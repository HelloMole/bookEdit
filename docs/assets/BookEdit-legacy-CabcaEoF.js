(function(){System.register(["./index-legacy-D7myyrmh.js"],(function(exports,module){"use strict";var _extends,Pagination,ref,onMounted,watch,createElementBlock,createVNode,isRef,unref,resolveComponent,withCtx,openBlock,createBaseVNode,createTextVNode,toDisplayString,getDefaultExportFromCjs,__vitePreload,_export_sfc,getAugmentedNamespace,commonjsGlobal,resolveDirective,createBlock,createCommentVNode,Fragment,renderList,withDirectives,normalizeStyle,UseElementSize,h$1,Tag,CloseOutlined,ApiFilled,api,api$1,hooks,ToolOutlined,BuildOutlined,LoginOutlined,LogoutOutlined,ApiOutlined,resolveDynamicComponent,vShow,withModifiers;return{setters:[t=>{_extends=t._,Pagination=t.P,ref=t.r,onMounted=t.o,watch=t.w,createElementBlock=t.c,createVNode=t.a,isRef=t.i,unref=t.u,resolveComponent=t.b,withCtx=t.d,openBlock=t.e,createBaseVNode=t.f,createTextVNode=t.g,toDisplayString=t.t,getDefaultExportFromCjs=t.h,__vitePreload=t.j,_export_sfc=t.k,getAugmentedNamespace=t.l,commonjsGlobal=t.m,resolveDirective=t.n,createBlock=t.p,createCommentVNode=t.q,Fragment=t.F,renderList=t.s,withDirectives=t.v,normalizeStyle=t.x,UseElementSize=t.U,h$1=t.y,Tag=t.T,CloseOutlined=t.C,ApiFilled=t.A,api=t.z,api$1=t.B,hooks=t.D,ToolOutlined=t.E,BuildOutlined=t.G,LoginOutlined=t.L,LogoutOutlined=t.H,ApiOutlined=t.I,resolveDynamicComponent=t.J,vShow=t.K,withModifiers=t.M}],execute:function(){var __vite_style__=document.createElement("style");function clone(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){for(var e=[],i=t.length,r=0;r<i;++r)e[r]=clone(t[r]);return e}if(t instanceof Object){e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=clone(t[n]));return e}}function arrToDit(t,e,i){if(!Array.isArray(t))return t;for(var r={},n=0;n<t.length;n++)r[t[n][e]]=t[n][i];return r}function bind(t,e){return function(){return t.apply(e,arguments)}}__vite_style__.textContent=".tree-node{width:100%;display:flex;align-items:center;justify-content:space-between}.tree-node .desc{font-size:12px;color:#999;margin-right:20px}.desc{padding:0 20px}.desc .example,.desc .description{font-size:12px}.about{width:100vw;display:flex;flex-direction:column}.gird:hover{border-width:1px;border-style:solid;border-color:#1853aa}#tfjs-visor-container{color:#2c3d50}:after .ant-card-body{padding:5px}.expandPolicyList{width:500px}.noexpandPolicyList{width:280px}.widthAni{transition:width .5s ease-in-out}.about[data-v-52828108] .ant-card .ant-card-body{padding:5px}.about[data-v-52828108] .ant-collapse .ant-collapse-item .ant-collapse-header{padding:7px 7px 7px 10px}.about[data-v-52828108] .ant-collapse .ant-collapse-content .ant-collapse-content-box{padding:5px 10px 10px}.about[data-v-52828108] .ant-tree .ant-tree-indent-unit{width:12px}.about[data-v-52828108] .ant-menu-light .ant-menu-submenu-popup,.about[data-v-52828108] .ant-menu-submenu,.about[data-v-52828108] .ant-menu-submenu-popup .ant-menu-vertical .ant-menu-sub,.ant-menu-vertical[data-v-52828108]{user-select:none}\n/*$vite$:1*/",document.head.appendChild(__vite_style__);const{toString:toString$1}=Object.prototype,{getPrototypeOf:getPrototypeOf}=Object,kindOf=(cache=Object.create(null),t=>{const e=toString$1.call(t);return cache[e]||(cache[e]=e.slice(8,-1).toLowerCase())});var cache;const kindOfTest=t=>(t=t.toLowerCase(),e=>kindOf(e)===t),typeOfTest=t=>e=>typeof e===t,{isArray:isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(t){return null!==t&&!isUndefined(t)&&null!==t.constructor&&!isUndefined(t.constructor)&&isFunction(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(t){let e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&isArrayBuffer(t.buffer),e}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=t=>null!==t&&"object"==typeof t,isBoolean=t=>!0===t||!1===t,isPlainObject=t=>{if("object"!==kindOf(t))return!1;const e=getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=t=>isObject(t)&&isFunction(t.pipe),isFormData=t=>{let e;return t&&("function"==typeof FormData&&t instanceof FormData||isFunction(t.append)&&("formdata"===(e=kindOf(t))||"object"===e&&isFunction(t.toString)&&"[object FormData]"===t.toString()))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(t,e,{allOwnKeys:i=!1}={}){if(null==t)return;let r,n;if("object"!=typeof t&&(t=[t]),isArray(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const n=i?Object.getOwnPropertyNames(t):Object.keys(t),s=n.length;let o;for(r=0;r<s;r++)o=n[r],e.call(null,t[o],o,t)}}function findKey(t,e){e=e.toLowerCase();const i=Object.keys(t);let r,n=i.length;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const _global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,isContextDefined=t=>!isUndefined(t)&&t!==_global;function merge$1(){const{caseless:t}=isContextDefined(this)&&this||{},e={},i=(i,r)=>{const n=t&&findKey(e,r)||r;isPlainObject(e[n])&&isPlainObject(i)?e[n]=merge$1(e[n],i):isPlainObject(i)?e[n]=merge$1({},i):isArray(i)?e[n]=i.slice():e[n]=i};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&forEach(arguments[r],i);return e}const extend=(t,e,i,{allOwnKeys:r}={})=>(forEach(e,((e,r)=>{i&&isFunction(e)?t[r]=bind(e,i):t[r]=e}),{allOwnKeys:r}),t),stripBOM=t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject=(t,e,i,r)=>{let n,s,o;const a={};if(e=e||{},null==t)return e;do{for(n=Object.getOwnPropertyNames(t),s=n.length;s-- >0;)o=n[s],r&&!r(o,t,e)||a[o]||(e[o]=t[o],a[o]=!0);t=!1!==i&&getPrototypeOf(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},endsWith=(t,e,i)=>{t=String(t),(void 0===i||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return-1!==r&&r===i},toArray=t=>{if(!t)return null;if(isArray(t))return t;let e=t.length;if(!isNumber(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},isTypedArray=(TypedArray="undefined"!=typeof Uint8Array&&getPrototypeOf(Uint8Array),t=>TypedArray&&t instanceof TypedArray);var TypedArray;const forEachEntry=(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=i.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},matchAll=(t,e)=>{let i;const r=[];for(;null!==(i=t.exec(e));)r.push(i);return r},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,i){return e.toUpperCase()+i})),hasOwnProperty=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};forEach(i,((i,n)=>{let s;!1!==(s=e(i,n,t))&&(r[n]=s||i)})),Object.defineProperties(t,r)},freezeMethods=t=>{reduceDescriptors(t,((e,i)=>{if(isFunction(t)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const r=t[i];isFunction(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet=(t,e)=>{const i={},r=t=>{t.forEach((t=>{i[t]=!0}))};return isArray(t)?r(t):r(String(t).split(e)),i},noop=()=>{},toFiniteNumber=(t,e)=>null!=t&&Number.isFinite(t=+t)?t:e;function isSpecCompliantForm(t){return!!(t&&isFunction(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])}const toJSONObject=t=>{const e=new Array(10),i=(t,r)=>{if(isObject(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[r]=t;const n=isArray(t)?[]:{};return forEach(t,((t,e)=>{const s=i(t,r+1);!isUndefined(s)&&(n[e]=s)})),e[r]=void 0,n}}return t};return i(t,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=t=>t&&(isObject(t)||isFunction(t))&&isFunction(t.then)&&isFunction(t.catch),_setImmediate=(setImmediateSupported="function"==typeof setImmediate,postMessageSupported=isFunction(_global.postMessage),setImmediateSupported?setImmediate:postMessageSupported?(token=`axios@${Math.random()}`,callbacks=[],_global.addEventListener("message",(({source:t,data:e})=>{t===_global&&e===token&&callbacks.length&&callbacks.shift()()}),!1),t=>{callbacks.push(t),_global.postMessage(token,"*")}):t=>setTimeout(t));var setImmediateSupported,postMessageSupported,token,callbacks;const asap="undefined"!=typeof queueMicrotask?queueMicrotask.bind(_global):"undefined"!=typeof process&&process.nextTick||_setImmediate,utils$4={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isBoolean:isBoolean,isObject:isObject,isPlainObject:isPlainObject,isReadableStream:isReadableStream,isRequest:isRequest,isResponse:isResponse,isHeaders:isHeaders,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isRegExp:isRegExp,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isTypedArray:isTypedArray,isFileList:isFileList,forEach:forEach,merge:merge$1,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,forEachEntry:forEachEntry,matchAll:matchAll,isHTMLForm:isHTMLForm,hasOwnProperty:hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors:reduceDescriptors,freezeMethods:freezeMethods,toObjectSet:toObjectSet,toCamelCase:toCamelCase,noop:noop,toFiniteNumber:toFiniteNumber,findKey:findKey,global:_global,isContextDefined:isContextDefined,isSpecCompliantForm:isSpecCompliantForm,toJSONObject:toJSONObject,isAsyncFn:isAsyncFn,isThenable:isThenable,setImmediate:_setImmediate,asap:asap};function AxiosError$1(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}utils$4.inherits(AxiosError$1,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$4.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{descriptors[t]={value:t}})),Object.defineProperties(AxiosError$1,descriptors),Object.defineProperty(prototype$1,"isAxiosError",{value:!0}),AxiosError$1.from=(t,e,i,r,n,s)=>{const o=Object.create(prototype$1);return utils$4.toFlatObject(t,o,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),AxiosError$1.call(o,t.message,e,i,r,n),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};const httpAdapter=null;function isVisitable(t){return utils$4.isPlainObject(t)||utils$4.isArray(t)}function removeBrackets(t){return utils$4.endsWith(t,"[]")?t.slice(0,-2):t}function renderKey(t,e,i){return t?t.concat(e).map((function(t,e){return t=removeBrackets(t),!i&&e?"["+t+"]":t})).join(i?".":""):e}function isFlatArray(t){return utils$4.isArray(t)&&!t.some(isVisitable)}const predicates=utils$4.toFlatObject(utils$4,{},null,(function(t){return/^is[A-Z]/.test(t)}));function toFormData$1(t,e,i){if(!utils$4.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const r=(i=utils$4.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!utils$4.isUndefined(e[t])}))).metaTokens,n=i.visitor||c,s=i.dots,o=i.indexes,a=(i.Blob||"undefined"!=typeof Blob&&Blob)&&utils$4.isSpecCompliantForm(e);if(!utils$4.isFunction(n))throw new TypeError("visitor must be a function");function l(t){if(null===t)return"";if(utils$4.isDate(t))return t.toISOString();if(!a&&utils$4.isBlob(t))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$4.isArrayBuffer(t)||utils$4.isTypedArray(t)?a&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function c(t,i,n){let a=t;if(t&&!n&&"object"==typeof t)if(utils$4.endsWith(i,"{}"))i=r?i:i.slice(0,-2),t=JSON.stringify(t);else if(utils$4.isArray(t)&&isFlatArray(t)||(utils$4.isFileList(t)||utils$4.endsWith(i,"[]"))&&(a=utils$4.toArray(t)))return i=removeBrackets(i),a.forEach((function(t,r){!utils$4.isUndefined(t)&&null!==t&&e.append(!0===o?renderKey([i],r,s):null===o?i:i+"[]",l(t))})),!1;return!!isVisitable(t)||(e.append(renderKey(n,i,s),l(t)),!1)}const h=[],u=Object.assign(predicates,{defaultVisitor:c,convertValue:l,isVisitable:isVisitable});if(!utils$4.isObject(t))throw new TypeError("data must be an object");return function t(i,r){if(!utils$4.isUndefined(i)){if(-1!==h.indexOf(i))throw Error("Circular reference detected in "+r.join("."));h.push(i),utils$4.forEach(i,(function(i,s){!0===(!(utils$4.isUndefined(i)||null===i)&&n.call(e,i,utils$4.isString(s)?s.trim():s,r,u))&&t(i,r?r.concat(s):[s])})),h.pop()}}(t),e}function encode$1(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function AxiosURLSearchParams(t,e){this._pairs=[],t&&toFormData$1(t,this,e)}const prototype=AxiosURLSearchParams.prototype;function encode(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(t,e,i){if(!e)return t;const r=i&&i.encode||encode;utils$4.isFunction(i)&&(i={serialize:i});const n=i&&i.serialize;let s;if(s=n?n(e,i):utils$4.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,i).toString(r),s){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}prototype.append=function(t,e){this._pairs.push([t,e])},prototype.toString=function(t){const e=t?function(e){return t.call(this,e,encode$1)}:encode$1;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};class InterceptorManager{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){utils$4.forEach(this.handlers,(function(e){null!==e&&t(e)}))}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1="undefined"!=typeof URLSearchParams?URLSearchParams:AxiosURLSearchParams,FormData$1="undefined"!=typeof FormData?FormData:null,Blob$1="undefined"!=typeof Blob?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv="undefined"!=typeof window&&"undefined"!=typeof document,_navigator="object"==typeof navigator&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,origin=hasBrowserEnv&&window.location.href||"http://localhost",utils$3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hasBrowserEnv,hasStandardBrowserEnv:hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv:hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin:origin},Symbol.toStringTag,{value:"Module"})),platform={...utils$3,...platform$1};function toURLEncodedForm(t,e){return toFormData$1(t,new platform.classes.URLSearchParams,Object.assign({visitor:function(t,e,i,r){return platform.isNode&&utils$4.isBuffer(t)?(this.append(e,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function parsePropPath(t){return utils$4.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}function arrayToObject(t){const e={},i=Object.keys(t);let r;const n=i.length;let s;for(r=0;r<n;r++)s=i[r],e[s]=t[s];return e}function formDataToJSON(t){function e(t,i,r,n){let s=t[n++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),a=n>=t.length;if(s=!s&&utils$4.isArray(r)?r.length:s,a)return utils$4.hasOwnProp(r,s)?r[s]=[r[s],i]:r[s]=i,!o;r[s]&&utils$4.isObject(r[s])||(r[s]=[]);return e(t,i,r[s],n)&&utils$4.isArray(r[s])&&(r[s]=arrayToObject(r[s])),!o}if(utils$4.isFormData(t)&&utils$4.isFunction(t.entries)){const i={};return utils$4.forEachEntry(t,((t,r)=>{e(parsePropPath(t),r,i,0)})),i}return null}function stringifySafely(t,i,r){if(utils$4.isString(t))try{return(i||JSON.parse)(t),utils$4.trim(t)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(t)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const i=e.getContentType()||"",r=i.indexOf("application/json")>-1,n=utils$4.isObject(t);n&&utils$4.isHTMLForm(t)&&(t=new FormData(t));if(utils$4.isFormData(t))return r?JSON.stringify(formDataToJSON(t)):t;if(utils$4.isArrayBuffer(t)||utils$4.isBuffer(t)||utils$4.isStream(t)||utils$4.isFile(t)||utils$4.isBlob(t)||utils$4.isReadableStream(t))return t;if(utils$4.isArrayBufferView(t))return t.buffer;if(utils$4.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(n){if(i.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(t,this.formSerializer).toString();if((s=utils$4.isFileList(t))||i.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return toFormData$1(s?{"files[]":t}:t,e&&new e,this.formSerializer)}}return n||r?(e.setContentType("application/json",!1),stringifySafely(t)):t}],transformResponse:[function(t){const i=this.transitional||defaults.transitional,r=i&&i.forcedJSONParsing,n="json"===this.responseType;if(utils$4.isResponse(t)||utils$4.isReadableStream(t))return t;if(t&&utils$4.isString(t)&&(r&&!this.responseType||n)){const r=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(e){if(r){if("SyntaxError"===e.name)throw AxiosError$1.from(e,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$4.forEach(["delete","get","head","post","put","patch"],(t=>{defaults.headers[t]={}}));const ignoreDuplicateOf=utils$4.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=t=>{const e={};let i,r,n;return t&&t.split("\n").forEach((function(t){n=t.indexOf(":"),i=t.substring(0,n).trim().toLowerCase(),r=t.substring(n+1).trim(),!i||e[i]&&ignoreDuplicateOf[i]||("set-cookie"===i?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)})),e},$internals=Symbol("internals");function normalizeHeader(t){return t&&String(t).trim().toLowerCase()}function normalizeValue(t){return!1===t||null==t?t:utils$4.isArray(t)?t.map(normalizeValue):String(t)}function parseTokens(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const isValidHeaderName=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function matchHeaderValue(t,e,i,r,n){return utils$4.isFunction(r)?r.call(this,e,i):(n&&(e=i),utils$4.isString(e)?utils$4.isString(r)?-1!==e.indexOf(r):utils$4.isRegExp(r)?r.test(e):void 0:void 0)}function formatHeader(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,i)=>e.toUpperCase()+i))}function buildAccessors(t,e){const i=utils$4.toCamelCase(" "+e);["get","set","has"].forEach((r=>{Object.defineProperty(t,r+i,{value:function(t,i,n){return this[r].call(this,e,t,i,n)},configurable:!0})}))}let AxiosHeaders$1=class{constructor(t){t&&this.set(t)}set(t,e,i){const r=this;function n(t,e,i){const n=normalizeHeader(e);if(!n)throw new Error("header name must be a non-empty string");const s=utils$4.findKey(r,n);(!s||void 0===r[s]||!0===i||void 0===i&&!1!==r[s])&&(r[s||e]=normalizeValue(t))}const s=(t,e)=>utils$4.forEach(t,((t,i)=>n(t,i,e)));if(utils$4.isPlainObject(t)||t instanceof this.constructor)s(t,e);else if(utils$4.isString(t)&&(t=t.trim())&&!isValidHeaderName(t))s(parseHeaders(t),e);else if(utils$4.isHeaders(t))for(const[o,a]of t.entries())n(a,o,i);else null!=t&&n(e,t,i);return this}get(t,e){if(t=normalizeHeader(t)){const i=utils$4.findKey(this,t);if(i){const t=this[i];if(!e)return t;if(!0===e)return parseTokens(t);if(utils$4.isFunction(e))return e.call(this,t,i);if(utils$4.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=normalizeHeader(t)){const i=utils$4.findKey(this,t);return!(!i||void 0===this[i]||e&&!matchHeaderValue(this,this[i],i,e))}return!1}delete(t,e){const i=this;let r=!1;function n(t){if(t=normalizeHeader(t)){const n=utils$4.findKey(i,t);!n||e&&!matchHeaderValue(i,i[n],n,e)||(delete i[n],r=!0)}}return utils$4.isArray(t)?t.forEach(n):n(t),r}clear(t){const e=Object.keys(this);let i=e.length,r=!1;for(;i--;){const n=e[i];t&&!matchHeaderValue(this,this[n],n,t,!0)||(delete this[n],r=!0)}return r}normalize(t){const e=this,i={};return utils$4.forEach(this,((r,n)=>{const s=utils$4.findKey(i,n);if(s)return e[s]=normalizeValue(r),void delete e[n];const o=t?formatHeader(n):String(n).trim();o!==n&&delete e[n],e[o]=normalizeValue(r),i[o]=!0})),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return utils$4.forEach(this,((i,r)=>{null!=i&&!1!==i&&(e[r]=t&&utils$4.isArray(i)?i.join(", "):i)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([t,e])=>t+": "+e)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach((t=>i.set(t))),i}static accessor(t){const e=(this[$internals]=this[$internals]={accessors:{}}).accessors,i=this.prototype;function r(t){const r=normalizeHeader(t);e[r]||(buildAccessors(i,t),e[r]=!0)}return utils$4.isArray(t)?t.forEach(r):r(t),this}};function transformData(t,e){const i=this||defaults,r=e||i,n=AxiosHeaders$1.from(r.headers);let s=r.data;return utils$4.forEach(t,(function(t){s=t.call(i,s,n.normalize(),e?e.status:void 0)})),n.normalize(),s}function isCancel$1(t){return!(!t||!t.__CANCEL__)}function CanceledError$1(t,e,i){AxiosError$1.call(this,null==t?"canceled":t,AxiosError$1.ERR_CANCELED,e,i),this.name="CanceledError"}function settle(t,e,i){const r=i.config.validateStatus;i.status&&r&&!r(i.status)?e(new AxiosError$1("Request failed with status code "+i.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}function parseProtocol(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function speedometer(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n,s=0,o=0;return e=void 0!==e?e:1e3,function(a){const l=Date.now(),c=r[o];n||(n=l),i[s]=a,r[s]=l;let h=o,u=0;for(;h!==s;)u+=i[h++],h%=t;if(s=(s+1)%t,s===o&&(o=(o+1)%t),l-n<e)return;const d=c&&l-c;return d?Math.round(1e3*u/d):void 0}}function throttle(t,e){let i,r,n=0,s=1e3/e;const o=(e,s=Date.now())=>{n=s,i=null,r&&(clearTimeout(r),r=null),t.apply(null,e)};return[(...t)=>{const e=Date.now(),a=e-n;a>=s?o(t,e):(i=t,r||(r=setTimeout((()=>{r=null,o(i)}),s-a)))},()=>i&&o(i)]}AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils$4.reduceDescriptors(AxiosHeaders$1.prototype,(({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(t){this[i]=t}}})),utils$4.freezeMethods(AxiosHeaders$1),utils$4.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});const progressEventReducer=(t,e,i=3)=>{let r=0;const n=speedometer(50,250);return throttle((i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-r,l=n(a);r=s;t({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:i,lengthComputable:null!=o,[e?"download":"upload"]:!0})}),i)},progressEventDecorator=(t,e)=>{const i=null!=t;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},asyncDecorator=t=>(...e)=>utils$4.asap((()=>t(...e))),isURLSameOrigin=platform.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,platform.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(t,e,i,r,n,s){const o=[t+"="+encodeURIComponent(e)];utils$4.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),utils$4.isString(r)&&o.push("path="+r),utils$4.isString(n)&&o.push("domain="+n),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function isAbsoluteURL(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function combineURLs(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function buildFullPath(t,e,i){let r=!isAbsoluteURL(e);return t&&r||0==i?combineURLs(t,e):e}const headersToObject=t=>t instanceof AxiosHeaders$1?{...t}:t;function mergeConfig$1(t,e){e=e||{};const i={};function r(t,e,i,r){return utils$4.isPlainObject(t)&&utils$4.isPlainObject(e)?utils$4.merge.call({caseless:r},t,e):utils$4.isPlainObject(e)?utils$4.merge({},e):utils$4.isArray(e)?e.slice():e}function n(t,e,i,n){return utils$4.isUndefined(e)?utils$4.isUndefined(t)?void 0:r(void 0,t,0,n):r(t,e,0,n)}function s(t,e){if(!utils$4.isUndefined(e))return r(void 0,e)}function o(t,e){return utils$4.isUndefined(e)?utils$4.isUndefined(t)?void 0:r(void 0,t):r(void 0,e)}function a(i,n,s){return s in e?r(i,n):s in t?r(void 0,i):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(t,e,i)=>n(headersToObject(t),headersToObject(e),0,!0)};return utils$4.forEach(Object.keys(Object.assign({},t,e)),(function(r){const s=l[r]||n,o=s(t[r],e[r],r);utils$4.isUndefined(o)&&s!==a||(i[r]=o)})),i}const resolveConfig=t=>{const e=mergeConfig$1({},t);let i,{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:o,headers:a,auth:l}=e;if(e.headers=a=AxiosHeaders$1.from(a),e.url=buildURL(buildFullPath(e.baseURL,e.url),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),utils$4.isFormData(r))if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(i=a.getContentType())){const[t,...e]=i?i.split(";").map((t=>t.trim())).filter(Boolean):[];a.setContentType([t||"multipart/form-data",...e].join("; "))}if(platform.hasStandardBrowserEnv&&(n&&utils$4.isFunction(n)&&(n=n(e)),n||!1!==n&&isURLSameOrigin(e.url))){const t=s&&o&&cookies.read(o);t&&a.set(s,t)}return e},isXHRAdapterSupported="undefined"!=typeof XMLHttpRequest,xhrAdapter=isXHRAdapterSupported&&function(t){return new Promise((function(e,i){const r=resolveConfig(t);let n=r.data;const s=AxiosHeaders$1.from(r.headers).normalize();let o,a,l,c,h,{responseType:u,onUploadProgress:d,onDownloadProgress:p}=r;function f(){c&&c(),h&&h(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let _=new XMLHttpRequest;function m(){if(!_)return;const r=AxiosHeaders$1.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders());settle((function(t){e(t),f()}),(function(t){i(t),f()}),{data:u&&"text"!==u&&"json"!==u?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:r,config:t,request:_}),_=null}_.open(r.method.toUpperCase(),r.url,!0),_.timeout=r.timeout,"onloadend"in _?_.onloadend=m:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(m)},_.onabort=function(){_&&(i(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,t,_)),_=null)},_.onerror=function(){i(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,t,_)),_=null},_.ontimeout=function(){let e=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const n=r.transitional||transitionalDefaults;r.timeoutErrorMessage&&(e=r.timeoutErrorMessage),i(new AxiosError$1(e,n.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,t,_)),_=null},void 0===n&&s.setContentType(null),"setRequestHeader"in _&&utils$4.forEach(s.toJSON(),(function(t,e){_.setRequestHeader(e,t)})),utils$4.isUndefined(r.withCredentials)||(_.withCredentials=!!r.withCredentials),u&&"json"!==u&&(_.responseType=r.responseType),p&&([l,h]=progressEventReducer(p,!0),_.addEventListener("progress",l)),d&&_.upload&&([a,c]=progressEventReducer(d),_.upload.addEventListener("progress",a),_.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(o=e=>{_&&(i(!e||e.type?new CanceledError$1(null,t,_):e),_.abort(),_=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const g=parseProtocol(r.url);g&&-1===platform.protocols.indexOf(g)?i(new AxiosError$1("Unsupported protocol "+g+":",AxiosError$1.ERR_BAD_REQUEST,t)):_.send(n||null)}))},composeSignals=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let i,r=new AbortController;const n=function(t){if(!i){i=!0,o();const e=t instanceof Error?t:this.reason;r.abort(e instanceof AxiosError$1?e:new CanceledError$1(e instanceof Error?e.message:e))}};let s=e&&setTimeout((()=>{s=null,n(new AxiosError$1(`timeout ${e} of ms exceeded`,AxiosError$1.ETIMEDOUT))}),e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach((t=>{t.unsubscribe?t.unsubscribe(n):t.removeEventListener("abort",n)})),t=null)};t.forEach((t=>t.addEventListener("abort",n)));const{signal:a}=r;return a.unsubscribe=()=>utils$4.asap(o),a}},streamChunk=function*(t,e){let i=t.byteLength;if(i<e)return void(yield t);let r,n=0;for(;n<i;)r=n+e,yield t.slice(n,r),n=r},readBytes=async function*(t,e){for await(const i of readStream(t))yield*streamChunk(i,e)},readStream=async function*(t){if(t[Symbol.asyncIterator])return void(yield*t);const e=t.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},trackStream=(t,e,i,r)=>{const n=readBytes(t,e);let s,o=0,a=t=>{s||(s=!0,r&&r(t))};return new ReadableStream({async pull(t){try{const{done:e,value:r}=await n.next();if(e)return a(),void t.close();let s=r.byteLength;if(i){let t=o+=s;i(t)}t.enqueue(new Uint8Array(r))}catch(e){throw a(e),e}},cancel:t=>(a(t),n.return())},{highWaterMark:2})},isFetchSupported="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,isReadableStreamSupported=isFetchSupported&&"function"==typeof ReadableStream,encodeText=isFetchSupported&&("function"==typeof TextEncoder?(encoder=new TextEncoder,t=>encoder.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var encoder;const test=(t,...i)=>{try{return!!t(...i)}catch(e){return!1}},supportsRequestStream=isReadableStreamSupported&&test((()=>{let t=!1;const e=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})),DEFAULT_CHUNK_SIZE=65536,supportsResponseStream=isReadableStreamSupported&&test((()=>utils$4.isReadableStream(new Response("").body))),resolvers={stream:supportsResponseStream&&(t=>t.body)};var res;isFetchSupported&&(res=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!resolvers[t]&&(resolvers[t]=utils$4.isFunction(res[t])?e=>e[t]():(e,i)=>{throw new AxiosError$1(`Response type '${t}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,i)})})));const getBodyLength=async t=>{if(null==t)return 0;if(utils$4.isBlob(t))return t.size;if(utils$4.isSpecCompliantForm(t)){const e=new Request(platform.origin,{method:"POST",body:t});return(await e.arrayBuffer()).byteLength}return utils$4.isArrayBufferView(t)||utils$4.isArrayBuffer(t)?t.byteLength:(utils$4.isURLSearchParams(t)&&(t+=""),utils$4.isString(t)?(await encodeText(t)).byteLength:void 0)},resolveBodyLength=async(t,e)=>{const i=utils$4.toFiniteNumber(t.getContentLength());return null==i?getBodyLength(e):i},fetchAdapter=isFetchSupported&&(async t=>{let{url:e,method:i,data:r,signal:n,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:h,withCredentials:u="same-origin",fetchOptions:d}=resolveConfig(t);c=c?(c+"").toLowerCase():"text";let p,f=composeSignals([n,s&&s.toAbortSignal()],o);const _=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let m;try{if(l&&supportsRequestStream&&"get"!==i&&"head"!==i&&0!==(m=await resolveBodyLength(h,r))){let t,i=new Request(e,{method:"POST",body:r,duplex:"half"});if(utils$4.isFormData(r)&&(t=i.headers.get("content-type"))&&h.setContentType(t),i.body){const[t,e]=progressEventDecorator(m,progressEventReducer(asyncDecorator(l)));r=trackStream(i.body,DEFAULT_CHUNK_SIZE,t,e)}}utils$4.isString(u)||(u=u?"include":"omit");const n="credentials"in Request.prototype;p=new Request(e,{...d,signal:f,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:r,duplex:"half",credentials:n?u:void 0});let s=await fetch(p);const o=supportsResponseStream&&("stream"===c||"response"===c);if(supportsResponseStream&&(a||o&&_)){const t={};["status","statusText","headers"].forEach((e=>{t[e]=s[e]}));const e=utils$4.toFiniteNumber(s.headers.get("content-length")),[i,r]=a&&progressEventDecorator(e,progressEventReducer(asyncDecorator(a),!0))||[];s=new Response(trackStream(s.body,DEFAULT_CHUNK_SIZE,i,(()=>{r&&r(),_&&_()})),t)}c=c||"text";let g=await resolvers[utils$4.findKey(resolvers,c)||"text"](s,t);return!o&&_&&_(),await new Promise(((e,i)=>{settle(e,i,{data:g,headers:AxiosHeaders$1.from(s.headers),status:s.status,statusText:s.statusText,config:t,request:p})}))}catch(g){if(_&&_(),g&&"TypeError"===g.name&&/fetch/i.test(g.message))throw Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,t,p),{cause:g.cause||g});throw AxiosError$1.from(g,g&&g.code,t,p)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$4.forEach(knownAdapters,((t,i)=>{if(t){try{Object.defineProperty(t,"name",{value:i})}catch(e){}Object.defineProperty(t,"adapterName",{value:i})}}));const renderReason=t=>`- ${t}`,isResolvedHandle=t=>utils$4.isFunction(t)||null===t||!1===t,adapters={getAdapter:t=>{t=utils$4.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let s=0;s<e;s++){let e;if(i=t[s],r=i,!isResolvedHandle(i)&&(r=knownAdapters[(e=String(i)).toLowerCase()],void 0===r))throw new AxiosError$1(`Unknown adapter '${e}'`);if(r)break;n[e||"#"+s]=r}if(!r){const t=Object.entries(n).map((([t,e])=>`adapter ${t} `+(!1===e?"is not supported by the environment":"is not available in the build")));throw new AxiosError$1("There is no suitable adapter to dispatch the request "+(e?t.length>1?"since :\n"+t.map(renderReason).join("\n"):" "+renderReason(t[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:knownAdapters};function throwIfCancellationRequested(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new CanceledError$1(null,t)}function dispatchRequest(t){throwIfCancellationRequested(t),t.headers=AxiosHeaders$1.from(t.headers),t.data=transformData.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1);return adapters.getAdapter(t.adapter||defaults.adapter)(t).then((function(e){return throwIfCancellationRequested(t),e.data=transformData.call(t,t.transformResponse,e),e.headers=AxiosHeaders$1.from(e.headers),e}),(function(e){return isCancel$1(e)||(throwIfCancellationRequested(t),e&&e.response&&(e.response.data=transformData.call(t,t.transformResponse,e.response),e.response.headers=AxiosHeaders$1.from(e.response.headers))),Promise.reject(e)}))}const VERSION$1="1.8.1",validators$1={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{validators$1[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));const deprecatedWarnings={};function assertOptions(t,e,i){if("object"!=typeof t)throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const s=r[n],o=e[s];if(o){const e=t[s],i=void 0===e||o(e,s,t);if(!0!==i)throw new AxiosError$1("option "+s+" must be "+i,AxiosError$1.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new AxiosError$1("Unknown option "+s,AxiosError$1.ERR_BAD_OPTION)}}validators$1.transitional=function(t,e,i){function r(t,e){return"[Axios v"+VERSION$1+"] Transitional option '"+t+"'"+e+(i?". "+i:"")}return(i,n,s)=>{if(!1===t)throw new AxiosError$1(r(n," has been removed"+(e?" in "+e:"")),AxiosError$1.ERR_DEPRECATED);return e&&!deprecatedWarnings[n]&&(deprecatedWarnings[n]=!0,console.warn(r(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,n,s)}},validators$1.spelling=function(t){return(e,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};const validator={assertOptions:assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(t){this.defaults=t,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(t,i){try{return await this._request(t,i)}catch(r){if(r instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const i=t.stack?t.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+i):r.stack=i}catch(e){}}throw r}}_request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=mergeConfig$1(this.defaults,e);const{transitional:i,paramsSerializer:r,headers:n}=e;void 0!==i&&validator.assertOptions(i,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),null!=r&&(utils$4.isFunction(r)?e.paramsSerializer={serialize:r}:validator.assertOptions(r,{encode:validators.function,serialize:validators.function},!0)),void 0!==e.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),validator.assertOptions(e,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=n&&utils$4.merge(n.common,n[e.method]);n&&utils$4.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete n[t]})),e.headers=AxiosHeaders$1.concat(s,n);const o=[];let a=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(a=a&&t.synchronous,o.unshift(t.fulfilled,t.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(t){l.push(t.fulfilled,t.rejected)}));let h,u=0;if(!a){const t=[dispatchRequest.bind(this),void 0];for(t.unshift.apply(t,o),t.push.apply(t,l),h=t.length,c=Promise.resolve(e);u<h;)c=c.then(t[u++],t[u++]);return c}h=o.length;let d=e;for(u=0;u<h;){const t=o[u++],e=o[u++];try{d=t(d)}catch(p){e.call(this,p);break}}try{c=dispatchRequest.call(this,d)}catch(p){return Promise.reject(p)}for(u=0,h=l.length;u<h;)c=c.then(l[u++],l[u++]);return c}getUri(t){return buildURL(buildFullPath((t=mergeConfig$1(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};utils$4.forEach(["delete","get","head","options"],(function(t){Axios$1.prototype[t]=function(e,i){return this.request(mergeConfig$1(i||{},{method:t,url:e,data:(i||{}).data}))}})),utils$4.forEach(["post","put","patch"],(function(t){function e(e){return function(i,r,n){return this.request(mergeConfig$1(n||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Axios$1.prototype[t]=e(),Axios$1.prototype[t+"Form"]=e(!0)}));let CancelToken$1=class t{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const i=this;this.promise.then((t=>{if(!i._listeners)return;let e=i._listeners.length;for(;e-- >0;)i._listeners[e](t);i._listeners=null})),this.promise.then=t=>{let e;const r=new Promise((t=>{i.subscribe(t),e=t})).then(t);return r.cancel=function(){i.unsubscribe(e)},r},t((function(t,r,n){i.reason||(i.reason=new CanceledError$1(t,r,n),e(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=e=>{t.abort(e)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let e;const i=new t((function(t){e=t}));return{token:i,cancel:e}}};function spread$1(t){return function(e){return t.apply(null,e)}}function isAxiosError$1(t){return utils$4.isObject(t)&&!0===t.isAxiosError}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};function createInstance(t){const e=new Axios$1(t),i=bind(Axios$1.prototype.request,e);return utils$4.extend(i,Axios$1.prototype,e,{allOwnKeys:!0}),utils$4.extend(i,e,null,{allOwnKeys:!0}),i.create=function(e){return createInstance(mergeConfig$1(t,e))},i}Object.entries(HttpStatusCode$1).forEach((([t,e])=>{HttpStatusCode$1[e]=t}));const axios=createInstance(defaults);axios.Axios=Axios$1,axios.CanceledError=CanceledError$1,axios.CancelToken=CancelToken$1,axios.isCancel=isCancel$1,axios.VERSION=VERSION$1,axios.toFormData=toFormData$1,axios.AxiosError=AxiosError$1,axios.Cancel=axios.CanceledError,axios.all=function(t){return Promise.all(t)},axios.spread=spread$1,axios.isAxiosError=isAxiosError$1,axios.mergeConfig=mergeConfig$1,axios.AxiosHeaders=AxiosHeaders$1,axios.formToJSON=t=>formDataToJSON(utils$4.isHTMLForm(t)?new FormData(t):t),axios.getAdapter=adapters.getAdapter,axios.HttpStatusCode=HttpStatusCode$1,axios.default=axios;const{Axios:Axios,AxiosError:AxiosError,CanceledError:CanceledError,isCancel:isCancel,CancelToken:CancelToken,VERSION:VERSION,all:all,Cancel:Cancel,isAxiosError:isAxiosError,spread:spread,toFormData:toFormData,AxiosHeaders:AxiosHeaders,HttpStatusCode:HttpStatusCode,formToJSON:formToJSON,getAdapter:getAdapter,mergeConfig:mergeConfig}=axios,locale$2={locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",yearFormat:"YYYY年",dayFormat:"D日",dateFormat:"YYYY年M月D日",dateTimeFormat:"YYYY年M月D日 HH时mm分ss秒",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪"},locale$1={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]},locale={lang:_extends({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},locale$2),timePickerLocale:_extends({},locale$1)};locale.lang.ok="确定";const typeTemplate="${label}不是一个有效的${type}",localeValues={locale:"zh-cn",Pagination:Pagination,DatePicker:locale,TimePicker:locale$1,Calendar:locale,global:{placeholder:"请选择"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckall:"全选",filterSearchPlaceholder:"在筛选项中搜索",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开"},PageHeader:{back:"返回"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:typeTemplate,method:typeTemplate,array:typeTemplate,object:typeTemplate,number:typeTemplate,date:typeTemplate,boolean:typeTemplate,integer:typeTemplate,float:typeTemplate,regexp:typeTemplate,email:typeTemplate,url:typeTemplate,hex:typeTemplate},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码已过期",refresh:"点击刷新",scanned:"已扫描"}},_hoisted_1$4=["onMouseenter"],_hoisted_2$3={key:0,style:{display:"flex"}},_hoisted_3$3={style:{color:"#f50"}},_hoisted_4$3={key:1},__default__$1={name:"Tree"},_sfc_main$4=Object.assign(__default__$1,{props:["data"],emits:["mouseenter","node-click"],setup(t,{emit:e}){const i=t,r=e;var n=ref(""),s=ref(!0);const o=(t,e)=>{console.log("onSelectNode",t,e.node.dataRef),r("node-click",e.node.dataRef)};var a=ref([]);onMounted((()=>{console.log("the component is now mounted.",i.data)}));const l=(t,e)=>{let i;for(let r=0;r<e.length;r++){const n=e[r];n.children&&(n.children.some((e=>e.key===t))?i=n.key:l(t,n.children)&&(i=l(t,n.children)))}return i},c=t=>{a.value=t,s.value=!1},h=[],u=t=>{for(let e=0;e<t.length;e++){const i=t[e],r=i.key;h.push({key:r,title:i.title}),i.children&&u(i.children)}};return u(i.data),watch(n,(t=>{t=t.toUpperCase(),console.log("props.data",i.data,h);const e=h.map((e=>e.title.indexOf(t)>-1?l(e.key,i.data):null)).filter(((t,e,i)=>t&&i.indexOf(t)===e));a.value=e,n.value=t,s.value=!0})),(t,e)=>{const l=resolveComponent("a-input-search"),h=resolveComponent("a-tree");return openBlock(),createElementBlock("div",null,[createVNode(l,{value:unref(n),"onUpdate:value":e[0]||(e[0]=t=>isRef(n)?n.value=t:n=t),style:{"margin-bottom":"8px"},placeholder:"Search"},null,8,["value"]),createVNode(h,{style:{"max-width":"600px"},"tree-data":i.data,expandedKeys:unref(a),"onUpdate:expandedKeys":e[1]||(e[1]=t=>isRef(a)?a.value=t:a=t),onSelect:o,"auto-expand-parent":unref(s),onExpand:c},{title:withCtx((({title:t,key:e})=>[createBaseVNode("div",{class:"tree-node",onMouseenter:e=>{r("mouseenter",t)}},[t.indexOf(unref(n))>-1?(openBlock(),createElementBlock("div",_hoisted_2$3,[createTextVNode(toDisplayString(t.substring(0,t.indexOf(unref(n))))+" ",1),createBaseVNode("div",_hoisted_3$3,toDisplayString(unref(n)),1),createTextVNode(" "+toDisplayString(t.substring(t.indexOf(unref(n))+unref(n).length)),1)])):(openBlock(),createElementBlock("div",_hoisted_4$3,toDisplayString(t),1))],40,_hoisted_1$4)])),_:1},8,["tree-data","expandedKeys","auto-expand-parent"])])}}}),_hoisted_1$3={class:"desc"},_hoisted_2$2={class:"title"},_hoisted_3$2={class:"example"},_hoisted_4$2={class:"description"},__default__={name:"Desc"},_sfc_main$3=Object.assign(__default__,{props:{title:{type:String,default:""},example:{type:String,default:""},description:{type:String,default:""}},setup(t){const e=t;return(t,i)=>(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("h4",_hoisted_2$2,toDisplayString(e.title),1),createBaseVNode("p",_hoisted_3$2,toDisplayString(e.example),1),createBaseVNode("p",_hoisted_4$2,toDisplayString(e.description),1)]))}});class Observer{constructor(){this.observerListeners={},this.observerToken=0}publish(t,...e){if(!t||!this.observerListeners[t])return!1;let i=this.observerListeners[t];for(let r=0;r<i.length;r++)i[r].context?i[r].fn.apply(i[r].context,e):i[r].fn.apply(i[r].fn,e)}subscribe(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.observerListeners[t]||(this.observerListeners[t]=[]),this.observerToken++,this.observerListeners[t].push({fn:e,context:i,token:this.observerToken}),this.observerToken}unsubscribe(t){if(!t)return!1;for(let e in this.observerListeners)if(this.observerListeners.hasOwnProperty(e))for(let i=0;i<this.observerListeners[e].length;i++)this.observerListeners[e][i].token===t&&this.observerListeners[e].splice(i,1)}clearTopic(t){if(!t)return!1;for(let e in this.observerListeners)this.observerListeners.hasOwnProperty(e)&&e===t&&delete this.observerListeners[e]}clearAll(){this.observerListeners={},this.observerToken=0}}function checkLineSegmentCross(t,e,i,r){let n=!1,s=[e.x-t.x,e.y-t.y],o=[i.x-t.x,i.y-t.y],a=[r.x-t.x,r.y-t.y],l=s[0]*o[1]-s[1]*o[0],c=s[0]*a[1]-s[1]*a[0],h=[i.x-r.x,i.y-r.y],u=[t.x-r.x,t.y-r.y],d=[e.x-r.x,e.y-r.y];return l*c<0&&(h[0]*u[1]-h[1]*u[0])*(h[0]*d[1]-h[1]*d[0])<0&&(n=!0),n}function getLinePointDistance(t,e,i,r,n,s){if(t===i)return Math.abs(n-t);{let o,a,l=1;return o=(e-r)/(i-t),a=0-l*e-o*t,Math.abs((o*n+l*s+a)/Math.sqrt(o*o+l*l))}}function getAngle(t,e,i,r){let n=180*Math.atan2(r-e,i-t)/Math.PI;return n>0?n-360:n}function getLinePointYByX(t,e,i,r,n){if(t===i)return Math.min(e,r);{let s,o,a=1;s=(e-r)/(i-t),o=0-a*e-s*t;const l=t=>(0-o-s*t)/a;return l(n)}}function getLineAllPoint(t,e,i,r){let n=[];if(t===i){let i=Math.abs(r-e),s=Math.min(e,r);for(let e=0;e<=i;e++)n.push([t,s+e])}else{let s,o,a=1;s=(e-r)/(i-t),o=0-a*e-s*t;const l=t=>(0-o-s*t)/a;let c=Math.abs(i-t),h=Math.min(t,i);for(let t=0;t<=c;t++)n.push([h+t,l(h+t)])}return n}function getTwoPointDistance(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function getNearestPointFromLine(t,e,i,r,n,s){let o=getLineAllPoint(t,e,i,r),a=1/0,l=null;return o.forEach((t=>{let e=getTwoPointDistance(t[0],t[1],n,s);e<a&&(a=e,l=t)})),l}function loadImage(t){return new Promise(((e,i)=>{let r=new Image;r.onload=()=>{e(r)},r.onerror=t=>{i(t)},r.src=t}))}const utils$2={checkLineSegmentCross:checkLineSegmentCross,loadImage:loadImage,getTwoPointDistance:getTwoPointDistance,getLinePointYByX:getLinePointYByX,getLineAllPoint:getLineAllPoint,getLinePointDistance:getLinePointDistance,getAngle:getAngle,getNearestPointFromLine:getNearestPointFromLine},defaultStrokeStyle={lineWidth:3,strokeColor:"rgba(0, 136, 255, 1)",lineJoin:"round",frontLineWidth:3,frontStrokeColor:"rgba(0, 136, 255, 1)",frontLineJoin:"round"},defaultFillColor="rgba(0, 136, 255, 0.5)",defaultPointStyle={lineWidth:3,strokeColor:"rgba(0, 136, 255, 1)",fillColor:"rgba(0, 136, 255, 0.5)"},defaultOpt$3={showPoint:!0,pointType:"square",pointWidth:3,lineType:"line"};class MarkItem{constructor(t=null,e={}){this.ctx=t,this.updateOpt(e),this.updatePointFn=e.updatePoint,this.pointArr=e.pointArr||[],this.isClosePath=!1,this.isEditing=!1,this.isDragging=!1,this.dragPointIndex=-1,this.dragCachePointArr=[],this.hoverActive=!1,this.areaToPointPos=null}updateOpt(t){this.opt={...defaultOpt$3,...t},this.data=t.data||null,this.strokeStyle=t.strokeStyle?{...defaultStrokeStyle,...t.strokeStyle}:defaultStrokeStyle,this.fillColor=t.fillColor||defaultFillColor,this.pointStyle=t.pointStyle?{...defaultPointStyle,...t.pointStyle}:defaultPointStyle,this.area=t.area||!1,this.enableAddPoint=t.enableAddPoint||!1}enable(){this.isEditing=!0,this.insertFictitiousPoints()}disable(){this.isEditing=!1,this.removeFictitiousPoints()}getTruePointArr(){return this.pointArr.filter((t=>!t.fictitious))}getPointLength(){return this.getTruePointArr().length}pushPoint(t,e){this.isEditing&&!this.isClosePath&&this.pointArr.push({x:t,y:e})}removePoint(t){this.pointArr[t].fictitious||(this.pointArr.splice(t,1),this.removeFictitiousPoints(),this.insertFictitiousPoints())}areaToPoint(t,e){this.areaToPointPos={x:t,y:e}}render(){(this.isClosePath||this.area)&&this.renderArea(),"custom"===this.opt.lineType?this.opt.customRenderLine&&this.opt.customRenderLine(this):"borderLine"===this.opt.lineType?(this.renderLines(this.strokeStyle),this.renderLines({...this.strokeStyle,lineWidth:this.strokeStyle.frontLineWidth,strokeColor:this.strokeStyle.frontStrokeColor,lineJoin:this.strokeStyle.frontLineJoin})):this.renderLines(this.strokeStyle),this.renderPoints()}renderArea(){this.ctx.save(),this.ctx.fillStyle=this.fillColor,this.ctx.beginPath();let t=this.pointArr.concat(this.area&&this.areaToPointPos?[this.areaToPointPos]:[]);for(let e=0;e<t.length;e++){let i=t[e].x,r=t[e].y;0===e?this.ctx.moveTo(i,r):this.ctx.lineTo(i,r)}this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}renderLines({lineWidth:t,strokeColor:e,lineJoin:i},r){this.ctx.save(),this.ctx.lineWidth=t,this.ctx.strokeStyle=e,this.ctx.lineJoin=i,this.ctx.beginPath();let n=this.pointArr.concat(this.area&&this.areaToPointPos?[this.areaToPointPos]:[]);for(let s=0;s<n.length;s++){let t=n[s].x,e=n[s].y;0===s?this.ctx.moveTo(t,e):this.ctx.lineTo(t,e)}(this.isClosePath||this.area)&&this.ctx.closePath(),r||this.ctx.stroke(),this.ctx.restore()}renderPoints(t,e){for(let i=0;i<this.pointArr.length;i++){this.ctx.beginPath();let r=this.pointArr[i].x,n=this.pointArr[i].y;(this.isEditing||t||this.hoverActive)&&(this.drawPoint(r,n,t,!1,this.pointArr[i].fictitious),e&&e(i))}}insertFictitiousPoints(){if(!this.isEditing||!this.isClosePath||!this.enableAddPoint)return;this.removeFictitiousPoints();let t=[],e=this.pointArr,i=e.length;for(let n=0;n<i-1;n++){let i=e[n],r=e[n+1];t.push({x:(i.x+r.x)/2,y:(i.y+r.y)/2,fictitious:!0})}t.push({x:(e[i-1].x+e[0].x)/2,y:(e[i-1].y+e[0].y)/2,fictitious:!0});let r=[];for(let n=0;n<this.pointArr.length;n++)r.push(this.pointArr[n]),r.push(t.shift());this.pointArr=r}removeFictitiousPoints(){this.pointArr=this.getTruePointArr()}drawPoint(t,e,i,r,n){let{customRenderPoint:s,showPoint:o,pointType:a,pointWidth:l}=this.opt;if(r&&this.ctx.beginPath(),s)s(this.ctx,t,e,i,this.pointStyle);else{switch(this.ctx.save(),this.ctx.lineWidth=this.pointStyle.lineWidth,this.ctx.strokeStyle=this.pointStyle.strokeColor,this.ctx.fillStyle=this.pointStyle.fillColor,n&&(this.ctx.strokeStyle=this.pointStyle.fillColor,this.ctx.fillStyle=this.pointStyle.strokeColor),a){case"square":this.ctx.rect(t-l,e-l,2*l,2*l);break;case"circle":this.ctx.arc(t,e,2*l,0,2*Math.PI)}i||o&&(this.ctx.fill(),this.ctx.stroke()),this.ctx.restore()}}checkInPath(t,e){return this.renderLines(this.strokeStyle,!0),this.ctx.isPointInPath(t,e)}checkInPoints(t,e){let i=-1;return this.renderPoints(!0,(r=>{this.ctx.isPointInPath(t,e)&&(i=r)})),i}closePath(){this.areaToPointPos=null,this.isClosePath=!0}enableDrag(t=-1){this.isDragging=!0,this.dragPointIndex=t,this.dragCachePointArr=JSON.parse(JSON.stringify(this.pointArr))}getTruePointIndex(t){if(-1===t||this.pointArr[t].fictitious)return t;let e=0;for(let i=0;i<t;i++)this.pointArr[i].fictitious&&e++;return t-e}disableDrag(){this.isDragging=!1,this.dragPointIndex=-1,this.dragCachePointArr=[],this.insertFictitiousPoints()}dragPoint(t,e,...i){this.isDragging&&-1!==this.dragPointIndex&&(this.pointArr[this.dragPointIndex].fictitious&&delete this.pointArr[this.dragPointIndex].fictitious,this.dragPointIndex=this.getTruePointIndex(this.dragPointIndex),this.removeFictitiousPoints(),this.updatePointFn?this.updatePointFn(this,t,e,...i):this.pointArr.splice(this.dragPointIndex,1,{...this.pointArr[this.dragPointIndex],x:t,y:e}))}dragAll(t,e){this.isDragging&&(this.pointArr=this.dragCachePointArr.map((i=>({...i,x:i.x+t,y:i.y+e}))))}enableHoverActive(){this.hoverActive=!0}disableHoverActive(){this.hoverActive=!1}checkLineSegmentCross(){if(!this.checkCrossPrevCheck())return!1;let t=this.createLineSegments(!0),e=t.length,i=!1;for(let r=0;r<e;r++){let e=t[r];this.checkCrossWithLineSegments(e[0],e[1],!0)&&(i=!0)}return i}checkNextLineSegmentCross(t,e){if(!this.checkCrossPrevCheck())return!1;let i=this.getTruePointArr(),r={x:t,y:e},n=i[i.length-1];return this.checkCrossWithLineSegments(r,n)}checkEndLineSegmentCross(){if(!this.checkCrossPrevCheck())return!1;let t=this.getTruePointArr(),e=t[t.length-1],i=t[0];return this.checkCrossWithLineSegments(e,i)}checkCrossWithLineSegments(t,e,i){let r=this.createLineSegments(i),n=!1;for(let s=0;s<r.length;s++){let i=r[s],o=i[0],a=i[1];utils$2.checkLineSegmentCross(o,a,t,e)&&(n=!0)}return n}createLineSegments(t){let e=this.getTruePointArr(),i=e.length,r=[];for(let n=0;n<i-1;n++)r.push([e[n],e[n+1]]);return t&&r.push([e[i-1],e[0]]),r}checkCrossPrevCheck(){return!(this.getTruePointArr().length<=2)}getPintNearestLine(t,e){let i=this.createLineSegments(this.isClosePath);if(i.length<=0)return null;-1!==this.dragPointIndex&&(0===this.dragPointIndex?(i.splice(0,1),i.splice(-1,1)):i.splice(this.dragPointIndex-1,2));let r,n=1/0;for(let s=0;s<i.length;s++){let o=i[s],a=o[0],l=o[1],c=utils$2.getLinePointDistance(a.x,a.y,l.x,l.y,t,e);c<n&&(n=c,r=o)}return[n,r]}}const defaultOpt$2={value:[],max:-1,hoverActive:!1,readonly:!1,single:!1,noCrossing:!1,dbClickRemovePoint:!1,area:!1,adsorbent:!0,adsorbentNum:5,adsorbentLine:!0,dbClickActive:!1,singleClickComplete:!0,enableAddPoint:!1};function EditPlugin(t,e){let i=null,r=new Promise((t=>{i=t})),n={...defaultOpt$2,...t.opt};n.dbClickActive&&(t.opt.cursorTips?t.opt.cursorTips.HOVER||(t.opt.cursorTips.HOVER="双击激活该区域并进入编辑状态"):t.opt.cursorTips={HOVER:"双击激活该区域并进入编辑状态"});let s=[],o=null,a={x:0,y:0},l={x:0,y:0},c=n.readonly,h=!1,u=null,d=null,p=0,f=null,_=[0,0],m={x:0,y:0},g=!1,y=x(),v={x:0,y:0},b={x:0,y:0};function x(e={}){return new MarkItem(t.ctx,{id:p++,...n,...u,...e,area:n.area})}function T(){t.clearCanvas(),n.single&&(o||h)?o&&o.render():s.forEach((t=>{t.render()})),f&&y.drawPoint(f[0],f[1],!1,!0)}function C(){s.forEach((t=>{t.disable()}))}function S(){s.forEach((t=>{t.disableHoverActive()}))}function w(t,e){for(let i=s.length-1;i>=0;i--){let r=s[i];if(r.checkInPath(t,e)||-1!==r.checkInPoints(t,e))return r}}function A(t,e){let i=[];for(let r=s.length-1;r>=0;r--){let n=s[r];(n.checkInPath(t,e)||-1!==n.checkInPoints(t,e))&&i.push(n)}return i}function E(){return o&&!o.isClosePath}function D(){S(),C(),I(null),T()}function L(e){return!c&&(h=e,t.emit("IS-CREATE-MARKING-CHANGE",e),!0)}function I(e){return!c&&(o=e,t.emit("CURRENT-MARK-ITEM-CHANGE",e),!0)}function P(t,i){if(!n.adsorbent)return[t,i];let r=1/0,a=t,l=i,c=null;return s.forEach((s=>{if(s.pointArr.forEach(((h,u)=>{if(o&&s===o&&s.dragPointIndex===u)return;let d=e.getTwoPointDistance(h.x,h.y,t,i);d<=n.adsorbentNum&&d<r&&(r=d,a=h.x,l=h.y,c=[a,l])})),n.adsorbentLine){let r=s.getPintNearestLine(t,i);if(r&&r[0]<=n.adsorbentNum){let n=r[1],s=n[0],o=n[1],h=Math.min(s.x,o.x),u=Math.max(s.x,o.x);if(t>=h&&t<=u){let r=e.getNearestPointFromLine(s.x,s.y,o.x,o.y,t,i);a=r[0],l=r[1],c=[a,l]}}}})),f=c,[a,l]}return t.on("UPDATED_OPT",(e=>{n={...defaultOpt$2,...t.opt},t.clearCanvas(),s.forEach((t=>{t.updateOpt(n),t.render()}))})),n.value.length>0&&(n.value.forEach((e=>{let i=new MarkItem(t.ctx,{id:p++,...n,...e,pointArr:e.pointArr.map((e=>({x:e.x*t.canvasEleRectInfo.width,y:e.y*t.canvasEleRectInfo.height})))});i.closePath(),s.push(i)})),T()),t.on("CLICK",(e=>{if(!n.mobile&&(Math.abs(b.x-v.x)>=5||Math.abs(b.y-v.y)>=5))return;if(c)return;if(!n.mobile&&g)return void(g=!1);let{x:i,y:r}=t.toCanvasPos(e),a=null;if(h){let e=i,a=r;if(f&&(e=f[0],a=f[1],f=null),o)if(n.noCrossing){o.checkNextLineSegmentCross(e,a)?t.emit("LINE-CROSS",o):o.pushPoint(e,a)}else o.pushPoint(e,a);else-1===n.max||s.length<n.max?(C(),I(x()),o.enable(),o.pushPoint(e,a),s.push(o)):(t.emit("COUNT-LIMIT",o),L(!1))}else(a=w(i,r))?n.dbClickActive||A(i,r).includes(o)||(!n.single||n.single&&!o)&&(C(),a.enable(),I(a)):!n.single&&n.singleClickComplete&&D();T()})),t.on("DOUBLE-CLICK",(e=>{if(c)return;let{x:i,y:r}=t.toCanvasPos(e),s=!0,a=w(i,r),l=!(!a||!o)&&a===o;if(o){let a=o.checkInPoints(i,r);n.dbClickRemovePoint&&-1!==a?(s=!1,o.getPointLength()>3?(o.removePoint(a),T()):t.emit("NOT-ENOUGH-POINTS-REMOVE",o)):o.getPointLength()<3?(s=!1,t.emit("NOT-ENOUGH-END-POINTS",o)):n.noCrossing&&o.checkEndLineSegmentCross()?(s=!1,t.emit("LINE-CROSS",o)):(h&&t.emit("COMPLETE-CREATE-ITEM",o,e),L(!1),o.closePath(),o.disable(),f=null,I(null),T(),t.emit("COMPLETE-EDIT-ITEM",o,e))}n.dbClickActive&&!h&&s&&a&&!l&&(C(),a.enable(),I(a),T())})),t.on("MOUSEDOWN",(e=>{if(v={x:e.clientX,y:e.clientY},c)return;let{x:i,y:r}=t.toCanvasPos(e);if(!o||!o.isEditing||!o.isClosePath)return;let s=o.checkInPoints(i,r);(o.checkInPath(i,r)||-1!==s)&&(n.noCrossing&&(d=JSON.parse(JSON.stringify(o.pointArr))),a.x=i,a.y=r,l.x=i,l.y=r,o.enableDrag(s))})),t.on("MOUSEMOVE",((i,r)=>{if(c)return;let{x:u,y:d}=t.toCanvasPos(i);if(o&&o.isDragging){if(t.opt.mobile?(r.stopPropagation(),r.preventDefault()):(i.stopPropagation(),i.preventDefault()),-1!==o.dragPointIndex)o.dragPoint(...P(u,d),t);else{!function(t,i){if(!n.adsorbent)return[t,i];let r=1/0,l=null,c=null;o.pointArr.forEach((t=>{s.forEach((i=>{i!==o&&i.pointArr.forEach((i=>{let n=e.getTwoPointDistance(t.x,t.y,i.x,i.y);n<r&&(r=n,l=t,c=i)}))}))})),r<=n.adsorbentNum&&(_=[c.x-l.x,c.y-l.y],a.x-=_[0],a.y-=_[1])}(),0!==_[0]&&0!==_[1]&&0===m.x&&0===m.y&&(m.x=u,m.y=d),0!==m.x&&0!==m.y&&e.getTwoPointDistance(m.x,m.y,u,d)>n.adsorbentNum&&(_=[0,0],a.x=l.x,a.y=l.y,m.x=0,m.y=0);let t=u-a.x,i=d-a.y;o.dragAll(t,i)}T();let c=o.checkInPoints(u,d);t.emit("HOVER-ITEM",o,o,A(u,d),i,c)}else if(h){let t=P(u-a.x,d-a.y);n.area&&o&&o.areaToPoint(...t),T()}else if(!h){let e=w(u,d);if(!n.hoverActive||o&&!o.isClosePath||(S(),e&&e.enableHoverActive(),T()),e&&e.isClosePath){let r=e.checkInPoints(u,d);t.emit("HOVER-ITEM",e,o,A(u,d),i,r)}}})),t.on("MOUSEUP",(e=>{b={x:e.clientX,y:e.clientY},c||o&&o.isDragging&&(g=!0,o.disableDrag(),a.x=0,a.y=0,l.x=0,l.y=0,n.noCrossing&&o.checkLineSegmentCross()&&(t.emit("LINE-CROSS",o),o.pointArr=d,d=null),T())})),t._disableAllItemsEdit=C,t._setMarkEditItem=I,t._createNewMarkItem=x,t._setIsCreateMarking=L,t._render=T,t._disableAllItemsHoverActive=S,t._checkInPathItem=w,t._checkInPathAllItems=A,t._getIsCreateIngMarkItem=E,t.getState=function(){return{markItemList:s,curEditingMarkItem:o,isReadonly:c,isCreateMarking:h}},t.getMarkData=function(){return s.map((e=>{let i=e.pointArr.map((e=>({x:e.x/t.canvasEleRectInfo.width,y:e.y/t.canvasEleRectInfo.height})));return{data:e.data,pointArr:i}}))},t.enableEdit=function(){c=!1},t.disableEdit=function(){return!E()&&(D(),c=!0,!0)},t.deleteMarkItem=function(e){if(!e)return!1;let i=s.findIndex((t=>t.opt.id===e.opt.id));if(-1!==i){o.opt.id===e.opt.id&&I(null);let r=s.splice(i,1);return T(),t.emit("DELETE-MARKING-ITEM",r[0],i),!0}return!1},t.deleteAllMarkItem=function(){s=[],I(null),T(),t.emit("DELETE-ALL-MARKING-ITEM")},t.createMarkItem=function(e=null){if(E()||c)return!1;if(D(),u=e,u&&u.pointArr&&u.pointArr.length>0){let e=x({pointArr:u.pointArr.map((e=>({x:e.x*t.canvasEleRectInfo.width,y:e.y*t.canvasEleRectInfo.height})))});e.closePath(),s.push(e),T()}else L(!0);return n.single&&t.clearCanvas(),!0},t.exitCreate=function(){if(!h)return!1;if(L(!1),E()){let t=s.findIndex((t=>t===o));s.splice(t,1)}D()},t.reset=D,i(),r}var cjs,hasRequiredCjs;function requireCjs(){if(hasRequiredCjs)return cjs;hasRequiredCjs=1;var t=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var i=Object.prototype.toString.call(t);return"[object RegExp]"===i||"[object Date]"===i||function(t){return t.$$typeof===e}(t)}(t)};var e="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(t,e){return!1!==e.clone&&e.isMergeableObject(t)?a((i=t,Array.isArray(i)?[]:{}),t,e):t;var i}function r(t,e,r){return t.concat(e).map((function(t){return i(t,r)}))}function n(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return Object.propertyIsEnumerable.call(t,e)})):[]}(t))}function s(t,e){try{return e in t}catch(i){return!1}}function o(t,e,r){var o={};return r.isMergeableObject(t)&&n(t).forEach((function(e){o[e]=i(t[e],r)})),n(e).forEach((function(n){(function(t,e){return s(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,n)||(s(t,n)&&r.isMergeableObject(e[n])?o[n]=function(t,e){if(!e.customMerge)return a;var i=e.customMerge(t);return"function"==typeof i?i:a}(n,r)(t[n],e[n],r):o[n]=i(e[n],r))})),o}function a(e,n,s){(s=s||{}).arrayMerge=s.arrayMerge||r,s.isMergeableObject=s.isMergeableObject||t,s.cloneUnlessOtherwiseSpecified=i;var a=Array.isArray(n);return a===Array.isArray(e)?a?s.arrayMerge(e,n,s):o(e,n,s):i(n,s)}return a.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,i){return a(t,i,e)}),{})},cjs=a}var cjsExports=requireCjs();const merge=getDefaultExportFromCjs(cjsExports),defaultOpt$1={dbClickTime:200};class Markjs{static pluginList=[];static use(t,e=-1){if(t){if(t.used)return this;t.used=!0,-1===e?Markjs.pluginList.push(t):Markjs.pluginList.splice(e,0,t)}}constructor(t={}){if(!t.el)throw new Error("el属性为空");if(this.opt={...defaultOpt$1,...t},this.el=this.originEl="string"==typeof t.el?document.querySelector(t.el):t.el,!this.el)throw new Error("容器元素获取失败");this.crateContainer(),this.elRectInfo=null,this.canvasEle=null,this.canvasEleRectInfo=null,this.ctx=null,this.clickTimer=null,this.observer=new Observer,this.mousedownPos={x:0,y:0},this.mouseupPos={x:0,y:0},this.lastClickTime=0,this.bindEventCallback(),this.init(),this.usePlugins()}updateOpt(t){this.opt=merge(this.opt,t),this.emit("UPDATED_OPT",this.opt),null!=t.scale&&this.emit("UPDATED_IMG",t)}usePlugins(){let t=0,e=Markjs.pluginList.length,i=()=>{if(t>=e)return void this.emit("PLUGINS_LOADED");(0,Markjs.pluginList[t])(this,utils$2).then((()=>{t++,i()}))};i()}emit(t,...e){this.observer.publish(t,...e)}on(t,e){return this.observer.subscribe(t,e)}off(t){this.observer.unsubscribe(t)}crateContainer(){let t=document.createElement("div");t.className="markjsContainer",t.style.cssText="\n            position: relative;\n            width: 100%;\n            height: 100%;\n        ",this.el.style.overflow="hidden",this.el.appendChild(t),this.el=t}init(){this.createElement(),this.ctx=this.canvasEle.getContext("2d"),this.bindEvent()}destroy(){this.unbindEvent(),this.el.removeChild(this.canvasEle),this.emit("DESTORY"),this.observer.clearAll()}createElement(){this.elRectInfo=this.el.getBoundingClientRect();let{width:t,height:e}=this.elRectInfo;this.canvasEle=document.createElement("canvas"),this.canvasEle.width=t,this.canvasEle.height=e,this.canvasEleRectInfo={width:t,height:e},this.el.appendChild(this.canvasEle)}bindEventCallback(){this.onclick=this.onclick.bind(this),this.onmousedown=this.onmousedown.bind(this),this.onmousemove=this.onmousemove.bind(this),this.onmouseup=this.onmouseup.bind(this),this.onmouseenter=this.onmouseenter.bind(this),this.onmouseleave=this.onmouseleave.bind(this),this.onWindowClick=this.onWindowClick.bind(this)}bindEvent(){let t=this.opt.mobile;this.canvasEle.addEventListener("click",this.onclick),this.canvasEle.addEventListener(t?"touchstart":"mousedown",this.onmousedown),this.canvasEle.addEventListener(t?"touchmove":"mousemove",this.onmousemove),window.addEventListener(t?"touchend":"mouseup",this.onmouseup),this.canvasEle.addEventListener("mouseenter",this.onmouseenter),this.canvasEle.addEventListener("mouseleave",this.onmouseleave),window.addEventListener("click",this.onWindowClick)}unbindEvent(){let t=this.opt.mobile;this.canvasEle.removeEventListener("click",this.onclick),this.canvasEle.removeEventListener(t?"touchstart":"mousedown",this.onmousedown),this.canvasEle.removeEventListener(t?"touchmove":"mousemove",this.onmousemove),window.removeEventListener(t?"touchend":"mouseup",this.onmouseup),this.canvasEle.removeEventListener("mouseenter",this.onmouseenter),this.canvasEle.removeEventListener("mouseleave",this.onmouseleave),window.removeEventListener("click",this.onWindowClick)}onclick(t){this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null),this.clickTimer=setTimeout((()=>{this.emit("CLICK",t)}),this.opt.dbClickTime),Date.now()-this.lastClickTime<=this.opt.dbClickTime&&(clearTimeout(this.clickTimer),this.clickTimer=null,this.lastClickTime=0,this.emit("DOUBLE-CLICK",t)),this.lastClickTime=Date.now()}onmousedown(t){let e=null;this.opt.mobile&&(e=t,t=t.touches[0]),this.mousedownPos={x:t.clientX,y:t.clientY},this.emit("MOUSEDOWN",t,e)}onmousemove(t){let e=null;this.opt.mobile&&(e=t,t=t.touches[0]),this.emit("MOUSEMOVE",t,e)}onmouseup(t){let e=null;this.opt.mobile&&(e=t,t=t.touches[0]),t||(t={clientX:0,clientY:0}),this.mouseupPos={x:t.clientX,y:t.clientY},this.emit("MOUSEUP",t,e)}onmouseenter(t){this.emit("MOUSEENTER",t)}onmouseleave(t){this.emit("MOUSELEAVE",t)}onWindowClick(t){this.emit("WINDOW-CLICK",t)}clearCanvas(){this.ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height)}toCanvasPos(t){let e=t.clientX,i=t.clientY,{left:r,top:n,width:s,height:o}=this.canvasEle.getBoundingClientRect();return{x:(e-r)/(s/this.canvasEle.offsetWidth),y:(i-n)/(o/this.canvasEle.offsetHeight)}}}Markjs.use(EditPlugin),__vitePreload((()=>module.import("./pen-legacy-Col081MR.js")),void 0,module.meta.url);const defaultOpt={elBg:"",bg:""};function ImgPlugin(t){let e=null,i=new Promise((t=>{e=t})),r={...defaultOpt,...t.opt};if(!r.img)return e(),i;let n=t.elRectInfo,s=t.canvasEle,o=null,a=null,l=0,c=0,h=0,u=0,d=0,p=!1;function f(){utils$2.loadImage(r.img).then((i=>{a=i,l=a.width,c=a.height,function(){if(n.width>=l&&n.height>=c)d=1,h=l,u=c;else{let t=l/c;n.width/n.height>t?(d=c/n.height,h=l/d,u=n.height):(d=l/n.width,h=n.width,u=c/d)}}(),t.canvasEleRectInfo={width:h,height:u,left:(n.width-h)/2,top:(n.height-u)/2},"static"===window.getComputedStyle(t.el).position&&(t.el.style.position="relative"),r.elBg&&(t.originEl.style.background=r.elBg,t.el.style.background=r.elBg),_(s,{zIndex:2}),m(),p&&t._render(),p||e()})).catch((i=>{t.observer.publish("IMG-LOAD-ERROR",i),p||e()}))}function _(e,i={}){e.width=h,e.height=u,e.style.position="absolute",e.style.left=t.canvasEleRectInfo.left+"px",e.style.top=t.canvasEleRectInfo.top+"px",Object.keys(i).forEach((t=>{e.style[t]=i[t]}))}function m(){o=o||document.createElement("canvas");let e={zIndex:1};r.bg&&(e.background=r.bg);let i=r.scale||1;_(o,e),t.el.appendChild(o);let n=o.getContext("2d");n.lineWidth=5,n.strokeRect(0,0,h,u),n.drawImage(a,.5*(1-i)*h,.5*(1-i)*u,h*i,u*i)}return t.on("DESTORY",(()=>{o&&t.el.removeChild(o)})),t.on("UPDATED_IMG",(t=>{r.scale=t.scale,m()})),f(),t.image=a,t.ratio=d,t.refreshImage=function(e){e&&(p=!0,t.opt.img=e,r.img=e,f())},i}Markjs.use(ImgPlugin,0);let mark2=null;const _sfc_main$2={name:"MarkEdit",props:{img:{type:String,required:!1},pointArr:{type:Array,default:[],required:!1},imgScale:{type:Number,default:1,required:!1}},data(){return{dataSource:[],editing2:!0,curEditMarkItem2:null,isCreateMarking2:!1,scale:this.imgScale}},watch:{scale(t,e){null!=mark2&&mark2.updateOpt({scale:t})}},mounted(){console.log("当前的scale",this.imgScale),mark2=new Markjs({el:this.$refs.markBox2,hoverActive:!0,img:this.img,scale:this.scale}),console.log("mark2",mark2);let t=()=>{if(this.timeOutInt=null,null!=mark2.createMarkItem)for(var e=0;e<this.pointArr.length;e++)mark2.createMarkItem({pointArr:this.pointArr[e]});else this.timeOutInt=setTimeout((()=>{t()}),10)};t(),mark2.on("CURRENT-MARK-ITEM-CHANGE",(t=>{this.curEditMarkItem2=t})),mark2.on("IS-CREATE-MARKING-CHANGE",(t=>{this.isCreateMarking2=t})),mark2.on("LINE-CROSS",(t=>{this.$message.warning("线段不允许交叉")})),mark2.on("NOT-ENOUGH-END-POINTS",(t=>{this.$message.warning("至少需要绘制三个端点")})),mark2.on("COUNT-LIMIT",(t=>{this.$message.warning("最多只能绘制三个区域")}))},unmounted(){null!=this.timeOutInt&&clearTimeout(this.timeOutInt)},methods:{getMarkData2(){let t=mark2.getMarkData();0==t.length?this.$emit("onChange",[],this.scale):this.$emit("onChange",t.map((t=>t.pointArr)),this.scale)},deleteItem2(){console.log("删除了选中的碰撞框",this.curEditMarkItem2),mark2.deleteMarkItem(this.curEditMarkItem2)},deleteAll2(){mark2.deleteAllMarkItem()},create2(){mark2.createMarkItem()},exit2(){mark2.exitCreate()}}},_hoisted_1$2={class:"markBox",ref:"markBox2",style:{width:"100%",height:"600px","margin-bottom":"10px",border:"solid 1px gray"}};function _sfc_render$2(t,e,i,r,n,s){const o=resolveComponent("a-button"),a=resolveComponent("a-slider"),l=resolveComponent("a-flex");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$2,null,512),createVNode(l,{gap:"small",align:"center"},{default:withCtx((()=>[createVNode(o,{onClick:s.create2,disabled:!n.editing2||!!n.curEditMarkItem2},{default:withCtx((()=>[...e[1]||(e[1]=[createTextVNode("新增碰撞框",-1)])])),_:1},8,["onClick","disabled"]),createVNode(o,{onClick:s.exit2,disabled:!n.isCreateMarking2},{default:withCtx((()=>[...e[2]||(e[2]=[createTextVNode("退出新增",-1)])])),_:1},8,["onClick","disabled"]),createVNode(o,{onClick:s.deleteItem2,disabled:!n.curEditMarkItem2},{default:withCtx((()=>[...e[3]||(e[3]=[createTextVNode("删除选中",-1)])])),_:1},8,["onClick","disabled"]),createVNode(o,{onClick:s.deleteAll2},{default:withCtx((()=>[...e[4]||(e[4]=[createTextVNode("清空",-1)])])),_:1},8,["onClick"]),e[6]||(e[6]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),e[7]||(e[7]=createBaseVNode("div",null,"缩放",-1)),createVNode(a,{style:{width:"100px"},value:n.scale,"onUpdate:value":e[0]||(e[0]=t=>n.scale=t),max:1,min:.1,step:.01},null,8,["value"]),e[8]||(e[8]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),createVNode(o,{type:"primary",onClick:s.getMarkData2},{default:withCtx((()=>[...e[5]||(e[5]=[createTextVNode("保存",-1)])])),_:1},8,["onClick"])])),_:1})])}const MarkEdit=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]);var cryptoJs$1={exports:{}};function commonjsRequire(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var core$1={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var core=core$1.exports,hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(t){var i;t.exports=(i=i||function(t,i){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==commonjsGlobal&&commonjsGlobal.crypto&&(r=commonjsGlobal.crypto),!r&&"function"==typeof commonjsRequire)try{r=require$$0}catch(m){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(m){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(m){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function t(){}return function(e){var i;return t.prototype=e,i=new t,t.prototype=null,i}}(),o={},a=o.lib={},l=a.Base={extend:function(t){var e=s(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=e!=i?e:4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,i=t.words,r=this.sigBytes,n=t.sigBytes;if(this.clamp(),r%4)for(var s=0;s<n;s++){var o=i[s>>>2]>>>24-s%4*8&255;e[r+s>>>2]|=o<<24-(r+s)%4*8}else for(var a=0;a<n;a+=4)e[r+a>>>2]=i[a>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],i=0;i<t;i+=4)e.push(n());return new c.init(e,t)}}),h=o.enc={},u=h.Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],n=0;n<i;n++){var s=e[n>>>2]>>>24-n%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new c.init(i,e/2)}},d=h.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],n=0;n<i;n++){var s=e[n>>>2]>>>24-n%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var e=t.length,i=[],r=0;r<e;r++)i[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new c.init(i,e)}},p=h.Utf8={stringify:function(t){try{return decodeURIComponent(escape(d.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return d.parse(unescape(encodeURIComponent(t)))}},f=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i,r=this._data,n=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),l=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*o,h=t.min(4*l,s);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(n,u);i=n.splice(0,l),r.sigBytes-=h}return new c.init(i,h)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=f.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new _.HMAC.init(t,i).finalize(e)}}});var _=o.algo={};return o}(Math),i)}(core$1)),core$1.exports}var x64Core$1={exports:{}},x64Core=x64Core$1.exports,hasRequiredX64Core;function requireX64Core(){return hasRequiredX64Core||(hasRequiredX64Core=1,function(t){var e;t.exports=(e=requireCore(),function(t){var i=e,r=i.lib,n=r.Base,s=r.WordArray,o=i.x64={};o.Word=n.extend({init:function(t,e){this.high=t,this.low=e}}),o.WordArray=n.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:8*e.length},toX32:function(){for(var t=this.words,e=t.length,i=[],r=0;r<e;r++){var n=t[r];i.push(n.high),i.push(n.low)}return s.create(i,this.sigBytes)},clone:function(){for(var t=n.clone.call(this),e=t.words=this.words.slice(0),i=e.length,r=0;r<i;r++)e[r]=e[r].clone();return t}})}(),e)}(x64Core$1)),x64Core$1.exports}var libTypedarrays$1={exports:{}},libTypedarrays=libTypedarrays$1.exports,hasRequiredLibTypedarrays;function requireLibTypedarrays(){return hasRequiredLibTypedarrays||(hasRequiredLibTypedarrays=1,function(t){var e;t.exports=(e=requireCore(),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,i=t.init,r=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,r=[],n=0;n<e;n++)r[n>>>2]|=t[n]<<24-n%4*8;i.call(this,r,e)}else i.apply(this,arguments)};r.prototype=t}}(),e.lib.WordArray)}(libTypedarrays$1)),libTypedarrays$1.exports}var encUtf16$1={exports:{}},encUtf16=encUtf16$1.exports,hasRequiredEncUtf16;function requireEncUtf16(){return hasRequiredEncUtf16||(hasRequiredEncUtf16=1,function(t){var e;t.exports=(e=requireCore(),function(){var t=e,i=t.lib.WordArray,r=t.enc;function n(t){return t<<8&4278255360|t>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],n=0;n<i;n+=2){var s=e[n>>>2]>>>16-n%4*8&65535;r.push(String.fromCharCode(s))}return r.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>1]|=t.charCodeAt(n)<<16-n%2*16;return i.create(r,2*e)}},r.Utf16LE={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],s=0;s<i;s+=2){var o=n(e[s>>>2]>>>16-s%4*8&65535);r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var e=t.length,r=[],s=0;s<e;s++)r[s>>>1]|=n(t.charCodeAt(s)<<16-s%2*16);return i.create(r,2*e)}}}(),e.enc.Utf16)}(encUtf16$1)),encUtf16$1.exports}var encBase64$1={exports:{}},encBase64=encBase64$1.exports,hasRequiredEncBase64;function requireEncBase64(){return hasRequiredEncBase64||(hasRequiredEncBase64=1,function(t){var e;t.exports=(e=requireCore(),function(){var t=e,i=t.lib.WordArray;function r(t,e,r){for(var n=[],s=0,o=0;o<e;o++)if(o%4){var a=r[t.charCodeAt(o-1)]<<o%4*2|r[t.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=a<<24-s%4*8,s++}return i.create(n,s)}t.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,r=this._map;t.clamp();for(var n=[],s=0;s<i;s+=3)for(var o=(e[s>>>2]>>>24-s%4*8&255)<<16|(e[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|e[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<i;a++)n.push(r.charAt(o>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(t){var e=t.length,i=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var s=0;s<i.length;s++)n[i.charCodeAt(s)]=s}var o=i.charAt(64);if(o){var a=t.indexOf(o);-1!==a&&(e=a)}return r(t,e,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)}(encBase64$1)),encBase64$1.exports}var encBase64url$1={exports:{}},encBase64url=encBase64url$1.exports,hasRequiredEncBase64url;function requireEncBase64url(){return hasRequiredEncBase64url||(hasRequiredEncBase64url=1,function(t){var e;t.exports=(e=requireCore(),function(){var t=e,i=t.lib.WordArray;function r(t,e,r){for(var n=[],s=0,o=0;o<e;o++)if(o%4){var a=r[t.charCodeAt(o-1)]<<o%4*2|r[t.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=a<<24-s%4*8,s++}return i.create(n,s)}t.enc.Base64url={stringify:function(t,e){void 0===e&&(e=!0);var i=t.words,r=t.sigBytes,n=e?this._safe_map:this._map;t.clamp();for(var s=[],o=0;o<r;o+=3)for(var a=(i[o>>>2]>>>24-o%4*8&255)<<16|(i[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|i[o+2>>>2]>>>24-(o+2)%4*8&255,l=0;l<4&&o+.75*l<r;l++)s.push(n.charAt(a>>>6*(3-l)&63));var c=n.charAt(64);if(c)for(;s.length%4;)s.push(c);return s.join("")},parse:function(t,e){void 0===e&&(e=!0);var i=t.length,n=e?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<n.length;o++)s[n.charCodeAt(o)]=o}var a=n.charAt(64);if(a){var l=t.indexOf(a);-1!==l&&(i=l)}return r(t,i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),e.enc.Base64url)}(encBase64url$1)),encBase64url$1.exports}var md5$1={exports:{}},md5=md5$1.exports,hasRequiredMd5;function requireMd5(){return hasRequiredMd5||(hasRequiredMd5=1,function(t){var e;t.exports=(e=requireCore(),function(t){var i=e,r=i.lib,n=r.WordArray,s=r.Hasher,o=i.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=o.MD5=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var r=e+i,n=t[r];t[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s=this._hash.words,o=t[e+0],l=t[e+1],p=t[e+2],f=t[e+3],_=t[e+4],m=t[e+5],g=t[e+6],y=t[e+7],v=t[e+8],b=t[e+9],x=t[e+10],T=t[e+11],C=t[e+12],S=t[e+13],w=t[e+14],A=t[e+15],E=s[0],D=s[1],L=s[2],I=s[3];E=c(E,D,L,I,o,7,a[0]),I=c(I,E,D,L,l,12,a[1]),L=c(L,I,E,D,p,17,a[2]),D=c(D,L,I,E,f,22,a[3]),E=c(E,D,L,I,_,7,a[4]),I=c(I,E,D,L,m,12,a[5]),L=c(L,I,E,D,g,17,a[6]),D=c(D,L,I,E,y,22,a[7]),E=c(E,D,L,I,v,7,a[8]),I=c(I,E,D,L,b,12,a[9]),L=c(L,I,E,D,x,17,a[10]),D=c(D,L,I,E,T,22,a[11]),E=c(E,D,L,I,C,7,a[12]),I=c(I,E,D,L,S,12,a[13]),L=c(L,I,E,D,w,17,a[14]),E=h(E,D=c(D,L,I,E,A,22,a[15]),L,I,l,5,a[16]),I=h(I,E,D,L,g,9,a[17]),L=h(L,I,E,D,T,14,a[18]),D=h(D,L,I,E,o,20,a[19]),E=h(E,D,L,I,m,5,a[20]),I=h(I,E,D,L,x,9,a[21]),L=h(L,I,E,D,A,14,a[22]),D=h(D,L,I,E,_,20,a[23]),E=h(E,D,L,I,b,5,a[24]),I=h(I,E,D,L,w,9,a[25]),L=h(L,I,E,D,f,14,a[26]),D=h(D,L,I,E,v,20,a[27]),E=h(E,D,L,I,S,5,a[28]),I=h(I,E,D,L,p,9,a[29]),L=h(L,I,E,D,y,14,a[30]),E=u(E,D=h(D,L,I,E,C,20,a[31]),L,I,m,4,a[32]),I=u(I,E,D,L,v,11,a[33]),L=u(L,I,E,D,T,16,a[34]),D=u(D,L,I,E,w,23,a[35]),E=u(E,D,L,I,l,4,a[36]),I=u(I,E,D,L,_,11,a[37]),L=u(L,I,E,D,y,16,a[38]),D=u(D,L,I,E,x,23,a[39]),E=u(E,D,L,I,S,4,a[40]),I=u(I,E,D,L,o,11,a[41]),L=u(L,I,E,D,f,16,a[42]),D=u(D,L,I,E,g,23,a[43]),E=u(E,D,L,I,b,4,a[44]),I=u(I,E,D,L,C,11,a[45]),L=u(L,I,E,D,A,16,a[46]),E=d(E,D=u(D,L,I,E,p,23,a[47]),L,I,o,6,a[48]),I=d(I,E,D,L,y,10,a[49]),L=d(L,I,E,D,w,15,a[50]),D=d(D,L,I,E,m,21,a[51]),E=d(E,D,L,I,C,6,a[52]),I=d(I,E,D,L,f,10,a[53]),L=d(L,I,E,D,x,15,a[54]),D=d(D,L,I,E,l,21,a[55]),E=d(E,D,L,I,v,6,a[56]),I=d(I,E,D,L,A,10,a[57]),L=d(L,I,E,D,g,15,a[58]),D=d(D,L,I,E,S,21,a[59]),E=d(E,D,L,I,_,6,a[60]),I=d(I,E,D,L,T,10,a[61]),L=d(L,I,E,D,p,15,a[62]),D=d(D,L,I,E,b,21,a[63]),s[0]=s[0]+E|0,s[1]=s[1]+D|0,s[2]=s[2]+L|0,s[3]=s[3]+I|0},_doFinalize:function(){var e=this._data,i=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;i[n>>>5]|=128<<24-n%32;var s=t.floor(r/4294967296),o=r;i[15+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(i.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var h=l[c];l[c]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});function c(t,e,i,r,n,s,o){var a=t+(e&i|~e&r)+n+o;return(a<<s|a>>>32-s)+e}function h(t,e,i,r,n,s,o){var a=t+(e&r|i&~r)+n+o;return(a<<s|a>>>32-s)+e}function u(t,e,i,r,n,s,o){var a=t+(e^i^r)+n+o;return(a<<s|a>>>32-s)+e}function d(t,e,i,r,n,s,o){var a=t+(i^(e|~r))+n+o;return(a<<s|a>>>32-s)+e}i.MD5=s._createHelper(l),i.HmacMD5=s._createHmacHelper(l)}(Math),e.MD5)}(md5$1)),md5$1.exports}var sha1$1={exports:{}},sha1=sha1$1.exports,hasRequiredSha1;function requireSha1(){return hasRequiredSha1||(hasRequiredSha1=1,function(t){var e;t.exports=(e=requireCore(),function(){var t=e,i=t.lib,r=i.WordArray,n=i.Hasher,s=t.algo,o=[],a=s.SHA1=n.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],n=i[1],s=i[2],a=i[3],l=i[4],c=0;c<80;c++){if(c<16)o[c]=0|t[e+c];else{var h=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=h<<1|h>>>31}var u=(r<<5|r>>>27)+l+o[c];u+=c<20?1518500249+(n&s|~n&a):c<40?1859775393+(n^s^a):c<60?(n&s|n&a|s&a)-1894007588:(n^s^a)-899497514,l=a,a=s,s=n<<30|n>>>2,n=r,r=u}i[0]=i[0]+r|0,i[1]=i[1]+n|0,i[2]=i[2]+s|0,i[3]=i[3]+a|0,i[4]=i[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(r+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=n._createHelper(a),t.HmacSHA1=n._createHmacHelper(a)}(),e.SHA1)}(sha1$1)),sha1$1.exports}var sha256$1={exports:{}},sha256=sha256$1.exports,hasRequiredSha256;function requireSha256(){return hasRequiredSha256||(hasRequiredSha256=1,function(t){var e;t.exports=(e=requireCore(),function(t){var i=e,r=i.lib,n=r.WordArray,s=r.Hasher,o=i.algo,a=[],l=[];!function(){function e(e){for(var i=t.sqrt(e),r=2;r<=i;r++)if(!(e%r))return!1;return!0}function i(t){return 4294967296*(t-(0|t))|0}for(var r=2,n=0;n<64;)e(r)&&(n<8&&(a[n]=i(t.pow(r,.5))),l[n]=i(t.pow(r,1/3)),n++),r++}();var c=[],h=o.SHA256=s.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],h=i[5],u=i[6],d=i[7],p=0;p<64;p++){if(p<16)c[p]=0|t[e+p];else{var f=c[p-15],_=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=c[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;c[p]=_+c[p-7]+g+c[p-16]}var y=r&n^r&s^n&s,v=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&h^~a&u)+l[p]+c[p];d=u,u=h,h=a,a=o+b|0,o=s,s=n,n=r,r=b+(v+y)|0}i[0]=i[0]+r|0,i[1]=i[1]+n|0,i[2]=i[2]+s|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0,i[5]=i[5]+h|0,i[6]=i[6]+u|0,i[7]=i[7]+d|0},_doFinalize:function(){var e=this._data,i=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return i[n>>>5]|=128<<24-n%32,i[14+(n+64>>>9<<4)]=t.floor(r/4294967296),i[15+(n+64>>>9<<4)]=r,e.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});i.SHA256=s._createHelper(h),i.HmacSHA256=s._createHmacHelper(h)}(Math),e.SHA256)}(sha256$1)),sha256$1.exports}var sha224$1={exports:{}},sha224=sha224$1.exports,hasRequiredSha224;function requireSha224(){return hasRequiredSha224||(hasRequiredSha224=1,function(t){var e;t.exports=(e=requireCore(),requireSha256(),function(){var t=e,i=t.lib.WordArray,r=t.algo,n=r.SHA256,s=r.SHA224=n.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=n._doFinalize.call(this);return t.sigBytes-=4,t}});t.SHA224=n._createHelper(s),t.HmacSHA224=n._createHmacHelper(s)}(),e.SHA224)}(sha224$1)),sha224$1.exports}var sha512$1={exports:{}},sha512=sha512$1.exports,hasRequiredSha512;function requireSha512(){return hasRequiredSha512||(hasRequiredSha512=1,function(t){var e;t.exports=(e=requireCore(),requireX64Core(),function(){var t=e,i=t.lib.Hasher,r=t.x64,n=r.Word,s=r.WordArray,o=t.algo;function a(){return n.create.apply(n,arguments)}var l=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],c=[];!function(){for(var t=0;t<80;t++)c[t]=a()}();var h=o.SHA512=i.extend({_doReset:function(){this._hash=new s.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],h=i[5],u=i[6],d=i[7],p=r.high,f=r.low,_=n.high,m=n.low,g=s.high,y=s.low,v=o.high,b=o.low,x=a.high,T=a.low,C=h.high,S=h.low,w=u.high,A=u.low,E=d.high,D=d.low,L=p,I=f,P=_,M=m,R=g,O=y,B=v,N=b,k=x,F=T,V=C,j=S,G=w,U=A,Y=E,H=D,X=0;X<80;X++){var z,W,Z=c[X];if(X<16)W=Z.high=0|t[e+2*X],z=Z.low=0|t[e+2*X+1];else{var J=c[X-15],q=J.high,K=J.low,Q=(q>>>1|K<<31)^(q>>>8|K<<24)^q>>>7,$=(K>>>1|q<<31)^(K>>>8|q<<24)^(K>>>7|q<<25),tt=c[X-2],et=tt.high,it=tt.low,rt=(et>>>19|it<<13)^(et<<3|it>>>29)^et>>>6,nt=(it>>>19|et<<13)^(it<<3|et>>>29)^(it>>>6|et<<26),st=c[X-7],ot=st.high,at=st.low,lt=c[X-16],ct=lt.high,ht=lt.low;W=(W=(W=Q+ot+((z=$+at)>>>0<$>>>0?1:0))+rt+((z+=nt)>>>0<nt>>>0?1:0))+ct+((z+=ht)>>>0<ht>>>0?1:0),Z.high=W,Z.low=z}var ut,dt=k&V^~k&G,pt=F&j^~F&U,ft=L&P^L&R^P&R,_t=I&M^I&O^M&O,mt=(L>>>28|I<<4)^(L<<30|I>>>2)^(L<<25|I>>>7),gt=(I>>>28|L<<4)^(I<<30|L>>>2)^(I<<25|L>>>7),yt=(k>>>14|F<<18)^(k>>>18|F<<14)^(k<<23|F>>>9),vt=(F>>>14|k<<18)^(F>>>18|k<<14)^(F<<23|k>>>9),bt=l[X],xt=bt.high,Tt=bt.low,Ct=Y+yt+((ut=H+vt)>>>0<H>>>0?1:0),St=gt+_t;Y=G,H=U,G=V,U=j,V=k,j=F,k=B+(Ct=(Ct=(Ct=Ct+dt+((ut+=pt)>>>0<pt>>>0?1:0))+xt+((ut+=Tt)>>>0<Tt>>>0?1:0))+W+((ut+=z)>>>0<z>>>0?1:0))+((F=N+ut|0)>>>0<N>>>0?1:0)|0,B=R,N=O,R=P,O=M,P=L,M=I,L=Ct+(mt+ft+(St>>>0<gt>>>0?1:0))+((I=ut+St|0)>>>0<ut>>>0?1:0)|0}f=r.low=f+I,r.high=p+L+(f>>>0<I>>>0?1:0),m=n.low=m+M,n.high=_+P+(m>>>0<M>>>0?1:0),y=s.low=y+O,s.high=g+R+(y>>>0<O>>>0?1:0),b=o.low=b+N,o.high=v+B+(b>>>0<N>>>0?1:0),T=a.low=T+F,a.high=x+k+(T>>>0<F>>>0?1:0),S=h.low=S+j,h.high=C+V+(S>>>0<j>>>0?1:0),A=u.low=A+U,u.high=w+G+(A>>>0<U>>>0?1:0),D=d.low=D+H,d.high=E+Y+(D>>>0<H>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[30+(r+128>>>10<<5)]=Math.floor(i/4294967296),e[31+(r+128>>>10<<5)]=i,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=i._createHelper(h),t.HmacSHA512=i._createHmacHelper(h)}(),e.SHA512)}(sha512$1)),sha512$1.exports}var sha384$1={exports:{}},sha384=sha384$1.exports,hasRequiredSha384;function requireSha384(){return hasRequiredSha384||(hasRequiredSha384=1,function(t){var e;t.exports=(e=requireCore(),requireX64Core(),requireSha512(),function(){var t=e,i=t.x64,r=i.Word,n=i.WordArray,s=t.algo,o=s.SHA512,a=s.SHA384=o.extend({_doReset:function(){this._hash=new n.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var t=o._doFinalize.call(this);return t.sigBytes-=16,t}});t.SHA384=o._createHelper(a),t.HmacSHA384=o._createHmacHelper(a)}(),e.SHA384)}(sha384$1)),sha384$1.exports}var sha3$1={exports:{}},sha3=sha3$1.exports,hasRequiredSha3;function requireSha3(){return hasRequiredSha3||(hasRequiredSha3=1,function(t){var e;t.exports=(e=requireCore(),requireX64Core(),function(t){var i=e,r=i.lib,n=r.WordArray,s=r.Hasher,o=i.x64.Word,a=i.algo,l=[],c=[],h=[];!function(){for(var t=1,e=0,i=0;i<24;i++){l[t+5*e]=(i+1)*(i+2)/2%64;var r=(2*t+3*e)%5;t=e%5,e=r}for(t=0;t<5;t++)for(e=0;e<5;e++)c[t+5*e]=e+(2*t+3*e)%5*5;for(var n=1,s=0;s<24;s++){for(var a=0,u=0,d=0;d<7;d++){if(1&n){var p=(1<<d)-1;p<32?u^=1<<p:a^=1<<p-32}128&n?n=n<<1^113:n<<=1}h[s]=o.create(a,u)}}();var u=[];!function(){for(var t=0;t<25;t++)u[t]=o.create()}();var d=a.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var i=this._state,r=this.blockSize/2,n=0;n<r;n++){var s=t[e+2*n],o=t[e+2*n+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(D=i[n]).high^=o,D.low^=s}for(var a=0;a<24;a++){for(var d=0;d<5;d++){for(var p=0,f=0,_=0;_<5;_++)p^=(D=i[d+5*_]).high,f^=D.low;var m=u[d];m.high=p,m.low=f}for(d=0;d<5;d++){var g=u[(d+4)%5],y=u[(d+1)%5],v=y.high,b=y.low;for(p=g.high^(v<<1|b>>>31),f=g.low^(b<<1|v>>>31),_=0;_<5;_++)(D=i[d+5*_]).high^=p,D.low^=f}for(var x=1;x<25;x++){var T=(D=i[x]).high,C=D.low,S=l[x];S<32?(p=T<<S|C>>>32-S,f=C<<S|T>>>32-S):(p=C<<S-32|T>>>64-S,f=T<<S-32|C>>>64-S);var w=u[c[x]];w.high=p,w.low=f}var A=u[0],E=i[0];for(A.high=E.high,A.low=E.low,d=0;d<5;d++)for(_=0;_<5;_++){var D=i[x=d+5*_],L=u[x],I=u[(d+1)%5+5*_],P=u[(d+2)%5+5*_];D.high=L.high^~I.high&P.high,D.low=L.low^~I.low&P.low}D=i[0];var M=h[a];D.high^=M.high,D.low^=M.low}},_doFinalize:function(){var e=this._data,i=e.words;this._nDataBytes;var r=8*e.sigBytes,s=32*this.blockSize;i[r>>>5]|=1<<24-r%32,i[(t.ceil((r+1)/s)*s>>>5)-1]|=128,e.sigBytes=4*i.length,this._process();for(var o=this._state,a=this.cfg.outputLength/8,l=a/8,c=[],h=0;h<l;h++){var u=o[h],d=u.high,p=u.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),c.push(p),c.push(d)}return new n.init(c,a)},clone:function(){for(var t=s.clone.call(this),e=t._state=this._state.slice(0),i=0;i<25;i++)e[i]=e[i].clone();return t}});i.SHA3=s._createHelper(d),i.HmacSHA3=s._createHmacHelper(d)}(Math),e.SHA3)}(sha3$1)),sha3$1.exports}var ripemd160$1={exports:{}},ripemd160=ripemd160$1.exports,hasRequiredRipemd160;function requireRipemd160(){return hasRequiredRipemd160||(hasRequiredRipemd160=1,function(t){var e;t.exports=(e=requireCore(),
/** @preserve
      			(c) 2012 by Cédric Mesnil. All rights reserved.

      			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

      			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
      			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

      			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      			*/
function(){var t=e,i=t.lib,r=i.WordArray,n=i.Hasher,s=t.algo,o=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=r.create([0,1518500249,1859775393,2400959708,2840853838]),u=r.create([1352829926,1548603684,1836072691,2053994217,0]),d=s.RIPEMD160=n.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var r=e+i,n=t[r];t[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s,d,v,b,x,T,C,S,w,A,E,D=this._hash.words,L=h.words,I=u.words,P=o.words,M=a.words,R=l.words,O=c.words;for(T=s=D[0],C=d=D[1],S=v=D[2],w=b=D[3],A=x=D[4],i=0;i<80;i+=1)E=s+t[e+P[i]]|0,E+=i<16?p(d,v,b)+L[0]:i<32?f(d,v,b)+L[1]:i<48?_(d,v,b)+L[2]:i<64?m(d,v,b)+L[3]:g(d,v,b)+L[4],E=(E=y(E|=0,R[i]))+x|0,s=x,x=b,b=y(v,10),v=d,d=E,E=T+t[e+M[i]]|0,E+=i<16?g(C,S,w)+I[0]:i<32?m(C,S,w)+I[1]:i<48?_(C,S,w)+I[2]:i<64?f(C,S,w)+I[3]:p(C,S,w)+I[4],E=(E=y(E|=0,O[i]))+A|0,T=A,A=w,w=y(S,10),S=C,C=E;E=D[1]+v+w|0,D[1]=D[2]+b+A|0,D[2]=D[3]+x+T|0,D[3]=D[4]+s+C|0,D[4]=D[0]+d+S|0,D[0]=E},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(e.length+1),this._process();for(var n=this._hash,s=n.words,o=0;o<5;o++){var a=s[o];s[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return n},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});function p(t,e,i){return t^e^i}function f(t,e,i){return t&e|~t&i}function _(t,e,i){return(t|~e)^i}function m(t,e,i){return t&i|e&~i}function g(t,e,i){return t^(e|~i)}function y(t,e){return t<<e|t>>>32-e}t.RIPEMD160=n._createHelper(d),t.HmacRIPEMD160=n._createHmacHelper(d)}(),e.RIPEMD160)}(ripemd160$1)),ripemd160$1.exports}var hmac$1={exports:{}},hmac=hmac$1.exports,hasRequiredHmac;function requireHmac(){return hasRequiredHmac||(hasRequiredHmac=1,function(t){var e;t.exports=(e=requireCore(),void function(){var t=e,i=t.lib.Base,r=t.enc.Utf8;t.algo.HMAC=i.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=r.parse(e));var i=t.blockSize,n=4*i;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var s=this._oKey=e.clone(),o=this._iKey=e.clone(),a=s.words,l=o.words,c=0;c<i;c++)a[c]^=1549556828,l[c]^=909522486;s.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,i=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(i))}})}())}(hmac$1)),hmac$1.exports}var pbkdf2$1={exports:{}},pbkdf2=pbkdf2$1.exports,hasRequiredPbkdf2;function requirePbkdf2(){return hasRequiredPbkdf2||(hasRequiredPbkdf2=1,function(t){var e;t.exports=(e=requireCore(),requireSha256(),requireHmac(),function(){var t=e,i=t.lib,r=i.Base,n=i.WordArray,s=t.algo,o=s.SHA256,a=s.HMAC,l=s.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:o,iterations:25e4}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,r=a.create(i.hasher,t),s=n.create(),o=n.create([1]),l=s.words,c=o.words,h=i.keySize,u=i.iterations;l.length<h;){var d=r.update(e).finalize(o);r.reset();for(var p=d.words,f=p.length,_=d,m=1;m<u;m++){_=r.finalize(_),r.reset();for(var g=_.words,y=0;y<f;y++)p[y]^=g[y]}s.concat(d),c[0]++}return s.sigBytes=4*h,s}});t.PBKDF2=function(t,e,i){return l.create(i).compute(t,e)}}(),e.PBKDF2)}(pbkdf2$1)),pbkdf2$1.exports}var evpkdf$1={exports:{}},evpkdf=evpkdf$1.exports,hasRequiredEvpkdf;function requireEvpkdf(){return hasRequiredEvpkdf||(hasRequiredEvpkdf=1,function(t){var e;t.exports=(e=requireCore(),requireSha1(),requireHmac(),function(){var t=e,i=t.lib,r=i.Base,n=i.WordArray,s=t.algo,o=s.MD5,a=s.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:o,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i,r=this.cfg,s=r.hasher.create(),o=n.create(),a=o.words,l=r.keySize,c=r.iterations;a.length<l;){i&&s.update(i),i=s.update(t).finalize(e),s.reset();for(var h=1;h<c;h++)i=s.finalize(i),s.reset();o.concat(i)}return o.sigBytes=4*l,o}});t.EvpKDF=function(t,e,i){return a.create(i).compute(t,e)}}(),e.EvpKDF)}(evpkdf$1)),evpkdf$1.exports}var cipherCore$1={exports:{}},cipherCore=cipherCore$1.exports,hasRequiredCipherCore;function requireCipherCore(){return hasRequiredCipherCore||(hasRequiredCipherCore=1,function(t){var e;t.exports=(e=requireCore(),requireEvpkdf(),void(e.lib.Cipher||function(t){var i=e,r=i.lib,n=r.Base,s=r.WordArray,o=r.BufferedBlockAlgorithm,a=i.enc;a.Utf8;var l=a.Base64,c=i.algo.EvpKDF,h=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?v:g}return function(e){return{encrypt:function(i,r,n){return t(r).encrypt(e,i,r,n)},decrypt:function(i,r,n){return t(r).decrypt(e,i,r,n)}}}}()});r.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=i.mode={},d=r.BlockCipherMode=n.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),p=u.CBC=function(){var e=d.extend();function i(e,i,r){var n,s=this._iv;s?(n=s,this._iv=t):n=this._prevBlock;for(var o=0;o<r;o++)e[i+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize;i.call(this,t,e,n),r.encryptBlock(t,e),this._prevBlock=t.slice(e,e+n)}}),e.Decryptor=e.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,s=t.slice(e,e+n);r.decryptBlock(t,e),i.call(this,t,e,n),this._prevBlock=s}}),e}(),f=(i.pad={}).Pkcs7={pad:function(t,e){for(var i=4*e,r=i-t.sigBytes%i,n=r<<24|r<<16|r<<8|r,o=[],a=0;a<r;a+=4)o.push(n);var l=s.create(o,r);t.concat(l)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:p,padding:f}),reset:function(){var t;h.reset.call(this);var e=this.cfg,i=e.iv,r=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=r.createEncryptor:(t=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,i&&i.words):(this._mode=t.call(r,this,i&&i.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4});var _=r.CipherParams=n.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),m=(i.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,i=t.salt;return(i?s.create([1398893684,1701076831]).concat(i).concat(e):e).toString(l)},parse:function(t){var e,i=l.parse(t),r=i.words;return 1398893684==r[0]&&1701076831==r[1]&&(e=s.create(r.slice(2,4)),r.splice(0,4),i.sigBytes-=16),_.create({ciphertext:i,salt:e})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:m}),encrypt:function(t,e,i,r){r=this.cfg.extend(r);var n=t.createEncryptor(i,r),s=n.finalize(e),o=n.cfg;return _.create({ciphertext:s,key:i,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,i,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(i,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),y=(i.kdf={}).OpenSSL={execute:function(t,e,i,r,n){if(r||(r=s.random(8)),n)o=c.create({keySize:e+i,hasher:n}).compute(t,r);else var o=c.create({keySize:e+i}).compute(t,r);var a=s.create(o.words.slice(e),4*i);return o.sigBytes=4*e,_.create({key:o,iv:a,salt:r})}},v=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:y}),encrypt:function(t,e,i,r){var n=(r=this.cfg.extend(r)).kdf.execute(i,t.keySize,t.ivSize,r.salt,r.hasher);r.iv=n.iv;var s=g.encrypt.call(this,t,e,n.key,r);return s.mixIn(n),s},decrypt:function(t,e,i,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var n=r.kdf.execute(i,t.keySize,t.ivSize,e.salt,r.hasher);return r.iv=n.iv,g.decrypt.call(this,t,e,n.key,r)}})}()))}(cipherCore$1)),cipherCore$1.exports}var modeCfb$1={exports:{}},modeCfb=modeCfb$1.exports,hasRequiredModeCfb;function requireModeCfb(){return hasRequiredModeCfb||(hasRequiredModeCfb=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function i(t,e,i,r){var n,s=this._iv;s?(n=s.slice(0),this._iv=void 0):n=this._prevBlock,r.encryptBlock(n,0);for(var o=0;o<i;o++)t[e+o]^=n[o]}return t.Encryptor=t.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize;i.call(this,t,e,n,r),this._prevBlock=t.slice(e,e+n)}}),t.Decryptor=t.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,s=t.slice(e,e+n);i.call(this,t,e,n,r),this._prevBlock=s}}),t}(),e.mode.CFB)}(modeCfb$1)),modeCfb$1.exports}var modeCtr$1={exports:{}},modeCtr=modeCtr$1.exports,hasRequiredModeCtr;function requireModeCtr(){return hasRequiredModeCtr||(hasRequiredModeCtr=1,function(t){var e,i,r;t.exports=(r=requireCore(),requireCipherCore(),r.mode.CTR=(e=r.lib.BlockCipherMode.extend(),i=e.Encryptor=e.extend({processBlock:function(t,e){var i=this._cipher,r=i.blockSize,n=this._iv,s=this._counter;n&&(s=this._counter=n.slice(0),this._iv=void 0);var o=s.slice(0);i.encryptBlock(o,0),s[r-1]=s[r-1]+1|0;for(var a=0;a<r;a++)t[e+a]^=o[a]}}),e.Decryptor=i,e),r.mode.CTR)}(modeCtr$1)),modeCtr$1.exports}var modeCtrGladman$1={exports:{}},modeCtrGladman=modeCtrGladman$1.exports,hasRequiredModeCtrGladman;function requireModeCtrGladman(){return hasRequiredModeCtrGladman||(hasRequiredModeCtrGladman=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),
/** @preserve
      			 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
      			 * derived from CryptoJS.mode.CTR
      			 * Jan Hruby jhruby.web@gmail.com
      			 */
e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function i(t){if(255&~(t>>24))t+=1<<24;else{var e=t>>16&255,i=t>>8&255,r=255&t;255===e?(e=0,255===i?(i=0,255===r?r=0:++r):++i):++e,t=0,t+=e<<16,t+=i<<8,t+=r}return t}function r(t){return 0===(t[0]=i(t[0]))&&(t[1]=i(t[1])),t}var n=t.Encryptor=t.extend({processBlock:function(t,e){var i=this._cipher,n=i.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0),r(o);var a=o.slice(0);i.encryptBlock(a,0);for(var l=0;l<n;l++)t[e+l]^=a[l]}});return t.Decryptor=n,t}(),e.mode.CTRGladman)}(modeCtrGladman$1)),modeCtrGladman$1.exports}var modeOfb$1={exports:{}},modeOfb=modeOfb$1.exports,hasRequiredModeOfb;function requireModeOfb(){return hasRequiredModeOfb||(hasRequiredModeOfb=1,function(t){var e,i,r;t.exports=(r=requireCore(),requireCipherCore(),r.mode.OFB=(e=r.lib.BlockCipherMode.extend(),i=e.Encryptor=e.extend({processBlock:function(t,e){var i=this._cipher,r=i.blockSize,n=this._iv,s=this._keystream;n&&(s=this._keystream=n.slice(0),this._iv=void 0),i.encryptBlock(s,0);for(var o=0;o<r;o++)t[e+o]^=s[o]}}),e.Decryptor=i,e),r.mode.OFB)}(modeOfb$1)),modeOfb$1.exports}var modeEcb$1={exports:{}},modeEcb=modeEcb$1.exports,hasRequiredModeEcb;function requireModeEcb(){return hasRequiredModeEcb||(hasRequiredModeEcb=1,function(t){var e,i;t.exports=(i=requireCore(),requireCipherCore(),i.mode.ECB=((e=i.lib.BlockCipherMode.extend()).Encryptor=e.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),e.Decryptor=e.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),e),i.mode.ECB)}(modeEcb$1)),modeEcb$1.exports}var padAnsix923$1={exports:{}},padAnsix923=padAnsix923$1.exports,hasRequiredPadAnsix923;function requirePadAnsix923(){return hasRequiredPadAnsix923||(hasRequiredPadAnsix923=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.pad.AnsiX923={pad:function(t,e){var i=t.sigBytes,r=4*e,n=r-i%r,s=i+n-1;t.clamp(),t.words[s>>>2]|=n<<24-s%4*8,t.sigBytes+=n},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},e.pad.Ansix923)}(padAnsix923$1)),padAnsix923$1.exports}var padIso10126$1={exports:{}},padIso10126=padIso10126$1.exports,hasRequiredPadIso10126;function requirePadIso10126(){return hasRequiredPadIso10126||(hasRequiredPadIso10126=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.pad.Iso10126={pad:function(t,i){var r=4*i,n=r-t.sigBytes%r;t.concat(e.lib.WordArray.random(n-1)).concat(e.lib.WordArray.create([n<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},e.pad.Iso10126)}(padIso10126$1)),padIso10126$1.exports}var padIso97971$1={exports:{}},padIso97971=padIso97971$1.exports,hasRequiredPadIso97971;function requirePadIso97971(){return hasRequiredPadIso97971||(hasRequiredPadIso97971=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.pad.Iso97971={pad:function(t,i){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,i)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971)}(padIso97971$1)),padIso97971$1.exports}var padZeropadding$1={exports:{}},padZeropadding=padZeropadding$1.exports,hasRequiredPadZeropadding;function requirePadZeropadding(){return hasRequiredPadZeropadding||(hasRequiredPadZeropadding=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.pad.ZeroPadding={pad:function(t,e){var i=4*e;t.clamp(),t.sigBytes+=i-(t.sigBytes%i||i)},unpad:function(t){var e=t.words,i=t.sigBytes-1;for(i=t.sigBytes-1;i>=0;i--)if(e[i>>>2]>>>24-i%4*8&255){t.sigBytes=i+1;break}}},e.pad.ZeroPadding)}(padZeropadding$1)),padZeropadding$1.exports}var padNopadding$1={exports:{}},padNopadding=padNopadding$1.exports,hasRequiredPadNopadding;function requirePadNopadding(){return hasRequiredPadNopadding||(hasRequiredPadNopadding=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding)}(padNopadding$1)),padNopadding$1.exports}var formatHex$1={exports:{}},formatHex=formatHex$1.exports,hasRequiredFormatHex;function requireFormatHex(){return hasRequiredFormatHex||(hasRequiredFormatHex=1,function(t){var e;t.exports=(e=requireCore(),requireCipherCore(),function(){var t=e,i=t.lib.CipherParams,r=t.enc.Hex;t.format.Hex={stringify:function(t){return t.ciphertext.toString(r)},parse:function(t){var e=r.parse(t);return i.create({ciphertext:e})}}}(),e.format.Hex)}(formatHex$1)),formatHex$1.exports}var aes$1={exports:{}},aes=aes$1.exports,hasRequiredAes;function requireAes(){return hasRequiredAes||(hasRequiredAes=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib.BlockCipher,r=t.algo,n=[],s=[],o=[],a=[],l=[],c=[],h=[],u=[],d=[],p=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var i=0,r=0;for(e=0;e<256;e++){var f=r^r<<1^r<<2^r<<3^r<<4;f=f>>>8^255&f^99,n[i]=f,s[f]=i;var _=t[i],m=t[_],g=t[m],y=257*t[f]^16843008*f;o[i]=y<<24|y>>>8,a[i]=y<<16|y>>>16,l[i]=y<<8|y>>>24,c[i]=y,y=16843009*g^65537*m^257*_^16843008*i,h[f]=y<<24|y>>>8,u[f]=y<<16|y>>>16,d[f]=y<<8|y>>>24,p[f]=y,i?(i=_^t[t[t[g^_]]],r^=t[t[r]]):i=r=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],_=r.AES=i.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4,r=4*((this._nRounds=i+6)+1),s=this._keySchedule=[],o=0;o<r;o++)o<i?s[o]=e[o]:(c=s[o-1],o%i?i>6&&o%i==4&&(c=n[c>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c]):(c=n[(c=c<<8|c>>>24)>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c],c^=f[o/i|0]<<24),s[o]=s[o-i]^c);for(var a=this._invKeySchedule=[],l=0;l<r;l++){if(o=r-l,l%4)var c=s[o];else c=s[o-4];a[l]=l<4||o<=4?c:h[n[c>>>24]]^u[n[c>>>16&255]]^d[n[c>>>8&255]]^p[n[255&c]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,o,a,l,c,n)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,h,u,d,p,s),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,r,n,s,o,a){for(var l=this._nRounds,c=t[e]^i[0],h=t[e+1]^i[1],u=t[e+2]^i[2],d=t[e+3]^i[3],p=4,f=1;f<l;f++){var _=r[c>>>24]^n[h>>>16&255]^s[u>>>8&255]^o[255&d]^i[p++],m=r[h>>>24]^n[u>>>16&255]^s[d>>>8&255]^o[255&c]^i[p++],g=r[u>>>24]^n[d>>>16&255]^s[c>>>8&255]^o[255&h]^i[p++],y=r[d>>>24]^n[c>>>16&255]^s[h>>>8&255]^o[255&u]^i[p++];c=_,h=m,u=g,d=y}_=(a[c>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^i[p++],m=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^i[p++],g=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&h])^i[p++],y=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^i[p++],t[e]=_,t[e+1]=m,t[e+2]=g,t[e+3]=y},keySize:8});t.AES=i._createHelper(_)}(),e.AES)}(aes$1)),aes$1.exports}var tripledes$1={exports:{}},tripledes=tripledes$1.exports,hasRequiredTripledes;function requireTripledes(){return hasRequiredTripledes||(hasRequiredTripledes=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib,r=i.WordArray,n=i.BlockCipher,s=t.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=s.DES=n.extend({_doReset:function(){for(var t=this._key.words,e=[],i=0;i<56;i++){var r=o[i]-1;e[i]=t[r>>>5]>>>31-r%32&1}for(var n=this._subKeys=[],s=0;s<16;s++){var c=n[s]=[],h=l[s];for(i=0;i<24;i++)c[i/6|0]|=e[(a[i]-1+h)%28]<<31-i%6,c[4+(i/6|0)]|=e[28+(a[i+24]-1+h)%28]<<31-i%6;for(c[0]=c[0]<<1|c[0]>>>31,i=1;i<7;i++)c[i]=c[i]>>>4*(i-1)+3;c[7]=c[7]<<5|c[7]>>>27}var u=this._invSubKeys=[];for(i=0;i<16;i++)u[i]=n[15-i]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,i){this._lBlock=t[e],this._rBlock=t[e+1],d.call(this,4,252645135),d.call(this,16,65535),p.call(this,2,858993459),p.call(this,8,16711935),d.call(this,1,1431655765);for(var r=0;r<16;r++){for(var n=i[r],s=this._lBlock,o=this._rBlock,a=0,l=0;l<8;l++)a|=c[l][((o^n[l])&h[l])>>>0];this._lBlock=o,this._rBlock=s^a}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,d.call(this,1,1431655765),p.call(this,8,16711935),p.call(this,2,858993459),d.call(this,16,65535),d.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(t,e){var i=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=i,this._lBlock^=i<<t}function p(t,e){var i=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=i,this._rBlock^=i<<t}t.DES=n._createHelper(u);var f=s.TripleDES=n.extend({_doReset:function(){var t=this._key.words;if(2!==t.length&&4!==t.length&&t.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var e=t.slice(0,2),i=t.length<4?t.slice(0,2):t.slice(2,4),n=t.length<6?t.slice(0,2):t.slice(4,6);this._des1=u.createEncryptor(r.create(e)),this._des2=u.createEncryptor(r.create(i)),this._des3=u.createEncryptor(r.create(n))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=n._createHelper(f)}(),e.TripleDES)}(tripledes$1)),tripledes$1.exports}var rc4$1={exports:{}},rc4=rc4$1.exports,hasRequiredRc4;function requireRc4(){return hasRequiredRc4||(hasRequiredRc4=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib.StreamCipher,r=t.algo,n=r.RC4=i.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes,r=this._S=[],n=0;n<256;n++)r[n]=n;n=0;for(var s=0;n<256;n++){var o=n%i,a=e[o>>>2]>>>24-o%4*8&255;s=(s+r[n]+a)%256;var l=r[n];r[n]=r[s],r[s]=l}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var t=this._S,e=this._i,i=this._j,r=0,n=0;n<4;n++){i=(i+t[e=(e+1)%256])%256;var s=t[e];t[e]=t[i],t[i]=s,r|=t[(t[e]+t[i])%256]<<24-8*n}return this._i=e,this._j=i,r}t.RC4=i._createHelper(n);var o=r.RC4Drop=n.extend({cfg:n.cfg.extend({drop:192}),_doReset:function(){n._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)s.call(this)}});t.RC4Drop=i._createHelper(o)}(),e.RC4)}(rc4$1)),rc4$1.exports}var rabbit$1={exports:{}},rabbit=rabbit$1.exports,hasRequiredRabbit;function requireRabbit(){return hasRequiredRabbit||(hasRequiredRabbit=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib.StreamCipher,r=t.algo,n=[],s=[],o=[],a=r.Rabbit=i.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,i=0;i<4;i++)t[i]=16711935&(t[i]<<8|t[i]>>>24)|4278255360&(t[i]<<24|t[i]>>>8);var r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],n=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,i=0;i<4;i++)l.call(this);for(i=0;i<8;i++)n[i]^=r[i+4&7];if(e){var s=e.words,o=s[0],a=s[1],c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=c>>>16|4294901760&h,d=h<<16|65535&c;for(n[0]^=c,n[1]^=u,n[2]^=h,n[3]^=d,n[4]^=c,n[5]^=u,n[6]^=h,n[7]^=d,i=0;i<4;i++)l.call(this)}},_doProcessBlock:function(t,e){var i=this._X;l.call(this),n[0]=i[0]^i[5]>>>16^i[3]<<16,n[1]=i[2]^i[7]>>>16^i[5]<<16,n[2]=i[4]^i[1]>>>16^i[7]<<16,n[3]=i[6]^i[3]>>>16^i[1]<<16;for(var r=0;r<4;r++)n[r]=16711935&(n[r]<<8|n[r]>>>24)|4278255360&(n[r]<<24|n[r]>>>8),t[e+r]^=n[r]},blockSize:4,ivSize:2});function l(){for(var t=this._X,e=this._C,i=0;i<8;i++)s[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,i=0;i<8;i++){var r=t[i]+e[i],n=65535&r,a=r>>>16,l=((n*n>>>17)+n*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);o[i]=l^c}t[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,t[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,t[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,t[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,t[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,t[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,t[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,t[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.Rabbit=i._createHelper(a)}(),e.Rabbit)}(rabbit$1)),rabbit$1.exports}var rabbitLegacy$1={exports:{}},rabbitLegacy=rabbitLegacy$1.exports,hasRequiredRabbitLegacy;function requireRabbitLegacy(){return hasRequiredRabbitLegacy||(hasRequiredRabbitLegacy=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib.StreamCipher,r=t.algo,n=[],s=[],o=[],a=r.RabbitLegacy=i.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,i=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],r=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var n=0;n<4;n++)l.call(this);for(n=0;n<8;n++)r[n]^=i[n+4&7];if(e){var s=e.words,o=s[0],a=s[1],c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=c>>>16|4294901760&h,d=h<<16|65535&c;for(r[0]^=c,r[1]^=u,r[2]^=h,r[3]^=d,r[4]^=c,r[5]^=u,r[6]^=h,r[7]^=d,n=0;n<4;n++)l.call(this)}},_doProcessBlock:function(t,e){var i=this._X;l.call(this),n[0]=i[0]^i[5]>>>16^i[3]<<16,n[1]=i[2]^i[7]>>>16^i[5]<<16,n[2]=i[4]^i[1]>>>16^i[7]<<16,n[3]=i[6]^i[3]>>>16^i[1]<<16;for(var r=0;r<4;r++)n[r]=16711935&(n[r]<<8|n[r]>>>24)|4278255360&(n[r]<<24|n[r]>>>8),t[e+r]^=n[r]},blockSize:4,ivSize:2});function l(){for(var t=this._X,e=this._C,i=0;i<8;i++)s[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,i=0;i<8;i++){var r=t[i]+e[i],n=65535&r,a=r>>>16,l=((n*n>>>17)+n*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);o[i]=l^c}t[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,t[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,t[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,t[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,t[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,t[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,t[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,t[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.RabbitLegacy=i._createHelper(a)}(),e.RabbitLegacy)}(rabbitLegacy$1)),rabbitLegacy$1.exports}var blowfish$1={exports:{}},blowfish=blowfish$1.exports,hasRequiredBlowfish;function requireBlowfish(){return hasRequiredBlowfish||(hasRequiredBlowfish=1,function(t){var e;t.exports=(e=requireCore(),requireEncBase64(),requireMd5(),requireEvpkdf(),requireCipherCore(),function(){var t=e,i=t.lib.BlockCipher,r=t.algo;const n=16,s=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],o=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var a={pbox:[],sbox:[]};function l(t,e){let i=e>>24&255,r=e>>16&255,n=e>>8&255,s=255&e,o=t.sbox[0][i]+t.sbox[1][r];return o^=t.sbox[2][n],o+=t.sbox[3][s],o}function c(t,e,i){let r,s=e,o=i;for(let a=0;a<n;++a)s^=t.pbox[a],o=l(t,s)^o,r=s,s=o,o=r;return r=s,s=o,o=r,o^=t.pbox[n],s^=t.pbox[n+1],{left:s,right:o}}function h(t,e,i){let r,s=e,o=i;for(let a=n+1;a>1;--a)s^=t.pbox[a],o=l(t,s)^o,r=s,s=o,o=r;return r=s,s=o,o=r,o^=t.pbox[1],s^=t.pbox[0],{left:s,right:o}}function u(t,e,i){for(let n=0;n<4;n++){t.sbox[n]=[];for(let e=0;e<256;e++)t.sbox[n][e]=o[n][e]}let r=0;for(let o=0;o<n+2;o++)t.pbox[o]=s[o]^e[r],r++,r>=i&&(r=0);let a=0,l=0,h=0;for(let s=0;s<n+2;s+=2)h=c(t,a,l),a=h.left,l=h.right,t.pbox[s]=a,t.pbox[s+1]=l;for(let n=0;n<4;n++)for(let e=0;e<256;e+=2)h=c(t,a,l),a=h.left,l=h.right,t.sbox[n][e]=a,t.sbox[n][e+1]=l;return!0}var d=r.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4;u(a,e,i)}},encryptBlock:function(t,e){var i=c(a,t[e],t[e+1]);t[e]=i.left,t[e+1]=i.right},decryptBlock:function(t,e){var i=h(a,t[e],t[e+1]);t[e]=i.left,t[e+1]=i.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=i._createHelper(d)}(),e.Blowfish)}(blowfish$1)),blowfish$1.exports}var cryptoJs=cryptoJs$1.exports,hasRequiredCryptoJs;function requireCryptoJs(){return hasRequiredCryptoJs||(hasRequiredCryptoJs=1,function(t){var e;t.exports=(e=requireCore(),requireX64Core(),requireLibTypedarrays(),requireEncUtf16(),requireEncBase64(),requireEncBase64url(),requireMd5(),requireSha1(),requireSha256(),requireSha224(),requireSha512(),requireSha384(),requireSha3(),requireRipemd160(),requireHmac(),requirePbkdf2(),requireEvpkdf(),requireCipherCore(),requireModeCfb(),requireModeCtr(),requireModeCtrGladman(),requireModeOfb(),requireModeEcb(),requirePadAnsix923(),requirePadIso10126(),requirePadIso97971(),requirePadZeropadding(),requirePadNopadding(),requireFormatHex(),requireAes(),requireTripledes(),requireRc4(),requireRabbit(),requireRabbitLegacy(),requireBlowfish(),e)}(cryptoJs$1)),cryptoJs$1.exports}var cryptoJsExports=requireCryptoJs();let iatWS,lastWsData=[],resultHandle=null;const config$1={appid:"145d2560",apiSecret:"MTM3ZWQ2Y2Y4ZmEyMTEwYWVmMDg3NmRk",apiKey:"4c75d2411acf143f4145ba8b72a03bdc"};function getWebSocketUrl(){var t="wss://iat-api.xfyun.cn/v2/iat",e="iat-api.xfyun.cn",i=config$1.apiKey,r=config$1.apiSecret,n=(new Date).toGMTString(),s=`host: ${e}\ndate: ${n}\nGET /v2/iat HTTP/1.1`,o=cryptoJsExports.HmacSHA256(s,r),a=cryptoJsExports.enc.Base64.stringify(o);return t=`${t}?authorization=${btoa(`api_key="${i}", algorithm="hmac-sha256", headers="host date request-line", signature="${a}"`)}&date=${n}&host=${e}`}function toString(t){for(var e="",i=new Uint8Array(t),r=i.byteLength,n=0;n<r;n++)e+=String.fromCharCode(i[n]);return e}function renderResult(t){let e=JSON.parse(t);if(e.data&&e.data.result){let t=e.data.result,i="",r=t.ws;for(let e=0;e<r.length;e++)i+=r[e].cw[0].w;t.pgs&&("apd"===t.pgs||"rlt"==t.rst&&(console.log("有时间点的识别结果",t),lastWsData=lastWsData.concat(t.ws)))}0===e.code&&2===e.data.status&&(iatWS.close(),null!=resultHandle&&resultHandle(lastWsData)),0!==e.code&&(iatWS.close(),console.error(e),null!=resultHandle&&resultHandle(lastWsData))}function connectWebSocket(t){const e=getWebSocketUrl();if("WebSocket"in window)iatWS=new WebSocket(e);else{if(!("MozWebSocket"in window))return void alert("浏览器不支持WebSocket");iatWS=new MozWebSocket(e)}iatWS.onopen=e=>{var i={common:{app_id:config$1.appid},business:{language:"zh_cn",domain:"iat",accent:"mandarin",vad_eos:5e3,dwa:"wpgs"},data:{status:0,format:"audio/L16;rate=16000",encoding:"raw"}};iatWS.send(JSON.stringify(i)),t()},iatWS.onmessage=t=>{renderResult(t.data)},iatWS.onerror=t=>{console.error(t)}}async function convertAudio(t,e){var i;!function(t){var r,n,s,o=new FileReader;o.onload=function(){r=this.result,a()},o.readAsArrayBuffer(t),i||(n=URL.createObjectURL(new Blob(['importScripts("https://cdn.goowee.cn/src/otplib/ffmpeg_asm.js");var now = Date.now;function print(text) {postMessage({"type" : "stdout","data" : text});};onmessage = function(event) {var message = event.data;if (message.type === "command") {var Module = {print: print,printErr: print,files: message.files || [],arguments: message.arguments || [],TOTAL_MEMORY: message.TOTAL_MEMORY || false};postMessage({"type" : "start","data" : Module.arguments.join(" ")});postMessage({"type" : "stdout","data" : "Received command: " +Module.arguments.join(" ") +((Module.TOTAL_MEMORY) ? ".  Processing with " + Module.TOTAL_MEMORY + " bits." : "")});var time = now();var result = ffmpeg_run(Module);var totalTime = now() - time;postMessage({"type" : "stdout","data" : "Finished processing (took " + totalTime + "ms)"});postMessage({"type" : "done","data" : result,"time" : totalTime});}};postMessage({"type" : "ready"});'],{type:"application/javascript"})),s=new Worker(n),URL.revokeObjectURL(n),i=s),i.onmessage=function(t){var i=t.data;if("ready"==i.type);else if("stdout"==i.type)i.data;else if("start"==i.type);else if("done"==i.type){var r=i.data[0],n=new File([r.data],"test.pcm",{type:"audio/pcm"});null!=e&&e(n)}};var a=function(){i.postMessage({type:"command",arguments:"-i audio.mp3 -acodec pcm_s16le -f s16le -ac 1 -ar 16000 test.pcm".split(" "),files:[{data:new Uint8Array(r),name:"audio.mp3"}]})}}(t)}let VoiceCheck$1=class{static setConfig(t,e,i){null!=t&&(config$1.appid=t),null!=e&&(config$1.apiSecret=e),null!=i&&(config$1.apiKey=i)}static async startTestByUrl(t,e){lastWsData=[],resultHandle=e,connectWebSocket((()=>{axios({url:t,method:"GET",responseType:"arraybuffer"}).then((t=>{let e=t.data;convertAudio(new Blob([e],{type:"audio/mp3"}),(async t=>{const e=toString(await t.arrayBuffer());let i=0;for(;i<e.length;){const t=e.substring(i,i+1280);i+=1280;const r=i>=e.length;iatWS.send(JSON.stringify({data:{status:r?2:1,format:"audio/L16;rate=16000",encoding:"raw",audio:window.btoa(t)}}))}}))}))}))}};function t$2(t,e,i,r){return new(i||(i=Promise))((function(n,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;let e$1=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),null==i?void 0:i.once){const i=(...r)=>{this.un(t,i),e(...r)};return this.listeners[t].add(i),()=>this.un(t,i)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}};const i$1={decode:function(t,e){return t$2(this,void 0,void 0,(function*(){const i=new AudioContext({sampleRate:e});try{return yield i.decodeAudioData(t)}finally{i.close()}}))},createBuffer:function(t,e){if(!t||0===t.length)throw new Error("channelData must be a non-empty array");if(e<=0)throw new Error("duration must be greater than 0");if("number"==typeof t[0]&&(t=[t]),!t[0]||0===t[0].length)throw new Error("channelData must contain non-empty channel arrays");!function(t){const e=t[0];if(e.some((t=>t>1||t<-1))){const i=e.length;let r=0;for(let t=0;t<i;t++){const i=Math.abs(e[t]);i>r&&(r=i)}for(const e of t)for(let t=0;t<i;t++)e[t]/=r}}(t);const i=t.map((t=>t instanceof Float32Array?t:Float32Array.from(t)));return{duration:e,length:i[0].length,sampleRate:i[0].length/e,numberOfChannels:i.length,getChannelData:t=>{const e=i[t];if(!e)throw new Error(`Channel ${t} not found`);return e},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function n$1(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[r,n]of Object.entries(e))if("children"===r&&n)for(const[t,e]of Object.entries(n))e instanceof Node?i.appendChild(e):"string"==typeof e?i.appendChild(document.createTextNode(e)):i.appendChild(n$1(t,e));else"style"===r?Object.assign(i.style,n):"textContent"===r?i.textContent=n:i.setAttribute(r,n.toString());return i}function s$1(t,e,i){const r=n$1(t,e||{});return null==i||i.appendChild(r),r}var r=Object.freeze({__proto__:null,createElement:s$1,default:s$1});const o$1={fetchBlob:function(t,e,i){return t$2(this,void 0,void 0,(function*(){const r=yield fetch(t,i);if(r.status>=400)throw new Error(`Failed to fetch ${t}: ${r.status} (${r.statusText})`);return function(t,e){t$2(this,void 0,void 0,(function*(){if(!t.body||!t.headers)return;const i=t.body.getReader(),r=Number(t.headers.get("Content-Length"))||0;let n=0;const s=t=>{n+=(null==t?void 0:t.length)||0;const i=Math.round(n/r*100);e(i)};try{for(;;){const t=yield i.read();if(t.done)break;s(t.value)}}catch(i){console.warn("Progress tracking error:",i)}}))}(r.clone(),e),r.blob()}))}};class a extends e$1{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),null!=t.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=t.playbackRate&&(this.media.playbackRate=t.playbackRate)}),{once:!0})}onMediaEvent(t,e,i){return this.media.addEventListener(t,e,i),()=>this.media.removeEventListener(t,e,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return""!==this.media.canPlayType(t)}setSrc(t,e){const i=this.getSrc();if(t&&i===t)return;this.revokeSrc();const r=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;if(i&&this.media.removeAttribute("src"),r||t)try{this.media.src=r}catch(e){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(t){this.media=t}play(){return t$2(this,void 0,void 0,(function*(){try{return yield this.media.play()}catch(t){if(t instanceof DOMException&&"AbortError"===t.name)return;throw t}}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,e){null!=e&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}function h(t){return t<0?0:t>1?1:t}function l({maxTop:t,maxBottom:e,halfHeight:i,vScale:r}){const n=Math.round(t*i*r);return{topHeight:n,totalHeight:n+Math.round(e*i*r)||1}}function c({barAlign:t,halfHeight:e,topHeight:i,totalHeight:r,canvasHeight:n}){return"top"===t?0:"bottom"===t?n-r:e-i}function d(t,e,i){const r=e-t.left,n=i-t.top;return[r/t.width,n/t.height]}function u(t){return Boolean(t.barWidth||t.barGap||t.barAlign)}function p(t,e){if(!u(e))return t;const i=e.barWidth||.5,r=i+(e.barGap||i/2);return 0===r?t:Math.floor(t/r)*r}function m({scrollLeft:t,totalWidth:e,numCanvases:i}){if(0===e)return[0];const r=t/e,n=Math.floor(r*i);return[n-1,n,n+1]}function f({scrollLeft:t,clientWidth:e,scrollWidth:i}){return 0===i?{startX:0,endX:0}:{startX:t/i,endX:(t+e)/i}}class g extends e$1{constructor(t,e){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=t;const i=this.parentFromOptionsContainer(t.container);this.parent=i;const[r,n]=this.initHtml();i.appendChild(r),this.container=r,this.scrollContainer=n.querySelector(".scroll"),this.wrapper=n.querySelector(".wrapper"),this.canvasWrapper=n.querySelector(".canvases"),this.progressWrapper=n.querySelector(".progress"),this.cursor=n.querySelector(".cursor"),e&&n.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if("string"==typeof t?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw new Error("Container not found");return e}initEvents(){if(this.wrapper.addEventListener("click",(t=>{const e=this.wrapper.getBoundingClientRect(),[i,r]=d(e,t.clientX,t.clientY);this.emit("click",i,r)})),this.wrapper.addEventListener("dblclick",(t=>{const e=this.wrapper.getBoundingClientRect(),[i,r]=d(e,t.clientX,t.clientY);this.emit("dblclick",i,r)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:t,scrollWidth:e,clientWidth:i}=this.scrollContainer,{startX:r,endX:n}=f({scrollLeft:t,scrollWidth:e,clientWidth:i});this.emit("scroll",r,n,t,t+i)})),"function"==typeof ResizeObserver){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{t().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=t,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=function(t,e,i,r,n=3,s=0,o=100){if(!t)return()=>{};const a=new Map,l=matchMedia("(pointer: coarse)").matches;let c=()=>{};const h=h=>{if(h.button!==s)return;if(a.set(h.pointerId,h),a.size>1)return;let u=h.clientX,d=h.clientY,p=!1;const f=Date.now(),_=r=>{if(r.defaultPrevented||a.size>1)return;if(l&&Date.now()-f<o)return;const s=r.clientX,c=r.clientY,h=s-u,_=c-d;if(p||Math.abs(h)>n||Math.abs(_)>n){r.preventDefault(),r.stopPropagation();const n=t.getBoundingClientRect(),{left:o,top:a}=n;p||(null==i||i(u-o,d-a),p=!0),e(h,_,s-o,c-a),u=s,d=c}},m=e=>{if(a.delete(e.pointerId),p){const i=e.clientX,n=e.clientY,s=t.getBoundingClientRect(),{left:o,top:a}=s;null==r||r(i-o,n-a)}c()},g=t=>{a.delete(t.pointerId),t.relatedTarget&&t.relatedTarget!==document.documentElement||m(t)},y=t=>{p&&(t.stopPropagation(),t.preventDefault())},v=t=>{t.defaultPrevented||a.size>1||p&&t.preventDefault()};document.addEventListener("pointermove",_),document.addEventListener("pointerup",m),document.addEventListener("pointerout",g),document.addEventListener("pointercancel",g),document.addEventListener("touchmove",v,{passive:!1}),document.addEventListener("click",y,{capture:!0}),c=()=>{document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",g),document.removeEventListener("pointercancel",g),document.removeEventListener("touchmove",v),setTimeout((()=>{document.removeEventListener("click",y,{capture:!0})}),10)}};return t.addEventListener("pointerdown",h),()=>{c(),t.removeEventListener("pointerdown",h),a.clear()}}(this.wrapper,((t,e,i)=>{const r=this.wrapper.getBoundingClientRect().width;this.emit("drag",h(i/r))}),(t=>{this.isDragging=!0;const e=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",h(t/e))}),(t=>{this.isDragging=!1;const e=this.wrapper.getBoundingClientRect().width;this.emit("dragend",h(t/e))})),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){const t=document.createElement("div"),e=t.attachShadow({mode:"open"}),i=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML=`\n      <style${i?` nonce="${i}"`:""}>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n          pointer-events: none;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[t,e]}setOptions(t){if(this.options.container!==t.container){const e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}!0!==t.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:e}=this.scrollContainer,i=e*t;this.setScroll(i)}destroy(){var t;this.subscriptions.forEach((t=>t())),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null===(t=this.unsubscribeOnScroll)||void 0===t||t.forEach((t=>t())),this.unsubscribeOnScroll=[]}createDelay(t=10){let e,i;const r=()=>{e&&(clearTimeout(e),e=void 0),i&&(i(),i=void 0)};return this.timeouts.push(r),()=>new Promise(((n,s)=>{r(),i=s,e=setTimeout((()=>{e=void 0,i=void 0,n()}),t)}))}getHeight(t,e){var i;const r=(null===(i=this.audioData)||void 0===i?void 0:i.numberOfChannels)||1;return function({optionsHeight:t,optionsSplitChannels:e,parentHeight:i,numberOfChannels:r,defaultHeight:n=128}){if(null==t)return n;const s=Number(t);if(!isNaN(s))return s;if("auto"===t){const t=i||n;return(null==e?void 0:e.every((t=>!t.overlay)))?t/r:t}return n}({optionsHeight:t,optionsSplitChannels:e,parentHeight:this.parent.clientHeight,numberOfChannels:r,defaultHeight:128})}convertColorValues(t){return function(t,e){if(!Array.isArray(t))return t||"";if(0===t.length)return"#999";if(t.length<2)return t[0]||"";const i=document.createElement("canvas"),r=i.getContext("2d"),n=i.height*e,s=r.createLinearGradient(0,0,0,n||e),o=1/(t.length-1);return t.forEach(((t,e)=>{s.addColorStop(e*o,t)})),s}(t,this.getPixelRatio())}getPixelRatio(){return t=window.devicePixelRatio,Math.max(1,t||1);var t}renderBarWaveform(t,e,i,r){const{width:n,height:s}=i.canvas,{halfHeight:o,barWidth:a,barRadius:h,barIndexScale:u,barSpacing:d}=function({width:t,height:e,length:i,options:r,pixelRatio:n}){const s=e/2,o=r.barWidth?r.barWidth*n:1,a=r.barGap?r.barGap*n:r.barWidth?o/2:0,l=o+a||1;return{halfHeight:s,barWidth:o,barGap:a,barRadius:r.barRadius||0,barIndexScale:i>0?t/l/i:0,barSpacing:l}}({width:n,height:s,length:(t[0]||[]).length,options:e,pixelRatio:this.getPixelRatio()}),p=function({channelData:t,barIndexScale:e,barSpacing:i,barWidth:r,halfHeight:n,vScale:s,canvasHeight:o,barAlign:a}){const h=t[0]||[],u=t[1]||h,d=h.length,p=[];let f=0,_=0,m=0;for(let g=0;g<=d;g++){const t=Math.round(g*e);if(t>f){const{topHeight:e,totalHeight:h}=l({maxTop:_,maxBottom:m,halfHeight:n,vScale:s}),u=c({barAlign:a,halfHeight:n,topHeight:e,totalHeight:h,canvasHeight:o});p.push({x:f*i,y:u,width:r,height:h}),f=t,_=0,m=0}const d=Math.abs(h[g]||0),y=Math.abs(u[g]||0);d>_&&(_=d),y>m&&(m=y)}return p}({channelData:t,barIndexScale:u,barSpacing:d,barWidth:a,halfHeight:o,vScale:r,canvasHeight:s,barAlign:e.barAlign});i.beginPath();for(const l of p)h&&"roundRect"in i?i.roundRect(l.x,l.y,l.width,l.height,h):i.rect(l.x,l.y,l.width,l.height);i.fill(),i.closePath()}renderLineWaveform(t,e,i,r){const{width:n,height:s}=i.canvas,o=function({channelData:t,width:e,height:i,vScale:r}){const n=i/2,s=t[0]||[];return[s,t[1]||s].map(((t,i)=>{const s=t.length,o=s?e/s:0,a=n,l=0===i?-1:1,c=[{x:0,y:a}];let h=0,u=0;for(let e=0;e<=s;e++){const i=Math.round(e*o);if(i>h){const t=a+(Math.round(u*n*r)||1)*l;c.push({x:h,y:t}),h=i,u=0}const s=Math.abs(t[e]||0);s>u&&(u=s)}return c.push({x:h,y:a}),c}))}({channelData:t,width:n,height:s,vScale:r});i.beginPath();for(const a of o)if(a.length){i.moveTo(a[0].x,a[0].y);for(let t=1;t<a.length;t++){const e=a[t];i.lineTo(e.x,e.y)}}i.fill(),i.closePath()}renderWaveform(t,e,i){if(i.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction)return void e.renderFunction(t,i);const r=function({channelData:t,barHeight:e,normalize:i}){var r;const n=e||1;if(!i)return n;const s=t[0];if(!s||0===s.length)return n;let o=0;for(let a=0;a<s.length;a++){const t=null!==(r=s[a])&&void 0!==r?r:0,e=Math.abs(t);e>o&&(o=e)}return o?n/o:n}({channelData:t,barHeight:e.barHeight,normalize:e.normalize});u(e)?this.renderBarWaveform(t,e,i,r):this.renderLineWaveform(t,e,i,r)}renderSingleCanvas(t,e,i,r,n,s,o){const a=this.getPixelRatio(),l=document.createElement("canvas");l.width=Math.round(i*a),l.height=Math.round(r*a),l.style.width=`${i}px`,l.style.height=`${r}px`,l.style.left=`${Math.round(n)}px`,s.appendChild(l);const c=l.getContext("2d");if(e.renderFunction?(c.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction(t,c)):this.renderWaveform(t,e,c),l.width>0&&l.height>0){const t=l.cloneNode(),i=t.getContext("2d");i.drawImage(l,0,0),i.globalCompositeOperation="source-in",i.fillStyle=this.convertColorValues(e.progressColor),i.fillRect(0,0,l.width,l.height),o.appendChild(t)}}renderMultiCanvas(t,e,i,r,n,s){const o=this.getPixelRatio(),{clientWidth:a}=this.scrollContainer,l=i/o,c=function({clientWidth:t,totalWidth:e,options:i}){return p(Math.min(8e3,t,e),i)}({clientWidth:a,totalWidth:l,options:e});let h={};if(0===c)return;const u=i=>{if(i<0||i>=d)return;if(h[i])return;h[i]=!0;const o=i*c;let a=Math.min(l-o,c);if(a=p(a,e),a<=0)return;const u=function({channelData:t,offset:e,clampedWidth:i,totalWidth:r}){return t.map((t=>{const n=Math.floor(e/r*t.length),s=Math.floor((e+i)/r*t.length);return t.slice(n,s)}))}({channelData:t,offset:o,clampedWidth:a,totalWidth:l});this.renderSingleCanvas(u,e,a,r,o,n,s)},d=Math.ceil(l/c);if(this.isScrollable){if(m({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:l,numCanvases:d}).forEach((t=>u(t))),d>1){const t=this.on("scroll",(()=>{const{scrollLeft:t}=this.scrollContainer;Object.keys(h).length>10&&(n.innerHTML="",s.innerHTML="",h={}),m({scrollLeft:t,totalWidth:l,numCanvases:d}).forEach((t=>u(t)))}));this.unsubscribeOnScroll.push(t)}}else for(let p=0;p<d;p++)u(p)}renderChannel(t,e,i,r){var{overlay:n}=e,s=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i}(e,["overlay"]);const o=document.createElement("div"),a=this.getHeight(s.height,s.splitChannels);o.style.height=`${a}px`,n&&r>0&&(o.style.marginTop=`-${a}px`),this.canvasWrapper.style.minHeight=`${a}px`,this.canvasWrapper.appendChild(o);const l=o.cloneNode();this.progressWrapper.appendChild(l),this.renderMultiCanvas(t,s,i,a,o,l)}render(t){return t$2(this,void 0,void 0,(function*(){var e;this.timeouts.forEach((t=>t())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const i=this.getPixelRatio(),r=this.scrollContainer.clientWidth,{scrollWidth:n,isScrollable:s,useParentWidth:o,width:a}=function({duration:t,minPxPerSec:e=0,parentWidth:i,fillParent:r,pixelRatio:n}){const s=Math.ceil(t*e),o=s>i,a=Boolean(r&&!o);return{scrollWidth:s,isScrollable:o,useParentWidth:a,width:(a?i:s)*n}}({duration:t.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:r,fillParent:this.options.fillParent,pixelRatio:i});if(this.isScrollable=s,this.wrapper.style.width=o?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let l=0;l<t.numberOfChannels;l++){const i=Object.assign(Object.assign({},this.options),null===(e=this.options.splitChannels)||void 0===e?void 0:e[l]);this.renderChannel([t.getChannelData(l)],i,a,l)}else{const e=[t.getChannelData(0)];t.numberOfChannels>1&&e.push(t.getChannelData(1)),this.renderChannel(e,this.options,a,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((t=>t())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:t}=this.scrollContainer,{right:e}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){const{right:t}=this.progressWrapper.getBoundingClientRect(),i=function(t){const e=2*t;return(e<0?Math.floor(e):Math.ceil(e))/2}(t-e);this.scrollContainer.scrollLeft+=i}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){const{scrollLeft:i,scrollWidth:r,clientWidth:n}=this.scrollContainer,s=t*r,o=i,a=i+n,l=n/2;if(this.isDragging){const t=30;s+t>a?this.scrollContainer.scrollLeft+=t:s-t<o&&(this.scrollContainer.scrollLeft-=t)}else{(s<o||s>a)&&(this.scrollContainer.scrollLeft=s-(this.options.autoCenter?l:0));const t=s-i-l;e&&this.options.autoCenter&&t>0&&(this.scrollContainer.scrollLeft+=t)}{const t=this.scrollContainer.scrollLeft,{startX:e,endX:i}=f({scrollLeft:t,scrollWidth:r,clientWidth:n});this.emit("scroll",e,i,t,t+n)}}renderProgress(t,e){if(isNaN(t))return;const i=100*t;this.canvasWrapper.style.clipPath=`polygon(${i}% 0%, 100% 0%, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${t*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,e)}exportImage(t,e,i){return t$2(this,void 0,void 0,(function*(){const r=this.canvasWrapper.querySelectorAll("canvas");if(!r.length)throw new Error("No waveform data");if("dataURL"===i){const i=Array.from(r).map((i=>i.toDataURL(t,e)));return Promise.resolve(i)}return Promise.all(Array.from(r).map((i=>new Promise(((r,n)=>{i.toBlob((t=>{t?r(t):n(new Error("Could not export image"))}),t,e)})))))}))}}class v extends e$1{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class b extends e$1{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return t$2(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((e=>{if(e.status>=400)throw new Error(`Failed to fetch ${t}: ${e.status} (${e.statusText})`);return e.arrayBuffer()})).then((e=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(e))).then((e=>{this.currentSrc===t&&(this.buffer=e,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})).catch((t=>{console.error("WebAudioPlayer load error:",t)}))}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,null===(t=this.bufferNode)||void 0===t||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t$2(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){const e=t-this.currentTime,i=this.bufferNode;null==i||i.stop(this.audioContext.currentTime+e),null==i||i.addEventListener("ended",(()=>{i===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(t){return t$2(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,e;return null!==(t=this._duration)&&void 0!==t?t:(null===(e=this.buffer)||void 0===e?void 0:e.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const e=this.buffer.numberOfChannels;for(let i=0;i<e;i++)t.push(this.buffer.getChannelData(i));return t}removeAttribute(t){switch(t){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const y={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class C extends a{static create(t){return new C(t)}constructor(t){const e=t.media||("WebAudio"===t.backend?new b:void 0);super({media:e,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},y,t),this.timer=new v;const i=e?void 0:this.getMediaElement();this.renderer=new g(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const r=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:t,duration:e}=this.options;(r||t&&e)&&this.load(r,t,e).catch((t=>{this.emit("error",t instanceof Error?t:new Error(String(t)))}))}))}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),null!=this.stopAtPosition&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const t=this.updateProgress();this.emit("timeupdate",t)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var t;this.emit("error",null!==(t=this.getMediaElement().error)&&void 0!==t?t:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))})),this.renderer.on("dblclick",((t,e)=>{this.emit("dblclick",t,e)})),this.renderer.on("scroll",((t,e,i,r)=>{const n=this.getDuration();this.emit("scroll",t*n,e*n,i,r)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(t=>{this.emit("dragstart",t)})),this.renderer.on("dragend",(t=>{this.emit("dragend",t)})),this.renderer.on("resize",(()=>{this.emit("resize")})));{let t;const e=this.renderer.on("drag",(e=>{var i;if(!this.options.interact)return;this.renderer.renderProgress(e),clearTimeout(t);let r=0;const n=this.options.dragToSeek;this.isPlaying()?r=0:!0===n?r=200:n&&"object"==typeof n&&(r=null!==(i=n.debounceTime)&&void 0!==i?i:200),t=setTimeout((()=>{this.seekTo(e)}),r),this.emit("interaction",e*this.getDuration()),this.emit("drag",e)}));this.subscriptions.push((()=>{clearTimeout(t),e()}))}}initPlugins(){var t;(null===(t=this.options.plugins)||void 0===t?void 0:t.length)&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t=>t())),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=i$1.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=i$1.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),null!=t.mediaControls&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){if(this.plugins.includes(t))return t;t._init(this),this.plugins.push(t);const e=t.once("destroy",(()=>{this.plugins=this.plugins.filter((e=>e!==t)),this.subscriptions=this.subscriptions.filter((t=>t!==e))}));return this.subscriptions.push(e),t}unregisterPlugin(t){this.plugins=this.plugins.filter((e=>e!==t)),t.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const e=t/this.getDuration();this.renderer.setScrollPercentage(e)}getActivePlugins(){return this.plugins}loadAudio(t,e,i,r){return t$2(this,void 0,void 0,(function*(){var n;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,null===(n=this.abortController)||void 0===n||n.abort(),this.abortController=null,!e&&!i){const i=this.options.fetchParams||{};window.AbortController&&!i.signal&&(this.abortController=new AbortController,i.signal=this.abortController.signal);const r=t=>this.emit("loading",t);e=yield o$1.fetchBlob(t,r,i);const n=this.options.blobMimeType;n&&(e=new Blob([e],{type:n}))}this.setSrc(t,e);const s=yield new Promise((t=>{const e=r||this.getDuration();e?t(e):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>t(this.getDuration())),{once:!0}))}));if(!t&&!e){const t=this.getMediaElement();t instanceof b&&(t.duration=s)}if(i)this.decodedData=i$1.createBuffer(i,s||0);else if(e){const t=yield e.arrayBuffer();this.decodedData=yield i$1.decode(t,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(e,i,r){return t$2(this,void 0,void 0,(function*(){try{return yield this.loadAudio(e,void 0,i,r)}catch(t){throw this.emit("error",t),t}}))}loadBlob(e,i,r){return t$2(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",e,i,r)}catch(t){throw this.emit("error",t),t}}))}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const r=Math.min(t,this.decodedData.numberOfChannels),n=[];for(let s=0;s<r;s++){const t=this.decodedData.getChannelData(s),r=[],o=t.length/e;for(let n=0;n<e;n++){const e=t.slice(Math.floor(n*o),Math.ceil((n+1)*o));let s=0;for(let t=0;t<e.length;t++){const i=e[t];Math.abs(i)>Math.abs(s)&&(s=i)}r.push(Math.round(s*i)/i)}n.push(r)}return n}getDuration(){let t=super.getDuration()||0;return 0!==t&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const e=this.getDuration()*t;this.setTime(e)}play(t,e){const i=Object.create(null,{play:{get:()=>super.play}});return t$2(this,void 0,void 0,(function*(){null!=t&&this.setTime(t);const r=yield i.play.call(this);return null!=e&&(this.media instanceof b?this.media.stopAt(e):this.stopAtPosition=e),r}))}playPause(){return t$2(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return t$2(this,arguments,void 0,(function*(t="image/png",e=1,i="dataURL"){return this.renderer.exportImage(t,e,i)}))}destroy(){var t;this.emit("destroy"),null===(t=this.abortController)||void 0===t||t.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}C.BasePlugin=class extends e$1{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},C.dom=r;let t$1=class{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),null==i?void 0:i.once){const i=(...r)=>{this.un(t,i),e(...r)};return this.listeners[t].add(i),()=>this.un(t,i)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}};class e extends t$1{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function s(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[r,n]of Object.entries(e))if("children"===r&&n)for(const[t,e]of Object.entries(n))e instanceof Node?i.appendChild(e):"string"==typeof e?i.appendChild(document.createTextNode(e)):i.appendChild(s(t,e));else"style"===r?Object.assign(i.style,n):"textContent"===r?i.textContent=n:i.setAttribute(r,n.toString());return i}function i(t,e,i){const r=s(t,e||{});return null==i||i.appendChild(r),r}const n={lineWidth:1,labelSize:11,labelPreferLeft:!1,formatTimeCallback:t=>`${Math.floor(t/60)}:${("0"+Math.floor(t)%60).slice(-2)}`};class o extends e{constructor(t){super(t||{}),this.lastPointerPosition=null,this.unsubscribe=()=>{},this.onPointerMove=t=>{if(!this.wavesurfer)return;this.lastPointerPosition={clientX:t.clientX,clientY:t.clientY};const e=this.wavesurfer.getWrapper().getBoundingClientRect(),{width:i}=e,r=t.clientX-e.left,n=Math.min(1,Math.max(0,r/i)),s=Math.min(i-this.options.lineWidth-1,r);this.wrapper.style.transform=`translateX(${s}px)`,this.wrapper.style.opacity="1";const o=this.wavesurfer.getDuration()||0;this.label.textContent=this.options.formatTimeCallback(o*n);const a=this.label.offsetWidth,l=this.options.labelPreferLeft?s-a>0:s+a>i;this.label.style.transform=l?`translateX(-${a+this.options.lineWidth}px)`:"",this.emit("hover",n)},this.onPointerLeave=()=>{this.wrapper.style.opacity="0",this.lastPointerPosition=null},this.options=Object.assign({},n,t),this.wrapper=i("div",{part:"hover"}),this.label=i("span",{part:"hover-label"},this.wrapper)}static create(t){return new o(t)}addUnits(t){return`${t}${"number"==typeof t?"px":""}`}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const t=this.wavesurfer.options,e=this.options.lineColor||t.cursorColor||t.progressColor;Object.assign(this.wrapper.style,{position:"absolute",zIndex:10,left:0,top:0,height:"100%",pointerEvents:"none",borderLeft:`${this.addUnits(this.options.lineWidth)} solid ${e}`,opacity:"0",transition:"opacity .1s ease-in"}),Object.assign(this.label.style,{display:"block",backgroundColor:this.options.labelBackground,color:this.options.labelColor,fontSize:`${this.addUnits(this.options.labelSize)}`,transition:"transform .1s ease-in",padding:"2px 3px"});const i=this.wavesurfer.getWrapper();i.appendChild(this.wrapper);const r=()=>{this.lastPointerPosition&&this.onPointerMove(this.lastPointerPosition)},n=this.wavesurfer.on("zoom",r),s=this.wavesurfer.on("scroll",r);i.addEventListener("pointermove",this.onPointerMove),i.addEventListener("pointerleave",this.onPointerLeave),this.unsubscribe=()=>{i.removeEventListener("pointermove",this.onPointerMove),i.removeEventListener("pointerleave",this.onPointerLeave),n(),s()}}destroy(){super.destroy(),this.unsubscribe(),this.wrapper.remove()}}const _sfc_main$1={name:"SoundTextEdit",props:{audioUrl:{type:String,required:!0},config:{type:Object,required:!1}},data:()=>({inLoading:!1,dataSource:[],wsArr:[],curTouchCwIndex:-1}),mounted(){console.log("初始化时的配置",this.config),this.dataSource=this.config,this.wavesurfer=C.create({container:document.getElementById("wavesurferParent"),waveColor:"rgb(77, 150, 253)",progressColor:"rgb(253, 165, 77)",url:this.audioUrl,audioRate:1,plugins:[o.create({lineColor:"#ff0000",lineWidth:2,labelBackground:"#555",labelColor:"#fff",labelSize:"11px",labelPreferLeft:!1,formatTimeCallback:t=>t.toFixed(3)+"s"})]})},unmounted(){},methods:{onClickPlayOrPause(){null!=this.wavesurfer&&this.wavesurfer.playPause()},startRun(){cc.Tween.stopAllByTarget(this.node.children[0])},onClickAuto(){this.inLoading=!0,VoiceCheck$1.startTestByUrl(this.audioUrl,(t=>{this.inLoading=!1,console.log("我获取到了字幕结果",t),this.wsArr=t}))},onClickPreview(){null!=this.wavesurfer&&(this.wavesurfer.stop(),setTimeout((()=>{this.wavesurfer.play()}),10));let t=e=>{var i=e.times[e.curTimeIndex]-e.times[e.curTimeIndex-1];let r=e.position[e.curTimeIndex],n=0;1==e.curTimeIndex&&(n=e.times[0]),cc.tween(e).delay(n).to(i,{curProgress:r}).call((()=>{null!=e.position[e.curTimeIndex+1]&&(e.curTimeIndex+=1,t(e))})).start()};for(var e=0;e<this.dataSource.length;e++){let i=this.dataSource[e];i.times.length>1&&(i.curTimeIndex=1,i.curProgress=i.position[0],t(i))}},onClickAddOneText(){this.dataSource.push({text:"",position:[],times:[],width:0,curProgress:0,curTimeIndex:0})},onClickDelOneText(t){this.dataSource.splice(t,1)},onClickAddTimePos(t){t.times.push(this.wavesurfer.getCurrentTime()),t.position.push(t.curProgress),t.curTimeIndex=t.times.length-1},onClickResetTimePos(t){null!=t.times[t.curTimeIndex]&&(t.times[t.curTimeIndex]=this.wavesurfer.getCurrentTime(),t.position[t.curTimeIndex]=t.curProgress)},onClickDeleteTimePos(t){if(null==t.times[t.curTimeIndex])return;t.times.splice(t.curTimeIndex,1),t.position.splice(t.curTimeIndex,1);let e=t.curTimeIndex-1;e<0&&(e=0),t.curTimeIndex=e,this.onPosChange(t)},onPosChange(t){let e=t.times[t.curTimeIndex],i=t.position[t.curTimeIndex];null==t.times[t.curTimeIndex]&&(e=0,i=0),null!=this.wavesurfer&&this.wavesurfer.setTime(e),console.log("设置了时间",e),t.curProgress=i},onClickCwTag(t){null!=this.wsArr[t+1]&&(this.wsArr[t+1].isSplit||(this.wsArr.splice(t+1,0,{isSplit:!0}),this.curTouchCwIndex=-1))},onClickDelSplite(t){this.wsArr.splice(t,1)},onTouchCwTag(t){null!=this.wsArr[t+1]?this.wsArr[t+1].isSplit?this.curTouchCwIndex=-1:this.curTouchCwIndex=t:this.curTouchCwIndex=-1},onLeaveCwTag(t){this.curTouchCwIndex=-1},onClickWsToText(){this.dataSource.push({text:"",position:[],times:[],width:0,curProgress:0,curTimeIndex:0});for(var t=0;t<this.wsArr.length;t++){let e=this.wsArr[t];if(1==e.isSplit)this.dataSource.push({text:"",position:[],times:[],width:0,curProgress:0,curTimeIndex:0});else{this.dataSource[this.dataSource.length-1].text+=e.cw[0].w}}let e=0,i="";for(t=0;t<this.wsArr.length;t++){let r=this.wsArr[t],n=this.dataSource[e];1==r.isSplit?(n.position.push(100),null!=this.wsArr[t+1]?n.times.push(this.wsArr[t+1].bg/100):n.times.push(this.wavesurfer.getDuration()),e+=1,i=""):(n.position.push(i.length/n.text.length*100),i+=r.cw[0].w,n.times.push(r.bg/100))}let r=this.dataSource[e];100!=r.position[r.position.length-1]&&(r.position.push(100),r.times.push(this.wavesurfer.getDuration()))},onClickSave(){this.$emit("onChange",this.dataSource)}}},_hoisted_1$1={style:{width:"100%",height:"100%"}},_hoisted_2$1={style:{"max-width":"300px",overflow:"scroll"}},_hoisted_3$1={style:{"font-size":"20px",color:"#4D96FD"}},_hoisted_4$1={style:{"font-size":"20px",color:"#FDA54D",width:"999px"}};function _sfc_render$1(t,e,i,r,n,s){const o=resolveComponent("a-button"),a=resolveComponent("a-input"),l=resolveComponent("a-flex"),c=resolveComponent("a-radio-button"),h=resolveComponent("a-radio-group"),u=resolveComponent("a-slider"),d=resolveComponent("a-card"),p=resolveComponent("a-tag"),f=resolveComponent("icon-oblique-line"),_=resolveDirective("element-size");return openBlock(),createElementBlock("div",_hoisted_1$1,[e[11]||(e[11]=createBaseVNode("div",{id:"wavesurferParent",style:{width:"100%"}},null,-1)),createVNode(l,{vertical:"",gap:"small",style:{"margin-top":"10px"}},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.dataSource,((t,i)=>(openBlock(),createBlock(d,{size:"small"},{title:withCtx((()=>[createVNode(l,{gap:"small",style:{"margin-right":"10px"}},{default:withCtx((()=>[createVNode(o,{danger:"",onClick:t=>s.onClickDelOneText(i)},{default:withCtx((()=>[...e[0]||(e[0]=[createTextVNode("删除字幕",-1)])])),_:1},8,["onClick"]),createVNode(a,{value:t.text,"onUpdate:value":e=>t.text=e,placeholder:"输入字幕内容"},null,8,["value","onUpdate:value"])])),_:2},1024)])),extra:withCtx((()=>[createVNode(l,{gap:"small"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_2$1,[createVNode(h,{value:t.curTimeIndex,"onUpdate:value":e=>t.curTimeIndex=e,onChange:e=>s.onPosChange(t),"button-style":"solid",style:{width:"max-content"}},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.times,((t,e)=>(openBlock(),createBlock(c,{value:e},{default:withCtx((()=>[createTextVNode(toDisplayString(e+1),1)])),_:2},1032,["value"])))),256))])),_:2},1032,["value","onUpdate:value","onChange"])]),createVNode(o,{onClick:e=>s.onClickAddTimePos(t)},{default:withCtx((()=>[...e[1]||(e[1]=[createTextVNode("打点",-1)])])),_:1},8,["onClick"]),createVNode(o,{onClick:e=>s.onClickResetTimePos(t)},{default:withCtx((()=>[...e[2]||(e[2]=[createTextVNode("修改",-1)])])),_:1},8,["onClick"]),createVNode(o,{danger:"",onClick:e=>s.onClickDeleteTimePos(t)},{default:withCtx((()=>[...e[3]||(e[3]=[createTextVNode("删除选中时间点",-1)])])),_:1},8,["onClick"])])),_:2},1024)])),default:withCtx((()=>[createVNode(l,{gap:"small",vertical:""},{default:withCtx((()=>[createVNode(l,null,{default:withCtx((()=>[withDirectives((openBlock(),createElementBlock("div",_hoisted_3$1,[createTextVNode(toDisplayString(t.text),1)])),[[_,e=>{t.width=e.width}]])])),_:2},1024),createBaseVNode("div",{style:normalizeStyle([{position:"absolute",overflow:"hidden"},{width:t.width*t.curProgress*.01+"px"}])},[createBaseVNode("div",_hoisted_4$1,toDisplayString(t.text),1)],4),createVNode(u,{id:"test",style:normalizeStyle({width:t.width+"px"}),value:t.curProgress,"onUpdate:value":e=>t.curProgress=e,step:.01,tipFormatter:null},null,8,["style","value","onUpdate:value"])])),_:2},1024)])),_:2},1024)))),256)),n.wsArr.length>0?(openBlock(),createBlock(l,{key:0,gap:"small",wrap:"wrap",style:{"margin-top":"10px"}},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.wsArr,((t,e)=>(openBlock(),createElementBlock(Fragment,null,[null!=t.cw?(openBlock(),createBlock(p,{key:0,style:{cursor:"pointer","margin-right":"0"},onClick:t=>s.onClickCwTag(e),onMouseenter:t=>s.onTouchCwTag(e),onMouseleave:t=>s.onLeaveCwTag(e)},{default:withCtx((()=>[createTextVNode(toDisplayString(t.cw[0].w),1)])),_:2},1032,["onClick","onMouseenter","onMouseleave"])):createCommentVNode("",!0),t.isSplit||e==n.curTouchCwIndex?(openBlock(),createBlock(f,{key:1,onClick:t=>s.onClickDelSplite(e),style:{cursor:"pointer",color:"#4D96FD","font-size":"22","stroke-linecap":"round","stroke-linejoin":"miter-clip","stroke-width":"5"}},null,8,["onClick"])):createCommentVNode("",!0)],64)))),256)),createVNode(o,{type:"primary",style:{"margin-left":"20px"},onClick:s.onClickWsToText},{default:withCtx((()=>[...e[4]||(e[4]=[createTextVNode("生成字幕",-1)])])),_:1},8,["onClick"])])),_:1})):createCommentVNode("",!0),createVNode(l,{gap:"small",style:{"margin-top":"10px"}},{default:withCtx((()=>[createVNode(o,{type:"primary",onClick:s.onClickPlayOrPause},{default:withCtx((()=>[...e[5]||(e[5]=[createTextVNode("播放/暂停",-1)])])),_:1},8,["onClick"]),createVNode(o,{type:"primary",onClick:s.onClickAddOneText},{default:withCtx((()=>[...e[6]||(e[6]=[createTextVNode("增加一行字幕",-1)])])),_:1},8,["onClick"]),e[10]||(e[10]=createBaseVNode("div",{style:{height:"1px","flex-grow":"1"}},null,-1)),createVNode(o,{type:"primary",loading:n.inLoading,onClick:s.onClickAuto},{default:withCtx((()=>[...e[7]||(e[7]=[createTextVNode("自动识别",-1)])])),_:1},8,["loading","onClick"]),createVNode(o,{type:"primary",onClick:s.onClickPreview},{default:withCtx((()=>[...e[8]||(e[8]=[createTextVNode("预览",-1)])])),_:1},8,["onClick"]),createVNode(o,{type:"primary",onClick:s.onClickSave},{default:withCtx((()=>[...e[9]||(e[9]=[createTextVNode("保存",-1)])])),_:1},8,["onClick"])])),_:1})])),_:1})])}const SoundTextEdit=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),fnData=[{title:"常用函数",key:"1",children:[{title:"MOD",desc:"求余数",ex:"MOD(3, -2)",key:"1-1",enCode:"MOD"},{title:"ABS",desc:"绝对值",key:"1-2",enCode:"ABS"},{title:"RAND",desc:"[0,1]区间的随机数",key:"1-3",enCode:"RAND"},{title:"ROUND",desc:"四舍五入取整",key:"1-4",enCode:"ROUND"},{title:"ROUNDDOWN",desc:"向下取整",key:"1-5",enCode:"ROUNDDOWN"},{title:"ROUNDUP",desc:"向上取整",ex:"ROUNDUP(-3.14159, 2)",key:"1-6",enCode:"ROUNDUP"},{title:"SQRT",desc:"平方根",key:"1-7",enCode:"SQRT"},{title:"SUM",desc:"求和",ex:"SUM(-5, 15, 32, 'Hello World!')",key:"1-8",enCode:"SUM"},{title:"SUMIF",desc:"对满足条件的值求和",ex:"SUMIF([2,4,8,16], '>5')",key:"1-9",enCode:"SUMIF"}]},{title:"日期转换",key:"2",children:[{title:"DAY",desc:"获取日期中的天",key:"2-1",enCode:"DAY"},{title:"HOUR",desc:"获取日期中的小时",key:"2-2",enCode:"HOUR"},{title:"MINUTE",desc:"获取日期中的分钟",key:"2-3",enCode:"MINUTE"},{title:"SECOND",desc:"获取日期中的秒数",key:"2-4",enCode:"SECOND"},{title:"MONTH",desc:"获取日期中的月份",key:"2-5",enCode:"MONTH"},{title:"YEAR",desc:"获取日期中的年份",key:"2-6",enCode:"YEAR"},{title:"NOW",desc:"获取当前日期，包含时间",key:"2-7",enCode:"NOW"},{title:"DAYS",desc:"返回两个日期相差的天数",key:"2-8",enCode:"DAYS"},{title:"DATE",desc:"通过输入年月日生成时间",key:"2-9",enCode:"DATE"},{title:"DATEVALUE",desc:"通过输入日期字符串生成时间",key:"2-10",enCode:"DATEVALUE"}]},{title:"逻辑运算",key:"3",children:[{title:"AND",desc:"所有输入满足True时输出True",key:"3-1",enCode:"AND"},{title:"IF",desc:"条件判断",key:"3-2",enCode:"IF"},{title:"NOT",desc:"输出相反的True或者False",key:"3-3",enCode:"NOT"},{title:"OR",desc:"任意条件为真则返回真",key:"3-4",enCode:"OR"},{title:"TRUE",desc:"返回true",key:"3-5",enCode:"TRUE"},{title:"FALSE",desc:"返回false",key:"3-6",enCode:"FALSE"},{title:"SWITCH",desc:"多条件判断",key:"3-7",enCode:"SWITCH"}]},{title:"统计运算",key:"4",children:[{title:"MAX",desc:"获取一组输入中最大的数",key:"4-1",enCode:"MAX"},{title:"MIN",desc:"获取一组输入中最小的数",key:"4-2",enCode:"MIN"},{title:"AVERAGE",desc:"求平均数",key:"4-3",enCode:"AVERAGE"},{title:"AVEDEV",desc:"求平均数偏差平均值",key:"4-4",enCode:"AVEDEV"},{title:"COUNT",desc:"返回输入的数量",key:"4-5",enCode:"COUNT"},{title:"COUNTIF",desc:"返回满足条件的输入数量",key:"4-6",enCode:"COUNTIF"}]}],functionDescription={SUM:{title:"求和",example:"SUM(数值1,数值2,...)",description:"SUM(数学成绩,语文成绩,英语成绩,...) = 各科总成绩"},SUMIF:{title:"对满足条件的值求和",example:"SUM([数值1,数值2,...], '>数值')",description:"SUMIF([2,4,8,16], '>5') = 24"},AVERAGE:{title:"平均数",example:"AVERAGE(数值1,数值2,...)",description:"AVERAGE(数学成绩,语文成绩,英语成绩,...) = 平均成绩"},IF:{title:"条件判断",example:"IF(条件,真值,假值)",description:"IF(数学成绩>90,优秀,良好)"},MOD:{title:"求余数",example:"MOD(3, -2)",description:"返回第一个数除第二数的余数,结果：-1"},ABS:{title:"绝对值",example:"ABS(-2)",description:"返回结果：2"},RAND:{title:"随机数",example:"RAND()",description:"返回[0,1]区间的随机数"},ROUND:{title:"四舍五入取整",example:"ROUND(626.3, -3)",description:"四舍五入取整，第二个参数控制保留到小数点后几位，如果是负数则向小数点前保留，上面例子返回1000，相当于在百位上四舍五入"},ROUNDDOWN:{title:"向下取整",example:"ROUNDDOWN(-3.14159, 2)",description:"向下取整，第二个参数控制保留到小数点后几位，如果是负数则向小数点前保留，上面例子返回-3.14"},ROUNDUP:{title:"向上取整",example:"ROUNDUP(-3.14159, 2)",description:"第二个参数控制保留到小数点后几位，如果是负数则向小数点前保留，上面例子返回-3.15"},SQRT:{title:"平方根",example:"SQRT(16)",description:"返回一个数的平方根，上面例子返回4"},DAY:{title:"获取日期中的天",example:"DAY('2025-02-25')",description:"返回一个日期的天，上面例子返回25"},HOUR:{title:"获取日期中的小时",example:"HOUR('7/18/2011 7:45:00 AM')",description:"返回一个日期的小时，上面例子返回7"},MINUTE:{title:"获取日期中的分钟",example:"MINUTE('7/18/2011 7:45:00 AM')",description:"返回一个日期的分钟，上面例子返回45"},SECOND:{title:"获取日期中的秒数",example:"SECOND('2/1/2011 4:48:18 PM')",description:"返回一个日期的秒数，上面例子返回18"},MONTH:{title:"获取日期中的月份",example:"MONTH('2025-02-25')",description:"返回一个日期的秒数，上面例子返回2"},YEAR:{title:"获取日期中的年份",example:"YEAR('2025-02-25')",description:"返回一个日期的秒数，上面例子返回2025"},NOW:{title:"获取当前日期，包含时间",example:"NOW()",description:"返回当前系统时间，Wed Mar 19 2025 17:27:49 GMT+0800 (中国标准时间)"},DATE:{title:"通过输入年月日生成时间",example:"DATE(2025, 9, 10)",description:"生成时间：Wed Sep 10 2025 00:00:00 GMT+0800 (中国标准时间)"},DATEVALUE:{title:"通过输入日期字符串生成时间",example:"DATEVALUE('8/22/2011')",description:"生成时间：Mon Aug 22 2011 00:00:00 GMT+0800 (中国标准时间)"},DAYS:{title:"返回两个日期相差的天数",example:"DAYS('2025-02-25', '2025-04-25')",description:"如果第一个日期小于第二个日期，则返回的是负数，上面的例子返回-59"},AND:{title:"且运算",example:"AND(true, false, true)",description:"所有输入满足True时输出True，上述例子返回false"},OR:{title:"或运算",example:"OR(true, false, true)",description:"任意输入满足True时输出True，上述例子返回true"},IF:{title:"条件判断",example:"IF(true, 'Hello!', 'Goodbye!')",description:"如果为true返回第一个结果，否则返回第二个，上述例子返回Hello!"},NOT:{title:"非运算",example:"NOT(true)",description:"输出相反的True或者False，上述例子返回false"},TRUE:{title:"真boolen值",example:"TRUE()",description:"返回true"},FALSE:{title:"假boolen值",example:"FALSE()",description:"返回false"},SWITCH:{title:"多条件判断",example:"SWITCH(表达式, 值1, 结果1, 值2, 结果2, ...)",description:"这里的“表达式”是一个计算结果，而“值1”、“值2”等是你要与表达式结果进行比对的值。如果表达式的值与某个值匹配，函数会返回对应的结果；如果没有匹配项，可以指定一个默认值。SWITCH(7, 9, 'Nine', 7, 'Seven')返回结果Seven"},MAX:{title:"获取一组输入中最大的数",example:"MAX([0.1,0.2], [0.4,0.8]) or MAX(0.1,0.2,0.8,0.4)",description:"上述示例返回0.8"},MIN:{title:"获取一组输入中最小的数",example:"MIN([0.1,0.2], [0.4,0.8]) or MIN(0.1,0.2,0.8,0.4)",description:"上述示例返回0.1"},AVERAGE:{title:"求平均数",example:"AVERAGE([2,4], [8,16]) or AVERAGE(2,4,8,16)",description:"上述示例返回7.5"},AVEDEV:{title:"求偏差平均值",example:"AVEDEV([2,4], [8,16] or or AVERAGE(2,4,8,16))",description:"上述示例返回4.5"},COUNT:{title:"返回输入的数量",example:"COUNT([2,4], [8,16] or or COUNT(2,4,8,16))",description:"上述示例返回4"},COUNTIF:{title:"返回满足条件的输入数量",example:"COUNTIF([1,2,3,4],'>3')",description:"上述示例返回1"}};
/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],CS2CP={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},set_ansi=function(t){-1!=VALID_ANSI.indexOf(t)&&(current_ansi=CS2CP[0]=t)};function reset_ansi(){set_ansi(1252)}var set_cp=function(t){set_ansi(t)};function reset_cp(){set_cp(1200),reset_ansi()}function char_codes(t){for(var e=[],i=0,r=t.length;i<r;++i)e[i]=t.charCodeAt(i);return e}function utf16leread(t){for(var e=[],i=0;i<t.length>>1;++i)e[i]=String.fromCharCode(t.charCodeAt(2*i)+(t.charCodeAt(2*i+1)<<8));return e.join("")}function utf16beread(t){for(var e=[],i=0;i<t.length>>1;++i)e[i]=String.fromCharCode(t.charCodeAt(2*i+1)+(t.charCodeAt(2*i)<<8));return e.join("")}var debom=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1);return 255==e&&254==i?utf16leread(t.slice(2)):254==e&&255==i?utf16beread(t.slice(2)):65279==e?t.slice(1):t},_getchar=function(t){return String.fromCharCode(t)},_getansi=function(t){return String.fromCharCode(t)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(t){for(var e="",i=0,r=0,n=0,s=0,o=0,a=0,l=0,c=0;c<t.length;)s=(i=t.charCodeAt(c++))>>2,o=(3&i)<<4|(r=t.charCodeAt(c++))>>4,a=(15&r)<<2|(n=t.charCodeAt(c++))>>6,l=63&n,isNaN(r)?a=l=64:isNaN(n)&&(l=64),e+=Base64_map.charAt(s)+Base64_map.charAt(o)+Base64_map.charAt(a)+Base64_map.charAt(l);return e}function Base64_decode(t){var e="",i=0,r=0,n=0,s=0,o=0,a=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var l=0;l<t.length;)i=Base64_map.indexOf(t.charAt(l++))<<2|(s=Base64_map.indexOf(t.charAt(l++)))>>4,e+=String.fromCharCode(i),r=(15&s)<<4|(o=Base64_map.indexOf(t.charAt(l++)))>>2,64!==o&&(e+=String.fromCharCode(r)),n=(3&o)<<6|(a=Base64_map.indexOf(t.charAt(l++))),64!==a&&(e+=String.fromCharCode(n));return e}var has_buf=function(){return"undefined"!=typeof Buffer&&"undefined"!=typeof process&&void 0!==process.versions&&!!process.versions.node}(),Buffer_from=function(){if("undefined"!=typeof Buffer){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch(e){t=!0}return t?function(t,e){return e?new Buffer(t,e):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(t){return has_buf?Buffer.alloc?Buffer.alloc(t):new Buffer(t):"undefined"!=typeof Uint8Array?new Uint8Array(t):new Array(t)}function new_unsafe_buf(t){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):"undefined"!=typeof Uint8Array?new Uint8Array(t):new Array(t)}var s2a=function(t){return has_buf?Buffer_from(t,"binary"):t.split("").map((function(t){return 255&t.charCodeAt(0)}))};function a2s(t){if(Array.isArray(t))return t.map((function(t){return String.fromCharCode(t)})).join("");for(var e=[],i=0;i<t.length;++i)e[i]=String.fromCharCode(t[i]);return e.join("")}function ab2a(t){if("undefined"==typeof ArrayBuffer)throw new Error("Unsupported");if(t instanceof ArrayBuffer)return ab2a(new Uint8Array(t));for(var e=new Array(t.length),i=0;i<t.length;++i)e[i]=t[i];return e}var bconcat=has_buf?function(t){return Buffer.concat(t.map((function(t){return Buffer.isBuffer(t)?t:Buffer_from(t)})))}:function(t){if("undefined"!=typeof Uint8Array){var e=0,i=0;for(e=0;e<t.length;++e)i+=t[e].length;var r=new Uint8Array(i),n=0;for(e=0,i=0;e<t.length;i+=n,++e)if(n=t[e].length,t[e]instanceof Uint8Array)r.set(t[e],i);else{if("string"==typeof t[e])throw"wtf";r.set(new Uint8Array(t[e]),i)}return r}return[].concat.apply([],t.map((function(t){return Array.isArray(t)?t:[].slice.call(t)})))};function utf8decode(t){for(var e=[],i=0,r=t.length+250,n=new_raw_buf(t.length+255),s=0;s<t.length;++s){var o=t.charCodeAt(s);if(o<128)n[i++]=o;else if(o<2048)n[i++]=192|o>>6&31,n[i++]=128|63&o;else if(o>=55296&&o<57344){o=64+(1023&o);var a=1023&t.charCodeAt(++s);n[i++]=240|o>>8&7,n[i++]=128|o>>2&63,n[i++]=128|a>>6&15|(3&o)<<4,n[i++]=128|63&a}else n[i++]=224|o>>12&15,n[i++]=128|o>>6&63,n[i++]=128|63&o;i>r&&(e.push(n.slice(0,i)),i=0,n=new_raw_buf(65535),r=65530)}return e.push(n.slice(0,i)),bconcat(e)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(t){for(var e="",i=t.length-1;i>=0;)e+=t.charAt(i--);return e}function pad0(t,e){var i=""+t;return i.length>=e?i:fill("0",e-i.length)+i}function pad_(t,e){var i=""+t;return i.length>=e?i:fill(" ",e-i.length)+i}function rpad_(t,e){var i=""+t;return i.length>=e?i:i+fill(" ",e-i.length)}function pad0r1(t,e){var i=""+Math.round(t);return i.length>=e?i:fill("0",e-i.length)+i}function pad0r2(t,e){var i=""+t;return i.length>=e?i:fill("0",e-i.length)+i}var p2_32=Math.pow(2,32);function pad0r(t,e){return t>p2_32||t<-p2_32?pad0r1(t,e):pad0r2(Math.round(t),e)}function SSF_isgeneral(t,e){return e=e||0,t.length>=7+e&&103==(32|t.charCodeAt(e))&&101==(32|t.charCodeAt(e+1))&&110==(32|t.charCodeAt(e+2))&&101==(32|t.charCodeAt(e+3))&&114==(32|t.charCodeAt(e+4))&&97==(32|t.charCodeAt(e+5))&&108==(32|t.charCodeAt(e+6))}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',t}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(t,e,i){for(var r=t<0?-1:1,n=t*r,s=0,o=1,a=0,l=1,c=0,h=0,u=Math.floor(n);c<e&&(a=(u=Math.floor(n))*o+s,h=u*c+l,!(n-u<5e-8));)n=1/(n-u),s=o,o=a,l=c,c=h;if(h>e&&(c>e?(h=l,a=s):(h=c,a=o)),!i)return[0,r*a,h];var d=Math.floor(r*a/h);return[d,r*a-d*h,h]}function SSF_parse_date_code(t,e,i){if(t>2958465||t<0)return null;var r=0|t,n=Math.floor(86400*(t-r)),s=0,o=[],a={D:r,T:n,u:86400*(t-r)-n,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(a.u)<1e-6&&(a.u=0),e&&e.date1904&&(r+=1462),a.u>.9999&&(a.u=0,86400==++n&&(a.T=n=0,++r,++a.D)),60===r)o=i?[1317,10,29]:[1900,2,29],s=3;else if(0===r)o=i?[1317,8,29]:[1900,1,0],s=6;else{r>60&&--r;var l=new Date(1900,0,1);l.setDate(l.getDate()+r-1),o=[l.getFullYear(),l.getMonth()+1,l.getDate()],s=l.getDay(),r<60&&(s=(s+6)%7),i&&(s=SSF_fix_hijri(l,o))}return a.y=o[0],a.m=o[1],a.d=o[2],a.S=n%60,n=Math.floor(n/60),a.M=n%60,n=Math.floor(n/60),a.H=n,a.q=s,a}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(t,e){var i=t.getTime();return e?i-=1262304e5:t>=SSFbase1904&&(i+=864e5),(i-(SSFdnthresh+6e4*(t.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())))/864e5}function SSF_strip_decimal(t){return-1==t.indexOf(".")?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(t){return-1==t.indexOf("E")?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(t){var e=t<0?12:11,i=SSF_strip_decimal(t.toFixed(12));return i.length<=e||(i=t.toPrecision(10)).length<=e?i:t.toExponential(5)}function SSF_large_exp(t){var e=SSF_strip_decimal(t.toFixed(11));return e.length>(t<0?12:11)||"0"===e||"-0"===e?t.toPrecision(6):e}function SSF_general_num(t){var e=Math.floor(Math.log(Math.abs(t))*Math.LOG10E);return SSF_strip_decimal(SSF_normalize_exp((e>=-4&&e<=-1?t.toPrecision(10+e):Math.abs(e)<=9?SSF_small_exp(t):10===e?t.toFixed(10).substr(0,12):SSF_large_exp(t)).toUpperCase()))}function SSF_general(t,e){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(0|t)===t?t.toString(10):SSF_general_num(t);case"undefined":return"";case"object":if(null==t)return"";if(t instanceof Date)return SSF_format(14,datenum_local(t,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+t)}function SSF_fix_hijri(t,e){e[0]-=581;var i=t.getDay();return t<60&&(i=(i+6)%7),i}function SSF_write_date(t,e,i,r){var n,s="",o=0,a=0,l=i.y,c=0;switch(t){case 98:l=i.y+543;case 121:switch(e.length){case 1:case 2:n=l%100,c=2;break;default:n=l%1e4,c=4}break;case 109:switch(e.length){case 1:case 2:n=i.m,c=e.length;break;case 3:return months[i.m-1][1];case 5:return months[i.m-1][0];default:return months[i.m-1][2]}break;case 100:switch(e.length){case 1:case 2:n=i.d,c=e.length;break;case 3:return days[i.q][0];default:return days[i.q][1]}break;case 104:switch(e.length){case 1:case 2:n=1+(i.H+11)%12,c=e.length;break;default:throw"bad hour format: "+e}break;case 72:switch(e.length){case 1:case 2:n=i.H,c=e.length;break;default:throw"bad hour format: "+e}break;case 77:switch(e.length){case 1:case 2:n=i.M,c=e.length;break;default:throw"bad minute format: "+e}break;case 115:if("s"!=e&&"ss"!=e&&".0"!=e&&".00"!=e&&".000"!=e)throw"bad second format: "+e;return 0!==i.u||"s"!=e&&"ss"!=e?(a=r>=2?3===r?1e3:100:1===r?10:1,(o=Math.round(a*(i.S+i.u)))>=60*a&&(o=0),"s"===e?0===o?"0":""+o/a:(s=pad0(o,2+r),"ss"===e?s.substr(0,2):"."+s.substr(2,e.length-1))):pad0(i.S,e.length);case 90:switch(e){case"[h]":case"[hh]":n=24*i.D+i.H;break;case"[m]":case"[mm]":n=60*(24*i.D+i.H)+i.M;break;case"[s]":case"[ss]":n=60*(60*(24*i.D+i.H)+i.M)+Math.round(i.S+i.u);break;default:throw"bad abstime format: "+e}c=3===e.length?1:2;break;case 101:n=l,c=1}return c>0?pad0(n,c):""}function commaify(t){if(t.length<=3)return t;for(var e=t.length%3,i=t.substr(0,e);e!=t.length;e+=3)i+=(i.length>0?",":"")+t.substr(e,3);return i}var pct1=/%/g;function write_num_pct(t,e,i){var r=e.replace(pct1,""),n=e.length-r.length;return write_num(t,r,i*Math.pow(10,2*n))+fill("%",n)}function write_num_cm(t,e,i){for(var r=e.length-1;44===e.charCodeAt(r-1);)--r;return write_num(t,e.substr(0,r),i/Math.pow(10,3*(e.length-r)))}function write_num_exp(t,e){var i,r=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==e)return"0.0E+0";if(e<0)return"-"+write_num_exp(t,-e);var n=t.indexOf(".");-1===n&&(n=t.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%n;if(s<0&&(s+=n),-1===(i=(e/Math.pow(10,s)).toPrecision(r+1+(n+s)%n)).indexOf("e")){var o=Math.floor(Math.log(e)*Math.LOG10E);for(-1===i.indexOf(".")?i=i.charAt(0)+"."+i.substr(1)+"E+"+(o-i.length+s):i+="E+"+(o-s);"0."===i.substr(0,2);)i=(i=i.charAt(0)+i.substr(2,n)+"."+i.substr(2+n)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");i=i.replace(/\+-/,"-")}i=i.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(t,e,i,r){return e+i+r.substr(0,(n+s)%n)+"."+r.substr(s)+"E"}))}else i=e.toExponential(r);return t.match(/E\+00$/)&&i.match(/e[+-]\d$/)&&(i=i.substr(0,i.length-1)+"0"+i.charAt(i.length-1)),t.match(/E\-/)&&i.match(/e\+/)&&(i=i.replace(/e\+/,"e")),i.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(t,e,i){var r=parseInt(t[4],10),n=Math.round(e*r),s=Math.floor(n/r),o=n-s*r,a=r;return i+(0===s?"":""+s)+" "+(0===o?fill(" ",t[1].length+1+t[4].length):pad_(o,t[1].length)+t[2]+"/"+t[3]+pad0(a,t[4].length))}function write_num_f2(t,e,i){return i+(0===e?"":""+e)+fill(" ",t[1].length+2+t[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(t){for(var e,i="",r=0;r!=t.length;++r)switch(e=t.charCodeAt(r)){case 35:break;case 63:i+=" ";break;case 48:i+="0";break;default:i+=String.fromCharCode(e)}return i}function rnd(t,e){var i=Math.pow(10,e);return""+Math.round(t*i)/i}function dec(t,e){var i=t-Math.floor(t),r=Math.pow(10,e);return e<(""+Math.round(i*r)).length?0:Math.round(i*r)}function carry(t,e){return e<(""+Math.round((t-Math.floor(t))*Math.pow(10,e))).length?1:0}function flr(t){return t<2147483647&&t>-2147483648?""+(t>=0?0|t:t-1|0):""+Math.floor(t)}function write_num_flt(t,e,i){if(40===t.charCodeAt(0)&&!e.match(closeparen)){var r=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return i>=0?write_num_flt("n",r,i):"("+write_num_flt("n",r,-i)+")"}if(44===e.charCodeAt(e.length-1))return write_num_cm(t,e,i);if(-1!==e.indexOf("%"))return write_num_pct(t,e,i);if(-1!==e.indexOf("E"))return write_num_exp(e,i);if(36===e.charCodeAt(0))return"$"+write_num_flt(t,e.substr(" "==e.charAt(1)?2:1),i);var n,s,o,a,l=Math.abs(i),c=i<0?"-":"";if(e.match(/^00+$/))return c+pad0r(l,e.length);if(e.match(/^[#?]+$/))return"0"===(n=pad0r(i,0))&&(n=""),n.length>e.length?n:hashq(e.substr(0,e.length-n.length))+n;if(s=e.match(frac1))return write_num_f1(s,l,c);if(e.match(/^#+0+$/))return c+pad0r(l,e.length-e.indexOf("0"));if(s=e.match(dec1))return n=rnd(i,s[1].length).replace(/^([^\.]+)$/,"$1."+hashq(s[1])).replace(/\.$/,"."+hashq(s[1])).replace(/\.(\d*)$/,(function(t,e){return"."+e+fill("0",hashq(s[1]).length-e.length)})),-1!==e.indexOf("0.")?n:n.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return c+rnd(l,s[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return c+commaify(pad0r(l,0));if(s=e.match(/^#,##0\.([#0]*0)$/))return i<0?"-"+write_num_flt(t,e,-i):commaify(""+(Math.floor(i)+carry(i,s[1].length)))+"."+pad0(dec(i,s[1].length),s[1].length);if(s=e.match(/^#,#*,#0/))return write_num_flt(t,e.replace(/^#,#*,/,""),i);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return n=_strrev(write_num_flt(t,e.replace(/[\\-]/g,""),i)),o=0,_strrev(_strrev(e.replace(/\\/g,"")).replace(/[0#]/g,(function(t){return o<n.length?n.charAt(o++):"0"===t?"0":""})));if(e.match(phone))return"("+(n=write_num_flt(t,"##########",i)).substr(0,3)+") "+n.substr(3,3)+"-"+n.substr(6);var h="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(s[4].length,7),a=SSF_frac(l,Math.pow(10,o)-1,!1),n=""+c," "==(h=write_num("n",s[1],a[1])).charAt(h.length-1)&&(h=h.substr(0,h.length-1)+"0"),n+=h+s[2]+"/"+s[3],(h=rpad_(a[2],o)).length<s[4].length&&(h=hashq(s[4].substr(s[4].length-h.length))+h),n+=h;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(s[1].length,s[4].length),7),c+((a=SSF_frac(l,Math.pow(10,o)-1,!0))[0]||(a[1]?"":"0"))+" "+(a[1]?pad_(a[1],o)+s[2]+"/"+s[3]+rpad_(a[2],o):fill(" ",2*o+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return n=pad0r(i,0),e.length<=n.length?n:hashq(e.substr(0,e.length-n.length))+n;if(s=e.match(/^([#0?]+)\.([#0]+)$/)){n=""+i.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),o=n.indexOf(".");var u=e.indexOf(".")-o,d=e.length-n.length-u;return hashq(e.substr(0,u)+n+e.substr(e.length-d))}if(s=e.match(/^00,000\.([#0]*0)$/))return o=dec(i,s[1].length),i<0?"-"+write_num_flt(t,e,-i):commaify(flr(i)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(t){return"00,"+(t.length<3?pad0(0,3-t.length):"")+t}))+"."+pad0(o,s[1].length);switch(e){case"###,##0.00":return write_num_flt(t,"#,##0.00",i);case"###,###":case"##,###":case"#,###":var p=commaify(pad0r(l,0));return"0"!==p?c+p:"";case"###,###.00":return write_num_flt(t,"###,##0.00",i).replace(/^0\./,".");case"#,###.00":return write_num_flt(t,"#,##0.00",i).replace(/^0\./,".")}throw new Error("unsupported format |"+e+"|")}function write_num_cm2(t,e,i){for(var r=e.length-1;44===e.charCodeAt(r-1);)--r;return write_num(t,e.substr(0,r),i/Math.pow(10,3*(e.length-r)))}function write_num_pct2(t,e,i){var r=e.replace(pct1,""),n=e.length-r.length;return write_num(t,r,i*Math.pow(10,2*n))+fill("%",n)}function write_num_exp2(t,e){var i,r=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==e)return"0.0E+0";if(e<0)return"-"+write_num_exp2(t,-e);var n=t.indexOf(".");-1===n&&(n=t.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%n;if(s<0&&(s+=n),!(i=(e/Math.pow(10,s)).toPrecision(r+1+(n+s)%n)).match(/[Ee]/)){var o=Math.floor(Math.log(e)*Math.LOG10E);-1===i.indexOf(".")?i=i.charAt(0)+"."+i.substr(1)+"E+"+(o-i.length+s):i+="E+"+(o-s),i=i.replace(/\+-/,"-")}i=i.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(t,e,i,r){return e+i+r.substr(0,(n+s)%n)+"."+r.substr(s)+"E"}))}else i=e.toExponential(r);return t.match(/E\+00$/)&&i.match(/e[+-]\d$/)&&(i=i.substr(0,i.length-1)+"0"+i.charAt(i.length-1)),t.match(/E\-/)&&i.match(/e\+/)&&(i=i.replace(/e\+/,"e")),i.replace("e","E")}function write_num_int(t,e,i){if(40===t.charCodeAt(0)&&!e.match(closeparen)){var r=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return i>=0?write_num_int("n",r,i):"("+write_num_int("n",r,-i)+")"}if(44===e.charCodeAt(e.length-1))return write_num_cm2(t,e,i);if(-1!==e.indexOf("%"))return write_num_pct2(t,e,i);if(-1!==e.indexOf("E"))return write_num_exp2(e,i);if(36===e.charCodeAt(0))return"$"+write_num_int(t,e.substr(" "==e.charAt(1)?2:1),i);var n,s,o,a,l=Math.abs(i),c=i<0?"-":"";if(e.match(/^00+$/))return c+pad0(l,e.length);if(e.match(/^[#?]+$/))return n=""+i,0===i&&(n=""),n.length>e.length?n:hashq(e.substr(0,e.length-n.length))+n;if(s=e.match(frac1))return write_num_f2(s,l,c);if(e.match(/^#+0+$/))return c+pad0(l,e.length-e.indexOf("0"));if(s=e.match(dec1))return n=(n=(""+i).replace(/^([^\.]+)$/,"$1."+hashq(s[1])).replace(/\.$/,"."+hashq(s[1]))).replace(/\.(\d*)$/,(function(t,e){return"."+e+fill("0",hashq(s[1]).length-e.length)})),-1!==e.indexOf("0.")?n:n.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return c+(""+l).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return c+commaify(""+l);if(s=e.match(/^#,##0\.([#0]*0)$/))return i<0?"-"+write_num_int(t,e,-i):commaify(""+i)+"."+fill("0",s[1].length);if(s=e.match(/^#,#*,#0/))return write_num_int(t,e.replace(/^#,#*,/,""),i);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return n=_strrev(write_num_int(t,e.replace(/[\\-]/g,""),i)),o=0,_strrev(_strrev(e.replace(/\\/g,"")).replace(/[0#]/g,(function(t){return o<n.length?n.charAt(o++):"0"===t?"0":""})));if(e.match(phone))return"("+(n=write_num_int(t,"##########",i)).substr(0,3)+") "+n.substr(3,3)+"-"+n.substr(6);var h="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(s[4].length,7),a=SSF_frac(l,Math.pow(10,o)-1,!1),n=""+c," "==(h=write_num("n",s[1],a[1])).charAt(h.length-1)&&(h=h.substr(0,h.length-1)+"0"),n+=h+s[2]+"/"+s[3],(h=rpad_(a[2],o)).length<s[4].length&&(h=hashq(s[4].substr(s[4].length-h.length))+h),n+=h;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(s[1].length,s[4].length),7),c+((a=SSF_frac(l,Math.pow(10,o)-1,!0))[0]||(a[1]?"":"0"))+" "+(a[1]?pad_(a[1],o)+s[2]+"/"+s[3]+rpad_(a[2],o):fill(" ",2*o+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return n=""+i,e.length<=n.length?n:hashq(e.substr(0,e.length-n.length))+n;if(s=e.match(/^([#0]+)\.([#0]+)$/)){n=""+i.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),o=n.indexOf(".");var u=e.indexOf(".")-o,d=e.length-n.length-u;return hashq(e.substr(0,u)+n+e.substr(e.length-d))}if(s=e.match(/^00,000\.([#0]*0)$/))return i<0?"-"+write_num_int(t,e,-i):commaify(""+i).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(t){return"00,"+(t.length<3?pad0(0,3-t.length):"")+t}))+"."+pad0(0,s[1].length);switch(e){case"###,###":case"##,###":case"#,###":var p=commaify(""+l);return"0"!==p?c+p:"";default:if(e.match(/\.[0#?]*$/))return write_num_int(t,e.slice(0,e.lastIndexOf(".")),i)+hashq(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function write_num(t,e,i){return(0|i)===i?write_num_int(t,e,i):write_num_flt(t,e,i)}function SSF_split_fmt(t){for(var e=[],i=!1,r=0,n=0;r<t.length;++r)switch(t.charCodeAt(r)){case 34:i=!i;break;case 95:case 42:case 92:++r;break;case 59:e[e.length]=t.substr(n,r-n),n=r+1}if(e[e.length]=t.substr(n),!0===i)throw new Error("Format |"+t+"| unterminated string ");return e}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(t){for(var e=0,i="",r="";e<t.length;)switch(i=t.charAt(e)){case"G":SSF_isgeneral(t,e)&&(e+=6),e++;break;case'"':for(;34!==t.charCodeAt(++e)&&e<t.length;);++e;break;case"\\":case"_":e+=2;break;case"@":++e;break;case"B":case"b":if("1"===t.charAt(e+1)||"2"===t.charAt(e+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if("A/P"===t.substr(e,3).toUpperCase())return!0;if("AM/PM"===t.substr(e,5).toUpperCase())return!0;if("上午/下午"===t.substr(e,5).toUpperCase())return!0;++e;break;case"[":for(r=i;"]"!==t.charAt(e++)&&e<t.length;)r+=t.charAt(e);if(r.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;e<t.length&&("0#?.,E+-%".indexOf(i=t.charAt(++e))>-1||"\\"==i&&"-"==t.charAt(e+1)&&"0#".indexOf(t.charAt(e+2))>-1););break;case"?":for(;t.charAt(++e)===i;);break;case"*":++e," "!=t.charAt(e)&&"*"!=t.charAt(e)||++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<t.length&&"0123456789".indexOf(t.charAt(++e))>-1;);break;default:++e}return!1}function eval_fmt(t,e,i,r){for(var n,s,o,a=[],l="",c=0,h="",u="t",d="H";c<t.length;)switch(h=t.charAt(c)){case"G":if(!SSF_isgeneral(t,c))throw new Error("unrecognized character "+h+" in "+t);a[a.length]={t:"G",v:"General"},c+=7;break;case'"':for(l="";34!==(o=t.charCodeAt(++c))&&c<t.length;)l+=String.fromCharCode(o);a[a.length]={t:"t",v:l},++c;break;case"\\":var p=t.charAt(++c),f="("===p||")"===p?p:"t";a[a.length]={t:f,v:p},++c;break;case"_":a[a.length]={t:"t",v:" "},c+=2;break;case"@":a[a.length]={t:"T",v:e},++c;break;case"B":case"b":if("1"===t.charAt(c+1)||"2"===t.charAt(c+1)){if(null==n&&null==(n=SSF_parse_date_code(e,i,"2"===t.charAt(c+1))))return"";a[a.length]={t:"X",v:t.substr(c,2)},u=h,c+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":h=h.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(e<0)return"";if(null==n&&null==(n=SSF_parse_date_code(e,i)))return"";for(l=h;++c<t.length&&t.charAt(c).toLowerCase()===h;)l+=h;"m"===h&&"h"===u.toLowerCase()&&(h="M"),"h"===h&&(h=d),a[a.length]={t:h,v:l},u=h;break;case"A":case"a":case"上":var _={t:h,v:h};if(null==n&&(n=SSF_parse_date_code(e,i)),"A/P"===t.substr(c,3).toUpperCase()?(null!=n&&(_.v=n.H>=12?"P":"A"),_.t="T",d="h",c+=3):"AM/PM"===t.substr(c,5).toUpperCase()?(null!=n&&(_.v=n.H>=12?"PM":"AM"),_.t="T",c+=5,d="h"):"上午/下午"===t.substr(c,5).toUpperCase()?(null!=n&&(_.v=n.H>=12?"下午":"上午"),_.t="T",c+=5,d="h"):(_.t="t",++c),null==n&&"T"===_.t)return"";a[a.length]=_,u=h;break;case"[":for(l=h;"]"!==t.charAt(c++)&&c<t.length;)l+=t.charAt(c);if("]"!==l.slice(-1))throw'unterminated "[" block: |'+l+"|";if(l.match(SSF_abstime)){if(null==n&&null==(n=SSF_parse_date_code(e,i)))return"";a[a.length]={t:"Z",v:l.toLowerCase()},u=l.charAt(1)}else l.indexOf("$")>-1&&(l=(l.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(t)||(a[a.length]={t:"t",v:l}));break;case".":if(null!=n){for(l=h;++c<t.length&&"0"===(h=t.charAt(c));)l+=h;a[a.length]={t:"s",v:l};break}case"0":case"#":for(l=h;++c<t.length&&"0#?.,E+-%".indexOf(h=t.charAt(c))>-1;)l+=h;a[a.length]={t:"n",v:l};break;case"?":for(l=h;t.charAt(++c)===h;)l+=h;a[a.length]={t:h,v:l},u=h;break;case"*":++c," "!=t.charAt(c)&&"*"!=t.charAt(c)||++c;break;case"(":case")":a[a.length]={t:1===r?"t":h,v:h},++c;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(l=h;c<t.length&&"0123456789".indexOf(t.charAt(++c))>-1;)l+=t.charAt(c);a[a.length]={t:"D",v:l};break;case" ":a[a.length]={t:h,v:h},++c;break;case"$":a[a.length]={t:"t",v:"$"},++c;break;default:if(-1===",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(h))throw new Error("unrecognized character "+h+" in "+t);a[a.length]={t:"t",v:h},++c}var m,g=0,y=0;for(c=a.length-1,u="t";c>=0;--c)switch(a[c].t){case"h":case"H":a[c].t=d,u="h",g<1&&(g=1);break;case"s":(m=a[c].v.match(/\.0+$/))&&(y=Math.max(y,m[0].length-1)),g<3&&(g=3);case"d":case"y":case"M":case"e":u=a[c].t;break;case"m":"s"===u&&(a[c].t="M",g<2&&(g=2));break;case"X":break;case"Z":g<1&&a[c].v.match(/[Hh]/)&&(g=1),g<2&&a[c].v.match(/[Mm]/)&&(g=2),g<3&&a[c].v.match(/[Ss]/)&&(g=3)}switch(g){case 0:break;case 1:n.u>=.5&&(n.u=0,++n.S),n.S>=60&&(n.S=0,++n.M),n.M>=60&&(n.M=0,++n.H);break;case 2:n.u>=.5&&(n.u=0,++n.S),n.S>=60&&(n.S=0,++n.M)}var v,b="";for(c=0;c<a.length;++c)switch(a[c].t){case"t":case"T":case" ":case"D":break;case"X":a[c].v="",a[c].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":a[c].v=SSF_write_date(a[c].t.charCodeAt(0),a[c].v,n,y),a[c].t="t";break;case"n":case"?":for(v=c+1;null!=a[v]&&("?"===(h=a[v].t)||"D"===h||(" "===h||"t"===h)&&null!=a[v+1]&&("?"===a[v+1].t||"t"===a[v+1].t&&"/"===a[v+1].v)||"("===a[c].t&&(" "===h||"n"===h||")"===h)||"t"===h&&("/"===a[v].v||" "===a[v].v&&null!=a[v+1]&&"?"==a[v+1].t));)a[c].v+=a[v].v,a[v]={v:"",t:";"},++v;b+=a[c].v,c=v-1;break;case"G":a[c].t="t",a[c].v=SSF_general(e,i)}var x,T,C="";if(b.length>0){40==b.charCodeAt(0)?(x=e<0&&45===b.charCodeAt(0)?-e:e,T=write_num("n",b,x)):(T=write_num("n",b,x=e<0&&r>1?-e:e),x<0&&a[0]&&"t"==a[0].t&&(T=T.substr(1),a[0].v="-"+a[0].v)),v=T.length-1;var S=a.length;for(c=0;c<a.length;++c)if(null!=a[c]&&"t"!=a[c].t&&a[c].v.indexOf(".")>-1){S=c;break}var w=a.length;if(S===a.length&&-1===T.indexOf("E")){for(c=a.length-1;c>=0;--c)null!=a[c]&&-1!=="n?".indexOf(a[c].t)&&(v>=a[c].v.length-1?(v-=a[c].v.length,a[c].v=T.substr(v+1,a[c].v.length)):v<0?a[c].v="":(a[c].v=T.substr(0,v+1),v=-1),a[c].t="t",w=c);v>=0&&w<a.length&&(a[w].v=T.substr(0,v+1)+a[w].v)}else if(S!==a.length&&-1===T.indexOf("E")){for(v=T.indexOf(".")-1,c=S;c>=0;--c)if(null!=a[c]&&-1!=="n?".indexOf(a[c].t)){for(s=a[c].v.indexOf(".")>-1&&c===S?a[c].v.indexOf(".")-1:a[c].v.length-1,C=a[c].v.substr(s+1);s>=0;--s)v>=0&&("0"===a[c].v.charAt(s)||"#"===a[c].v.charAt(s))&&(C=T.charAt(v--)+C);a[c].v=C,a[c].t="t",w=c}for(v>=0&&w<a.length&&(a[w].v=T.substr(0,v+1)+a[w].v),v=T.indexOf(".")+1,c=S;c<a.length;++c)if(null!=a[c]&&(-1!=="n?(".indexOf(a[c].t)||c===S)){for(s=a[c].v.indexOf(".")>-1&&c===S?a[c].v.indexOf(".")+1:0,C=a[c].v.substr(0,s);s<a[c].v.length;++s)v<T.length&&(C+=T.charAt(v++));a[c].v=C,a[c].t="t",w=c}}}for(c=0;c<a.length;++c)null!=a[c]&&"n?".indexOf(a[c].t)>-1&&(x=r>1&&e<0&&c>0&&"-"===a[c-1].v?-e:e,a[c].v=write_num(a[c].t,a[c].v,x),a[c].t="t");var A="";for(c=0;c!==a.length;++c)null!=a[c]&&(A+=a[c].v);return A}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(t,e){if(null==e)return!1;var i=parseFloat(e[2]);switch(e[1]){case"=":if(t==i)return!0;break;case">":if(t>i)return!0;break;case"<":if(t<i)return!0;break;case"<>":if(t!=i)return!0;break;case">=":if(t>=i)return!0;break;case"<=":if(t<=i)return!0}return!1}function choose_fmt(t,e){var i=SSF_split_fmt(t),r=i.length,n=i[r-1].indexOf("@");if(r<4&&n>-1&&--r,i.length>4)throw new Error("cannot find right format for |"+i.join("|")+"|");if("number"!=typeof e)return[4,4===i.length||n>-1?i[i.length-1]:"@"];switch(i.length){case 1:i=n>-1?["General","General","General",i[0]]:[i[0],i[0],i[0],"@"];break;case 2:i=n>-1?[i[0],i[0],i[0],i[1]]:[i[0],i[1],i[0],"@"];break;case 3:i=n>-1?[i[0],i[1],i[0],i[2]]:[i[0],i[1],i[2],"@"]}var s=e>0?i[0]:e<0?i[1]:i[2];if(-1===i[0].indexOf("[")&&-1===i[1].indexOf("["))return[r,s];if(null!=i[0].match(/\[[=<>]/)||null!=i[1].match(/\[[=<>]/)){var o=i[0].match(cfregex2),a=i[1].match(cfregex2);return chkcond(e,o)?[r,i[0]]:chkcond(e,a)?[r,i[1]]:[r,i[null!=o&&null!=a?2:1]]}return[r,s]}function SSF_format(t,e,i){null==i&&(i={});var r="";switch(typeof t){case"string":r="m/d/yy"==t&&i.dateNF?i.dateNF:t;break;case"number":null==(r=14==t&&i.dateNF?i.dateNF:(null!=i.table?i.table:table_fmt)[t])&&(r=i.table&&i.table[SSF_default_map[t]]||table_fmt[SSF_default_map[t]]),null==r&&(r=SSF_default_str[t]||"General")}if(SSF_isgeneral(r,0))return SSF_general(e,i);e instanceof Date&&(e=datenum_local(e,i.date1904));var n=choose_fmt(r,e);if(SSF_isgeneral(n[1]))return SSF_general(e,i);if(!0===e)e="TRUE";else if(!1===e)e="FALSE";else if(""===e||null==e)return"";return eval_fmt(n[1],e,i,n[0])}function SSF_load(t,e){if("number"!=typeof e){e=+e||-1;for(var i=0;i<392;++i)if(null!=table_fmt[i]){if(table_fmt[i]==t){e=i;break}}else e<0&&(e=i);e<0&&(e=391)}return table_fmt[e]=t,e}function make_ssf(){table_fmt=SSF_init_table()}var SSFImplicit={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(t){var e="number"==typeof t?table_fmt[t]:t;return e=e.replace(dateNFregex,"(\\d+)"),new RegExp("^"+e+"$")}function dateNF_fix(t,e,i){var r=-1,n=-1,s=-1,o=-1,a=-1,l=-1;(e.match(dateNFregex)||[]).forEach((function(t,e){var c=parseInt(i[e+1],10);switch(t.toLowerCase().charAt(0)){case"y":r=c;break;case"d":s=c;break;case"h":o=c;break;case"s":l=c;break;case"m":o>=0?a=c:n=c}})),l>=0&&-1==a&&n>=0&&(a=n,n=-1);var c=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(n>=1?n:1)).slice(-2)+"-"+("00"+(s>=1?s:1)).slice(-2);7==c.length&&(c="0"+c),8==c.length&&(c="20"+c);var h=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(a>=0?a:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2);return-1==o&&-1==a&&-1==l?c:-1==r&&-1==n&&-1==s?h:c+"T"+h}var CRC32=function(){var t={};t.version="1.2.0";var e=function(){for(var t=0,e=new Array(256),i=0;256!=i;++i)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=i)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[i]=t;return"undefined"!=typeof Int32Array?new Int32Array(e):e}();var i=function(t){var e=0,i=0,r=0,n="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(r=0;256!=r;++r)n[r]=t[r];for(r=0;256!=r;++r)for(i=t[r],e=256+r;e<4096;e+=256)i=n[e]=i>>>8^t[255&i];var s=[];for(r=1;16!=r;++r)s[r-1]="undefined"!=typeof Int32Array?n.subarray(256*r,256*r+256):n.slice(256*r,256*r+256);return s}(e),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],f=i[11],_=i[12],m=i[13],g=i[14];return t.table=e,t.bstr=function(t,i){for(var r=~i,n=0,s=t.length;n<s;)r=r>>>8^e[255&(r^t.charCodeAt(n++))];return~r},t.buf=function(t,i){for(var y=~i,v=t.length-15,b=0;b<v;)y=g[t[b++]^255&y]^m[t[b++]^y>>8&255]^_[t[b++]^y>>16&255]^f[t[b++]^y>>>24]^p[t[b++]]^d[t[b++]]^u[t[b++]]^h[t[b++]]^c[t[b++]]^l[t[b++]]^a[t[b++]]^o[t[b++]]^s[t[b++]]^n[t[b++]]^r[t[b++]]^e[t[b++]];for(v+=15;b<v;)y=y>>>8^e[255&(y^t[b++])];return~y},t.str=function(t,i){for(var r=~i,n=0,s=t.length,o=0,a=0;n<s;)(o=t.charCodeAt(n++))<128?r=r>>>8^e[255&(r^o)]:o<2048?r=(r=r>>>8^e[255&(r^(192|o>>6&31))])>>>8^e[255&(r^(128|63&o))]:o>=55296&&o<57344?(o=64+(1023&o),a=1023&t.charCodeAt(n++),r=(r=(r=(r=r>>>8^e[255&(r^(240|o>>8&7))])>>>8^e[255&(r^(128|o>>2&63))])>>>8^e[255&(r^(128|a>>6&15|(3&o)<<4))])>>>8^e[255&(r^(128|63&a))]):r=(r=(r=r>>>8^e[255&(r^(224|o>>12&15))])>>>8^e[255&(r^(128|o>>6&63))])>>>8^e[255&(r^(128|63&o))];return~r},t}(),CFB=function(){var t,i={};function r(t){if("/"==t.charAt(t.length-1))return-1===t.slice(0,-1).indexOf("/")?t:r(t.slice(0,-1));var e=t.lastIndexOf("/");return-1===e?t:t.slice(0,e+1)}function n(t){if("/"==t.charAt(t.length-1))return n(t.slice(0,-1));var e=t.lastIndexOf("/");return-1===e?t:t.slice(e+1)}function s(t,e){"string"==typeof e&&(e=new Date(e));var i=e.getHours();i=(i=i<<6|e.getMinutes())<<5|e.getSeconds()>>>1,t.write_shift(2,i);var r=e.getFullYear()-1980;r=(r=r<<4|e.getMonth()+1)<<5|e.getDate(),t.write_shift(2,r)}function o(t){prep_blob(t,0);for(var e={},i=0;t.l<=t.length-4;){var r=t.read_shift(2),n=t.read_shift(2),s=t.l+n,o={};if(21589===r)1&(i=t.read_shift(1))&&(o.mtime=t.read_shift(4)),n>5&&(2&i&&(o.atime=t.read_shift(4)),4&i&&(o.ctime=t.read_shift(4))),o.mtime&&(o.mt=new Date(1e3*o.mtime));t.l=s,e[r]=o}return e}function a(){return t||(t={})}function l(t,e){if(80==t[0]&&75==t[1])return nt(t,e);if(109==(32|t[0])&&105==(32|t[1]))return function(t,e){if("mime-version:"!=C(t.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var i=e&&e.root||"",r=(has_buf&&Buffer.isBuffer(t)?t.toString("binary"):C(t)).split("\r\n"),n=0,s="";for(n=0;n<r.length;++n)if(s=r[n],/^Content-Location:/i.test(s)&&(s=s.slice(s.indexOf("file")),i||(i=s.slice(0,s.lastIndexOf("/")+1)),s.slice(0,i.length)!=i))for(;i.length>0&&(i=(i=i.slice(0,i.length-1)).slice(0,i.lastIndexOf("/")+1),s.slice(0,i.length)!=i););var o=(r[1]||"").match(/boundary="(.*?)"/);if(!o)throw new Error("MAD cannot find boundary");var a="--"+(o[1]||""),l=[],c=[],h={FileIndex:l,FullPaths:c};p(h);var u,d=0;for(n=0;n<r.length;++n){var f=r[n];f!==a&&f!==a+"--"||(d++&&ht(h,r.slice(u,n),i),u=n)}return h}(t,e);if(t.length<512)throw new Error("CFB file size "+t.length+" < 512");var i,r,n,s,o,a,l=512,f=[],_=t.slice(0,512);prep_blob(_,0);var m=function(t){if(80==t[t.l]&&75==t[t.l+1])return[0,0];t.chk(v,"Header Signature: "),t.l+=16;var e=t.read_shift(2,"u");return[t.read_shift(2,"u"),e]}(_);switch(i=m[0]){case 3:l=512;break;case 4:l=4096;break;case 0:if(0==m[1])return nt(t,e);default:throw new Error("Major Version: Expected 3 or 4 saw "+i)}512!==l&&prep_blob(_=t.slice(0,l),28);var g=t.slice(0,l);!function(t,e){var i=9;switch(t.l+=2,i=t.read_shift(2)){case 9:if(3!=e)throw new Error("Sector Shift: Expected 9 saw "+i);break;case 12:if(4!=e)throw new Error("Sector Shift: Expected 12 saw "+i);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+i)}t.chk("0600","Mini Sector Shift: "),t.chk("000000000000","Reserved: ")}(_,i);var b=_.read_shift(4,"i");if(3===i&&0!==b)throw new Error("# Directory Sectors: Expected 0 saw "+b);_.l+=4,s=_.read_shift(4,"i"),_.l+=4,_.chk("00100000","Mini Stream Cutoff Size: "),o=_.read_shift(4,"i"),r=_.read_shift(4,"i"),a=_.read_shift(4,"i"),n=_.read_shift(4,"i");for(var x=-1,T=0;T<109&&!((x=_.read_shift(4,"i"))<0);++T)f[T]=x;var S=function(t,e){for(var i=Math.ceil(t.length/e)-1,r=[],n=1;n<i;++n)r[n-1]=t.slice(n*e,(n+1)*e);return r[i-1]=t.slice(i*e),r}(t,l);h(a,n,S,l,f);var w=function(t,e,i,r){var n=t.length,s=[],o=[],a=[],l=[],c=r-1,h=0,u=0,d=0,p=0;for(h=0;h<n;++h)if(a=[],(d=h+e)>=n&&(d-=n),!o[d]){l=[];var f=[];for(u=d;u>=0;){f[u]=!0,o[u]=!0,a[a.length]=u,l.push(t[u]);var _=i[Math.floor(4*u/r)];if(r<4+(p=4*u&c))throw new Error("FAT boundary crossed: "+u+" 4 "+r);if(!t[_])break;if(f[u=__readInt32LE(t[_],p)])break}s[d]={nodes:a,data:__toBuffer([l])}}return s}(S,s,f,l);w[s].name="!Directory",r>0&&o!==y&&(w[o].name="!MiniFAT"),w[f[0]].name="!FAT",w.fat_addrs=f,w.ssz=l;var A=[],E=[],D=[];!function(t,e,i,r,n,s,o,a){for(var l,h=0,p=r.length?2:0,f=e[t].data,_=0,m=0;_<f.length;_+=128){var g=f.slice(_,_+128);prep_blob(g,64),m=g.read_shift(2),l=__utf16le(g,0,m-p),r.push(l);var v={name:l,type:g.read_shift(1),color:g.read_shift(1),L:g.read_shift(4,"i"),R:g.read_shift(4,"i"),C:g.read_shift(4,"i"),clsid:g.read_shift(16),state:g.read_shift(4,"i"),start:0,size:0};0!==g.read_shift(2)+g.read_shift(2)+g.read_shift(2)+g.read_shift(2)&&(v.ct=d(g,g.l-8)),0!==g.read_shift(2)+g.read_shift(2)+g.read_shift(2)+g.read_shift(2)&&(v.mt=d(g,g.l-8)),v.start=g.read_shift(4,"i"),v.size=g.read_shift(4,"i"),v.size<0&&v.start<0&&(v.size=v.type=0,v.start=y,v.name=""),5===v.type?(h=v.start,n>0&&h!==y&&(e[h].name="!StreamData")):v.size>=4096?(v.storage="fat",void 0===e[v.start]&&(e[v.start]=u(i,v.start,e.fat_addrs,e.ssz)),e[v.start].name=v.name,v.content=e[v.start].data.slice(0,v.size)):(v.storage="minifat",v.size<0?v.size=0:h!==y&&v.start!==y&&e[h]&&(v.content=c(v,e[h].data,(e[a]||{}).data))),v.content&&prep_blob(v.content,0),s[l]=v,o.push(v)}}(s,w,S,A,r,{},E,o),function(t,e,i){for(var r=0,n=0,s=0,o=0,a=0,l=i.length,c=[],h=[];r<l;++r)c[r]=h[r]=r,e[r]=i[r];for(;a<h.length;++a)n=t[r=h[a]].L,s=t[r].R,o=t[r].C,c[r]===r&&(-1!==n&&c[n]!==n&&(c[r]=c[n]),-1!==s&&c[s]!==s&&(c[r]=c[s])),-1!==o&&(c[o]=r),-1!==n&&r!=c[r]&&(c[n]=c[r],h.lastIndexOf(n)<a&&h.push(n)),-1!==s&&r!=c[r]&&(c[s]=c[r],h.lastIndexOf(s)<a&&h.push(s));for(r=1;r<l;++r)c[r]===r&&(-1!==s&&c[s]!==s?c[r]=c[s]:-1!==n&&c[n]!==n&&(c[r]=c[n]));for(r=1;r<l;++r)if(0!==t[r].type){if((a=r)!=c[a])do{a=c[a],e[r]=e[a]+"/"+e[r]}while(0!==a&&-1!==c[a]&&a!=c[a]);c[r]=-1}for(e[0]+="/",r=1;r<l;++r)2!==t[r].type&&(e[r]+="/")}(E,D,A),A.shift();var L={FileIndex:E,FullPaths:D};return e&&e.raw&&(L.raw={header:g,sectors:S}),L}function c(t,e,i){for(var r=t.start,n=t.size,s=[],o=r;i&&n>0&&o>=0;)s.push(e.slice(o*g,o*g+g)),n-=g,o=__readInt32LE(i,4*o);return 0===s.length?new_buf(0):bconcat(s).slice(0,t.size)}function h(t,e,i,r,n){var s=y;if(t===y){if(0!==e)throw new Error("DIFAT chain shorter than expected")}else if(-1!==t){var o=i[t],a=(r>>>2)-1;if(!o)return;for(var l=0;l<a&&(s=__readInt32LE(o,4*l))!==y;++l)n.push(s);h(__readInt32LE(o,r-4),e-1,i,r,n)}}function u(t,e,i,r,n){var s=[],o=[];n||(n=[]);var a=r-1,l=0,c=0;for(l=e;l>=0;){n[l]=!0,s[s.length]=l,o.push(t[l]);var h=i[Math.floor(4*l/r)];if(r<4+(c=4*l&a))throw new Error("FAT boundary crossed: "+l+" 4 "+r);if(!t[h])break;l=__readInt32LE(t[h],c)}return{nodes:s,data:__toBuffer([o])}}function d(t,e){return new Date(1e3*(__readUInt32LE(t,e+4)/1e7*Math.pow(2,32)+__readUInt32LE(t,e)/1e7-11644473600))}function p(t,e){var i=e||{},r=i.root||"Root Entry";if(t.FullPaths||(t.FullPaths=[]),t.FileIndex||(t.FileIndex=[]),t.FullPaths.length!==t.FileIndex.length)throw new Error("inconsistent CFB structure");0===t.FullPaths.length&&(t.FullPaths[0]=r+"/",t.FileIndex[0]={name:r,type:5}),i.CLSID&&(t.FileIndex[0].clsid=i.CLSID),function(t){var e="Sh33tJ5";if(CFB.find(t,"/"+e))return;var i=new_buf(4);i[0]=55,i[1]=i[3]=50,i[2]=54,t.FileIndex.push({name:e,type:2,content:i,size:4,L:69,R:69,C:69}),t.FullPaths.push(t.FullPaths[0]+e),f(t)}(t)}function f(t,e){p(t);for(var i=!1,s=!1,o=t.FullPaths.length-1;o>=0;--o){var a=t.FileIndex[o];switch(a.type){case 0:s?i=!0:(t.FileIndex.pop(),t.FullPaths.pop());break;case 1:case 2:case 5:s=!0,isNaN(a.R*a.L*a.C)&&(i=!0),a.R>-1&&a.L>-1&&a.R==a.L&&(i=!0);break;default:i=!0}}if(i||e){var l=new Date(1987,1,19),c=0,h=Object.create?Object.create(null):{},u=[];for(o=0;o<t.FullPaths.length;++o)h[t.FullPaths[o]]=!0,0!==t.FileIndex[o].type&&u.push([t.FullPaths[o],t.FileIndex[o]]);for(o=0;o<u.length;++o){var d=r(u[o][0]);(s=h[d])||(u.push([d,{name:n(d).replace("/",""),type:1,clsid:x,ct:l,mt:l,content:null}]),h[d]=!0)}for(u.sort((function(t,e){return function(t,e){for(var i=t.split("/"),r=e.split("/"),n=0,s=0,o=Math.min(i.length,r.length);n<o;++n){if(s=i[n].length-r[n].length)return s;if(i[n]!=r[n])return i[n]<r[n]?-1:1}return i.length-r.length}(t[0],e[0])})),t.FullPaths=[],t.FileIndex=[],o=0;o<u.length;++o)t.FullPaths[o]=u[o][0],t.FileIndex[o]=u[o][1];for(o=0;o<u.length;++o){var f=t.FileIndex[o],_=t.FullPaths[o];if(f.name=n(_).replace("/",""),f.L=f.R=f.C=-(f.color=1),f.size=f.content?f.content.length:0,f.start=0,f.clsid=f.clsid||x,0===o)f.C=u.length>1?1:-1,f.size=0,f.type=5;else if("/"==_.slice(-1)){for(c=o+1;c<u.length&&r(t.FullPaths[c])!=_;++c);for(f.C=c>=u.length?-1:c,c=o+1;c<u.length&&r(t.FullPaths[c])!=r(_);++c);f.R=c>=u.length?-1:c,f.type=1}else r(t.FullPaths[o+1]||"")==r(_)&&(f.R=o+1),f.type=2}}}function _(t,e){var i=e||{};if("mad"==i.fileType)return function(t,e){for(var i=e||{},r=i.boundary||"SheetJS",n=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(r="------="+r).slice(2)+'"',"","",""],s=t.FullPaths[0],o=s,a=t.FileIndex[0],l=1;l<t.FullPaths.length;++l)if(o=t.FullPaths[l].slice(s.length),(a=t.FileIndex[l]).size&&a.content&&"Sh33tJ5"!=o){o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,(function(t){return"_x"+t.charCodeAt(0).toString(16)+"_"})).replace(/[\u0080-\uFFFF]/g,(function(t){return"_u"+t.charCodeAt(0).toString(16)+"_"}));for(var c=a.content,h=has_buf&&Buffer.isBuffer(c)?c.toString("binary"):C(c),u=0,d=Math.min(1024,h.length),p=0,f=0;f<=d;++f)(p=h.charCodeAt(f))>=32&&p<128&&++u;var _=u>=4*d/5;n.push(r),n.push("Content-Location: "+(i.root||"file:///C:/SheetJS/")+o),n.push("Content-Transfer-Encoding: "+(_?"quoted-printable":"base64")),n.push("Content-Type: "+at(a,o)),n.push(""),n.push(_?ct(h):lt(h))}return n.push(r+"--\r\n"),n.join("\r\n")}(t,i);if(f(t),"zip"===i.fileType)return function(t,e){var i=e||{},r=[],n=[],o=new_buf(1),a=i.compression?8:0,l=0,c=0,h=0,u=0,d=0,p=t.FullPaths[0],f=p,_=t.FileIndex[0],m=[],g=0;for(c=1;c<t.FullPaths.length;++c)if(f=t.FullPaths[c].slice(p.length),(_=t.FileIndex[c]).size&&_.content&&"Sh33tJ5"!=f){var y=u,v=new_buf(f.length);for(h=0;h<f.length;++h)v.write_shift(1,127&f.charCodeAt(h));v=v.slice(0,v.l),m[d]=CRC32.buf(_.content,0);var b=_.content;8==a&&(b=S(b)),(o=new_buf(30)).write_shift(4,67324752),o.write_shift(2,20),o.write_shift(2,l),o.write_shift(2,a),_.mt?s(o,_.mt):o.write_shift(4,0),o.write_shift(-4,m[d]),o.write_shift(4,b.length),o.write_shift(4,_.content.length),o.write_shift(2,v.length),o.write_shift(2,0),u+=o.length,r.push(o),u+=v.length,r.push(v),u+=b.length,r.push(b),(o=new_buf(46)).write_shift(4,33639248),o.write_shift(2,0),o.write_shift(2,20),o.write_shift(2,l),o.write_shift(2,a),o.write_shift(4,0),o.write_shift(-4,m[d]),o.write_shift(4,b.length),o.write_shift(4,_.content.length),o.write_shift(2,v.length),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(4,0),o.write_shift(4,y),g+=o.l,n.push(o),g+=v.length,n.push(v),++d}return o=new_buf(22),o.write_shift(4,101010256),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,d),o.write_shift(2,d),o.write_shift(4,g),o.write_shift(4,u),o.write_shift(2,0),bconcat([bconcat(r),bconcat(n),o])}(t,i);var r=function(t){for(var e=0,i=0,r=0;r<t.FileIndex.length;++r){var n=t.FileIndex[r];if(n.content){var s=n.content.length;s>0&&(s<4096?e+=s+63>>6:i+=s+511>>9)}}for(var o=t.FullPaths.length+3>>2,a=e+127>>7,l=(e+7>>3)+i+o+a,c=l+127>>7,h=c<=109?0:Math.ceil((c-109)/127);l+c+h+127>>7>c;)h=++c<=109?0:Math.ceil((c-109)/127);var u=[1,h,c,a,o,i,e,0];return t.FileIndex[0].size=e<<6,u[7]=(t.FileIndex[0].start=u[0]+u[1]+u[2]+u[3]+u[4]+u[5])+(u[6]+7>>3),u}(t),n=new_buf(r[7]<<9),o=0,a=0;for(o=0;o<8;++o)n.write_shift(1,b[o]);for(o=0;o<8;++o)n.write_shift(2,0);for(n.write_shift(2,62),n.write_shift(2,3),n.write_shift(2,65534),n.write_shift(2,9),n.write_shift(2,6),o=0;o<3;++o)n.write_shift(2,0);for(n.write_shift(4,0),n.write_shift(4,r[2]),n.write_shift(4,r[0]+r[1]+r[2]+r[3]-1),n.write_shift(4,0),n.write_shift(4,4096),n.write_shift(4,r[3]?r[0]+r[1]+r[2]-1:y),n.write_shift(4,r[3]),n.write_shift(-4,r[1]?r[0]-1:y),n.write_shift(4,r[1]),o=0;o<109;++o)n.write_shift(-4,o<r[2]?r[1]+o:-1);if(r[1])for(a=0;a<r[1];++a){for(;o<236+127*a;++o)n.write_shift(-4,o<r[2]?r[1]+o:-1);n.write_shift(-4,a===r[1]-1?y:a+1)}var l=function(t){for(a+=t;o<a-1;++o)n.write_shift(-4,o+1);t&&(++o,n.write_shift(-4,y))};for(a=o=0,a+=r[1];o<a;++o)n.write_shift(-4,T.DIFSECT);for(a+=r[2];o<a;++o)n.write_shift(-4,T.FATSECT);l(r[3]),l(r[4]);for(var c=0,h=0,u=t.FileIndex[0];c<t.FileIndex.length;++c)(u=t.FileIndex[c]).content&&((h=u.content.length)<4096||(u.start=a,l(h+511>>9)));for(l(r[6]+7>>3);511&n.l;)n.write_shift(-4,T.ENDOFCHAIN);for(a=o=0,c=0;c<t.FileIndex.length;++c)(u=t.FileIndex[c]).content&&(!(h=u.content.length)||h>=4096||(u.start=a,l(h+63>>6)));for(;511&n.l;)n.write_shift(-4,T.ENDOFCHAIN);for(o=0;o<r[4]<<2;++o){var d=t.FullPaths[o];if(d&&0!==d.length){u=t.FileIndex[o],0===o&&(u.start=u.size?u.start-1:y);var p=0===o&&i.root||u.name;if(h=2*(p.length+1),n.write_shift(64,p,"utf16le"),n.write_shift(2,h),n.write_shift(1,u.type),n.write_shift(1,u.color),n.write_shift(-4,u.L),n.write_shift(-4,u.R),n.write_shift(-4,u.C),u.clsid)n.write_shift(16,u.clsid,"hex");else for(c=0;c<4;++c)n.write_shift(4,0);n.write_shift(4,u.state||0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,u.start),n.write_shift(4,u.size),n.write_shift(4,0)}else{for(c=0;c<17;++c)n.write_shift(4,0);for(c=0;c<3;++c)n.write_shift(4,-1);for(c=0;c<12;++c)n.write_shift(4,0)}}for(o=1;o<t.FileIndex.length;++o)if((u=t.FileIndex[o]).size>=4096)if(n.l=u.start+1<<9,has_buf&&Buffer.isBuffer(u.content))u.content.copy(n,n.l,0,u.size),n.l+=u.size+511&-512;else{for(c=0;c<u.size;++c)n.write_shift(1,u.content[c]);for(;511&c;++c)n.write_shift(1,0)}for(o=1;o<t.FileIndex.length;++o)if((u=t.FileIndex[o]).size>0&&u.size<4096)if(has_buf&&Buffer.isBuffer(u.content))u.content.copy(n,n.l,0,u.size),n.l+=u.size+63&-64;else{for(c=0;c<u.size;++c)n.write_shift(1,u.content[c]);for(;63&c;++c)n.write_shift(1,0)}if(has_buf)n.l=n.length;else for(;n.l<n.length;)n.write_shift(1,0);return n}i.version="1.2.1";var m,g=64,y=-2,v="d0cf11e0a1b11ae1",b=[208,207,17,224,161,177,26,225],x="00000000000000000000000000000000",T={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:y,FREESECT:-1,HEADER_SIGNATURE:v,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:x,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function C(t){for(var e=new Array(t.length),i=0;i<t.length;++i)e[i]=String.fromCharCode(t[i]);return e.join("")}function S(t){return m?m.deflateRawSync(t):J(t)}var w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],E=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function D(t){var e=139536&(t<<1|t<<11)|558144&(t<<5|t<<15);return 255&(e>>16|e>>8|e)}for(var L="undefined"!=typeof Uint8Array,I=L?new Uint8Array(256):[],P=0;P<256;++P)I[P]=D(P);function M(t,e){var i=I[255&t];return e<=8?i>>>8-e:(i=i<<8|I[t>>8&255],e<=16?i>>>16-e:(i=i<<8|I[t>>16&255])>>>24-e)}function R(t,e){var i=7&e,r=e>>>3;return(t[r]|(i<=6?0:t[r+1]<<8))>>>i&3}function O(t,e){var i=7&e,r=e>>>3;return(t[r]|(i<=5?0:t[r+1]<<8))>>>i&7}function B(t,e){var i=7&e,r=e>>>3;return(t[r]|(i<=3?0:t[r+1]<<8))>>>i&31}function N(t,e){var i=7&e,r=e>>>3;return(t[r]|(i<=1?0:t[r+1]<<8))>>>i&127}function k(t,e,i){var r=7&e,n=e>>>3,s=(1<<i)-1,o=t[n]>>>r;return i<8-r?o&s:(o|=t[n+1]<<8-r,i<16-r?o&s:(o|=t[n+2]<<16-r,i<24-r?o&s:(o|=t[n+3]<<24-r)&s))}function F(t,e,i){var r=7&e,n=e>>>3;return r<=5?t[n]|=(7&i)<<r:(t[n]|=i<<r&255,t[n+1]=(7&i)>>8-r),e+3}function V(t,e,i){return i=(1&i)<<(7&e),t[e>>>3]|=i,e+1}function j(t,e,i){var r=e>>>3;return i<<=7&e,t[r]|=255&i,i>>>=8,t[r+1]=i,e+8}function G(t,e,i){var r=e>>>3;return i<<=7&e,t[r]|=255&i,i>>>=8,t[r+1]=255&i,t[r+2]=i>>>8,e+16}function U(t,e){var i=t.length,r=2*i>e?2*i:e+5,n=0;if(i>=e)return t;if(has_buf){var s=new_unsafe_buf(r);if(t.copy)t.copy(s);else for(;n<t.length;++n)s[n]=t[n];return s}if(L){var o=new Uint8Array(r);if(o.set)o.set(t);else for(;n<i;++n)o[n]=t[n];return o}return t.length=r,t}function Y(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=0;return e}function H(t,e,i){var r=1,n=0,s=0,o=0,a=0,l=t.length,c=L?new Uint16Array(32):Y(32);for(s=0;s<32;++s)c[s]=0;for(s=l;s<i;++s)t[s]=0;l=t.length;var h=L?new Uint16Array(l):Y(l);for(s=0;s<l;++s)c[n=t[s]]++,r<n&&(r=n),h[s]=0;for(c[0]=0,s=1;s<=r;++s)c[s+16]=a=a+c[s-1]<<1;for(s=0;s<l;++s)0!=(a=t[s])&&(h[s]=c[a+16]++);var u=0;for(s=0;s<l;++s)if(0!=(u=t[s]))for(a=M(h[s],r)>>r-u,o=(1<<r+4-u)-1;o>=0;--o)e[a|o<<u]=15&u|s<<4;return r}var X=L?new Uint16Array(512):Y(512),z=L?new Uint16Array(32):Y(32);if(!L){for(var W=0;W<512;++W)X[W]=0;for(W=0;W<32;++W)z[W]=0}!function(){for(var t=[],e=0;e<32;e++)t.push(5);H(t,z,32);var i=[];for(e=0;e<=143;e++)i.push(8);for(;e<=255;e++)i.push(9);for(;e<=279;e++)i.push(7);for(;e<=287;e++)i.push(8);H(i,X,288)}();var Z=function(){for(var t=L?new Uint8Array(32768):[],e=0,i=0;e<E.length-1;++e)for(;i<E[e+1];++i)t[i]=e;for(;i<32768;++i)t[i]=29;var r=L?new Uint8Array(259):[];for(e=0,i=0;e<A.length-1;++e)for(;i<A[e+1];++i)r[i]=e;return function(e,i){return e.length<8?function(t,e){for(var i=0;i<t.length;){var r=Math.min(65535,t.length-i),n=i+r==t.length;for(e.write_shift(1,+n),e.write_shift(2,r),e.write_shift(2,65535&~r);r-- >0;)e[e.l++]=t[i++]}return e.l}(e,i):function(e,i){for(var n=0,s=0,o=L?new Uint16Array(32768):[];s<e.length;){var a=Math.min(65535,e.length-s);if(a<10){for(7&(n=F(i,n,+!(s+a!=e.length)))&&(n+=8-(7&n)),i.l=n/8|0,i.write_shift(2,a),i.write_shift(2,65535&~a);a-- >0;)i[i.l++]=e[s++];n=8*i.l}else{n=F(i,n,+!(s+a!=e.length)+2);for(var l=0;a-- >0;){var c=e[s],h=-1,u=0;if((h=o[l=32767&(l<<5^c)])&&((h|=-32768&s)>s&&(h-=32768),h<s))for(;e[h+u]==e[s+u]&&u<250;)++u;if(u>2){(c=r[u])<=22?n=j(i,n,I[c+1]>>1)-1:(j(i,n,3),j(i,n+=5,I[c-23]>>5),n+=3);var d=c<8?0:c-4>>2;d>0&&(G(i,n,u-A[c]),n+=d),c=t[s-h],n=j(i,n,I[c]>>3),n-=3;var p=c<4?0:c-2>>1;p>0&&(G(i,n,s-h-E[c]),n+=p);for(var f=0;f<u;++f)o[l]=32767&s,l=32767&(l<<5^e[s]),++s;a-=u-1}else c<=143?c+=48:n=V(i,n,1),n=j(i,n,I[c]),o[l]=32767&s,++s}n=j(i,n,0)-1}}return i.l=(n+7)/8|0,i.l}(e,i)}}();function J(t){var e=new_buf(50+Math.floor(1.1*t.length)),i=Z(t,e);return e.slice(0,i)}var q=L?new Uint16Array(32768):Y(32768),K=L?new Uint16Array(32768):Y(32768),Q=L?new Uint16Array(128):Y(128),$=1,tt=1;function et(t,e){var i=B(t,e)+257,r=B(t,e+=5)+1,n=function(t,e){var i=7&e,r=e>>>3;return(t[r]|(i<=4?0:t[r+1]<<8))>>>i&15}(t,e+=5)+4;e+=4;for(var s=0,o=L?new Uint8Array(19):Y(19),a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=1,c=L?new Uint8Array(8):Y(8),h=L?new Uint8Array(8):Y(8),u=o.length,d=0;d<n;++d)o[w[d]]=s=O(t,e),l<s&&(l=s),c[s]++,e+=3;var p=0;for(c[0]=0,d=1;d<=l;++d)h[d]=p=p+c[d-1]<<1;for(d=0;d<u;++d)0!=(p=o[d])&&(a[d]=h[p]++);var f=0;for(d=0;d<u;++d)if(0!=(f=o[d])){p=I[a[d]]>>8-f;for(var _=(1<<7-f)-1;_>=0;--_)Q[p|_<<f]=7&f|d<<3}var m=[];for(l=1;m.length<i+r;)switch(e+=7&(p=Q[N(t,e)]),p>>>=3){case 16:for(s=3+R(t,e),e+=2,p=m[m.length-1];s-- >0;)m.push(p);break;case 17:for(s=3+O(t,e),e+=3;s-- >0;)m.push(0);break;case 18:for(s=11+N(t,e),e+=7;s-- >0;)m.push(0);break;default:m.push(p),l<p&&(l=p)}var g=m.slice(0,i),y=m.slice(i);for(d=i;d<286;++d)g[d]=0;for(d=r;d<30;++d)y[d]=0;return $=H(g,q,286),tt=H(y,K,30),e}function it(t,e){var i=function(t,e){if(3==t[0]&&!(3&t[1]))return[new_raw_buf(e),2];for(var i=0,r=0,n=new_unsafe_buf(e||1<<18),s=0,o=n.length>>>0,a=0,l=0;!(1&r);)if(r=O(t,i),i+=3,r>>>1!=0)for(r>>1==1?(a=9,l=5):(i=et(t,i),a=$,l=tt);;){!e&&o<s+32767&&(o=(n=U(n,s+32767)).length);var c=k(t,i,a),h=r>>>1==1?X[c]:q[c];if(i+=15&h,(h>>>=4)>>>8&255){if(256==h)break;var u=(h-=257)<8?0:h-4>>2;u>5&&(u=0);var d=s+A[h];u>0&&(d+=k(t,i,u),i+=u),c=k(t,i,l),i+=15&(h=r>>>1==1?z[c]:K[c]);var p=(h>>>=4)<4?0:h-2>>1,f=E[h];for(p>0&&(f+=k(t,i,p),i+=p),!e&&o<d&&(o=(n=U(n,d+100)).length);s<d;)n[s]=n[s-f],++s}else n[s++]=h}else{7&i&&(i+=8-(7&i));var _=t[i>>>3]|t[1+(i>>>3)]<<8;if(i+=32,_>0)for(!e&&o<s+_&&(o=(n=U(n,s+_)).length);_-- >0;)n[s++]=t[i>>>3],i+=8}return e?[n,i+7>>>3]:[n.slice(0,s),i+7>>>3]}(t.slice(t.l||0),e);return t.l+=i[1],i[0]}function rt(t,e){if(!t)throw new Error(e);"undefined"!=typeof console&&console.error(e)}function nt(t,e){var i=t;prep_blob(i,0);var r={FileIndex:[],FullPaths:[]};p(r,{root:e.root});for(var n=i.length-4;(80!=i[n]||75!=i[n+1]||5!=i[n+2]||6!=i[n+3])&&n>=0;)--n;i.l=n+4,i.l+=4;var s=i.read_shift(2);i.l+=6;var a=i.read_shift(4);for(i.l=a,n=0;n<s;++n){i.l+=20;var l=i.read_shift(4),c=i.read_shift(4),h=i.read_shift(2),u=i.read_shift(2),d=i.read_shift(2);i.l+=8;var f=i.read_shift(4),_=o(i.slice(i.l+h,i.l+h+u));i.l+=h+u+d;var m=i.l;i.l=f+4,st(i,l,c,r,_),i.l=m}return r}function st(t,e,i,r,n){t.l+=2;var s=t.read_shift(2),a=t.read_shift(2),l=function(t){var e=65535&t.read_shift(2),i=65535&t.read_shift(2),r=new Date,n=31&i,s=15&(i>>>=5);i>>>=4,r.setMilliseconds(0),r.setFullYear(i+1980),r.setMonth(s-1),r.setDate(n);var o=31&e,a=63&(e>>>=5);return e>>>=6,r.setHours(e),r.setMinutes(a),r.setSeconds(o<<1),r}(t);if(8257&s)throw new Error("Unsupported ZIP encryption");t.read_shift(4);for(var c=t.read_shift(4),h=t.read_shift(4),u=t.read_shift(2),d=t.read_shift(2),p="",f=0;f<u;++f)p+=String.fromCharCode(t[t.l++]);if(d){var _=o(t.slice(t.l,t.l+d));(_[21589]||{}).mt&&(l=_[21589].mt),((n||{})[21589]||{}).mt&&(l=n[21589].mt)}t.l+=d;var g=t.slice(t.l,t.l+c);switch(a){case 8:g=function(t,e){if(!m)return it(t,e);var i=new(0,m.InflateRaw),r=i._processChunk(t.slice(t.l),i._finishFlushFlag);return t.l+=i.bytesRead,r}(t,h);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+a)}var y=!1;8&s&&(134695760==t.read_shift(4)&&(t.read_shift(4),y=!0),c=t.read_shift(4),h=t.read_shift(4)),c!=e&&rt(y,"Bad compressed size: "+e+" != "+c),h!=i&&rt(y,"Bad uncompressed size: "+i+" != "+h),ut(r,p,g,{unsafe:!0,mt:l})}var ot={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function at(t,e){if(t.ctype)return t.ctype;var i=t.name||"",r=i.match(/\.([^\.]+)$/);return r&&ot[r[1]]||e&&(r=(i=e).match(/[\.\\]([^\.\\])+$/))&&ot[r[1]]?ot[r[1]]:"application/octet-stream"}function lt(t){for(var e=Base64_encode(t),i=[],r=0;r<e.length;r+=76)i.push(e.slice(r,r+76));return i.join("\r\n")+"\r\n"}function ct(t){var e=t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,(function(t){var e=t.charCodeAt(0).toString(16).toUpperCase();return"="+(1==e.length?"0"+e:e)}));"\n"==(e=e.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(e="=0D"+e.slice(1));for(var i=[],r=(e=e.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),n=0;n<r.length;++n){var s=r[n];if(0!=s.length)for(var o=0;o<s.length;){var a=76,l=s.slice(o,o+a);"="==l.charAt(a-1)?a--:"="==l.charAt(a-2)?a-=2:"="==l.charAt(a-3)&&(a-=3),l=s.slice(o,o+a),(o+=a)<s.length&&(l+="="),i.push(l)}else i.push("")}return i.join("\r\n")}function ht(t,e,i){for(var r,n="",s="",o="",a=0;a<10;++a){var l=e[a];if(!l||l.match(/^\s*$/))break;var c=l.match(/^(.*?):\s*([^\s].*)$/);if(c)switch(c[1].toLowerCase()){case"content-location":n=c[2].trim();break;case"content-type":o=c[2].trim();break;case"content-transfer-encoding":s=c[2].trim()}}switch(++a,s.toLowerCase()){case"base64":r=s2a(Base64_decode(e.slice(a).join("")));break;case"quoted-printable":r=function(t){for(var e=[],i=0;i<t.length;++i){for(var r=t[i];i<=t.length&&"="==r.charAt(r.length-1);)r=r.slice(0,r.length-1)+t[++i];e.push(r)}for(var n=0;n<e.length;++n)e[n]=e[n].replace(/[=][0-9A-Fa-f]{2}/g,(function(t){return String.fromCharCode(parseInt(t.slice(1),16))}));return s2a(e.join("\r\n"))}(e.slice(a));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+s)}var h=ut(t,n.slice(i.length),r,{unsafe:!0});o&&(h.ctype=o)}function ut(t,e,i,r){var s=r&&r.unsafe;s||p(t);var o=!s&&CFB.find(t,e);if(!o){var a=t.FullPaths[0];e.slice(0,a.length)==a?a=e:("/"!=a.slice(-1)&&(a+="/"),a=(a+e).replace("//","/")),o={name:n(e),type:2},t.FileIndex.push(o),t.FullPaths.push(a),s||CFB.utils.cfb_gc(t)}return o.content=i,o.size=i?i.length:0,r&&(r.CLSID&&(o.clsid=r.CLSID),r.mt&&(o.mt=r.mt),r.ct&&(o.ct=r.ct)),o}return i.find=function(t,e){var i=t.FullPaths.map((function(t){return t.toUpperCase()})),r=i.map((function(t){var e=t.split("/");return e[e.length-("/"==t.slice(-1)?2:1)]})),n=!1;47===e.charCodeAt(0)?(n=!0,e=i[0].slice(0,-1)+e):n=-1!==e.indexOf("/");var s=e.toUpperCase(),o=!0===n?i.indexOf(s):r.indexOf(s);if(-1!==o)return t.FileIndex[o];var a=!s.match(chr1);for(s=s.replace(chr0,""),a&&(s=s.replace(chr1,"!")),o=0;o<i.length;++o){if((a?i[o].replace(chr1,"!"):i[o]).replace(chr0,"")==s)return t.FileIndex[o];if((a?r[o].replace(chr1,"!"):r[o]).replace(chr0,"")==s)return t.FileIndex[o]}return null},i.read=function(e,i){var r=i&&i.type;switch(r||has_buf&&Buffer.isBuffer(e)&&(r="buffer"),r||"base64"){case"file":return function(e,i){return a(),l(t.readFileSync(e),i)}(e,i);case"base64":return l(s2a(Base64_decode(e)),i);case"binary":return l(s2a(e),i)}return l(e,i)},i.parse=l,i.write=function(e,i){var r=_(e,i);switch(i&&i.type||"buffer"){case"file":return a(),t.writeFileSync(i.filename,r),r;case"binary":return"string"==typeof r?r:C(r);case"base64":return Base64_encode("string"==typeof r?r:C(r));case"buffer":if(has_buf)return Buffer.isBuffer(r)?r:Buffer_from(r);case"array":return"string"==typeof r?s2a(r):r}return r},i.writeFile=function(e,i,r){a();var n=_(e,r);t.writeFileSync(i,n)},i.utils={cfb_new:function(t){var e={};return p(e,t),e},cfb_add:ut,cfb_del:function(t,e){p(t);var i=CFB.find(t,e);if(i)for(var r=0;r<t.FileIndex.length;++r)if(t.FileIndex[r]==i)return t.FileIndex.splice(r,1),t.FullPaths.splice(r,1),!0;return!1},cfb_mov:function(t,e,i){p(t);var r=CFB.find(t,e);if(r)for(var s=0;s<t.FileIndex.length;++s)if(t.FileIndex[s]==r)return t.FileIndex[s].name=n(i),t.FullPaths[s]=i,!0;return!1},cfb_gc:function(t){f(t,!0)},ReadShift:ReadShift,CheckField:CheckField,prep_blob:prep_blob,bconcat:bconcat,use_zlib:function(t){try{var i=new(0,t.InflateRaw);if(i._processChunk(new Uint8Array([3,0]),i._finishFlushFlag),!i.bytesRead)throw new Error("zlib does not expose bytesRead");m=t}catch(e){console.error("cannot use native zlib: "+(e.message||e))}},_deflateRaw:J,_inflateRaw:it,consts:T},i}();function read_binary(t){if("undefined"!=typeof Deno)return Deno.readFileSync(t);if("undefined"!=typeof $&&"undefined"!=typeof File&&"undefined"!=typeof Folder)try{var i=File(t);i.open("r"),i.encoding="binary";var r=i.read();return i.close(),r}catch(e){if(!e.message||!e.message.match(/onstruct/))throw e}throw new Error("Cannot access file "+t)}function keys(t){for(var e=Object.keys(t),i=[],r=0;r<e.length;++r)Object.prototype.hasOwnProperty.call(t,e[r])&&i.push(e[r]);return i}function evert(t){for(var e=[],i=keys(t),r=0;r!==i.length;++r)e[t[i[r]]]=i[r];return e}var basedate=new Date(1899,11,30,0,0,0);function datenum(t,e){return(t.getTime()-(basedate.getTime()+6e4*(t.getTimezoneOffset()-basedate.getTimezoneOffset())))/864e5}var refdate=new Date,dnthresh=basedate.getTime()+6e4*(refdate.getTimezoneOffset()-basedate.getTimezoneOffset()),refoffset=refdate.getTimezoneOffset();function numdate(t){var e=new Date;return e.setTime(24*t*60*60*1e3+dnthresh),e.getTimezoneOffset()!==refoffset&&e.setTime(e.getTime()+6e4*(e.getTimezoneOffset()-refoffset)),e}function parse_isodur(t){var e=0,i=0,r=!1,n=t.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!n)throw new Error("|"+t+"| is not an ISO8601 Duration");for(var s=1;s!=n.length;++s)if(n[s]){switch(i=1,s>3&&(r=!0),n[s].slice(n[s].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+n[s].slice(n[s].length-1));case"D":i*=24;case"H":i*=60;case"M":if(!r)throw new Error("Unsupported ISO Duration Field: M");i*=60}e+=i*parseInt(n[s],10)}return e}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=2017==good_pd_date.getFullYear();function parseDate(t,e){var i=new Date(t);if(good_pd)return e>0?i.setTime(i.getTime()+60*i.getTimezoneOffset()*1e3):e<0&&i.setTime(i.getTime()-60*i.getTimezoneOffset()*1e3),i;if(t instanceof Date)return t;if(1917==good_pd_date.getFullYear()&&!isNaN(i.getFullYear())){var r=i.getFullYear();return t.indexOf(""+r)>-1||i.setFullYear(i.getFullYear()+100),i}var n=t.match(/\d+/g)||["2017","2","19","0","0","0"],s=new Date(+n[0],+n[1]-1,+n[2],+n[3]||0,+n[4]||0,+n[5]||0);return t.indexOf("Z")>-1&&(s=new Date(s.getTime()-60*s.getTimezoneOffset()*1e3)),s}function cc2str(t,i){if(has_buf&&Buffer.isBuffer(t)){if(i){if(255==t[0]&&254==t[1])return utf8write(t.slice(2).toString("utf16le"));if(254==t[1]&&255==t[2])return utf8write(utf16beread(t.slice(2).toString("binary")))}return t.toString("binary")}if("undefined"!=typeof TextDecoder)try{if(i){if(255==t[0]&&254==t[1])return utf8write(new TextDecoder("utf-16le").decode(t.slice(2)));if(254==t[0]&&255==t[1])return utf8write(new TextDecoder("utf-16be").decode(t.slice(2)))}var r={"€":"","‚":"","ƒ":"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"","Š":"","‹":"","Œ":"","Ž":"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"","š":"","›":"","œ":"","ž":"","Ÿ":""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,(function(t){return r[t]||t}))}catch(e){}for(var n=[],s=0;s!=t.length;++s)n.push(String.fromCharCode(t[s]));return n.join("")}function dup(t){if("undefined"!=typeof JSON&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if("object"!=typeof t||null==t)return t;if(t instanceof Date)return new Date(t.getTime());var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=dup(t[i]));return e}function fill(t,e){for(var i="";i.length<e;)i+=t;return i}function fuzzynum(t){var e=Number(t);if(!isNaN(e))return isFinite(e)?e:NaN;if(!/\d/.test(t))return e;var i=1,r=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,(function(){return i*=100,""}));return isNaN(e=Number(r))?(r=r.replace(/[(](.*)[)]/,(function(t,e){return i=-i,e})),isNaN(e=Number(r))?e:e/i):e/i}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(t){var e=new Date(t),i=new Date(NaN),r=e.getYear(),n=e.getMonth(),s=e.getDate();if(isNaN(s))return i;var o=t.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==lower_months.indexOf(o))return i}else if(o.match(/[a-z]/))return i;return r<0||r>8099?i:(n>0||s>1)&&101!=r?e:t.match(/[^-0-9:,\/\\]/)?i:e}var split_regex=function(){var t=5=="abacaba".split(/(:?b)/i).length;return function(e,i,r){if(t||"string"==typeof i)return e.split(i);for(var n=e.split(i),s=[n[0]],o=1;o<n.length;++o)s.push(r),s.push(n[o]);return s}}();function getdatastr(t){return t?t.content&&t.type?cc2str(t.content,!0):t.data?debom(t.data):t.asNodeBuffer&&has_buf?debom(t.asNodeBuffer().toString("binary")):t.asBinary?debom(t.asBinary()):t._data&&t._data.getContent?debom(cc2str(Array.prototype.slice.call(t._data.getContent(),0))):null:null}function getdatabin(t){if(!t)return null;if(t.data)return char_codes(t.data);if(t.asNodeBuffer&&has_buf)return t.asNodeBuffer();if(t._data&&t._data.getContent){var e=t._data.getContent();return"string"==typeof e?char_codes(e):Array.prototype.slice.call(e)}return t.content&&t.type?t.content:null}function getdata(t){return t&&".bin"===t.name.slice(-4)?getdatabin(t):getdatastr(t)}function safegetzipfile(t,e){for(var i=t.FullPaths||keys(t.files),r=e.toLowerCase().replace(/[\/]/g,"\\"),n=r.replace(/\\/g,"/"),s=0;s<i.length;++s){var o=i[s].replace(/^Root Entry[\/]/,"").toLowerCase();if(r==o||n==o)return t.files?t.files[i[s]]:t.FileIndex[s]}return null}function getzipfile(t,e){var i=safegetzipfile(t,e);if(null==i)throw new Error("Cannot find file "+e+" in zip");return i}function getzipdata(t,i,r){if(!r)return getdata(getzipfile(t,i));if(!i)return null;try{return getzipdata(t,i)}catch(e){return null}}function getzipstr(t,i,r){if(!r)return getdatastr(getzipfile(t,i));if(!i)return null;try{return getzipstr(t,i)}catch(e){return null}}function getzipbin(t,e,i){return getdatabin(getzipfile(t,e))}function zipentries(t){for(var e=t.FullPaths||keys(t.files),i=[],r=0;r<e.length;++r)"/"!=e[r].slice(-1)&&i.push(e[r].replace(/^Root Entry[\/]/,""));return i.sort()}function zip_add_file(t,e,i){if(t.FullPaths){var r;if("string"==typeof i)return r=has_buf?Buffer_from(i):utf8decode(i),CFB.utils.cfb_add(t,e,r);CFB.utils.cfb_add(t,e,i)}else t.file(e,i)}function zip_read(t,e){switch(e.type){case"base64":return CFB.read(t,{type:"base64"});case"binary":return CFB.read(t,{type:"binary"});case"buffer":case"array":return CFB.read(t,{type:"buffer"})}throw new Error("Unrecognized type "+e.type)}function resolve_path(t,e){if("/"==t.charAt(0))return t.slice(1);var i=e.split("/");"/"!=e.slice(-1)&&i.pop();for(var r=t.split("/");0!==r.length;){var n=r.shift();".."===n?i.pop():"."!==n&&i.push(n)}return i.join("/")}var XML_HEADER='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',attregexg=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,tagregex1=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/gm,tagregex2=/<[^>]*>/g,tagregex=XML_HEADER.match(tagregex1)?tagregex1:tagregex2,nsregex=/<\w*:/,nsregex2=/<(\/?)\w+:/;function parsexmltag(t,e,i){for(var r={},n=0,s=0;n!==t.length&&(32!==(s=t.charCodeAt(n))&&10!==s&&13!==s);++n);if(e||(r[0]=t.slice(0,n)),n===t.length)return r;var o=t.match(attregexg),a=0,l="",c=0,h="",u="",d=1;if(o)for(c=0;c!=o.length;++c){for(u=o[c],s=0;s!=u.length&&61!==u.charCodeAt(s);++s);for(h=u.slice(0,s).trim();32==u.charCodeAt(s+1);)++s;for(d=34==(n=u.charCodeAt(s+1))||39==n?1:0,l=u.slice(s+1+d,u.length-d),a=0;a!=h.length&&58!==h.charCodeAt(a);++a);if(a===h.length)h.indexOf("_")>0&&(h=h.slice(0,h.indexOf("_"))),r[h]=l,r[h.toLowerCase()]=l;else{var p=(5===a&&"xmlns"===h.slice(0,5)?"xmlns":"")+h.slice(a+1);if(r[p]&&"ext"==h.slice(a-3,a))continue;r[p]=l,r[p.toLowerCase()]=l}}return r}function strip_ns(t){return t.replace(nsregex2,"<$1")}var encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),unescapexml=function(){var t=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/gi,e=/_x([\da-fA-F]{4})_/gi;return function i(r){var n=r+"",s=n.indexOf("<![CDATA[");if(-1==s)return n.replace(t,(function(t,e){return encodings[t]||String.fromCharCode(parseInt(e,t.indexOf("x")>-1?16:10))||t})).replace(e,(function(t,e){return String.fromCharCode(parseInt(e,16))}));var o=n.indexOf("]]>");return i(n.slice(0,s))+n.slice(s+9,o)+i(n.slice(o+3))}}(),decregex=/[&<>'"]/g,htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(t){return(t+"").replace(decregex,(function(t){return rencoding[t]})).replace(/\n/g,"<br/>").replace(htmlcharegex,(function(t){return"&#x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+";"}))}var xlml_fixstr=function(){var t=/&#(\d+);/g;function e(t,e){return String.fromCharCode(parseInt(e,10))}return function(i){return i.replace(t,e)}}();function parsexmlbool(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(t){for(var e="",i=0,r=0,n=0,s=0,o=0,a=0;i<t.length;)(r=t.charCodeAt(i++))<128?e+=String.fromCharCode(r):(n=t.charCodeAt(i++),r>191&&r<224?(o=(31&r)<<6,o|=63&n,e+=String.fromCharCode(o)):(s=t.charCodeAt(i++),r<240?e+=String.fromCharCode((15&r)<<12|(63&n)<<6|63&s):(a=((7&r)<<18|(63&n)<<12|(63&s)<<6|63&(o=t.charCodeAt(i++)))-65536,e+=String.fromCharCode(55296+(a>>>10&1023)),e+=String.fromCharCode(56320+(1023&a)))));return e}function utf8readb(t){var e,i,r,n=new_raw_buf(2*t.length),s=1,o=0,a=0;for(i=0;i<t.length;i+=s)s=1,(r=t.charCodeAt(i))<128?e=r:r<224?(e=64*(31&r)+(63&t.charCodeAt(i+1)),s=2):r<240?(e=4096*(15&r)+64*(63&t.charCodeAt(i+1))+(63&t.charCodeAt(i+2)),s=3):(s=4,e=262144*(7&r)+4096*(63&t.charCodeAt(i+1))+64*(63&t.charCodeAt(i+2))+(63&t.charCodeAt(i+3)),a=55296+((e-=65536)>>>10&1023),e=56320+(1023&e)),0!==a&&(n[o++]=255&a,n[o++]=a>>>8,a=0),n[o++]=e%256,n[o++]=e>>>8;return n.slice(0,o).toString("ucs2")}function utf8readc(t){return Buffer_from(t,"binary").toString("utf8")}var utf8corpus="foo bar bazâð£",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(t){return Buffer_from(t,"utf8").toString("binary")}:function(t){for(var e=[],i=0,r=0,n=0;i<t.length;)switch(r=t.charCodeAt(i++),!0){case r<128:e.push(String.fromCharCode(r));break;case r<2048:e.push(String.fromCharCode(192+(r>>6))),e.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,n=t.charCodeAt(i++)-56320+(r<<10),e.push(String.fromCharCode(240+(n>>18&7))),e.push(String.fromCharCode(144+(n>>12&63))),e.push(String.fromCharCode(128+(n>>6&63))),e.push(String.fromCharCode(128+(63&n)));break;default:e.push(String.fromCharCode(224+(r>>12))),e.push(String.fromCharCode(128+(r>>6&63))),e.push(String.fromCharCode(128+(63&r)))}return e.join("")},matchtag=function(){var t={};return function(e,i){var r=e+"|"+(i||"");return t[r]?t[r]:t[r]=new RegExp("<(?:\\w+:)?"+e+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+e+">",i||"")}}(),htmldecode=function(){var t=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map((function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]}));return function(e){for(var i=e.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,"\n").replace(/<[^>]*>/g,""),r=0;r<t.length;++r)i=i.replace(t[r][0],t[r][1]);return i}}(),vtregex=function(){var t={};return function(e){return void 0!==t[e]?t[e]:t[e]=new RegExp("<(?:vt:)?"+e+">([\\s\\S]*?)</(?:vt:)?"+e+">","g")}}(),vtvregex=/<\/?(?:vt:)?variant>/g,vtmregex=/<(?:vt:)([^>]*)>([\s\S]*)</;function parseVector(t,e){var i=parsexmltag(t),r=t.match(vtregex(i.baseType))||[],n=[];if(r.length!=i.size){if(e.WTF)throw new Error("unexpected vector length "+r.length+" != "+i.size);return n}return r.forEach((function(t){var e=t.replace(vtvregex,"").match(vtmregex);e&&n.push({v:utf8read(e[2]),t:e[1]})})),n}var wtregex=/(^\s|\s$|\n)/;function wxt_helper(t){return keys(t).map((function(e){return" "+e+'="'+t[e]+'"'})).join("")}function writextag(t,e,i){return"<"+t+(null!=i?wxt_helper(i):"")+(null!=e?(e.match(wtregex)?' xml:space="preserve"':"")+">"+e+"</"+t:"/")+">"}function xlml_normalize(t){if(has_buf&&Buffer.isBuffer(t))return t.toString("utf8");if("string"==typeof t)return t;if("undefined"!=typeof Uint8Array&&t instanceof Uint8Array)return utf8read(a2s(ab2a(t)));throw new Error("Bad input format: expected Buffer or string")}var xlmlregex=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/gm,XMLNS={CT:"http://schemas.openxmlformats.org/package/2006/content-types"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function read_double_le(t,e){for(var i=1-2*(t[e+7]>>>7),r=((127&t[e+7])<<4)+(t[e+6]>>>4&15),n=15&t[e+6],s=5;s>=0;--s)n=256*n+t[e+s];return 2047==r?0==n?i*(1/0):NaN:(0==r?r=-1022:(r-=1023,n+=Math.pow(2,52)),i*Math.pow(2,r-52)*n)}function write_double_le(t,e,i){var r=(e<0||1/e==-1/0?1:0)<<7,n=0,s=0,o=r?-e:e;isFinite(o)?0==o?n=s=0:(n=Math.floor(Math.log(o)/Math.LN2),s=o*Math.pow(2,52-n),n<=-1023&&(!isFinite(s)||s<Math.pow(2,52))?n=-1022:(s-=Math.pow(2,52),n+=1023)):(n=2047,s=isNaN(e)?26985:0);for(var a=0;a<=5;++a,s/=256)t[i+a]=255&s;t[i+6]=(15&n)<<4|15&s,t[i+7]=n>>4|r}var ___toBuffer=function(t){for(var e=[],i=0;i<t[0].length;++i)if(t[0][i])for(var r=0,n=t[0][i].length;r<n;r+=10240)e.push.apply(e,t[0][i].slice(r,r+10240));return e},__toBuffer=has_buf?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map((function(t){return Buffer.isBuffer(t)?t:Buffer_from(t)}))):___toBuffer(t)}:___toBuffer,___utf16le=function(t,e,i){for(var r=[],n=e;n<i;n+=2)r.push(String.fromCharCode(__readUInt16LE(t,n)));return r.join("").replace(chr0,"")},__utf16le=has_buf?function(t,e,i){return Buffer.isBuffer(t)?t.toString("utf16le",e,i).replace(chr0,""):___utf16le(t,e,i)}:___utf16le,___hexlify=function(t,e,i){for(var r=[],n=e;n<e+i;++n)r.push(("0"+t[n].toString(16)).slice(-2));return r.join("")},__hexlify=has_buf?function(t,e,i){return Buffer.isBuffer(t)?t.toString("hex",e,e+i):___hexlify(t,e,i)}:___hexlify,___utf8=function(t,e,i){for(var r=[],n=e;n<i;n++)r.push(String.fromCharCode(__readUInt8(t,n)));return r.join("")},__utf8=has_buf?function(t,e,i){return Buffer.isBuffer(t)?t.toString("utf8",e,i):___utf8(t,e,i)}:___utf8,___lpstr=function(t,e){var i=__readUInt32LE(t,e);return i>0?__utf8(t,e+4,e+4+i-1):""},__lpstr=___lpstr,___cpstr=function(t,e){var i=__readUInt32LE(t,e);return i>0?__utf8(t,e+4,e+4+i-1):""},__cpstr=___cpstr,___lpwstr=function(t,e){var i=2*__readUInt32LE(t,e);return i>0?__utf8(t,e+4,e+4+i-1):""},__lpwstr=___lpwstr,___lpp4=function(t,e){var i=__readUInt32LE(t,e);return i>0?__utf16le(t,e+4,e+4+i):""},__lpp4=___lpp4,___8lpp4=function(t,e){var i=__readUInt32LE(t,e);return i>0?__utf8(t,e+4,e+4+i):""},__8lpp4=___8lpp4,___double=function(t,e){return read_double_le(t,e)},__double=___double,is_buf=function(t){return Array.isArray(t)||"undefined"!=typeof Uint8Array&&t instanceof Uint8Array};has_buf&&(__lpstr=function(t,e){if(!Buffer.isBuffer(t))return ___lpstr(t,e);var i=t.readUInt32LE(e);return i>0?t.toString("utf8",e+4,e+4+i-1):""},__cpstr=function(t,e){if(!Buffer.isBuffer(t))return ___cpstr(t,e);var i=t.readUInt32LE(e);return i>0?t.toString("utf8",e+4,e+4+i-1):""},__lpwstr=function(t,e){if(!Buffer.isBuffer(t))return ___lpwstr(t,e);var i=2*t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+i-1)},__lpp4=function(t,e){if(!Buffer.isBuffer(t))return ___lpp4(t,e);var i=t.readUInt32LE(e);return t.toString("utf16le",e+4,e+4+i)},__8lpp4=function(t,e){if(!Buffer.isBuffer(t))return ___8lpp4(t,e);var i=t.readUInt32LE(e);return t.toString("utf8",e+4,e+4+i)},__double=function(t,e){return Buffer.isBuffer(t)?t.readDoubleLE(e):___double(t,e)},is_buf=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||"undefined"!=typeof Uint8Array&&t instanceof Uint8Array});var __readUInt8=function(t,e){return t[e]},__readUInt16LE=function(t,e){return 256*t[e+1]+t[e]},__readInt16LE=function(t,e){var i=256*t[e+1]+t[e];return i<32768?i:-1*(65535-i+1)},__readUInt32LE=function(t,e){return t[e+3]*(1<<24)+(t[e+2]<<16)+(t[e+1]<<8)+t[e]},__readInt32LE=function(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]},__readInt32BE=function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]};function ReadShift(t,e){var i,r,n,s,o,a,l="",c=[];switch(e){case"dbcs":if(a=this.l,has_buf&&Buffer.isBuffer(this))l=this.slice(this.l,this.l+2*t).toString("utf16le");else for(o=0;o<t;++o)l+=String.fromCharCode(__readUInt16LE(this,a)),a+=2;t*=2;break;case"utf8":l=__utf8(this,this.l,this.l+t);break;case"utf16le":t*=2,l=__utf16le(this,this.l,this.l+t);break;case"wstr":return ReadShift.call(this,t,"dbcs");case"lpstr-ansi":l=__lpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":l=__cpstr(this,this.l),t=4+__readUInt32LE(this,this.l);break;case"lpwstr":l=__lpwstr(this,this.l),t=4+2*__readUInt32LE(this,this.l);break;case"lpp4":t=4+__readUInt32LE(this,this.l),l=__lpp4(this,this.l),2&t&&(t+=2);break;case"8lpp4":t=4+__readUInt32LE(this,this.l),l=__8lpp4(this,this.l),3&t&&(t+=4-(3&t));break;case"cstr":for(t=0,l="";0!==(n=__readUInt8(this,this.l+t++));)c.push(_getchar(n));l=c.join("");break;case"_wstr":for(t=0,l="";0!==(n=__readUInt16LE(this,this.l+t));)c.push(_getchar(n)),t+=2;t+=2,l=c.join("");break;case"dbcs-cont":for(l="",a=this.l,o=0;o<t;++o){if(this.lens&&-1!==this.lens.indexOf(a))return n=__readUInt8(this,a),this.l=a+1,s=ReadShift.call(this,t-o,n?"dbcs-cont":"sbcs-cont"),c.join("")+s;c.push(_getchar(__readUInt16LE(this,a))),a+=2}l=c.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(l="",a=this.l,o=0;o!=t;++o){if(this.lens&&-1!==this.lens.indexOf(a))return n=__readUInt8(this,a),this.l=a+1,s=ReadShift.call(this,t-o,n?"dbcs-cont":"sbcs-cont"),c.join("")+s;c.push(_getchar(__readUInt8(this,a))),a+=1}l=c.join("");break;default:switch(t){case 1:return i=__readUInt8(this,this.l),this.l++,i;case 2:return i=("i"===e?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,i;case 4:case-4:return"i"!==e&&128&this[this.l+3]?(r=__readUInt32LE(this,this.l),this.l+=4,r):(i=(t>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,i);case 8:case-8:if("f"===e)return r=8==t?__double(this,this.l):__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;t=8;case 16:l=__hexlify(this,this.l,t)}}return this.l+=t,l}var __writeUInt32LE=function(t,e,i){t[i]=255&e,t[i+1]=e>>>8&255,t[i+2]=e>>>16&255,t[i+3]=e>>>24&255},__writeInt32LE=function(t,e,i){t[i]=255&e,t[i+1]=e>>8&255,t[i+2]=e>>16&255,t[i+3]=e>>24&255},__writeUInt16LE=function(t,e,i){t[i]=255&e,t[i+1]=e>>>8&255};function WriteShift(t,e,i){var r=0,n=0;if("dbcs"===i){for(n=0;n!=e.length;++n)__writeUInt16LE(this,e.charCodeAt(n),this.l+2*n);r=2*e.length}else if("sbcs"===i){for(e=e.replace(/[^\x00-\x7F]/g,"_"),n=0;n!=e.length;++n)this[this.l+n]=255&e.charCodeAt(n);r=e.length}else{if("hex"===i){for(;n<t;++n)this[this.l++]=parseInt(e.slice(2*n,2*n+2),16)||0;return this}if("utf16le"===i){var s=Math.min(this.l+t,this.length);for(n=0;n<Math.min(e.length,t);++n){var o=e.charCodeAt(n);this[this.l++]=255&o,this[this.l++]=o>>8}for(;this.l<s;)this[this.l++]=0;return this}switch(t){case 1:r=1,this[this.l]=255&e;break;case 2:r=2,this[this.l]=255&e,e>>>=8,this[this.l+1]=255&e;break;case 3:r=3,this[this.l]=255&e,e>>>=8,this[this.l+1]=255&e,e>>>=8,this[this.l+2]=255&e;break;case 4:r=4,__writeUInt32LE(this,e,this.l);break;case 8:if(r=8,"f"===i){write_double_le(this,e,this.l);break}case 16:break;case-4:r=4,__writeInt32LE(this,e,this.l)}}return this.l+=r,this}function CheckField(t,e){var i=__hexlify(this,this.l,t.length>>1);if(i!==t)throw new Error(e+"Expected "+t+" saw "+i);this.l+=t.length>>1}function prep_blob(t,e){t.l=e,t.read_shift=ReadShift,t.chk=CheckField,t.write_shift=WriteShift}function parsenoop(t,e){t.l+=e}function new_buf(t){var e=new_raw_buf(t);return prep_blob(e,0),e}function recordhopper(t,e,i){if(t){var r,n,s;prep_blob(t,t.l||0);for(var o=t.length,a=0,l=0;t.l<o;){128&(a=t.read_shift(1))&&(a=(127&a)+((127&t.read_shift(1))<<7));var c=XLSBRecordEnum[a]||XLSBRecordEnum[65535];for(s=127&(r=t.read_shift(1)),n=1;n<4&&128&r;++n)s+=(127&(r=t.read_shift(1)))<<7*n;l=t.l+s;var h=c.f&&c.f(t,s,i);if(t.l=l,e(h,c,a))return}}}function buf_array(){var t=[],e=has_buf?256:2048,i=function(t){var e=new_buf(t);return prep_blob(e,0),e},r=i(e),n=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&t.push(r),r=null)},s=function(t){return r&&t<r.length-r.l?r:(n(),r=i(Math.max(t+1,e)))};return{next:s,push:function(t){n(),null==(r=t).l&&(r.l=r.length),s(e)},end:function(){return n(),bconcat(t)},_bufs:t}}function shift_cell_xls(t,e,i){var r=dup(t);if(e.s?(r.cRel&&(r.c+=e.s.c),r.rRel&&(r.r+=e.s.r)):(r.cRel&&(r.c+=e.c),r.rRel&&(r.r+=e.r)),!i||i.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function shift_range_xls(t,e,i){var r=dup(t);return r.s=shift_cell_xls(r.s,e.s,i),r.e=shift_cell_xls(r.e,e.s,i),r}function encode_cell_xls(t,e){if(t.cRel&&t.c<0)for(t=dup(t);t.c<0;)t.c+=e>8?16384:256;if(t.rRel&&t.r<0)for(t=dup(t);t.r<0;)t.r+=e>8?1048576:e>5?65536:16384;var i=encode_cell(t);return t.cRel||null==t.cRel||(i=fix_col(i)),t.rRel||null==t.rRel||(i=fix_row(i)),i}function encode_range_xls(t,e){return 0!=t.s.r||t.s.rRel||t.e.r!=(e.biff>=12?1048575:e.biff>=8?65536:16384)||t.e.rRel?0!=t.s.c||t.s.cRel||t.e.c!=(e.biff>=12?16383:255)||t.e.cRel?encode_cell_xls(t.s,e.biff)+":"+encode_cell_xls(t.e,e.biff):(t.s.rRel?"":"$")+encode_row(t.s.r)+":"+(t.e.rRel?"":"$")+encode_row(t.e.r):(t.s.cRel?"":"$")+encode_col(t.s.c)+":"+(t.e.cRel?"":"$")+encode_col(t.e.c)}function decode_row(t){return parseInt(unfix_row(t),10)-1}function encode_row(t){return""+(t+1)}function fix_row(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(t){return t.replace(/\$(\d+)$/,"$1")}function decode_col(t){for(var e=unfix_col(t),i=0,r=0;r!==e.length;++r)i=26*i+e.charCodeAt(r)-64;return i-1}function encode_col(t){if(t<0)throw new Error("invalid column "+t);var e="";for(++t;t;t=Math.floor((t-1)/26))e=String.fromCharCode((t-1)%26+65)+e;return e}function fix_col(t){return t.replace(/^([A-Z])/,"$$$1")}function unfix_col(t){return t.replace(/^\$([A-Z])/,"$1")}function split_cell(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(t){for(var e=0,i=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=48&&n<=57?e=10*e+(n-48):n>=65&&n<=90&&(i=26*i+(n-64))}return{c:i-1,r:e-1}}function encode_cell(t){for(var e=t.c+1,i="";e;e=(e-1)/26|0)i=String.fromCharCode((e-1)%26+65)+i;return i+(t.r+1)}function decode_range(t){var e=t.indexOf(":");return-1==e?{s:decode_cell(t),e:decode_cell(t)}:{s:decode_cell(t.slice(0,e)),e:decode_cell(t.slice(e+1))}}function encode_range(t,e){return void 0===e||"number"==typeof e?encode_range(t.s,t.e):("string"!=typeof t&&(t=encode_cell(t)),"string"!=typeof e&&(e=encode_cell(e)),t==e?t:t+":"+e)}function safe_decode_range(t){var e={s:{c:0,r:0},e:{c:0,r:0}},i=0,r=0,n=0,s=t.length;for(i=0;r<s&&!((n=t.charCodeAt(r)-64)<1||n>26);++r)i=26*i+n;for(e.s.c=--i,i=0;r<s&&!((n=t.charCodeAt(r)-48)<0||n>9);++r)i=10*i+n;if(e.s.r=--i,r===s||10!=n)return e.e.c=e.s.c,e.e.r=e.s.r,e;for(++r,i=0;r!=s&&!((n=t.charCodeAt(r)-64)<1||n>26);++r)i=26*i+n;for(e.e.c=--i,i=0;r!=s&&!((n=t.charCodeAt(r)-48)<0||n>9);++r)i=10*i+n;return e.e.r=--i,e}function safe_format_cell(t,i){var r="d"==t.t&&i instanceof Date;if(null!=t.z)try{return t.w=SSF_format(t.z,r?datenum(i):i)}catch(e){}try{return t.w=SSF_format((t.XF||{}).numFmtId||(r?14:0),r?datenum(i):i)}catch(e){return""+i}}function format_cell(t,e,i){return null==t||null==t.t||"z"==t.t?"":void 0!==t.w?t.w:("d"==t.t&&!t.z&&i&&i.dateNF&&(t.z=i.dateNF),"e"==t.t?BErr[t.v]||t.v:safe_format_cell(t,null==e?t.v:e))}function sheet_to_workbook(t,e){var i=e&&e.sheet?e.sheet:"Sheet1",r={};return r[i]=t,{SheetNames:[i],Sheets:r}}function sheet_add_aoa(t,e,i){var r=i||{},n=t?Array.isArray(t):r.dense,s=t||(n?[]:{}),o=0,a=0;if(s&&null!=r.origin){if("number"==typeof r.origin)o=r.origin;else{var l="string"==typeof r.origin?decode_cell(r.origin):r.origin;o=l.r,a=l.c}s["!ref"]||(s["!ref"]="A1:A1")}var c={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(s["!ref"]){var h=safe_decode_range(s["!ref"]);c.s.c=h.s.c,c.s.r=h.s.r,c.e.c=Math.max(c.e.c,h.e.c),c.e.r=Math.max(c.e.r,h.e.r),-1==o&&(c.e.r=o=h.e.r+1)}for(var u=0;u!=e.length;++u)if(e[u]){if(!Array.isArray(e[u]))throw new Error("aoa_to_sheet expects an array of arrays");for(var d=0;d!=e[u].length;++d)if(void 0!==e[u][d]){var p={v:e[u][d]},f=o+u,_=a+d;if(c.s.r>f&&(c.s.r=f),c.s.c>_&&(c.s.c=_),c.e.r<f&&(c.e.r=f),c.e.c<_&&(c.e.c=_),!e[u][d]||"object"!=typeof e[u][d]||Array.isArray(e[u][d])||e[u][d]instanceof Date)if(Array.isArray(p.v)&&(p.f=e[u][d][1],p.v=p.v[0]),null===p.v)if(p.f)p.t="n";else if(r.nullError)p.t="e",p.v=0;else{if(!r.sheetStubs)continue;p.t="z"}else"number"==typeof p.v?p.t="n":"boolean"==typeof p.v?p.t="b":p.v instanceof Date?(p.z=r.dateNF||table_fmt[14],r.cellDates?(p.t="d",p.w=SSF_format(p.z,datenum(p.v))):(p.t="n",p.v=datenum(p.v),p.w=SSF_format(p.z,p.v))):p.t="s";else p=e[u][d];if(n)s[f]||(s[f]=[]),s[f][_]&&s[f][_].z&&(p.z=s[f][_].z),s[f][_]=p;else{var m=encode_cell({c:_,r:f});s[m]&&s[m].z&&(p.z=s[m].z),s[m]=p}}}return c.s.c<1e7&&(s["!ref"]=encode_range(c)),s}function aoa_to_sheet(t,e){return sheet_add_aoa(null,t,e)}function parse_Int32LE(t){return t.read_shift(4,"i")}function parse_XLWideString(t){var e=t.read_shift(4);return 0===e?"":t.read_shift(e,"dbcs")}function parse_StrRun(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function parse_RichStr(t,e){var i=t.l,r=t.read_shift(1),n=parse_XLWideString(t),s=[],o={t:n,h:n};if(1&r){for(var a=t.read_shift(4),l=0;l!=a;++l)s.push(parse_StrRun(t));o.r=s}else o.r=[{ich:0,ifnt:0}];return t.l=i+e,o}var parse_BrtCommentText=parse_RichStr;function parse_XLSBCell(t){var e=t.read_shift(4),i=t.read_shift(2);return i+=t.read_shift(1)<<16,t.l++,{c:e,iStyleRef:i}}function parse_XLSBShortCell(t){var e=t.read_shift(2);return e+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:e}}var parse_XLSBCodeName=parse_XLWideString;function parse_XLNullableWideString(t){var e=t.read_shift(4);return 0===e||4294967295===e?"":t.read_shift(e,"dbcs")}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString;function parse_RkNumber(t){var e=t.slice(t.l,t.l+4),i=1&e[0],r=2&e[0];t.l+=4;var n=0===r?__double([0,0,0,0,252&e[0],e[1],e[2],e[3]],0):__readInt32LE(e,0)>>2;return i?n/100:n}function parse_RfX(t){var e={s:{},e:{}};return e.s.r=t.read_shift(4),e.e.r=t.read_shift(4),e.s.c=t.read_shift(4),e.e.c=t.read_shift(4),e}var parse_UncheckedRfX=parse_RfX;function parse_Xnum(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function parse_BrtColor(t){var e={},i=t.read_shift(1)>>>1,r=t.read_shift(1),n=t.read_shift(2,"i"),s=t.read_shift(1),o=t.read_shift(1),a=t.read_shift(1);switch(t.l++,i){case 0:e.auto=1;break;case 1:e.index=r;var l=XLSIcv[r];l&&(e.rgb=rgb2Hex(l));break;case 2:e.rgb=rgb2Hex([s,o,a]);break;case 3:e.theme=r}return 0!=n&&(e.tint=n>0?n/32767:n/32768),e}function parse_FontFlags(t){var e=t.read_shift(1);return t.l++,{fBold:1&e,fItalic:2&e,fUnderline:4&e,fStrikeout:8&e,fOutline:16&e,fShadow:32&e,fCondense:64&e,fExtend:128&e}}function parse_ClipboardFormatOrString(t,e){var i=t.read_shift(4);switch(i){case 0:return"";case 4294967295:case 4294967294:return{2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"}[t.read_shift(4)]||""}if(i>400)throw new Error("Unsupported Clipboard: "+i.toString(16));return t.l-=4,t.read_shift(0,1==e?"lpstr":"lpwstr")}function parse_ClipboardFormatOrAnsiString(t){return parse_ClipboardFormatOrString(t,1)}function parse_ClipboardFormatOrUnicodeString(t){return parse_ClipboardFormatOrString(t,2)}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_VARIANT=12,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,VT_USTR=81,VT_CUSTOM=[VT_STRING,VT_USTR],DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},CountryEnum={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},XLSFillPattern=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function rgbify(t){return t.map((function(t){return[t>>16&255,t>>8&255,255&t]}))}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RBErr={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function parse_ct(t){var e=new_ct();if(!t||!t.match)return e;var i={};if((t.match(tagregex)||[]).forEach((function(t){var r=parsexmltag(t);switch(r[0].replace(nsregex,"<")){case"<?xml":break;case"<Types":e.xmlns=r["xmlns"+(r[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":i[r.Extension]=r.ContentType;break;case"<Override":void 0!==e[ct2type[r.ContentType]]&&e[ct2type[r.ContentType]].push(r.PartName)}})),e.xmlns!==XMLNS.CT)throw new Error("Unknown Namespace: "+e.xmlns);return e.calcchain=e.calcchains.length>0?e.calcchains[0]:"",e.sst=e.strs.length>0?e.strs[0]:"",e.style=e.styles.length>0?e.styles[0]:"",e.defaults=i,delete e.calcchains,e}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(t){var e=t.lastIndexOf("/");return t.slice(0,e+1)+"_rels/"+t.slice(e+1)+".rels"}function parse_rels(t,e){var i={"!id":{}};if(!t)return i;"/"!==e.charAt(0)&&(e="/"+e);var r={};return(t.match(tagregex)||[]).forEach((function(t){var n=parsexmltag(t);if("<Relationship"===n[0]){var s={};s.Type=n.Type,s.Target=n.Target,s.Id=n.Id,n.TargetMode&&(s.TargetMode=n.TargetMode);var o="External"===n.TargetMode?n.Target:resolve_path(n.Target,e);i[o]=s,r[n.Id]=s}})),i["!id"]=r,i}var CT_ODS="application/vnd.oasis.opendocument.spreadsheet";function parse_manifest(t,e){for(var i,r,n=xlml_normalize(t);i=xlmlregex.exec(n);)switch(i[3]){case"manifest":break;case"file-entry":if("/"==(r=parsexmltag(i[0],!1)).path&&r.type!==CT_ODS)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(e&&e.WTF)throw i}}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],CORE_PROPS_REGEX=function(){for(var t=new Array(CORE_PROPS.length),e=0;e<CORE_PROPS.length;++e){var i=CORE_PROPS[e],r="(?:"+i[0].slice(0,i[0].indexOf(":"))+":)"+i[0].slice(i[0].indexOf(":")+1);t[e]=new RegExp("<"+r+"[^>]*>([\\s\\S]*?)</"+r+">")}return t}();function parse_core_props(t){var e={};t=utf8read(t);for(var i=0;i<CORE_PROPS.length;++i){var r=CORE_PROPS[i],n=t.match(CORE_PROPS_REGEX[i]);null!=n&&n.length>0&&(e[r[1]]=unescapexml(n[1])),"date"===r[2]&&e[r[1]]&&(e[r[1]]=parseDate(e[r[1]]))}return e}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function load_props_pairs(t,e,i,r){var n=[];if("string"==typeof t)n=parseVector(t,r);else for(var s=0;s<t.length;++s)n=n.concat(t[s].map((function(t){return{v:t}})));var o="string"==typeof e?parseVector(e,r).map((function(t){return t.v})):e,a=0,l=0;if(o.length>0)for(var c=0;c!==n.length;c+=2){switch(l=+n[c+1].v,n[c].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":i.Worksheets=l,i.SheetNames=o.slice(a,a+l);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":i.NamedRanges=l,i.DefinedNames=o.slice(a,a+l);break;case"Charts":case"Diagramme":i.Chartsheets=l,i.ChartNames=o.slice(a,a+l)}a+=l}}function parse_ext_props(t,e,i){var r={};return e||(e={}),t=utf8read(t),EXT_PROPS.forEach((function(i){var n=(t.match(matchtag(i[0]))||[])[1];switch(i[2]){case"string":n&&(e[i[1]]=unescapexml(n));break;case"bool":e[i[1]]="true"===n;break;case"raw":var s=t.match(new RegExp("<"+i[0]+"[^>]*>([\\s\\S]*?)</"+i[0]+">"));s&&s.length>0&&(r[i[1]]=s[1])}})),r.HeadingPairs&&r.TitlesOfParts&&load_props_pairs(r.HeadingPairs,r.TitlesOfParts,e,i),e}var custregex=/<[^>]+>[^<]*/g;function parse_cust_props(t,e){var i={},r="",n=t.match(custregex);if(n)for(var s=0;s!=n.length;++s){var o=n[s],a=parsexmltag(o);switch(a[0]){case"<?xml":case"<Properties":break;case"<property":r=unescapexml(a.name);break;case"</property>":r=null;break;default:if(0===o.indexOf("<vt:")){var l=o.split(">"),c=l[0].slice(4),h=l[1];switch(c){case"lpstr":case"bstr":case"lpwstr":case"cy":case"error":i[r]=unescapexml(h);break;case"bool":i[r]=parsexmlbool(h);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":i[r]=parseInt(h,10);break;case"r4":case"r8":case"decimal":i[r]=parseFloat(h);break;case"filetime":case"date":i[r]=parseDate(h);break;default:if("/"==c.slice(-1))break;e.WTF&&"undefined"!=typeof console&&console.warn("Unexpected",o,c,l)}}else if("</"===o.slice(0,2));else if(e.WTF)throw new Error(o)}}return i}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},evert_XLMLDPM;function xlml_set_prop(t,e,i){evert_XLMLDPM||(evert_XLMLDPM=evert(XLMLDocPropsMap)),t[e=evert_XLMLDPM[e]||e]=i}function parse_FILETIME(t){var e=t.read_shift(4),i=t.read_shift(4);return new Date(1e3*(i/1e7*Math.pow(2,32)+e/1e7-11644473600)).toISOString().replace(/\.000/,"")}function parse_lpstr(t,e,i){var r=t.l,n=t.read_shift(0,"lpstr-cp");if(i)for(;t.l-r&3;)++t.l;return n}function parse_lpwstr(t,e,i){return t.read_shift(0,"lpwstr")}function parse_VtStringBase(t,e,i){return 31===e?parse_lpwstr(t):parse_lpstr(t,e,i)}function parse_VtString(t,e,i){return parse_VtStringBase(t,e,!1===i?0:4)}function parse_VtUnalignedString(t,e){if(!e)throw new Error("VtUnalignedString must have positive length");return parse_VtStringBase(t,e,0)}function parse_VtVecLpwstrValue(t){for(var e=t.read_shift(4),i=[],r=0;r!=e;++r){var n=t.l;i[r]=t.read_shift(0,"lpwstr").replace(chr0,""),t.l-n&2&&(t.l+=2)}return i}function parse_VtVecUnalignedLpstrValue(t){for(var e=t.read_shift(4),i=[],r=0;r!=e;++r)i[r]=t.read_shift(0,"lpstr-cp").replace(chr0,"");return i}function parse_VtHeadingPair(t){var e=t.l,i=parse_TypedPropertyValue(t,VT_USTR);return 0==t[t.l]&&0==t[t.l+1]&&t.l-e&2&&(t.l+=2),[i,parse_TypedPropertyValue(t,VT_I4)]}function parse_VtVecHeadingPairValue(t){for(var e=t.read_shift(4),i=[],r=0;r<e/2;++r)i.push(parse_VtHeadingPair(t));return i}function parse_dictionary(t,e){for(var i=t.read_shift(4),r={},n=0;n!=i;++n){var s=t.read_shift(4),o=t.read_shift(4);r[s]=t.read_shift(o,1200===e?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!"),1200===e&&o%2&&(t.l+=2)}return 3&t.l&&(t.l=t.l>>3<<2),r}function parse_BLOB(t){var e=t.read_shift(4),i=t.slice(t.l,t.l+e);return t.l+=e,(3&e)>0&&(t.l+=4-(3&e)&3),i}function parse_ClipboardData(t){var e={};return e.Size=t.read_shift(4),t.l+=e.Size+3-(e.Size-1)%4,e}function parse_TypedPropertyValue(t,e,i){var r,n=t.read_shift(2),s=i||{};if(t.l+=2,e!==VT_VARIANT&&n!==e&&-1===VT_CUSTOM.indexOf(e)&&(4126!=(65534&e)||4126!=(65534&n)))throw new Error("Expected type "+e+" saw "+n);switch(e===VT_VARIANT?n:e){case 2:return r=t.read_shift(2,"i"),s.raw||(t.l+=2),r;case 3:return r=t.read_shift(4,"i");case 11:return 0!==t.read_shift(4);case 19:return r=t.read_shift(4);case 30:return parse_lpstr(t,n,4).replace(chr0,"");case 31:return parse_lpwstr(t);case 64:return parse_FILETIME(t);case 65:return parse_BLOB(t);case 71:return parse_ClipboardData(t);case 80:return parse_VtString(t,n,!s.raw).replace(chr0,"");case 81:return parse_VtUnalignedString(t,n).replace(chr0,"");case 4108:return parse_VtVecHeadingPairValue(t);case 4126:case 4127:return 4127==n?parse_VtVecLpwstrValue(t):parse_VtVecUnalignedLpstrValue(t);default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+n)}}function parse_PropertySet(t,e){var i=t.l,r=t.read_shift(4),n=t.read_shift(4),s=[],o=0,a=0,l=-1,c={};for(o=0;o!=n;++o){var h=t.read_shift(4),u=t.read_shift(4);s[o]=[h,u+i]}s.sort((function(t,e){return t[1]-e[1]}));var d={};for(o=0;o!=n;++o){if(t.l!==s[o][1]){var p=!0;if(o>0&&e)switch(e[s[o-1][0]].t){case 2:t.l+2===s[o][1]&&(t.l+=2,p=!1);break;case 80:case 4108:t.l<=s[o][1]&&(t.l=s[o][1],p=!1)}if((!e||0==o)&&t.l<=s[o][1]&&(p=!1,t.l=s[o][1]),p)throw new Error("Read Error: Expected address "+s[o][1]+" at "+t.l+" :"+o)}if(e){var f=e[s[o][0]];if(d[f.n]=parse_TypedPropertyValue(t,f.t,{raw:!0}),"version"===f.p&&(d[f.n]=String(d[f.n]>>16)+"."+("0000"+String(65535&d[f.n])).slice(-4)),"CodePage"==f.n)switch(d[f.n]){case 0:d[f.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:set_cp(a=d[f.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+d[f.n])}}else if(1===s[o][0]){if(a=d.CodePage=parse_TypedPropertyValue(t,VT_I2),set_cp(a),-1!==l){var _=t.l;t.l=s[l][1],c=parse_dictionary(t,a),t.l=_}}else if(0===s[o][0]){if(0===a){l=o,t.l=s[o+1][1];continue}c=parse_dictionary(t,a)}else{var m,g=c[s[o][0]];switch(t[t.l]){case 65:t.l+=4,m=parse_BLOB(t);break;case 30:case 31:t.l+=4,m=parse_VtString(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 3:t.l+=4,m=t.read_shift(4,"i");break;case 19:t.l+=4,m=t.read_shift(4);break;case 5:t.l+=4,m=t.read_shift(8,"f");break;case 11:t.l+=4,m=parsebool(t,4);break;case 64:t.l+=4,m=parseDate(parse_FILETIME(t));break;default:throw new Error("unparsed value: "+t[t.l])}d[g]=m}}return t.l=i+r,d}function parse_PropertySetStream(t,i,r){var n=t.content;if(!n)return{};prep_blob(n,0);var s,o,a,l,c=0;n.chk("feff","Byte Order: "),n.read_shift(2);var h=n.read_shift(4),u=n.read_shift(16);if(u!==CFB.utils.consts.HEADER_CLSID&&u!==r)throw new Error("Bad PropertySet CLSID "+u);if(1!==(s=n.read_shift(4))&&2!==s)throw new Error("Unrecognized #Sets: "+s);if(o=n.read_shift(16),l=n.read_shift(4),1===s&&l!==n.l)throw new Error("Length mismatch: "+l+" !== "+n.l);2===s&&(a=n.read_shift(16),c=n.read_shift(4));var d,p=parse_PropertySet(n,i),f={SystemIdentifier:h};for(var _ in p)f[_]=p[_];if(f.FMTID=o,1===s)return f;if(c-n.l==2&&(n.l+=2),n.l!==c)throw new Error("Length mismatch 2: "+n.l+" !== "+c);try{d=parse_PropertySet(n,null)}catch(e){}for(_ in d)f[_]=d[_];return f.FMTID=[o,a],f}function parsenoop2(t,e){return t.read_shift(e),null}function parslurp(t,e,i){for(var r=[],n=t.l+e;t.l<n;)r.push(i(t,n-t.l));if(n!==t.l)throw new Error("Slurp error");return r}function parsebool(t,e){return 1===t.read_shift(e)}function parseuint16(t){return t.read_shift(2,"u")}function parseuint16a(t,e){return parslurp(t,e,parseuint16)}function parse_Bes(t){var e=t.read_shift(1);return 1===t.read_shift(1)?e:1===e}function parse_ShortXLUnicodeString(t,e,i){var r=t.read_shift(i&&i.biff>=12?2:1),n="sbcs-cont";(i&&i.biff,i&&8!=i.biff)?12==i.biff&&(n="wstr"):t.read_shift(1)&&(n="dbcs-cont");return i.biff>=2&&i.biff<=5&&(n="cpstr"),r?t.read_shift(r,n):""}function parse_XLUnicodeRichExtendedString(t){var e,i=t.read_shift(2),r=t.read_shift(1),n=4&r,s=8&r,o=1+(1&r),a=0,l={};s&&(a=t.read_shift(2)),n&&(e=t.read_shift(4));var c=2==o?"dbcs-cont":"sbcs-cont",h=0===i?"":t.read_shift(i,c);return s&&(t.l+=4*a),n&&(t.l+=e),l.t=h,s||(l.raw="<t>"+l.t+"</t>",l.r=l.t),l}function parse_XLUnicodeStringNoCch(t,e,i){if(i){if(i.biff>=2&&i.biff<=5)return t.read_shift(e,"cpstr");if(i.biff>=12)return t.read_shift(e,"dbcs-cont")}return 0===t.read_shift(1)?t.read_shift(e,"sbcs-cont"):t.read_shift(e,"dbcs-cont")}function parse_XLUnicodeString(t,e,i){var r=t.read_shift(i&&2==i.biff?1:2);return 0===r?(t.l++,""):parse_XLUnicodeStringNoCch(t,r,i)}function parse_XLUnicodeString2(t,e,i){if(i.biff>5)return parse_XLUnicodeString(t,e,i);var r=t.read_shift(1);return 0===r?(t.l++,""):t.read_shift(r,i.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function parse_ControlInfo(t){var e=t.read_shift(1);t.l++;var i=t.read_shift(2);return t.l+=2,[e,i]}function parse_URLMoniker(t){var e=t.read_shift(4),i=t.l,r=!1;e>24&&(t.l+=e-24,"795881f43b1d7f48af2c825dc4852763"===t.read_shift(16)&&(r=!0),t.l=i);var n=t.read_shift((r?e-24:e)>>1,"utf16le").replace(chr0,"");return r&&(t.l+=24),n}function parse_FileMoniker(t){for(var e=t.read_shift(2),i="";e-- >0;)i+="../";var r=t.read_shift(0,"lpstr-ansi");if(t.l+=2,57005!=t.read_shift(2))throw new Error("Bad FileMoniker");if(0===t.read_shift(4))return i+r.replace(/\\/g,"/");var n=t.read_shift(4);if(3!=t.read_shift(2))throw new Error("Bad FileMoniker");return i+t.read_shift(n>>1,"utf16le").replace(chr0,"")}function parse_HyperlinkMoniker(t,e){var i=t.read_shift(16);switch(i){case"e0c9ea79f9bace118c8200aa004ba90b":return parse_URLMoniker(t);case"0303000000000000c000000000000046":return parse_FileMoniker(t);default:throw new Error("Unsupported Moniker "+i)}}function parse_HyperlinkString(t){var e=t.read_shift(4);return e>0?t.read_shift(e,"utf16le").replace(chr0,""):""}function parse_Hyperlink(t,e){var i=t.l+e,r=t.read_shift(4);if(2!==r)throw new Error("Unrecognized streamVersion: "+r);var n=t.read_shift(2);t.l+=2;var s,o,a,l,c,h,u="";16&n&&(s=parse_HyperlinkString(t,i-t.l)),128&n&&(o=parse_HyperlinkString(t,i-t.l)),257&~n||(a=parse_HyperlinkString(t,i-t.l)),1==(257&n)&&(l=parse_HyperlinkMoniker(t,i-t.l)),8&n&&(u=parse_HyperlinkString(t,i-t.l)),32&n&&(c=t.read_shift(16)),64&n&&(h=parse_FILETIME(t)),t.l=i;var d=o||a||l||"";d&&u&&(d+="#"+u),d||(d="#"+u),2&n&&"/"==d.charAt(0)&&"/"!=d.charAt(1)&&(d="file://"+d);var p={Target:d};return c&&(p.guid=c),h&&(p.time=h),s&&(p.Tooltip=s),p}function parse_LongRGBA(t){return[t.read_shift(1),t.read_shift(1),t.read_shift(1),t.read_shift(1)]}function parse_LongRGB(t,e){var i=parse_LongRGBA(t);return i[3]=0,i}function parse_XLSCell(t){return{r:t.read_shift(2),c:t.read_shift(2),ixfe:t.read_shift(2)}}function parse_frtHeader(t){var e=t.read_shift(2),i=t.read_shift(2);return t.l+=8,{type:e,flags:i}}function parse_OptXLUnicodeString(t,e,i){return 0===e?"":parse_XLUnicodeString2(t,e,i)}function parse_XTI(t,e,i){var r=i.biff>8?4:2;return[t.read_shift(r),t.read_shift(r,"i"),t.read_shift(r,"i")]}function parse_RkRec(t){return[t.read_shift(2),parse_RkNumber(t)]}function parse_AddinUdf(t,e,i){t.l+=4,e-=4;var r=t.l+e,n=parse_ShortXLUnicodeString(t,e,i),s=t.read_shift(2);if(s!==(r-=t.l))throw new Error("Malformed AddinUdf: padding = "+r+" != "+s);return t.l+=s,n}function parse_Ref8U(t){var e=t.read_shift(2),i=t.read_shift(2);return{s:{c:t.read_shift(2),r:e},e:{c:t.read_shift(2),r:i}}}function parse_RefU(t){var e=t.read_shift(2),i=t.read_shift(2);return{s:{c:t.read_shift(1),r:e},e:{c:t.read_shift(1),r:i}}}var parse_Ref=parse_RefU;function parse_FtCmo(t){t.l+=4;var e=t.read_shift(2),i=t.read_shift(2),r=t.read_shift(2);return t.l+=12,[i,e,r]}function parse_FtNts(t){var e={};return t.l+=4,t.l+=16,e.fSharedNote=t.read_shift(2),t.l+=4,e}function parse_FtCf(t){return t.l+=4,t.cf=t.read_shift(2),{}}function parse_FtSkip(t){t.l+=2,t.l+=t.read_shift(2)}var FtTab={0:parse_FtSkip,4:parse_FtSkip,5:parse_FtSkip,6:parse_FtSkip,7:parse_FtCf,8:parse_FtSkip,9:parse_FtSkip,10:parse_FtSkip,11:parse_FtSkip,12:parse_FtSkip,13:parse_FtNts,14:parse_FtSkip,15:parse_FtSkip,16:parse_FtSkip,17:parse_FtSkip,18:parse_FtSkip,19:parse_FtSkip,20:parse_FtSkip,21:parse_FtCmo};function parse_FtArray(t,i){for(var r=t.l+i,n=[];t.l<r;){var s=t.read_shift(2);t.l-=2;try{n.push(FtTab[s](t,r-t.l))}catch(e){return t.l=r,n}}return t.l!=r&&(t.l=r),n}function parse_BOF(t,e){var i={BIFFVer:0,dt:0};switch(i.BIFFVer=t.read_shift(2),(e-=2)>=2&&(i.dt=t.read_shift(2),t.l-=2),i.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(e>6)throw new Error("Unexpected BIFF Ver "+i.BIFFVer)}return t.read_shift(e),i}function parse_InterfaceHdr(t,e){return 0===e||t.read_shift(2),1200}function parse_WriteAccess(t,e,i){if(i.enc)return t.l+=e,"";var r=t.l,n=parse_XLUnicodeString2(t,0,i);return t.read_shift(e+r-t.l),n}function parse_WsBool(t,e,i){var r=i&&8==i.biff||2==e?t.read_shift(2):(t.l+=e,0);return{fDialog:16&r,fBelow:64&r,fRight:128&r}}function parse_BoundSheet8(t,e,i){var r=t.read_shift(4),n=3&t.read_shift(1),s=t.read_shift(1);switch(s){case 0:s="Worksheet";break;case 1:s="Macrosheet";break;case 2:s="Chartsheet";break;case 6:s="VBAModule"}var o=parse_ShortXLUnicodeString(t,0,i);return 0===o.length&&(o="Sheet1"),{pos:r,hs:n,dt:s,name:o}}function parse_SST(t,e){for(var i=t.l+e,r=t.read_shift(4),n=t.read_shift(4),s=[],o=0;o!=n&&t.l<i;++o)s.push(parse_XLUnicodeRichExtendedString(t));return s.Count=r,s.Unique=n,s}function parse_ExtSST(t,e){var i={};return i.dsst=t.read_shift(2),t.l+=e-2,i}function parse_Row(t){var e={};e.r=t.read_shift(2),e.c=t.read_shift(2),e.cnt=t.read_shift(2)-e.c;var i=t.read_shift(2);t.l+=4;var r=t.read_shift(1);return t.l+=3,7&r&&(e.level=7&r),32&r&&(e.hidden=!0),64&r&&(e.hpt=i/20),e}function parse_ForceFullCalculation(t){var e=parse_frtHeader(t);if(2211!=e.type)throw new Error("Invalid Future Record "+e.type);return 0!==t.read_shift(4)}function parse_RecalcId(t){return t.read_shift(2),t.read_shift(4)}function parse_DefaultRowHeight(t,e,i){var r=0;i&&2==i.biff||(r=t.read_shift(2));var n=t.read_shift(2);return i&&2==i.biff&&(r=1-(n>>15),n&=32767),[{Unsynced:1&r,DyZero:(2&r)>>1,ExAsc:(4&r)>>2,ExDsc:(8&r)>>3},n]}function parse_Window1(t){return{Pos:[t.read_shift(2),t.read_shift(2)],Dim:[t.read_shift(2),t.read_shift(2)],Flags:t.read_shift(2),CurTab:t.read_shift(2),FirstTab:t.read_shift(2),Selected:t.read_shift(2),TabRatio:t.read_shift(2)}}function parse_Window2(t,e,i){return i&&i.biff>=2&&i.biff<5?{}:{RTL:64&t.read_shift(2)}}function parse_Pane(){}function parse_Font(t,e,i){var r={dyHeight:t.read_shift(2),fl:t.read_shift(2)};switch(i&&i.biff||8){case 2:break;case 3:case 4:t.l+=2;break;default:t.l+=10}return r.name=parse_ShortXLUnicodeString(t,0,i),r}function parse_LabelSst(t){var e=parse_XLSCell(t);return e.isst=t.read_shift(4),e}function parse_Label(t,e,i){i.biffguess&&2==i.biff&&(i.biff=5);var r=t.l+e,n=parse_XLSCell(t);2==i.biff&&t.l++;var s=parse_XLUnicodeString(t,r-t.l,i);return n.val=s,n}function parse_Format(t,e,i){return[t.read_shift(2),parse_XLUnicodeString2(t,0,i)]}var parse_BIFF2Format=parse_XLUnicodeString2;function parse_Dimensions(t,e,i){var r=t.l+e,n=8!=i.biff&&i.biff?2:4,s=t.read_shift(n),o=t.read_shift(n),a=t.read_shift(2),l=t.read_shift(2);return t.l=r,{s:{r:s,c:a},e:{r:o,c:l}}}function parse_RK(t){var e=t.read_shift(2),i=t.read_shift(2),r=parse_RkRec(t);return{r:e,c:i,ixfe:r[0],rknum:r[1]}}function parse_MulRk(t,e){for(var i=t.l+e-2,r=t.read_shift(2),n=t.read_shift(2),s=[];t.l<i;)s.push(parse_RkRec(t));if(t.l!==i)throw new Error("MulRK read error");var o=t.read_shift(2);if(s.length!=o-n+1)throw new Error("MulRK length mismatch");return{r:r,c:n,C:o,rkrec:s}}function parse_MulBlank(t,e){for(var i=t.l+e-2,r=t.read_shift(2),n=t.read_shift(2),s=[];t.l<i;)s.push(t.read_shift(2));if(t.l!==i)throw new Error("MulBlank read error");var o=t.read_shift(2);if(s.length!=o-n+1)throw new Error("MulBlank length mismatch");return{r:r,c:n,C:o,ixfe:s}}function parse_CellStyleXF(t,e,i,r){var n={},s=t.read_shift(4),o=t.read_shift(4),a=t.read_shift(4),l=t.read_shift(2);return n.patternType=XLSFillPattern[a>>26],r.cellStyles?(n.alc=7&s,n.fWrap=s>>3&1,n.alcV=s>>4&7,n.fJustLast=s>>7&1,n.trot=s>>8&255,n.cIndent=s>>16&15,n.fShrinkToFit=s>>20&1,n.iReadOrder=s>>22&2,n.fAtrNum=s>>26&1,n.fAtrFnt=s>>27&1,n.fAtrAlc=s>>28&1,n.fAtrBdr=s>>29&1,n.fAtrPat=s>>30&1,n.fAtrProt=s>>31&1,n.dgLeft=15&o,n.dgRight=o>>4&15,n.dgTop=o>>8&15,n.dgBottom=o>>12&15,n.icvLeft=o>>16&127,n.icvRight=o>>23&127,n.grbitDiag=o>>30&3,n.icvTop=127&a,n.icvBottom=a>>7&127,n.icvDiag=a>>14&127,n.dgDiag=a>>21&15,n.icvFore=127&l,n.icvBack=l>>7&127,n.fsxButton=l>>14&1,n):n}function parse_XF(t,e,i){var r={};return r.ifnt=t.read_shift(2),r.numFmtId=t.read_shift(2),r.flags=t.read_shift(2),r.fStyle=r.flags>>2&1,e-=6,r.data=parse_CellStyleXF(t,e,r.fStyle,i),r}function parse_Guts(t){t.l+=4;var e=[t.read_shift(2),t.read_shift(2)];if(0!==e[0]&&e[0]--,0!==e[1]&&e[1]--,e[0]>7||e[1]>7)throw new Error("Bad Gutters: "+e.join("|"));return e}function parse_BoolErr(t,e,i){var r=parse_XLSCell(t);2!=i.biff&&9!=e||++t.l;var n=parse_Bes(t);return r.val=n,r.t=!0===n||!1===n?"b":"e",r}function parse_Number(t,e,i){i.biffguess&&2==i.biff&&(i.biff=5);var r=parse_XLSCell(t),n=parse_Xnum(t);return r.val=n,r}var parse_XLHeaderFooter=parse_OptXLUnicodeString;function parse_SupBook(t,e,i){var r=t.l+e,n=t.read_shift(2),s=t.read_shift(2);if(i.sbcch=s,1025==s||14849==s)return[s,n];if(s<1||s>255)throw new Error("Unexpected SupBook type: "+s);for(var o=parse_XLUnicodeStringNoCch(t,s),a=[];r>t.l;)a.push(parse_XLUnicodeString(t));return[s,n,o,a]}function parse_ExternName(t,e,i){var r,n=t.read_shift(2),s={fBuiltIn:1&n,fWantAdvise:n>>>1&1,fWantPict:n>>>2&1,fOle:n>>>3&1,fOleLink:n>>>4&1,cf:n>>>5&1023,fIcon:n>>>15&1};return 14849===i.sbcch&&(r=parse_AddinUdf(t,e-2,i)),s.body=r||t.read_shift(e-2),"string"==typeof r&&(s.Name=r),s}var XLSLblBuiltIn=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function parse_Lbl(t,e,i){var r=t.l+e,n=t.read_shift(2),s=t.read_shift(1),o=t.read_shift(1),a=t.read_shift(i&&2==i.biff?1:2),l=0;(!i||i.biff>=5)&&(5!=i.biff&&(t.l+=2),l=t.read_shift(2),5==i.biff&&(t.l+=2),t.l+=4);var c=parse_XLUnicodeStringNoCch(t,o,i);32&n&&(c=XLSLblBuiltIn[c.charCodeAt(0)]);var h=r-t.l;return i&&2==i.biff&&--h,{chKey:s,Name:c,itab:l,rgce:r!=t.l&&0!==a&&h>0?parse_NameParsedFormula(t,h,i,a):[]}}function parse_ExternSheet(t,e,i){if(i.biff<8)return parse_BIFF5ExternSheet(t,e,i);for(var r=[],n=t.l+e,s=t.read_shift(i.biff>8?4:2);0!=s--;)r.push(parse_XTI(t,i.biff>8?12:6,i));if(t.l!=n)throw new Error("Bad ExternSheet: "+t.l+" != "+n);return r}function parse_BIFF5ExternSheet(t,e,i){3==t[t.l+1]&&t[t.l]++;var r=parse_ShortXLUnicodeString(t,e,i);return 3==r.charCodeAt(0)?r.slice(1):r}function parse_NameCmt(t,e,i){if(!(i.biff<8)){var r=t.read_shift(2),n=t.read_shift(2);return[parse_XLUnicodeStringNoCch(t,r,i),parse_XLUnicodeStringNoCch(t,n,i)]}t.l+=e}function parse_ShrFmla(t,e,i){var r=parse_RefU(t);t.l++;var n=t.read_shift(1);return[parse_SharedParsedFormula(t,e-=8,i),n,r]}function parse_Array(t,e,i){var r=parse_Ref(t);switch(i.biff){case 2:t.l++,e-=7;break;case 3:case 4:t.l+=2,e-=8;break;default:t.l+=6,e-=12}return[r,parse_ArrayParsedFormula(t,e,i)]}function parse_MTRSettings(t){return[0!==t.read_shift(4),0!==t.read_shift(4),t.read_shift(4)]}function parse_NoteSh(t,e,i){if(!(i.biff<8)){var r=t.read_shift(2),n=t.read_shift(2),s=t.read_shift(2),o=t.read_shift(2),a=parse_XLUnicodeString2(t,0,i);return i.biff<8&&t.read_shift(1),[{r:r,c:n},a,o,s]}}function parse_Note(t,e,i){return parse_NoteSh(t,e,i)}function parse_MergeCells(t,e){for(var i=[],r=t.read_shift(2);r--;)i.push(parse_Ref8U(t));return i}function parse_Obj(t,e,i){if(i&&i.biff<8)return parse_BIFF5Obj(t,e,i);var r=parse_FtCmo(t);return{cmo:r,ft:parse_FtArray(t,e-22,r[1])}}var parse_BIFF5OT={8:function(t,e){var i=t.l+e;t.l+=10;var r=t.read_shift(2);t.l+=4,t.l+=2,t.l+=2,t.l+=2,t.l+=4;var n=t.read_shift(1);return t.l+=n,t.l=i,{fmt:r}}};function parse_BIFF5Obj(t,e,i){t.l+=4;var r=t.read_shift(2),n=t.read_shift(2),s=t.read_shift(2);t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=6,e-=36;var o=[];return o.push((parse_BIFF5OT[r]||parsenoop)(t,e,i)),{cmo:[n,r,s],ft:o}}function parse_TxO(t,i,r){var n=t.l,s="";try{t.l+=4;var o=(r.lastobj||{cmo:[0,0]}).cmo[1];-1==[0,5,7,11,12,14].indexOf(o)?t.l+=6:parse_ControlInfo(t,6,r);var a=t.read_shift(2);t.read_shift(2),parseuint16(t,2);var l=t.read_shift(2);t.l+=l;for(var c=1;c<t.lens.length-1;++c){if(t.l-n!=t.lens[c])throw new Error("TxO: bad continue record");var h=t[t.l];if((s+=parse_XLUnicodeStringNoCch(t,t.lens[c+1]-t.lens[c]-1)).length>=(h?a:2*a))break}if(s.length!==a&&s.length!==2*a)throw new Error("cchText: "+a+" != "+s.length);return t.l=n+i,{t:s}}catch(e){return t.l=n+i,{t:s}}}function parse_HLink(t,e){var i=parse_Ref8U(t);return t.l+=16,[i,parse_Hyperlink(t,e-24)]}function parse_HLinkTooltip(t,e){t.read_shift(2);var i=parse_Ref8U(t),r=t.read_shift((e-10)/2,"dbcs-cont");return[i,r=r.replace(chr0,"")]}function parse_Country(t){var e,i=[0,0];return e=t.read_shift(2),i[0]=CountryEnum[e]||e,e=t.read_shift(2),i[1]=CountryEnum[e]||e,i}function parse_ClrtClient(t){for(var e=t.read_shift(2),i=[];e-- >0;)i.push(parse_LongRGB(t));return i}function parse_Palette(t){for(var e=t.read_shift(2),i=[];e-- >0;)i.push(parse_LongRGB(t));return i}function parse_XFCRC(t){t.l+=2;var e={cxfs:0,crc:0};return e.cxfs=t.read_shift(2),e.crc=t.read_shift(4),e}function parse_ColInfo(t,e,i){if(!i.cellStyles)return parsenoop(t,e);var r=i&&i.biff>=12?4:2,n=t.read_shift(r),s=t.read_shift(r),o=t.read_shift(r),a=t.read_shift(r),l=t.read_shift(2);2==r&&(t.l+=2);var c={s:n,e:s,w:o,ixfe:a,flags:l};return(i.biff>=5||!i.biff)&&(c.level=l>>8&7),c}function parse_Setup(t,e){var i={};return e<32||(t.l+=16,i.header=parse_Xnum(t),i.footer=parse_Xnum(t),t.l+=2),i}function parse_ShtProps(t,e,i){var r={area:!1};if(5!=i.biff)return t.l+=e,r;var n=t.read_shift(1);return t.l+=3,16&n&&(r.area=!0),r}var parse_Blank=parse_XLSCell,parse_Scl=parseuint16a,parse_String=parse_XLUnicodeString;function parse_ImData(t){var e=t.read_shift(2),i=t.read_shift(2),r=t.read_shift(4),n={fmt:e,env:i,len:r,data:t.slice(t.l,t.l+r)};return t.l+=r,n}function parse_BIFF2STR(t,e,i){i.biffguess&&5==i.biff&&(i.biff=2);var r=parse_XLSCell(t);++t.l;var n=parse_XLUnicodeString2(t,e-7,i);return r.t="str",r.val=n,r}function parse_BIFF2NUM(t){var e=parse_XLSCell(t);++t.l;var i=parse_Xnum(t);return e.t="n",e.val=i,e}function parse_BIFF2INT(t){var e=parse_XLSCell(t);++t.l;var i=t.read_shift(2);return e.t="n",e.val=i,e}function parse_BIFF2STRING(t){var e=t.read_shift(1);return 0===e?(t.l++,""):t.read_shift(e,"sbcs-cont")}function parse_BIFF2FONTXTRA(t,e){t.l+=6,t.l+=2,t.l+=1,t.l+=3,t.l+=1,t.l+=e-13}function parse_RString(t,e,i){var r=t.l+e,n=parse_XLSCell(t),s=t.read_shift(2),o=parse_XLUnicodeStringNoCch(t,s,i);return t.l=r,n.t="str",n.val=o,n}var DBF_SUPPORTED_VERSIONS=[2,3,48,49,131,139,140,245],DBF=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},i=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(e,i){var r=i||{};r.dateNF||(r.dateNF="yyyymmdd");var n=aoa_to_sheet(function(e,i){var r=[],n=new_raw_buf(1);switch(i.type){case"base64":n=s2a(Base64_decode(e));break;case"binary":n=s2a(e);break;case"buffer":case"array":n=e}prep_blob(n,0);var s=n.read_shift(1),o=!!(136&s),a=!1,l=!1;switch(s){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:a=!0,o=!0;break;case 140:l=!0;break;default:throw new Error("DBF Unsupported Version: "+s.toString(16))}var c=0,h=521;2==s&&(c=n.read_shift(2)),n.l+=3,2!=s&&(c=n.read_shift(4)),c>1048576&&(c=1e6),2!=s&&(h=n.read_shift(2));var u=n.read_shift(2),d=i.codepage||1252;2!=s&&(n.l+=16,n.read_shift(1),0!==n[n.l]&&(d=t[n[n.l]]),n.l+=1,n.l+=2),l&&(n.l+=36);for(var p=[],f={},_=Math.min(n.length,2==s?521:h-10-(a?264:0)),m=l?32:11;n.l<_&&13!=n[n.l];)switch((f={}).name=$cptable.utils.decode(d,n.slice(n.l,n.l+m)).replace(/[\u0000\r\n].*$/g,""),n.l+=m,f.type=String.fromCharCode(n.read_shift(1)),2==s||l||(f.offset=n.read_shift(4)),f.len=n.read_shift(1),2==s&&(f.offset=n.read_shift(2)),f.dec=n.read_shift(1),f.name.length&&p.push(f),2!=s&&(n.l+=l?13:14),f.type){case"B":a&&8==f.len||!i.WTF||console.log("Skipping "+f.name+":"+f.type);break;case"G":case"P":i.WTF&&console.log("Skipping "+f.name+":"+f.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+f.type)}if(13!==n[n.l]&&(n.l=h-1),13!==n.read_shift(1))throw new Error("DBF Terminator not found "+n.l+" "+n[n.l]);n.l=h;var g=0,y=0;for(r[0]=[],y=0;y!=p.length;++y)r[0][y]=p[y].name;for(;c-- >0;)if(42!==n[n.l])for(++n.l,r[++g]=[],y=0,y=0;y!=p.length;++y){var v=n.slice(n.l,n.l+p[y].len);n.l+=p[y].len,prep_blob(v,0);var b=$cptable.utils.decode(d,v);switch(p[y].type){case"C":b.trim().length&&(r[g][y]=b.replace(/\s+$/,""));break;case"D":8===b.length?r[g][y]=new Date(+b.slice(0,4),+b.slice(4,6)-1,+b.slice(6,8)):r[g][y]=b;break;case"F":r[g][y]=parseFloat(b.trim());break;case"+":case"I":r[g][y]=l?2147483648^v.read_shift(-4,"i"):v.read_shift(4,"i");break;case"L":switch(b.trim().toUpperCase()){case"Y":case"T":r[g][y]=!0;break;case"N":case"F":r[g][y]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+b+"|")}break;case"M":if(!o)throw new Error("DBF Unexpected MEMO for type "+s.toString(16));r[g][y]="##MEMO##"+(l?parseInt(b.trim(),10):v.read_shift(4));break;case"N":(b=b.replace(/\u0000/g,"").trim())&&"."!=b&&(r[g][y]=+b||0);break;case"@":r[g][y]=new Date(v.read_shift(-8,"f")-621356832e5);break;case"T":r[g][y]=new Date(864e5*(v.read_shift(4)-2440588)+v.read_shift(4));break;case"Y":r[g][y]=v.read_shift(4,"i")/1e4+v.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":r[g][y]=-v.read_shift(-8,"f");break;case"B":if(a&&8==p[y].len){r[g][y]=v.read_shift(8,"f");break}case"G":case"P":v.l+=p[y].len;break;case"0":if("_NullFlags"===p[y].name)break;default:throw new Error("DBF Unsupported data type "+p[y].type)}}else n.l+=u;if(2!=s&&n.l<n.length&&26!=n[n.l++])throw new Error("DBF EOF Marker missing "+(n.l-1)+" of "+n.length+" "+n[n.l-1].toString(16));return i&&i.sheetRows&&(r=r.slice(0,i.sheetRows)),i.DBF=p,r}(e,r),r);return n["!cols"]=r.DBF.map((function(t){return{wch:t.len,DBF:t}})),delete r.DBF,n}var n={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function(t,i){try{return sheet_to_workbook(r(t,i),i)}catch(e){if(i&&i.WTF)throw e}return{SheetNames:[],Sheets:{}}},to_sheet:r,from_sheet:function(t,e){var r=e||{};if(+r.codepage>=0&&set_cp(+r.codepage),"string"==r.type)throw new Error("Cannot write DBF to JS string");var s=buf_array(),o=sheet_to_json(t,{header:1,raw:!0,cellDates:!0}),a=o[0],l=o.slice(1),c=t["!cols"]||[],h=0,u=0,d=0,p=1;for(h=0;h<a.length;++h)if(((c[h]||{}).DBF||{}).name)a[h]=c[h].DBF.name,++d;else if(null!=a[h]){if(++d,"number"==typeof a[h]&&(a[h]=a[h].toString(10)),"string"!=typeof a[h])throw new Error("DBF Invalid column name "+a[h]+" |"+typeof a[h]+"|");if(a.indexOf(a[h])!==h)for(u=0;u<1024;++u)if(-1==a.indexOf(a[h]+"_"+u)){a[h]+="_"+u;break}}var f=safe_decode_range(t["!ref"]),_=[],m=[],g=[];for(h=0;h<=f.e.c-f.s.c;++h){var y="",v="",b=0,x=[];for(u=0;u<l.length;++u)null!=l[u][h]&&x.push(l[u][h]);if(0!=x.length&&null!=a[h]){for(u=0;u<x.length;++u){switch(typeof x[u]){case"number":v="B";break;case"string":default:v="C";break;case"boolean":v="L";break;case"object":v=x[u]instanceof Date?"D":"C"}b=Math.max(b,String(x[u]).length),y=y&&y!=v?"C":v}b>250&&(b=250),"C"==(v=((c[h]||{}).DBF||{}).type)&&c[h].DBF.len>b&&(b=c[h].DBF.len),"B"==y&&"N"==v&&(y="N",g[h]=c[h].DBF.dec,b=c[h].DBF.len),m[h]="C"==y||"N"==v?b:n[y]||0,p+=m[h],_[h]=y}else _[h]="?"}var T=s.next(32);for(T.write_shift(4,318902576),T.write_shift(4,l.length),T.write_shift(2,296+32*d),T.write_shift(2,p),h=0;h<4;++h)T.write_shift(4,0);for(T.write_shift(4,(+i[current_ansi]||3)<<8),h=0,u=0;h<a.length;++h)if(null!=a[h]){var C=s.next(32),S=(a[h].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);C.write_shift(1,S,"sbcs"),C.write_shift(1,"?"==_[h]?"C":_[h],"sbcs"),C.write_shift(4,u),C.write_shift(1,m[h]||n[_[h]]||0),C.write_shift(1,g[h]||0),C.write_shift(1,2),C.write_shift(4,0),C.write_shift(1,0),C.write_shift(4,0),C.write_shift(4,0),u+=m[h]||n[_[h]]||0}var w=s.next(264);for(w.write_shift(4,13),h=0;h<65;++h)w.write_shift(4,0);for(h=0;h<l.length;++h){var A=s.next(p);for(A.write_shift(1,0),u=0;u<a.length;++u)if(null!=a[u])switch(_[u]){case"L":A.write_shift(1,null==l[h][u]?63:l[h][u]?84:70);break;case"B":A.write_shift(8,l[h][u]||0,"f");break;case"N":var E="0";for("number"==typeof l[h][u]&&(E=l[h][u].toFixed(g[u]||0)),d=0;d<m[u]-E.length;++d)A.write_shift(1,32);A.write_shift(1,E,"sbcs");break;case"D":l[h][u]?(A.write_shift(4,("0000"+l[h][u].getFullYear()).slice(-4),"sbcs"),A.write_shift(2,("00"+(l[h][u].getMonth()+1)).slice(-2),"sbcs"),A.write_shift(2,("00"+l[h][u].getDate()).slice(-2),"sbcs")):A.write_shift(8,"00000000","sbcs");break;case"C":var D=String(null!=l[h][u]?l[h][u]:"").slice(0,m[u]);for(A.write_shift(1,D,"sbcs"),d=0;d<m[u]-D.length;++d)A.write_shift(1,32)}}return s.next(1).write_shift(1,26),s.end()}}}(),SYLK=function(){var t={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},e=new RegExp("N("+keys(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),i=function(e,i){var r=t[i];return"number"==typeof r?_getansi(r):r},r=function(t,e,i){var r=e.charCodeAt(0)-32<<4|i.charCodeAt(0)-48;return 59==r?t:_getansi(r)};function n(t,n){var s,o=t.split(/[\n\r]+/),a=-1,l=-1,c=0,h=0,u=[],d=[],p=null,f={},_=[],m=[],g=[],y=0;for(+n.codepage>=0&&set_cp(+n.codepage);c!==o.length;++c){y=0;var v,b=o[c].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(e,i),x=b.replace(/;;/g,"\0").split(";").map((function(t){return t.replace(/\u0000/g,";")})),T=x[0];if(b.length>0)switch(T){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==x[1].charAt(0)&&d.push(b.slice(3).replace(/;;/g,";"));break;case"C":var C=!1,S=!1,w=!1,A=!1,E=-1,D=-1;for(h=1;h<x.length;++h)switch(x[h].charAt(0)){case"A":case"G":break;case"X":l=parseInt(x[h].slice(1))-1,S=!0;break;case"Y":for(a=parseInt(x[h].slice(1))-1,S||(l=0),s=u.length;s<=a;++s)u[s]=[];break;case"K":'"'===(v=x[h].slice(1)).charAt(0)?v=v.slice(1,v.length-1):"TRUE"===v?v=!0:"FALSE"===v?v=!1:isNaN(fuzzynum(v))?isNaN(fuzzydate(v).getDate())||(v=parseDate(v)):(v=fuzzynum(v),null!==p&&fmt_is_date(p)&&(v=numdate(v))),C=!0;break;case"E":A=!0;var L=rc_to_a1(x[h].slice(1),{r:a,c:l});u[a][l]=[u[a][l],L];break;case"S":w=!0,u[a][l]=[u[a][l],"S5S"];break;case"R":E=parseInt(x[h].slice(1))-1;break;case"C":D=parseInt(x[h].slice(1))-1;break;default:if(n&&n.WTF)throw new Error("SYLK bad record "+b)}if(C&&(u[a][l]&&2==u[a][l].length?u[a][l][0]=v:u[a][l]=v,p=null),w){if(A)throw new Error("SYLK shared formula cannot have own formula");var I=E>-1&&u[E][D];if(!I||!I[1])throw new Error("SYLK shared formula cannot find base");u[a][l][1]=shift_formula_str(I[1],{r:a-E,c:l-D})}break;case"F":var P=0;for(h=1;h<x.length;++h)switch(x[h].charAt(0)){case"X":l=parseInt(x[h].slice(1))-1,++P;break;case"Y":for(a=parseInt(x[h].slice(1))-1,s=u.length;s<=a;++s)u[s]=[];break;case"M":y=parseInt(x[h].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":p=d[parseInt(x[h].slice(1))];break;case"W":for(g=x[h].slice(1).split(" "),s=parseInt(g[0],10);s<=parseInt(g[1],10);++s)y=parseInt(g[2],10),m[s-1]=0===y?{hidden:!0}:{wch:y},process_col(m[s-1]);break;case"C":m[l=parseInt(x[h].slice(1))-1]||(m[l]={});break;case"R":_[a=parseInt(x[h].slice(1))-1]||(_[a]={}),y>0?(_[a].hpt=y,_[a].hpx=pt2px(y)):0===y&&(_[a].hidden=!0);break;default:if(n&&n.WTF)throw new Error("SYLK bad record "+b)}P<1&&(p=null);break;default:if(n&&n.WTF)throw new Error("SYLK bad record "+b)}}return _.length>0&&(f["!rows"]=_),m.length>0&&(f["!cols"]=m),n&&n.sheetRows&&(u=u.slice(0,n.sheetRows)),[u,f]}function s(t,e){var i=function(t,e){switch(e.type){case"base64":return n(Base64_decode(t),e);case"binary":return n(t,e);case"buffer":return n(has_buf&&Buffer.isBuffer(t)?t.toString("binary"):a2s(t),e);case"array":return n(cc2str(t),e)}throw new Error("Unrecognized type "+e.type)}(t,e),r=i[0],s=i[1],o=aoa_to_sheet(r,e);return keys(s).forEach((function(t){o[t]=s[t]})),o}function o(t,e,i,r){var n="C;Y"+(i+1)+";X"+(r+1)+";K";switch(t.t){case"n":n+=t.v||0,t.f&&!t.F&&(n+=";E"+a1_to_rc(t.f,{r:i,c:r}));break;case"b":n+=t.v?"TRUE":"FALSE";break;case"e":n+=t.w||t.v;break;case"d":n+='"'+(t.w||t.v)+'"';break;case"s":n+='"'+t.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return n}return t["|"]=254,{to_workbook:function(t,e){return sheet_to_workbook(s(t,e),e)},to_sheet:s,from_sheet:function(t,e){var i,r,n=["ID;PWXL;N;E"],s=[],a=safe_decode_range(t["!ref"]),l=Array.isArray(t),c="\r\n";n.push("P;PGeneral"),n.push("F;P0;DG0G8;M255"),t["!cols"]&&(r=n,t["!cols"].forEach((function(t,e){var i="F;W"+(e+1)+" "+(e+1)+" ";t.hidden?i+="0":("number"!=typeof t.width||t.wpx||(t.wpx=width2px(t.width)),"number"!=typeof t.wpx||t.wch||(t.wch=px2char(t.wpx)),"number"==typeof t.wch&&(i+=Math.round(t.wch)))," "!=i.charAt(i.length-1)&&r.push(i)}))),t["!rows"]&&function(t,e){e.forEach((function(e,i){var r="F;";e.hidden?r+="M0;":e.hpt?r+="M"+20*e.hpt+";":e.hpx&&(r+="M"+20*px2pt(e.hpx)+";"),r.length>2&&t.push(r+"R"+(i+1))}))}(n,t["!rows"]),n.push("B;Y"+(a.e.r-a.s.r+1)+";X"+(a.e.c-a.s.c+1)+";D"+[a.s.c,a.s.r,a.e.c,a.e.r].join(" "));for(var h=a.s.r;h<=a.e.r;++h)for(var u=a.s.c;u<=a.e.c;++u){var d=encode_cell({r:h,c:u});(i=l?(t[h]||[])[u]:t[d])&&(null!=i.v||i.f&&!i.F)&&s.push(o(i,0,h,u))}return n.join(c)+c+s.join(c)+c+"E"+c}}}(),DIF=function(){function t(t,e){for(var i=t.split("\n"),r=-1,n=-1,s=0,o=[];s!==i.length;++s)if("BOT"!==i[s].trim()){if(!(r<0)){for(var a=i[s].trim().split(","),l=a[0],c=a[1],h=i[++s]||"";1&(h.match(/["]/g)||[]).length&&s<i.length-1;)h+="\n"+i[++s];switch(h=h.trim(),+l){case-1:if("BOT"===h){o[++r]=[],n=0;continue}if("EOD"!==h)throw new Error("Unrecognized DIF special command "+h);break;case 0:"TRUE"===h?o[r][n]=!0:"FALSE"===h?o[r][n]=!1:isNaN(fuzzynum(c))?isNaN(fuzzydate(c).getDate())?o[r][n]=c:o[r][n]=parseDate(c):o[r][n]=fuzzynum(c),++n;break;case 1:(h=(h=h.slice(1,h.length-1)).replace(/""/g,'"'))&&h.match(/^=".*"$/)&&(h=h.slice(2,-1)),o[r][n++]=""!==h?h:null}if("EOD"===h)break}}else o[++r]=[],n=0;return e&&e.sheetRows&&(o=o.slice(0,e.sheetRows)),o}function e(e,i){return aoa_to_sheet(function(e,i){switch(i.type){case"base64":return t(Base64_decode(e),i);case"binary":return t(e,i);case"buffer":return t(has_buf&&Buffer.isBuffer(e)?e.toString("binary"):a2s(e),i);case"array":return t(cc2str(e),i)}throw new Error("Unrecognized type "+i.type)}(e,i),i)}var i=function(){var t=function(t,e,i,r,n){t.push(e),t.push(i+","+r),t.push('"'+n.replace(/"/g,'""')+'"')},e=function(t,e,i,r){t.push(e+","+i),t.push(1==e?'"'+r.replace(/"/g,'""')+'"':r)};return function(i){var r,n=[],s=safe_decode_range(i["!ref"]),o=Array.isArray(i);t(n,"TABLE",0,1,"sheetjs"),t(n,"VECTORS",0,s.e.r-s.s.r+1,""),t(n,"TUPLES",0,s.e.c-s.s.c+1,""),t(n,"DATA",0,0,"");for(var a=s.s.r;a<=s.e.r;++a){e(n,-1,0,"BOT");for(var l=s.s.c;l<=s.e.c;++l){var c=encode_cell({r:a,c:l});if(r=o?(i[a]||[])[l]:i[c])switch(r.t){case"n":var h=r.w;h||null==r.v||(h=r.v),null==h?r.f&&!r.F?e(n,1,0,"="+r.f):e(n,1,0,""):e(n,0,h,"V");break;case"b":e(n,0,r.v?1:0,r.v?"TRUE":"FALSE");break;case"s":e(n,1,0,isNaN(r.v)?r.v:'="'+r.v+'"');break;case"d":r.w||(r.w=SSF_format(r.z||table_fmt[14],datenum(parseDate(r.v)))),e(n,0,r.w,"V");break;default:e(n,1,0,"")}else e(n,1,0,"")}}e(n,-1,0,"EOD");return n.join("\r\n")}}();return{to_workbook:function(t,i){return sheet_to_workbook(e(t,i),i)},to_sheet:e,from_sheet:i}}(),ETH=function(){function t(t){return t.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function e(t){return t.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function i(e,i){return aoa_to_sheet(function(e,i){for(var r=e.split("\n"),n=-1,s=-1,o=0,a=[];o!==r.length;++o){var l=r[o].trim().split(":");if("cell"===l[0]){var c=decode_cell(l[1]);if(a.length<=c.r)for(n=a.length;n<=c.r;++n)a[n]||(a[n]=[]);switch(n=c.r,s=c.c,l[2]){case"t":a[n][s]=t(l[3]);break;case"v":a[n][s]=+l[3];break;case"vtf":var h=l[l.length-1];case"vtc":"nl"===l[3]?a[n][s]=!!+l[4]:a[n][s]=+l[4],"vtf"==l[2]&&(a[n][s]=[a[n][s],h])}}}return i&&i.sheetRows&&(a=a.slice(0,i.sheetRows)),a}(e,i),i)}var r=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),n=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",s=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),o="--SocialCalcSpreadsheetControlSave--";function a(t){if(!t||!t["!ref"])return"";for(var i,r=[],n=[],s="",o=decode_range(t["!ref"]),a=Array.isArray(t),l=o.s.r;l<=o.e.r;++l)for(var c=o.s.c;c<=o.e.c;++c)if(s=encode_cell({r:l,c:c}),(i=a?(t[l]||[])[c]:t[s])&&null!=i.v&&"z"!==i.t){switch(n=["cell",s,"t"],i.t){case"s":case"str":n.push(e(i.v));break;case"n":i.f?(n[2]="vtf",n[3]="n",n[4]=i.v,n[5]=e(i.f)):(n[2]="v",n[3]=i.v);break;case"b":n[2]="vt"+(i.f?"f":"c"),n[3]="nl",n[4]=i.v?"1":"0",n[5]=e(i.f||(i.v?"TRUE":"FALSE"));break;case"d":var h=datenum(parseDate(i.v));n[2]="vtc",n[3]="nd",n[4]=""+h,n[5]=i.w||SSF_format(i.z||table_fmt[14],h);break;case"e":continue}r.push(n.join(":"))}return r.push("sheet:c:"+(o.e.c-o.s.c+1)+":r:"+(o.e.r-o.s.r+1)+":tvf:1"),r.push("valueformat:1:text-wiki"),r.join("\n")}return{to_workbook:function(t,e){return sheet_to_workbook(i(t,e),e)},to_sheet:i,from_sheet:function(t){return[r,n,s,n,a(t),o].join("\n")}}}(),PRN=function(){function t(t,e,i,r,n){n.raw?e[i][r]=t:""===t||("TRUE"===t?e[i][r]=!0:"FALSE"===t?e[i][r]=!1:isNaN(fuzzynum(t))?isNaN(fuzzydate(t).getDate())?e[i][r]=t:e[i][r]=parseDate(t):e[i][r]=fuzzynum(t))}var e={44:",",9:"\t",59:";",124:"|"},i={44:3,9:2,59:1,124:0};function r(t){for(var r={},n=!1,s=0,o=0;s<t.length;++s)34==(o=t.charCodeAt(s))?n=!n:!n&&o in e&&(r[o]=(r[o]||0)+1);for(s in o=[],r)Object.prototype.hasOwnProperty.call(r,s)&&o.push([r[s],s]);if(!o.length)for(s in r=i)Object.prototype.hasOwnProperty.call(r,s)&&o.push([r[s],s]);return o.sort((function(t,e){return t[0]-e[0]||i[t[1]]-i[e[1]]})),e[o.pop()[1]]||44}function n(t,e){var i=e||{},n="",s=i.dense?[]:{},o={s:{c:0,r:0},e:{c:0,r:0}};"sep="==t.slice(0,4)?13==t.charCodeAt(5)&&10==t.charCodeAt(6)?(n=t.charAt(4),t=t.slice(7)):13==t.charCodeAt(5)||10==t.charCodeAt(5)?(n=t.charAt(4),t=t.slice(6)):n=r(t.slice(0,1024)):n=i&&i.FS?i.FS:r(t.slice(0,1024));var a=0,l=0,c=0,h=0,u=0,d=n.charCodeAt(0),p=!1,f=0,_=t.charCodeAt(0);t=t.replace(/\r\n/gm,"\n");var m=null!=i.dateNF?dateNF_regex(i.dateNF):null;function g(){var e=t.slice(h,u),r={};if('"'==e.charAt(0)&&'"'==e.charAt(e.length-1)&&(e=e.slice(1,-1).replace(/""/g,'"')),0===e.length)r.t="z";else if(i.raw)r.t="s",r.v=e;else if(0===e.trim().length)r.t="s",r.v=e;else if(61==e.charCodeAt(0))34==e.charCodeAt(1)&&34==e.charCodeAt(e.length-1)?(r.t="s",r.v=e.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(e)?(r.t="n",r.f=e.slice(1)):(r.t="s",r.v=e);else if("TRUE"==e)r.t="b",r.v=!0;else if("FALSE"==e)r.t="b",r.v=!1;else if(isNaN(c=fuzzynum(e)))if(!isNaN(fuzzydate(e).getDate())||m&&e.match(m)){r.z=i.dateNF||table_fmt[14];var n=0;m&&e.match(m)&&(e=dateNF_fix(e,i.dateNF,e.match(m)||[]),n=1),i.cellDates?(r.t="d",r.v=parseDate(e,n)):(r.t="n",r.v=datenum(parseDate(e,n))),!1!==i.cellText&&(r.w=SSF_format(r.z,r.v instanceof Date?datenum(r.v):r.v)),i.cellNF||delete r.z}else r.t="s",r.v=e;else r.t="n",!1!==i.cellText&&(r.w=e),r.v=c;if("z"==r.t||(i.dense?(s[a]||(s[a]=[]),s[a][l]=r):s[encode_cell({c:l,r:a})]=r),h=u+1,_=t.charCodeAt(h),o.e.c<l&&(o.e.c=l),o.e.r<a&&(o.e.r=a),f==d)++l;else if(l=0,++a,i.sheetRows&&i.sheetRows<=a)return!0}t:for(;u<t.length;++u)switch(f=t.charCodeAt(u)){case 34:34===_&&(p=!p);break;case d:case 10:case 13:if(!p&&g())break t}return u-h>0&&g(),s["!ref"]=encode_range(o),s}function s(e,i){return i&&i.PRN?i.FS||"sep="==e.slice(0,4)||e.indexOf("\t")>=0||e.indexOf(",")>=0||e.indexOf(";")>=0?n(e,i):aoa_to_sheet(function(e,i){var r=i||{},n=[];if(!e||0===e.length)return n;for(var s=e.split(/[\r\n]/),o=s.length-1;o>=0&&0===s[o].length;)--o;for(var a=10,l=0,c=0;c<=o;++c)-1==(l=s[c].indexOf(" "))?l=s[c].length:l++,a=Math.max(a,l);for(c=0;c<=o;++c){n[c]=[];var h=0;for(t(s[c].slice(0,a).trim(),n,c,h,r),h=1;h<=(s[c].length-a)/10+1;++h)t(s[c].slice(a+10*(h-1),a+10*h).trim(),n,c,h,r)}return r.sheetRows&&(n=n.slice(0,r.sheetRows)),n}(e,i),i):n(e,i)}function o(t,e){var i="",r="string"==e.type?[0,0,0,0]:firstbyte(t,e);switch(e.type){case"base64":i=Base64_decode(t);break;case"binary":case"string":i=t;break;case"buffer":65001==e.codepage?i=t.toString("utf8"):e.codepage&&void 0!==$cptable||(i=has_buf&&Buffer.isBuffer(t)?t.toString("binary"):a2s(t));break;case"array":i=cc2str(t);break;default:throw new Error("Unrecognized type "+e.type)}return 239==r[0]&&187==r[1]&&191==r[2]?i=utf8read(i.slice(3)):"string"!=e.type&&"buffer"!=e.type&&65001==e.codepage?i=utf8read(i):e.type,"socialcalc:version:"==i.slice(0,19)?ETH.to_sheet("string"==e.type?i:utf8read(i),e):s(i,e)}return{to_workbook:function(t,e){return sheet_to_workbook(o(t,e),e)},to_sheet:o,from_sheet:function(t){for(var e,i=[],r=safe_decode_range(t["!ref"]),n=Array.isArray(t),s=r.s.r;s<=r.e.r;++s){for(var o=[],a=r.s.c;a<=r.e.c;++a){var l=encode_cell({r:s,c:a});if((e=n?(t[s]||[])[a]:t[l])&&null!=e.v){for(var c=(e.w||(format_cell(e),e.w)||"").slice(0,10);c.length<10;)c+=" ";o.push(c+(0===a?" ":""))}else o.push("          ")}i.push(o.join(""))}return i.join("\n")}}}();function read_wb_ID(t,i){var r=i||{},n=!!r.WTF;r.WTF=!0;try{var s=SYLK.to_workbook(t,r);return r.WTF=n,s}catch(e){if(r.WTF=n,!e.message.match(/SYLK bad record ID/)&&n)throw e;return PRN.to_workbook(t,i)}}var WK_=function(){function t(t,e,i){if(t){prep_blob(t,t.l||0);for(var r=i.Enum||g;t.l<t.length;){var n=t.read_shift(2),s=r[n]||r[65535],o=t.read_shift(2),a=t.l+o,l=s.f&&s.f(t,o,i);if(t.l=a,e(l,s,n))return}}}function e(e,i){if(!e)return e;var r=i||{},n=r.dense?[]:{},s="Sheet1",o="",a=0,l={},c=[],h=[],u={s:{r:0,c:0},e:{r:0,c:0}},d=r.sheetRows||0;if(0==e[2]&&(8==e[3]||9==e[3])&&e.length>=16&&5==e[14]&&108===e[15])throw new Error("Unsupported Works 3 for Mac file");if(2==e[2])r.Enum=g,t(e,(function(t,e,i){switch(i){case 0:r.vers=t,t>=4096&&(r.qpro=!0);break;case 6:u=t;break;case 204:t&&(o=t);break;case 222:o=t;break;case 15:case 51:r.qpro||(t[1].v=t[1].v.slice(1));case 13:case 14:case 16:14==i&&!(112&~t[2])&&(15&t[2])>1&&(15&t[2])<15&&(t[1].z=r.dateNF||table_fmt[14],r.cellDates&&(t[1].t="d",t[1].v=numdate(t[1].v))),r.qpro&&t[3]>a&&(n["!ref"]=encode_range(u),l[s]=n,c.push(s),n=r.dense?[]:{},u={s:{r:0,c:0},e:{r:0,c:0}},a=t[3],s=o||"Sheet"+(a+1),o="");var h=r.dense?(n[t[0].r]||[])[t[0].c]:n[encode_cell(t[0])];if(h){h.t=t[1].t,h.v=t[1].v,null!=t[1].z&&(h.z=t[1].z),null!=t[1].f&&(h.f=t[1].f);break}r.dense?(n[t[0].r]||(n[t[0].r]=[]),n[t[0].r][t[0].c]=t[1]):n[encode_cell(t[0])]=t[1]}}),r);else{if(26!=e[2]&&14!=e[2])throw new Error("Unrecognized LOTUS BOF "+e[2]);r.Enum=y,14==e[2]&&(r.qpro=!0,e.l=0),t(e,(function(t,e,i){switch(i){case 204:s=t;break;case 22:t[1].v=t[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(t[3]>a&&(n["!ref"]=encode_range(u),l[s]=n,c.push(s),n=r.dense?[]:{},u={s:{r:0,c:0},e:{r:0,c:0}},a=t[3],s="Sheet"+(a+1)),d>0&&t[0].r>=d)break;r.dense?(n[t[0].r]||(n[t[0].r]=[]),n[t[0].r][t[0].c]=t[1]):n[encode_cell(t[0])]=t[1],u.e.c<t[0].c&&(u.e.c=t[0].c),u.e.r<t[0].r&&(u.e.r=t[0].r);break;case 27:t[14e3]&&(h[t[14e3][0]]=t[14e3][1]);break;case 1537:h[t[0]]=t[1],t[0]==a&&(s=t[1])}}),r)}if(n["!ref"]=encode_range(u),l[o||s]=n,c.push(o||s),!h.length)return{SheetNames:c,Sheets:l};for(var p={},f=[],_=0;_<h.length;++_)l[c[_]]?(f.push(h[_]||c[_]),p[h[_]]=l[h[_]]||l[c[_]]):(f.push(h[_]),p[h[_]]={"!ref":"A1"});return{SheetNames:f,Sheets:p}}function i(t,e,i){var r=[{c:0,r:0},{t:"n",v:0},0,0];return i.qpro&&20768!=i.vers?(r[0].c=t.read_shift(1),r[3]=t.read_shift(1),r[0].r=t.read_shift(2),t.l+=2):(r[2]=t.read_shift(1),r[0].c=t.read_shift(2),r[0].r=t.read_shift(2)),r}function r(t,e,r){var n=t.l+e,s=i(t,0,r);if(s[1].t="s",20768==r.vers){t.l++;var o=t.read_shift(1);return s[1].v=t.read_shift(o,"utf8"),s}return r.qpro&&t.l++,s[1].v=t.read_shift(n-t.l,"cstr"),s}function n(t,e,i){var r=new_buf(7+i.length);r.write_shift(1,255),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(1,39);for(var n=0;n<r.length;++n){var s=i.charCodeAt(n);r.write_shift(1,s>=128?95:s)}return r.write_shift(1,0),r}function s(t,e,i){var r=new_buf(7);return r.write_shift(1,255),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(2,i,"i"),r}function o(t,e,i){var r=new_buf(13);return r.write_shift(1,255),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(8,i,"f"),r}function a(t,e,i){var r=32768&e;return e=(r?t:0)+((e&=-32769)>=8192?e-16384:e),(r?"":"$")+(i?encode_col(e):encode_row(e))}var l={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},c=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function h(t){var e=[{c:0,r:0},{t:"n",v:0},0];return e[0].r=t.read_shift(2),e[3]=t[t.l++],e[0].c=t[t.l++],e}function u(t,e,i,r){var n=new_buf(6+r.length);n.write_shift(2,t),n.write_shift(1,i),n.write_shift(1,e),n.write_shift(1,39);for(var s=0;s<r.length;++s){var o=r.charCodeAt(s);n.write_shift(1,o>=128?95:o)}return n.write_shift(1,0),n}function d(t,e){var i=h(t),r=t.read_shift(4),n=t.read_shift(4),s=t.read_shift(2);if(65535==s)return 0===r&&3221225472===n?(i[1].t="e",i[1].v=15):0===r&&3489660928===n?(i[1].t="e",i[1].v=42):i[1].v=0,i;var o=32768&s;return s=(32767&s)-16446,i[1].v=(1-2*o)*(n*Math.pow(2,s+32)+r*Math.pow(2,s)),i}function p(t,e,i,r){var n=new_buf(14);if(n.write_shift(2,t),n.write_shift(1,i),n.write_shift(1,e),0==r)return n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,65535),n;var s,o=0,a=0,l=0;return r<0&&(o=1,r=-r),a=0|Math.log2(r),2147483648&(l=(r/=Math.pow(2,a-31))>>>0)||(++a,l=(r/=2)>>>0),r-=l,l|=2147483648,l>>>=0,s=(r*=Math.pow(2,32))>>>0,n.write_shift(4,s),n.write_shift(4,l),a+=16383+(o?32768:0),n.write_shift(2,a),n}function f(t,e){var i=h(t),r=t.read_shift(8,"f");return i[1].v=r,i}function _(t,e){return 0==t[t.l+e-1]?t.read_shift(e,"cstr"):""}function m(t,e){var i=new_buf(5+t.length);i.write_shift(2,14e3),i.write_shift(2,e);for(var r=0;r<t.length;++r){var n=t.charCodeAt(r);i[i.l++]=n>127?95:n}return i[i.l++]=0,i}var g={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function(t,e,i){var r={s:{c:0,r:0},e:{c:0,r:0}};return 8==e&&i.qpro?(r.s.c=t.read_shift(1),t.l++,r.s.r=t.read_shift(2),r.e.c=t.read_shift(1),t.l++,r.e.r=t.read_shift(2),r):(r.s.c=t.read_shift(2),r.s.r=t.read_shift(2),12==e&&i.qpro&&(t.l+=2),r.e.c=t.read_shift(2),r.e.r=t.read_shift(2),12==e&&i.qpro&&(t.l+=2),65535==r.s.c&&(r.s.c=r.e.c=r.s.r=r.e.r=0),r)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function(t,e,r){var n=i(t,0,r);return n[1].v=t.read_shift(2,"i"),n}},14:{n:"NUMBER",f:function(t,e,r){var n=i(t,0,r);return n[1].v=t.read_shift(8,"f"),n}},15:{n:"LABEL",f:r},16:{n:"FORMULA",f:function(t,e,r){var n=t.l+e,s=i(t,0,r);if(s[1].v=t.read_shift(8,"f"),r.qpro)t.l=n;else{var o=t.read_shift(2);!function(t,e){prep_blob(t,0);var i=[],r=0,n="",s="",o="",h="";for(;t.l<t.length;){var u=t[t.l++];switch(u){case 0:i.push(t.read_shift(8,"f"));break;case 1:s=a(e[0].c,t.read_shift(2),!0),n=a(e[0].r,t.read_shift(2),!1),i.push(s+n);break;case 2:var d=a(e[0].c,t.read_shift(2),!0),p=a(e[0].r,t.read_shift(2),!1);s=a(e[0].c,t.read_shift(2),!0),n=a(e[0].r,t.read_shift(2),!1),i.push(d+p+":"+s+n);break;case 3:if(t.l<t.length)return void console.error("WK1 premature formula end");break;case 4:i.push("("+i.pop()+")");break;case 5:i.push(t.read_shift(2));break;case 6:for(var f="";u=t[t.l++];)f+=String.fromCharCode(u);i.push('"'+f.replace(/"/g,'""')+'"');break;case 8:i.push("-"+i.pop());break;case 23:i.push("+"+i.pop());break;case 22:i.push("NOT("+i.pop()+")");break;case 20:case 21:h=i.pop(),o=i.pop(),i.push(["AND","OR"][u-20]+"("+o+","+h+")");break;default:if(u<32&&c[u])h=i.pop(),o=i.pop(),i.push(o+c[u]+h);else{if(!l[u])return u<=7?console.error("WK1 invalid opcode "+u.toString(16)):u<=24?console.error("WK1 unsupported op "+u.toString(16)):u<=30?console.error("WK1 invalid opcode "+u.toString(16)):u<=115?console.error("WK1 unsupported function opcode "+u.toString(16)):console.error("WK1 unrecognized opcode "+u.toString(16));if(69==(r=l[u][1])&&(r=t[t.l++]),r>i.length)return void console.error("WK1 bad formula parse 0x"+u.toString(16)+":|"+i.join("|")+"|");var _=i.slice(-r);i.length-=r,i.push(l[u][0]+"("+_.join(",")+")")}}}1==i.length?e[1].f=""+i[0]:console.error("WK1 bad formula parse |"+i.join("|")+"|")}(t.slice(t.l,t.l+o),s),t.l+=o}return s}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:r},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:_},222:{n:"SHEETNAMELP",f:function(t,e){var i=t[t.l++];i>e-1&&(i=e-1);for(var r="";r.length<i;)r+=String.fromCharCode(t[t.l++]);return r}},65535:{n:""}},y={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function(t,e){var i=h(t);return i[1].t="s",i[1].v=t.read_shift(e-4,"cstr"),i}},23:{n:"NUMBER17",f:d},24:{n:"NUMBER18",f:function(t,e){var i=h(t);i[1].v=t.read_shift(2);var r=i[1].v>>1;if(1&i[1].v)switch(7&r){case 0:r=5e3*(r>>3);break;case 1:r=500*(r>>3);break;case 2:r=(r>>3)/20;break;case 3:r=(r>>3)/200;break;case 4:r=(r>>3)/2e3;break;case 5:r=(r>>3)/2e4;break;case 6:r=(r>>3)/16;break;case 7:r=(r>>3)/64}return i[1].v=r,i}},25:{n:"FORMULA19",f:function(t,e){var i=d(t);return t.l+=e-14,i}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function(t,e){for(var i={},r=t.l+e;t.l<r;){var n=t.read_shift(2);if(14e3==n){for(i[n]=[0,""],i[n][0]=t.read_shift(2);t[t.l];)i[n][1]+=String.fromCharCode(t[t.l]),t.l++;t.l++}}return i}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function(t,e){var i=h(t),r=t.read_shift(4);return i[1].v=r>>6,i}},38:{n:"??"},39:{n:"NUMBER27",f:f},40:{n:"FORMULA28",f:function(t,e){var i=f(t);return t.l+=e-10,i}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:_},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function(t,e,i){if(i.qpro&&!(e<21)){var r=t.read_shift(1);return t.l+=17,t.l+=1,t.l+=2,[r,t.read_shift(e-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function(t,e){var i=e||{};if(+i.codepage>=0&&set_cp(+i.codepage),"string"==i.type)throw new Error("Cannot write WK1 to JS string");var r=buf_array(),a=safe_decode_range(t["!ref"]),l=Array.isArray(t),c=[];write_biff_rec(r,0,function(t){var e=new_buf(2);return e.write_shift(2,t),e}(1030)),write_biff_rec(r,6,function(t){var e=new_buf(8);return e.write_shift(2,t.s.c),e.write_shift(2,t.s.r),e.write_shift(2,t.e.c),e.write_shift(2,t.e.r),e}(a));for(var h=Math.min(a.e.r,8191),u=a.s.r;u<=h;++u)for(var d=encode_row(u),p=a.s.c;p<=a.e.c;++p){u===a.s.r&&(c[p]=encode_col(p));var f=c[p]+d,_=l?(t[u]||[])[p]:t[f];if(_&&"z"!=_.t)if("n"==_.t)(0|_.v)==_.v&&_.v>=-32768&&_.v<=32767?write_biff_rec(r,13,s(u,p,_.v)):write_biff_rec(r,14,o(u,p,_.v));else write_biff_rec(r,15,n(u,p,format_cell(_).slice(0,239)))}return write_biff_rec(r,1),r.end()},book_to_wk3:function(t,e){var i=e||{};if(+i.codepage>=0&&set_cp(+i.codepage),"string"==i.type)throw new Error("Cannot write WK3 to JS string");var r=buf_array();write_biff_rec(r,0,function(t){var e=new_buf(26);e.write_shift(2,4096),e.write_shift(2,4),e.write_shift(4,0);for(var i=0,r=0,n=0,s=0;s<t.SheetNames.length;++s){var o=t.SheetNames[s],a=t.Sheets[o];if(a&&a["!ref"]){++n;var l=decode_range(a["!ref"]);i<l.e.r&&(i=l.e.r),r<l.e.c&&(r=l.e.c)}}i>8191&&(i=8191);return e.write_shift(2,i),e.write_shift(1,n),e.write_shift(1,r),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(1,1),e.write_shift(1,2),e.write_shift(4,0),e.write_shift(4,0),e}(t));for(var n=0,s=0;n<t.SheetNames.length;++n)(t.Sheets[t.SheetNames[n]]||{})["!ref"]&&write_biff_rec(r,27,m(t.SheetNames[n],s++));var o=0;for(n=0;n<t.SheetNames.length;++n){var a=t.Sheets[t.SheetNames[n]];if(a&&a["!ref"]){for(var l=safe_decode_range(a["!ref"]),c=Array.isArray(a),h=[],d=Math.min(l.e.r,8191),f=l.s.r;f<=d;++f)for(var _=encode_row(f),g=l.s.c;g<=l.e.c;++g){f===l.s.r&&(h[g]=encode_col(g));var y=h[g]+_,v=c?(a[f]||[])[g]:a[y];if(v&&"z"!=v.t)if("n"==v.t)write_biff_rec(r,23,p(f,g,o,v.v));else write_biff_rec(r,22,u(f,g,o,format_cell(v).slice(0,239)))}++o}}return write_biff_rec(r,1),r.end()},to_workbook:function(t,i){switch(i.type){case"base64":return e(s2a(Base64_decode(t)),i);case"binary":return e(s2a(t),i);case"buffer":case"array":return e(t,i)}throw"Unsupported type "+i.type}}}();function parse_rpr(t){var e={},i=t.match(tagregex),r=0,n=!1;if(i)for(;r!=i.length;++r){var s=parsexmltag(i[r]);switch(s[0].replace(/\w*:/g,"")){case"<condense":case"<extend":break;case"<shadow":if(!s.val)break;case"<shadow>":case"<shadow/>":e.shadow=1;break;case"</shadow>":break;case"<charset":if("1"==s.val)break;e.cp=CS2CP[parseInt(s.val,10)];break;case"<outline":if(!s.val)break;case"<outline>":case"<outline/>":e.outline=1;break;case"</outline>":break;case"<rFont":e.name=s.val;break;case"<sz":e.sz=s.val;break;case"<strike":if(!s.val)break;case"<strike>":case"<strike/>":e.strike=1;break;case"</strike>":break;case"<u":if(!s.val)break;switch(s.val){case"double":e.uval="double";break;case"singleAccounting":e.uval="single-accounting";break;case"doubleAccounting":e.uval="double-accounting"}case"<u>":case"<u/>":e.u=1;break;case"</u>":break;case"<b":if("0"==s.val)break;case"<b>":case"<b/>":e.b=1;break;case"</b>":break;case"<i":if("0"==s.val)break;case"<i>":case"<i/>":e.i=1;break;case"</i>":break;case"<color":s.rgb&&(e.color=s.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":e.family=s.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":e.valign=s.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":case"<scheme":case"<scheme>":case"<scheme/>":case"</scheme>":case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(47!==s[0].charCodeAt(1)&&!n)throw new Error("Unrecognized rich format "+s[0])}}return e}var parse_rs=function(){var t=matchtag("t"),e=matchtag("rPr");function i(i){var r=i.match(t);if(!r)return{t:"s",v:""};var n={t:"s",v:unescapexml(r[1])},s=i.match(e);return s&&(n.s=parse_rpr(s[1])),n}var r=/<(?:\w+:)?r>/g,n=/<\/(?:\w+:)?r>/;return function(t){return t.replace(r,"").split(n).map(i).filter((function(t){return t.v}))}}(),rs_to_html=function(){var t=/(\r\n|\n)/g;function e(e){var i=[[],e.v,[]];return e.v?(e.s&&function(t,e,i){var r=[];t.u&&r.push("text-decoration: underline;"),t.uval&&r.push("text-underline-style:"+t.uval+";"),t.sz&&r.push("font-size:"+t.sz+"pt;"),t.outline&&r.push("text-effect: outline;"),t.shadow&&r.push("text-shadow: auto;"),e.push('<span style="'+r.join("")+'">'),t.b&&(e.push("<b>"),i.push("</b>")),t.i&&(e.push("<i>"),i.push("</i>")),t.strike&&(e.push("<s>"),i.push("</s>"));var n=t.valign||"";"superscript"==n||"super"==n?n="sup":"subscript"==n&&(n="sub"),""!=n&&(e.push("<"+n+">"),i.push("</"+n+">")),i.push("</span>")}(e.s,i[0],i[2]),i[0].join("")+i[1].replace(t,"<br/>")+i[2].join("")):""}return function(t){return t.map(e).join("")}}(),sitregex=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,sirregex=/<(?:\w+:)?r>/,sirphregex=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function parse_si(t,e){var i=!e||e.cellHTML,r={};return t?(t.match(/^\s*<(?:\w+:)?t[^>]*>/)?(r.t=unescapexml(utf8read(t.slice(t.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),r.r=utf8read(t),i&&(r.h=escapehtml(r.t))):t.match(sirregex)&&(r.r=utf8read(t),r.t=unescapexml(utf8read((t.replace(sirphregex,"").match(sitregex)||[]).join("").replace(tagregex,""))),i&&(r.h=rs_to_html(parse_rs(r.r)))),r):{t:""}}var sstr0=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,sstr1=/<(?:\w+:)?(?:si|sstItem)>/g,sstr2=/<\/(?:\w+:)?(?:si|sstItem)>/;function parse_sst_xml(t,e){var i=[],r="";if(!t)return i;var n=t.match(sstr0);if(n){r=n[2].replace(sstr1,"").split(sstr2);for(var s=0;s!=r.length;++s){var o=parse_si(r[s].trim(),e);null!=o&&(i[i.length]=o)}n=parsexmltag(n[1]),i.Count=n.count,i.Unique=n.uniqueCount}return i}function parse_BrtBeginSst(t){return[t.read_shift(4),t.read_shift(4)]}function parse_sst_bin(t,e){var i=[],r=!1;return recordhopper(t,(function(t,n,s){switch(s){case 159:i.Count=t[0],i.Unique=t[1];break;case 19:i.push(t);break;case 160:return!0;case 35:r=!0;break;case 36:r=!1;break;default:if(n.T,!r||e.WTF)throw new Error("Unexpected record 0x"+s.toString(16))}})),i}function _JS2ANSI(t){for(var e=[],i=t.split(""),r=0;r<i.length;++r)e[r]=i[r].charCodeAt(0);return e}function parse_CRYPTOVersion(t,e){var i={};return i.Major=t.read_shift(2),i.Minor=t.read_shift(2),e>=4&&(t.l+=e-4),i}function parse_DataSpaceVersionInfo(t){var e={};return e.id=t.read_shift(0,"lpp4"),e.R=parse_CRYPTOVersion(t,4),e.U=parse_CRYPTOVersion(t,4),e.W=parse_CRYPTOVersion(t,4),e}function parse_DataSpaceMapEntry(t){for(var e=t.read_shift(4),i=t.l+e-4,r={},n=t.read_shift(4),s=[];n-- >0;)s.push({t:t.read_shift(4),v:t.read_shift(0,"lpp4")});if(r.name=t.read_shift(0,"lpp4"),r.comps=s,t.l!=i)throw new Error("Bad DataSpaceMapEntry: "+t.l+" != "+i);return r}function parse_DataSpaceMap(t){var e=[];t.l+=4;for(var i=t.read_shift(4);i-- >0;)e.push(parse_DataSpaceMapEntry(t));return e}function parse_DataSpaceDefinition(t){var e=[];t.l+=4;for(var i=t.read_shift(4);i-- >0;)e.push(t.read_shift(0,"lpp4"));return e}function parse_TransformInfoHeader(t){var e={};return t.read_shift(4),t.l+=4,e.id=t.read_shift(0,"lpp4"),e.name=t.read_shift(0,"lpp4"),e.R=parse_CRYPTOVersion(t,4),e.U=parse_CRYPTOVersion(t,4),e.W=parse_CRYPTOVersion(t,4),e}function parse_Primary(t){var e=parse_TransformInfoHeader(t);if(e.ename=t.read_shift(0,"8lpp4"),e.blksz=t.read_shift(4),e.cmode=t.read_shift(4),4!=t.read_shift(4))throw new Error("Bad !Primary record");return e}function parse_EncryptionHeader(t,e){var i=t.l+e,r={};r.Flags=63&t.read_shift(4),t.l+=4,r.AlgID=t.read_shift(4);var n=!1;switch(r.AlgID){case 26126:case 26127:case 26128:n=36==r.Flags;break;case 26625:n=4==r.Flags;break;case 0:n=16==r.Flags||4==r.Flags||36==r.Flags;break;default:throw"Unrecognized encryption algorithm: "+r.AlgID}if(!n)throw new Error("Encryption Flags/AlgID mismatch");return r.AlgIDHash=t.read_shift(4),r.KeySize=t.read_shift(4),r.ProviderType=t.read_shift(4),t.l+=8,r.CSPName=t.read_shift(i-t.l>>1,"utf16le"),t.l=i,r}function parse_EncryptionVerifier(t,e){var i={},r=t.l+e;return t.l+=4,i.Salt=t.slice(t.l,t.l+16),t.l+=16,i.Verifier=t.slice(t.l,t.l+16),t.l+=16,t.read_shift(4),i.VerifierHash=t.slice(t.l,r),t.l=r,i}function parse_EncryptionInfo(t){var e=parse_CRYPTOVersion(t);switch(e.Minor){case 2:return[e.Minor,parse_EncInfoStd(t)];case 3:return[e.Minor,parse_EncInfoExt()];case 4:return[e.Minor,parse_EncInfoAgl(t)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+e.Minor)}function parse_EncInfoStd(t){if(36!=(63&t.read_shift(4)))throw new Error("EncryptionInfo mismatch");var e=t.read_shift(4);return{t:"Std",h:parse_EncryptionHeader(t,e),v:parse_EncryptionVerifier(t,t.length-t.l)}}function parse_EncInfoExt(){throw new Error("File is password-protected: ECMA-376 Extensible")}function parse_EncInfoAgl(t){var e=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];t.l+=4;var i=t.read_shift(t.length-t.l,"utf8"),r={};return i.replace(tagregex,(function(t){var i=parsexmltag(t);switch(strip_ns(i[0])){case"<?xml":case"<encryption":case"</encryption>":case"</keyEncryptors>":case"</keyEncryptor>":break;case"<keyData":e.forEach((function(t){r[t]=i[t]}));break;case"<dataIntegrity":r.encryptedHmacKey=i.encryptedHmacKey,r.encryptedHmacValue=i.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":r.encs=[];break;case"<keyEncryptor":r.uri=i.uri;break;case"<encryptedKey":r.encs.push(i);break;default:throw i[0]}})),r}function parse_RC4CryptoHeader(t,e){var i={},r=i.EncryptionVersionInfo=parse_CRYPTOVersion(t,4);if(e-=4,2!=r.Minor)throw new Error("unrecognized minor version code: "+r.Minor);if(r.Major>4||r.Major<2)throw new Error("unrecognized major version code: "+r.Major);i.Flags=t.read_shift(4),e-=4;var n=t.read_shift(4);return e-=4,i.EncryptionHeader=parse_EncryptionHeader(t,n),e-=n,i.EncryptionVerifier=parse_EncryptionVerifier(t,e),i}function parse_RC4Header(t){var e={},i=e.EncryptionVersionInfo=parse_CRYPTOVersion(t,4);if(1!=i.Major||1!=i.Minor)throw"unrecognized version code "+i.Major+" : "+i.Minor;return e.Salt=t.read_shift(16),e.EncryptedVerifier=t.read_shift(16),e.EncryptedVerifierHash=t.read_shift(16),e}function crypto_CreatePasswordVerifier_Method1(t){var e,i,r=0,n=_JS2ANSI(t),s=n.length+1;for((e=new_raw_buf(s))[0]=n.length,i=1;i!=s;++i)e[i]=n[i-1];for(i=s-1;i>=0;--i)r=((16384&r?1:0)|r<<1&32767)^e[i];return 52811^r}var crypto_CreateXorArray_Method1=function(){var t=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],e=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],i=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],r=function(t,e){return 255&((i=t^e)/2|128*i);var i};return function(n){for(var s,o,a,l=_JS2ANSI(n),c=function(t){for(var r=e[t.length-1],n=104,s=t.length-1;s>=0;--s)for(var o=t[s],a=0;7!=a;++a)64&o&&(r^=i[n]),o*=2,--n;return r}(l),h=l.length,u=new_raw_buf(16),d=0;16!=d;++d)u[d]=0;for(1&~h||(s=c>>8,u[h]=r(t[0],s),--h,s=255&c,o=l[l.length-1],u[h]=r(o,s));h>0;)s=c>>8,u[--h]=r(l[h],s),s=255&c,u[--h]=r(l[h],s);for(h=15,a=15-l.length;a>0;)s=c>>8,u[h]=r(t[a],s),--a,s=255&c,u[--h]=r(l[h],s),--h,--a;return u}}(),crypto_DecryptData_Method1=function(t,e,i,r,n){var s,o;for(n||(n=e),r||(r=crypto_CreateXorArray_Method1(t)),s=0;s!=e.length;++s)o=e[s],o=255&((o^=r[i])>>5|o<<3),n[s]=o,++i;return[n,i,r]},crypto_MakeXorDecryptor=function(t){var e=0,i=crypto_CreateXorArray_Method1(t);return function(t){var r=crypto_DecryptData_Method1("",t,e,i);return e=r[1],r[0]}};function parse_XORObfuscation(t,e,i,r){var n={key:parseuint16(t),verificationBytes:parseuint16(t)};return i.password&&(n.verifier=crypto_CreatePasswordVerifier_Method1(i.password)),r.valid=n.verificationBytes===n.verifier,r.valid&&(r.insitu=crypto_MakeXorDecryptor(i.password)),n}function parse_FilePassHeader(t,e,i){var r=i||{};return r.Info=t.read_shift(2),t.l-=2,1===r.Info?r.Data=parse_RC4Header(t):r.Data=parse_RC4CryptoHeader(t,e),r}function parse_FilePass(t,e,i){var r={Type:i.biff>=8?t.read_shift(2):0};return r.Type?parse_FilePassHeader(t,e-2,r):parse_XORObfuscation(t,i.biff>=8?e:e-2,i,r),r}var RTF=function(){function t(t,i){switch(i.type){case"base64":return e(Base64_decode(t),i);case"binary":return e(t,i);case"buffer":return e(has_buf&&Buffer.isBuffer(t)?t.toString("binary"):a2s(t),i);case"array":return e(cc2str(t),i)}throw new Error("Unrecognized type "+i.type)}function e(t,e){var i=(e||{}).dense?[]:{},r=t.match(/\\trowd.*?\\row\b/g);if(!r.length)throw new Error("RTF missing table");var n={s:{c:0,r:0},e:{c:0,r:r.length-1}};return r.forEach((function(t,e){Array.isArray(i)&&(i[e]=[]);for(var r,s=/\\\w+\b/g,o=0,a=-1;r=s.exec(t);){if("\\cell"===r[0]){var l=t.slice(o,s.lastIndex-r[0].length);if(" "==l[0]&&(l=l.slice(1)),++a,l.length){var c={v:l,t:"s"};Array.isArray(i)?i[e][a]=c:i[encode_cell({r:e,c:a})]=c}}o=s.lastIndex}a>n.e.c&&(n.e.c=a)})),i["!ref"]=encode_range(n),i}return{to_workbook:function(e,i){return sheet_to_workbook(t(e,i),i)},to_sheet:t,from_sheet:function(t){for(var e,i=["{\\rtf1\\ansi"],r=safe_decode_range(t["!ref"]),n=Array.isArray(t),s=r.s.r;s<=r.e.r;++s){i.push("\\trowd\\trautofit1");for(var o=r.s.c;o<=r.e.c;++o)i.push("\\cellx"+(o+1));for(i.push("\\pard\\intbl"),o=r.s.c;o<=r.e.c;++o){var a=encode_cell({r:s,c:o});(e=n?(t[s]||[])[o]:t[a])&&(null!=e.v||e.f&&!e.F)&&(i.push(" "+(e.w||(format_cell(e),e.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}}}();function hex2RGB(t){var e=t.slice("#"===t[0]?1:0).slice(0,6);return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function rgb2Hex(t){for(var e=0,i=1;3!=e;++e)i=256*i+(t[e]>255?255:t[e]<0?0:t[e]);return i.toString(16).toUpperCase().slice(1)}function rgb2HSL(t){var e=t[0]/255,i=t[1]/255,r=t[2]/255,n=Math.max(e,i,r),s=Math.min(e,i,r),o=n-s;if(0===o)return[0,0,e];var a,l=0,c=n+s;switch(a=o/(c>1?2-c:c),n){case e:l=((i-r)/o+6)%6;break;case i:l=(r-e)/o+2;break;case r:l=(e-i)/o+4}return[l/6,a,c/2]}function hsl2RGB(t){var e,i=t[0],r=t[1],n=t[2],s=2*r*(n<.5?n:1-n),o=n-s/2,a=[o,o,o],l=6*i;if(0!==r)switch(0|l){case 0:case 6:e=s*l,a[0]+=s,a[1]+=e;break;case 1:e=s*(2-l),a[0]+=e,a[1]+=s;break;case 2:e=s*(l-2),a[1]+=s,a[2]+=e;break;case 3:e=s*(4-l),a[1]+=e,a[2]+=s;break;case 4:e=s*(l-4),a[2]+=s,a[0]+=e;break;case 5:e=s*(6-l),a[2]+=e,a[0]+=s}for(var c=0;3!=c;++c)a[c]=Math.round(255*a[c]);return a}function rgb_tint(t,e){if(0===e)return t;var i=rgb2HSL(hex2RGB(t));return i[2]=e<0?i[2]*(1+e):1-(1-i[2])*(1-e),rgb2Hex(hsl2RGB(i))}var DEF_MDW=6,MAX_MDW=15,MIN_MDW=1,MDW=DEF_MDW;function width2px(t){return Math.floor((t+Math.round(128/MDW)/256)*MDW)}function px2char(t){return Math.floor((t-5)/MDW*100+.5)/100}function char2width(t){return Math.round((t*MDW+5)/MDW*256)/256}function cycle_width(t){return char2width(px2char(width2px(t)))}function find_mdw_colw(t){var e=Math.abs(t-cycle_width(t)),i=MDW;if(e>.005)for(MDW=MIN_MDW;MDW<MAX_MDW;++MDW)Math.abs(t-cycle_width(t))<=e&&(e=Math.abs(t-cycle_width(t)),i=MDW);MDW=i}function process_col(t){t.width?(t.wpx=width2px(t.width),t.wch=px2char(t.wpx),t.MDW=MDW):t.wpx?(t.wch=px2char(t.wpx),t.width=char2width(t.wch),t.MDW=MDW):"number"==typeof t.wch&&(t.width=char2width(t.wch),t.wpx=width2px(t.width),t.MDW=MDW),t.customWidth&&delete t.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(t){return 96*t/PPI}function pt2px(t){return t*PPI/96}var XLMLPatternTypeMap={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function parse_borders(t,e,i,r){e.Borders=[];var n={},s=!1;(t[0].match(tagregex)||[]).forEach((function(t){var i=parsexmltag(t);switch(strip_ns(i[0])){case"<borders":case"<borders>":case"</borders>":case"</border>":case"<left/>":case"<left":case"<left>":case"</left>":case"<right/>":case"<right":case"<right>":case"</right>":case"<top/>":case"<top":case"<top>":case"</top>":case"<bottom/>":case"<bottom":case"<bottom>":case"</bottom>":case"<diagonal":case"<diagonal>":case"<diagonal/>":case"</diagonal>":case"<horizontal":case"<horizontal>":case"<horizontal/>":case"</horizontal>":case"<vertical":case"<vertical>":case"<vertical/>":case"</vertical>":case"<start":case"<start>":case"<start/>":case"</start>":case"<end":case"<end>":case"<end/>":case"</end>":case"<color":case"<color>":case"<color/>":case"</color>":case"<extLst":case"<extLst>":case"</extLst>":break;case"<border":case"<border>":case"<border/>":n={},i.diagonalUp&&(n.diagonalUp=parsexmlbool(i.diagonalUp)),i.diagonalDown&&(n.diagonalDown=parsexmlbool(i.diagonalDown)),e.Borders.push(n);break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+i[0]+" in borders")}}))}function parse_fills(t,e,i,r){e.Fills=[];var n={},s=!1;(t[0].match(tagregex)||[]).forEach((function(t){var i=parsexmltag(t);switch(strip_ns(i[0])){case"<fills":case"<fills>":case"</fills>":case"</fill>":case"<gradientFill>":case"<patternFill/>":case"</patternFill>":case"<bgColor/>":case"</bgColor>":case"<fgColor/>":case"</fgColor>":case"<stop":case"<stop/>":case"</stop>":case"<color":case"<color/>":case"</color>":case"<extLst":case"<extLst>":case"</extLst>":break;case"<fill>":case"<fill":case"<fill/>":n={},e.Fills.push(n);break;case"<gradientFill":case"</gradientFill>":e.Fills.push(n),n={};break;case"<patternFill":case"<patternFill>":i.patternType&&(n.patternType=i.patternType);break;case"<bgColor":n.bgColor||(n.bgColor={}),i.indexed&&(n.bgColor.indexed=parseInt(i.indexed,10)),i.theme&&(n.bgColor.theme=parseInt(i.theme,10)),i.tint&&(n.bgColor.tint=parseFloat(i.tint)),i.rgb&&(n.bgColor.rgb=i.rgb.slice(-6));break;case"<fgColor":n.fgColor||(n.fgColor={}),i.theme&&(n.fgColor.theme=parseInt(i.theme,10)),i.tint&&(n.fgColor.tint=parseFloat(i.tint)),null!=i.rgb&&(n.fgColor.rgb=i.rgb.slice(-6));break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+i[0]+" in fills")}}))}function parse_fonts(t,e,i,r){e.Fonts=[];var n={},s=!1;(t[0].match(tagregex)||[]).forEach((function(t){var o=parsexmltag(t);switch(strip_ns(o[0])){case"<fonts":case"<fonts>":case"</fonts>":case"<font":case"<font>":case"<name/>":case"</name>":case"<sz/>":case"</sz>":case"<vertAlign/>":case"</vertAlign>":case"<family/>":case"</family>":case"<scheme/>":case"</scheme>":case"<color/>":case"</color>":case"<extLst":case"<extLst>":case"</extLst>":break;case"</font>":case"<font/>":e.Fonts.push(n),n={};break;case"<name":o.val&&(n.name=utf8read(o.val));break;case"<b":n.bold=o.val?parsexmlbool(o.val):1;break;case"<b/>":n.bold=1;break;case"<i":n.italic=o.val?parsexmlbool(o.val):1;break;case"<i/>":n.italic=1;break;case"<u":switch(o.val){case"none":n.underline=0;break;case"single":n.underline=1;break;case"double":n.underline=2;break;case"singleAccounting":n.underline=33;break;case"doubleAccounting":n.underline=34}break;case"<u/>":n.underline=1;break;case"<strike":n.strike=o.val?parsexmlbool(o.val):1;break;case"<strike/>":n.strike=1;break;case"<outline":n.outline=o.val?parsexmlbool(o.val):1;break;case"<outline/>":n.outline=1;break;case"<shadow":n.shadow=o.val?parsexmlbool(o.val):1;break;case"<shadow/>":n.shadow=1;break;case"<condense":n.condense=o.val?parsexmlbool(o.val):1;break;case"<condense/>":n.condense=1;break;case"<extend":n.extend=o.val?parsexmlbool(o.val):1;break;case"<extend/>":n.extend=1;break;case"<sz":o.val&&(n.sz=+o.val);break;case"<vertAlign":o.val&&(n.vertAlign=o.val);break;case"<family":o.val&&(n.family=parseInt(o.val,10));break;case"<scheme":o.val&&(n.scheme=o.val);break;case"<charset":if("1"==o.val)break;o.codepage=CS2CP[parseInt(o.val,10)];break;case"<color":if(n.color||(n.color={}),o.auto&&(n.color.auto=parsexmlbool(o.auto)),o.rgb)n.color.rgb=o.rgb.slice(-6);else if(o.indexed){n.color.index=parseInt(o.indexed,10);var a=XLSIcv[n.color.index];81==n.color.index&&(a=XLSIcv[1]),a||(a=XLSIcv[1]),n.color.rgb=a[0].toString(16)+a[1].toString(16)+a[2].toString(16)}else o.theme&&(n.color.theme=parseInt(o.theme,10),o.tint&&(n.color.tint=parseFloat(o.tint)),o.theme&&i.themeElements&&i.themeElements.clrScheme&&(n.color.rgb=rgb_tint(i.themeElements.clrScheme[n.color.theme].rgb,n.color.tint||0)));break;case"<AlternateContent":case"<ext":s=!0;break;case"</AlternateContent>":case"</ext>":s=!1;break;default:if(r&&r.WTF&&!s)throw new Error("unrecognized "+o[0]+" in fonts")}}))}function parse_numFmts(t,e,i){e.NumberFmt=[];for(var r=keys(table_fmt),n=0;n<r.length;++n)e.NumberFmt[r[n]]=table_fmt[r[n]];var s=t[0].match(tagregex);if(s)for(n=0;n<s.length;++n){var o=parsexmltag(s[n]);switch(strip_ns(o[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":case"</numFmt>":break;case"<numFmt":var a=unescapexml(utf8read(o.formatCode)),l=parseInt(o.numFmtId,10);if(e.NumberFmt[l]=a,l>0){if(l>392){for(l=392;l>60&&null!=e.NumberFmt[l];--l);e.NumberFmt[l]=a}SSF_load(a,l)}break;default:if(i.WTF)throw new Error("unrecognized "+o[0]+" in numFmts")}}}var cellXF_uint=["numFmtId","fillId","fontId","borderId","xfId"],cellXF_bool=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function parse_cellXfs(t,e,i){var r;e.CellXf=[];var n=!1;(t[0].match(tagregex)||[]).forEach((function(t){var s=parsexmltag(t),o=0;switch(strip_ns(s[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":case"</xf>":case"</alignment>":case"<protection":case"</protection>":case"<protection/>":case"<extLst":case"<extLst>":case"</extLst>":break;case"<xf":case"<xf/>":for(delete(r=s)[0],o=0;o<cellXF_uint.length;++o)r[cellXF_uint[o]]&&(r[cellXF_uint[o]]=parseInt(r[cellXF_uint[o]],10));for(o=0;o<cellXF_bool.length;++o)r[cellXF_bool[o]]&&(r[cellXF_bool[o]]=parsexmlbool(r[cellXF_bool[o]]));if(e.NumberFmt&&r.numFmtId>392)for(o=392;o>60;--o)if(e.NumberFmt[r.numFmtId]==e.NumberFmt[o]){r.numFmtId=o;break}e.CellXf.push(r);break;case"<alignment":case"<alignment/>":var a={};s.vertical&&(a.vertical=s.vertical),s.horizontal&&(a.horizontal=s.horizontal),null!=s.textRotation&&(a.textRotation=s.textRotation),s.indent&&(a.indent=s.indent),s.wrapText&&(a.wrapText=parsexmlbool(s.wrapText)),r.alignment=a;break;case"<AlternateContent":case"<ext":n=!0;break;case"</AlternateContent>":case"</ext>":n=!1;break;default:if(i&&i.WTF&&!n)throw new Error("unrecognized "+s[0]+" in cellXfs")}}))}var parse_sty_xml=function(){var t=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,e=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,i=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,r=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,n=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(s,o,a){var l,c={};return s?((l=(s=s.replace(/<!--([\s\S]*?)-->/gm,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"")).match(t))&&parse_numFmts(l,c,a),(l=s.match(r))&&parse_fonts(l,c,o,a),(l=s.match(i))&&parse_fills(l,c,o,a),(l=s.match(n))&&parse_borders(l,c,o,a),(l=s.match(e))&&parse_cellXfs(l,c,a),c):c}}();function parse_BrtFmt(t,e){return[t.read_shift(2),parse_XLWideString(t)]}function parse_BrtFont(t,e,i){var r={};r.sz=t.read_shift(2)/20;var n=parse_FontFlags(t);switch(n.fItalic&&(r.italic=1),n.fCondense&&(r.condense=1),n.fExtend&&(r.extend=1),n.fShadow&&(r.shadow=1),n.fOutline&&(r.outline=1),n.fStrikeout&&(r.strike=1),700===t.read_shift(2)&&(r.bold=1),t.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var s=t.read_shift(1);0!=s&&(r.underline=s);var o=t.read_shift(1);o>0&&(r.family=o);var a=t.read_shift(1);switch(a>0&&(r.charset=a),t.l++,r.color=parse_BrtColor(t),t.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=parse_XLWideString(t),r}var parse_BrtFill=parsenoop;function parse_BrtXF(t,e){var i=t.l+e,r=t.read_shift(2),n=t.read_shift(2);return t.l=i,{ixfe:r,numFmtId:n}}var parse_BrtBorder=parsenoop;function parse_sty_bin(t,e,i){var r={NumberFmt:[]};for(var n in table_fmt)r.NumberFmt[n]=table_fmt[n];r.CellXf=[],r.Fonts=[];var s=[],o=!1;return recordhopper(t,(function(t,n,a){switch(a){case 44:r.NumberFmt[t[0]]=t[1],SSF_load(t[1],t[0]);break;case 43:r.Fonts.push(t),null!=t.color.theme&&e&&e.themeElements&&e.themeElements.clrScheme&&(t.color.rgb=rgb_tint(e.themeElements.clrScheme[t.color.theme].rgb,t.color.tint||0));break;case 1025:case 45:case 46:case 48:case 507:case 572:case 475:case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 47:617==s[s.length-1]&&r.CellXf.push(t);break;case 35:o=!0;break;case 36:o=!1;break;case 37:s.push(a),o=!0;break;case 38:s.pop(),o=!1;break;default:if(n.T>0)s.push(a);else if(n.T<0)s.pop();else if(!o||i.WTF&&37!=s[s.length-1])throw new Error("Unexpected record 0x"+a.toString(16))}})),r}var XLSXThemeClrScheme=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function parse_clrScheme(t,e,i){e.themeElements.clrScheme=[];var r={};(t[0].match(tagregex)||[]).forEach((function(t){var n=parsexmltag(t);switch(n[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":r.rgb=n.val;break;case"<a:sysClr":r.rgb=n.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":"/"===n[0].charAt(1)?(e.themeElements.clrScheme[XLSXThemeClrScheme.indexOf(n[0])]=r,r={}):r.name=n[0].slice(3,n[0].length-1);break;default:if(i&&i.WTF)throw new Error("Unrecognized "+n[0]+" in clrScheme")}}))}function parse_fontScheme(){}function parse_fmtScheme(){}var clrsregex=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,fntsregex=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,fmtsregex=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function parse_themeElements(t,e,i){var r;e.themeElements={},[["clrScheme",clrsregex,parse_clrScheme],["fontScheme",fntsregex,parse_fontScheme],["fmtScheme",fmtsregex,parse_fmtScheme]].forEach((function(n){if(!(r=t.match(n[1])))throw new Error(n[0]+" not found in themeElements");n[2](r,e,i)}))}var themeltregex=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function parse_theme_xml(t,e){var i;t&&0!==t.length||(t=write_theme());var r={};if(!(i=t.match(themeltregex)))throw new Error("themeElements not found in theme");return parse_themeElements(i[0],r,e),r.raw=t,r}function write_theme(t,e){var i=[XML_HEADER];return i[i.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',i[i.length]="<a:themeElements>",i[i.length]='<a:clrScheme name="Office">',i[i.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',i[i.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',i[i.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',i[i.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',i[i.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',i[i.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',i[i.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',i[i.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',i[i.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',i[i.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',i[i.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',i[i.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',i[i.length]="</a:clrScheme>",i[i.length]='<a:fontScheme name="Office">',i[i.length]="<a:majorFont>",i[i.length]='<a:latin typeface="Cambria"/>',i[i.length]='<a:ea typeface=""/>',i[i.length]='<a:cs typeface=""/>',i[i.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',i[i.length]='<a:font script="Hang" typeface="맑은 고딕"/>',i[i.length]='<a:font script="Hans" typeface="宋体"/>',i[i.length]='<a:font script="Hant" typeface="新細明體"/>',i[i.length]='<a:font script="Arab" typeface="Times New Roman"/>',i[i.length]='<a:font script="Hebr" typeface="Times New Roman"/>',i[i.length]='<a:font script="Thai" typeface="Tahoma"/>',i[i.length]='<a:font script="Ethi" typeface="Nyala"/>',i[i.length]='<a:font script="Beng" typeface="Vrinda"/>',i[i.length]='<a:font script="Gujr" typeface="Shruti"/>',i[i.length]='<a:font script="Khmr" typeface="MoolBoran"/>',i[i.length]='<a:font script="Knda" typeface="Tunga"/>',i[i.length]='<a:font script="Guru" typeface="Raavi"/>',i[i.length]='<a:font script="Cans" typeface="Euphemia"/>',i[i.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',i[i.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',i[i.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',i[i.length]='<a:font script="Thaa" typeface="MV Boli"/>',i[i.length]='<a:font script="Deva" typeface="Mangal"/>',i[i.length]='<a:font script="Telu" typeface="Gautami"/>',i[i.length]='<a:font script="Taml" typeface="Latha"/>',i[i.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',i[i.length]='<a:font script="Orya" typeface="Kalinga"/>',i[i.length]='<a:font script="Mlym" typeface="Kartika"/>',i[i.length]='<a:font script="Laoo" typeface="DokChampa"/>',i[i.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',i[i.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',i[i.length]='<a:font script="Viet" typeface="Times New Roman"/>',i[i.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',i[i.length]='<a:font script="Geor" typeface="Sylfaen"/>',i[i.length]="</a:majorFont>",i[i.length]="<a:minorFont>",i[i.length]='<a:latin typeface="Calibri"/>',i[i.length]='<a:ea typeface=""/>',i[i.length]='<a:cs typeface=""/>',i[i.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',i[i.length]='<a:font script="Hang" typeface="맑은 고딕"/>',i[i.length]='<a:font script="Hans" typeface="宋体"/>',i[i.length]='<a:font script="Hant" typeface="新細明體"/>',i[i.length]='<a:font script="Arab" typeface="Arial"/>',i[i.length]='<a:font script="Hebr" typeface="Arial"/>',i[i.length]='<a:font script="Thai" typeface="Tahoma"/>',i[i.length]='<a:font script="Ethi" typeface="Nyala"/>',i[i.length]='<a:font script="Beng" typeface="Vrinda"/>',i[i.length]='<a:font script="Gujr" typeface="Shruti"/>',i[i.length]='<a:font script="Khmr" typeface="DaunPenh"/>',i[i.length]='<a:font script="Knda" typeface="Tunga"/>',i[i.length]='<a:font script="Guru" typeface="Raavi"/>',i[i.length]='<a:font script="Cans" typeface="Euphemia"/>',i[i.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',i[i.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',i[i.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',i[i.length]='<a:font script="Thaa" typeface="MV Boli"/>',i[i.length]='<a:font script="Deva" typeface="Mangal"/>',i[i.length]='<a:font script="Telu" typeface="Gautami"/>',i[i.length]='<a:font script="Taml" typeface="Latha"/>',i[i.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',i[i.length]='<a:font script="Orya" typeface="Kalinga"/>',i[i.length]='<a:font script="Mlym" typeface="Kartika"/>',i[i.length]='<a:font script="Laoo" typeface="DokChampa"/>',i[i.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',i[i.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',i[i.length]='<a:font script="Viet" typeface="Arial"/>',i[i.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',i[i.length]='<a:font script="Geor" typeface="Sylfaen"/>',i[i.length]="</a:minorFont>",i[i.length]="</a:fontScheme>",i[i.length]='<a:fmtScheme name="Office">',i[i.length]="<a:fillStyleLst>",i[i.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:lin ang="16200000" scaled="1"/>',i[i.length]="</a:gradFill>",i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:lin ang="16200000" scaled="0"/>',i[i.length]="</a:gradFill>",i[i.length]="</a:fillStyleLst>",i[i.length]="<a:lnStyleLst>",i[i.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',i[i.length]="</a:lnStyleLst>",i[i.length]="<a:effectStyleLst>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]="</a:effectStyle>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]="</a:effectStyle>",i[i.length]="<a:effectStyle>",i[i.length]="<a:effectLst>",i[i.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',i[i.length]="</a:effectLst>",i[i.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',i[i.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',i[i.length]="</a:effectStyle>",i[i.length]="</a:effectStyleLst>",i[i.length]="<a:bgFillStyleLst>",i[i.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',i[i.length]="</a:gradFill>",i[i.length]='<a:gradFill rotWithShape="1">',i[i.length]="<a:gsLst>",i[i.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',i[i.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',i[i.length]="</a:gsLst>",i[i.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',i[i.length]="</a:gradFill>",i[i.length]="</a:bgFillStyleLst>",i[i.length]="</a:fmtScheme>",i[i.length]="</a:themeElements>",i[i.length]="<a:objectDefaults>",i[i.length]="<a:spDef>",i[i.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',i[i.length]="</a:spDef>",i[i.length]="<a:lnDef>",i[i.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',i[i.length]="</a:lnDef>",i[i.length]="</a:objectDefaults>",i[i.length]="<a:extraClrSchemeLst/>",i[i.length]="</a:theme>",i.join("")}function parse_Theme(t,i,r){var n=t.l+i;if(124226!==t.read_shift(4))if(r.cellStyles){var s,o=t.slice(t.l);t.l=n;try{s=zip_read(o,{type:"array"})}catch(e){return}var a=getzipstr(s,"theme/theme/theme1.xml",!0);if(a)return parse_theme_xml(a,r)}else t.l=n}function parse_ColorTheme(t){return t.read_shift(4)}function parse_FullColorExt(t){var e={};switch(e.xclrType=t.read_shift(2),e.nTintShade=t.read_shift(2),e.xclrType){case 0:case 4:t.l+=4;break;case 1:e.xclrValue=parse_IcvXF(t,4);break;case 2:e.xclrValue=parse_LongRGBA(t);break;case 3:e.xclrValue=parse_ColorTheme(t)}return t.l+=8,e}function parse_IcvXF(t,e){return parsenoop(t,e)}function parse_XFExtGradient(t,e){return parsenoop(t,e)}function parse_ExtProp(t){var e=t.read_shift(2),i=t.read_shift(2)-4,r=[e];switch(e){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:r[1]=parse_FullColorExt(t);break;case 6:r[1]=parse_XFExtGradient(t,i);break;case 14:case 15:r[1]=t.read_shift(1===i?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+e+" "+i)}return r}function parse_XFExt(t,e){var i=t.l+e;t.l+=2;var r=t.read_shift(2);t.l+=2;for(var n=t.read_shift(2),s=[];n-- >0;)s.push(parse_ExtProp(t,i-t.l));return{ixfe:r,ext:s}}function update_xfext(t,e){e.forEach((function(t){t[0]}))}function parse_BrtMdtinfo(t,e){return{flags:t.read_shift(4),version:t.read_shift(4),name:parse_XLWideString(t)}}function parse_BrtMdb(t){for(var e=[],i=t.read_shift(4);i-- >0;)e.push([t.read_shift(4),t.read_shift(4)]);return e}function parse_BrtBeginEsmdb(t){return t.l+=4,0!=t.read_shift(4)}function parse_xlmeta_bin(t,e,i){var r={Types:[],Cell:[],Value:[]},n=i||{},s=[],o=!1,a=2;return recordhopper(t,(function(t,e,i){switch(i){case 335:r.Types.push({name:t.name});break;case 51:t.forEach((function(t){1==a?r.Cell.push({type:r.Types[t[0]-1].name,index:t[1]}):0==a&&r.Value.push({type:r.Types[t[0]-1].name,index:t[1]})}));break;case 337:a=t?1:0;break;case 338:a=2;break;case 35:s.push(i),o=!0;break;case 36:s.pop(),o=!1;break;default:if(e.T);else if(!o||n.WTF&&35!=s[s.length-1])throw new Error("Unexpected record 0x"+i.toString(16))}})),r}function parse_xlmeta_xml(t,e,i){var r={Types:[],Cell:[],Value:[]};if(!t)return r;var n,s=!1,o=2;return t.replace(tagregex,(function(t){var e=parsexmltag(t);switch(strip_ns(e[0])){case"<?xml":case"<metadata":case"</metadata>":case"<metadataTypes":case"</metadataTypes>":case"</metadataType>":case"</futureMetadata>":case"<bk>":case"</bk>":case"</rc>":case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<metadataType":r.Types.push({name:e.name});break;case"<futureMetadata":for(var a=0;a<r.Types.length;++a)r.Types[a].name==e.name&&(n=r.Types[a]);break;case"<rc":1==o?r.Cell.push({type:r.Types[e.t-1].name,index:+e.v}):0==o&&r.Value.push({type:r.Types[e.t-1].name,index:+e.v});break;case"<cellMetadata":o=1;break;case"</cellMetadata>":case"</valueMetadata>":o=2;break;case"<valueMetadata":o=0;break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<rvb":if(!n)break;n.offsets||(n.offsets=[]),n.offsets.push(+e.i);break;default:if(!s&&i.WTF)throw new Error("unrecognized "+e[0]+" in metadata")}return t})),r}function parse_cc_xml(t){var e=[];if(!t)return e;var i=1;return(t.match(tagregex)||[]).forEach((function(t){var r=parsexmltag(t);switch(r[0]){case"<?xml":case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete r[0],r.i?i=r.i:r.i=i,e.push(r)}})),e}function parse_BrtCalcChainItem$(t){var e={};e.i=t.read_shift(4);var i={};i.r=t.read_shift(4),i.c=t.read_shift(4),e.r=encode_cell(i);var r=t.read_shift(1);return 2&r&&(e.l="1"),8&r&&(e.a="1"),e}function parse_cc_bin(t,e,i){var r=[];return recordhopper(t,(function(t,e,i){if(63===i)r.push(t);else if(!e.T)throw new Error("Unexpected record 0x"+i.toString(16))})),r}function parse_xlink_xml(){}function parse_xlink_bin(t,e,i,r){if(!t)return t;var n=r||{},s=!1;recordhopper(t,(function(t,e,i){switch(i){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:s=!0;break;case 36:s=!1;break;default:if(e.T);else if(!s||n.WTF)throw new Error("Unexpected record 0x"+i.toString(16))}}),n)}function parse_drawing(t,e){if(!t)return"??";var i=(t.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return e["!id"][i].Target}function sheet_insert_comments(t,e,i,r){var n,s=Array.isArray(t);e.forEach((function(e){var o=decode_cell(e.ref);if(s?(t[o.r]||(t[o.r]=[]),n=t[o.r][o.c]):n=t[e.ref],!n){n={t:"z"},s?t[o.r][o.c]=n:t[e.ref]=n;var a=safe_decode_range(t["!ref"]||"BDWGO1000001:A1");a.s.r>o.r&&(a.s.r=o.r),a.e.r<o.r&&(a.e.r=o.r),a.s.c>o.c&&(a.s.c=o.c),a.e.c<o.c&&(a.e.c=o.c);var l=encode_range(a);l!==t["!ref"]&&(t["!ref"]=l)}n.c||(n.c=[]);var c={a:e.author,t:e.t,r:e.r,T:i};e.h&&(c.h=e.h);for(var h=n.c.length-1;h>=0;--h){if(!i&&n.c[h].T)return;i&&!n.c[h].T&&n.c.splice(h,1)}if(i&&r)for(h=0;h<r.length;++h)if(c.a==r[h].id){c.a=r[h].name||c.a;break}n.c.push(c)}))}function parse_comments_xml(t,e){if(t.match(/<(?:\w+:)?comments *\/>/))return[];var i=[],r=[],n=t.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);n&&n[1]&&n[1].split(/<\/\w*:?author>/).forEach((function(t){if(""!==t&&""!==t.trim()){var e=t.match(/<(?:\w+:)?author[^>]*>(.*)/);e&&i.push(e[1])}}));var s=t.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return s&&s[1]&&s[1].split(/<\/\w*:?comment>/).forEach((function(t){if(""!==t&&""!==t.trim()){var n=t.match(/<(?:\w+:)?comment[^>]*>/);if(n){var s=parsexmltag(n[0]),o={author:s.authorId&&i[s.authorId]||"sheetjsghost",ref:s.ref,guid:s.guid},a=decode_cell(s.ref);if(!(e.sheetRows&&e.sheetRows<=a.r)){var l=t.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),c=!!l&&!!l[1]&&parse_si(l[1])||{r:"",t:"",h:""};o.r=c.r,"<t></t>"==c.r&&(c.t=c.h=""),o.t=(c.t||"").replace(/\r\n/g,"\n").replace(/\r/g,"\n"),e.cellHTML&&(o.h=c.h),r.push(o)}}}})),r}function parse_tcmnt_xml(t,e){var i=[],r=!1,n={},s=0;return t.replace(tagregex,(function(o,a){var l=parsexmltag(o);switch(strip_ns(l[0])){case"<?xml":case"<ThreadedComments":case"</ThreadedComments>":case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<threadedComment":n={author:l.personId,guid:l.id,ref:l.ref,T:1};break;case"</threadedComment>":null!=n.t&&i.push(n);break;case"<text>":case"<text":s=a+o.length;break;case"</text>":n.t=t.slice(s,a).replace(/\r\n/g,"\n").replace(/\r/g,"\n");break;case"<mentions":case"<mentions>":case"<ext":r=!0;break;case"</mentions>":case"</ext>":r=!1;break;default:if(!r&&e.WTF)throw new Error("unrecognized "+l[0]+" in threaded comments")}return o})),i}function parse_people_xml(t,e){var i=[],r=!1;return t.replace(tagregex,(function(t){var n=parsexmltag(t);switch(strip_ns(n[0])){case"<?xml":case"<personList":case"</personList>":case"</person>":case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<person":i.push({name:n.displayname,id:n.id});break;case"<ext":r=!0;break;case"</ext>":r=!1;break;default:if(!r&&e.WTF)throw new Error("unrecognized "+n[0]+" in threaded comments")}return t})),i}function parse_BrtBeginComment(t){var e={};e.iauthor=t.read_shift(4);var i=parse_UncheckedRfX(t);return e.rfx=i.s,e.ref=encode_cell(i.s),t.l+=16,e}var parse_BrtCommentAuthor=parse_XLWideString;function parse_comments_bin(t,e){var i=[],r=[],n={},s=!1;return recordhopper(t,(function(t,o,a){switch(a){case 632:r.push(t);break;case 635:n=t;break;case 637:n.t=t.t,n.h=t.h,n.r=t.r;break;case 636:if(n.author=r[n.iauthor],delete n.iauthor,e.sheetRows&&n.rfx&&e.sheetRows<=n.rfx.r)break;n.t||(n.t=""),delete n.rfx,i.push(n);break;case 3072:case 37:case 38:break;case 35:s=!0;break;case 36:s=!1;break;default:if(o.T);else if(!s||e.WTF)throw new Error("Unexpected record 0x"+a.toString(16))}})),i}var CT_VBA="application/vnd.ms-office.vbaProject";function make_vba_xls(t){var e=CFB.utils.cfb_new({root:"R"});return t.FullPaths.forEach((function(i,r){if("/"!==i.slice(-1)&&i.match(/_VBA_PROJECT_CUR/)){var n=i.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");CFB.utils.cfb_add(e,n,t.FileIndex[r].content)}})),CFB.write(e)}function parse_ds_bin(){return{"!type":"dialog"}}function parse_ds_xml(){return{"!type":"dialog"}}function parse_ms_bin(){return{"!type":"macro"}}function parse_ms_xml(){return{"!type":"macro"}}var rc_to_a1=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,e={r:0,c:0};function i(t,i,r,n){var s=!1,o=!1;0==r.length?o=!0:"["==r.charAt(0)&&(o=!0,r=r.slice(1,-1)),0==n.length?s=!0:"["==n.charAt(0)&&(s=!0,n=n.slice(1,-1));var a=r.length>0?0|parseInt(r,10):0,l=n.length>0?0|parseInt(n,10):0;return s?l+=e.c:--l,o?a+=e.r:--a,i+(s?"":"$")+encode_col(l)+(o?"":"$")+encode_row(a)}return function(r,n){return e=n,r.replace(t,i)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(t,e){return t.replace(crefregex,(function(t,i,r,n,s,o){var a=decode_col(n)-(r?0:e.c),l=decode_row(o)-(s?0:e.r);return i+"R"+(0==l?"":s?l+1:"["+l+"]")+"C"+(0==a?"":r?a+1:"["+a+"]")}))}}();function shift_formula_str(t,e){return t.replace(crefregex,(function(t,i,r,n,s,o){return i+("$"==r?r+n:encode_col(decode_col(n)+e.c))+("$"==s?s+o:encode_row(decode_row(o)+e.r))}))}function shift_formula_xlsx(t,e,i){var r=decode_range(e).s,n=decode_cell(i);return shift_formula_str(t,{r:n.r-r.r,c:n.c-r.c})}function fuzzyfmla(t){return 1!=t.length}function _xlfn(t){return t.replace(/_xlfn\./g,"")}function parseread1(t){t.l+=1}function parse_ColRelU(t,e){var i=t.read_shift(2);return[16383&i,i>>14&1,i>>15&1]}function parse_RgceArea(t,e,i){var r=2;if(i){if(i.biff>=2&&i.biff<=5)return parse_RgceArea_BIFF2(t);12==i.biff&&(r=4)}var n=t.read_shift(r),s=t.read_shift(r),o=parse_ColRelU(t),a=parse_ColRelU(t);return{s:{r:n,c:o[0],cRel:o[1],rRel:o[2]},e:{r:s,c:a[0],cRel:a[1],rRel:a[2]}}}function parse_RgceArea_BIFF2(t){var e=parse_ColRelU(t),i=parse_ColRelU(t),r=t.read_shift(1),n=t.read_shift(1);return{s:{r:e[0],c:r,cRel:e[1],rRel:e[2]},e:{r:i[0],c:n,cRel:i[1],rRel:i[2]}}}function parse_RgceAreaRel(t,e,i){if(i.biff<8)return parse_RgceArea_BIFF2(t);var r=t.read_shift(12==i.biff?4:2),n=t.read_shift(12==i.biff?4:2),s=parse_ColRelU(t),o=parse_ColRelU(t);return{s:{r:r,c:s[0],cRel:s[1],rRel:s[2]},e:{r:n,c:o[0],cRel:o[1],rRel:o[2]}}}function parse_RgceLoc(t,e,i){if(i&&i.biff>=2&&i.biff<=5)return parse_RgceLoc_BIFF2(t);var r=t.read_shift(i&&12==i.biff?4:2),n=parse_ColRelU(t);return{r:r,c:n[0],cRel:n[1],rRel:n[2]}}function parse_RgceLoc_BIFF2(t){var e=parse_ColRelU(t),i=t.read_shift(1);return{r:e[0],c:i,cRel:e[1],rRel:e[2]}}function parse_RgceElfLoc(t){var e=t.read_shift(2),i=t.read_shift(2);return{r:e,c:255&i,fQuoted:!!(16384&i),cRel:i>>15,rRel:i>>15}}function parse_RgceLocRel(t,e,i){var r=i&&i.biff?i.biff:8;if(r>=2&&r<=5)return parse_RgceLocRel_BIFF2(t);var n=t.read_shift(r>=12?4:2),s=t.read_shift(2),o=(16384&s)>>14,a=(32768&s)>>15;if(s&=16383,1==a)for(;n>524287;)n-=1048576;if(1==o)for(;s>8191;)s-=16384;return{r:n,c:s,cRel:o,rRel:a}}function parse_RgceLocRel_BIFF2(t){var e=t.read_shift(2),i=t.read_shift(1),r=(32768&e)>>15,n=(16384&e)>>14;return e&=16383,1==r&&e>=8192&&(e-=16384),1==n&&i>=128&&(i-=256),{r:e,c:i,cRel:n,rRel:r}}function parse_PtgArea(t,e,i){return[(96&t[t.l++])>>5,parse_RgceArea(t,i.biff>=2&&i.biff<=5?6:8,i)]}function parse_PtgArea3d(t,e,i){var r=(96&t[t.l++])>>5,n=t.read_shift(2,"i"),s=8;if(i)switch(i.biff){case 5:t.l+=12,s=6;break;case 12:s=12}return[r,n,parse_RgceArea(t,s,i)]}function parse_PtgAreaErr(t,e,i){var r=(96&t[t.l++])>>5;return t.l+=i&&i.biff>8?12:i.biff<8?6:8,[r]}function parse_PtgAreaErr3d(t,e,i){var r=(96&t[t.l++])>>5,n=t.read_shift(2),s=8;if(i)switch(i.biff){case 5:t.l+=12,s=6;break;case 12:s=12}return t.l+=s,[r,n]}function parse_PtgAreaN(t,e,i){return[(96&t[t.l++])>>5,parse_RgceAreaRel(t,e-1,i)]}function parse_PtgArray(t,e,i){var r=(96&t[t.l++])>>5;return t.l+=2==i.biff?6:12==i.biff?14:7,[r]}function parse_PtgAttrBaxcel(t){var e=1&t[t.l+1];return t.l+=4,[e,1]}function parse_PtgAttrChoose(t,e,i){t.l+=2;for(var r=t.read_shift(i&&2==i.biff?1:2),n=[],s=0;s<=r;++s)n.push(t.read_shift(i&&2==i.biff?1:2));return n}function parse_PtgAttrGoto(t,e,i){var r=255&t[t.l+1]?1:0;return t.l+=2,[r,t.read_shift(i&&2==i.biff?1:2)]}function parse_PtgAttrIf(t,e,i){var r=255&t[t.l+1]?1:0;return t.l+=2,[r,t.read_shift(i&&2==i.biff?1:2)]}function parse_PtgAttrIfError(t){var e=255&t[t.l+1]?1:0;return t.l+=2,[e,t.read_shift(2)]}function parse_PtgAttrSemi(t,e,i){var r=255&t[t.l+1]?1:0;return t.l+=i&&2==i.biff?3:4,[r]}function parse_PtgAttrSpaceType(t){return[t.read_shift(1),t.read_shift(1)]}function parse_PtgAttrSpace(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgAttrSpaceSemi(t){return t.read_shift(2),parse_PtgAttrSpaceType(t)}function parse_PtgRef(t,e,i){var r=(96&t[t.l])>>5;return t.l+=1,[r,parse_RgceLoc(t,0,i)]}function parse_PtgRefN(t,e,i){var r=(96&t[t.l])>>5;return t.l+=1,[r,parse_RgceLocRel(t,0,i)]}function parse_PtgRef3d(t,e,i){var r=(96&t[t.l])>>5;t.l+=1;var n=t.read_shift(2);return i&&5==i.biff&&(t.l+=12),[r,n,parse_RgceLoc(t,0,i)]}function parse_PtgFunc(t,e,i){var r=(96&t[t.l])>>5;t.l+=1;var n=t.read_shift(i&&i.biff<=3?1:2);return[FtabArgc[n],Ftab[n],r]}function parse_PtgFuncVar(t,e,i){var r=t[t.l++],n=t.read_shift(1),s=i&&i.biff<=3?[88==r?-1:0,t.read_shift(1)]:parsetab(t);return[n,(0===s[0]?Ftab:Cetab)[s[1]]]}function parsetab(t){return[t[t.l+1]>>7,32767&t.read_shift(2)]}function parse_PtgAttrSum(t,e,i){t.l+=i&&2==i.biff?3:4}function parse_PtgExp(t,e,i){return t.l++,i&&12==i.biff?[t.read_shift(4,"i"),0]:[t.read_shift(2),t.read_shift(i&&2==i.biff?1:2)]}function parse_PtgErr(t){return t.l++,BErr[t.read_shift(1)]}function parse_PtgInt(t){return t.l++,t.read_shift(2)}function parse_PtgBool(t){return t.l++,0!==t.read_shift(1)}function parse_PtgNum(t){return t.l++,parse_Xnum(t)}function parse_PtgStr(t,e,i){return t.l++,parse_ShortXLUnicodeString(t,e-1,i)}function parse_SerAr(t,e){var i=[t.read_shift(1)];if(12==e)switch(i[0]){case 2:i[0]=4;break;case 4:i[0]=16;break;case 0:i[0]=1;break;case 1:i[0]=2}switch(i[0]){case 4:i[1]=parsebool(t,1)?"TRUE":"FALSE",12!=e&&(t.l+=7);break;case 37:case 16:i[1]=BErr[t[t.l]],t.l+=12==e?4:8;break;case 0:t.l+=8;break;case 1:i[1]=parse_Xnum(t);break;case 2:i[1]=parse_XLUnicodeString2(t,0,{biff:e>0&&e<8?2:e});break;default:throw new Error("Bad SerAr: "+i[0])}return i}function parse_PtgExtraMem(t,e,i){for(var r=t.read_shift(12==i.biff?4:2),n=[],s=0;s!=r;++s)n.push((12==i.biff?parse_UncheckedRfX:parse_Ref8U)(t));return n}function parse_PtgExtraArray(t,e,i){var r=0,n=0;12==i.biff?(r=t.read_shift(4),n=t.read_shift(4)):(n=1+t.read_shift(1),r=1+t.read_shift(2)),i.biff>=2&&i.biff<8&&(--r,0==--n&&(n=256));for(var s=0,o=[];s!=r&&(o[s]=[]);++s)for(var a=0;a!=n;++a)o[s][a]=parse_SerAr(t,i.biff);return o}function parse_PtgName(t,e,i){var r=t.read_shift(1)>>>5&3,n=!i||i.biff>=8?4:2,s=t.read_shift(n);switch(i.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12}return[r,0,s]}function parse_PtgNameX(t,e,i){return 5==i.biff?parse_PtgNameX_BIFF5(t):[t.read_shift(1)>>>5&3,t.read_shift(2),t.read_shift(4)]}function parse_PtgNameX_BIFF5(t){var e=t.read_shift(1)>>>5&3,i=t.read_shift(2,"i");t.l+=8;var r=t.read_shift(2);return t.l+=12,[e,i,r]}function parse_PtgMemArea(t,e,i){var r=t.read_shift(1)>>>5&3;return t.l+=i&&2==i.biff?3:4,[r,t.read_shift(i&&2==i.biff?1:2)]}function parse_PtgMemFunc(t,e,i){return[t.read_shift(1)>>>5&3,t.read_shift(i&&2==i.biff?1:2)]}function parse_PtgRefErr(t,e,i){var r=t.read_shift(1)>>>5&3;return t.l+=4,i.biff<8&&t.l--,12==i.biff&&(t.l+=2),[r]}function parse_PtgRefErr3d(t,e,i){var r=(96&t[t.l++])>>5,n=t.read_shift(2),s=4;if(i)switch(i.biff){case 5:s=15;break;case 12:s=6}return t.l+=s,[r,n]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(t,e,i){return t.l+=2,[parse_RgceElfLoc(t)]}function parse_PtgElfNoop(t){return t.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(t){return t.l+=2,[parseuint16(t),1&t.read_shift(2)]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(t){t.l+=2;var e=t.read_shift(2),i=t.read_shift(2),r=t.read_shift(4),n=t.read_shift(2),s=t.read_shift(2);return{ixti:e,coltype:3&i,rt:PtgListRT[i>>2&31],idx:r,c:n,C:s}}function parse_PtgSxName(t){return t.l+=2,[t.read_shift(4)]}function parse_PtgSheet(t,e,i){return t.l+=5,t.l+=2,t.l+=2==i.biff?1:4,["PTGSHEET"]}function parse_PtgEndSheet(t,e,i){return t.l+=2==i.biff?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(t){return[t.read_shift(1)>>>5&3,t.read_shift(2)]}function parse_PtgMemNoMemN(t){return[t.read_shift(1)>>>5&3,t.read_shift(2)]}function parse_PtgAttrNoop(t){return t.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(t,e,i,r){if(r.biff<8)return parsenoop(t,e);for(var n=t.l+e,s=[],o=0;o!==i.length;++o)switch(i[o][0]){case"PtgArray":i[o][1]=parse_PtgExtraArray(t,0,r),s.push(i[o][1]);break;case"PtgMemArea":i[o][2]=parse_PtgExtraMem(t,i[o][1],r),s.push(i[o][2]);break;case"PtgExp":r&&12==r.biff&&(i[o][1][1]=t.read_shift(4),s.push(i[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+i[o][0]}return 0!==(e=n-t.l)&&s.push(parsenoop(t,e)),s}function parse_Rgce(t,e,i){for(var r,n,s=t.l+e,o=[];s!=t.l;)e=s-t.l,n=t[t.l],r=PtgTypes[n]||PtgTypes[PtgDupes[n]],24!==n&&25!==n||(r=(24===n?Ptg18:Ptg19)[t[t.l+1]]),r&&r.f?o.push([r.n,r.f(t,e,i)]):parsenoop(t,e);return o}function stringify_array(t){for(var e=[],i=0;i<t.length;++i){for(var r=t[i],n=[],s=0;s<r.length;++s){var o=r[s];if(o)if(2===o[0])n.push('"'+o[1].replace(/"/g,'""')+'"');else n.push(o[1]);else n.push("")}e.push(n.join(","))}return e.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(t,e){if(!(t||e&&e.biff<=5&&e.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function get_ixti_raw(t,e,i){if(!t)return"SH33TJSERR0";if(i.biff>8&&(!t.XTI||!t.XTI[e]))return t.SheetNames[e];if(!t.XTI)return"SH33TJSERR6";var r=t.XTI[e];if(i.biff<8)return e>1e4&&(e-=65536),e<0&&(e=-e),0==e?"":t.XTI[e-1];if(!r)return"SH33TJSERR1";var n="";if(i.biff>8)switch(t[r[0]][0]){case 357:return n=-1==r[1]?"#REF":t.SheetNames[r[1]],r[1]==r[2]?n:n+":"+t.SheetNames[r[2]];case 358:return null!=i.SID?t.SheetNames[i.SID]:"SH33TJSSAME"+t[r[0]][0];default:return"SH33TJSSRC"+t[r[0]][0]}switch(t[r[0]][0][0]){case 1025:return n=-1==r[1]?"#REF":t.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?n:n+":"+t.SheetNames[r[2]];case 14849:return t[r[0]].slice(1).map((function(t){return t.Name})).join(";;");default:return t[r[0]][0][3]?(n=-1==r[1]?"#REF":t[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?n:n+":"+t[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function get_ixti(t,e,i){var r=get_ixti_raw(t,e,i);return"#REF"==r?r:formula_quote_sheet_name(r,i)}function stringify_formula(t,e,i,r,n){var s,o,a,l,c=n&&n.biff||8,h={s:{c:0,r:0}},u=[],d=0,p=0,f="";if(!t[0]||!t[0][0])return"";for(var _=-1,m="",g=0,y=t[0].length;g<y;++g){var v=t[0][g];switch(v[0]){case"PtgUminus":u.push("-"+u.pop());break;case"PtgUplus":u.push("+"+u.pop());break;case"PtgPercent":u.push(u.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(s=u.pop(),o=u.pop(),_>=0){switch(t[0][_][1][0]){case 0:m=fill(" ",t[0][_][1][1]);break;case 1:m=fill("\r",t[0][_][1][1]);break;default:if(m="",n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][_][1][0])}o+=m,_=-1}u.push(o+PtgBinOp[v[0]]+s);break;case"PtgIsect":s=u.pop(),o=u.pop(),u.push(o+" "+s);break;case"PtgUnion":s=u.pop(),o=u.pop(),u.push(o+","+s);break;case"PtgRange":s=u.pop(),o=u.pop(),u.push(o+":"+s);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":a=shift_cell_xls(v[1][1],h,n),u.push(encode_cell_xls(a,c));break;case"PtgRefN":a=i?shift_cell_xls(v[1][1],i,n):v[1][1],u.push(encode_cell_xls(a,c));break;case"PtgRef3d":d=v[1][1],a=shift_cell_xls(v[1][2],h,n),f=get_ixti(r,d,n),u.push(f+"!"+encode_cell_xls(a,c));break;case"PtgFunc":case"PtgFuncVar":var b=v[1][0],x=v[1][1];b||(b=0);var T=0==(b&=127)?[]:u.slice(-b);u.length-=b,"User"===x&&(x=T.shift()),u.push(x+"("+T.join(",")+")");break;case"PtgBool":u.push(v[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":u.push(v[1]);break;case"PtgNum":u.push(String(v[1]));break;case"PtgStr":u.push('"'+v[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":l=shift_range_xls(v[1][1],i?{s:i}:h,n),u.push(encode_range_xls(l,n));break;case"PtgArea":l=shift_range_xls(v[1][1],h,n),u.push(encode_range_xls(l,n));break;case"PtgArea3d":d=v[1][1],l=v[1][2],f=get_ixti(r,d,n),u.push(f+"!"+encode_range_xls(l,n));break;case"PtgAttrSum":u.push("SUM("+u.pop()+")");break;case"PtgName":p=v[1][2];var C=(r.names||[])[p-1]||(r[0]||[])[p],S=C?C.Name:"SH33TJSNAME"+String(p);S&&"_xlfn."==S.slice(0,6)&&!n.xlfn&&(S=S.slice(6)),u.push(S);break;case"PtgNameX":var w,A=v[1][1];if(p=v[1][2],!(n.biff<=5)){var E="";if(14849==((r[A]||[])[0]||[])[0]||(1025==((r[A]||[])[0]||[])[0]?r[A][p]&&r[A][p].itab>0&&(E=r.SheetNames[r[A][p].itab-1]+"!"):E=r.SheetNames[p-1]+"!"),r[A]&&r[A][p])E+=r[A][p].Name;else if(r[0]&&r[0][p])E+=r[0][p].Name;else{var D=(get_ixti_raw(r,A,n)||"").split(";;");D[p-1]?E=D[p-1]:E+="SH33TJSERRX"}u.push(E);break}A<0&&(A=-A),r[A]&&(w=r[A][p]),w||(w={Name:"SH33TJSERRY"}),u.push(w.Name);break;case"PtgParen":var L="(",I=")";if(_>=0){switch(m="",t[0][_][1][0]){case 2:L=fill(" ",t[0][_][1][1])+L;break;case 3:L=fill("\r",t[0][_][1][1])+L;break;case 4:I=fill(" ",t[0][_][1][1])+I;break;case 5:I=fill("\r",t[0][_][1][1])+I;break;default:if(n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][_][1][0])}_=-1}u.push(L+u.pop()+I);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":u.push("#REF!");break;case"PtgExp":a={c:v[1][1],r:v[1][0]};var P={c:i.c,r:i.r};if(r.sharedf[encode_cell(a)]){var M=r.sharedf[encode_cell(a)];u.push(stringify_formula(M,h,P,r,n))}else{var R=!1;for(s=0;s!=r.arrayf.length;++s)if(o=r.arrayf[s],!(a.c<o[0].s.c||a.c>o[0].e.c||a.r<o[0].s.r||a.r>o[0].e.r)){u.push(stringify_formula(o[1],h,P,r,n)),R=!0;break}R||u.push(v[1])}break;case"PtgArray":u.push("{"+stringify_array(v[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":_=g;break;case"PtgMissArg":u.push("");break;case"PtgList":u.push("Table"+v[1].idx+"[#"+v[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(v))}if(3!=n.biff&&_>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(t[0][g][0])){var O=!0;switch((v=t[0][_])[1][0]){case 4:O=!1;case 0:m=fill(" ",v[1][1]);break;case 5:O=!1;case 1:m=fill("\r",v[1][1]);break;default:if(m="",n.WTF)throw new Error("Unexpected PtgAttrSpaceType "+v[1][0])}u.push((O?m:"")+u.pop()+(O?"":m)),_=-1}}if(u.length>1&&n.WTF)throw new Error("bad formula stack");return u[0]}function parse_ArrayParsedFormula(t,e,i){var r,n=t.l+e,s=2==i.biff?1:2,o=t.read_shift(s);if(65535==o)return[[],parsenoop(t,e-2)];var a=parse_Rgce(t,o,i);return e!==o+s&&(r=parse_RgbExtra(t,e-o-s,a,i)),t.l=n,[a,r]}function parse_XLSCellParsedFormula(t,e,i){var r,n=t.l+e,s=2==i.biff?1:2,o=t.read_shift(s);if(65535==o)return[[],parsenoop(t,e-2)];var a=parse_Rgce(t,o,i);return e!==o+s&&(r=parse_RgbExtra(t,e-o-s,a,i)),t.l=n,[a,r]}function parse_NameParsedFormula(t,e,i,r){var n,s=t.l+e,o=parse_Rgce(t,r,i);return s!==t.l&&(n=parse_RgbExtra(t,s-t.l,o,i)),[o,n]}function parse_SharedParsedFormula(t,e,i){var r,n=t.l+e,s=t.read_shift(2),o=parse_Rgce(t,s,i);return 65535==s?[[],parsenoop(t,e-2)]:(e!==s+2&&(r=parse_RgbExtra(t,n-s-2,o,i)),[o,r])}function parse_FormulaValue(t){var e;if(65535!==__readUInt16LE(t,t.l+6))return[parse_Xnum(t),"n"];switch(t[t.l]){case 0:return t.l+=8,["String","s"];case 1:return e=1===t[t.l+2],t.l+=8,[e,"b"];case 2:return e=t[t.l+2],t.l+=8,[e,"e"];case 3:return t.l+=8,["","s"]}return[]}function parse_Formula(t,e,i){var r=t.l+e,n=parse_XLSCell(t);2==i.biff&&++t.l;var s=parse_FormulaValue(t),o=t.read_shift(1);2!=i.biff&&(t.read_shift(1),i.biff>=5&&t.read_shift(4));var a=parse_XLSCellParsedFormula(t,r-t.l,i);return{cell:n,val:s[0],formula:a,shared:o>>3&1,tt:s[1]}}function parse_XLSBParsedFormula(t,e,i){var r=t.read_shift(4),n=parse_Rgce(t,r,i),s=t.read_shift(4);return[n,s>0?parse_RgbExtra(t,s,n,i):null]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function ods_to_csf_formula(t){return"of:"==t.slice(0,3)&&(t=t.slice(3)),61==t.charCodeAt(0)&&61==(t=t.slice(1)).charCodeAt(0)&&(t=t.slice(1)),(t=(t=(t=t.replace(/COM\.MICROSOFT\./g,"")).replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,(function(t,e){return e.replace(/\./g,"")}))).replace(/\[.(#[A-Z]*[?!])\]/g,"$1")).replace(/[;~]/g,",").replace(/\|/g,";")}function ods_to_csf_3D(t){var e=t.split(":");return[e[0].split(".")[0],e[0].split(".")[1]+(e.length>1?":"+(e[1].split(".")[1]||e[1].split(".")[0]):"")]}var strs={},_ssfopts={};function default_margins(t,e){if(t){var i=[.7,.7,.75,.75,.3,.3];"xlml"==e&&(i=[1,1,1,1,.5,.5]),null==t.left&&(t.left=i[0]),null==t.right&&(t.right=i[1]),null==t.top&&(t.top=i[2]),null==t.bottom&&(t.bottom=i[3]),null==t.header&&(t.header=i[4]),null==t.footer&&(t.footer=i[5])}}function safe_format(t,i,r,n,s,o){try{n.cellNF&&(t.z=table_fmt[i])}catch(e){if(n.WTF)throw e}if("z"!==t.t||n.cellStyles){if("d"===t.t&&"string"==typeof t.v&&(t.v=parseDate(t.v)),(!n||!1!==n.cellText)&&"z"!==t.t)try{if(null==table_fmt[i]&&SSF_load(SSFImplicit[i]||"General",i),"e"===t.t)t.w=t.w||BErr[t.v];else if(0===i)if("n"===t.t)(0|t.v)===t.v?t.w=t.v.toString(10):t.w=SSF_general_num(t.v);else if("d"===t.t){var a=datenum(t.v);t.w=(0|a)===a?a.toString(10):SSF_general_num(a)}else{if(void 0===t.v)return"";t.w=SSF_general(t.v,_ssfopts)}else"d"===t.t?t.w=SSF_format(i,datenum(t.v),_ssfopts):t.w=SSF_format(i,t.v,_ssfopts)}catch(e){if(n.WTF)throw e}if(n.cellStyles&&null!=r)try{t.s=o.Fills[r],t.s.fgColor&&t.s.fgColor.theme&&!t.s.fgColor.rgb&&(t.s.fgColor.rgb=rgb_tint(s.themeElements.clrScheme[t.s.fgColor.theme].rgb,t.s.fgColor.tint||0),n.WTF&&(t.s.fgColor.raw_rgb=s.themeElements.clrScheme[t.s.fgColor.theme].rgb)),t.s.bgColor&&t.s.bgColor.theme&&(t.s.bgColor.rgb=rgb_tint(s.themeElements.clrScheme[t.s.bgColor.theme].rgb,t.s.bgColor.tint||0),n.WTF&&(t.s.bgColor.raw_rgb=s.themeElements.clrScheme[t.s.bgColor.theme].rgb))}catch(e){if(n.WTF&&o.Fills)throw e}}}function parse_ws_xml_dim(t,e){var i=safe_decode_range(e);i.s.r<=i.e.r&&i.s.c<=i.e.c&&i.s.r>=0&&i.s.c>=0&&(t["!ref"]=encode_range(i))}var mergecregex=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,sheetdataregex=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,hlinkregex=/<(?:\w:)?hyperlink [^>]*>/gm,dimregex=/"(\w*:\w*)"/,colregex=/<(?:\w:)?col\b[^>]*[\/]?>/g,afregex=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,marginregex=/<(?:\w:)?pageMargins[^>]*\/>/g,sheetprregex=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,sheetprregex2=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,svsregex=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function parse_ws_xml(t,e,i,r,n,s,o){if(!t)return t;r||(r={"!id":{}});var a=e.dense?[]:{},l={s:{r:2e6,c:2e6},e:{r:0,c:0}},c="",h="",u=t.match(sheetdataregex);u?(c=t.slice(0,u.index),h=t.slice(u.index+u[0].length)):c=h=t;var d=c.match(sheetprregex);d?parse_ws_xml_sheetpr(d[0],a,n,i):(d=c.match(sheetprregex2))&&parse_ws_xml_sheetpr2(d[0],d[1]||"",a,n,i);var p=(c.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(p>0){var f=c.slice(p,p+50).match(dimregex);f&&parse_ws_xml_dim(a,f[1])}var _=c.match(svsregex);_&&_[1]&&parse_ws_xml_sheetviews(_[1],n);var m=[];if(e.cellStyles){var g=c.match(colregex);g&&parse_ws_xml_cols(m,g)}u&&parse_ws_xml_data(u[1],a,e,l,s,o);var y=h.match(afregex);y&&(a["!autofilter"]=parse_ws_xml_autofilter(y[0]));var v=[],b=h.match(mergecregex);if(b)for(p=0;p!=b.length;++p)v[p]=safe_decode_range(b[p].slice(b[p].indexOf('"')+1));var x=h.match(hlinkregex);x&&parse_ws_xml_hlinks(a,x,r);var T=h.match(marginregex);if(T&&(a["!margins"]=parse_ws_xml_margins(parsexmltag(T[0]))),!a["!ref"]&&l.e.c>=l.s.c&&l.e.r>=l.s.r&&(a["!ref"]=encode_range(l)),e.sheetRows>0&&a["!ref"]){var C=safe_decode_range(a["!ref"]);e.sheetRows<=+C.e.r&&(C.e.r=e.sheetRows-1,C.e.r>l.e.r&&(C.e.r=l.e.r),C.e.r<C.s.r&&(C.s.r=C.e.r),C.e.c>l.e.c&&(C.e.c=l.e.c),C.e.c<C.s.c&&(C.s.c=C.e.c),a["!fullref"]=a["!ref"],a["!ref"]=encode_range(C))}return m.length>0&&(a["!cols"]=m),v.length>0&&(a["!merges"]=v),a}function parse_ws_xml_sheetpr(t,e,i,r){var n=parsexmltag(t);i.Sheets[r]||(i.Sheets[r]={}),n.codeName&&(i.Sheets[r].CodeName=unescapexml(utf8read(n.codeName)))}function parse_ws_xml_sheetpr2(t,e,i,r,n){parse_ws_xml_sheetpr(t.slice(0,t.indexOf(">")),i,r,n)}function parse_ws_xml_hlinks(t,e,i){for(var r=Array.isArray(t),n=0;n!=e.length;++n){var s=parsexmltag(utf8read(e[n]),!0);if(!s.ref)return;var o=((i||{})["!id"]||[])[s.id];o?(s.Target=o.Target,s.location&&(s.Target+="#"+unescapexml(s.location))):(s.Target="#"+unescapexml(s.location),o={Target:s.Target,TargetMode:"Internal"}),s.Rel=o,s.tooltip&&(s.Tooltip=s.tooltip,delete s.tooltip);for(var a=safe_decode_range(s.ref),l=a.s.r;l<=a.e.r;++l)for(var c=a.s.c;c<=a.e.c;++c){var h=encode_cell({c:c,r:l});r?(t[l]||(t[l]=[]),t[l][c]||(t[l][c]={t:"z",v:void 0}),t[l][c].l=s):(t[h]||(t[h]={t:"z",v:void 0}),t[h].l=s)}}}function parse_ws_xml_margins(t){var e={};return["left","right","top","bottom","header","footer"].forEach((function(i){t[i]&&(e[i]=parseFloat(t[i]))})),e}function parse_ws_xml_cols(t,e){for(var i=!1,r=0;r!=e.length;++r){var n=parsexmltag(e[r],!0);n.hidden&&(n.hidden=parsexmlbool(n.hidden));var s=parseInt(n.min,10)-1,o=parseInt(n.max,10)-1;for(n.outlineLevel&&(n.level=+n.outlineLevel||0),delete n.min,delete n.max,n.width=+n.width,!i&&n.width&&(i=!0,find_mdw_colw(n.width)),process_col(n);s<=o;)t[s++]=dup(n)}}function parse_ws_xml_autofilter(t){return{ref:(t.match(/ref="([^"]*)"/)||[])[1]}}var sviewregex=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function parse_ws_xml_sheetviews(t,e){e.Views||(e.Views=[{}]),(t.match(sviewregex)||[]).forEach((function(t,i){var r=parsexmltag(t);e.Views[i]||(e.Views[i]={}),+r.zoomScale&&(e.Views[i].zoom=+r.zoomScale),parsexmlbool(r.rightToLeft)&&(e.Views[i].RTL=!0)}))}var parse_ws_xml_data=function(){var t=/<(?:\w+:)?c[ \/>]/,e=/<\/(?:\w+:)?row>/,i=/r=["']([^"']*)["']/,r=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,n=/ref=["']([^"']*)["']/,s=matchtag("v"),o=matchtag("f");return function(a,l,c,h,u,d){for(var p,f,_,m,g,y=0,v="",b=[],x=[],T=0,C=0,S=0,w="",A=0,E=0,D=0,L=0,I=Array.isArray(d.CellXf),P=[],M=[],R=Array.isArray(l),O=[],B={},N=!1,k=!!c.sheetStubs,F=a.split(e),V=0,j=F.length;V!=j;++V){var G=(v=F[V].trim()).length;if(0!==G){var U=0;t:for(y=0;y<G;++y)switch(v[y]){case">":if("/"!=v[y-1]){++y;break t}if(c&&c.cellStyles){if(A=null!=(f=parsexmltag(v.slice(U,y),!0)).r?parseInt(f.r,10):A+1,E=-1,c.sheetRows&&c.sheetRows<A)continue;B={},N=!1,f.ht&&(N=!0,B.hpt=parseFloat(f.ht),B.hpx=pt2px(B.hpt)),"1"==f.hidden&&(N=!0,B.hidden=!0),null!=f.outlineLevel&&(N=!0,B.level=+f.outlineLevel),N&&(O[A-1]=B)}break;case"<":U=y}if(U>=y)break;if(A=null!=(f=parsexmltag(v.slice(U,y),!0)).r?parseInt(f.r,10):A+1,E=-1,!(c.sheetRows&&c.sheetRows<A)){h.s.r>A-1&&(h.s.r=A-1),h.e.r<A-1&&(h.e.r=A-1),c&&c.cellStyles&&(B={},N=!1,f.ht&&(N=!0,B.hpt=parseFloat(f.ht),B.hpx=pt2px(B.hpt)),"1"==f.hidden&&(N=!0,B.hidden=!0),null!=f.outlineLevel&&(N=!0,B.level=+f.outlineLevel),N&&(O[A-1]=B)),b=v.slice(y).split(t);for(var Y=0;Y!=b.length&&"<"==b[Y].trim().charAt(0);++Y);for(b=b.slice(Y),y=0;y!=b.length;++y)if(0!==(v=b[y].trim()).length){if(x=v.match(i),T=y,C=0,S=0,v="<c "+("<"==v.slice(0,1)?">":"")+v,null!=x&&2===x.length){for(T=0,w=x[1],C=0;C!=w.length&&!((S=w.charCodeAt(C)-64)<1||S>26);++C)T=26*T+S;E=--T}else++E;for(C=0;C!=v.length&&62!==v.charCodeAt(C);++C);if(++C,(f=parsexmltag(v.slice(0,C),!0)).r||(f.r=encode_cell({r:A-1,c:E})),p={t:""},null!=(x=(w=v.slice(C)).match(s))&&""!==x[1]&&(p.v=unescapexml(x[1])),c.cellFormula){if(null!=(x=w.match(o))&&""!==x[1]){if(p.f=unescapexml(utf8read(x[1])).replace(/\r\n/g,"\n"),c.xlfn||(p.f=_xlfn(p.f)),x[0].indexOf('t="array"')>-1)p.F=(w.match(n)||[])[1],p.F.indexOf(":")>-1&&P.push([safe_decode_range(p.F),p.F]);else if(x[0].indexOf('t="shared"')>-1){m=parsexmltag(x[0]);var H=unescapexml(utf8read(x[1]));c.xlfn||(H=_xlfn(H)),M[parseInt(m.si,10)]=[m,H,f.r]}}else(x=w.match(/<f[^>]*\/>/))&&M[(m=parsexmltag(x[0])).si]&&(p.f=shift_formula_xlsx(M[m.si][1],M[m.si][2],f.r));var X=decode_cell(f.r);for(C=0;C<P.length;++C)X.r>=P[C][0].s.r&&X.r<=P[C][0].e.r&&X.c>=P[C][0].s.c&&X.c<=P[C][0].e.c&&(p.F=P[C][1])}if(null==f.t&&void 0===p.v)if(p.f||p.F)p.v=0,p.t="n";else{if(!k)continue;p.t="z"}else p.t=f.t||"n";switch(h.s.c>E&&(h.s.c=E),h.e.c<E&&(h.e.c=E),p.t){case"n":if(""==p.v||null==p.v){if(!k)continue;p.t="z"}else p.v=parseFloat(p.v);break;case"s":if(void 0===p.v){if(!k)continue;p.t="z"}else _=strs[parseInt(p.v,10)],p.v=_.t,p.r=_.r,c.cellHTML&&(p.h=_.h);break;case"str":p.t="s",p.v=null!=p.v?utf8read(p.v):"",c.cellHTML&&(p.h=escapehtml(p.v));break;case"inlineStr":x=w.match(r),p.t="s",null!=x&&(_=parse_si(x[1]))?(p.v=_.t,c.cellHTML&&(p.h=_.h)):p.v="";break;case"b":p.v=parsexmlbool(p.v);break;case"d":c.cellDates?p.v=parseDate(p.v,1):(p.v=datenum(parseDate(p.v,1)),p.t="n");break;case"e":c&&!1===c.cellText||(p.w=p.v),p.v=RBErr[p.v]}if(D=L=0,g=null,I&&void 0!==f.s&&null!=(g=d.CellXf[f.s])&&(null!=g.numFmtId&&(D=g.numFmtId),c.cellStyles&&null!=g.fillId&&(L=g.fillId)),safe_format(p,D,L,c,u,d),c.cellDates&&I&&"n"==p.t&&fmt_is_date(table_fmt[D])&&(p.t="d",p.v=numdate(p.v)),f.cm&&c.xlmeta){var z=(c.xlmeta.Cell||[])[+f.cm-1];z&&"XLDAPR"==z.type&&(p.D=!0)}if(R){var W=decode_cell(f.r);l[W.r]||(l[W.r]=[]),l[W.r][W.c]=p}else l[f.r]=p}}}}O.length>0&&(l["!rows"]=O)}}();function parse_BrtRowHdr(t,e){var i={},r=t.l+e;i.r=t.read_shift(4),t.l+=4;var n=t.read_shift(2);t.l+=1;var s=t.read_shift(1);return t.l=r,7&s&&(i.level=7&s),16&s&&(i.hidden=!0),32&s&&(i.hpt=n/20),i}var parse_BrtWsDim=parse_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(t,e){var i={},r=t[t.l];return++t.l,i.above=!(64&r),i.left=!(128&r),t.l+=18,i.name=parse_XLSBCodeName(t),i}function parse_BrtCellBlank(t){return[parse_XLSBCell(t)]}function parse_BrtShortBlank(t){return[parse_XLSBShortCell(t)]}function parse_BrtCellBool(t){return[parse_XLSBCell(t),t.read_shift(1),"b"]}function parse_BrtShortBool(t){return[parse_XLSBShortCell(t),t.read_shift(1),"b"]}function parse_BrtCellError(t){return[parse_XLSBCell(t),t.read_shift(1),"e"]}function parse_BrtShortError(t){return[parse_XLSBShortCell(t),t.read_shift(1),"e"]}function parse_BrtCellIsst(t){return[parse_XLSBCell(t),t.read_shift(4),"s"]}function parse_BrtShortIsst(t){return[parse_XLSBShortCell(t),t.read_shift(4),"s"]}function parse_BrtCellReal(t){return[parse_XLSBCell(t),parse_Xnum(t),"n"]}function parse_BrtShortReal(t){return[parse_XLSBShortCell(t),parse_Xnum(t),"n"]}function parse_BrtCellRk(t){return[parse_XLSBCell(t),parse_RkNumber(t),"n"]}function parse_BrtShortRk(t){return[parse_XLSBShortCell(t),parse_RkNumber(t),"n"]}function parse_BrtCellRString(t){return[parse_XLSBCell(t),parse_RichStr(t),"is"]}function parse_BrtCellSt(t){return[parse_XLSBCell(t),parse_XLWideString(t),"str"]}function parse_BrtShortSt(t){return[parse_XLSBShortCell(t),parse_XLWideString(t),"str"]}function parse_BrtFmlaBool(t,e,i){var r=t.l+e,n=parse_XLSBCell(t);n.r=i["!row"];var s=[n,t.read_shift(1),"b"];if(i.cellFormula){t.l+=2;var o=parse_XLSBCellParsedFormula(t,r-t.l,i);s[3]=stringify_formula(o,null,n,i.supbooks,i)}else t.l=r;return s}function parse_BrtFmlaError(t,e,i){var r=t.l+e,n=parse_XLSBCell(t);n.r=i["!row"];var s=[n,t.read_shift(1),"e"];if(i.cellFormula){t.l+=2;var o=parse_XLSBCellParsedFormula(t,r-t.l,i);s[3]=stringify_formula(o,null,n,i.supbooks,i)}else t.l=r;return s}function parse_BrtFmlaNum(t,e,i){var r=t.l+e,n=parse_XLSBCell(t);n.r=i["!row"];var s=[n,parse_Xnum(t),"n"];if(i.cellFormula){t.l+=2;var o=parse_XLSBCellParsedFormula(t,r-t.l,i);s[3]=stringify_formula(o,null,n,i.supbooks,i)}else t.l=r;return s}function parse_BrtFmlaString(t,e,i){var r=t.l+e,n=parse_XLSBCell(t);n.r=i["!row"];var s=[n,parse_XLWideString(t),"str"];if(i.cellFormula){t.l+=2;var o=parse_XLSBCellParsedFormula(t,r-t.l,i);s[3]=stringify_formula(o,null,n,i.supbooks,i)}else t.l=r;return s}var parse_BrtMergeCell=parse_UncheckedRfX;function parse_BrtHLink(t,e){var i=t.l+e,r=parse_UncheckedRfX(t),n=parse_XLNullableWideString(t),s=parse_XLWideString(t),o=parse_XLWideString(t),a=parse_XLWideString(t);t.l=i;var l={rfx:r,relId:n,loc:s,display:a};return o&&(l.Tooltip=o),l}function parse_BrtPane(){}function parse_BrtArrFmla(t,e,i){var r=t.l+e,n=parse_RfX(t),s=t.read_shift(1),o=[n];if(o[2]=s,i.cellFormula){var a=parse_XLSBArrayParsedFormula(t,r-t.l,i);o[1]=a}else t.l=r;return o}function parse_BrtShrFmla(t,e,i){var r=t.l+e,n=[parse_UncheckedRfX(t)];if(i.cellFormula){var s=parse_XLSBSharedParsedFormula(t,r-t.l,i);n[1]=s,t.l=r}else t.l=r;return n}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(t){var e={};return BrtMarginKeys.forEach((function(i){e[i]=parse_Xnum(t)})),e}function parse_BrtBeginWsView(t){var e=t.read_shift(2);return t.l+=28,{RTL:32&e}}function parse_BrtDVal(){}function parse_BrtDVal14(){}function parse_ws_bin(t,e,i,r,n,s,o){if(!t)return t;var a=e||{};r||(r={"!id":{}});var l,c,h,u,d,p,f,_,m,g,y=a.dense?[]:{},v={s:{r:2e6,c:2e6},e:{r:0,c:0}},b=!1,x=!1,T=[];a.biff=12,a["!row"]=0;var C=0,S=!1,w=[],A={},E=a.supbooks||n.supbooks||[[]];if(E.sharedf=A,E.arrayf=w,E.SheetNames=n.SheetNames||n.Sheets.map((function(t){return t.name})),!a.supbooks&&(a.supbooks=E,n.Names))for(var D=0;D<n.Names.length;++D)E[0][D+1]=n.Names[D];var L,I=[],P=[],M=!1;if(XLSBRecordEnum[16]={n:"BrtShortReal",f:parse_BrtShortReal},recordhopper(t,(function(t,e,D){if(!x)switch(D){case 148:l=t;break;case 0:c=t,a.sheetRows&&a.sheetRows<=c.r&&(x=!0),m=encode_row(d=c.r),a["!row"]=c.r,(t.hidden||t.hpt||null!=t.level)&&(t.hpt&&(t.hpx=pt2px(t.hpt)),P[t.r]=t);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(h={t:t[2]},t[2]){case"n":h.v=t[1];break;case"s":_=strs[t[1]],h.v=_.t,h.r=_.r;break;case"b":h.v=!!t[1];break;case"e":h.v=t[1],!1!==a.cellText&&(h.w=BErr[h.v]);break;case"str":h.t="s",h.v=t[1];break;case"is":h.t="s",h.v=t[1].t}if((u=o.CellXf[t[0].iStyleRef])&&safe_format(h,u.numFmtId,null,a,s,o),p=-1==t[0].c?p+1:t[0].c,a.dense?(y[d]||(y[d]=[]),y[d][p]=h):y[encode_col(p)+m]=h,a.cellFormula){for(S=!1,C=0;C<w.length;++C){var R=w[C];c.r>=R[0].s.r&&c.r<=R[0].e.r&&p>=R[0].s.c&&p<=R[0].e.c&&(h.F=encode_range(R[0]),S=!0)}!S&&t.length>3&&(h.f=t[3])}if(v.s.r>c.r&&(v.s.r=c.r),v.s.c>p&&(v.s.c=p),v.e.r<c.r&&(v.e.r=c.r),v.e.c<p&&(v.e.c=p),a.cellDates&&u&&"n"==h.t&&fmt_is_date(table_fmt[u.numFmtId])){var O=SSF_parse_date_code(h.v);O&&(h.t="d",h.v=new Date(O.y,O.m-1,O.d,O.H,O.M,O.S,O.u))}L&&("XLDAPR"==L.type&&(h.D=!0),L=void 0);break;case 1:case 12:if(!a.sheetStubs||b)break;h={t:"z",v:void 0},p=-1==t[0].c?p+1:t[0].c,a.dense?(y[d]||(y[d]=[]),y[d][p]=h):y[encode_col(p)+m]=h,v.s.r>c.r&&(v.s.r=c.r),v.s.c>p&&(v.s.c=p),v.e.r<c.r&&(v.e.r=c.r),v.e.c<p&&(v.e.c=p),L&&("XLDAPR"==L.type&&(h.D=!0),L=void 0);break;case 176:T.push(t);break;case 49:L=((a.xlmeta||{}).Cell||[])[t-1];break;case 494:var B=r["!id"][t.relId];for(B?(t.Target=B.Target,t.loc&&(t.Target+="#"+t.loc),t.Rel=B):""==t.relId&&(t.Target="#"+t.loc),d=t.rfx.s.r;d<=t.rfx.e.r;++d)for(p=t.rfx.s.c;p<=t.rfx.e.c;++p)a.dense?(y[d]||(y[d]=[]),y[d][p]||(y[d][p]={t:"z",v:void 0}),y[d][p].l=t):(f=encode_cell({c:p,r:d}),y[f]||(y[f]={t:"z",v:void 0}),y[f].l=t);break;case 426:if(!a.cellFormula)break;w.push(t),(g=a.dense?y[d][p]:y[encode_col(p)+m]).f=stringify_formula(t[1],v,{r:c.r,c:p},E,a),g.F=encode_range(t[0]);break;case 427:if(!a.cellFormula)break;A[encode_cell(t[0].s)]=t[1],(g=a.dense?y[d][p]:y[encode_col(p)+m]).f=stringify_formula(t[1],v,{r:c.r,c:p},E,a);break;case 60:if(!a.cellStyles)break;for(;t.e>=t.s;)I[t.e--]={width:t.w/256,hidden:!!(1&t.flags),level:t.level},M||(M=!0,find_mdw_colw(t.w/256)),process_col(I[t.e+1]);break;case 161:y["!autofilter"]={ref:encode_range(t)};break;case 476:y["!margins"]=t;break;case 147:n.Sheets[i]||(n.Sheets[i]={}),t.name&&(n.Sheets[i].CodeName=t.name),(t.above||t.left)&&(y["!outline"]={above:t.above,left:t.left});break;case 137:n.Views||(n.Views=[{}]),n.Views[0]||(n.Views[0]={}),t.RTL&&(n.Views[0].RTL=!0);break;case 485:case 64:case 1053:case 151:case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:case 37:b=!0;break;case 36:case 38:b=!1;break;default:if(e.T);else if(!b||a.WTF)throw new Error("Unexpected record 0x"+D.toString(16))}}),a),delete a.supbooks,delete a["!row"],!y["!ref"]&&(v.s.r<2e6||l&&(l.e.r>0||l.e.c>0||l.s.r>0||l.s.c>0))&&(y["!ref"]=encode_range(l||v)),a.sheetRows&&y["!ref"]){var R=safe_decode_range(y["!ref"]);a.sheetRows<=+R.e.r&&(R.e.r=a.sheetRows-1,R.e.r>v.e.r&&(R.e.r=v.e.r),R.e.r<R.s.r&&(R.s.r=R.e.r),R.e.c>v.e.c&&(R.e.c=v.e.c),R.e.c<R.s.c&&(R.s.c=R.e.c),y["!fullref"]=y["!ref"],y["!ref"]=encode_range(R))}return T.length>0&&(y["!merges"]=T),I.length>0&&(y["!cols"]=I),P.length>0&&(y["!rows"]=P),y}function parse_Cache(t){var e,i=[],r=t.match(/^<c:numCache>/);(t.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/gm)||[]).forEach((function(t){var e=t.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);e&&(i[+e[1]]=r?+e[2]:e[2])}));var n=unescapexml((t.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(t.match(/<c:f>(.*?)<\/c:f>/gm)||[]).forEach((function(t){e=t.replace(/<.*?>/g,"")})),[i,n,e]}function parse_chart(t,e,i,r,n,s){var o=s||{"!type":"chart"};if(!t)return s;var a=0,l=0,c="A",h={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(t.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach((function(t){var e=parse_Cache(t);h.s.r=h.s.c=0,h.e.c=a,c=encode_col(a),e[0].forEach((function(t,i){o[c+encode_row(i)]={t:"n",v:t,z:e[1]},l=i})),h.e.r<l&&(h.e.r=l),++a})),a>0&&(o["!ref"]=encode_range(h)),o}function parse_cs_xml(t,e,i,r,n){if(!t)return t;r||(r={"!id":{}});var s,o={"!type":"chart","!drawel":null,"!rel":""},a=t.match(sheetprregex);return a&&parse_ws_xml_sheetpr(a[0],o,n,i),(s=t.match(/drawing r:id="(.*?)"/))&&(o["!rel"]=s[1]),r["!id"][o["!rel"]]&&(o["!drawel"]=r["!id"][o["!rel"]]),o}function parse_BrtCsProp(t,e){return t.l+=10,{name:parse_XLWideString(t)}}function parse_cs_bin(t,e,i,r,n){if(!t)return t;r||(r={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},o=!1;return recordhopper(t,(function(t,r,a){switch(a){case 550:s["!rel"]=t;break;case 651:n.Sheets[i]||(n.Sheets[i]={}),t.name&&(n.Sheets[i].CodeName=t.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:case 37:case 38:break;case 35:o=!0;break;case 36:o=!1;break;default:if(r.T>0);else if(r.T<0);else if(!o||e.WTF)throw new Error("Unexpected record 0x"+a.toString(16))}}),e),r["!id"][s["!rel"]]&&(s["!drawel"]=r["!id"][s["!rel"]]),s}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],WBViewDef=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],SheetDef=[],CalcPrDef=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function push_defaults_array(t,e){for(var i=0;i!=t.length;++i)for(var r=t[i],n=0;n!=e.length;++n){var s=e[n];if(null==r[s[0]])r[s[0]]=s[1];else switch(s[2]){case"bool":"string"==typeof r[s[0]]&&(r[s[0]]=parsexmlbool(r[s[0]]));break;case"int":"string"==typeof r[s[0]]&&(r[s[0]]=parseInt(r[s[0]],10))}}}function push_defaults(t,e){for(var i=0;i!=e.length;++i){var r=e[i];if(null==t[r[0]])t[r[0]]=r[1];else switch(r[2]){case"bool":"string"==typeof t[r[0]]&&(t[r[0]]=parsexmlbool(t[r[0]]));break;case"int":"string"==typeof t[r[0]]&&(t[r[0]]=parseInt(t[r[0]],10))}}}function parse_wb_defaults(t){push_defaults(t.WBProps,WBPropsDef),push_defaults(t.CalcPr,CalcPrDef),push_defaults_array(t.WBView,WBViewDef),push_defaults_array(t.Sheets,SheetDef),_ssfopts.date1904=parsexmlbool(t.WBProps.date1904)}var badchars="][*?/\\".split("");function check_ws_name(t,e){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");return badchars.forEach((function(e){if(-1!=t.indexOf(e))throw new Error("Sheet name cannot contain : \\ / ? * [ ]")})),!0}var wbnsregex=/<\w+:workbook/;function parse_wb_xml(t,e){if(!t)throw new Error("Could not find file");var i={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},r=!1,n="xmlns",s={},o=0;if(t.replace(tagregex,(function(a,l){var c=parsexmltag(a);switch(strip_ns(c[0])){case"<?xml":case"</workbook>":case"<fileVersion/>":case"</fileVersion>":case"<fileSharing":case"<fileSharing/>":case"</workbookPr>":case"<workbookProtection":case"<workbookProtection/>":case"<bookViews":case"<bookViews>":case"</bookViews>":case"</workbookView>":case"<sheets":case"<sheets>":case"</sheets>":case"</sheet>":case"<functionGroups":case"<functionGroups/>":case"<functionGroup":case"<externalReferences":case"</externalReferences>":case"<externalReferences>":case"<externalReference":case"<definedNames/>":case"<definedName/>":case"</calcPr>":case"<oleSize":case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":case"<customWorkbookView":case"</customWorkbookView>":case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":case"<pivotCache":case"<smartTagPr":case"<smartTagPr/>":case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":case"<smartTagType":case"<webPublishing":case"<webPublishing/>":case"<fileRecoveryPr":case"<fileRecoveryPr/>":case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":case"<webPublishObject":case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":case"<ArchID":case"<revisionPtr":break;case"<workbook":a.match(wbnsregex)&&(n="xmlns"+a.match(/<(\w+):/)[1]),i.xmlns=c[n];break;case"<fileVersion":delete c[0],i.AppVersion=c;break;case"<workbookPr":case"<workbookPr/>":WBPropsDef.forEach((function(t){if(null!=c[t[0]])switch(t[2]){case"bool":i.WBProps[t[0]]=parsexmlbool(c[t[0]]);break;case"int":i.WBProps[t[0]]=parseInt(c[t[0]],10);break;default:i.WBProps[t[0]]=c[t[0]]}})),c.codeName&&(i.WBProps.CodeName=utf8read(c.codeName));break;case"<workbookView":case"<workbookView/>":delete c[0],i.WBView.push(c);break;case"<sheet":switch(c.state){case"hidden":c.Hidden=1;break;case"veryHidden":c.Hidden=2;break;default:c.Hidden=0}delete c.state,c.name=unescapexml(utf8read(c.name)),delete c[0],i.Sheets.push(c);break;case"<definedNames>":case"<definedNames":case"<ext":case"<AlternateContent":case"<AlternateContent>":r=!0;break;case"</definedNames>":case"</ext>":case"</AlternateContent>":r=!1;break;case"<definedName":(s={}).Name=utf8read(c.name),c.comment&&(s.Comment=c.comment),c.localSheetId&&(s.Sheet=+c.localSheetId),parsexmlbool(c.hidden||"0")&&(s.Hidden=!0),o=l+a.length;break;case"</definedName>":s.Ref=unescapexml(utf8read(t.slice(o,l))),i.Names.push(s);break;case"<calcPr":case"<calcPr/>":delete c[0],i.CalcPr=c;break;default:if(!r&&e.WTF)throw new Error("unrecognized "+c[0]+" in workbook")}return a})),-1===XMLNS_main.indexOf(i.xmlns))throw new Error("Unknown Namespace: "+i.xmlns);return parse_wb_defaults(i),i}function parse_BrtBundleSh(t,e){var i={};return i.Hidden=t.read_shift(4),i.iTabID=t.read_shift(4),i.strRelID=parse_RelID(t),i.name=parse_XLWideString(t),i}function parse_BrtWbProp(t,e){var i={},r=t.read_shift(4);i.defaultThemeVersion=t.read_shift(4);var n=e>8?parse_XLWideString(t):"";return n.length>0&&(i.CodeName=n),i.autoCompressPictures=!!(65536&r),i.backupFile=!!(64&r),i.checkCompatibility=!!(4096&r),i.date1904=!!(1&r),i.filterPrivacy=!!(8&r),i.hidePivotFieldList=!!(1024&r),i.promptedSolutions=!!(16&r),i.publishItems=!!(2048&r),i.refreshAllConnections=!!(262144&r),i.saveExternalLinkValues=!!(128&r),i.showBorderUnselectedTables=!!(4&r),i.showInkAnnotation=!!(32&r),i.showObjects=["all","placeholders","none"][r>>13&3],i.showPivotChartFilter=!!(32768&r),i.updateLinks=["userSet","never","always"][r>>8&3],i}function parse_BrtFRTArchID$(t,e){var i={};return t.read_shift(4),i.ArchID=t.read_shift(4),t.l+=e-8,i}function parse_BrtName(t,e,i){var r=t.l+e;t.l+=4,t.l+=1;var n=t.read_shift(4),s=parse_XLNameWideString(t),o=parse_XLSBNameParsedFormula(t,0,i),a=parse_XLNullableWideString(t);t.l=r;var l={Name:s,Ptg:o};return n<268435455&&(l.Sheet=n),a&&(l.Comment=a),l}function parse_wb_bin(t,e){var i={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},r=[],n=!1;e||(e={}),e.biff=12;var s=[],o=[[]];return o.SheetNames=[],o.XTI=[],XLSBRecordEnum[16]={n:"BrtFRTArchID$",f:parse_BrtFRTArchID$},recordhopper(t,(function(t,a,l){switch(l){case 156:o.SheetNames.push(t.name),i.Sheets.push(t);break;case 153:i.WBProps=t;break;case 39:null!=t.Sheet&&(e.SID=t.Sheet),t.Ref=stringify_formula(t.Ptg,null,null,o,e),delete e.SID,delete t.Ptg,s.push(t);break;case 1036:case 361:case 2071:case 158:case 143:case 664:case 353:case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:case 16:break;case 357:case 358:case 355:case 667:o[0].length?o.push([l,t]):o[0]=[l,t],o[o.length-1].XTI=[];break;case 362:0===o.length&&(o[0]=[],o[0].XTI=[]),o[o.length-1].XTI=o[o.length-1].XTI.concat(t),o.XTI=o.XTI.concat(t);break;case 35:case 37:r.push(l),n=!0;break;case 36:case 38:r.pop(),n=!1;break;default:if(a.T);else if(!n||e.WTF&&37!=r[r.length-1]&&35!=r[r.length-1])throw new Error("Unexpected record 0x"+l.toString(16))}}),e),parse_wb_defaults(i),i.Names=s,i.supbooks=o,i}function parse_wb(t,e,i){return".bin"===e.slice(-4)?parse_wb_bin(t,i):parse_wb_xml(t,i)}function parse_ws(t,e,i,r,n,s,o,a){return".bin"===e.slice(-4)?parse_ws_bin(t,r,i,n,s,o,a):parse_ws_xml(t,r,i,n,s,o,a)}function parse_cs(t,e,i,r,n,s,o,a){return".bin"===e.slice(-4)?parse_cs_bin(t,r,i,n,s):parse_cs_xml(t,r,i,n,s)}function parse_ms(t,e,i,r,n,s,o,a){return".bin"===e.slice(-4)?parse_ms_bin():parse_ms_xml()}function parse_ds(t,e,i,r,n,s,o,a){return".bin"===e.slice(-4)?parse_ds_bin():parse_ds_xml()}function parse_sty(t,e,i,r){return".bin"===e.slice(-4)?parse_sty_bin(t,i,r):parse_sty_xml(t,i,r)}function parse_theme(t,e,i){return parse_theme_xml(t,i)}function parse_sst(t,e,i){return".bin"===e.slice(-4)?parse_sst_bin(t,i):parse_sst_xml(t,i)}function parse_cmnt(t,e,i){return".bin"===e.slice(-4)?parse_comments_bin(t,i):parse_comments_xml(t,i)}function parse_cc(t,e,i){return".bin"===e.slice(-4)?parse_cc_bin(t):parse_cc_xml(t)}function parse_xlink(t,e,i,r){return".bin"===i.slice(-4)?parse_xlink_bin(t,e,i,r):parse_xlink_xml()}function parse_xlmeta(t,e,i){return".bin"===e.slice(-4)?parse_xlmeta_bin(t,e,i):parse_xlmeta_xml(t,e,i)}var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/,XLMLFormatMap;function xlml_parsexmltag(t,e){var i=t.split(/\s+/),r=[];if(r[0]=i[0],1===i.length)return r;var n,s,o,a=t.match(attregexg2);if(a)for(o=0;o!=a.length;++o)-1===(s=(n=a[o].match(attregex2))[1].indexOf(":"))?r[n[1]]=n[2].slice(1,n[2].length-1):r["xmlns:"===n[1].slice(0,6)?"xmlns"+n[1].slice(6):n[1].slice(s+1)]=n[2].slice(1,n[2].length-1);return r}function xlml_parsexmltagobj(t){var e={};if(1===t.split(/\s+/).length)return e;var i,r,n,s=t.match(attregexg2);if(s)for(n=0;n!=s.length;++n)-1===(r=(i=s[n].match(attregex2))[1].indexOf(":"))?e[i[1]]=i[2].slice(1,i[2].length-1):e["xmlns:"===i[1].slice(0,6)?"xmlns"+i[1].slice(6):i[1].slice(r+1)]=i[2].slice(1,i[2].length-1);return e}function xlml_format(t,e){var i=XLMLFormatMap[t]||unescapexml(t);return"General"===i?SSF_general(e):SSF_format(i,e)}function xlml_set_custprop(t,e,i,r){var n=r;switch((i[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":n=parsexmlbool(r);break;case"i2":case"int":n=parseInt(r,10);break;case"r4":case"float":n=parseFloat(r);break;case"date":case"dateTime.tz":n=parseDate(r);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+i[0])}t[unescapexml(e)]=n}function safe_format_xlml(t,i,r){if("z"!==t.t){if(!r||!1!==r.cellText)try{"e"===t.t?t.w=t.w||BErr[t.v]:"General"===i?"n"===t.t?(0|t.v)===t.v?t.w=t.v.toString(10):t.w=SSF_general_num(t.v):t.w=SSF_general(t.v):t.w=xlml_format(i||"General",t.v)}catch(e){if(r.WTF)throw e}try{var n=XLMLFormatMap[i]||i||"General";if(r.cellNF&&(t.z=n),r.cellDates&&"n"==t.t&&fmt_is_date(n)){var s=SSF_parse_date_code(t.v);s&&(t.t="d",t.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}catch(e){if(r.WTF)throw e}}}function process_style_xlml(t,e,i){if(i.cellStyles&&e.Interior){var r=e.Interior;r.Pattern&&(r.patternType=XLMLPatternTypeMap[r.Pattern]||r.Pattern)}t[e.ID]=e}function parse_xlml_data(t,e,i,r,n,s,o,a,l,c){var h="General",u=r.StyleID,d={};c=c||{};var p=[],f=0;for(void 0===u&&a&&(u=a.StyleID),void 0===u&&o&&(u=o.StyleID);void 0!==s[u]&&(s[u].nf&&(h=s[u].nf),s[u].Interior&&p.push(s[u].Interior),s[u].Parent);)u=s[u].Parent;switch(i.Type){case"Boolean":r.t="b",r.v=parsexmlbool(t);break;case"String":r.t="s",r.r=xlml_fixstr(unescapexml(t)),r.v=t.indexOf("<")>-1?unescapexml(e||t).replace(/<.*?>/g,""):r.r;break;case"DateTime":"Z"!=t.slice(-1)&&(t+="Z"),r.v=(parseDate(t)-new Date(Date.UTC(1899,11,30)))/864e5,r.v!=r.v?r.v=unescapexml(t):r.v<60&&(r.v=r.v-1),h&&"General"!=h||(h="yyyy-mm-dd");case"Number":void 0===r.v&&(r.v=+t),r.t||(r.t="n");break;case"Error":r.t="e",r.v=RBErr[t],!1!==c.cellText&&(r.w=t);break;default:""==t&&""==e?r.t="z":(r.t="s",r.v=xlml_fixstr(e||t))}if(safe_format_xlml(r,h,c),!1!==c.cellFormula)if(r.Formula){var _=unescapexml(r.Formula);61==_.charCodeAt(0)&&(_=_.slice(1)),r.f=rc_to_a1(_,n),delete r.Formula,"RC"==r.ArrayRange?r.F=rc_to_a1("RC:RC",n):r.ArrayRange&&(r.F=rc_to_a1(r.ArrayRange,n),l.push([safe_decode_range(r.F),r.F]))}else for(f=0;f<l.length;++f)n.r>=l[f][0].s.r&&n.r<=l[f][0].e.r&&n.c>=l[f][0].s.c&&n.c<=l[f][0].e.c&&(r.F=l[f][1]);c.cellStyles&&(p.forEach((function(t){!d.patternType&&t.patternType&&(d.patternType=t.patternType)})),r.s=d),void 0!==r.StyleID&&(r.ixfe=r.StyleID)}function xlml_clean_comment(t){t.t=t.v||"",t.t=t.t.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),t.v=t.w=t.ixfe=void 0}function parse_xlml_xml(t,e){var i=e||{};make_ssf();var r=debom(xlml_normalize(t));"binary"!=i.type&&"array"!=i.type&&"base64"!=i.type||(r=utf8read(r));var n,s=r.slice(0,1024).toLowerCase(),o=!1;if((1023&(s=s.replace(/".*?"/g,"")).indexOf(">"))>Math.min(1023&s.indexOf(","),1023&s.indexOf(";"))){var a=dup(i);return a.type="string",PRN.to_workbook(r,a)}if(-1==s.indexOf("<?xml")&&["html","table","head","meta","script","style","div"].forEach((function(t){s.indexOf("<"+t)>=0&&(o=!0)})),o)return html_to_workbook(r,i);XLMLFormatMap={"General Number":"General","General Date":table_fmt[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":table_fmt[15],"Short Date":table_fmt[14],"Long Time":table_fmt[19],"Medium Time":table_fmt[18],"Short Time":table_fmt[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:table_fmt[2],Standard:table_fmt[4],Percent:table_fmt[10],Scientific:table_fmt[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var l,c,h=[],u={},d=[],p=i.dense?[]:{},f="",_={},m={},g=xlml_parsexmltag('<Data ss:Type="String">'),y=0,v=0,b=0,x={s:{r:2e6,c:2e6},e:{r:0,c:0}},T={},C={},S="",w=0,A=[],E={},D={},L=0,I=[],P=[],M={},R=[],O=!1,B=[],N=[],k={},F=0,V=0,j={Sheets:[],WBProps:{date1904:!1}},G={};xlmlregex.lastIndex=0,r=r.replace(/<!--([\s\S]*?)-->/gm,"");for(var U="";n=xlmlregex.exec(r);)switch(n[3]=(U=n[3]).toLowerCase()){case"data":if("data"==U){if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else"/"!==n[0].charAt(n[0].length-2)&&h.push([n[3],!0]);break}if(h[h.length-1][1])break;"/"===n[1]?parse_xlml_data(r.slice(y,n.index),S,g,"comment"==h[h.length-1][0]?M:_,{c:v,r:b},T,R[v],m,B,i):(S="",g=xlml_parsexmltag(n[0]),y=n.index+n[0].length);break;case"cell":if("/"===n[1])if(P.length>0&&(_.c=P),(!i.sheetRows||i.sheetRows>b)&&void 0!==_.v&&(i.dense?(p[b]||(p[b]=[]),p[b][v]=_):p[encode_col(v)+encode_row(b)]=_),_.HRef&&(_.l={Target:unescapexml(_.HRef)},_.HRefScreenTip&&(_.l.Tooltip=_.HRefScreenTip),delete _.HRef,delete _.HRefScreenTip),(_.MergeAcross||_.MergeDown)&&(F=v+(0|parseInt(_.MergeAcross,10)),V=b+(0|parseInt(_.MergeDown,10)),A.push({s:{c:v,r:b},e:{c:F,r:V}})),i.sheetStubs)if(_.MergeAcross||_.MergeDown){for(var Y=v;Y<=F;++Y)for(var H=b;H<=V;++H)(Y>v||H>b)&&(i.dense?(p[H]||(p[H]=[]),p[H][Y]={t:"z"}):p[encode_col(Y)+encode_row(H)]={t:"z"});v=F+1}else++v;else _.MergeAcross?v=F+1:++v;else(_=xlml_parsexmltagobj(n[0])).Index&&(v=+_.Index-1),v<x.s.c&&(x.s.c=v),v>x.e.c&&(x.e.c=v),"/>"===n[0].slice(-2)&&++v,P=[];break;case"row":"/"===n[1]||"/>"===n[0].slice(-2)?(b<x.s.r&&(x.s.r=b),b>x.e.r&&(x.e.r=b),"/>"===n[0].slice(-2)&&(m=xlml_parsexmltag(n[0])).Index&&(b=+m.Index-1),v=0,++b):((m=xlml_parsexmltag(n[0])).Index&&(b=+m.Index-1),k={},("0"==m.AutoFitHeight||m.Height)&&(k.hpx=parseInt(m.Height,10),k.hpt=px2pt(k.hpx),N[b]=k),"1"==m.Hidden&&(k.hidden=!0,N[b]=k));break;case"worksheet":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"));d.push(f),x.s.r<=x.e.r&&x.s.c<=x.e.c&&(p["!ref"]=encode_range(x),i.sheetRows&&i.sheetRows<=x.e.r&&(p["!fullref"]=p["!ref"],x.e.r=i.sheetRows-1,p["!ref"]=encode_range(x))),A.length&&(p["!merges"]=A),R.length>0&&(p["!cols"]=R),N.length>0&&(p["!rows"]=N),u[f]=p}else x={s:{r:2e6,c:2e6},e:{r:0,c:0}},b=v=0,h.push([n[3],!1]),l=xlml_parsexmltag(n[0]),f=unescapexml(l.Name),p=i.dense?[]:{},A=[],B=[],N=[],G={name:f,Hidden:0},j.Sheets.push(G);break;case"table":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else{if("/>"==n[0].slice(-2))break;h.push([n[3],!1]),R=[],O=!1}break;case"style":"/"===n[1]?process_style_xlml(T,C,i):C=xlml_parsexmltag(n[0]);break;case"numberformat":C.nf=unescapexml(xlml_parsexmltag(n[0]).Format||"General"),XLMLFormatMap[C.nf]&&(C.nf=XLMLFormatMap[C.nf]);for(var X=0;392!=X&&table_fmt[X]!=C.nf;++X);if(392==X)for(X=57;392!=X;++X)if(null==table_fmt[X]){SSF_load(C.nf,X);break}break;case"column":if("table"!==h[h.length-1][0])break;if((c=xlml_parsexmltag(n[0])).Hidden&&(c.hidden=!0,delete c.Hidden),c.Width&&(c.wpx=parseInt(c.Width,10)),!O&&c.wpx>10){O=!0,MDW=DEF_MDW;for(var z=0;z<R.length;++z)R[z]&&process_col(R[z])}O&&process_col(c),R[c.Index-1||R.length]=c;for(var W=0;W<+c.Span;++W)R[R.length]=dup(c);break;case"namedrange":if("/"===n[1])break;j.Names||(j.Names=[]);var Z=parsexmltag(n[0]),J={Name:Z.Name,Ref:rc_to_a1(Z.RefersTo.slice(1),{r:0,c:0})};j.Sheets.length>0&&(J.Sheet=j.Sheets.length-1),j.Names.push(J);break;case"namedcell":case"b":case"i":case"u":case"s":case"em":case"h2":case"h3":case"sub":case"sup":case"span":case"alignment":case"borders":case"border":case"protection":case"paragraphs":case"name":case"pixelsperinch":case"null":break;case"font":if("/>"===n[0].slice(-2))break;"/"===n[1]?S+=r.slice(w,n.index):w=n.index+n[0].length;break;case"interior":if(!i.cellStyles)break;C.Interior=xlml_parsexmltag(n[0]);break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if("/>"===n[0].slice(-2))break;"/"===n[1]?xlml_set_prop(E,U,r.slice(L,n.index)):L=n.index+n[0].length;break;case"styles":case"workbook":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else h.push([n[3],!1]);break;case"comment":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"));xlml_clean_comment(M),P.push(M)}else h.push([n[3],!1]),M={a:(l=xlml_parsexmltag(n[0])).Author};break;case"autofilter":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else if("/"!==n[0].charAt(n[0].length-2)){var q=xlml_parsexmltag(n[0]);p["!autofilter"]={ref:rc_to_a1(q.Range).replace(/\$/g,"")},h.push([n[3],!0])}break;case"datavalidation":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else"/"!==n[0].charAt(n[0].length-2)&&h.push([n[3],!0]);break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if("/"===n[1]){if((l=h.pop())[0]!==n[3])throw new Error("Bad state: "+l.join("|"))}else"/"!==n[0].charAt(n[0].length-2)&&h.push([n[3],!0]);break;default:if(0==h.length&&"document"==n[3])return parse_fods(r,i);if(0==h.length&&"uof"==n[3])return parse_fods(r,i);var K=!0;switch(h[h.length-1][0]){case"officedocumentsettings":switch(n[3]){case"allowpng":case"removepersonalinformation":case"downloadcomponents":case"locationofcomponents":case"colors":case"color":case"index":case"rgb":case"targetscreensize":case"readonlyrecommended":break;default:K=!1}break;case"componentoptions":switch(n[3]){case"toolbar":case"hideofficelogo":case"spreadsheetautofit":case"label":case"caption":case"maxheight":case"maxwidth":case"nextsheetnumber":break;default:K=!1}break;case"excelworkbook":switch(n[3]){case"date1904":j.WBProps.date1904=!0;break;case"windowheight":case"windowwidth":case"windowtopx":case"windowtopy":case"tabratio":case"protectstructure":case"protectwindow":case"protectwindows":case"activesheet":case"displayinknotes":case"firstvisiblesheet":case"supbook":case"sheetname":case"sheetindex":case"sheetindexfirst":case"sheetindexlast":case"dll":case"acceptlabelsinformulas":case"donotsavelinkvalues":case"iteration":case"maxiterations":case"maxchange":case"path":case"xct":case"count":case"selectedsheets":case"calculation":case"uncalced":case"startupprompt":case"crn":case"externname":case"formula":case"colfirst":case"collast":case"wantadvise":case"boolean":case"error":case"text":case"ole":case"noautorecover":case"publishobjects":case"donotcalculatebeforesave":case"number":case"refmoder1c1":case"embedsavesmarttags":break;default:K=!1}break;case"workbookoptions":switch(n[3]){case"owcversion":case"height":case"width":break;default:K=!1}break;case"worksheetoptions":switch(n[3]){case"visible":if("/>"===n[0].slice(-2));else if("/"===n[1])switch(r.slice(L,n.index)){case"SheetHidden":G.Hidden=1;break;case"SheetVeryHidden":G.Hidden=2}else L=n.index+n[0].length;break;case"header":p["!margins"]||default_margins(p["!margins"]={},"xlml"),isNaN(+parsexmltag(n[0]).Margin)||(p["!margins"].header=+parsexmltag(n[0]).Margin);break;case"footer":p["!margins"]||default_margins(p["!margins"]={},"xlml"),isNaN(+parsexmltag(n[0]).Margin)||(p["!margins"].footer=+parsexmltag(n[0]).Margin);break;case"pagemargins":var Q=parsexmltag(n[0]);p["!margins"]||default_margins(p["!margins"]={},"xlml"),isNaN(+Q.Top)||(p["!margins"].top=+Q.Top),isNaN(+Q.Left)||(p["!margins"].left=+Q.Left),isNaN(+Q.Right)||(p["!margins"].right=+Q.Right),isNaN(+Q.Bottom)||(p["!margins"].bottom=+Q.Bottom);break;case"displayrighttoleft":j.Views||(j.Views=[]),j.Views[0]||(j.Views[0]={}),j.Views[0].RTL=!0;break;case"freezepanes":case"frozennosplit":case"splithorizontal":case"splitvertical":case"donotdisplaygridlines":case"activerow":case"activecol":case"toprowbottompane":case"leftcolumnrightpane":case"unsynced":case"print":case"printerrors":case"panes":case"scale":case"pane":case"number":case"layout":case"pagesetup":case"selected":case"protectobjects":case"enableselection":case"protectscenarios":case"validprinterinfo":case"horizontalresolution":case"verticalresolution":case"numberofcopies":case"activepane":case"toprowvisible":case"leftcolumnvisible":case"fittopage":case"rangeselection":case"papersizeindex":case"pagelayoutzoom":case"pagebreakzoom":case"filteron":case"fitwidth":case"fitheight":case"commentslayout":case"zoom":case"lefttoright":case"gridlines":case"allowsort":case"allowfilter":case"allowinsertrows":case"allowdeleterows":case"allowinsertcols":case"allowdeletecols":case"allowinserthyperlinks":case"allowformatcells":case"allowsizecols":case"allowsizerows":case"tabcolorindex":case"donotdisplayheadings":case"showpagelayoutzoom":case"blackandwhite":case"donotdisplayzeros":case"displaypagebreak":case"rowcolheadings":case"donotdisplayoutline":case"noorientation":case"allowusepivottables":case"zeroheight":case"viewablerange":case"selection":case"protectcontents":break;case"nosummaryrowsbelowdetail":p["!outline"]||(p["!outline"]={}),p["!outline"].above=!0;break;case"nosummarycolumnsrightdetail":p["!outline"]||(p["!outline"]={}),p["!outline"].left=!0;break;default:K=!1}break;case"pivottable":case"pivotcache":switch(n[3]){case"immediateitemsondrop":case"showpagemultipleitemlabel":case"compactrowindent":case"location":case"pivotfield":case"orientation":case"layoutform":case"layoutsubtotallocation":case"layoutcompactrow":case"position":case"pivotitem":case"datatype":case"datafield":case"sourcename":case"parentfield":case"ptlineitems":case"ptlineitem":case"countofsameitems":case"item":case"itemtype":case"ptsource":case"cacheindex":case"consolidationreference":case"filename":case"reference":case"nocolumngrand":case"norowgrand":case"blanklineafteritems":case"hidden":case"subtotal":case"basefield":case"mapchilditems":case"function":case"refreshonfileopen":case"printsettitles":case"mergelabels":case"defaultversion":case"refreshname":case"refreshdate":case"refreshdatecopy":case"versionlastrefresh":case"versionlastupdate":case"versionupdateablemin":case"versionrefreshablemin":case"calculation":break;default:K=!1}break;case"pagebreaks":switch(n[3]){case"colbreaks":case"colbreak":case"rowbreaks":case"rowbreak":case"colstart":case"colend":case"rowend":break;default:K=!1}break;case"autofilter":switch(n[3]){case"autofiltercolumn":case"autofiltercondition":case"autofilterand":case"autofilteror":break;default:K=!1}break;case"querytable":switch(n[3]){case"id":case"autoformatfont":case"autoformatpattern":case"querysource":case"querytype":case"enableredirections":case"refreshedinxl9":case"urlstring":case"htmltables":case"connection":case"commandtext":case"refreshinfo":case"notitles":case"nextid":case"columninfo":case"overwritecells":case"donotpromptforfile":case"textwizardsettings":case"source":case"number":case"decimal":case"thousandseparator":case"trailingminusnumbers":case"formatsettings":case"fieldtype":case"delimiters":case"tab":case"comma":case"autoformatname":case"versionlastedit":case"versionlastrefresh":break;default:K=!1}break;case"datavalidation":switch(n[3]){case"range":case"type":case"min":case"max":case"sort":case"descending":case"order":case"casesensitive":case"value":case"errorstyle":case"errormessage":case"errortitle":case"inputmessage":case"inputtitle":case"combohide":case"inputhide":case"condition":case"qualifier":case"useblank":case"value1":case"value2":case"format":case"cellrangelist":break;default:K=!1}break;case"sorting":case"conditionalformatting":switch(n[3]){case"range":case"type":case"min":case"max":case"sort":case"descending":case"order":case"casesensitive":case"value":case"errorstyle":case"errormessage":case"errortitle":case"cellrangelist":case"inputmessage":case"inputtitle":case"combohide":case"inputhide":case"condition":case"qualifier":case"useblank":case"value1":case"value2":case"format":break;default:K=!1}break;case"mapinfo":case"schema":case"data":switch(n[3]){case"map":case"entry":case"range":case"xpath":case"field":case"xsdtype":case"filteron":case"aggregate":case"elementtype":case"attributetype":case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":case"row":break;default:K=!1}break;case"smarttags":break;default:K=!1}if(K)break;if(n[3].match(/!\[CDATA/))break;if(!h[h.length-1][1])throw"Unrecognized tag: "+n[3]+"|"+h.join("|");if("customdocumentproperties"===h[h.length-1][0]){if("/>"===n[0].slice(-2))break;"/"===n[1]?xlml_set_custprop(D,U,I,r.slice(L,n.index)):(I=n,L=n.index+n[0].length);break}if(i.WTF)throw"Unrecognized tag: "+n[3]+"|"+h.join("|")}var $={};return i.bookSheets||i.bookProps||($.Sheets=u),$.SheetNames=d,$.Workbook=j,$.SSF=dup(table_fmt),$.Props=E,$.Custprops=D,$}function parse_xlml(t,e){switch(fix_read_opts(e=e||{}),e.type||"base64"){case"base64":return parse_xlml_xml(Base64_decode(t),e);case"binary":case"buffer":case"file":return parse_xlml_xml(t,e);case"array":return parse_xlml_xml(a2s(t),e)}}function parse_compobj(t){var e={},i=t.content;if(i.l=28,e.AnsiUserType=i.read_shift(0,"lpstr-ansi"),e.AnsiClipboardFormat=parse_ClipboardFormatOrAnsiString(i),i.length-i.l<=4)return e;var r=i.read_shift(4);return 0==r||r>40?e:(i.l-=4,e.Reserved1=i.read_shift(0,"lpstr-ansi"),i.length-i.l<=4||1907505652!==(r=i.read_shift(4))?e:(e.UnicodeClipboardFormat=parse_ClipboardFormatOrUnicodeString(i),0==(r=i.read_shift(4))||r>40?e:(i.l-=4,void(e.Reserved2=i.read_shift(0,"lpwstr")))))}var CONTINUE_RT=[60,1084,2066,2165,2175];function slurp(t,e,i,r,n){var s=r,o=[],a=i.slice(i.l,i.l+s);if(n&&n.enc&&n.enc.insitu&&a.length>0)switch(t){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:case 133:break;default:n.enc.insitu(a)}o.push(a),i.l+=s;for(var l=__readUInt16LE(i,i.l),c=XLSRecordEnum[l],h=0;null!=c&&CONTINUE_RT.indexOf(l)>-1;)s=__readUInt16LE(i,i.l+2),h=i.l+4,2066==l?h+=4:2165!=l&&2175!=l||(h+=12),a=i.slice(h,i.l+4+s),o.push(a),i.l+=4+s,c=XLSRecordEnum[l=__readUInt16LE(i,i.l)];var u=bconcat(o);prep_blob(u,0);var d=0;u.lens=[];for(var p=0;p<o.length;++p)u.lens.push(d),d+=o[p].length;if(u.length<r)throw"XLS Record 0x"+t.toString(16)+" Truncated: "+u.length+" < "+r;return e.f(u,u.length,n)}function safe_format_xf(t,i,r){if("z"!==t.t&&t.XF){var n=0;try{n=t.z||t.XF.numFmtId||0,i.cellNF&&(t.z=table_fmt[n])}catch(e){if(i.WTF)throw e}if(!i||!1!==i.cellText)try{"e"===t.t?t.w=t.w||BErr[t.v]:0===n||"General"==n?"n"===t.t?(0|t.v)===t.v?t.w=t.v.toString(10):t.w=SSF_general_num(t.v):t.w=SSF_general(t.v):t.w=SSF_format(n,t.v,{date1904:!!r,dateNF:i&&i.dateNF})}catch(e){if(i.WTF)throw e}if(i.cellDates&&n&&"n"==t.t&&fmt_is_date(table_fmt[n]||String(n))){var s=SSF_parse_date_code(t.v);s&&(t.t="d",t.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}}function make_cell(t,e,i){return{v:t,ixfe:e,t:i}}function parse_workbook(t,e){var i,r,n,s,o,a,l,c,h={opts:{}},u={},d=e.dense?[]:{},p={},f={},_=null,m=[],g="",y={},v="",b={},x=[],T=[],C=[],S={Sheets:[],WBProps:{date1904:!1},Views:[{}]},w={},A=function(t){return t<8?XLSIcv[t]:t<64&&C[t-8]||XLSIcv[t]},E=function(t,e,r){if(!(k>1||r.sheetRows&&t.r>=r.sheetRows)){if(r.cellStyles&&e.XF&&e.XF.data&&function(t,e,i){var r,n=e.XF.data;n&&n.patternType&&i&&i.cellStyles&&(e.s={},e.s.patternType=n.patternType,(r=rgb2Hex(A(n.icvFore)))&&(e.s.fgColor={rgb:r}),(r=rgb2Hex(A(n.icvBack)))&&(e.s.bgColor={rgb:r}))}(0,e,r),delete e.ixfe,delete e.XF,i=t,v=encode_cell(t),f&&f.s&&f.e||(f={s:{r:0,c:0},e:{r:0,c:0}}),t.r<f.s.r&&(f.s.r=t.r),t.c<f.s.c&&(f.s.c=t.c),t.r+1>f.e.r&&(f.e.r=t.r+1),t.c+1>f.e.c&&(f.e.c=t.c+1),r.cellFormula&&e.f)for(var n=0;n<x.length;++n)if(!(x[n][0].s.c>t.c||x[n][0].s.r>t.r||x[n][0].e.c<t.c||x[n][0].e.r<t.r)){e.F=encode_range(x[n][0]),x[n][0].s.c==t.c&&x[n][0].s.r==t.r||delete e.f,e.f&&(e.f=""+stringify_formula(x[n][1],f,t,O,D));break}r.dense?(d[t.r]||(d[t.r]=[]),d[t.r][t.c]=e):d[v]=e}},D={enc:!1,sbcch:0,snames:[],sharedf:b,arrayf:x,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!e&&!!e.cellStyles,WTF:!!e&&!!e.wtf};e.password&&(D.password=e.password);var L=[],I=[],P=[],M=[],R=!1,O=[];O.SheetNames=D.snames,O.sharedf=D.sharedf,O.arrayf=D.arrayf,O.names=[],O.XTI=[];var B,N=0,k=0,F=0,V=[],j=[];D.codepage=1200,set_cp(1200);for(var G=!1;t.l<t.length-1;){var U=t.l,Y=t.read_shift(2);if(0===Y&&10===N)break;var H=t.l===t.length?0:t.read_shift(2),X=XLSRecordEnum[Y];if(X&&X.f){if(e.bookSheets&&133===N&&133!==Y)break;if(N=Y,2===X.r||12==X.r){var z=t.read_shift(2);if(H-=2,!D.enc&&z!==Y&&((255&z)<<8|z>>8)!==Y)throw new Error("rt mismatch: "+z+"!="+Y);12==X.r&&(t.l+=10,H-=10)}var W={};if(W=10===Y?X.f(t,H,D):slurp(Y,X,t,H,D),0==k&&-1===[9,521,1033,2057].indexOf(N))continue;switch(Y){case 34:h.opts.Date1904=S.WBProps.date1904=W;break;case 134:h.opts.WriteProtect=!0;break;case 47:if(D.enc||(t.l=0),D.enc=W,!e.password)throw new Error("File is password-protected");if(null==W.valid)throw new Error("Encryption scheme unsupported");if(!W.valid)throw new Error("Password is incorrect");break;case 92:D.lastuser=W;break;case 66:var Z=Number(W);switch(Z){case 21010:Z=1200;break;case 32768:Z=1e4;break;case 32769:Z=1252}set_cp(D.codepage=Z),G=!0;break;case 317:D.rrtabid=W;break;case 25:D.winlocked=W;break;case 439:h.opts.RefreshAll=W;break;case 12:h.opts.CalcCount=W;break;case 16:h.opts.CalcDelta=W;break;case 17:h.opts.CalcIter=W;break;case 13:h.opts.CalcMode=W;break;case 14:h.opts.CalcPrecision=W;break;case 95:h.opts.CalcSaveRecalc=W;break;case 15:D.CalcRefMode=W;break;case 2211:h.opts.FullCalc=W;break;case 129:W.fDialog&&(d["!type"]="dialog"),W.fBelow||((d["!outline"]||(d["!outline"]={})).above=!0),W.fRight||((d["!outline"]||(d["!outline"]={})).left=!0);break;case 224:T.push(W);break;case 430:O.push([W]),O[O.length-1].XTI=[];break;case 35:case 547:O[O.length-1].push(W);break;case 24:case 536:B={Name:W.Name,Ref:stringify_formula(W.rgce,f,null,O,D)},W.itab>0&&(B.Sheet=W.itab-1),O.names.push(B),O[0]||(O[0]=[],O[0].XTI=[]),O[O.length-1].push(W),"_xlnm._FilterDatabase"==W.Name&&W.itab>0&&W.rgce&&W.rgce[0]&&W.rgce[0][0]&&"PtgArea3d"==W.rgce[0][0][0]&&(j[W.itab-1]={ref:encode_range(W.rgce[0][0][1][2])});break;case 22:D.ExternCount=W;break;case 23:0==O.length&&(O[0]=[],O[0].XTI=[]),O[O.length-1].XTI=O[O.length-1].XTI.concat(W),O.XTI=O.XTI.concat(W);break;case 2196:if(D.biff<8)break;null!=B&&(B.Comment=W[1]);break;case 18:d["!protect"]=W;break;case 19:0!==W&&D.WTF&&console.error("Password verifier: "+W);break;case 133:p[W.pos]=W,D.snames.push(W.name);break;case 10:if(--k)break;if(f.e){if(f.e.r>0&&f.e.c>0){if(f.e.r--,f.e.c--,d["!ref"]=encode_range(f),e.sheetRows&&e.sheetRows<=f.e.r){var J=f.e.r;f.e.r=e.sheetRows-1,d["!fullref"]=d["!ref"],d["!ref"]=encode_range(f),f.e.r=J}f.e.r++,f.e.c++}L.length>0&&(d["!merges"]=L),I.length>0&&(d["!objects"]=I),P.length>0&&(d["!cols"]=P),M.length>0&&(d["!rows"]=M),S.Sheets.push(w)}""===g?y=d:u[g]=d,d=e.dense?[]:{};break;case 9:case 521:case 1033:case 2057:if(8===D.biff&&(D.biff={9:2,521:3,1033:4}[Y]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[W.BIFFVer]||8),D.biffguess=0==W.BIFFVer,0==W.BIFFVer&&4096==W.dt&&(D.biff=5,G=!0,set_cp(D.codepage=28591)),8==D.biff&&0==W.BIFFVer&&16==W.dt&&(D.biff=2),k++)break;if(d=e.dense?[]:{},D.biff<8&&!G&&(G=!0,set_cp(D.codepage=e.codepage||1252)),D.biff<5||0==W.BIFFVer&&4096==W.dt){""===g&&(g="Sheet1"),f={s:{r:0,c:0},e:{r:0,c:0}};var q={pos:t.l-H,name:g};p[q.pos]=q,D.snames.push(g)}else g=(p[U]||{name:""}).name;32==W.dt&&(d["!type"]="chart"),64==W.dt&&(d["!type"]="macro"),L=[],I=[],D.arrayf=x=[],P=[],M=[],R=!1,w={Hidden:(p[U]||{hs:0}).hs,name:g};break;case 515:case 3:case 2:"chart"==d["!type"]&&(e.dense?(d[W.r]||[])[W.c]:d[encode_cell({c:W.c,r:W.r})])&&++W.c,a={ixfe:W.ixfe,XF:T[W.ixfe]||{},v:W.val,t:"n"},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e);break;case 5:case 517:a={ixfe:W.ixfe,XF:T[W.ixfe],v:W.val,t:W.t},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e);break;case 638:a={ixfe:W.ixfe,XF:T[W.ixfe],v:W.rknum,t:"n"},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e);break;case 189:for(var K=W.c;K<=W.C;++K){var Q=W.rkrec[K-W.c][0];a={ixfe:Q,XF:T[Q],v:W.rkrec[K-W.c][1],t:"n"},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:K,r:W.r},a,e)}break;case 6:case 518:case 1030:if("String"==W.val){_=W;break}if((a=make_cell(W.val,W.cell.ixfe,W.tt)).XF=T[a.ixfe],e.cellFormula){var $=W.formula;if($&&$[0]&&$[0][0]&&"PtgExp"==$[0][0][0]){var tt=$[0][0][1][0],et=$[0][0][1][1],it=encode_cell({r:tt,c:et});b[it]?a.f=""+stringify_formula(W.formula,f,W.cell,O,D):a.F=((e.dense?(d[tt]||[])[et]:d[it])||{}).F}else a.f=""+stringify_formula(W.formula,f,W.cell,O,D)}F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E(W.cell,a,e),_=W;break;case 7:case 519:if(!_)throw new Error("String record expects Formula");_.val=W,(a=make_cell(W,_.cell.ixfe,"s")).XF=T[a.ixfe],e.cellFormula&&(a.f=""+stringify_formula(_.formula,f,_.cell,O,D)),F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E(_.cell,a,e),_=null;break;case 33:case 545:x.push(W);var rt=encode_cell(W[0].s);if(r=e.dense?(d[W[0].s.r]||[])[W[0].s.c]:d[rt],e.cellFormula&&r){if(!_)break;if(!rt||!r)break;r.f=""+stringify_formula(W[1],f,W[0],O,D),r.F=encode_range(W[0])}break;case 1212:if(!e.cellFormula)break;if(v){if(!_)break;b[encode_cell(_.cell)]=W[0],((r=e.dense?(d[_.cell.r]||[])[_.cell.c]:d[encode_cell(_.cell)])||{}).f=""+stringify_formula(W[0],f,i,O,D)}break;case 253:a=make_cell(m[W.isst].t,W.ixfe,"s"),m[W.isst].h&&(a.h=m[W.isst].h),a.XF=T[a.ixfe],F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e);break;case 513:e.sheetStubs&&(a={ixfe:W.ixfe,XF:T[W.ixfe],t:"z"},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e));break;case 190:if(e.sheetStubs)for(var nt=W.c;nt<=W.C;++nt){var st=W.ixfe[nt-W.c];a={ixfe:st,XF:T[st],t:"z"},F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:nt,r:W.r},a,e)}break;case 214:case 516:case 4:(a=make_cell(W.val,W.ixfe,"s")).XF=T[a.ixfe],F>0&&(a.z=V[a.ixfe>>8&63]),safe_format_xf(a,e,h.opts.Date1904),E({c:W.c,r:W.r},a,e);break;case 0:case 512:1===k&&(f=W);break;case 252:m=W;break;case 1054:if(4==D.biff){V[F++]=W[1];for(var ot=0;ot<F+163&&table_fmt[ot]!=W[1];++ot);ot>=163&&SSF_load(W[1],F+163)}else SSF_load(W[1],W[0]);break;case 30:V[F++]=W;for(var at=0;at<F+163&&table_fmt[at]!=W;++at);at>=163&&SSF_load(W,F+163);break;case 229:L=L.concat(W);break;case 93:I[W.cmo[0]]=D.lastobj=W;break;case 438:D.lastobj.TxO=W;break;case 127:D.lastobj.ImData=W;break;case 440:for(o=W[0].s.r;o<=W[0].e.r;++o)for(s=W[0].s.c;s<=W[0].e.c;++s)(r=e.dense?(d[o]||[])[s]:d[encode_cell({c:s,r:o})])&&(r.l=W[1]);break;case 2048:for(o=W[0].s.r;o<=W[0].e.r;++o)for(s=W[0].s.c;s<=W[0].e.c;++s)(r=e.dense?(d[o]||[])[s]:d[encode_cell({c:s,r:o})])&&r.l&&(r.l.Tooltip=W[1]);break;case 28:if(D.biff<=5&&D.biff>=2)break;r=e.dense?(d[W[0].r]||[])[W[0].c]:d[encode_cell(W[0])];var lt=I[W[2]];r||(e.dense?(d[W[0].r]||(d[W[0].r]=[]),r=d[W[0].r][W[0].c]={t:"z"}):r=d[encode_cell(W[0])]={t:"z"},f.e.r=Math.max(f.e.r,W[0].r),f.s.r=Math.min(f.s.r,W[0].r),f.e.c=Math.max(f.e.c,W[0].c),f.s.c=Math.min(f.s.c,W[0].c)),r.c||(r.c=[]),n={a:W[1],t:lt.TxO.t},r.c.push(n);break;case 2173:update_xfext(T[W.ixfe],W.ext);break;case 125:if(!D.cellStyles)break;for(;W.e>=W.s;)P[W.e--]={width:W.w/256,level:W.level||0,hidden:!!(1&W.flags)},R||(R=!0,find_mdw_colw(W.w/256)),process_col(P[W.e+1]);break;case 520:var ct={};null!=W.level&&(M[W.r]=ct,ct.level=W.level),W.hidden&&(M[W.r]=ct,ct.hidden=!0),W.hpt&&(M[W.r]=ct,ct.hpt=W.hpt,ct.hpx=pt2px(W.hpt));break;case 38:case 39:case 40:case 41:d["!margins"]||default_margins(d["!margins"]={}),d["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[Y]]=W;break;case 161:d["!margins"]||default_margins(d["!margins"]={}),d["!margins"].header=W.header,d["!margins"].footer=W.footer;break;case 574:W.RTL&&(S.Views[0].RTL=!0);break;case 146:C=W;break;case 2198:c=W;break;case 140:l=W;break;case 442:g?w.CodeName=W||w.name:S.WBProps.CodeName=W||"ThisWorkbook"}}else X||console.error("Missing Info for XLS Record 0x"+Y.toString(16)),t.l+=H}return h.SheetNames=keys(p).sort((function(t,e){return Number(t)-Number(e)})).map((function(t){return p[t].name})),e.bookSheets||(h.Sheets=u),!h.SheetNames.length&&y["!ref"]?(h.SheetNames.push("Sheet1"),h.Sheets&&(h.Sheets.Sheet1=y)):h.Preamble=y,h.Sheets&&j.forEach((function(t,e){h.Sheets[h.SheetNames[e]]["!autofilter"]=t})),h.Strings=m,h.SSF=dup(table_fmt),D.enc&&(h.Encryption=D.enc),c&&(h.Themes=c),h.Metadata={},void 0!==l&&(h.Metadata.Country=l),O.names.length>0&&(S.Names=O.names),h.Workbook=S,h}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function parse_xls_props(t,i,r){var n=CFB.find(t,"/!DocumentSummaryInformation");if(n&&n.size>0)try{var s=parse_PropertySetStream(n,DocSummaryPIDDSI,PSCLSID.DSI);for(var o in s)i[o]=s[o]}catch(e){if(r.WTF)throw e}var a=CFB.find(t,"/!SummaryInformation");if(a&&a.size>0)try{var l=parse_PropertySetStream(a,SummaryPIDSI,PSCLSID.SI);for(var c in l)null==i[c]&&(i[c]=l[c])}catch(e){if(r.WTF)throw e}i.HeadingPairs&&i.TitlesOfParts&&(load_props_pairs(i.HeadingPairs,i.TitlesOfParts,i,r),delete i.HeadingPairs,delete i.TitlesOfParts)}function parse_xlscfb(t,e){var i,r,n,s;if(e||(e={}),fix_read_opts(e),reset_cp(),e.codepage&&set_ansi(e.codepage),t.FullPaths){if(CFB.find(t,"/encryption"))throw new Error("File is password-protected");i=CFB.find(t,"!CompObj"),r=CFB.find(t,"/Workbook")||CFB.find(t,"/Book")}else{switch(e.type){case"base64":t=s2a(Base64_decode(t));break;case"binary":t=s2a(t);break;case"buffer":break;case"array":Array.isArray(t)||(t=Array.prototype.slice.call(t))}prep_blob(t,0),r={content:t}}if(i&&parse_compobj(i),e.bookProps&&!e.bookSheets)n={};else{var o=has_buf?"buffer":"array";if(r&&r.content)n=parse_workbook(r.content,e);else if((s=CFB.find(t,"PerfectOffice_MAIN"))&&s.content)n=WK_.to_workbook(s.content,(e.type=o,e));else{if(!(s=CFB.find(t,"NativeContent_MAIN"))||!s.content)throw(s=CFB.find(t,"MN0"))&&s.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");n=WK_.to_workbook(s.content,(e.type=o,e))}e.bookVBA&&t.FullPaths&&CFB.find(t,"/_VBA_PROJECT_CUR/VBA/dir")&&(n.vbaraw=make_vba_xls(t))}var a={};return t.FullPaths&&parse_xls_props(t,a,e),n.Props=n.Custprops=a,e.bookFiles&&(n.cfb=t),n}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},XLSRecordEnum={6:{f:parse_Formula},10:{f:parsenoop2},12:{f:parseuint16},13:{f:parseuint16},14:{f:parsebool},15:{f:parsebool},16:{f:parse_Xnum},17:{f:parsebool},18:{f:parsebool},19:{f:parseuint16},20:{f:parse_XLHeaderFooter},21:{f:parse_XLHeaderFooter},23:{f:parse_ExternSheet},24:{f:parse_Lbl},25:{f:parsebool},26:{},27:{},28:{f:parse_Note},29:{},34:{f:parsebool},35:{f:parse_ExternName},38:{f:parse_Xnum},39:{f:parse_Xnum},40:{f:parse_Xnum},41:{f:parse_Xnum},42:{f:parsebool},43:{f:parsebool},47:{f:parse_FilePass},49:{f:parse_Font},51:{f:parseuint16},60:{},61:{f:parse_Window1},64:{f:parsebool},65:{f:parse_Pane},66:{f:parseuint16},77:{},80:{},81:{},82:{},85:{f:parseuint16},89:{},90:{},91:{},92:{f:parse_WriteAccess},93:{f:parse_Obj},94:{},95:{f:parsebool},96:{},97:{},99:{f:parsebool},125:{f:parse_ColInfo},128:{f:parse_Guts},129:{f:parse_WsBool},130:{f:parseuint16},131:{f:parsebool},132:{f:parsebool},133:{f:parse_BoundSheet8},134:{},140:{f:parse_Country},141:{f:parseuint16},144:{},146:{f:parse_Palette},151:{},152:{},153:{},154:{},155:{},156:{f:parseuint16},157:{},158:{},160:{f:parse_Scl},161:{f:parse_Setup},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:parse_MulRk},190:{f:parse_MulBlank},193:{f:parsenoop2},197:{},198:{},199:{},200:{},201:{},202:{f:parsebool},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:parseuint16},220:{},221:{f:parsebool},222:{},224:{f:parse_XF},225:{f:parse_InterfaceHdr},226:{f:parsenoop2},227:{},229:{f:parse_MergeCells},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:parse_SST},253:{f:parse_LabelSst},255:{f:parse_ExtSST},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:parseuint16a},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:parsebool},353:{f:parsenoop2},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:parse_SupBook},431:{f:parsebool},432:{},433:{},434:{},437:{},438:{f:parse_TxO},439:{f:parsebool},440:{f:parse_HLink},441:{},442:{f:parse_XLUnicodeString},443:{},444:{f:parseuint16},445:{},446:{},448:{f:parsenoop2},449:{f:parse_RecalcId,r:2},450:{f:parsenoop2},512:{f:parse_Dimensions},513:{f:parse_Blank},515:{f:parse_Number},516:{f:parse_Label},517:{f:parse_BoolErr},519:{f:parse_String},520:{f:parse_Row},523:{},545:{f:parse_Array},549:{f:parse_DefaultRowHeight},566:{},574:{f:parse_Window2},638:{f:parse_RK},659:{},1048:{},1054:{f:parse_Format},1084:{},1212:{f:parse_ShrFmla},2048:{f:parse_HLinkTooltip},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:parse_BOF},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:parsenoop2},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:parse_XFCRC,r:12},2173:{f:parse_XFExt,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:parsebool,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:parse_NameCmt,r:12},2197:{},2198:{f:parse_Theme,r:12},2199:{},2200:{},2201:{},2202:{f:parse_MTRSettings,r:12},2203:{f:parsenoop2},2204:{},2205:{},2206:{},2207:{},2211:{f:parse_ForceFullCalculation},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:parseuint16},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:parse_ShtProps},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:parse_ClrtClient},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:parse_Dimensions},1:{},2:{f:parse_BIFF2INT},3:{f:parse_BIFF2NUM},4:{f:parse_BIFF2STR},5:{f:parse_BoolErr},7:{f:parse_BIFF2STRING},8:{},9:{f:parse_BOF},11:{},22:{f:parseuint16},30:{f:parse_BIFF2Format},31:{},32:{},33:{f:parse_Array},36:{},37:{f:parse_DefaultRowHeight},50:{f:parse_BIFF2FONTXTRA},62:{},52:{},67:{},68:{f:parseuint16},69:{},86:{},126:{},127:{f:parse_ImData},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:parse_RString},223:{},234:{},354:{},421:{},518:{f:parse_Formula},521:{f:parse_BOF},536:{f:parse_Lbl},547:{f:parse_ExternName},561:{},579:{},1030:{f:parse_Formula},1033:{f:parse_BOF},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function write_biff_rec(t,e,i,r){var n=e;if(!isNaN(n)){var s=(i||[]).length||0,o=t.next(4);o.write_shift(2,n),o.write_shift(2,s),s>0&&is_buf(i)&&t.push(i)}}function html_to_sheet(t,e){var i=e||{},r=i.dense?[]:{},n=(t=t.replace(/<!--.*?-->/g,"")).match(/<table/i);if(!n)throw new Error("Invalid HTML: could not find <table>");var s=t.match(/<\/table/i),o=n.index,a=s&&s.index||t.length,l=split_regex(t.slice(o,a),/(:?<tr[^>]*>)/i,"<tr>"),c=-1,h=0,u=0,d=0,p={s:{r:1e7,c:1e7},e:{r:0,c:0}},f=[];for(o=0;o<l.length;++o){var _=l[o].trim(),m=_.slice(0,3).toLowerCase();if("<tr"!=m){if("<td"==m||"<th"==m){var g=_.split(/<\/t[dh]>/i);for(a=0;a<g.length;++a){var y=g[a].trim();if(y.match(/<t[dh]/i)){for(var v=y,b=0;"<"==v.charAt(0)&&(b=v.indexOf(">"))>-1;)v=v.slice(b+1);for(var x=0;x<f.length;++x){var T=f[x];T.s.c==h&&T.s.r<c&&c<=T.e.r&&(h=T.e.c+1,x=-1)}var C=parsexmltag(y.slice(0,y.indexOf(">")));d=C.colspan?+C.colspan:1,((u=+C.rowspan)>1||d>1)&&f.push({s:{r:c,c:h},e:{r:c+(u||1)-1,c:h+d-1}});var S=C.t||C["data-t"]||"";if(v.length)if(v=htmldecode(v),p.s.r>c&&(p.s.r=c),p.e.r<c&&(p.e.r=c),p.s.c>h&&(p.s.c=h),p.e.c<h&&(p.e.c=h),v.length){var w={t:"s",v:v};i.raw||!v.trim().length||"s"==S||("TRUE"===v?w={t:"b",v:!0}:"FALSE"===v?w={t:"b",v:!1}:isNaN(fuzzynum(v))?isNaN(fuzzydate(v).getDate())||(w={t:"d",v:parseDate(v)},i.cellDates||(w={t:"n",v:datenum(w.v)}),w.z=i.dateNF||table_fmt[14]):w={t:"n",v:fuzzynum(v)}),i.dense?(r[c]||(r[c]=[]),r[c][h]=w):r[encode_cell({r:c,c:h})]=w,h+=d}else h+=d;else h+=d}}}}else{if(++c,i.sheetRows&&i.sheetRows<=c){--c;break}h=0}}return r["!ref"]=encode_range(p),f.length&&(r["!merges"]=f),r}function make_html_row(t,e,i,r){for(var n=t["!merges"]||[],s=[],o=e.s.c;o<=e.e.c;++o){for(var a=0,l=0,c=0;c<n.length;++c)if(!(n[c].s.r>i||n[c].s.c>o||n[c].e.r<i||n[c].e.c<o)){if(n[c].s.r<i||n[c].s.c<o){a=-1;break}a=n[c].e.r-n[c].s.r+1,l=n[c].e.c-n[c].s.c+1;break}if(!(a<0)){var h=encode_cell({r:i,c:o}),u=r.dense?(t[i]||[])[o]:t[h],d=u&&null!=u.v&&(u.h||escapehtml(u.w||(format_cell(u),u.w)||""))||"",p={};a>1&&(p.rowspan=a),l>1&&(p.colspan=l),r.editable?d='<span contenteditable="true">'+d+"</span>":u&&(p["data-t"]=u&&u.t||"z",null!=u.v&&(p["data-v"]=u.v),null!=u.z&&(p["data-z"]=u.z),u.l&&"#"!=(u.l.Target||"#").charAt(0)&&(d='<a href="'+u.l.Target+'">'+d+"</a>")),p.id=(r.id||"sjs")+"-"+h,s.push(writextag("td",d,p))}}return"<tr>"+s.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function html_to_workbook(t,e){var i=t.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!i||0==i.length)throw new Error("Invalid HTML: could not find <table>");if(1==i.length)return sheet_to_workbook(html_to_sheet(i[0],e),e);var r=book_new();return i.forEach((function(t,i){book_append_sheet(r,html_to_sheet(t,e),"Sheet"+(i+1))})),r}function make_html_preamble(t,e,i){return[].join("")+"<table"+(i&&i.id?' id="'+i.id+'"':"")+">"}function sheet_to_html(t,e){var i=e||{},r=null!=i.header?i.header:HTML_BEGIN,n=null!=i.footer?i.footer:HTML_END,s=[r],o=decode_range(t["!ref"]);i.dense=Array.isArray(t),s.push(make_html_preamble(t,o,i));for(var a=o.s.r;a<=o.e.r;++a)s.push(make_html_row(t,o,a,i));return s.push("</table>"+n),s.join("")}function sheet_add_dom(t,e,i){var r=i||{},n=0,s=0;if(null!=r.origin)if("number"==typeof r.origin)n=r.origin;else{var o="string"==typeof r.origin?decode_cell(r.origin):r.origin;n=o.r,s=o.c}var a=e.getElementsByTagName("tr"),l=Math.min(r.sheetRows||1e7,a.length),c={s:{r:0,c:0},e:{r:n,c:s}};if(t["!ref"]){var h=decode_range(t["!ref"]);c.s.r=Math.min(c.s.r,h.s.r),c.s.c=Math.min(c.s.c,h.s.c),c.e.r=Math.max(c.e.r,h.e.r),c.e.c=Math.max(c.e.c,h.e.c),-1==n&&(c.e.r=n=h.e.r+1)}var u=[],d=0,p=t["!rows"]||(t["!rows"]=[]),f=0,_=0,m=0,g=0,y=0,v=0;for(t["!cols"]||(t["!cols"]=[]);f<a.length&&_<l;++f){var b=a[f];if(is_dom_element_hidden(b)){if(r.display)continue;p[_]={hidden:!0}}var x=b.children;for(m=g=0;m<x.length;++m){var T=x[m];if(!r.display||!is_dom_element_hidden(T)){var C=T.hasAttribute("data-v")?T.getAttribute("data-v"):T.hasAttribute("v")?T.getAttribute("v"):htmldecode(T.innerHTML),S=T.getAttribute("data-z")||T.getAttribute("z");for(d=0;d<u.length;++d){var w=u[d];w.s.c==g+s&&w.s.r<_+n&&_+n<=w.e.r&&(g=w.e.c+1-s,d=-1)}v=+T.getAttribute("colspan")||1,((y=+T.getAttribute("rowspan")||1)>1||v>1)&&u.push({s:{r:_+n,c:g+s},e:{r:_+n+(y||1)-1,c:g+s+(v||1)-1}});var A={t:"s",v:C},E=T.getAttribute("data-t")||T.getAttribute("t")||"";null!=C&&(0==C.length?A.t=E||"z":r.raw||0==C.trim().length||"s"==E||("TRUE"===C?A={t:"b",v:!0}:"FALSE"===C?A={t:"b",v:!1}:isNaN(fuzzynum(C))?isNaN(fuzzydate(C).getDate())||(A={t:"d",v:parseDate(C)},r.cellDates||(A={t:"n",v:datenum(A.v)}),A.z=r.dateNF||table_fmt[14]):A={t:"n",v:fuzzynum(C)})),void 0===A.z&&null!=S&&(A.z=S);var D="",L=T.getElementsByTagName("A");if(L&&L.length)for(var I=0;I<L.length&&(!L[I].hasAttribute("href")||"#"==(D=L[I].getAttribute("href")).charAt(0));++I);D&&"#"!=D.charAt(0)&&(A.l={Target:D}),r.dense?(t[_+n]||(t[_+n]=[]),t[_+n][g+s]=A):t[encode_cell({c:g+s,r:_+n})]=A,c.e.c<g+s&&(c.e.c=g+s),g+=v}}++_}return u.length&&(t["!merges"]=(t["!merges"]||[]).concat(u)),c.e.r=Math.max(c.e.r,_-1+n),t["!ref"]=encode_range(c),_>=l&&(t["!fullref"]=encode_range((c.e.r=a.length-f+_-1+n,c))),t}function parse_dom_table(t,e){return sheet_add_dom((e||{}).dense?[]:{},t,e)}function table_to_book(t,e){return sheet_to_workbook(parse_dom_table(t,e),e)}function is_dom_element_hidden(t){var e="",i=get_get_computed_style_function(t);return i&&(e=i(t).getPropertyValue("display")),e||(e=t.style&&t.style.display),"none"===e}function get_get_computed_style_function(t){return t.ownerDocument.defaultView&&"function"==typeof t.ownerDocument.defaultView.getComputedStyle?t.ownerDocument.defaultView.getComputedStyle:"function"==typeof getComputedStyle?getComputedStyle:null}function parse_text_p(t){var e=t.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,(function(t,e){return Array(parseInt(e,10)+1).join(" ")})).replace(/<text:tab[^>]*\/>/g,"\t").replace(/<text:line-break\/>/g,"\n");return[unescapexml(e.replace(/<[^>]*>/g,""))]}var number_formats_ods={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function parse_content_xml(t,i){var r,n,s,o,a,l,c=i||{},h=xlml_normalize(t),u=[],d={name:""},p="",f=0,_={},m=[],g=c.dense?[]:{},y={value:""},v="",b=0,x=[],T=-1,C=-1,S={s:{r:1e6,c:1e7},e:{r:0,c:0}},w=0,A={},E=[],D={},L=[],I=1,P=1,M=[],R={Names:[]},O={},B=["",""],N=[],k={},F="",V=0,j=!1,G=!1,U=0;for(xlmlregex.lastIndex=0,h=h.replace(/<!--([\s\S]*?)-->/gm,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");a=xlmlregex.exec(h);)switch(a[3]=a[3].replace(/_.*$/,"")){case"table":case"工作表":"/"===a[1]?(S.e.c>=S.s.c&&S.e.r>=S.s.r?g["!ref"]=encode_range(S):g["!ref"]="A1:A1",c.sheetRows>0&&c.sheetRows<=S.e.r&&(g["!fullref"]=g["!ref"],S.e.r=c.sheetRows-1,g["!ref"]=encode_range(S)),E.length&&(g["!merges"]=E),L.length&&(g["!rows"]=L),s.name=s["名称"]||s.name,"undefined"!=typeof JSON&&JSON.stringify(s),m.push(s.name),_[s.name]=g,G=!1):"/"!==a[0].charAt(a[0].length-2)&&(s=parsexmltag(a[0],!1),T=C=-1,S.s.r=S.s.c=1e7,S.e.r=S.e.c=0,g=c.dense?[]:{},E=[],L=[],G=!0);break;case"table-row-group":"/"===a[1]?--w:++w;break;case"table-row":case"行":if("/"===a[1]){T+=I,I=1;break}if((o=parsexmltag(a[0],!1))["行号"]?T=o["行号"]-1:-1==T&&(T=0),(I=+o["number-rows-repeated"]||1)<10)for(U=0;U<I;++U)w>0&&(L[T+U]={level:w});C=-1;break;case"covered-table-cell":"/"!==a[1]&&++C,c.sheetStubs&&(c.dense?(g[T]||(g[T]=[]),g[T][C]={t:"z"}):g[encode_cell({r:T,c:C})]={t:"z"}),v="",x=[];break;case"table-cell":case"数据":if("/"===a[0].charAt(a[0].length-2))++C,y=parsexmltag(a[0],!1),P=parseInt(y["number-columns-repeated"]||"1",10),l={t:"z",v:null},y.formula&&0!=c.cellFormula&&(l.f=ods_to_csf_formula(unescapexml(y.formula))),"string"==(y["数据类型"]||y["value-type"])&&(l.t="s",l.v=unescapexml(y["string-value"]||""),c.dense?(g[T]||(g[T]=[]),g[T][C]=l):g[encode_cell({r:T,c:C})]=l),C+=P-1;else if("/"!==a[1]){v="",b=0,x=[],P=1;var Y=I?T+I-1:T;if(++C>S.e.c&&(S.e.c=C),C<S.s.c&&(S.s.c=C),T<S.s.r&&(S.s.r=T),Y>S.e.r&&(S.e.r=Y),N=[],k={},l={t:(y=parsexmltag(a[0],!1))["数据类型"]||y["value-type"],v:null},c.cellFormula)if(y.formula&&(y.formula=unescapexml(y.formula)),y["number-matrix-columns-spanned"]&&y["number-matrix-rows-spanned"]&&(D={s:{r:T,c:C},e:{r:T+(parseInt(y["number-matrix-rows-spanned"],10)||0)-1,c:C+(parseInt(y["number-matrix-columns-spanned"],10)||0)-1}},l.F=encode_range(D),M.push([D,l.F])),y.formula)l.f=ods_to_csf_formula(y.formula);else for(U=0;U<M.length;++U)T>=M[U][0].s.r&&T<=M[U][0].e.r&&C>=M[U][0].s.c&&C<=M[U][0].e.c&&(l.F=M[U][1]);switch((y["number-columns-spanned"]||y["number-rows-spanned"])&&(D={s:{r:T,c:C},e:{r:T+(parseInt(y["number-rows-spanned"],10)||0)-1,c:C+(parseInt(y["number-columns-spanned"],10)||0)-1}},E.push(D)),y["number-columns-repeated"]&&(P=parseInt(y["number-columns-repeated"],10)),l.t){case"boolean":l.t="b",l.v=parsexmlbool(y["boolean-value"]);break;case"float":case"percentage":case"currency":l.t="n",l.v=parseFloat(y.value);break;case"date":l.t="d",l.v=parseDate(y["date-value"]),c.cellDates||(l.t="n",l.v=datenum(l.v)),l.z="m/d/yy";break;case"time":l.t="n",l.v=parse_isodur(y["time-value"])/86400,c.cellDates&&(l.t="d",l.v=numdate(l.v)),l.z="HH:MM:SS";break;case"number":l.t="n",l.v=parseFloat(y["数据数值"]);break;default:if("string"!==l.t&&"text"!==l.t&&l.t)throw new Error("Unsupported value type "+l.t);l.t="s",null!=y["string-value"]&&(v=unescapexml(y["string-value"]),x=[])}}else{if(j=!1,"s"===l.t&&(l.v=v||"",x.length&&(l.R=x),j=0==b),O.Target&&(l.l=O),N.length>0&&(l.c=N,N=[]),v&&!1!==c.cellText&&(l.w=v),j&&(l.t="z",delete l.v),(!j||c.sheetStubs)&&!(c.sheetRows&&c.sheetRows<=T))for(var H=0;H<I;++H){if(P=parseInt(y["number-columns-repeated"]||"1",10),c.dense)for(g[T+H]||(g[T+H]=[]),g[T+H][C]=0==H?l:dup(l);--P>0;)g[T+H][C+P]=dup(l);else for(g[encode_cell({r:T+H,c:C})]=l;--P>0;)g[encode_cell({r:T+H,c:C+P})]=dup(l);S.e.c<=C&&(S.e.c=C)}C+=(P=parseInt(y["number-columns-repeated"]||"1",10))-1,P=0,l={},v="",x=[]}O={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if("/"===a[1]){if((r=u.pop())[0]!==a[3])throw"Bad state: "+r}else"/"!==a[0].charAt(a[0].length-2)&&u.push([a[3],!0]);break;case"annotation":if("/"===a[1]){if((r=u.pop())[0]!==a[3])throw"Bad state: "+r;k.t=v,x.length&&(k.R=x),k.a=F,N.push(k)}else"/"!==a[0].charAt(a[0].length-2)&&u.push([a[3],!1]);F="",V=0,v="",b=0,x=[];break;case"creator":"/"===a[1]?F=h.slice(V,a.index):V=a.index+a[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if("/"===a[1]){if((r=u.pop())[0]!==a[3])throw"Bad state: "+r}else"/"!==a[0].charAt(a[0].length-2)&&u.push([a[3],!1]);v="",b=0,x=[];break;case"scientific-number":case"currency-symbol":case"currency-style":case"script":case"libraries":case"automatic-styles":case"default-style":case"page-layout":case"style":case"map":case"font-face":case"paragraph-properties":case"table-properties":case"table-column-properties":case"table-row-properties":case"table-cell-properties":case"fraction":case"boolean-style":case"boolean":case"text-style":case"text-content":case"text-properties":case"embedded-text":case"body":case"电子表格":case"forms":case"table-column":case"table-header-rows":case"table-rows":case"table-column-group":case"table-header-columns":case"table-columns":case"null-date":case"graphic-properties":case"calculation-settings":case"named-expressions":case"label-range":case"label-ranges":case"named-expression":case"sort":case"sort-by":case"sort-groups":case"tab":case"line-break":case"span":case"s":case"date":case"object":case"title":case"标题":case"desc":case"binary-data":case"table-source":case"scenario":case"iteration":case"content-validations":case"content-validation":case"help-message":case"error-message":case"database-ranges":case"filter":case"filter-and":case"filter-or":case"filter-condition":case"list-level-style-bullet":case"list-level-style-number":case"list-level-properties":case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":case"event-listener":case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":case"config-item":case"page-number":case"page-count":case"time":case"cell-range-source":case"detective":case"operation":case"highlighted-range":case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":case"rect":case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":case"properties":case"property":case"table-protection":case"data-pilot-grand-total":case"office-document-common-attrs":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if("/"===a[1]){if(A[d.name]=p,(r=u.pop())[0]!==a[3])throw"Bad state: "+r}else"/"!==a[0].charAt(a[0].length-2)&&(p="",d=parsexmltag(a[0],!1),u.push([a[3],!0]));break;case"number":case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(u[u.length-1][0]){case"time-style":case"date-style":n=parsexmltag(a[0],!1),p+=number_formats_ods[a[3]]["long"===n.style?1:0]}break;case"text":if("/>"===a[0].slice(-2))break;if("/"===a[1])switch(u[u.length-1][0]){case"number-style":case"date-style":case"time-style":p+=h.slice(f,a.index)}else f=a.index+a[0].length;break;case"named-range":B=ods_to_csf_3D((n=parsexmltag(a[0],!1))["cell-range-address"]);var X={Name:n.name,Ref:B[0]+"!"+B[1]};G&&(X.Sheet=m.length),R.Names.push(X);break;case"p":case"文本串":if(["master-styles"].indexOf(u[u.length-1][0])>-1)break;if("/"!==a[1]||y&&y["string-value"])parsexmltag(a[0],!1),b=a.index+a[0].length;else{var z=parse_text_p(h.slice(b,a.index));v=(v.length>0?v+"\n":"")+z[0]}break;case"database-range":if("/"===a[1])break;try{_[(B=ods_to_csf_3D(parsexmltag(a[0])["target-range-address"]))[0]]["!autofilter"]={ref:B[1]}}catch(e){}break;case"a":if("/"!==a[1]){if(!(O=parsexmltag(a[0],!1)).href)break;O.Target=unescapexml(O.href),delete O.href,"#"==O.Target.charAt(0)&&O.Target.indexOf(".")>-1?(B=ods_to_csf_3D(O.Target.slice(1)),O.Target="#"+B[0]+"!"+B[1]):O.Target.match(/^\.\.[\\\/]/)&&(O.Target=O.Target.slice(3))}break;default:switch(a[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(c.WTF)throw new Error(a)}}var W={Sheets:_,SheetNames:m,Workbook:R};return c.bookSheets&&delete W.Sheets,W}function parse_ods(t,e){e=e||{},safegetzipfile(t,"META-INF/manifest.xml")&&parse_manifest(getzipdata(t,"META-INF/manifest.xml"),e);var i=getzipstr(t,"content.xml");if(!i)throw new Error("Missing content.xml in ODS / UOF file");var r=parse_content_xml(utf8read(i),e);return safegetzipfile(t,"meta.xml")&&(r.Props=parse_core_props(getzipdata(t,"meta.xml"))),r}function parse_fods(t,e){return parse_content_xml(t,e)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function u8str(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):utf8read(a2s(t))}function u8concat(t){var e=t.reduce((function(t,e){return t+e.length}),0),i=new Uint8Array(e),r=0;return t.forEach((function(t){i.set(t,r),r+=t.length})),i}function popcnt(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>>24}function readDecimal128LE(t,e){for(var i=(127&t[e+15])<<7|t[e+14]>>1,r=1&t[e+14],n=e+13;n>=e;--n)r=256*r+t[n];return(128&t[e+15]?-r:r)*Math.pow(10,i-6176)}function parse_varint49(t,e){var i=e?e[0]:0,r=127&t[i];t:if(t[i++]>=128){if(r|=(127&t[i])<<7,t[i++]<128)break t;if(r|=(127&t[i])<<14,t[i++]<128)break t;if(r|=(127&t[i])<<21,t[i++]<128)break t;if(r+=(127&t[i])*Math.pow(2,28),++i,t[i++]<128)break t;if(r+=(127&t[i])*Math.pow(2,35),++i,t[i++]<128)break t;if(r+=(127&t[i])*Math.pow(2,42),++i,t[i++]<128)break t}return e&&(e[0]=i),r}function varint_to_i32(t){var e=0,i=127&t[e];t:if(t[e++]>=128){if(i|=(127&t[e])<<7,t[e++]<128)break t;if(i|=(127&t[e])<<14,t[e++]<128)break t;if(i|=(127&t[e])<<21,t[e++]<128)break t;i|=(127&t[e])<<28}return i}function parse_shallow(t){for(var e=[],i=[0];i[0]<t.length;){var r,n=i[0],s=parse_varint49(t,i),o=7&s,a=0;if(0==(s=Math.floor(s/8)))break;switch(o){case 0:for(var l=i[0];t[i[0]++]>=128;);r=t.slice(l,i[0]);break;case 5:a=4,r=t.slice(i[0],i[0]+a),i[0]+=a;break;case 1:a=8,r=t.slice(i[0],i[0]+a),i[0]+=a;break;case 2:a=parse_varint49(t,i),r=t.slice(i[0],i[0]+a),i[0]+=a;break;default:throw new Error("PB Type ".concat(o," for Field ").concat(s," at offset ").concat(n))}var c={data:r,type:o};null==e[s]?e[s]=[c]:e[s].push(c)}return e}function mappa(t,e){return(null==t?void 0:t.map((function(t){return e(t.data)})))||[]}function parse_iwa_file(t){for(var e,i=[],r=[0];r[0]<t.length;){var n=parse_varint49(t,r),s=parse_shallow(t.slice(r[0],r[0]+n));r[0]+=n;var o={id:varint_to_i32(s[1][0].data),messages:[]};s[2].forEach((function(e){var i=parse_shallow(e.data),n=varint_to_i32(i[3][0].data);o.messages.push({meta:i,data:t.slice(r[0],r[0]+n)}),r[0]+=n})),(null==(e=s[3])?void 0:e[0])&&(o.merge=varint_to_i32(s[3][0].data)>>>0>0),i.push(o)}return i}function parse_snappy_chunk(t,e){if(0!=t)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var i=[0],r=parse_varint49(e,i),n=[];i[0]<e.length;){var s=3&e[i[0]];if(0!=s){var o=0,a=0;if(1==s?(a=4+(e[i[0]]>>2&7),o=(224&e[i[0]++])<<3,o|=e[i[0]++]):(a=1+(e[i[0]++]>>2),2==s?(o=e[i[0]]|e[i[0]+1]<<8,i[0]+=2):(o=(e[i[0]]|e[i[0]+1]<<8|e[i[0]+2]<<16|e[i[0]+3]<<24)>>>0,i[0]+=4)),n=[u8concat(n)],0==o)throw new Error("Invalid offset 0");if(o>n[0].length)throw new Error("Invalid offset beyond length");if(a>=o)for(n.push(n[0].slice(-o)),a-=o;a>=n[n.length-1].length;)n.push(n[n.length-1]),a-=n[n.length-1].length;n.push(n[0].slice(-o,-o+a))}else{var l=e[i[0]++]>>2;if(l<60)++l;else{var c=l-59;l=e[i[0]],c>1&&(l|=e[i[0]+1]<<8),c>2&&(l|=e[i[0]+2]<<16),c>3&&(l|=e[i[0]+3]<<24),l>>>=0,l++,i[0]+=c}n.push(e.slice(i[0],i[0]+l)),i[0]+=l}}var h=u8concat(n);if(h.length!=r)throw new Error("Unexpected length: ".concat(h.length," != ").concat(r));return h}function decompress_iwa_file(t){for(var e=[],i=0;i<t.length;){var r=t[i++],n=t[i]|t[i+1]<<8|t[i+2]<<16;i+=3,e.push(parse_snappy_chunk(r,t.slice(i,i+n))),i+=n}if(i!==t.length)throw new Error("data is not a valid framed stream!");return u8concat(e)}function parse_old_storage(t,e,i,r){var n,s=u8_to_dataview(t),o=s.getUint32(4,!0),a=(r>1?12:8)+4*popcnt(o&(r>1?3470:398)),l=-1,c=-1,h=NaN,u=new Date(2001,0,1);switch(512&o&&(l=s.getUint32(a,!0),a+=4),a+=4*popcnt(o&(r>1?12288:4096)),16&o&&(c=s.getUint32(a,!0),a+=4),32&o&&(h=s.getFloat64(a,!0),a+=8),64&o&&(u.setTime(u.getTime()+1e3*s.getFloat64(a,!0)),a+=8),t[2]){case 0:break;case 2:n={t:"n",v:h};break;case 3:n={t:"s",v:e[c]};break;case 5:n={t:"d",v:u};break;case 6:n={t:"b",v:h>0};break;case 7:n={t:"n",v:h/86400};break;case 8:n={t:"e",v:0};break;case 9:if(l>-1)n={t:"s",v:i[l]};else if(c>-1)n={t:"s",v:e[c]};else{if(isNaN(h))throw new Error("Unsupported cell type ".concat(t.slice(0,4)));n={t:"n",v:h}}break;default:throw new Error("Unsupported cell type ".concat(t.slice(0,4)))}return n}function parse_new_storage(t,e,i){var r,n=u8_to_dataview(t),s=n.getUint32(8,!0),o=12,a=-1,l=-1,c=NaN,h=NaN,u=new Date(2001,0,1);switch(1&s&&(c=readDecimal128LE(t,o),o+=16),2&s&&(h=n.getFloat64(o,!0),o+=8),4&s&&(u.setTime(u.getTime()+1e3*n.getFloat64(o,!0)),o+=8),8&s&&(l=n.getUint32(o,!0),o+=4),16&s&&(a=n.getUint32(o,!0),o+=4),t[1]){case 0:break;case 2:case 10:r={t:"n",v:c};break;case 3:r={t:"s",v:e[l]};break;case 5:r={t:"d",v:u};break;case 6:r={t:"b",v:h>0};break;case 7:r={t:"n",v:h/86400};break;case 8:r={t:"e",v:0};break;case 9:if(!(a>-1))throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(31&s," : ").concat(t.slice(0,4)));r={t:"s",v:i[a]};break;default:throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(31&s," : ").concat(t.slice(0,4)))}return r}function parse_cell_storage(t,e,i){switch(t[0]){case 0:case 1:case 2:case 3:return parse_old_storage(t,e,i,t[0]);case 5:return parse_new_storage(t,e,i);default:throw new Error("Unsupported payload version ".concat(t[0]))}}function parse_TSP_Reference(t){return parse_varint49(parse_shallow(t)[1][0].data)}function parse_TST_TableDataList(t,e){var i=parse_shallow(e.data),r=varint_to_i32(i[1][0].data),n=i[3],s=[];return(n||[]).forEach((function(e){var i=parse_shallow(e.data),n=varint_to_i32(i[1][0].data)>>>0;switch(r){case 1:s[n]=u8str(i[3][0].data);break;case 8:var o=parse_shallow(t[parse_TSP_Reference(i[9][0].data)][0].data),a=t[parse_TSP_Reference(o[1][0].data)][0],l=varint_to_i32(a.meta[1][0].data);if(2001!=l)throw new Error("2000 unexpected reference to ".concat(l));var c=parse_shallow(a.data);s[n]=c[3].map((function(t){return u8str(t.data)})).join("")}})),s}function parse_TST_TileRowInfo(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,_,m,g,y=parse_shallow(t),v=varint_to_i32(y[1][0].data)>>>0,b=varint_to_i32(y[2][0].data)>>>0,x=(null==(r=null==(i=y[8])?void 0:i[0])?void 0:r.data)&&varint_to_i32(y[8][0].data)>0||!1;if((null==(s=null==(n=y[7])?void 0:n[0])?void 0:s.data)&&0!=e)m=null==(a=null==(o=y[7])?void 0:o[0])?void 0:a.data,g=null==(c=null==(l=y[6])?void 0:l[0])?void 0:c.data;else{if(!(null==(u=null==(h=y[4])?void 0:h[0])?void 0:u.data)||1==e)throw"NUMBERS Tile missing ".concat(e," cell storage");m=null==(p=null==(d=y[4])?void 0:d[0])?void 0:p.data,g=null==(_=null==(f=y[3])?void 0:f[0])?void 0:_.data}for(var T=x?4:1,C=u8_to_dataview(m),S=[],w=0;w<m.length/2;++w){var A=C.getUint16(2*w,!0);A<65535&&S.push([w,A])}if(S.length!=b)throw"Expected ".concat(b," cells, found ").concat(S.length);var E=[];for(w=0;w<S.length-1;++w)E[S[w][0]]=g.subarray(S[w][1]*T,S[w+1][1]*T);return S.length>=1&&(E[S[S.length-1][0]]=g.subarray(S[S.length-1][1]*T)),{R:v,cells:E}}function parse_TST_Tile(t,e){var i,r=parse_shallow(e.data),n=(null==(i=null==r?void 0:r[7])?void 0:i[0])?varint_to_i32(r[7][0].data)>>>0>0?1:0:-1,s=mappa(r[5],(function(t){return parse_TST_TileRowInfo(t,n)}));return{nrows:varint_to_i32(r[4][0].data)>>>0,data:s.reduce((function(t,e){return t[e.R]||(t[e.R]=[]),e.cells.forEach((function(i,r){if(t[e.R][r])throw new Error("Duplicate cell r=".concat(e.R," c=").concat(r));t[e.R][r]=i})),t}),[])}}function parse_TST_TableModelArchive(t,e,i){var r,n=parse_shallow(e.data),s={s:{r:0,c:0},e:{r:0,c:0}};if(s.e.r=(varint_to_i32(n[6][0].data)>>>0)-1,s.e.r<0)throw new Error("Invalid row varint ".concat(n[6][0].data));if(s.e.c=(varint_to_i32(n[7][0].data)>>>0)-1,s.e.c<0)throw new Error("Invalid col varint ".concat(n[7][0].data));i["!ref"]=encode_range(s);var o=parse_shallow(n[4][0].data),a=parse_TST_TableDataList(t,t[parse_TSP_Reference(o[4][0].data)][0]),l=(null==(r=o[17])?void 0:r[0])?parse_TST_TableDataList(t,t[parse_TSP_Reference(o[17][0].data)][0]):[],c=parse_shallow(o[3][0].data),h=0;c[1].forEach((function(e){var r=parse_shallow(e.data),n=t[parse_TSP_Reference(r[2][0].data)][0],s=varint_to_i32(n.meta[1][0].data);if(6002!=s)throw new Error("6001 unexpected reference to ".concat(s));var o=parse_TST_Tile(t,n);o.data.forEach((function(t,e){t.forEach((function(t,r){var n=encode_cell({r:h+e,c:r}),s=parse_cell_storage(t,a,l);s&&(i[n]=s)}))})),h+=o.nrows}))}function parse_TST_TableInfoArchive(t,e){var i={"!ref":"A1"},r=t[parse_TSP_Reference(parse_shallow(e.data)[2][0].data)],n=varint_to_i32(r[0].meta[1][0].data);if(6001!=n)throw new Error("6000 unexpected reference to ".concat(n));return parse_TST_TableModelArchive(t,r[0],i),i}function parse_TN_SheetArchive(t,e){var i,r=parse_shallow(e.data),n={name:(null==(i=r[1])?void 0:i[0])?u8str(r[1][0].data):"",sheets:[]};return mappa(r[2],parse_TSP_Reference).forEach((function(e){t[e].forEach((function(e){6e3==varint_to_i32(e.meta[1][0].data)&&n.sheets.push(parse_TST_TableInfoArchive(t,e))}))})),n}function parse_TN_DocumentArchive(t,e){var i=book_new();if(mappa(parse_shallow(e.data)[1],parse_TSP_Reference).forEach((function(e){t[e].forEach((function(e){if(2==varint_to_i32(e.meta[1][0].data)){var r=parse_TN_SheetArchive(t,e);r.sheets.forEach((function(t,e){book_append_sheet(i,t,0==e?r.name:r.name+"_"+e,!0)}))}}))})),0==i.SheetNames.length)throw new Error("Empty NUMBERS file");return i}function parse_numbers_iwa(t){var i,r,n,s,o={},a=[];if(t.FullPaths.forEach((function(t){if(t.match(/\.iwpv2/))throw new Error("Unsupported password protection")})),t.FileIndex.forEach((function(t){if(t.name.match(/\.iwa$/)){var i,r;try{i=decompress_iwa_file(t.content)}catch(e){return console.log("?? "+t.content.length+" "+(e.message||e))}try{r=parse_iwa_file(i)}catch(e){return console.log("## "+(e.message||e))}r.forEach((function(t){o[t.id]=t.messages,a.push(t.id)}))}})),!a.length)throw new Error("File has no messages");var l=(null==(s=null==(n=null==(r=null==(i=null==o?void 0:o[1])?void 0:i[0])?void 0:r.meta)?void 0:n[1])?void 0:s[0].data)&&1==varint_to_i32(o[1][0].meta[1][0].data)&&o[1][0];if(l||a.forEach((function(t){o[t].forEach((function(t){if(1==varint_to_i32(t.meta[1][0].data)>>>0){if(l)throw new Error("Document has multiple roots");l=t}}))})),!l)throw new Error("Cannot find Document root");return parse_TN_DocumentArchive(o,l)}function fix_opts_func(t){return function(e){for(var i=0;i!=t.length;++i){var r=t[i];void 0===e[r[0]]&&(e[r[0]]=r[1]),"n"===r[2]&&(e[r[0]]=Number(e[r[0]]))}}}function fix_read_opts(t){fix_opts_func([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(t)}function get_sheet_type(t){return RELS.WS.indexOf(t)>-1?"sheet":t==RELS.CS?"chart":t==RELS.DS?"dialog":t==RELS.MS?"macro":t&&t.length?t:"sheet"}function safe_parse_wbrels(t,i){if(!t)return 0;try{t=i.map((function(e){return e.id||(e.id=e.strRelID),[e.name,t["!id"][e.id].Target,get_sheet_type(t["!id"][e.id].Type)]}))}catch(e){return null}return t&&0!==t.length?t:null}function safe_parse_sheet(t,i,r,n,s,o,a,l,c,h,u,d){try{o[n]=parse_rels(getzipstr(t,r,!0),i);var p,f=getzipdata(t,i);switch(l){case"sheet":p=parse_ws(f,i,s,c,o[n],h,u,d);break;case"chart":if(!(p=parse_cs(f,i,s,c,o[n],h,u,d))||!p["!drawel"])break;var _=resolve_path(p["!drawel"].Target,i),m=get_rels_path(_),g=resolve_path(parse_drawing(getzipstr(t,_,!0),parse_rels(getzipstr(t,m,!0),_)),_),y=get_rels_path(g);p=parse_chart(getzipstr(t,g,!0),g,c,parse_rels(getzipstr(t,y,!0),g),h,p);break;case"macro":p=parse_ms(f,i,s,c,o[n],h,u,d);break;case"dialog":p=parse_ds(f,i,s,c,o[n],h,u,d);break;default:throw new Error("Unrecognized sheet type "+l)}a[n]=p;var v=[];o&&o[n]&&keys(o[n]).forEach((function(e){var r="";if(o[n][e].Type==RELS.CMNT){r=resolve_path(o[n][e].Target,i);var s=parse_cmnt(getzipdata(t,r,!0),r,c);if(!s||!s.length)return;sheet_insert_comments(p,s,!1)}o[n][e].Type==RELS.TCMNT&&(r=resolve_path(o[n][e].Target,i),v=v.concat(parse_tcmnt_xml(getzipdata(t,r,!0),c)))})),v&&v.length&&sheet_insert_comments(p,v,!0,c.people||[])}catch(e){if(c.WTF)throw e}}function strip_front_slash(t){return"/"==t.charAt(0)?t.slice(1):t}function parse_zip(t,i){if(make_ssf(),fix_read_opts(i=i||{}),safegetzipfile(t,"META-INF/manifest.xml"))return parse_ods(t,i);if(safegetzipfile(t,"objectdata.xml"))return parse_ods(t,i);if(safegetzipfile(t,"Index/Document.iwa")){if("undefined"==typeof Uint8Array)throw new Error("NUMBERS file parsing requires Uint8Array support");if(void 0!==parse_numbers_iwa){if(t.FileIndex)return parse_numbers_iwa(t);var r=CFB.utils.cfb_new();return zipentries(t).forEach((function(e){zip_add_file(r,e,getzipbin(t,e))})),parse_numbers_iwa(r)}throw new Error("Unsupported NUMBERS file")}if(!safegetzipfile(t,"[Content_Types].xml")){if(safegetzipfile(t,"index.xml.gz"))throw new Error("Unsupported NUMBERS 08 file");if(safegetzipfile(t,"index.xml"))throw new Error("Unsupported NUMBERS 09 file");throw new Error("Unsupported ZIP file")}var n,s,o=zipentries(t),a=parse_ct(getzipstr(t,"[Content_Types].xml")),l=!1;if(0===a.workbooks.length&&getzipdata(t,s="xl/workbook.xml",!0)&&a.workbooks.push(s),0===a.workbooks.length){if(!getzipdata(t,s="xl/workbook.bin",!0))throw new Error("Could not find workbook");a.workbooks.push(s),l=!0}"bin"==a.workbooks[0].slice(-3)&&(l=!0);var c={},h={};if(!i.bookSheets&&!i.bookProps){if(strs=[],a.sst)try{strs=parse_sst(getzipdata(t,strip_front_slash(a.sst)),a.sst,i)}catch(e){if(i.WTF)throw e}i.cellStyles&&a.themes.length&&(c=parse_theme(getzipstr(t,a.themes[0].replace(/^\//,""),!0)||"",a.themes[0],i)),a.style&&(h=parse_sty(getzipdata(t,strip_front_slash(a.style)),a.style,c,i))}a.links.map((function(r){try{var n=parse_rels(getzipstr(t,get_rels_path(strip_front_slash(r))),r);return parse_xlink(getzipdata(t,strip_front_slash(r)),n,r,i)}catch(e){}}));var u=parse_wb(getzipdata(t,strip_front_slash(a.workbooks[0])),a.workbooks[0],i),d={},p="";a.coreprops.length&&((p=getzipdata(t,strip_front_slash(a.coreprops[0]),!0))&&(d=parse_core_props(p)),0!==a.extprops.length&&(p=getzipdata(t,strip_front_slash(a.extprops[0]),!0))&&parse_ext_props(p,d,i));var f={};i.bookSheets&&!i.bookProps||0!==a.custprops.length&&(p=getzipstr(t,strip_front_slash(a.custprops[0]),!0))&&(f=parse_cust_props(p,i));var _={};if((i.bookSheets||i.bookProps)&&(u.Sheets?n=u.Sheets.map((function(t){return t.name})):d.Worksheets&&d.SheetNames.length>0&&(n=d.SheetNames),i.bookProps&&(_.Props=d,_.Custprops=f),i.bookSheets&&void 0!==n&&(_.SheetNames=n),i.bookSheets?_.SheetNames:i.bookProps))return _;n={};var m={};i.bookDeps&&a.calcchain&&(m=parse_cc(getzipdata(t,strip_front_slash(a.calcchain)),a.calcchain));var g,y,v=0,b={},x=u.Sheets;d.Worksheets=x.length,d.SheetNames=[];for(var T=0;T!=x.length;++T)d.SheetNames[T]=x[T].name;var C=l?"bin":"xml",S=a.workbooks[0].lastIndexOf("/"),w=(a.workbooks[0].slice(0,S+1)+"_rels/"+a.workbooks[0].slice(S+1)+".rels").replace(/^\//,"");safegetzipfile(t,w)||(w="xl/_rels/workbook."+C+".rels");var A=parse_rels(getzipstr(t,w,!0),w.replace(/_rels.*/,"s5s"));(a.metadata||[]).length>=1&&(i.xlmeta=parse_xlmeta(getzipdata(t,strip_front_slash(a.metadata[0])),a.metadata[0],i)),(a.people||[]).length>=1&&(i.people=parse_people_xml(getzipdata(t,strip_front_slash(a.people[0])),i)),A&&(A=safe_parse_wbrels(A,u.Sheets));var E=getzipdata(t,"xl/worksheets/sheet.xml",!0)?1:0;t:for(v=0;v!=d.Worksheets;++v){var D="sheet";if(A&&A[v]?(g="xl/"+A[v][1].replace(/[\/]?xl\//,""),safegetzipfile(t,g)||(g=A[v][1]),safegetzipfile(t,g)||(g=w.replace(/_rels\/.*$/,"")+A[v][1]),D=A[v][2]):g=(g="xl/worksheets/sheet"+(v+1-E)+"."+C).replace(/sheet0\./,"sheet."),y=g.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),i&&null!=i.sheets)switch(typeof i.sheets){case"number":if(v!=i.sheets)continue t;break;case"string":if(d.SheetNames[v].toLowerCase()!=i.sheets.toLowerCase())continue t;break;default:if(Array.isArray&&Array.isArray(i.sheets)){for(var L=!1,I=0;I!=i.sheets.length;++I)"number"==typeof i.sheets[I]&&i.sheets[I]==v&&(L=1),"string"==typeof i.sheets[I]&&i.sheets[I].toLowerCase()==d.SheetNames[v].toLowerCase()&&(L=1);if(!L)continue t}}safe_parse_sheet(t,g,y,d.SheetNames[v],v,b,n,D,i,u,c,h)}return _={Directory:a,Workbook:u,Props:d,Custprops:f,Deps:m,Sheets:n,SheetNames:d.SheetNames,Strings:strs,Styles:h,Themes:c,SSF:dup(table_fmt)},i&&i.bookFiles&&(t.files?(_.keys=o,_.files=t.files):(_.keys=[],_.files={},t.FullPaths.forEach((function(e,i){e=e.replace(/^Root Entry[\/]/,""),_.keys.push(e),_.files[e]=t.FileIndex[i]})))),i&&i.bookVBA&&(a.vba.length>0?_.vbaraw=getzipdata(t,strip_front_slash(a.vba[0]),!0):a.defaults&&a.defaults.bin===CT_VBA&&(_.vbaraw=getzipdata(t,"xl/vbaProject.bin",!0))),_}function parse_xlsxcfb(t,i){var r=i||{},n="Workbook",s=CFB.find(t,n);try{if(n="/!DataSpaces/Version",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(parse_DataSpaceVersionInfo(s.content),n="/!DataSpaces/DataSpaceMap",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var o=parse_DataSpaceMap(s.content);if(1!==o.length||1!==o[0].comps.length||0!==o[0].comps[0].t||"StrongEncryptionDataSpace"!==o[0].name||"EncryptedPackage"!==o[0].comps[0].v)throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var a=parse_DataSpaceDefinition(s.content);if(1!=a.length||"StrongEncryptionTransform"!=a[0])throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);parse_Primary(s.content)}catch(e){}if(n="/EncryptionInfo",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var l=parse_EncryptionInfo(s.content);if(n="/EncryptedPackage",!(s=CFB.find(t,n))||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(4==l[0]&&"undefined"!=typeof decrypt_agile)return decrypt_agile(l[1],s.content,r.password||"",r);if(2==l[0]&&"undefined"!=typeof decrypt_std76)return decrypt_std76(l[1],s.content,r.password||"",r);throw new Error("File is password-protected")}function firstbyte(t,e){var i="";switch((e||{}).type||"base64"){case"buffer":case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":i=Base64_decode(t.slice(0,12));break;case"binary":i=t;break;default:throw new Error("Unrecognized type "+(e&&e.type||"undefined"))}return[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3),i.charCodeAt(4),i.charCodeAt(5),i.charCodeAt(6),i.charCodeAt(7)]}function read_cfb(t,e){return CFB.find(t,"EncryptedPackage")?parse_xlsxcfb(t,e):parse_xlscfb(t,e)}function read_zip(t,e){var i=t,r=e||{};return r.type||(r.type=has_buf&&Buffer.isBuffer(t)?"buffer":"base64"),parse_zip(zip_read(i,r),r)}function read_plaintext(t,e){var i=0;t:for(;i<t.length;)switch(t.charCodeAt(i)){case 10:case 13:case 32:++i;break;case 60:return parse_xlml(t.slice(i),e);default:break t}return PRN.to_workbook(t,e)}function read_plaintext_raw(t,e){var i="",r=firstbyte(t,e);switch(e.type){case"base64":i=Base64_decode(t);break;case"binary":i=t;break;case"buffer":i=t.toString("binary");break;case"array":i=cc2str(t);break;default:throw new Error("Unrecognized type "+e.type)}return 239==r[0]&&187==r[1]&&191==r[2]&&(i=utf8read(i)),e.type="binary",read_plaintext(i,e)}function read_utf16(t,e){var i=t;return"base64"==e.type&&(i=Base64_decode(i)),i=$cptable.utils.decode(1200,i.slice(2),"str"),e.type="binary",read_plaintext(i,e)}function bstrify(t){return t.match(/[^\x00-\x7F]/)?utf8write(t):t}function read_prn(t,e,i,r){return r?(i.type="string",PRN.to_workbook(t,i)):PRN.to_workbook(e,i)}function readSync(t,e){reset_cp();var i=e||{};if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer)return readSync(new Uint8Array(t),((i=dup(i)).type="array",i));"undefined"!=typeof Uint8Array&&t instanceof Uint8Array&&!i.type&&(i.type="undefined"!=typeof Deno?"buffer":"array");var r,n=t,s=!1;if(i.cellStyles&&(i.cellNF=!0,i.sheetStubs=!0),_ssfopts={},i.dateNF&&(_ssfopts.dateNF=i.dateNF),i.type||(i.type=has_buf&&Buffer.isBuffer(t)?"buffer":"base64"),"file"==i.type&&(i.type=has_buf?"buffer":"binary",n=read_binary(t),"undefined"==typeof Uint8Array||has_buf||(i.type="array")),"string"==i.type&&(s=!0,i.type="binary",i.codepage=65001,n=bstrify(t)),"array"==i.type&&"undefined"!=typeof Uint8Array&&t instanceof Uint8Array&&"undefined"!=typeof ArrayBuffer){var o=new ArrayBuffer(3),a=new Uint8Array(o);if(a.foo="bar",!a.foo)return(i=dup(i)).type="array",readSync(ab2a(n),i)}switch((r=firstbyte(n,i))[0]){case 208:if(207===r[1]&&17===r[2]&&224===r[3]&&161===r[4]&&177===r[5]&&26===r[6]&&225===r[7])return read_cfb(CFB.read(n,i),i);break;case 9:if(r[1]<=8)return parse_xlscfb(n,i);break;case 60:return parse_xlml(n,i);case 73:if(73===r[1]&&42===r[2]&&0===r[3])throw new Error("TIFF Image File is not a spreadsheet");if(68===r[1])return read_wb_ID(n,i);break;case 84:if(65===r[1]&&66===r[2]&&76===r[3])return DIF.to_workbook(n,i);break;case 80:return 75===r[1]&&r[2]<9&&r[3]<9?read_zip(n,i):read_prn(t,n,i,s);case 239:return 60===r[3]?parse_xlml(n,i):read_prn(t,n,i,s);case 255:if(254===r[1])return read_utf16(n,i);if(0===r[1]&&2===r[2]&&0===r[3])return WK_.to_workbook(n,i);break;case 0:if(0===r[1]){if(r[2]>=2&&0===r[3])return WK_.to_workbook(n,i);if(0===r[2]&&(8===r[3]||9===r[3]))return WK_.to_workbook(n,i)}break;case 3:case 131:case 139:case 140:return DBF.to_workbook(n,i);case 123:if(92===r[1]&&114===r[2]&&116===r[3])return RTF.to_workbook(n,i);break;case 10:case 13:case 32:return read_plaintext_raw(n,i);case 137:if(80===r[1]&&78===r[2]&&71===r[3])throw new Error("PNG Image File is not a spreadsheet")}return DBF_SUPPORTED_VERSIONS.indexOf(r[0])>-1&&r[2]<=12&&r[3]<=31?DBF.to_workbook(n,i):read_prn(t,n,i,s)}function make_json_row(t,i,r,n,s,o,a,l){var c=encode_row(r),h=l.defval,u=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),d=!0,p=1===s?[]:{};if(1!==s)if(Object.defineProperty)try{Object.defineProperty(p,"__rowNum__",{value:r,enumerable:!1})}catch(e){p.__rowNum__=r}else p.__rowNum__=r;if(!a||t[r])for(var f=i.s.c;f<=i.e.c;++f){var _=a?t[r][f]:t[n[f]+c];if(void 0!==_&&void 0!==_.t){var m=_.v;switch(_.t){case"z":if(null==m)break;continue;case"e":m=0==m?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+_.t)}if(null!=o[f]){if(null==m)if("e"==_.t&&null===m)p[o[f]]=null;else if(void 0!==h)p[o[f]]=h;else{if(!u||null!==m)continue;p[o[f]]=null}else p[o[f]]=u&&("n"!==_.t||"n"===_.t&&!1!==l.rawNumbers)?m:format_cell(_,m,l);null!=m&&(d=!1)}}else{if(void 0===h)continue;null!=o[f]&&(p[o[f]]=h)}}return{row:p,isempty:d}}function sheet_to_json(t,e){if(null==t||null==t["!ref"])return[];var i={t:"n",v:0},r=0,n=1,s=[],o=0,a="",l={s:{r:0,c:0},e:{r:0,c:0}},c=e||{},h=null!=c.range?c.range:t["!ref"];switch(1===c.header?r=1:"A"===c.header?r=2:Array.isArray(c.header)?r=3:null==c.header&&(r=0),typeof h){case"string":l=safe_decode_range(h);break;case"number":(l=safe_decode_range(t["!ref"])).s.r=h;break;default:l=h}r>0&&(n=0);var u=encode_row(l.s.r),d=[],p=[],f=0,_=0,m=Array.isArray(t),g=l.s.r,y=0,v={};m&&!t[g]&&(t[g]=[]);var b=c.skipHidden&&t["!cols"]||[],x=c.skipHidden&&t["!rows"]||[];for(y=l.s.c;y<=l.e.c;++y)if(!(b[y]||{}).hidden)switch(d[y]=encode_col(y),i=m?t[g][y]:t[d[y]+u],r){case 1:s[y]=y-l.s.c;break;case 2:s[y]=d[y];break;case 3:s[y]=c.header[y-l.s.c];break;default:if(null==i&&(i={w:"__EMPTY",t:"s"}),a=o=format_cell(i,null,c),_=v[o]||0){do{a=o+"_"+_++}while(v[a]);v[o]=_,v[a]=1}else v[o]=1;s[y]=a}for(g=l.s.r+n;g<=l.e.r;++g)if(!(x[g]||{}).hidden){var T=make_json_row(t,l,g,d,r,s,m,c);(!1===T.isempty||(1===r?!1!==c.blankrows:c.blankrows))&&(p[f++]=T.row)}return p.length=f,p}var qreg=/"/g;function make_csv_row(t,e,i,r,n,s,o,a){for(var l=!0,c=[],h="",u=encode_row(i),d=e.s.c;d<=e.e.c;++d)if(r[d]){var p=a.dense?(t[i]||[])[d]:t[r[d]+u];if(null==p)h="";else if(null!=p.v){l=!1,h=""+(a.rawNumbers&&"n"==p.t?p.v:format_cell(p,null,a));for(var f=0,_=0;f!==h.length;++f)if((_=h.charCodeAt(f))===n||_===s||34===_||a.forceQuotes){h='"'+h.replace(qreg,'""')+'"';break}"ID"==h&&(h='"ID"')}else null==p.f||p.F?h="":(l=!1,(h="="+p.f).indexOf(",")>=0&&(h='"'+h.replace(qreg,'""')+'"'));c.push(h)}return!1===a.blankrows&&l?null:c.join(o)}function sheet_to_csv(t,e){var i=[],r=null==e?{}:e;if(null==t||null==t["!ref"])return"";var n=safe_decode_range(t["!ref"]),s=void 0!==r.FS?r.FS:",",o=s.charCodeAt(0),a=void 0!==r.RS?r.RS:"\n",l=a.charCodeAt(0),c=new RegExp(("|"==s?"\\|":s)+"+$"),h="",u=[];r.dense=Array.isArray(t);for(var d=r.skipHidden&&t["!cols"]||[],p=r.skipHidden&&t["!rows"]||[],f=n.s.c;f<=n.e.c;++f)(d[f]||{}).hidden||(u[f]=encode_col(f));for(var _=0,m=n.s.r;m<=n.e.r;++m)(p[m]||{}).hidden||null!=(h=make_csv_row(t,n,m,u,o,l,s,r))&&(r.strip&&(h=h.replace(c,"")),(h||!1!==r.blankrows)&&i.push((_++?a:"")+h));return delete r.dense,i.join("")}function sheet_to_txt(t,e){return e||(e={}),e.FS="\t",e.RS="\n",sheet_to_csv(t,e)}function sheet_to_formulae(t){var e,i="",r="";if(null==t||null==t["!ref"])return[];var n,s=safe_decode_range(t["!ref"]),o="",a=[],l=[],c=Array.isArray(t);for(n=s.s.c;n<=s.e.c;++n)a[n]=encode_col(n);for(var h=s.s.r;h<=s.e.r;++h)for(o=encode_row(h),n=s.s.c;n<=s.e.c;++n)if(i=a[n]+o,r="",void 0!==(e=c?(t[h]||[])[n]:t[i])){if(null!=e.F){if(i=e.F,!e.f)continue;r=e.f,-1==i.indexOf(":")&&(i=i+":"+i)}if(null!=e.f)r=e.f;else{if("z"==e.t)continue;if("n"==e.t&&null!=e.v)r=""+e.v;else if("b"==e.t)r=e.v?"TRUE":"FALSE";else if(void 0!==e.w)r="'"+e.w;else{if(void 0===e.v)continue;r="s"==e.t?"'"+e.v:""+e.v}}l[l.length]=i+"="+r}return l}function sheet_add_json(t,e,i){var r,n=i||{},s=+!n.skipHeader,o=t||{},a=0,l=0;if(o&&null!=n.origin)if("number"==typeof n.origin)a=n.origin;else{var c="string"==typeof n.origin?decode_cell(n.origin):n.origin;a=c.r,l=c.c}var h={s:{c:0,r:0},e:{c:l,r:a+e.length-1+s}};if(o["!ref"]){var u=safe_decode_range(o["!ref"]);h.e.c=Math.max(h.e.c,u.e.c),h.e.r=Math.max(h.e.r,u.e.r),-1==a&&(a=u.e.r+1,h.e.r=a+e.length-1+s)}else-1==a&&(a=0,h.e.r=e.length-1+s);var d=n.header||[],p=0;e.forEach((function(t,e){keys(t).forEach((function(i){-1==(p=d.indexOf(i))&&(d[p=d.length]=i);var c=t[i],h="z",u="",f=encode_cell({c:l+p,r:a+e+s});r=ws_get_cell_stub(o,f),!c||"object"!=typeof c||c instanceof Date?("number"==typeof c?h="n":"boolean"==typeof c?h="b":"string"==typeof c?h="s":c instanceof Date?(h="d",n.cellDates||(h="n",c=datenum(c)),u=n.dateNF||table_fmt[14]):null===c&&n.nullError&&(h="e",c=0),r?(r.t=h,r.v=c,delete r.w,delete r.R,u&&(r.z=u)):o[f]=r={t:h,v:c},u&&(r.z=u)):o[f]=c}))})),h.e.c=Math.max(h.e.c,l+d.length-1);var f=encode_row(a);if(s)for(p=0;p<d.length;++p)o[encode_col(p+l)+f]={t:"s",v:d[p]};return o["!ref"]=encode_range(h),o}function json_to_sheet(t,e){return sheet_add_json(null,t,e)}function ws_get_cell_stub(t,e,i){if("string"==typeof e){if(Array.isArray(t)){var r=decode_cell(e);return t[r.r]||(t[r.r]=[]),t[r.r][r.c]||(t[r.r][r.c]={t:"z"})}return t[e]||(t[e]={t:"z"})}return ws_get_cell_stub(t,encode_cell("number"!=typeof e?e:{r:e,c:i||0}))}function wb_sheet_idx(t,e){if("number"==typeof e){if(e>=0&&t.SheetNames.length>e)return e;throw new Error("Cannot find sheet # "+e)}if("string"==typeof e){var i=t.SheetNames.indexOf(e);if(i>-1)return i;throw new Error("Cannot find sheet name |"+e+"|")}throw new Error("Cannot find sheet |"+e+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(t,e,i,r){var n=1;if(!i)for(;n<=65535&&-1!=t.SheetNames.indexOf(i="Sheet"+n);++n,i=void 0);if(!i||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(r&&t.SheetNames.indexOf(i)>=0){var s=i.match(/(^.*?)(\d+)$/);n=s&&+s[2]||0;var o=s&&s[1]||i;for(++n;n<=65535&&-1!=t.SheetNames.indexOf(i=o+n);++n);}if(check_ws_name(i),t.SheetNames.indexOf(i)>=0)throw new Error("Worksheet with name |"+i+"| already exists!");return t.SheetNames.push(i),t.Sheets[i]=e,i}function book_set_sheet_visibility(t,e,i){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var r=wb_sheet_idx(t,e);switch(t.Workbook.Sheets[r]||(t.Workbook.Sheets[r]={}),i){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+i)}t.Workbook.Sheets[r].Hidden=i}function cell_set_number_format(t,e){return t.z=e,t}function cell_set_hyperlink(t,e,i){return e?(t.l={Target:e},i&&(t.l.Tooltip=i)):delete t.l,t}function cell_set_internal_link(t,e,i){return cell_set_hyperlink(t,"#"+e,i)}function cell_add_comment(t,e,i){t.c||(t.c=[]),t.c.push({t:e,a:i||"SheetJS"})}function sheet_set_array_formula(t,e,i,r){for(var n="string"!=typeof e?e:safe_decode_range(e),s="string"==typeof e?e:encode_range(e),o=n.s.r;o<=n.e.r;++o)for(var a=n.s.c;a<=n.e.c;++a){var l=ws_get_cell_stub(t,o,a);l.t="n",l.F=s,delete l.v,o==n.s.r&&a==n.s.c&&(l.f=i,r&&(l.D=!0))}return t}var utils$1={encode_col:encode_col,encode_row:encode_row,encode_cell:encode_cell,encode_range:encode_range,decode_col:decode_col,decode_row:decode_row,split_cell:split_cell,decode_cell:decode_cell,decode_range:decode_range,format_cell:format_cell,sheet_add_aoa:sheet_add_aoa,sheet_add_json:sheet_add_json,sheet_add_dom:sheet_add_dom,aoa_to_sheet:aoa_to_sheet,json_to_sheet:json_to_sheet,table_to_sheet:parse_dom_table,table_to_book:table_to_book,sheet_to_csv:sheet_to_csv,sheet_to_txt:sheet_to_txt,sheet_to_json:sheet_to_json,sheet_to_html:sheet_to_html,sheet_to_formulae:sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new:book_new,book_append_sheet:book_append_sheet,book_set_sheet_visibility:book_set_sheet_visibility,cell_set_number_format:cell_set_number_format,cell_set_hyperlink:cell_set_hyperlink,cell_set_internal_link:cell_set_internal_link,cell_add_comment:cell_add_comment,sheet_set_array_formula:sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const zhString={"Add Node":"添加节点","Add Group":"添加分组","Edit Group":"编辑分组",Clone:"复制",Inputs:"输入",Outputs:"输出",Properties:"参数","Properties Panel":"参数面板",Title:"标题",Mode:"运行模式",Always:"每帧运行","On Event":"事件触发",Never:"从不运行","On Trigger":"通用触发",Resize:"自适应尺寸",Collapse:"折叠",Pin:"固定",Color:"颜色",Colors:"颜色",Shapes:"形状",Remove:"移除",default:"默认",box:"矩形",round:"圆角",card:"卡片","Font size":"标题大小","Rename Slot":"重命名节点","Remove Slot":"移除节点","Disconnect Links":"断开链接","Add Reroute":"添加控制点",Delete:"删除",Expand:"展开",graph:"蓝图",Open:"打开","Close subgraph":"关闭分支蓝图","Align Selected To":"对齐选中节点",Align:"对齐",Top:"顶部",Bottom:"底部",Left:"左边",Right:"右边","Distribute Nodes":"平均分配节点",Vertically:"垂直",Horizontally:"水平",tips:"提示",input:"输入",middle:"中间",output:"输出",objects:"物件",data:"数据",value:"常数",valueString:"文字",button:"按下按键",screen:"触摸屏",phoneSensor:"动作感应",event:"游戏内的变化",controll:"摇杆",controllHorizontal:"摇杆前后",customButton:"自定义按键",touchStart:"触摸开始",touchMove:"触摸移动",touchEnd:"触摸结束",leftOrRightAct:"重力感应",forwardOrbackAct:"前后倾斜",shakeAct:"摇晃",rotationAct:"转动",gameStart:"开始时",objectDestroy:"物体损坏时",calculate:"计算",covert:"转换",angleCalculate:"角度计算",compare:"比较",inRange:"范围内",logic:"逻辑",change:"变化",tool:"工具",mapping:"映射",toint:"取整数",squareRoot:"平方根",abs:"绝对值",revertNegative:"正负反转",dataObject:"数据结构",getKeyValue:"数据取值",angleDifference:"角度差",vectorToAngel:"将位置转换为角度",angleConvertVector:"将角度转换为位置",allRight:"且",orRight:"或",notRight:"非",checkTag:"标记状态",upCount:"计数",timeDown:"倒计时",randomNum:"随机数",sendData:"无线传送发射",acceptData:"无线传送接收",writeNote:"个人备忘录",exportObject:"引用物体",media:"播放媒体",time:"时间控制",game:"游戏控制",other:"其它",bgm:"背景音",sound:"声音",vibrate:"震动",stopTime:"停止时间",timeScale:"时间缩放",restartGame:"重新开始",endGame:"游戏结束",changeGame:"切换游戏",showTextTip:"文字提示",consoleInfo:"输出控制台",showConfirm:"确认框",showHandTip:"触摸提示",blockTouch:"屏蔽触摸",sprite:"绘制图片",animate:"骨骼动画",animates:"动画",tween:"数值动画",bezierCurve:"路径动画",powerOfGod:"神秘力量",objectSensor:"传感器",space:"空间",camera:"照相机",createObject:"物体",destroyObject:"销毁物体",sendObject:"传送物体",gravity:"引力",contact:"接触感应器",destroy:"销毁感应器",position:"位置感应器",speed:"其它感应器",acceleration:"加速度感应器",angle:"角度感应器",angleSpeed:"角速度感应器",connection:"连接零件",layoutEx:"自动布局",girdMap:"格子地图",scrollRect:"滚动视图",group:"物体成组",getData:"获取数据",setData:"记录数据",controllData:"修改数据",handData:"操作数据",bagControll:"背包",friend:"朋友",systemData:"系统数据",screenSize:"屏幕适配",customData:"自定义数据",userData:"玩家数据",addBagGood:"添加物品",useBagGood:"使用物品",getFriend:"获取好友",add:"加",del:"减",x:"乘",chu:"除",length:"长度",equire:"等于",litter:"小于",bigger:"大于",menu:"菜单",startBtn:"运行",previewBtn:"预览",importBtn:"导入",exportBtn:"导出到缓存",downloadBtn:"下载到本地",freshBtn:"刷新",closeViewBtn:"关闭",bigIcon:"大icon显示",hideLine:"隐藏绿线",debugMode:"预览Debug模式 OFF",recordMode:"recordMode",clearBtn:"删除缓存",showFps:"showFps",setting:"设置",customComponent:"脚本组件",inputArr:"输入扩展",outputArr:"输出扩展",outputLine:"输出逻辑线",linkArr:"关联扩展",lighting:"动态赋值",lightingOut:"动态取值",textCode:"js文本"};class InputIndicators{constructor(t){this.canvas=t,this.radius=8,this.startAngle=0,this.endAngle=2*Math.PI,this.inactiveColour="#ffffff10",this.colour1="#ff5f00",this.colour2="#00ff7c",this.colour3="#dea7ff",this.fontString="bold 12px Arial",this.enabled=!0,this.shiftDown=!1,this.undoDown=!1,this.redoDown=!1,this.ctrlDown=!1,this.altDown=!1,this.mouse0Down=!1,this.mouse1Down=!1,this.mouse2Down=!1,this.x=0,this.y=0,this.#t=this.onPointerDownOrMove.bind(this),this.#e=this.onPointerUp.bind(this),this.#i=this.onKeyDownOrUp.bind(this),this.controller=new AbortController;const{signal:e}=this.controller,i=t.canvas,r={capture:!0,signal:e};i.addEventListener("pointerdown",this.#t,r),i.addEventListener("pointermove",this.#t,r),i.addEventListener("pointerup",this.#e,r),i.addEventListener("keydown",this.#i,r),document.addEventListener("keyup",this.#i,r);const n=t.drawFrontCanvas.bind(t);e.addEventListener("abort",(()=>{t.drawFrontCanvas=n})),t.drawFrontCanvas=()=>{n(),this.draw()}}#t;onPointerDownOrMove(t){this.mouse0Down=!(1&~t.buttons),this.mouse1Down=!(4&~t.buttons),this.mouse2Down=!(2&~t.buttons),this.x=t.clientX,this.y=t.clientY,this.canvas.setDirty(!0)}#e;onPointerUp(){this.mouse0Down=!1,this.mouse1Down=!1,this.mouse2Down=!1}#i;onKeyDownOrUp(t){this.ctrlDown=t.ctrlKey,this.altDown=t.altKey,this.shiftDown=t.shiftKey,this.undoDown=t.ctrlKey&&"KeyZ"===t.code&&"keydown"===t.type,this.redoDown=t.ctrlKey&&"KeyY"===t.code&&"keydown"===t.type}draw(){const{canvas:{ctx:t},radius:e,startAngle:i,endAngle:r,x:n,y:s,inactiveColour:o,colour1:a,colour2:l,colour3:c,fontString:h}=this,{fillStyle:u,font:d}=t,p=n,f=s-80,_=p,m=f-15;t.font=h,b(_+0,m,"Shift",this.shiftDown?a:o),b(_+45,m+20,"Alt",this.altDown?l:o),b(_+30,m,"Control",this.ctrlDown?c:o),b(_-30,m,"↩️",this.undoDown?"#000":"transparent"),b(_+45,m,"↪️",this.redoDown?"#000":"transparent"),t.beginPath(),T(p,f),T(p+15,f),T(p+30,f),t.fillStyle=o,t.fill();const g=this.mouse0Down?a:o,y=this.mouse1Down?l:o,v=this.mouse2Down?c:o;function b(e,i,r,n){t.fillStyle=n,t.fillText(r,e,i)}function x(e,i,r){t.beginPath(),t.fillStyle=r,T(e,i),t.fill()}function T(n,s){t.arc(n,s,e,i,r)}this.mouse0Down&&x(p,f,g),this.mouse1Down&&x(p+15,f,y),this.mouse2Down&&x(p+30,f,v),t.fillStyle=u,t.font=d}dispose(){this.controller?.abort(),this.controller=void 0}[Symbol.dispose](){this.dispose()}}class ContextMenu{constructor(t,e){this.controller=new AbortController,e||={},this.options=e;const i=e.parentMenu;i&&(i instanceof ContextMenu?(this.parentMenu=i,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this):(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=void 0),"dark"===i.options?.className&&(e.className="dark"));const r=e.event?e.event.constructor.name:null;"MouseEvent"!==r&&"CustomEvent"!==r&&"PointerEvent"!==r&&(console.error(`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${r})`),e.event=void 0);const n=document.createElement("div");let s="litegraph litecontextmenu litemenubar-panel";e.className&&(s+=` ${e.className}`),n.className=s,n.style.minWidth="100",n.style.minHeight="100",n.style.pointerEvents="none",setTimeout((function(){n.style.pointerEvents="auto"}),100);const{signal:o}=this.controller,a={capture:!0,signal:o};if(this.parentMenu||document.addEventListener("pointerdown",(t=>{t.target instanceof Node&&!this.containsNode(t.target)&&this.close()}),a),n.addEventListener("pointerup",(t=>t.preventDefault()),!0),n.addEventListener("contextmenu",(t=>{2===t.button&&t.preventDefault()}),!0),n.addEventListener("pointerdown",(t=>{2==t.button&&(this.close(),t.preventDefault())}),!0),this.root=n,e.title){const t=document.createElement("div");t.className="litemenu-title",t.innerHTML=e.title,n.append(t)}for(let d=0;d<t.length;d++){const i=t[d];let r=Array.isArray(t)?i:String(d);"string"!=typeof r&&(r=null!=r?void 0===r.content?String(r):r.content:r),this.addItem(r,i,e)}n.addEventListener("pointerenter",(function(){n.closing_timer&&clearTimeout(n.closing_timer)}));const l=e.event?.target?.ownerDocument,c=l||document;c.fullscreenElement?c.fullscreenElement.append(n):c.body.append(n);let h=e.left||0,u=e.top||0;if(e.event){if(h=e.event.clientX-10,u=e.event.clientY-10,e.title&&(u-=20),i){const t=i.root.getBoundingClientRect();h=t.left+t.width}const t=document.body.getBoundingClientRect(),r=n.getBoundingClientRect();0==t.height&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),t.width&&h>t.width-r.width-10&&(h=t.width-r.width-10),t.height&&u>t.height-r.height-10&&(u=t.height-r.height-10)}n.style.left=`${h}px`,n.style.top=`${u}px`,LiteGraph.context_menu_scaling&&e.scale&&(n.style.transform=`scale(${.25*Math.round(4*e.scale)})`)}containsNode(t,e=new Set){return!e.has(this)&&(e.add(this),this.current_submenu?.containsNode(t,e)||this.root.contains(t))}addItem(t,e,i){i||={};const r=document.createElement("div");r.className="litemenu-entry submenu";let n=!1;if(null===e)r.classList.add("separator");else{const i=null===t?"":String(t);"string"==typeof e?r.innerHTML=i:(r.innerHTML=e?.title??i,e.disabled&&(n=!0,r.classList.add("disabled"),r.setAttribute("aria-disabled","true")),(e.submenu||e.has_submenu)&&(r.classList.add("has_submenu"),r.setAttribute("aria-haspopup","true"),r.setAttribute("aria-expanded","false")),e.className&&(r.className+=` ${e.className}`)),null!=zhString[r.innerHTML]&&(r.innerHTML=zhString[r.innerHTML]),r.value=e,r.setAttribute("role","menuitem"),"function"==typeof e?(r.dataset.value=String(t),r.onclick_callback=e):r.dataset.value=String(e)}this.root.append(r),n||r.addEventListener("click",a),!n&&i.autoopen&&r.addEventListener("pointerenter",(function(t){const e=this.value;if(!e||!e.has_submenu)return;a.call(this,t),s()}));const s=()=>{const t=this.root.querySelectorAll("div.litemenu-entry.has_submenu");if(t)for(const e of t)e.setAttribute("aria-expanded","false");r.setAttribute("aria-expanded","true")};const o=this;function a(t){const e=this.value;let r=!0;if(o.current_submenu?.close(t),(e?.has_submenu||e?.submenu)&&s(),i.callback){!0===i.callback.call(this,e,i,t,o,i.node)&&(r=!1)}if("object"==typeof e){if(e.callback&&!i.ignore_item_callbacks&&!0!==e.disabled){!0===e.callback.call(this,e,i,t,o,i.extra)&&(r=!1)}if(e.submenu){if(!e.submenu.options)throw"ContextMenu submenu needs options";new o.constructor(e.submenu.options,{callback:e.submenu.callback,event:t,parentMenu:o,ignore_item_callbacks:e.submenu.ignore_item_callbacks,title:e.submenu.title,extra:e.submenu.extra,autoopen:i.autoopen}),r=!1}}r&&!o.lock&&o.close()}return r}close(t,e){this.controller.abort(),this.root.remove(),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=void 0,void 0===t?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,`${LiteGraph.pointerevents_method}leave`,t)),this.current_submenu?.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)}static trigger(t,e,i){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!0,!0,i),t.dispatchEvent&&t.dispatchEvent(r),r}getTopMenu(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this}getFirstEvent(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event}static isCursorOverElement(t,e){const i=t.clientX,r=t.clientY,n=e.getBoundingClientRect();return!!n&&(r>n.top&&r<n.top+n.height&&i>n.left&&i<n.left+n.width)}}var NodeSlotType=(t=>(t[t.INPUT=1]="INPUT",t[t.OUTPUT=2]="OUTPUT",t))(NodeSlotType||{}),RenderShape=(t=>(t[t.BOX=1]="BOX",t[t.ROUND=2]="ROUND",t[t.CIRCLE=3]="CIRCLE",t[t.CARD=4]="CARD",t[t.ARROW=5]="ARROW",t[t.GRID=6]="GRID",t[t.HollowCircle=7]="HollowCircle",t))(RenderShape||{}),CanvasItem=(t=>(t[t.Nothing=0]="Nothing",t[t.Node=1]="Node",t[t.Group=2]="Group",t[t.Reroute=4]="Reroute",t[t.Link=8]="Link",t[t.ResizeSe=16]="ResizeSe",t))(CanvasItem||{}),LinkDirection=(t=>(t[t.NONE=0]="NONE",t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t[t.CENTER=5]="CENTER",t))(LinkDirection||{}),LinkRenderType=(t=>(t[t.HIDDEN_LINK=-1]="HIDDEN_LINK",t[t.STRAIGHT_LINK=0]="STRAIGHT_LINK",t[t.LINEAR_LINK=1]="LINEAR_LINK",t[t.SPLINE_LINK=2]="SPLINE_LINK",t))(LinkRenderType||{}),LinkMarkerShape=(t=>(t[t.None=0]="None",t[t.Circle=1]="Circle",t[t.Arrow=2]="Arrow",t))(LinkMarkerShape||{}),TitleMode=(t=>(t[t.NORMAL_TITLE=0]="NORMAL_TITLE",t[t.NO_TITLE=1]="NO_TITLE",t[t.TRANSPARENT_TITLE=2]="TRANSPARENT_TITLE",t[t.AUTOHIDE_TITLE=3]="AUTOHIDE_TITLE",t))(TitleMode||{}),LGraphEventMode=(t=>(t[t.ALWAYS=0]="ALWAYS",t[t.ON_EVENT=1]="ON_EVENT",t[t.NEVER=2]="NEVER",t[t.ON_TRIGGER=3]="ON_TRIGGER",t[t.BYPASS=4]="BYPASS",t))(LGraphEventMode||{}),EaseFunction=(t=>(t.LINEAR="linear",t.EASE_IN_QUAD="easeInQuad",t.EASE_OUT_QUAD="easeOutQuad",t.EASE_IN_OUT_QUAD="easeInOutQuad",t))(EaseFunction||{});function distance(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function dist2(t,e,i,r){return(i-t)*(i-t)+(r-e)*(r-e)}function isInRectangle(t,e,i,r,n,s){return t>=i&&t<i+n&&e>=r&&e<r+s}function isPointInRect(t,e){return t[0]>=e[0]&&t[0]<e[0]+e[2]&&t[1]>=e[1]&&t[1]<e[1]+e[3]}function isInRect(t,e,i){return t>=i[0]&&t<i[0]+i[2]&&e>=i[1]&&e<i[1]+i[3]}function isInsideRectangle(t,e,i,r,n,s){return i<t&&i+n>t&&r<e&&r+s>e}function isSortaInsideOctagon(t,e,i){return Math.min(i,Math.abs(t))+Math.min(i,Math.abs(e))<.75*i}function overlapBounding(t,e){const i=t[0]+t[2],r=t[1]+t[3],n=e[0]+e[2],s=e[1]+e[3];return!(t[0]>n||t[1]>s||i<e[0]||r<e[1])}function containsCentre(t,e){return isInRect(e[0]+.5*e[2],e[1]+.5*e[3],t)}function containsRect(t,e){const i=t[0]+t[2],r=t[1]+t[3],n=e[0]+e[2],s=e[1]+e[3];return!(t[0]===e[0]&&t[1]===e[1]&&i===n&&r===s)&&t[0]<=e[0]&&t[1]<=e[1]&&i>=n&&r>=s}function findPointOnCurve(t,e,i,r,n,s=.5){const o=1-s,a=o*o*o,l=o*o*3*s,c=3*o*(s*s),h=s*s*s;t[0]=a*e[0]+l*r[0]+c*n[0]+h*i[0],t[1]=a*e[1]+l*r[1]+c*n[1]+h*i[1]}function createBounds(t,e=10){const i=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const r of t){const t=r.boundingRect;i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]+t[2]),i[3]=Math.max(i[3],t[1]+t[3])}return i.every((t=>isFinite(t)))?[i[0]-e,i[1]-e,i[2]-i[0]+2*e,i[3]-i[1]+2*e]:null}function snapPoint(t,e){return!!e&&(t[0]=e*Math.round(t[0]/e),t[1]=e*Math.round(t[1]/e),!0)}class CurveEditor{constructor(t){this.points=t,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}static sampleCurve(t,e){if(e){for(let i=0;i<e.length-1;++i){const r=e[i],n=e[i+1];if(n[0]<t)continue;const s=n[0]-r[0];if(Math.abs(s)<1e-5)return r[1];const o=(t-r[0])/s;return r[1]*(1-o)+n[1]*o}return 0}}draw(t,e,i,r,n,s=!1){const o=this.points;if(!o)return;this.size=e;const a=e[0]-2*this.margin,l=e[1]-2*this.margin;n=n||"#666",t.save(),t.translate(this.margin,this.margin),r&&(t.fillStyle="#111",t.fillRect(0,0,a,l),t.fillStyle="#222",t.fillRect(.5*a,0,1,l),t.strokeStyle="#333",t.strokeRect(0,0,a,l)),t.strokeStyle=n,s&&(t.globalAlpha=.5),t.beginPath();for(const c of o)t.lineTo(c[0]*a,(1-c[1])*l);if(t.stroke(),t.globalAlpha=1,!s)for(const[c,h]of o.entries())t.fillStyle=this.selected==c?"#FFF":this.nearest==c?"#DDD":"#AAA",t.beginPath(),t.arc(h[0]*a,(1-h[1])*l,2,0,2*Math.PI),t.fill();t.restore()}onMouseDown(t,e){const i=this.points;if(!i)return;if(t[1]<0)return;if(null==this.size)throw new Error("CurveEditor.size was null or undefined.");const r=this.size[0]-2*this.margin,n=this.size[1]-2*this.margin,s=t[0]-this.margin,o=t[1]-this.margin,a=[s,o],l=30/e.ds.scale;if(this.selected=this.getCloserPoint(a,l),-1==this.selected){const t=[s/r,1-o/n];i.push(t),i.sort((function(t,e){return t[0]-e[0]})),this.selected=i.indexOf(t),this.must_update=!0}return-1!=this.selected||void 0}onMouseMove(t,e){const i=this.points;if(!i)return;const r=this.selected;if(r<0)return;if(null==this.size)throw new Error("CurveEditor.size was null or undefined.");const n=(t[0]-this.margin)/(this.size[0]-2*this.margin),s=(t[1]-this.margin)/(this.size[1]-2*this.margin),o=[t[0]-this.margin,t[1]-this.margin],a=30/e.ds.scale;this._nearest=this.getCloserPoint(o,a);const l=i[r];if(l){const e=0==r||r==i.length-1;if(!e&&(t[0]<-10||t[0]>this.size[0]+10||t[1]<-10||t[1]>this.size[1]+10))return i.splice(r,1),void(this.selected=-1);l[0]=e?0==r?0:1:clamp(n,0,1),l[1]=1-clamp(s,0,1),i.sort((function(t,e){return t[0]-e[0]})),this.selected=i.indexOf(l),this.must_update=!0}}onMouseUp(){return this.selected=-1,!1}getCloserPoint(t,e){const i=this.points;if(!i)return-1;if(e=e||30,null==this.size)throw new Error("CurveEditor.size was null or undefined.");const r=this.size[0]-2*this.margin,n=this.size[1]-2*this.margin,s=i.length,o=[0,0];let a=1e6,l=-1;for(let c=0;c<s;++c){const s=i[c];o[0]=s[0]*r,o[1]=(1-s[1])*n;const h=distance(t,o);h>a||h>e||(l=c,a=h)}return l}}class DragAndScale{get offset(){return this.state.offset}set offset(t){this.state.offset=t}get scale(){return this.state.scale}set scale(t){this.state.scale=t}constructor(t){this.state={offset:new Float32Array([0,0]),scale:1},this.max_scale=10,this.min_scale=.1,this.enabled=!0,this.last_mouse=[0,0],this.visible_area=new Float32Array(4),this.element=t}computeVisibleArea(t){if(!this.element)return void(this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0);let e=this.element.width,i=this.element.height,r=-this.offset[0],n=-this.offset[1];t&&(r+=t[0]/this.scale,n+=t[1]/this.scale,e=t[2],i=t[3]);const s=r+e/this.scale,o=n+i/this.scale;this.visible_area[0]=r,this.visible_area[1]=n,this.visible_area[2]=s-r,this.visible_area[3]=o-n}toCanvasContext(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]}convertCanvasToOffset(t,e){return(e=e||[0,0])[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e}mouseDrag(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw?.(this)}changeScale(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t==this.scale)return;if(!this.element)return;const i=this.element.getBoundingClientRect();if(!i)return;const r=[(e=e??[.5*i.width,.5*i.height])[0]-i.x,e[1]-i.y],n=this.convertCanvasToOffset(r);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);const s=this.convertCanvasToOffset(r),o=[s[0]-n[0],s[1]-n[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw?.(this)}changeDeltaScale(t,e){this.changeScale(this.scale*t,e)}animateToBounds(t,e,{duration:i=350,zoom:r=.75,easing:n=EaseFunction.EASE_IN_OUT_QUAD}={}){if(!(i>0))throw new RangeError("Duration must be greater than 0");const s={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1},o=s[n]??s.linear,a=performance.now(),l=this.element.width/window.devicePixelRatio,c=this.element.height/window.devicePixelRatio,h=this.offset[0],u=this.offset[1],d=h-l/this.scale,p=u-c/this.scale;let f=this.scale;if(r>0){const e=r*l/Math.max(t[2],300),i=r*c/Math.max(t[3],300);f=Math.min(e,i,this.max_scale)}const _=l/f,m=c/f,g=-t[0]-.5*t[2]+.5*_,y=-t[1]-.5*t[3]+.5*m,v=g-_,b=y-m,x=t=>{const n=t-a,s=Math.min(n/i,1),f=o(s),_=h+(g-h)*f,m=u+(y-u)*f;if(this.offset[0]=_,this.offset[1]=m,r>0){const t=d+(v-d)*f,e=p+(b-p)*f,i=Math.abs(t-_),r=Math.abs(e-m);this.scale=Math.min(l/i,c/r)}e(),s<1?T=requestAnimationFrame(x):cancelAnimationFrame(T)};let T=requestAnimationFrame(x)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}var SlotType=(t=>(t.Array="array",t[t.Event=-1]="Event",t))(SlotType||{}),SlotShape=(SlotShape2=SlotShape||{},SlotShape2[SlotShape2.Box=RenderShape.BOX]="Box",SlotShape2[SlotShape2.Arrow=RenderShape.ARROW]="Arrow",SlotShape2[SlotShape2.Grid=RenderShape.GRID]="Grid",SlotShape2[SlotShape2.Circle=RenderShape.CIRCLE]="Circle",SlotShape2[SlotShape2.HollowCircle=RenderShape.HollowCircle]="HollowCircle",SlotShape2),SlotShape2,SlotDirection=(SlotDirection2=SlotDirection||{},SlotDirection2[SlotDirection2.Up=LinkDirection.UP]="Up",SlotDirection2[SlotDirection2.Right=LinkDirection.RIGHT]="Right",SlotDirection2[SlotDirection2.Down=LinkDirection.DOWN]="Down",SlotDirection2[SlotDirection2.Left=LinkDirection.LEFT]="Left",SlotDirection2),SlotDirection2,LabelPosition=(t=>(t.Left="left",t.Right="right",t))(LabelPosition||{});function strokeShape(t,e,{shape:i=RenderShape.BOX,round_radius:r,title_height:n,title_mode:s=TitleMode.NORMAL_TITLE,color:o,padding:a=6,collapsed:l=!1,lineWidth:c=1}={}){if(r??=LiteGraph.ROUND_RADIUS,o??=LiteGraph.NODE_BOX_OUTLINE_COLOR,s===TitleMode.TRANSPARENT_TITLE){const t=n??LiteGraph.NODE_TITLE_HEIGHT;e[1]-=t,e[3]+=t}const{lineWidth:h,strokeStyle:u}=t;t.lineWidth=c,t.globalAlpha=.8,t.strokeStyle=o,t.beginPath();const[d,p,f,_]=e;switch(i){case RenderShape.BOX:t.rect(d-a,p-a,f+2*a,_+2*a);break;case RenderShape.ROUND:case RenderShape.CARD:{const e=r+a,n=i===RenderShape.CARD&&l||i===RenderShape.ROUND?[e]:[e,2,e,2];t.roundRect(d-a,p-a,f+2*a,_+2*a,n);break}case RenderShape.CIRCLE:{const e=d+f/2,i=p+_/2,r=Math.max(f,_)/2+a;t.arc(e,i,r,0,2*Math.PI);break}}t.stroke(),t.lineWidth=h,t.strokeStyle=u,t.globalAlpha=1}const zeroUuid="00000000-0000-0000-0000-000000000000",randomStorage=new Uint32Array(31);function createUuidv4(){if("function"==typeof crypto?.randomUUID)return crypto.randomUUID();if("function"==typeof crypto?.getRandomValues){const t=crypto.getRandomValues(randomStorage);let e=0;return"10000000-1000-4000-8000-100000000000".replaceAll(/[018]/g,(i=>(Number(i)^3.725290298461914e-9*t[e++]>>.25*Number(i)).toString(16)))}return"10000000-1000-4000-8000-100000000000".replaceAll(/[018]/g,(t=>(Number(t)^16*Math.random()>>.25*Number(t)).toString(16)))}class LinkConnectorEventTarget extends EventTarget{dispatch(t,e){const i=new CustomEvent(t,{detail:e});return super.dispatchEvent(i)}addEventListener(t,e,i){super.addEventListener(t,e,i)}removeEventListener(t,e,i){super.removeEventListener(t,e,i)}dispatchEvent(t){return super.dispatchEvent(t)}}class LLink{#r;get color(){return this.#r}set color(t){this.#r=""===t?null:t}get isFloatingOutput(){return-1===this.origin_id&&-1===this.origin_slot}get isFloatingInput(){return-1===this.target_id&&-1===this.target_slot}get isFloating(){return this.isFloatingOutput||this.isFloatingInput}constructor(t,e,i,r,n,s,o){this.id=t,this.type=e,this.origin_id=i,this.origin_slot=r,this.target_id=n,this.target_slot=s,this.parentId=o,this._data=null,this._pos=new Float32Array(2)}static createFromArray(t){return new LLink(t[0],t[5],t[1],t[2],t[3],t[4])}static create(t){return new LLink(t.id,t.type,t.origin_id,t.origin_slot,t.target_id,t.target_slot,t.parentId)}static getReroutes(t,e){return e.parentId?t.reroutes.get(e.parentId)?.getReroutes()??[]:[]}static getFirstReroute(t,e){return LLink.getReroutes(t,e).at(0)}static findNextReroute(t,e,i){if(e.parentId)return t.reroutes.get(e.parentId)?.findNextReroute(i)}static getOriginNode(t,e){const i=t.links.get(e)?.origin_id;return t.getNodeById(i)??void 0}static getTargetNode(t,e){const i=t.links.get(e)?.target_id;return t.getNodeById(i)??void 0}configure(t){Array.isArray(t)?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot,this.parentId=t.parentId)}hasOrigin(t,e){return this.origin_id===t&&this.origin_slot===e}hasTarget(t,e){return this.target_id===t&&this.target_slot===e}toFloating(t,e){const i=this.asSerialisable();return i.id=-1,i.parentId=e,"input"===t?(i.origin_id=-1,i.origin_slot=-1):(i.target_id=-1,i.target_slot=-1),LLink.create(i)}disconnect(t,e){const i=LLink.getReroutes(t,this),r=i.at(-1);if("output"===e&&1===r?.linkIds.size&&0===r.floatingLinkIds.size||"input"===e&&r){const i=LLink.create(this);i.id=-1,"input"===e?(i.origin_id=-1,i.origin_slot=-1,r.floating={slotType:"input"}):(i.target_id=-1,i.target_slot=-1,r.floating={slotType:"output"}),t.addFloatingLink(i)}for(const n of i)n.linkIds.delete(this.id),e||n.totalLinks||t.reroutes.delete(n.id);t.links.delete(this.id)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}asSerialisable(){const t={id:this.id,origin_id:this.origin_id,origin_slot:this.origin_slot,target_id:this.target_id,target_slot:this.target_slot,type:this.type};return this.parentId&&(t.parentId=this.parentId),t}}class FloatingRenderLink{constructor(t,e,i,r,n=LinkDirection.CENTER){this.network=t,this.link=e,this.toType=i,this.fromReroute=r,this.dragDirection=n,this.outputNodeId=-1,this.outputIndex=-1,this.inputNodeId=-1,this.inputIndex=-1;const{origin_id:s,target_id:o,origin_slot:a,target_slot:l}=e;if(-1!==s){const i=t.getNodeById(s)??void 0;if(!i)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Output node [${s}] not found.`);const n=i?.outputs.at(a);if(!n)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Output slot [${a}] not found.`);this.outputNodeId=s,this.outputNode=i,this.outputSlot=n,this.outputIndex=a,this.outputPos=i.getOutputPos(a),this.node=i,this.fromSlot=n,this.fromPos=r?.pos??this.outputPos,this.fromDirection=LinkDirection.LEFT,this.dragDirection=LinkDirection.RIGHT,this.fromSlotIndex=a}else{const i=t.getNodeById(o)??void 0;if(!i)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Input node [${o}] not found.`);const r=i?.inputs.at(l);if(!r)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Input slot [${l}] not found.`);this.inputNodeId=o,this.inputNode=i,this.inputSlot=r,this.inputIndex=l,this.inputPos=i.getInputPos(l),this.node=i,this.fromSlot=r,this.fromDirection=LinkDirection.RIGHT,this.fromSlotIndex=l}this.fromPos=r.pos}canConnectToInput(){return"input"===this.toType}canConnectToOutput(){return"output"===this.toType}canConnectToReroute(t){if("input"===this.toType){if(t.origin_id===this.inputNode?.id)return!1}else if(t.origin_id===this.outputNode?.id)return!1;return!0}connectToInput(t,e,i){const r=this.link;r.target_id=t.id,r.target_slot=t.inputs.indexOf(e),t.disconnectInput(t.inputs.indexOf(e)),this.fromSlot._floatingLinks?.delete(r),e._floatingLinks??=new Set,e._floatingLinks.add(r)}connectToOutput(t,e,i){const r=this.link;r.origin_id=t.id,r.origin_slot=t.outputs.indexOf(e),this.fromSlot._floatingLinks?.delete(r),e._floatingLinks??=new Set,e._floatingLinks.add(r)}connectToRerouteInput(t,{node:e,input:i},r){const n=this.link;n.target_id=e.id,n.target_slot=e.inputs.indexOf(i),this.fromSlot._floatingLinks?.delete(n),i._floatingLinks??=new Set,i._floatingLinks.add(n),r.dispatch("input-moved",this)}connectToRerouteOutput(t,e,i,r){const n=this.link;n.origin_id=e.id,n.origin_slot=e.outputs.indexOf(i),this.fromSlot._floatingLinks?.delete(n),i._floatingLinks??=new Set,i._floatingLinks.add(n),r.dispatch("output-moved",this)}}class MovingLinkBase{constructor(t,e,i,r,n=LinkDirection.CENTER){this.network=t,this.link=e,this.toType=i,this.fromReroute=r,this.dragDirection=n;const{origin_id:s,target_id:o,origin_slot:a,target_slot:l}=e,c=t.getNodeById(s)??void 0;if(!c)throw new Error(`Creating MovingRenderLink for link [${e.id}] failed: Output node [${s}] not found.`);const h=c.outputs.at(a);if(!h)throw new Error(`Creating MovingRenderLink for link [${e.id}] failed: Output slot [${a}] not found.`);this.outputNodeId=s,this.outputNode=c,this.outputSlot=h,this.outputIndex=a,this.outputPos=c.getOutputPos(a);const u=t.getNodeById(o)??void 0;if(!u)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Input node [${o}] not found.`);const d=u.inputs.at(l);if(!d)throw new Error(`Creating DraggingRenderLink for link [${e.id}] failed: Input slot [${l}] not found.`);this.inputNodeId=o,this.inputNode=u,this.inputSlot=d,this.inputIndex=l,this.inputPos=u.getInputPos(l)}}class MovingInputLink extends MovingLinkBase{constructor(t,e,i,r=LinkDirection.CENTER){super(t,e,"input",i,r),this.toType="input",this.node=this.outputNode,this.fromSlot=this.outputSlot,this.fromPos=i?.pos??this.outputPos,this.fromDirection=LinkDirection.NONE,this.fromSlotIndex=this.outputIndex}canConnectToInput(t,e){return this.node.canConnectTo(t,e,this.outputSlot)}canConnectToOutput(){return!1}canConnectToReroute(t){return t.origin_id!==this.inputNode.id}connectToInput(t,e,i){if(e===this.inputSlot)return;this.inputNode.disconnectInput(this.inputIndex,!0);const r=this.outputNode.connectSlots(this.outputSlot,t,e,this.fromReroute?.id);return r&&i.dispatch("input-moved",this),r}connectToOutput(){throw new Error("MovingInputLink cannot connect to an output.")}connectToRerouteInput(t,{node:e,input:i,link:r},n,s){const{outputNode:o,outputSlot:a,fromReroute:l}=this;for(const c of s){if(c.id===this.link.parentId)break;1===c.totalLinks&&c.remove()}t.parentId=l?.id;o.connectSlots(a,e,i,r.parentId)&&n.dispatch("input-moved",this)}connectToRerouteOutput(){throw new Error("MovingInputLink cannot connect to an output.")}}class MovingOutputLink extends MovingLinkBase{constructor(t,e,i,r=LinkDirection.CENTER){super(t,e,"output",i,r),this.toType="output",this.node=this.inputNode,this.fromSlot=this.inputSlot,this.fromPos=i?.pos??this.inputPos,this.fromDirection=LinkDirection.LEFT,this.fromSlotIndex=this.inputIndex}canConnectToInput(){return!1}canConnectToOutput(t,e){return t.canConnectTo(this.node,this.inputSlot,e)}canConnectToReroute(t){return t.origin_id!==this.outputNode.id}connectToInput(){throw new Error("MovingOutputLink cannot connect to an input.")}connectToOutput(t,e,i){if(e===this.outputSlot)return;const r=t.connectSlots(e,this.inputNode,this.inputSlot,this.link.parentId);return r&&i.dispatch("output-moved",this),r}connectToRerouteInput(){throw new Error("MovingOutputLink cannot connect to an input.")}connectToRerouteOutput(t,e,i,r){const{inputNode:n,inputSlot:s,fromReroute:o}=this,a="output"===t?.floating?.slotType;o?o.parentId=t.id:this.link.parentId=t.id,e.connectSlots(i,n,s,this.link.parentId),a&&t.removeAllFloatingLinks(),r.dispatch("output-moved",this)}}class ToInputRenderLink{constructor(t,e,i,r,n=LinkDirection.CENTER){this.network=t,this.node=e,this.fromSlot=i,this.fromReroute=r,this.dragDirection=n,this.toType="input",this.fromDirection=LinkDirection.RIGHT;const s=e.outputs.indexOf(i);if(-1===s)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=s,this.fromPos=r?r.pos:this.node.getOutputPos(s)}canConnectToInput(t,e){return this.node.canConnectTo(t,e,this.fromSlot)}canConnectToOutput(){return!1}connectToInput(t,e,i){const{node:r,fromSlot:n,fromReroute:s}=this;if(t===r)return;const o=r.connectSlots(n,t,e,s?.id);i.dispatch("link-created",o)}connectToRerouteInput(t,{node:e,input:i,link:r},n,s){const{node:o,fromSlot:a,fromReroute:l}=this,c="output"===l?.floating?.slotType;t.parentId=l?.id;const h=o.connectSlots(a,e,i,r.parentId);c&&l.removeAllFloatingLinks();for(const u of s){if(u.id===l?.id)break;if(u.removeLink(r),0===u.totalLinks)if(r.isFloating)u.remove();else{const t=r.toFloating("output",u.id);this.network.addFloatingLink(t),u.floating={slotType:"output"}}}n.dispatch("link-created",h)}connectToOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}connectToRerouteOutput(){throw new Error("ToInputRenderLink cannot connect to an output.")}}class ToOutputRenderLink{constructor(t,e,i,r,n=LinkDirection.CENTER){this.network=t,this.node=e,this.fromSlot=i,this.fromReroute=r,this.dragDirection=n,this.toType="output",this.fromDirection=LinkDirection.LEFT;const s=e.inputs.indexOf(i);if(-1===s)throw new Error(`Creating render link for node [${this.node.id}] failed: Slot index not found.`);this.fromSlotIndex=s,this.fromPos=r?r.pos:this.node.getInputPos(s)}canConnectToInput(){return!1}canConnectToOutput(t,e){return this.node.canConnectTo(t,this.fromSlot,e)}canConnectToReroute(t){return t.origin_id!==this.node.id}connectToOutput(t,e,i){const{node:r,fromSlot:n,fromReroute:s}=this;if(!r)return;const o=t.connectSlots(e,r,n,s?.id);i.dispatch("link-created",o)}connectToRerouteOutput(t,e,i,r){const{node:n,fromSlot:s}=this,o=e.connectSlots(i,n,s,t?.id);r.dispatch("link-created",o)}connectToInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}connectToRerouteInput(){throw new Error("ToOutputRenderLink cannot connect to an input.")}}class LinkConnector{constructor(t){this.state={connectingTo:void 0,multi:!1,draggingExistingLinks:!1},this.events=new LinkConnectorEventTarget,this.renderLinks=[],this.inputLinks=[],this.outputLinks=[],this.floatingLinks=[],this.hiddenReroutes=new Set,this.#n=t}#n;get isConnecting(){return void 0!==this.state.connectingTo}get draggingExistingLinks(){return this.state.draggingExistingLinks}moveInputLink(t,e){if(this.isConnecting)throw new Error("Already dragging links.");const{state:i,inputLinks:r,renderLinks:n}=this,s=e.link;if(null==s){const i=e._floatingLinks?.values().next().value;if(null==i?.parentId)return;try{const e=t.reroutes.get(i.parentId);if(!e)throw new Error(`Invalid reroute id: [${i.parentId}] for floating link id: [${i.id}].`);const r=new FloatingRenderLink(t,i,"input",e);if(!1===this.events.dispatch("before-move-input",r))return;n.push(r)}catch(o){console.warn(`Could not create render link for link id: [${i.id}].`,i,o)}i._dragging=!0,this.floatingLinks.push(i)}else{const e=t.links.get(s);if(!e)return;try{const i=t.getReroute(e.parentId),r=new MovingInputLink(t,e,i);if(!1===this.events.dispatch("before-move-input",r))return;n.push(r),this.listenUntilReset("input-moved",(e=>{e.detail.link.disconnect(t,"output")}))}catch(o){return void console.warn(`Could not create render link for link id: [${e.id}].`,e,o)}e._dragging=!0,r.push(e)}i.connectingTo="input",i.draggingExistingLinks=!0,this.#s(!1)}moveOutputLink(t,e){if(this.isConnecting)throw new Error("Already dragging links.");const{state:i,renderLinks:r}=this;if(e._floatingLinks?.size)for(const s of e._floatingLinks.values())try{const e=LLink.getFirstReroute(t,s);if(!e)throw new Error(`Invalid reroute id: [${s.parentId}] for floating link id: [${s.id}].`);const i=new FloatingRenderLink(t,s,"output",e);if(!1===this.events.dispatch("before-move-output",i))continue;r.push(i),this.floatingLinks.push(s)}catch(n){console.warn(`Could not create render link for link id: [${s.id}].`,s,n)}if(e.links?.length)for(const s of e.links){const e=t.links.get(s);if(!e)continue;const i=LLink.getFirstReroute(t,e);i?(i._dragging=!0,this.hiddenReroutes.add(i)):e._dragging=!0,this.outputLinks.push(e);try{const n=new MovingOutputLink(t,e,i,LinkDirection.RIGHT);if(!1===this.events.dispatch("before-move-output",n))continue;r.push(n)}catch(n){console.warn(`Could not create render link for link id: [${e.id}].`,e,n);continue}}if(0===r.length)return this.reset();i.draggingExistingLinks=!0,i.multi=!0,i.connectingTo="output",this.#s(!0)}dragNewFromOutput(t,e,i,r){if(this.isConnecting)throw new Error("Already dragging links.");const{state:n}=this,s=new ToInputRenderLink(t,e,i,r);this.renderLinks.push(s),n.connectingTo="input",this.#s(!1)}dragNewFromInput(t,e,i,r){if(this.isConnecting)throw new Error("Already dragging links.");const{state:n}=this,s=new ToOutputRenderLink(t,e,i,r);this.renderLinks.push(s),n.connectingTo="output",this.#s(!0)}dragFromReroute(t,e){if(this.isConnecting)throw new Error("Already dragging links.");const i=e.firstLink??e.firstFloatingLink;if(!i)return;const r=t.getNodeById(i.origin_id);if(!r)return;const n=r.outputs.at(i.origin_slot);if(!n)return;const s=new ToInputRenderLink(t,r,n,e);s.fromDirection=LinkDirection.NONE,this.renderLinks.push(s),this.state.connectingTo="input",this.#s(!1)}dragFromLinkSegment(t,e){if(this.isConnecting)throw new Error("Already dragging links.");const{state:i}=this;if(null==e.origin_id||null==e.origin_slot)return;const r=t.getNodeById(e.origin_id);if(!r)return;const n=r.outputs.at(e.origin_slot);if(!n)return;const s=t.getReroute(e.parentId),o=new ToInputRenderLink(t,r,n,s);o.fromDirection=LinkDirection.NONE,this.renderLinks.push(o),i.connectingTo="input",this.#s(!1)}dropLinks(t,e){if(!this.isConnecting)return this.reset();const{renderLinks:i}=this;if(!1===this.events.dispatch("before-drop-links",{renderLinks:i,event:e}))return this.reset();const{canvasX:r,canvasY:n}=e,s=t.getNodeOnPos(r,n)??void 0;if(s)this.dropOnNode(s,e);else{const i=t.getRerouteOnPos(r,n);i&&this.isRerouteValidDrop(i)?this.dropOnReroute(i,e):this.dropOnNothing(e)}this.events.dispatch("after-drop-links",{renderLinks:i,event:e}),this.reset()}dropOnNode(t,e){const{renderLinks:i,state:r}=this,{connectingTo:n}=r,{canvasX:s,canvasY:o}=e;if(!i.every((e=>e.node===t)))if("output"===n){const i=t.getOutputOnPos([s,o]);i?this.#o(t,i):this.#a(t,e)}else if("input"===n){const r=t.getInputOnPos([s,o]);r?this.#l(t,r):this.overWidget&&i[0]instanceof ToInputRenderLink?(this.events.dispatch("dropped-on-widget",{link:i[0],node:t,widget:this.overWidget}),this.overWidget=void 0):this.#a(t,e)}}dropOnReroute(t,e){if(!1!==this.events.dispatch("dropped-on-reroute",{reroute:t,event:e}))if("input"!==this.state.connectingTo)for(const i of this.renderLinks){if("output"!==i.toType)continue;const e=t.findSourceOutput();if(!e)continue;const{node:r,output:n}=e;i.canConnectToOutput(r,n)&&i.connectToRerouteOutput(t,r,n,this.events)}else{if(1!==this.renderLinks.length)throw new Error(`Attempted to connect ${this.renderLinks.length} input links to a reroute.`);const e=this.renderLinks[0],i=t.findTargetInputs();if(!i?.length)return;const r=t.getReroutes();if(null===r)throw new Error("Reroute loop detected.");const n=r.slice(0,-1).reverse();if(e instanceof ToInputRenderLink){const{node:i,fromSlot:r,fromSlotIndex:s,fromReroute:o}=e;if(t.setFloatingLinkOrigin(i,r,s),null!=o)for(const e of n){if(e.id===o.id)break;for(const i of t.floatingLinkIds)e.floatingLinkIds.delete(i)}}const s=i.filter((i=>"input"===e.toType&&canConnectInputLinkToReroute(e,i.node,i.input,t)));for(const o of s)e.connectToRerouteInput(t,o,this.events,n)}}dropOnNothing(t){if("input"===this.state.connectingTo)for(const e of this.renderLinks)e instanceof MovingInputLink&&e.inputNode.disconnectInput(e.inputIndex,!0);this.events.dispatch("dropped-on-canvas",t)}#a(t,e){const{state:{connectingTo:i}}=this;if(!1===this.events.dispatch("dropped-on-node",{node:t,event:e}))return;const r=this.renderLinks[0];if(r)if("output"===i){const e=t.findOutputByType(r.fromSlot.type)?.slot;if(!e)return void console.warn(`Could not find slot for link type: [${r.fromSlot.type}].`);this.#o(t,e)}else if("input"===i){const e=t.findInputByType(r.fromSlot.type)?.slot;if(!e)return void console.warn(`Could not find slot for link type: [${r.fromSlot.type}].`);this.#l(t,e)}}#l(t,e){for(const i of this.renderLinks)i.canConnectToInput(t,e)&&i.connectToInput(t,e,this.events)}#o(t,e){for(const i of this.renderLinks)i.canConnectToOutput(t,e)?i.connectToOutput(t,e,this.events):i instanceof MovingOutputLink&&void 0!==i.link.parentId&&i.outputNode.connectSlots(i.outputSlot,i.inputNode,i.inputSlot,void 0)}isNodeValidDrop(t){return"output"===this.state.connectingTo?t.outputs.some((e=>this.renderLinks.some((i=>i.canConnectToOutput(t,e))))):!!t.widgets?.length||t.inputs.some((e=>this.renderLinks.some((i=>i.canConnectToInput(t,e)))))}isRerouteValidDrop(t){if("input"===this.state.connectingTo){const e=t.findTargetInputs();if(!e?.length)return!1;for(const{node:i,input:r}of e)for(const e of this.renderLinks)if("input"===e.toType&&canConnectInputLinkToReroute(e,i,r,t))return!0}else{const e=t.findSourceOutput();if(!e)return!1;const{node:i,output:r}=e;for(const n of this.renderLinks)if("output"===n.toType&&n.canConnectToReroute(t)&&n.canConnectToOutput(i,r))return!0}return!1}#s(t){const e=this.renderLinks.map((e=>{const i=t?e.fromSlot:null,r=t?null:e.fromSlot,n=e instanceof MovingLinkBase?e.link?.parentId:e.fromReroute?.id;return{node:e.node,slot:e.fromSlotIndex,input:i,output:r,pos:e.fromPos,afterRerouteId:n}}));this.#n(e)}export(t){return{renderLinks:[...this.renderLinks],inputLinks:[...this.inputLinks],outputLinks:[...this.outputLinks],floatingLinks:[...this.floatingLinks],state:{...this.state},network:t}}listenUntilReset(t,e,i){this.events.addEventListener(t,e,i),this.events.addEventListener("reset",(()=>this.events.removeEventListener(t,e)),{once:!0})}reset(t=!1){this.events.dispatch("reset",t);const{state:e,outputLinks:i,inputLinks:r,hiddenReroutes:n,renderLinks:s,floatingLinks:o}=this;if(t||void 0!==e.connectingTo){e.connectingTo=void 0;for(const t of i)delete t._dragging;for(const t of r)delete t._dragging;for(const t of o)delete t._dragging;for(const t of n)delete t._dragging;s.length=0,r.length=0,i.length=0,o.length=0,n.clear(),e.multi=!1,e.draggingExistingLinks=!1}}}function canConnectInputLinkToReroute(t,e,i,r){const{fromReroute:n}=t;if(!t.canConnectToInput(e,i)||n?.id===r.id||n?.getReroutes()?.includes(r))return!1;if(t instanceof ToInputRenderLink)if(null==r.parentId){if(r.firstLink?.hasOrigin(t.node.id,t.fromSlotIndex))return!1}else if(t.fromReroute?.id===r.parentId)return!1;return!0}function getNodeInputOnPos(t,e,i){const{inputs:r}=t;if(r)for(const[n,s]of r.entries()){const r=t.getInputPos(n),o=20+7*((s.label?.length??s.localized_name?.length??s.name?.length)||3);if(isInRectangle(e,i,r[0]-10,r[1]-10,o,20))return{index:n,input:s,pos:r}}}function getNodeOutputOnPos(t,e,i){const{outputs:r}=t;if(r)for(const[n,s]of r.entries()){const r=t.getOutputPos(n);if(isInRectangle(e,i,r[0]-10,r[1]-10,40,20))return{index:n,output:s,pos:r}}}function isOverNodeInput(t,e,i,r){const n=getNodeInputOnPos(t,e,i);return n?(r&&(r[0]=n.pos[0],r[1]=n.pos[1]),n.index):-1}function isOverNodeOutput(t,e,i,r){const n=getNodeOutputOnPos(t,e,i);return n?(r&&(r[0]=n.pos[0],r[1]=n.pos[1]),n.index):-1}class CanvasPointer{constructor(t){this.dragStarted=!1,this.isDouble=!1,this.isDown=!1,this.clearEventsOnReset=!0,this.element=t}static#c=(()=>this.bufferTime=150)();static#h=(()=>this.doubleClickTime=300)();static get maxClickDrift(){return this.#u}static set maxClickDrift(t){this.#u=t,this.#d=t*t}static#u=6;static#d=(()=>this.#u**2)();get finally(){return this.#p}set finally(t){try{this.#p?.()}finally{this.#p=t}}#p;down(t){this.reset(),this.eDown=t,this.pointerId=t.pointerId,this.element.setPointerCapture(t.pointerId)}move(t){const{eDown:e}=this;if(!e)return;if(!t.buttons)return void this.reset();if(!(t.buttons&e.buttons))return this.#f(t),void this.reset();if(this.eMove=t,this.onDrag?.(t),this.dragStarted)return;!(t.timeStamp-e.timeStamp>CanvasPointer.bufferTime)&&this.#_(t,e)||this.#m()}up(t){if(t.button!==this.eDown?.button)return!1;this.#f(t);const{dragStarted:e}=this;return this.reset(),!e}#f(t){const{eDown:e}=this;e&&(this.eUp=t,this.dragStarted?this.onDragEnd?.(t):this.#_(t,e)?this.onDoubleClick&&this.#g()?(this.onDoubleClick(t),this.eLastDown=void 0):(this.onClick?.(t),this.eLastDown=e):(this.#m(),this.onDragEnd?.(t)))}#_(t,e,i=CanvasPointer.#d){return dist2(t.clientX,t.clientY,e.clientX,e.clientY)<=i}#g(){const{eDown:t,eLastDown:e}=this;if(!t||!e)return!1;const i=(3*CanvasPointer.#u)**2,r=t.timeStamp-e.timeStamp;return r>0&&r<CanvasPointer.doubleClickTime&&this.#_(t,e,i)}#m(){this.dragStarted=!0,this.onDragStart?.(this),delete this.onDragStart}reset(){this.finally=void 0,delete this.onClick,delete this.onDoubleClick,delete this.onDragStart,delete this.onDrag,delete this.onDragEnd,this.isDown=!1,this.isDouble=!1,this.dragStarted=!1,this.clearEventsOnReset&&(this.eDown=void 0,this.eMove=void 0,this.eUp=void 0);const{element:t,pointerId:e}=this;this.pointerId=void 0,"number"==typeof e&&t.hasPointerCapture(e)&&t.releasePointerCapture(e)}}class NullGraphError extends Error{constructor(t="Attempted to access LGraph reference that was null or undefined.",e){super(t,{cause:e}),this.name="NullGraphError"}}var BadgePosition=(t=>(t.TopLeft="top-left",t.TopRight="top-right",t))(BadgePosition||{});class LGraphBadge{constructor({text:t,fgColor:e="white",bgColor:i="#0F1F0F",fontSize:r=12,padding:n=6,height:s=20,cornerRadius:o=5}){this.text=t,this.fgColor=e,this.bgColor=i,this.fontSize=r,this.padding=n,this.height=s,this.cornerRadius=o}get visible(){return this.text.length>0}getWidth(t){if(!this.visible)return 0;const{font:e}=t;t.font=`${this.fontSize}px sans-serif`;const i=t.measureText(this.text).width;return t.font=e,i+2*this.padding}draw(t,e,i){if(!this.visible)return;const{fillStyle:r}=t;t.font=`${this.fontSize}px sans-serif`;const n=this.getWidth(t);t.fillStyle=this.bgColor,t.beginPath(),t.roundRect?t.roundRect(e+0,i,n,this.height,this.cornerRadius):t.rect(e+0,i,n,this.height),t.fill(),t.fillStyle=this.fgColor,t.fillText(this.text,e+0+this.padding,i+this.height-this.padding),t.fillStyle=r}}function shallowCloneCommonProps(t){const{color_off:e,color_on:i,dir:r,label:n,localized_name:s,locked:o,name:a,nameLocked:l,removable:c,shape:h,type:u}=t;return{color_off:e,color_on:i,dir:r,label:n,localized_name:s,locked:o,name:a,nameLocked:l,removable:c,shape:h,type:u}}function inputAsSerialisable(t){const{link:e}=t,i=t.widget?{widget:{name:t.widget.name}}:{pos:t.pos};return{...shallowCloneCommonProps(t),...i,link:e}}function outputAsSerialisable(t){const{pos:e,slot_index:i,links:r,widget:n}=t,s=n?{widget:{name:n.name}}:null;return{...shallowCloneCommonProps(t),...s,pos:e,slot_index:i,links:r}}function toNodeSlotClass(t){if(isINodeInputSlot(t))return new NodeInputSlot(t);if(isINodeOutputSlot(t))return new NodeOutputSlot(t);throw new Error("Invalid slot type")}function isWidgetInputSlot(t){return isINodeInputSlot(t)&&!!t.widget}class NodeSlot{constructor(t){Object.assign(this,t),this.name=t.name,this.type=t.type}get renderingLabel(){return this.label||this.localized_name||this.name||""}connectedColor(t){return this.color_on||t.default_connection_color_byType[this.type]||t.default_connection_color.output_on}disconnectedColor(t){return this.color_off||t.default_connection_color_byTypeOff[this.type]||t.default_connection_color_byType[this.type]||t.default_connection_color.output_off}renderingColor(t){return this.isConnected()?this.connectedColor(t):this.disconnectedColor(t)}draw(t,e){const{pos:i,colorContext:r,labelColor:n="#AAA",labelPosition:s=LabelPosition.Right,lowQuality:o=!1,highlight:a=!1}=e;let{doStroke:l=!1}=e;const c=t.fillStyle,h=t.strokeStyle,u=t.lineWidth,d=this.type,p=d===SlotType.Array?SlotShape.Grid:this.shape;t.beginPath();let f=!0;if(t.fillStyle=this.renderingColor(r),t.lineWidth=1,d===SlotType.Event||p===SlotShape.Box)t.rect(i[0]-6+.5,i[1]-5+.5,14,10);else if(p===SlotShape.Arrow)t.moveTo(i[0]+8,i[1]+.5),t.lineTo(i[0]-4,i[1]+6+.5),t.lineTo(i[0]-4,i[1]-6+.5),t.closePath();else if(p===SlotShape.Grid){const e=3,r=2,n=3;for(let s=0;s<e;s++)for(let o=0;o<e;o++)t.rect(i[0]-4+s*n,i[1]-4+o*n,r,r);l=!1}else if(o)t.rect(i[0]-4,i[1]-4,8,8);else{let e;p===SlotShape.HollowCircle?(f=!1,l=!0,t.lineWidth=3,t.strokeStyle=t.fillStyle,e=a?4:3):e=a?5:4,t.arc(i[0],i[1],e,0,2*Math.PI)}f&&t.fill(),!o&&l&&t.stroke();if(!(o||isWidgetInputSlot(this))){const e=this.renderingLabel;e&&(t.fillStyle=n,s===LabelPosition.Right?this.dir==LinkDirection.UP?t.fillText(e,i[0],i[1]-10):t.fillText(e,i[0]+10,i[1]+5):this.dir==LinkDirection.DOWN?t.fillText(e,i[0],i[1]-8):t.fillText(e,i[0]-10,i[1]+5))}this.hasErrors&&(t.lineWidth=2,t.strokeStyle="red",t.beginPath(),t.arc(i[0],i[1],12,0,2*Math.PI),t.stroke()),t.fillStyle=c,t.strokeStyle=h,t.lineWidth=u}drawCollapsed(t,e){const[i,r]=e.pos,n=t.fillStyle;if(t.fillStyle="#686",t.beginPath(),this.type===SlotType.Event||this.shape===RenderShape.BOX)t.rect(i-7+.5,r-4,14,8);else if(this.shape===RenderShape.ARROW){this instanceof NodeInputSlot?(t.moveTo(i+8,r),t.lineTo(i-4,r-4),t.lineTo(i-4,r+4)):(t.moveTo(i+6,r),t.lineTo(i-6,r-4),t.lineTo(i-6,r+4)),t.closePath()}else t.arc(i,r,4,0,2*Math.PI);t.fill(),t.fillStyle=n}}function isINodeInputSlot(t){return"link"in t}class NodeInputSlot extends NodeSlot{constructor(t){super(t),this.link=t.link}isConnected(){return null!=this.link}isValidTarget(t){return"links"in t&&LiteGraph.isValidConnection(this.type,t.type)}draw(t,e){const i=t.textAlign;t.textAlign="left",super.draw(t,{...e,labelPosition:LabelPosition.Right,doStroke:!1}),t.textAlign=i}}function isINodeOutputSlot(t){return"links"in t}class NodeOutputSlot extends NodeSlot{constructor(t){super(t),this.links=t.links,this._data=t._data,this.slot_index=t.slot_index}isValidTarget(t){return"link"in t&&LiteGraph.isValidConnection(this.type,t.type)}isConnected(){return null!=this.links&&this.links.length>0}draw(t,e){const i=t.textAlign,r=t.strokeStyle;t.textAlign="right",t.strokeStyle="black",super.draw(t,{...e,labelPosition:LabelPosition.Left,doStroke:!0}),t.textAlign=i,t.strokeStyle=r}}function stringOrEmpty(t){return null==t?"":String(t)}function parseSlotTypes(t){return""==t||"0"==t?["*"]:String(t).toLowerCase().split(",")}function getAllNestedItems(t){const e=new Set;if(t)for(const r of t)i(r,e);return e;function i(t,e){if(!e.has(t)&&!t.pinned&&(e.add(t),t.children))for(const r of t.children)i(r,e)}}function findFirstNode(t){for(const e of t)if(e instanceof LGraphNode)return e}function findFreeSlotOfType(t,e){if(!t?.length)return;let i,r,n;const s=parseSlotTypes(e);for(const[o,a]of t.entries()){const t=parseSlotTypes(a.type);for(const e of s)for(const s of t)if(s===e){if(null==a.link&&!a.links?.length)return{index:o,slot:a};i??={index:o,slot:a}}else r||"*"!==e&&"*"!==s||(null!=a.link||a.links?.length?n??={index:o,slot:a}:r={index:o,slot:a})}return r??i??n}class LayoutElement{constructor(t){this.value=t.value,this.boundingRect=t.boundingRect}get center(){return[this.boundingRect[0]+this.boundingRect[2]/2,this.boundingRect[1]+this.boundingRect[3]/2]}}function distributeSpace(t,e){if(0===e.length)return[];const i=e.reduce(((t,e)=>t+e.minSize),0);if(t<i)return e.map((t=>t.minSize));let r=e.map((t=>({computedSize:t.minSize,maxSize:t.maxSize??1/0,remaining:(t.maxSize??1/0)-t.minSize}))),n=t-i;for(;n>0&&r.some((t=>t.remaining>0));){const t=r.filter((t=>t.remaining>0)).length;if(0===t)break;const e=n/t;let i=0;if(r=r.map((t=>{if(t.remaining<=0)return t;const r=Math.min(e,t.remaining);return i+=r,{...t,computedSize:t.computedSize+r,remaining:t.remaining-r}})),n-=i,0===i)break}return r.map((({computedSize:t})=>t))}function toClass(t,e){return e instanceof t?e:new t(e)}class BaseWidget{constructor(t){this.y=0,Object.assign(this,t),this.name=t.name,this.options=t.options,this.type=t.type}get outline_color(){return this.advanced?LiteGraph.WIDGET_ADVANCED_OUTLINE_COLOR:LiteGraph.WIDGET_OUTLINE_COLOR}get background_color(){return LiteGraph.WIDGET_BGCOLOR}get height(){return LiteGraph.NODE_WIDGET_HEIGHT}get text_color(){return LiteGraph.WIDGET_TEXT_COLOR}get secondary_text_color(){return LiteGraph.WIDGET_SECONDARY_TEXT_COLOR}setValue(t,e){const{node:i,canvas:r,e:n}=e,s=this.value;if(t===this.value)return;const o="number"===this.type?Number(t):t;if(this.value=o,this.options?.property&&void 0!==i.properties[this.options.property]&&i.setProperty(this.options.property,o),null!=r){const t=r.graph_mouse;this.callback?.(this.value,r,i,t,n)}i.onWidgetChanged?.(this.name??"",o,s,this),i.graph&&i.graph._version++}}class BooleanWidget extends BaseWidget{constructor(t){super(t),this.type="toggle",this.value=t.value}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const{height:s}=this;if(t.textAlign="left",t.strokeStyle=this.outline_color,t.fillStyle=this.background_color,t.beginPath(),r?t.roundRect(n,e,i-2*n,s,[.5*s]):t.rect(n,e,i-2*n,s),t.fill(),r&&!this.computedDisabled&&t.stroke(),t.fillStyle=this.value?"#89A":"#333",t.beginPath(),t.arc(i-2*n,e+.5*s,.36*s,0,2*Math.PI),t.fill(),r){t.fillStyle=this.secondary_text_color;const r=this.label||this.name;null!=r&&t.fillText(r,2*n,e+.7*s),t.fillStyle=this.value?this.text_color:this.secondary_text_color,t.textAlign="right",t.fillText(this.value?this.options.on||"true":this.options.off||"false",i-40,e+.7*s)}}onClick(t){this.setValue(!this.value,t)}}class ButtonWidget extends BaseWidget{constructor(t){super(t),this.type="button",this.clicked=t.clicked??!1}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;let c=i-2*n,h=0;var u=i=>{t.fillStyle=this.background_color,this.clickeName==i&&(t.fillStyle="#AAA",this.clickeName=""),t.fillRect(n+h,e,c,l),r&&!this.computedDisabled&&(t.strokeStyle=this.outline_color,t.strokeRect(n+h,e,c,l)),r&&(t.textAlign="center",t.fillStyle=this.text_color,t.fillText(i,.5*c+h+n,e+.7*l)),h+=c+2};if(null!=this.options.buttons){c/=this.options.buttons.length,c-=2;for(var d=0;d<this.options.buttons.length;d++)u(this.options.buttons[d])}else u(this.label||this.name||"");t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(t){const{e:e,node:i,canvas:r}=t,n=r.graph_mouse,s=e.canvasX-i.pos[0];e.canvasY,this.y,i.pos[1];const{height:o}=this;let a=(this.width||i.size[0])-30;if(null!=this.options.buttons){a=a/this.options.buttons.length-2,this.clickeName="";for(var l=0;l<this.options.buttons.length;l++){if(a*l+15+2*l<s&&s<a*(l+1)+15+2*l){this.clickeName=this.options.buttons[l];break}}}else this.clickeName=this.label||this.name||"";this.clicked=!0,r.setDirty(!0),this.callback?.(this,r,i,n,e)}}class ComboWidget extends BaseWidget{constructor(t){super(t),this.type="combo",this.value=t.value}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;if(t.textAlign="left",t.strokeStyle=this.outline_color,t.fillStyle=this.background_color,t.beginPath(),r?t.roundRect(n,e,i-2*n,l,[.5*l]):t.rect(n,e,i-2*n,l),t.fill(),r){this.computedDisabled||(t.stroke(),t.fillStyle=this.text_color,t.beginPath(),t.moveTo(n+16,e+5),t.lineTo(n+6,e+.5*l),t.lineTo(n+16,e+l-5),t.fill(),t.beginPath(),t.moveTo(i-n-16,e+5),t.lineTo(i-n-6,e+.5*l),t.lineTo(i-n-16,e+l-5),t.fill()),t.fillStyle=this.secondary_text_color;const r=this.label||this.name;null!=r&&t.fillText(r,2*n+5,e+.7*l),t.fillStyle=this.text_color,t.textAlign="right";let s="number"==typeof this.value?String(this.value):this.value;if(this.options.values){let t=this.options.values;"function"==typeof t&&(t=t()),t&&!Array.isArray(t)&&(s=t[this.value])}const o=i-4*n-(t.measureText(r||"").width+2*n),a=t.measureText(s).width;if(a>o){const e="…",i=t.measureText(e).width,r=t.measureText("a").width;if(o<=i)s="․";else{s=`${s}`;if(a+i-o+3*r>o){const t=o+3*r,e=Math.floor((t-i)/r);s=s.substr(0,e)}for(;t.measureText(s).width+i>o;)s=s.substr(0,s.length-1);s+=e}}t.fillText(s,i-2*n-20,e+.7*l)}t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(t){const{e:e,node:i,canvas:r}=t,n=e.canvasX-i.pos[0],s=this.width||i.size[0],o=n<40?-1:n>s-40?1:0;let a=this.options.values;"function"==typeof a&&(a=a(this,i));const l=Array.isArray(a)?a:Object.keys(a);if(o){let t=-1;return r.last_mouseclick=0,t="object"==typeof a?l.indexOf(String(this.value))+o:l.indexOf(this.value)+o,t>=l.length&&(t=l.length-1),t<0&&(t=0),void this.setValue(Array.isArray(a)?a[t]:t,{e:e,node:i,canvas:r})}const c=a!=l?Object.values(a):a;new LiteGraph.ContextMenu(c,{scale:Math.max(1,r.ds.scale),event:e,className:"dark",callback:t=>{this.setValue(a!=l?c.indexOf(t):t,{e:e,node:i,canvas:r})}})}}function getWidgetStep(t){return t.step2||.1*(t.step||10)}class KnobWidget extends BaseWidget{constructor(t){super(t),this.current_drag_offset=0,this.type="knob",this.value=t.value,this.options=t.options}computeLayoutSize(){return{minHeight:60,minWidth:20,maxHeight:1e6,maxWidth:1e6}}get height(){return this.computedHeight||super.height}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{gradient_stops:l="rgb(14, 182, 201); rgb(0, 216, 72)"}=this.options,c=this.computedHeight||this.height,h=Math.min(this.computedHeight||this.height,this.width||20)/20,u={x:i/2,y:c/2+e};t.lineWidth=(Math.min(i,c)-n*h)/6;const d=(Math.min(i,c)-n*h-t.lineWidth)/2;{const e=t.createRadialGradient(u.x,u.y,d+t.lineWidth,0,0,d+t.lineWidth);e.addColorStop(0,"rgb(29, 29, 29)"),e.addColorStop(1,"rgb(116, 116, 116)"),t.fillStyle=e}t.beginPath(),t.arc(u.x,u.y,d+t.lineWidth/2,0,2*Math.PI,!1),t.fill(),t.closePath();const p={start_angle:.6*Math.PI,end_angle:2.4*Math.PI};t.beginPath();{const e=t.createRadialGradient(u.x,u.y,d+t.lineWidth,0,0,d+t.lineWidth);e.addColorStop(0,"rgb(99, 99, 99)"),e.addColorStop(1,"rgb(36, 36, 36)"),t.strokeStyle=e}t.arc(u.x,u.y,d,p.start_angle,p.end_angle,!1),t.stroke(),t.closePath();const f=this.options.max-this.options.min;let _=(this.value-this.options.min)/f;_=clamp(_,0,1),t.beginPath();const m=t.createConicGradient(p.start_angle,u.x,u.y),g=l.split(";");for(const[v,b]of g.entries())m.addColorStop(v,b.trim());t.strokeStyle=m;const y=(p.end_angle-p.start_angle)*_+p.start_angle;if(t.arc(u.x,u.y,d,p.start_angle,y,!1),t.stroke(),t.closePath(),r&&!this.computedDisabled&&(t.strokeStyle=this.outline_color,t.beginPath(),t.strokeStyle=this.outline_color,t.arc(u.x,u.y,d+t.lineWidth/2,0,2*Math.PI,!1),t.lineWidth=1,t.stroke(),t.closePath()),r){t.textAlign="center",t.fillStyle=this.text_color;const r=Number(this.value).toFixed(this.options.precision??3);t.fillText(`${this.label||this.name}\n${r}`,.5*i,e+.5*c)}t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(){this.current_drag_offset=0}onDrag(t){if(this.options.read_only)return;const{e:e}=t,i=getWidgetStep(this.options),r=this.options.max-this.options.min,n=r/10,s=r/100,o={shift:n>i?n-n%i:i,delta_y:s>i?s-s%i:i},a=Math.abs(e.movementY)>Math.abs(e.movementX),l=a?-e.movementY:e.movementX;this.current_drag_offset+=l;let c=0;this.current_drag_offset>15?(c+=1,this.current_drag_offset-=15):this.current_drag_offset<-15&&(c-=1,this.current_drag_offset+=15);const h=c*(e.shiftKey?o.shift:a?o.delta_y:i),u=clamp(this.value+h,this.options.min,this.options.max);u!==this.value&&this.setValue(u,t)}}class NumberWidget extends BaseWidget{constructor(t){super(t),this.type="number",this.value=t.value}setValue(t,e){let i=t;null!=this.options.min&&i<this.options.min&&(i=this.options.min),null!=this.options.max&&i>this.options.max&&(i=this.options.max),super.setValue(i,e)}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;if(t.textAlign="left",t.strokeStyle=this.outline_color,t.fillStyle=this.background_color,t.beginPath(),r?t.roundRect(n,e,i-2*n,l,[.5*l]):t.rect(n,e,i-2*n,l),t.fill(),r){this.computedDisabled||(t.stroke(),t.fillStyle=this.text_color,t.beginPath(),t.moveTo(n+16,e+5),t.lineTo(n+6,e+.5*l),t.lineTo(n+16,e+l-5),t.fill(),t.beginPath(),t.moveTo(i-n-16,e+5),t.lineTo(i-n-6,e+.5*l),t.lineTo(i-n-16,e+l-5),t.fill()),t.fillStyle=this.secondary_text_color;const r=this.label||this.name;null!=r&&t.fillText(r,2*n+5,e+.7*l),t.fillStyle=this.text_color,t.textAlign="right",t.fillText(Number(this.value).toFixed(void 0!==this.options.precision?this.options.precision:3),i-2*n-20,e+.7*l)}t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(options){const{e:e,node:node,canvas:canvas}=options,x=e.canvasX-node.pos[0],width=this.width||node.size[0],delta=x<40?-1:x>width-40?1:0;delta?this.setValue(this.value+delta*getWidgetStep(this.options),{e:e,node:node,canvas:canvas}):canvas.prompt("Value",this.value,(v=>{if(/^[\d\s()*+/-]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch{}const newValue=Number(v);isNaN(newValue)||this.setValue(newValue,{e:e,node:node,canvas:canvas})}),e)}onDrag(t){const{e:e,node:i,canvas:r}=t,n=this.width||i.width,s=e.canvasX-i.pos[0];(s<40?-1:s>n-40?1:0)&&s>-3&&s<n+3||this.setValue(this.value+(e.deltaX??0)*getWidgetStep(this.options),{e:e,node:i,canvas:r})}}class SliderWidget extends BaseWidget{constructor(t){super(t),this.type="slider",this.value=t.value,this.options=t.options,this.marker=t.marker}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;t.fillStyle=this.background_color,t.fillRect(n,e,i-2*n,l);const c=this.options.max-this.options.min;let h=(this.value-this.options.min)/c;if(h=clamp(h,0,1),t.fillStyle=this.options.slider_color??"#678",t.fillRect(n,e,h*(i-2*n),l),r&&!this.computedDisabled&&(t.strokeStyle=this.outline_color,t.strokeRect(n,e,i-2*n,l)),null!=this.marker){let r=(this.marker-this.options.min)/c;r=clamp(r,0,1),t.fillStyle=this.options.marker_color??"#AA9",t.fillRect(n+r*(i-2*n),e,2,l)}if(r){t.textAlign="center",t.fillStyle=this.text_color;const r=Number(this.value).toFixed(this.options.precision??3);t.fillText(`${this.label||this.name}  ${r}`,.5*i,e+.7*l)}t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(t){if(this.options.read_only)return;const{e:e,node:i}=t,r=this.width||i.size[0],n=clamp((e.canvasX-i.pos[0]-15)/(r-30),0,1),s=this.options.min+(this.options.max-this.options.min)*n;s!==this.value&&this.setValue(s,t)}onDrag(t){if(this.options.read_only)return!1;const{e:e,node:i}=t,r=this.width||i.size[0],n=clamp((e.canvasX-i.pos[0]-15)/(r-30),0,1),s=this.options.min+(this.options.max-this.options.min)*n;s!==this.value&&this.setValue(s,t)}}class TextWidget extends BaseWidget{constructor(t){super(t),this.type=t.type??"string",this.value=t.value?.toString()??""}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;if(t.textAlign="left",t.strokeStyle=this.outline_color,t.fillStyle=this.background_color,t.beginPath(),r?t.roundRect(n,e,i-2*n,l,[.5*l]):t.rect(n,e,i-2*n,l),t.fill(),r){this.computedDisabled||t.stroke(),t.save(),t.beginPath(),t.rect(n,e,i-2*n,l),t.clip(),t.fillStyle=this.secondary_text_color;const r=this.label||this.name;null!=r&&t.fillText(r,2*n,e+.7*l),t.fillStyle=this.text_color,t.textAlign="right";let s=String(this.value),o=s.length<9?s:s.substring(0,8)+"..";t.fillText(o,i-2*n,e+.7*l),t.restore()}t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(t){const{e:e,node:i,canvas:r}=t;r.prompt("Value",this.value,(t=>{null!==t&&this.setValue(t,{e:e,node:i,canvas:r})}),e,this.options?.multiline??!1)}}class ccNodeWidget extends BaseWidget{get height(){return this._height||100}computeLayoutSize(t){var e=t.width-30;let i=this.options.viewHeight/this.options.viewWidth*e;return this._height=i,{minHeight:i+4,maxHeight:i+4,minWidth:e,maxWidth:e}}constructor(t){super(t),this.type="ccnode",this.value=t.value,this.options=t.options}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.strokeStyle,o=t.fillStyle;i-=2*n;var a=this.options.viewHeight/this.options.viewWidth*i;t.fillStyle=this.background_color,t.fillRect(n,e,i,a),t.strokeStyle=this.outline_color,t.beginPath(),t.rect(n,e,i,a),t.stroke(),t.save(),t.clip(),t.fillStyle=this.value.color||"#D8D8D8",t.strokeStyle=this.options.borderColor||"#D8D8D8";var l=this.value.x,c=-1*this.value.y,h=i/this.options.viewWidth*l,u=a/this.options.viewHeight*c,d=i/this.options.viewWidth*this.value.width*this.value.scaleX,p=a/this.options.viewHeight*this.value.height*this.value.scaleY,f=.5*i,_=.5*a,m=this.value.anchorX*d*-1,g=(1-this.value.anchorY)*p*-1,y=this.value.angle*Math.PI/180*-1;t.translate(n+h+f,e+u+_),t.rotate(y),this.options.justDrawBorder?t.strokeRect(m,g,d,p):t.fillRect(m,g,d,p),t.restore(),t.fillStyle="#1568DD",t.beginPath(),t.arc(n+h+f,e+u+_,2,0,360),t.fill(),t.strokeStyle=s,t.fillStyle=o}dealTouch(t){if(this.options.read_only)return;const{e:e,node:i}=t,r=this.width||i.size[0],n=e.canvasX-i.pos[0],s=e.canvasY-this.y-i.pos[1],o=clamp((n-15)/(r-30),0,1),a=clamp(s/this.height,0,1);let l=(o-.5)*this.options.viewWidth,c=(a-.5)*this.options.viewHeight*-1;this.value.x=l,this.value.y=c,void 0!==i.properties.x&&i.setProperty("x",l),void 0!==i.properties.y&&i.setProperty("y",c),void 0!==i.properties[this.options.property]&&i.setProperty(this.options.property,this.value),i.onWidgetChanged?.(this.name??"",this.value,null,this),i.graph&&i.graph._version++}onClick(t){this.dealTouch(t)}onDrag(t){this.dealTouch(t)}}const{abs:abs$1,cos:cos$1,sin:sin$1,acos:acos$1,atan2:atan2,sqrt:sqrt$1,pow:pow}=Math;function crt(t){return t<0?-pow(-t,1/3):pow(t,1/3)}const pi$1=Math.PI,tau=2*pi$1,quart=pi$1/2,epsilon=1e-6,nMax=Number.MAX_SAFE_INTEGER||9007199254740991,nMin=Number.MIN_SAFE_INTEGER||-9007199254740991,ZERO={x:0,y:0,z:0},utils={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const i=e(t);let r=i.x*i.x+i.y*i.y;return void 0!==i.z&&(r+=i.z*i.z),sqrt$1(r)},compute:function(t,e,i){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const n=1-t;let s=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:n*s[0].x+t*s[1].x,y:n*s[0].y+t*s[1].y,t:t};return i&&(e.z=n*s[0].z+t*s[1].z),e}if(r<4){let e,o,a,l=n*n,c=t*t,h=0;2===r?(s=[s[0],s[1],s[2],ZERO],e=l,o=n*t*2,a=c):3===r&&(e=l*n,o=l*t*3,a=n*c*3,h=t*c);const u={x:e*s[0].x+o*s[1].x+a*s[2].x+h*s[3].x,y:e*s[0].y+o*s[1].y+a*s[2].y+h*s[3].y,t:t};return i&&(u.z=e*s[0].z+o*s[1].z+a*s[2].z+h*s[3].z),u}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e].z=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,i,r){const n=1-t,s=i,o=e;let a,l=s[0],c=s[1],h=s[2],u=s[3];return l*=n,c*=t,2===o.length?(a=l+c,{x:(l*o[0].x+c*o[1].x)/a,y:(l*o[0].y+c*o[1].y)/a,z:!!r&&(l*o[0].z+c*o[1].z)/a,t:t}):(l*=n,c*=2*n,h*=t*t,3===o.length?(a=l+c+h,{x:(l*o[0].x+c*o[1].x+h*o[2].x)/a,y:(l*o[0].y+c*o[1].y+h*o[2].y)/a,z:!!r&&(l*o[0].z+c*o[1].z+h*o[2].z)/a,t:t}):(l*=n,c*=1.5*n,h*=3*n,u*=t*t*t,4===o.length?(a=l+c+h+u,{x:(l*o[0].x+c*o[1].x+h*o[2].x+u*o[3].x)/a,y:(l*o[0].y+c*o[1].y+h*o[2].y+u*o[3].y)/a,z:!!r&&(l*o[0].z+c*o[1].z+h*o[2].z+u*o[3].z)/a,t:t}):void 0))},derive:function(t,e){const i=[];for(let r=t,n=r.length,s=n-1;n>1;n--,s--){const t=[];for(let i,n=0;n<s;n++)i={x:s*(r[n+1].x-r[n].x),y:s*(r[n+1].y-r[n].y)},e&&(i.z=s*(r[n+1].z-r[n].z)),t.push(i);i.push(t),r=t}return i},between:function(t,e,i){return e<=t&&t<=i||utils.approximately(t,e)||utils.approximately(t,i)},approximately:function(t,e,i){return abs$1(t-e)<=(i||epsilon)},length:function(t){const e=utils.Tvalues.length;let i=0;for(let r,n=0;n<e;n++)r=.5*utils.Tvalues[n]+.5,i+=utils.Cvalues[n]*utils.arcfn(r,t);return.5*i},map:function(t,e,i,r,n){return r+(n-r)*((t-e)/(i-e))},lerp:function(t,e,i){const r={x:e.x+t*(i.x-e.x),y:e.y+t*(i.y-e.y)};return void 0!==e.z&&void 0!==i.z&&(r.z=e.z+t*(i.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(utils.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,i){const r=e.x-t.x,n=e.y-t.y,s=i.x-t.x,o=i.y-t.y;return atan2(r*o-n*s,r*s+n*o)},round:function(t,e){const i=""+t,r=i.indexOf(".");return parseFloat(i.substring(0,r+1+e))},dist:function(t,e){const i=t.x-e.x,r=t.y-e.y;return sqrt$1(i*i+r*r)},closest:function(t,e){let i,r,n=pow(2,63);return t.forEach((function(t,s){r=utils.dist(e,t),r<n&&(n=r,i=s)})),{mdist:n,mpos:i}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=pow(t,e)+pow(1-t,e);return abs$1((i-1)/i)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const i=pow(1-t,e);return i/(pow(t,e)+i)},lli8:function(t,e,i,r,n,s,o,a){const l=(t-i)*(s-a)-(e-r)*(n-o);return 0!=l&&{x:((t*r-e*i)*(n-o)-(t-i)*(n*a-s*o))/l,y:((t*r-e*i)*(s-a)-(e-r)*(n*a-s*o))/l}},lli4:function(t,e,i,r){const n=t.x,s=t.y,o=e.x,a=e.y,l=i.x,c=i.y,h=r.x,u=r.y;return utils.lli8(n,s,o,a,l,c,h,u)},lli:function(t,e){return utils.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new Bezier(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=nMax,i=nMax,r=nMin,n=nMin;return t.forEach((function(t){const s=t.bbox();e>s.x.min&&(e=s.x.min),i>s.y.min&&(i=s.y.min),r<s.x.max&&(r=s.x.max),n<s.y.max&&(n=s.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:i,mid:(i+n)/2,max:n,size:n-i}}},shapeintersections:function(t,e,i,r,n){if(!utils.bboxoverlap(e,r))return[];const s=[],o=[t.startcap,t.forward,t.back,t.endcap],a=[i.startcap,i.forward,i.back,i.endcap];return o.forEach((function(e){e.virtual||a.forEach((function(r){if(r.virtual)return;const o=e.intersects(r,n);o.length>0&&(o.c1=e,o.c2=r,o.s1=t,o.s2=i,s.push(o))}))})),s},makeshape:function(t,e,i){const r=e.points.length,n=t.points.length,s=utils.makeline(e.points[r-1],t.points[0]),o=utils.makeline(t.points[n-1],e.points[0]),a={startcap:s,forward:t,back:e,endcap:o,bbox:utils.findbbox([s,t,e,o]),intersections:function(t){return utils.shapeintersections(a,a.bbox,t,t.bbox,i)}};return a},getminmax:function(t,e,i){if(!i)return{min:0,max:0};let r,n,s=nMax,o=nMin;-1===i.indexOf(0)&&(i=[0].concat(i)),-1===i.indexOf(1)&&i.push(1);for(let a=0,l=i.length;a<l;a++)r=i[a],n=t.get(r),n[e]<s&&(s=n[e]),n[e]>o&&(o=n[e]);return{min:s,mid:(s+o)/2,max:o,size:o-s}},align:function(t,e){const i=e.p1.x,r=e.p1.y,n=-atan2(e.p2.y-r,e.p2.x-i);return t.map((function(t){return{x:(t.x-i)*cos$1(n)-(t.y-r)*sin$1(n),y:(t.x-i)*sin$1(n)+(t.y-r)*cos$1(n)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const i=t.length-1,r=utils.align(t,e),n=function(t){return 0<=t&&t<=1};if(2===i){const t=r[0].y,e=r[1].y,i=r[2].y,s=t-2*e+i;if(0!==s){const r=-sqrt$1(e*e-t*i),o=-t+e;return[-(r+o)/s,-(-r+o)/s].filter(n)}return e!==i&&0===s?[(2*e-i)/(2*e-2*i)].filter(n):[]}const s=r[0].y,o=r[1].y,a=r[2].y;let l=3*o-s-3*a+r[3].y,c=3*s-6*o+3*a,h=-3*s+3*o,u=s;if(utils.approximately(l,0)){if(utils.approximately(c,0))return utils.approximately(h,0)?[]:[-u/h].filter(n);const t=sqrt$1(h*h-4*c*u),e=2*c;return[(t-h)/e,(-h-t)/e].filter(n)}c/=l,h/=l,u/=l;const d=(3*h-c*c)/3,p=d/3,f=(2*c*c*c-9*c*h+27*u)/27,_=f/2,m=_*_+p*p*p;let g,y,v,b,x;if(m<0){const t=-d/3,e=sqrt$1(t*t*t),i=-f/(2*e),r=acos$1(i<-1?-1:i>1?1:i),s=2*crt(e);return v=s*cos$1(r/3)-c/3,b=s*cos$1((r+tau)/3)-c/3,x=s*cos$1((r+2*tau)/3)-c/3,[v,b,x].filter(n)}if(0===m)return g=_<0?crt(-_):-crt(_),v=2*g-c/3,b=-g-c/3,[v,b].filter(n);{const t=sqrt$1(m);return g=crt(-_+t),y=crt(_+t),[g-y-c/3].filter(n)}},droots:function(t){if(3===t.length){const e=t[0],i=t[1],r=t[2],n=e-2*i+r;if(0!==n){const t=-sqrt$1(i*i-e*r),s=-e+i;return[-(t+s)/n,-(-t+s)/n]}return i!==r&&0===n?[(2*i-r)/(2*(i-r))]:[]}if(2===t.length){const e=t[0],i=t[1];return e!==i?[e/(e-i)]:[]}return[]},curvature:function(t,e,i,r,n){let s,o,a,l,c=0,h=0;const u=utils.compute(t,e),d=utils.compute(t,i),p=u.x*u.x+u.y*u.y;if(r?(s=sqrt$1(pow(u.y*d.z-d.y*u.z,2)+pow(u.z*d.x-d.z*u.x,2)+pow(u.x*d.y-d.x*u.y,2)),o=pow(p+u.z*u.z,1.5)):(s=u.x*d.y-u.y*d.x,o=pow(p,1.5)),0===s||0===o)return{k:0,r:0};if(c=s/o,h=o/s,!n){const n=utils.curvature(t-.001,e,i,r,!0).k,s=utils.curvature(t+.001,e,i,r,!0).k;l=(s-c+(c-n))/2,a=(abs$1(s-c)+abs$1(c-n))/2}return{k:c,r:h,dk:l,adk:a}},inflections:function(t){if(t.length<4)return[];const e=utils.align(t,{p1:t[0],p2:t.slice(-1)[0]}),i=e[2].x*e[1].y,r=e[3].x*e[1].y,n=e[1].x*e[2].y,s=18*(-3*i+2*r+3*n-e[3].x*e[2].y),o=18*(3*i-r-3*n),a=18*(n-i);if(utils.approximately(s,0)){if(!utils.approximately(o,0)){let t=-a/o;if(0<=t&&t<=1)return[t]}return[]}const l=2*s;if(utils.approximately(l,0))return[];const c=o*o-4*s*a;if(c<0)return[];const h=Math.sqrt(c);return[(h-o)/l,-(o+h)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const i=["x","y"],r=i.length;for(let n,s,o,a,l=0;l<r;l++)if(n=i[l],s=t[n].mid,o=e[n].mid,a=(t[n].size+e[n].size)/2,abs$1(s-o)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,i){const r=t.bbox(),n=e.bbox(),s=1e5,o=i||.5;if(r.x.size+r.y.size<o&&n.x.size+n.y.size<o)return[(s*(t._t1+t._t2)/2|0)/s+"/"+(s*(e._t1+e._t2)/2|0)/s];let a=t.split(.5),l=e.split(.5),c=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];c=c.filter((function(t){return utils.bboxoverlap(t.left.bbox(),t.right.bbox())}));let h=[];return 0===c.length||(c.forEach((function(t){h=h.concat(utils.pairiteration(t.left,t.right,o))})),h=h.filter((function(t,e){return h.indexOf(t)===e}))),h},getccenter:function(t,e,i){const r=e.x-t.x,n=e.y-t.y,s=i.x-e.x,o=i.y-e.y,a=r*cos$1(quart)-n*sin$1(quart),l=r*sin$1(quart)+n*cos$1(quart),c=s*cos$1(quart)-o*sin$1(quart),h=s*sin$1(quart)+o*cos$1(quart),u=(t.x+e.x)/2,d=(t.y+e.y)/2,p=(e.x+i.x)/2,f=(e.y+i.y)/2,_=u+a,m=d+l,g=p+c,y=f+h,v=utils.lli8(u,d,_,m,p,f,g,y),b=utils.dist(v,t);let x,T=atan2(t.y-v.y,t.x-v.x),C=atan2(e.y-v.y,e.x-v.x),S=atan2(i.y-v.y,i.x-v.x);return T<S?((T>C||C>S)&&(T+=tau),T>S&&(x=S,S=T,T=x)):S<C&&C<T?(x=S,S=T,T=x):S+=tau,v.s=T,v.e=S,v.r=b,v},numberSort:function(t,e){return t-e}};class PolyBezier{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return utils.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),i=1;i<t.length;i++)utils.expandbox(e,t[i].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(i){e.push(...i.offset(t))})),new PolyBezier(e)}}const{abs:abs,min:min,max:max,cos:cos,sin:sin,acos:acos,sqrt:sqrt}=Math,pi=Math.PI;class Bezier{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),i=!1;if("object"==typeof e[0]){i=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(i){void 0!==e[i]&&t.push(e[i])}))})),e=t}let r=!1;const n=e.length;if(i){if(i>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==n&&8!==n&&9!==n&&12!==n&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const s=this._3d=!r&&(9===n||12===n)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let d=0,p=s?3:2;d<n;d+=p){var a={x:e[d],y:e[d+1]};s&&(a.z=e[d+2]),o.push(a)}const l=this.order=o.length-1,c=this.dims=["x","y"];s&&c.push("z"),this.dimlen=c.length;const h=utils.align(o,{p1:o[0],p2:o[l]}),u=utils.dist(o[0],o[l]);this._linear=h.reduce(((t,e)=>t+abs(e.y)),0)<u/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,i,r){if(void 0===r&&(r=.5),0===r)return new Bezier(e,e,i);if(1===r)return new Bezier(t,e,e);const n=Bezier.getABC(2,t,e,i,r);return new Bezier(t,n.A,i)}static cubicFromPoints(t,e,i,r,n){void 0===r&&(r=.5);const s=Bezier.getABC(3,t,e,i,r);void 0===n&&(n=utils.dist(e,s.C));const o=n*(1-r)/r,a=utils.dist(t,i),l=(i.x-t.x)/a,c=(i.y-t.y)/a,h=n*l,u=n*c,d=o*l,p=o*c,f=e.x-h,_=e.y-u,m=e.x+d,g=e.y+p,y=s.A,v=y.x+(f-y.x)/(1-r),b=y.y+(_-y.y)/(1-r),x=y.x+(m-y.x)/r,T=y.y+(g-y.y)/r,C={x:t.x+(v-t.x)/r,y:t.y+(b-t.y)/r},S={x:i.x+(x-i.x)/(1-r),y:i.y+(T-i.y)/(1-r)};return new Bezier(t,C,S,i)}static getUtils(){return utils}getUtils(){return Bezier.getUtils()}static get PolyBezier(){return PolyBezier}valueOf(){return this.toString()}toString(){return utils.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let i=1,r=t.length;i<r;i++)e.push(t[i].x),e.push(t[i].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=utils.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=utils.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return utils.length(this.derivative.bind(this))}static getABC(t=2,e,i,r,n=.5){const s=utils.projectionratio(n,t),o=1-s,a={x:s*e.x+o*r.x,y:s*e.y+o*r.y},l=utils.abcratio(n,t);return{A:{x:i.x+(i.x-a.x)/l,y:i.y+(i.y-a.y)/l},B:i,C:a,S:e,E:r}}getABC(t,e){e=e||this.get(t);let i=this.points[0],r=this.points[this.order];return Bezier.getABC(this.order,i,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t+1)return this._lut;this._lut=[],t++,this._lut=[];for(let e,i,r=0;r<t;r++)i=r/(t-1),e=this.compute(i),e.t=i,this._lut.push(e);return this._lut}on(e,i){i=i||5;const r=this.getLUT(),n=[];for(let t,s=0,o=0;s<r.length;s++)t=r[s],utils.dist(t,e)<i&&(n.push(t),o+=s/r.length);return!!n.length&&(t/=n.length)}project(t){const e=this.getLUT(),i=e.length-1,r=utils.closest(e,t),n=r.mpos,s=(n-1)/i,o=(n+1)/i,a=.1/i;let l,c=r.mdist,h=s,u=h;c+=1;for(let d;h<o+a;h+=a)l=this.compute(h),d=utils.dist(t,l),d<c&&(c=d,u=h);return u=u<0?0:u>1?1:u,l=this.compute(u),l.t=u,l.d=c,l}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?utils.computeWithRatios(t,this.points,this.ratios,this._3d):utils.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],i=t.length;for(let r,n,s=1;s<i;s++)r=t[s],n=t[s-1],e[s]={x:(i-s)/i*r.x+s/i*n.x,y:(i-s)/i*r.y+s/i*n.y};return e[i]=t[i-1],new Bezier(e)}derivative(t){return utils.compute(t,this.dpoints[0],this._3d)}dderivative(t){return utils.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new Bezier(utils.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return utils.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return utils.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),i=sqrt(e.x*e.x+e.y*e.y);return{t:t,x:-e.y/i,y:e.x/i}}__normal3(t){const e=this.derivative(t),i=this.derivative(t+.01),r=sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=sqrt(i.x*i.x+i.y*i.y+i.z*i.z);e.x/=r,e.y/=r,e.z/=r,i.x/=n,i.y/=n,i.z/=n;const s={x:i.y*e.z-i.z*e.y,y:i.z*e.x-i.x*e.z,z:i.x*e.y-i.y*e.x},o=sqrt(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=o,s.y/=o,s.z/=o;const a=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{t:t,x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,i=[],r=[],n=0;for(r[n++]=e[0],r[n++]=e[1],r[n++]=e[2],3===this.order&&(r[n++]=e[3]);e.length>1;){i=[];for(let s,o=0,a=e.length-1;o<a;o++)s=utils.lerp(t,e[o],e[o+1]),r[n++]=s,i.push(s);e=i}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const i=this.hull(t),r={left:2===this.order?new Bezier([i[0],i[3],i[5]]):new Bezier([i[0],i[4],i[7],i[9]]),right:2===this.order?new Bezier([i[5],i[4],i[2]]):new Bezier([i[9],i[8],i[6],i[3]]),span:i};return r.left._t1=utils.map(0,0,1,this._t1,this._t2),r.left._t2=utils.map(t,0,1,this._t1,this._t2),r.right._t1=utils.map(t,0,1,this._t1,this._t2),r.right._t2=utils.map(1,0,1,this._t1,this._t2),e?(e=utils.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(i){let r=function(t){return t[i]},n=this.dpoints[0].map(r);t[i]=utils.droots(n),3===this.order&&(n=this.dpoints[1].map(r),t[i]=t[i].concat(utils.droots(n))),t[i]=t[i].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[i].sort(utils.numberSort))}.bind(this)),t.values=e.sort(utils.numberSort).filter((function(t,i){return e.indexOf(t)===i})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(i){e[i]=utils.getminmax(this,i,t[i])}.bind(this)),e}overlaps(t){const e=this.bbox(),i=t.bbox();return utils.bboxoverlap(e,i)}offset(t,e){if(void 0!==e){const i=this.get(t),r=this.normal(t),n={c:i,n:r,x:i.x+r.x*e,y:i.y+r.y*e};return this._3d&&(n.z=i.z+r.z*e),n}if(this._linear){const e=this.normal(0),i=this.points.map((function(i){const r={x:i.x+t*e.x,y:i.y+t*e.y};return i.z&&e.z&&(r.z=i.z+t*e.z),r}));return[new Bezier(i)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=utils.angle(this.points[0],this.points[3],this.points[1]),e=utils.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let i=t.x*e.x+t.y*e.y;return this._3d&&(i+=t.z*e.z),abs(acos(i))<pi/3}reduce(){let t,e,i=0,r=0,n=.01,s=[],o=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),i=a[0],t=1;t<a.length;t++)r=a[t],e=this.split(i,r),e._t1=i,e._t2=r,s.push(e),i=r;return s.forEach((function(t){for(i=0,r=0;r<=1;)for(r=i+n;r<=1.01;r+=n)if(e=t.split(i,r),!e.simple()){if(r-=n,abs(i-r)<n)return[];e=t.split(i,r),e._t1=utils.map(i,0,1,t._t1,t._t2),e._t2=utils.map(r,0,1,t._t1,t._t2),o.push(e),i=r;break}i<1&&(e=t.split(i,1),e._t1=utils.map(i,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}translate(t,e,i){i="number"==typeof i?i:e;const r=this.order;let n=this.points.map(((t,n)=>(1-n/r)*e+n/r*i));return new Bezier(this.points.map(((e,i)=>({x:e.x+t.x*n[i],y:e.y+t.y*n[i]}))))}scale(t){const e=this.order;let i=!1;if("function"==typeof t&&(i=t),i&&2===e)return this.raise().scale(i);const r=this.clockwise,n=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):t,i?i(1):t);const s=i?i(0):t,o=i?i(1):t,a=[this.offset(0,10),this.offset(1,10)],l=[],c=utils.lli4(a[0],a[0].c,a[1],a[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const i=l[t*e]=utils.copy(n[t*e]);i.x+=(t?o:s)*a[t].n.x,i.y+=(t?o:s)*a[t].n.y})),i?([0,1].forEach((function(s){if(2!==e||!s){var o=n[s+1],a={x:o.x-c.x,y:o.y-c.y},h=i?i((s+1)/e):t;i&&!r&&(h=-h);var u=sqrt(a.x*a.x+a.y*a.y);a.x/=u,a.y/=u,l[s+1]={x:o.x+h*a.x,y:o.y+h*a.y}}})),new Bezier(l)):([0,1].forEach((t=>{if(2===e&&t)return;const i=l[t*e],r=this.derivative(t),s={x:i.x+r.x,y:i.y+r.y};l[t+1]=utils.lli4(i,s,c,n[t+1])})),new Bezier(l))}outline(t,e,i,r){if(e=void 0===e?t:e,this._linear){const n=this.normal(0),s=this.points[0],o=this.points[this.points.length-1];let a,l,c;void 0===i&&(i=t,r=e),a={x:s.x+n.x*t,y:s.y+n.y*t},c={x:o.x+n.x*i,y:o.y+n.y*i},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const h=[a,l,c];a={x:s.x-n.x*e,y:s.y-n.y*e},c={x:o.x-n.x*r,y:o.y-n.y*r},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const u=[c,l,a],d=utils.makeline(u[2],h[0]),p=utils.makeline(h[2],u[0]),f=[d,new Bezier(h),p,new Bezier(u)];return new PolyBezier(f)}const n=this.reduce(),s=n.length,o=[];let a,l=[],c=0,h=this.length();const u=void 0!==i&&void 0!==r;function d(t,e,i,r,n){return function(s){const o=r/i,a=(r+n)/i,l=e-t;return utils.map(s,0,1,t+o*l,t+a*l)}}n.forEach((function(n){const s=n.length();u?(o.push(n.scale(d(t,i,h,c,s))),l.push(n.scale(d(-e,-r,h,c,s)))):(o.push(n.scale(t)),l.push(n.scale(-e))),c+=s})),l=l.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const p=o[0].points[0],f=o[s-1].points[o[s-1].points.length-1],_=l[s-1].points[l[s-1].points.length-1],m=l[0].points[0],g=utils.makeline(_,p),y=utils.makeline(f,m),v=[g].concat(o).concat([y]).concat(l);return new PolyBezier(v)}outlineshapes(t,e,i){e=e||t;const r=this.outline(t,e).curves,n=[];for(let s=1,o=r.length;s<o/2;s++){const t=utils.makeshape(r[s],r[o-s],i);t.startcap.virtual=s>1,t.endcap.virtual=s<o/2-1,n.push(t)}return n}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof Bezier&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=min(t.p1.x,t.p2.x),i=min(t.p1.y,t.p2.y),r=max(t.p1.x,t.p2.x),n=max(t.p1.y,t.p2.y);return utils.roots(this.points,t).filter((t=>{var s=this.get(t);return utils.between(s.x,e,r)&&utils.between(s.y,i,n)}))}selfintersects(t){const e=this.reduce(),i=e.length-2,r=[];for(let n,s,o,a=0;a<i;a++)s=e.slice(a,a+1),o=e.slice(a+2),n=this.curveintersects(s,o,t),r.push(...n);return r}curveintersects(t,e,i){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let n=[];return r.forEach((function(t){const e=utils.pairiteration(t.left,t.right,i);e.length>0&&(n=n.concat(e))})),n}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,i,r){const n=(r-i)/4,s=this.get(i+n),o=this.get(r-n),a=utils.dist(t,e),l=utils.dist(t,s),c=utils.dist(t,o);return abs(l-a)+abs(c-a)}_iterate(t,e){let i,r=0,n=1;do{i=0,n=1;let s,o,a,l,c,h=this.get(r),u=!1,d=!1,p=n,f=1;do{if(d=u,l=a,p=(r+n)/2,s=this.get(p),o=this.get(n),a=utils.getccenter(h,s,o),a.interval={start:r,end:n},u=this._error(a,h,r,n)<=t,c=d&&!u,c||(f=n),u){if(n>=1){if(a.interval.end=f=1,l=a,n>1){let t={x:a.x+a.r*cos(a.e),y:a.y+a.r*sin(a.e)};a.e+=utils.angle({x:a.x,y:a.y},t,this.get(1))}break}n+=(n-r)/2}else n=p}while(!c&&i++<100);if(i>=100)break;l=l||a,e.push(l),r=f}while(n<1);return e}}class curveWidget extends BaseWidget{get height(){return this._height||100}computeLayoutSize(t){var e=t.width-30;let i=this.options.viewHeight/this.options.viewWidth*e;return this._height=i,{minHeight:i+4,maxHeight:i+4,minWidth:e,maxWidth:e}}constructor(t){super(t),this.type="curve",this.value=t.value,this.options=t.options,this.selectPoint=-1}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.strokeStyle,o=t.fillStyle,a=t.font,l=t.textAlign,c=t.textBaseline;let h=[];for(var u=0;u<this.value.length;u++)h.push({x:this.value[u],y:this.value[u+1]}),u+=1;let d=[];for(u=0;u<h.length;u++)d.push(h[u].x),d.push(h[u].y);var p=new Bezier(this.value);i-=2*n;var f=this.options.viewHeight/this.options.viewWidth*i;t.fillStyle=this.background_color,t.fillRect(n,e,i,f),t.strokeStyle=this.outline_color,t.beginPath(),t.rect(n,e,i,f),t.stroke(),t.save(),t.clip();this.value.x,this.value.y;this.options.viewWidth,this.options.viewHeight;var _=.5*i,m=.5*f,g=t=>n+i/this.options.viewWidth*t+_,y=t=>e+f/this.options.viewHeight*t*-1+m;t.restore(),t.fillStyle="#1568DD",t.beginPath();for(var v=0;v<=1;v+=.01){var b=p.get(v);0==v?t.moveTo(g(b.x),y(b.y)):t.lineTo(g(b.x),y(b.y))}t.stroke(),t.strokeStyle="#FFFFFF";var x=e=>{var i=h[e];0==e?t.fillStyle="#7AFF16":e==h.length-1?t.fillStyle="#FF1616":t.fillStyle="#1568DD",t.beginPath(),t.arc(g(i.x),y(i.y),4,0,360),t.fill(),0!=e&&e!=h.length-1&&r&&(t.fillStyle="#FFFFFF",t.textAlign="center",t.textBaseline="middle",t.font="8px Arial",t.fillText(e+"",g(i.x),y(i.y)+1)),this.selectPoint==e&&t.stroke()};for(u=0;u<h.length;u++)x(u);t.textAlign=l,t.textBaseline=c,t.font=a,t.strokeStyle=s,t.fillStyle=o}remonveCtrlPoint(t){if(6!=this.value.length){if(this.selectPoint>=0){var e=2*this.selectPoint;this.value.splice(e,2),this.selectPoint=-1,null!=t&&t.onWidgetChanged?.(this.name??"",this.value,null,this)}}else console.log("至少要有3个控制点生成曲线！")}addCtrlPoint(t){if(this.selectPoint>0){var e=2*this.selectPoint;this.value.splice(this.selectPoint,0,this.value[e]+30,this.value[e+1]+30)}else this.value.push(0),this.value.push(0);null!=t&&t.onWidgetChanged?.(this.name??"",this.value,null,this)}dealTouch(t,e){if(this.options.read_only)return;const{e:i,node:r}=t,n=this.width||r.size[0],s=(i.canvasX-r.pos[0]-15)/(n-30),o=(i.canvasY-this.y-r.pos[1])/this.height;let a=(s-.5)*this.options.viewWidth,l=(o-.5)*this.options.viewHeight*-1;var c=4/(n/this.options.viewWidth);let h=[];for(var u=0;u<this.value.length;u++)h.push({x:this.value[u],y:this.value[u+1],i:u}),u+=1;var d=-1;for(u=0;u<h.length;u++){var p=h[u].x-a,f=h[u].y-l;if(Math.sqrt(p*p+f*f)<c){console.log("点击了第几个点？",u),d=u;break}}-1!=d&&this.selectPoint!=d&&(this.selectPoint=d),this.selectPoint>=0&&(h[this.selectPoint].x=a,h[this.selectPoint].y=l,this.value[h[this.selectPoint].i]=a,this.value[h[this.selectPoint].i+1]=l,r.onWidgetChanged?.(this.name??"",this.value,null,this)),r.graph&&r.graph._version++}onClick(t){this.dealTouch(t,!0)}onDrag(t){this.dealTouch(t,!1)}}class LinkNodeWidget extends BaseWidget{constructor(t){super(t),this.type="linknode",this.clicked=t.clicked??!1}drawWidget(t,{y:e,width:i,show_text:r=!0,margin:n=15}){const s=t.textAlign,o=t.strokeStyle,a=t.fillStyle,{height:l}=this;let c=i-2*n,h=0;var u=i=>{t.fillStyle=this.background_color,this.clickeName==i&&(t.fillStyle="#AAA",this.clickeName=""),t.fillRect(n+h,e,c,l),r&&!this.computedDisabled&&(t.strokeStyle=this.outline_color,t.strokeRect(n+h,e,c,l)),r&&(t.textAlign="center",t.fillStyle=this.text_color,t.fillText(i,.5*c+h+n,e+.7*l)),h+=c+2};if(null!=this.options.buttons){c/=this.options.buttons.length,c-=2;for(var d=0;d<this.options.buttons.length;d++)u(this.options.buttons[d])}else u(this.label||this.name||"");t.textAlign=s,t.strokeStyle=o,t.fillStyle=a}onClick(t){const{e:e,node:i,canvas:r}=t,n=r.graph_mouse,s=e.canvasX-i.pos[0];e.canvasY,this.y,i.pos[1];const{height:o}=this;let a=(this.width||i.size[0])-30;if(null!=this.options.buttons){a=a/this.options.buttons.length-2,this.clickeName="";for(var l=0;l<this.options.buttons.length;l++){if(a*l+15+2*l<s&&s<a*(l+1)+15+2*l){this.clickeName=this.options.buttons[l];break}}}else this.clickeName=this.label||this.name||"";this.clicked=!0,r.setDirty(!0),this.callback?.(this,r,i,n,e)}}const WIDGET_TYPE_MAP={button:ButtonWidget,toggle:BooleanWidget,slider:SliderWidget,knob:KnobWidget,combo:ComboWidget,number:NumberWidget,string:TextWidget,text:TextWidget,ccnode:ccNodeWidget,curve:curveWidget,linknode:LinkNodeWidget};class LGraphNode{constructor(t,e){this.graph=null,this.type="",this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={},this.order=0,this.mode=LGraphEventMode.ALWAYS,this.badges=[],this.badgePosition=BadgePosition.TopLeft,this.#y=new Float32Array(4),this.#v=new Float32Array(4),this._posSize=new Float32Array(4),this._pos=this._posSize.subarray(0,2),this._size=this._posSize.subarray(2,4),this.id=LiteGraph.use_uuids?LiteGraph.uuidv4():-1,this.title=t||"Unnamed",this.type=e??"",this.size=[LiteGraph.NODE_WIDTH,60],this.pos=[10,10],this.strokeStyles={error:this.#b,selected:this.#x}}static#c=(()=>this.keepAllLinksOnBypass=!1)();get titleFontStyle(){return`${LiteGraph.NODE_TEXT_SIZE}px Arial`}get innerFontStyle(){return`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`}get renderingColor(){return this.color||this.constructor.color||LiteGraph.NODE_DEFAULT_COLOR}get renderingBgColor(){return this.bgcolor||this.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR}get renderingBoxColor(){if(this.boxcolor)return this.boxcolor;if(LiteGraph.node_box_coloured_when_on){if(this.action_triggered)return"#FFF";if(this.execute_triggered)return"#AAA"}if(LiteGraph.node_box_coloured_by_mode){const t=LiteGraph.NODE_MODES_COLORS[this.mode??LGraphEventMode.ALWAYS];if(t)return t}return LiteGraph.NODE_DEFAULT_BOXCOLOR}setColorOption(t){null==t?(delete this.color,delete this.bgcolor):(this.color=t.color,this.bgcolor=t.bgcolor)}getColorOption(){return Object.values(LGraphCanvas.node_colors).find((t=>t.color===this.color&&t.bgcolor===this.bgcolor))??null}#y;get renderArea(){return this.#y}#v;get boundingRect(){return this.#v}get pos(){return this._pos}set pos(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])}get size(){return this._size}set size(t){!t||t.length<2||(this._size[0]=t[0],this._size[1]=t[1])}get renderingSize(){return this.flags.collapsed?[this._collapsed_width??0,0]:this._size}get shape(){return this._shape}set shape(t){switch(t){case"default":delete this._shape;break;case"box":this._shape=RenderShape.BOX;break;case"round":this._shape=RenderShape.ROUND;break;case"circle":this._shape=RenderShape.CIRCLE;break;case"card":this._shape=RenderShape.CARD;break;default:this._shape=t}}get renderingShape(){return this._shape||this.constructor.shape||LiteGraph.NODE_DEFAULT_SHAPE}get is_selected(){return this.selected}set is_selected(t){this.selected=t}get title_mode(){return this.constructor.title_mode??TitleMode.NORMAL_TITLE}#b(){if(this.has_errors)return{padding:12,lineWidth:10,color:LiteGraph.NODE_ERROR_COLOUR}}#x(){if(this.selected)return{padding:this.has_errors?20:void 0}}getRealLinkNode(){var t=this.getInputLink(0);if(null==t)return null;if(1!=this.graph._is_subgraph)return this.graph.getNodeById(t.origin_id);{let e=this.graph.getNodeById(t.origin_id),i=this.graph._subgraph_node.inputs.findIndex((t=>t.name==e.properties.name));if(-1!=i){let t=this.graph._subgraph_node.getInputLink(i);return null==t?null:this.graph._subgraph_node.graph.getNodeById(t.origin_id)}}}getIdWithGraph(){return null==this.graph?this.id:null!=this.graph._subgraph_node?this.id+"_"+this.graph._subgraph_node.id:this.id}configure(t){this.graph&&this.graph._version++;for(const e in t)if("properties"!=e)null!=t[e]&&("object"==typeof t[e]?this[e]?.configure?this[e]?.configure(t[e]):this[e]=LiteGraph.cloneObject(t[e],this[e]):this[e]=t[e]);else for(const i in t.properties)this.properties[i]=t.properties[i],this.onPropertyChanged?.(i,t.properties[i]);t.title||(this.title=this.constructor.title),this.inputs??=[],this.inputs=this.inputs.map((t=>toClass(NodeInputSlot,t)));for(const[e,i]of this.inputs.entries()){const t=this.graph&&null!=i.link?this.graph._links.get(i.link):null;this.onConnectionsChange?.(NodeSlotType.INPUT,e,!0,t,i),this.onInputAdded?.(i)}this.outputs??=[],this.outputs=this.outputs.map((t=>toClass(NodeOutputSlot,t)));for(const[e,i]of this.outputs.entries())if(i.links){for(const t of i.links){const r=this.graph?this.graph._links.get(t):null;this.onConnectionsChange?.(NodeSlotType.OUTPUT,e,!0,r,i)}this.onOutputAdded?.(i)}if(this.widgets){for(const t of this.widgets)t&&t.options?.property&&null!=this.properties[t.options.property]&&(t.value=JSON.parse(JSON.stringify(this.properties[t.options.property])));if(t.widgets_values)for(let e=0;e<t.widgets_values.length;++e){const i=this.widgets[e];i&&(i.value=t.widgets_values[e])}}this.pinned&&(this.resizable=!1),this.onConfigure?.(t)}serialize(){const t={id:this.id,type:this.type,pos:[this.pos[0],this.pos[1]],size:[this.size[0],this.size[1]],flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode,showAdvanced:this.showAdvanced};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;this.inputs&&(t.inputs=this.inputs.map((t=>inputAsSerialisable(t)))),this.outputs&&(t.outputs=this.outputs.map((t=>outputAsSerialisable(t)))),this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties));const{widgets:e}=this;if(e&&this.serialize_widgets){t.widgets_values=[];for(const[i,r]of e.entries())t.widgets_values[i]=r?r.value:null}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize?.(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t}clone(){if(null==this.type)return null;const t=LiteGraph.createNode(this.type);if(!t)return null;const e=LiteGraph.cloneObject(this.serialize()),{inputs:i,outputs:r}=e;if(i)for(const n of i)n.link=null;if(r)for(const{links:n}of r)n&&(n.length=0);return delete e.id,LiteGraph.use_uuids&&(e.id=LiteGraph.uuidv4()),t.configure(e),t}onGetOutputs(){return[["被引用","lgraphNode"]]}toString(){return JSON.stringify(this.serialize())}getTitle(){return this.title||this.constructor.title}setProperty(t,e){if(this.properties||={},e===this.properties[t])return;const i=this.properties[t];if(this.properties[t]=e,!1===this.onPropertyChanged?.(t,e,i)&&(this.properties[t]=i),this.widgets)for(const r of this.widgets)if(r&&r.options.property==t){r.value=e;break}}setOutputData(t,e){const{outputs:i}=this;if(!i)return;if(-1==t||t>=i.length)return;const r=i[t];if(!r)return;if(r._data=e,!this.graph)throw new NullGraphError;const{links:n}=i[t];if(n)for(const s of n){const t=this.graph._links.get(s);t&&(t.data=e)}}setOutputDataType(t,e){const{outputs:i}=this;if(!i||-1==t||t>=i.length)return;const r=i[t];if(!r)return;if(r.type=e,!this.graph)throw new NullGraphError;const{links:n}=i[t];if(n)for(const s of n){const t=this.graph._links.get(s);t&&(t.type=e)}}getInputData(t,e){if(!this.inputs)return;if(t>=this.inputs.length||null==this.inputs[t].link)return;if(!this.graph)throw new NullGraphError;const i=this.inputs[t].link,r=this.graph._links.get(i);if(!r)return null;if(!e)return r.data;const n=this.graph.getNodeById(r.origin_id);return n?(n.updateOutputData?n.updateOutputData(r.origin_slot):n.onExecute?.(),r.data):r.data}getInputDataType(t){if(!this.inputs)return null;if(t>=this.inputs.length||null==this.inputs[t].link)return null;if(!this.graph)throw new NullGraphError;const e=this.inputs[t].link,i=this.graph._links.get(e);if(!i)return null;const r=this.graph.getNodeById(i.origin_id);if(!r)return i.type;const n=r.outputs[i.origin_slot];return n?n.type:null}getInputDataByName(t,e){const i=this.findInputSlot(t);return-1==i?null:this.getInputData(i,e)}isInputConnected(t){return!!this.inputs&&(t<this.inputs.length&&null!=this.inputs[t].link)}getInputInfo(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null}getInputLink(t){if(!this.inputs)return null;if(t<this.inputs.length){if(!this.graph)throw new NullGraphError;const e=this.inputs[t];if(null!=e.link)return this.graph._links.get(e.link)??null}return null}isAnyInputConnected(){if(!this.inputs)return!1;let t=!1;for(var e=0;e<this.inputs.length;e++){if(null!=this.inputs[e].link){t=!0;break}}return t}getInputNode(t){if(!this.inputs)return null;if(t>=this.inputs.length)return null;const e=this.inputs[t];if(!e||null===e.link)return null;if(!this.graph)throw new NullGraphError;const i=this.graph._links.get(e.link);return i?this.graph.getNodeById(i.origin_id):null}getInputOrProperty(t){const{inputs:e}=this;if(!e?.length)return this.properties?this.properties[t]:null;if(!this.graph)throw new NullGraphError;for(const i of e)if(t==i.name&&null!=i.link){const t=this.graph._links.get(i.link);if(t)return t.data}return this.properties[t]}getOutputData(t){if(!this.outputs)return null;if(t>=this.outputs.length)return null;return this.outputs[t]._data}getOutputInfo(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null}isOutputConnected(t){return!!this.outputs&&(t<this.outputs.length&&Number(this.outputs[t].links?.length)>0)}isAnyOutputConnected(){const{outputs:t}=this;if(!t)return!1;for(const e of t)if(e.links?.length)return!0;return!1}getOutputNodes(t){const{outputs:e}=this;if(!e||0==e.length)return null;if(t>=e.length)return null;const{links:i}=e[t];if(!i||0==i.length)return null;if(!this.graph)throw new NullGraphError;const r=[];for(const n of i){const t=this.graph._links.get(n);if(t){const e=this.graph.getNodeById(t.target_id);e&&r.push(e)}}return r}addOnTriggerInput(){const t=this.findInputSlot("onTrigger");return-1==t?(this.addInput("onTrigger",LiteGraph.EVENT,{nameLocked:!0}),this.findInputSlot("onTrigger")):t}addOnExecutedOutput(){const t=this.findOutputSlot("onExecuted");return-1==t?(this.addOutput("onExecuted",LiteGraph.ACTION,{nameLocked:!0}),this.findOutputSlot("onExecuted")):t}removeOnTriggerInput(){const t=this.findInputSlot("onTrigger");-1!=t&&this.removeInput(t)}removeOnExecutedOutput(){const t=this.findOutputSlot("onExecuted");-1!=t&&this.removeOutput(t)}onAfterExecuteNode(t,e){const i=this.findOutputSlot("onExecuted");-1!=i&&this.triggerSlot(i,t,null,e)}changeMode(t){return t==LGraphEventMode.ON_TRIGGER?(this.addOnTriggerInput(),this.addOnExecutedOutput()):(this.removeOnTriggerInput(),this.removeOnExecutedOutput()),this.mode=t,!0}doExecute(t,e){if(e=e||{},this.onExecute){if(e.action_call||=`${this.id}_exec_${Math.floor(9999*Math.random())}`,!this.graph)throw new NullGraphError;this.graph.nodes_executing[this.id]=!0,this.onExecute(t,e),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,e?.action_call&&(this.action_call=e.action_call,this.graph.nodes_executedAction[this.id]=e.action_call)}this.execute_triggered=2,this.onAfterExecuteNode?.(t,e)}actionDo(t,e,i){if(i=i||{},this.onAction){if(i.action_call||=`${this.id}_${t||"action"}_${Math.floor(9999*Math.random())}`,!this.graph)throw new NullGraphError;this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,e,i),this.graph.nodes_actioning[this.id]=!1,i?.action_call&&(this.action_call=i.action_call,this.graph.nodes_executedAction[this.id]=i.action_call)}this.action_triggered=2,this.onAfterExecuteNode?.(e,i)}trigger(t,e,i){const{outputs:r}=this;if(r&&r.length){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(const[n,s]of r.entries())!s||s.type!==LiteGraph.EVENT||t&&s.name!=t||this.triggerSlot(n,e,null,i)}}triggerSlot(t,e,i,r){if(r=r||{},!this.outputs)return;if(null==t)return void console.error("slot must be a number");"number"!=typeof t&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");const n=this.outputs[t];if(!n)return;const s=n.links;if(s&&s.length){if(!this.graph)throw new NullGraphError;this.graph._last_trigger_time=LiteGraph.getTime();for(const t of s){if(null!=i&&i!=t)continue;const n=this.graph._links.get(t);if(!n)continue;n._last_time=LiteGraph.getTime();const s=this.graph.getNodeById(n.target_id);if(s)if(s.mode===LGraphEventMode.ON_TRIGGER)r.action_call||(r.action_call=`${this.id}_trigg_${Math.floor(9999*Math.random())}`),s.doExecute?.(e,r);else if(s.onAction){r.action_call||(r.action_call=`${this.id}_act_${Math.floor(9999*Math.random())}`);const t=s.inputs[n.target_slot];s.actionDo(t.name,e,r)}}}}clearTriggeredSlot(t,e){if(!this.outputs)return;const i=this.outputs[t];if(!i)return;const r=i.links;if(r&&r.length){if(!this.graph)throw new NullGraphError;for(const t of r){if(null!=e&&e!=t)continue;const i=this.graph._links.get(t);i&&(i._last_time=0)}}}setSize(t){this.size=t,this.onResize?.(this.size)}expandToFitContent(){const t=this.computeSize();this.setSize([Math.max(this.size[0],t[0]),Math.max(this.size[1],t[1])])}addProperty(t,e,i,r){const n={name:t,type:i,default_value:e};return r&&Object.assign(n,r),this.properties_info||=[],this.properties_info.push(n),this.properties||={},this.properties[t]=e,n}addOutput(t,e,i){const r=new NodeOutputSlot({name:t,type:e,links:null});return i&&Object.assign(r,i),this.outputs||=[],this.outputs.push(r),this.onOutputAdded?.(r),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e,!0),this.expandToFitContent(),this.setDirtyCanvas(!0,!0),r}addOutputs(t){for(const e of t){const i=new NodeOutputSlot({name:e[0],type:e[1],links:null});t[2]&&Object.assign(i,e[2]),this.outputs||=[],this.outputs.push(i),this.onOutputAdded?.(i),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e[1],!0)}this.expandToFitContent(),this.setDirtyCanvas(!0,!0)}removeOutput(t){this.disconnectOutput(t);const{outputs:e}=this;e.splice(t,1);for(let i=t;i<e.length;++i){const t=e[i];if(t&&t.links)for(const e of t.links){if(!this.graph)throw new NullGraphError;const t=this.graph._links.get(e);t&&t.origin_slot--}}this.onOutputRemoved?.(t),this.setDirtyCanvas(!0,!0)}addInput(t,e,i){const r=new NodeInputSlot({name:t,type:e=e||0,link:null});return i&&Object.assign(r,i),this.inputs||=[],this.inputs.push(r),this.expandToFitContent(),this.onInputAdded?.(r),LiteGraph.registerNodeAndSlotType(this,e),this.setDirtyCanvas(!0,!0),r}addInputs(t){for(const e of t){const i=new NodeInputSlot({name:e[0],type:e[1],link:null});t[2]&&Object.assign(i,e[2]),this.inputs||=[],this.inputs.push(i),this.onInputAdded?.(i),LiteGraph.registerNodeAndSlotType(this,e[1])}this.expandToFitContent(),this.setDirtyCanvas(!0,!0)}removeInput(t){this.disconnectInput(t,!0);const{inputs:e}=this,i=e.splice(t,1);for(let r=t;r<e.length;++r){const t=e[r];if(!t?.link)continue;if(!this.graph)throw new NullGraphError;const i=this.graph._links.get(t.link);i&&i.target_slot--}this.onInputRemoved?.(t,i[0]),this.setDirtyCanvas(!0,!0)}addConnection(t,e,i,r){const n={name:t,type:e,pos:i,direction:r,links:null};return this.connections.push(n),n}computeSize(t){const e=this.constructor.size;if(e)return[e[0],e[1]];const{inputs:i,outputs:r}=this;let n=Math.max(i?i.filter((t=>!isWidgetInputSlot(t))).length:1,r?r.length:1);const s=t||new Float32Array([0,0]);n=Math.max(n,1);const o=LiteGraph.NODE_TEXT_SIZE,a=u(this.title);let l=0,c=0;if(i)for(const d of i){const t=u(d.label||d.localized_name||d.name||"");l<t&&(l=t)}if(r)for(const d of r){const t=u(d.label||d.localized_name||d.name||"");c<t&&(c=t)}s[0]=Math.max(l+c+10,a),s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH),this.widgets?.length&&(s[0]=Math.max(s[0],1.5*LiteGraph.NODE_WIDTH)),s[1]=(this.constructor.slot_start_y||0)+n*LiteGraph.NODE_SLOT_HEIGHT;let h=0;if(this.widgets?.length){for(const t of this.widgets){if(!this.isWidgetVisible(t))continue;let e=0;t.computeSize?e+=t.computeSize(s[0])[1]:t.computeLayoutSize?e+=t.computeLayoutSize(this).minHeight:e+=LiteGraph.NODE_WIDGET_HEIGHT,h+=e+4}h+=8}function u(t){return t?o*t.length*.6:0}return this.widgets_up?s[1]=Math.max(s[1],h):null!=this.widgets_start_y?s[1]=Math.max(s[1],h+this.widgets_start_y):s[1]+=h,this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s}inResizeCorner(t,e){const i=this.outputs?this.outputs.length:1,r=(this.constructor.slot_start_y||0)+i*LiteGraph.NODE_SLOT_HEIGHT;return isInRectangle(t,e,this.pos[0]+this.size[0]-15,this.pos[1]+Math.max(this.size[1]-15,r),20,20)}getPropertyInfo(t){let e=null;const{properties_info:i}=this;if(i)for(const r of i)if(r.name==t){e=r;break}return this.constructor[`@${t}`]&&(e=this.constructor[`@${t}`]),this.constructor.widgets_info?.[t]&&(e=this.constructor.widgets_info[t]),!e&&this.onGetPropertyInfo&&(e=this.onGetPropertyInfo(t)),e||={},e.type||=typeof this.properties[t],"combo"==e.widget&&(e.type="enum"),e}addWidget(t,e,i,r,n){this.widgets||=[],!n&&r&&"object"==typeof r&&(n=r,r=null),n||={},"string"==typeof n&&(n={property:n}),r&&"string"==typeof r&&(n.property=r,r=null);const s={type:t.toLowerCase(),name:e,value:i,callback:"function"!=typeof r?void 0:r,options:n,y:0};if(void 0!==s.options.y&&(s.y=s.options.y),r||s.options.callback||s.options.property||console.warn("LiteGraph addWidget(...) without a callback or property assigned"),"combo"==t&&!s.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";const o=this.addCustomWidget(s);return this.expandToFitContent(),o}addCustomWidget(t){this.widgets||=[];const e=WIDGET_TYPE_MAP[t.type],i=e?new e(t):t;return this.widgets.push(i),i}move(t,e){this.pinned||(this.pos[0]+=t,this.pos[1]+=e)}measure(t,e){const i=this.title_mode,r=i!=TitleMode.TRANSPARENT_TITLE&&i!=TitleMode.NO_TITLE?LiteGraph.NODE_TITLE_HEIGHT:0;t[0]=this.pos[0],t[1]=this.pos[1]+-r,this.flags?.collapsed?(e.font=this.innerFontStyle,this._collapsed_width=Math.min(this.size[0],e.measureText(this.getTitle()??"").width+2*LiteGraph.NODE_TITLE_HEIGHT),t[2]=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH,t[3]=LiteGraph.NODE_TITLE_HEIGHT):(t[2]=this.size[0],t[3]=this.size[1]+r)}getBounding(t,e){t||=new Float32Array(4);const i=e?this.renderArea:this.boundingRect;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t}updateArea(t){const e=this.#v;this.measure(e,t),this.onBounding?.(e);const i=this.#y;i.set(e),i[0]-=4,i[1]-=4,i[2]+=10,i[3]+=9}isPointInside(t,e){return isInRect(t,e,this.boundingRect)}isPointInCollapse(t,e){const i=LiteGraph.NODE_TITLE_HEIGHT;return isInRectangle(t,e,this.pos[0],this.pos[1]-i,i,i)}getInputOnPos(t){return getNodeInputOnPos(this,t[0],t[1])?.input}getOutputOnPos(t){return getNodeOutputOnPos(this,t[0],t[1])?.output}getSlotOnPos(t){if(isPointInRect(t,this.boundingRect))return this.getInputOnPos(t)??this.getOutputOnPos(t)}getSlotInPosition(t,e){const{inputs:i,outputs:r}=this;if(i)for(const[n,s]of i.entries()){const i=this.getInputPos(n);if(isInRectangle(t,e,i[0]-10,i[1]-10,20,20))return{input:s,slot:n,link_pos:i}}if(r)for(const[n,s]of r.entries()){const i=this.getOutputPos(n);if(isInRectangle(t,e,i[0]-10,i[1]-10,20,20))return{output:s,slot:n,link_pos:i}}return null}getWidgetOnPos(t,e,i=!1){const{widgets:r,pos:n,size:s}=this;if(!r?.length)return null;const o=t-n[0],a=e-n[1],l=s[0];for(const c of r){if(c.computedDisabled&&!i||!this.isWidgetVisible(c))continue;const t=c.computedHeight??c.computeSize?.(l)[1]??LiteGraph.NODE_WIDGET_HEIGHT,e=c.width||l;if(void 0!==c.last_y&&isInRectangle(o,a,6,c.last_y,e-12,t))return c}return null}findInputSlot(t,e=!1){const{inputs:i}=this;if(!i)return-1;for(const[r,n]of i.entries())if(t==n.name)return e?n:r;return-1}findOutputSlot(t,e=!1){const{outputs:i}=this;if(!i)return-1;for(const[r,n]of i.entries())if(t==n.name)return e?n:r;return-1}findInputSlotFree(t){return this.#T(this.inputs,t)}findOutputSlotFree(t){return this.#T(this.outputs,t)}#T(t,e){const i=Object.assign({returnObj:!1,typesNotAccepted:[]},e||{}),r=t?.length;if(!(r>0))return-1;for(let n=0;n<r;++n){const e=t[n];if(e&&!e.link&&!e.links?.length&&!i.typesNotAccepted?.includes?.(e.type))return i.returnObj?e:n}return-1}findInputSlotByType(t,e,i,r){return this.#C(this.inputs,t,e,i,r)}findOutputSlotByType(t,e,i,r){return this.#C(this.outputs,t,e,i,r)}findSlotByType(t,e,i,r,n){return t?this.#C(this.inputs,e,i,r,n):this.#C(this.outputs,e,i,r,n)}#C(t,e,i,r,n){const s=t?.length;if(!s)return-1;""!=e&&"*"!=e||(e=0);const o=String(e).toLowerCase().split(",");let a=null;for(let l=0;l<s;++l){const e=t[l],n="0"==e.type||"*"==e.type?["0"]:String(e.type).toLowerCase().split(",");for(const t of o){const s="_event_"==t?LiteGraph.EVENT:t;for(const t of n){const n="_event_"==t?LiteGraph.EVENT:t;if(s==n||"*"===s||"*"===n){if(r&&(e.links?.length||null!=e.link)){a??=i?e:l;continue}return i?e:l}}}}return n?-1:a??-1}findConnectByTypeSlot(t,e,i,r){r&&"object"==typeof r&&("firstFreeIfInputGeneralInCase"in r&&(r.wildcardToTyped=!!r.firstFreeIfInputGeneralInCase),"firstFreeIfOutputGeneralInCase"in r&&(r.wildcardToTyped=!!r.firstFreeIfOutputGeneralInCase),"generalTypeInCase"in r&&(r.typedToWildcard=!!r.generalTypeInCase));const n=Object.assign({createEventInCase:!0,wildcardToTyped:!0,typedToWildcard:!0},r);if(!this.graph)throw new NullGraphError;if(e&&"number"==typeof e){const t=this.graph.getNodeById(e);if(!t)return;e=t}const s=e.findSlotByType(t,i,!1,!0);if(s>=0&&null!==s)return s;if(n.createEventInCase&&i==LiteGraph.EVENT){if(t)return-1;if(LiteGraph.do_add_triggers_slots)return e.addOnExecutedOutput()}if(n.typedToWildcard){const i=e.findSlotByType(t,0,!1,!0,!0);if(i>=0)return i}if(n.wildcardToTyped&&(0==i||"*"==i||""==i)){const i={typesNotAccepted:[LiteGraph.EVENT]},r=t?e.findInputSlotFree(i):e.findOutputSlotFree(i);if(r>=0)return r}}findOutputByType(t){return findFreeSlotOfType(this.outputs,t)}findInputByType(t){return findFreeSlotOfType(this.inputs,t)}connectByType(t,e,i,r){const n=this.findConnectByTypeSlot(!0,e,i,r);return void 0!==n?this.connect(t,e,n,r?.afterRerouteId):(console.debug("[connectByType]: no way to connect type:",i,"to node:",e),null)}connectByTypeOutput(t,e,i,r){"object"==typeof r&&("firstFreeIfInputGeneralInCase"in r&&(r.wildcardToTyped=!!r.firstFreeIfInputGeneralInCase),"generalTypeInCase"in r&&(r.typedToWildcard=!!r.generalTypeInCase));const n=this.findConnectByTypeSlot(!1,e,i,r);return void 0!==n?e.connect(n,this,t,r?.afterRerouteId):(console.debug("[connectByType]: no way to connect type:",i,"to node:",e),null)}canConnectTo(t,e,i){return this.id!==t.id&&LiteGraph.isValidConnection(i.type,e.type)}connect(t,e,i,r){let n;const{graph:s,outputs:o}=this;if(!s)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if("string"==typeof t){if(-1==(t=this.findOutputSlot(t)))return LiteGraph.debug&&console.log(`Connect: Error, no slot of name ${t}`),null}else if(!o||t>=o.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&"number"==typeof e){const t=s.getNodeById(e);if(!t)throw"target node is null";e=t}if(!e)throw"target node is null";if(e==this)return null;if("string"==typeof i){if(n=e.findInputSlot(i),-1==n)return LiteGraph.debug&&console.log(`Connect: Error, no slot of name ${n}`),null}else if(i===LiteGraph.EVENT){if(!LiteGraph.do_add_triggers_slots)return null;e.changeMode(LGraphEventMode.ON_TRIGGER),n=e.findInputSlot("onTrigger")}else n="number"==typeof i?i:0;if(e.onBeforeConnectInput){const t=e.onBeforeConnectInput(n,i);n="number"==typeof t?t:null}if(null===n||!e.inputs||n>=e.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;const a=e.inputs[n],l=o[t];if(!l)return null;l.links?.length&&(l.type!==LiteGraph.EVENT||LiteGraph.allow_multi_output_for_events||(s.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1})));return this.connectSlots(l,e,a,r)??null}connectSlots(t,e,i,r){const{graph:n}=this;if(!n)throw new NullGraphError;const s=this.outputs.indexOf(t);if(-1===s)return void console.warn("connectSlots: output not found");const o=e.inputs.indexOf(i);if(-1===o)return void console.warn("connectSlots: input not found");if(!LiteGraph.isValidConnection(t.type,i.type))return this.setDirtyCanvas(!1,!0),null;if(!1===e.onConnectInput?.(o,t.type,t,this,s))return null;if(!1===this.onConnectOutput?.(s,i.type,i,e,o))return null;null!=e.inputs[o]?.link&&(n.beforeChange(),e.disconnectInput(o,!0));const a=new LLink(++n.state.lastLinkId,i.type||t.type,this.id,s,e.id,o,r);n._links.set(a.id,a),t.links??=[],t.links.push(a.id),e.inputs[o].link=a.id;const l=LLink.getReroutes(n,a);for(const h of l)h.linkIds.add(a.id),h.floating&&delete h.floating,h._dragging=void 0;const c=l.at(-1);if(c)for(const h of c.floatingLinkIds){const t=n.floatingLinks.get(h);t?.parentId===c.id&&n.removeFloatingLink(t)}return n._version++,this.onConnectionsChange?.(NodeSlotType.OUTPUT,s,!0,a,t),e.onConnectionsChange?.(NodeSlotType.INPUT,o,!0,a,i),this.setDirtyCanvas(!1,!0),n.afterChange(),n.connectionChange(this),a}connectFloatingReroute(t,e,i){const{graph:r,id:n}=this;if(!r)throw new NullGraphError;const s=this.inputs.indexOf(e),o=this.outputs.indexOf(e);if(-1===s&&-1===o)throw new Error("Invalid slot");const a=-1===o?"input":"output",l=r.setReroute({pos:t,parentId:i,linkIds:[],floating:{slotType:a}}),c=r.getReroute(i);if(null==i||!("output"===c?.floating?.slotType)){const t=new LLink(-1,e.type,-1===o?-1:n,o,-1===s?-1:n,s);return t.parentId=l.id,r.addFloatingLink(t),l}if(!c)throw new Error("[connectFloatingReroute] Parent reroute not found");const h=c.getFloatingLinks("output")?.[0];if(!h)throw new Error("[connectFloatingReroute] Floating link not found");return l.floatingLinkIds.add(h.id),h.parentId=l.id,delete c.floating,l}disconnectOutput(t,e){if("string"==typeof t){if(-1==(t=this.findOutputSlot(t)))return LiteGraph.debug&&console.log(`Connect: Error, no slot of name ${t}`),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;const i=this.outputs[t];if(!i)return!1;if(i._floatingLinks)for(const s of i._floatingLinks)s.hasOrigin(this.id,t)&&this.graph?.removeFloatingLink(s);if(!i.links||0==i.links.length)return!1;const{links:r}=i,n=this.graph;if(!n)throw new NullGraphError;if(e){const s="number"==typeof e?n.getNodeById(e):e;if(!s)throw"Target Node not found";for(const[e,o]of r.entries()){const a=n._links.get(o);if(a?.target_id!=s.id)continue;r.splice(e,1);const l=s.inputs[a.target_slot];l.link=null,a.disconnect(n,"input"),n._version++,s.onConnectionsChange?.(NodeSlotType.INPUT,a.target_slot,!1,a,l),this.onConnectionsChange?.(NodeSlotType.OUTPUT,t,!1,a,i);break}}else{for(const e of r){const r=n._links.get(e);if(!r)continue;const s=n.getNodeById(r.target_id);if(n._version++,s){const t=s.inputs[r.target_slot];t.link=null,s.onConnectionsChange?.(NodeSlotType.INPUT,r.target_slot,!1,r,t)}r.disconnect(n,"input"),this.onConnectionsChange?.(NodeSlotType.OUTPUT,t,!1,r,i)}i.links=null}return this.setDirtyCanvas(!1,!0),n.connectionChange(this),!0}disconnectInput(t,e){if("string"==typeof t){if(-1==(t=this.findInputSlot(t)))return LiteGraph.debug&&console.log(`Connect: Error, no slot of name ${t}`),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;const i=this.inputs[t];if(!i)return!1;const{graph:r}=this;if(!r)throw new NullGraphError;if(i._floatingLinks?.size)for(const s of i._floatingLinks)r.removeFloatingLink(s);const n=this.inputs[t].link;if(null!=n){this.inputs[t].link=null;const s=r._links.get(n);if(s){const o=r.getNodeById(s.origin_id);if(!o)return!1;const a=o.outputs[s.origin_slot];if(!a?.links?.length)return!1;let l=0;for(const t=a.links.length;l<t;l++)if(a.links[l]==n){a.links.splice(l,1);break}s.disconnect(r,e?"output":void 0),r&&r._version++,this.onConnectionsChange?.(NodeSlotType.INPUT,t,!1,s,i),o.onConnectionsChange?.(NodeSlotType.OUTPUT,l,!1,s,a)}}return this.setDirtyCanvas(!1,!0),r?.connectionChange(this),!0}getConnectionPos(t,e,i){i||=new Float32Array(2);const{pos:[r,n],inputs:s,outputs:o}=this;if(this.flags.collapsed){const e=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return i[0]=t?r:r+e,i[1]=n-.5*LiteGraph.NODE_TITLE_HEIGHT,i}if(t&&-1==e)return i[0]=r+.5*LiteGraph.NODE_TITLE_HEIGHT,i[1]=n+.5*LiteGraph.NODE_TITLE_HEIGHT,i;const a=s?.[e]?.pos,l=o?.[e]?.pos;if(t&&a)return i[0]=r+a[0],i[1]=n+a[1],i;if(!t&&l)return i[0]=r+l[0],i[1]=n+l[1],i;const c=.5*LiteGraph.NODE_SLOT_HEIGHT,h=t?this.#S.indexOf(this.inputs[e]):this.#w.indexOf(this.outputs[e]);return i[0]=t?r+c:r+this.size[0]+1-c,i[1]=n+(h+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),i}get#S(){return this.inputs.filter((t=>!(t.pos||this.widgets?.length&&isWidgetInputSlot(t))))}get#w(){return this.outputs.filter((t=>!t.pos))}getInputPos(t){const{pos:[e,i],inputs:r}=this;if(this.flags.collapsed){return[e,i-.5*LiteGraph.NODE_TITLE_HEIGHT]}const n=r?.[t]?.pos;if(n)return[e+n[0],i+n[1]];const s=.5*LiteGraph.NODE_SLOT_HEIGHT,o=this.constructor.slot_start_y||0;return[e+s,i+(this.#S.indexOf(this.inputs[t])+.7)*LiteGraph.NODE_SLOT_HEIGHT+o]}getOutputPos(t){const{pos:[e,i],outputs:r,size:[n]}=this;if(this.flags.collapsed){return[e+(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH),i-.5*LiteGraph.NODE_TITLE_HEIGHT]}const s=r?.[t]?.pos;if(s)return[e+s[0],i+s[1]];const o=.5*LiteGraph.NODE_SLOT_HEIGHT,a=this.constructor.slot_start_y||0;return[e+n+1-o,i+(this.#w.indexOf(this.outputs[t])+.7)*LiteGraph.NODE_SLOT_HEIGHT+a]}snapToGrid(t){return!this.pinned&&snapPoint(this.pos,t)}alignToGrid(){this.snapToGrid(LiteGraph.CANVAS_GRID_SIZE)}trace(t){this.console||=[],this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift()}setDirtyCanvas(t,e){this.graph?.canvasAction((i=>i.setDirty(t,e)))}loadImage(t){const e=new Image;e.src=LiteGraph.node_images_path+t,e.ready=!1;const i=()=>this.setDirtyCanvas(!0);return e.addEventListener("load",(function(){this.ready=!0,i()})),e}captureInput(t){if(!this.graph||!this.graph.list_of_graphcanvas)return;const e=this.graph.list_of_graphcanvas;for(const i of e)(t||i.node_capturing_input==this)&&(i.node_capturing_input=t?this:null)}get collapsed(){return!!this.flags.collapsed}get collapsible(){return!this.pinned&&!1!==this.constructor.collapsable}collapse(t){if(this.collapsible||t){if(!this.graph)throw new NullGraphError;this.graph._version++,this.flags.collapsed=!this.flags.collapsed,this.setDirtyCanvas(!0,!0)}}toggleAdvanced(){if(this.widgets?.some((t=>t.advanced))){if(!this.graph)throw new NullGraphError;this.graph._version++,this.showAdvanced=!this.showAdvanced,this.expandToFitContent(),this.setDirtyCanvas(!0,!0)}}get pinned(){return!!this.flags.pinned}pin(t){if(!this.graph)throw new NullGraphError;this.graph._version++,this.flags.pinned=t??!this.flags.pinned,this.resizable=!this.pinned,this.pinned||delete this.flags.pinned}unpin(){this.pin(!1)}localToScreen(t,e,i){return[(t+this.pos[0])*i.scale+i.offset[0],(e+this.pos[1])*i.scale+i.offset[1]]}get width(){return this.collapsed?this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH:this.size[0]}get height(){return LiteGraph.NODE_TITLE_HEIGHT+this.bodyHeight}get bodyHeight(){return this.collapsed?0:this.size[1]}drawBadges(t,{gap:e=2}={}){const i=this.badges.map((t=>t instanceof LGraphBadge?t:t()));let r=this.badgePosition===BadgePosition.TopLeft?0:this.width-i.reduce(((i,r)=>i+r.getWidth(t)+e),0);const n=-(LiteGraph.NODE_TITLE_HEIGHT+e);for(const s of i)s.draw(t,r,n-s.height),r+=s.getWidth(t)+e}drawTitleBarBackground(t,{scale:e,title_height:i=LiteGraph.NODE_TITLE_HEIGHT,low_quality:r=!1}){const n=this.renderingColor,s=this.renderingShape,o=this.renderingSize;this.onDrawTitleBar?this.onDrawTitleBar(t,i,o,e,n):this.title_mode!==TitleMode.TRANSPARENT_TITLE&&(this.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),t.fillStyle=this.constructor.title_color||n,t.beginPath(),s==RenderShape.BOX||r?t.rect(0,-i,o[0],i):s!=RenderShape.ROUND&&s!=RenderShape.CARD||t.roundRect(0,-i,o[0],i,this.collapsed?[LiteGraph.ROUND_RADIUS]:[LiteGraph.ROUND_RADIUS,LiteGraph.ROUND_RADIUS,0,0]),t.fill(),t.shadowColor="transparent")}drawErrorTips(t){t.beginPath(),this.renderingShape==RenderShape.BOX?t.rect(0,-LiteGraph.NODE_TITLE_HEIGHT,this.renderingSize[0],LiteGraph.NODE_TITLE_HEIGHT):t.roundRect(0,-LiteGraph.NODE_TITLE_HEIGHT,this.renderingSize[0],LiteGraph.NODE_TITLE_HEIGHT,[8,8,8,8]),t.lineWidth=2,t.strokeStyle="#FF0000",t.stroke()}drawAssestBox(t,e,i){var r=0,n=0,s=0,o=0;this.flags.collapsed?(r=this.renderingSize[0],(n=this.renderingSize[0])>i+10&&(n=i+10),o=-7):(r=130,(n=130)>i+10&&(n=i+10),s=.5*this.renderingSize[0]-.5*r,o=-30-n),null==e&&(e=r),null==i&&(i=n);var a=Math.min((r-5)/e,(n-5)/i),l=e*a,c=i*a;c<l&&(n=c+5,this.flags.collapsed||(o=-30-n));var h=s+.5*(r-l),u=o+.5*(n-c);return t.beginPath(),this.flags.collapsed?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.roundRect(0,o,this.renderingSize[0],n,[0,0,8,8])):t.roundRect(.5*this.renderingSize[0]-.5*r,o,r,n,[8,8,0,0]),t.fillStyle=this.renderingBgColor,t.fill(),t.shadowColor="transparent",{x:h,y:u,width:l,height:c}}drawTitleBox(t,{scale:e,low_quality:i=!1,title_height:r=LiteGraph.NODE_TITLE_HEIGHT,box_size:n=10}){const s=this.renderingSize,o=this.renderingShape;this.onDrawTitleBox?this.onDrawTitleBox(t,r,s,e):[RenderShape.ROUND,RenderShape.CIRCLE,RenderShape.CARD].includes(o)?(i&&(t.fillStyle="black",t.beginPath(),t.arc(.5*r,-.5*r,.5*n+1,0,2*Math.PI),t.fill()),t.fillStyle=this.renderingBoxColor,i?t.fillRect(.5*r-.5*n,-.5*r-.5*n,n,n):(t.beginPath(),t.arc(.5*r,-.5*r,.5*n,0,2*Math.PI),t.fill())):(i&&(t.fillStyle="black",t.fillRect(.5*(r-n)-1,-.5*(r+n)-1,n+2,n+2)),t.fillStyle=this.renderingBoxColor,t.fillRect(.5*(r-n),-.5*(r+n),n,n))}drawTitleText(t,{scale:e,default_title_color:i,low_quality:r=!1,title_height:n=LiteGraph.NODE_TITLE_HEIGHT}){const s=this.renderingSize,o=this.selected;if(this.onDrawTitleText)return void this.onDrawTitleText(t,n,s,e,this.titleFontStyle,o);if(r)return;t.font=this.titleFontStyle;const a=this.getTitle()??`❌ ${this.type}`,l=String(a)+(this.pinned?"📌":"");l&&(t.fillStyle=o?LiteGraph.NODE_SELECTED_TITLE_COLOR:this.constructor.title_text_color||i,this.collapsed?(t.textAlign="left",t.fillText(l.substr(0,20),n,LiteGraph.NODE_TITLE_TEXT_Y-n),t.textAlign="left"):(t.textAlign="left",t.fillText(l,n,LiteGraph.NODE_TITLE_TEXT_Y-n)))}connectInputToOutput(){const{inputs:t,outputs:e,graph:i}=this;if(!t||!e)return;if(!i)throw new NullGraphError;const{_links:r}=i;let n=!1;for(const[o,a]of t.entries()){if(null==a.link)continue;const t=e[o];if(!t||!LiteGraph.isValidConnection(a.type,t.type))continue;const n=r.get(a.link);if(!n)continue;const l=i.getNodeById(n?.origin_id);l&&s(t,l,n,i)}if(!(this.flags.keepAllLinksOnBypass??LGraphNode.keepAllLinksOnBypass))return n;for(const o of t){if(null==o.link)continue;const t=r.get(o.link);if(!t)continue;const n=i.getNodeById(t?.origin_id);if(n)for(const r of e)if(LiteGraph.isValidConnection(o.type,r.type)){s(r,n,t,i);break}}return n;function s(t,e,i,s){const o=t.links?.map((t=>r.get(t))).filter((t=>!!t));if(o?.length)for(const r of o){const t=s.getNodeById(r.target_id);if(!t)continue;const o=e.connect(i.origin_slot,t,r.target_slot,i.parentId);n||=!!o}}}isWidgetVisible(t){return!(this.collapsed||t.hidden||t.advanced&&!this.showAdvanced)}drawWidgets(t,{lowQuality:e=!1,editorAlpha:i=1}){if(!this.widgets)return;const r=this.size[0],n=this.widgets,s=LiteGraph.NODE_WIDGET_HEIGHT,o=!e;t.save(),t.globalAlpha=i;for(const a of n){if(!this.isWidgetVisible(a))continue;const n=a.y,l=a.advanced?LiteGraph.WIDGET_ADVANCED_OUTLINE_COLOR:LiteGraph.WIDGET_OUTLINE_COLOR;a.last_y=n,a.computedDisabled=a.disabled||null!=this.getSlotFromWidget(a)?.link,t.strokeStyle=l,t.fillStyle="#222",t.textAlign="left",a.computedDisabled&&(t.globalAlpha*=.5);const c=a.width||r,h=WIDGET_TYPE_MAP[a.type];h?toClass(h,a).drawWidget(t,{y:n,width:c,show_text:o,margin:15}):a.draw?.(t,this,c,n,s,e),t.globalAlpha=i}t.restore()}drawCollapsedSlots(t){let e=null,i=null;for(const r of this.inputs??[])if(null!=r.link){e=r;break}for(const r of this.outputs??[])if(r.links&&r.links.length){i=r;break}if(e){const i=0,r=-.5*LiteGraph.NODE_TITLE_HEIGHT;toClass(NodeInputSlot,e).drawCollapsed(t,{pos:[i,r]})}if(i){const e=this._collapsed_width??LiteGraph.NODE_COLLAPSED_WIDTH,r=-.5*LiteGraph.NODE_TITLE_HEIGHT;toClass(NodeOutputSlot,i).drawCollapsed(t,{pos:[e,r]})}}get highlightColor(){return LiteGraph.NODE_TEXT_HIGHLIGHT_COLOR??LiteGraph.NODE_SELECTED_TITLE_COLOR??LiteGraph.NODE_TEXT_COLOR}get slots(){return[...this.inputs,...this.outputs]}#A(t,e){const i=isINodeInputSlot(t)?this.getInputPos(e):this.getOutputPos(e);return t._layoutElement=new LayoutElement({value:t,boundingRect:[i[0]-this.pos[0]-.5*LiteGraph.NODE_SLOT_HEIGHT,i[1]-this.pos[1]-.5*LiteGraph.NODE_SLOT_HEIGHT,LiteGraph.NODE_SLOT_HEIGHT,LiteGraph.NODE_SLOT_HEIGHT]}),t._layoutElement}#E(){const t=[];for(const[e,i]of this.inputs.entries()){if(this.widgets?.length&&isWidgetInputSlot(i))continue;const r=this.#A(i,e);t.push(r)}for(const[e,i]of this.outputs.entries()){const r=this.#A(i,e);t.push(r)}return t.length?createBounds(t,0):null}#D(t){const e=isINodeInputSlot(t),i=this.mouseOver?.[e?"inputId":"outputId"]??-1;return-1===i?null:e?this.inputs[i]:this.outputs[i]}#L(t){return this.#D(t)===t}#I(t){return this.mouseOver?.overWidget===t}getSlotFromWidget(t){return this.inputs.find((e=>isWidgetInputSlot(e)&&e.widget.name===t.name))}getWidgetFromSlot(t){if(isWidgetInputSlot(t))return this.widgets?.find((e=>e.name===t.widget.name))}drawSlots(t,{fromSlot:e,colorContext:i,editorAlpha:r,lowQuality:n}){for(const s of this.slots){const o=s._layoutElement,a=toNodeSlotClass(s),l=!e||a.isValidTarget(e),c=l&&this.#L(s),h=c?this.highlightColor:LiteGraph.NODE_TEXT_COLOR,u=!isWidgetInputSlot(s)||this.#I(this.getWidgetFromSlot(s))||e&&a.isValidTarget(e)||a.isConnected();t.globalAlpha=u?l?r:.4*r:0,a.draw(t,{pos:o?.center??[0,0],colorContext:i,labelColor:h,lowQuality:n,highlight:c})}}#P(t){if(!this.widgets||!this.widgets.length)return;const e=this.bodyHeight,i=this.widgets_start_y??(this.widgets_up?0:t)+2;let r=e-i,n=0;const s=[];for(const c of this.widgets)if(0!=this.isWidgetVisible(c)){if(c.computeSize){const t=c.computeSize()[1]+4;c.computedHeight=t,n+=t}else if(c.computeLayoutSize){const{minHeight:t,maxHeight:e}=c.computeLayoutSize(this);s.push({minHeight:t,prefHeight:e,w:c})}else{const t=LiteGraph.NODE_WIDGET_HEIGHT+4;c.computedHeight=t,n+=t}n+=8}r-=n,this.freeWidgetSpace=r;const o=s.map((t=>({minSize:t.minHeight,maxSize:t.prefHeight}))),a=distributeSpace(Math.max(0,r),o);for(const[c,h]of s.entries())h.w.computedHeight=a[c];let l=i;for(const c of this.widgets)0!=this.isWidgetVisible(c)&&(c.y=l,l+=c.computedHeight??0);if(l+=8,!this.graph)throw new NullGraphError;l>e&&(this.setSize([this.size[0],l]),this.graph.setDirtyCanvas(!1,!0))}#M(){if(!this.widgets)return;const t=new Map;for(const[e,i]of this.inputs.entries())isWidgetInputSlot(i)&&t.set(i.widget?.name,{...i,index:e});if(t.size)for(const e of this.widgets){const i=t.get(e.name);if(!i)continue;const r=this.inputs[i.index],n=.5*LiteGraph.NODE_SLOT_HEIGHT;r.pos=[n,e.y+n],this.#A(r,i.index)}}arrange(){const t=this.#E(),e=t?t[1]+t[3]:0;this.#P(e),this.#M()}drawProgressBar(t){if(!this.progress)return;const e=t.fillStyle;t.fillStyle="green",t.fillRect(0,0,this.width*this.progress,6),t.fillStyle=e}}class LGraphGroup{constructor(t,e){this.font_size=LiteGraph.DEFAULT_GROUP_FONT||24,this._bounding=new Float32Array([10,10,LGraphGroup.minWidth,LGraphGroup.minHeight]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this._children=new Set,this.flags={},this.isPointInside=LGraphNode.prototype.isPointInside,this.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas,this.id=e??-1,this.title=t||"Group",this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA"}static#c=(()=>this.minWidth=140)();static#h=(()=>this.minHeight=80)();static#R=(()=>this.resizeLength=10)();static#O=(()=>this.padding=4)();static#B=(()=>this.defaultColour="#335")();setColorOption(t){null==t?delete this.color:this.color=t.groupcolor}getColorOption(){return Object.values(LGraphCanvas.node_colors).find((t=>t.groupcolor===this.color))??null}get pos(){return this._pos}set pos(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])}get size(){return this._size}set size(t){!t||t.length<2||(this._size[0]=Math.max(LGraphGroup.minWidth,t[0]),this._size[1]=Math.max(LGraphGroup.minHeight,t[1]))}get boundingRect(){return this._bounding}get nodes(){return this._nodes}get titleHeight(){return 1.4*this.font_size}get children(){return this._children}get pinned(){return!!this.flags.pinned}pin(t){(void 0===t?!this.pinned:t)?this.flags.pinned=!0:delete this.flags.pinned}unpin(){this.pin(!1)}configure(t){this.id=t.id,this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.flags=t.flags||this.flags,t.font_size&&(this.font_size=t.font_size)}serialize(){const t=this._bounding;return{id:this.id,title:this.title,bounding:[...t],color:this.color,font_size:this.font_size,flags:this.flags}}draw(t,e){const{padding:i,resizeLength:r,defaultColour:n}=LGraphGroup,s=this.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE,[o,a]=this._pos,[l,c]=this._size,h=this.color||n;e.globalAlpha=.25*t.editor_alpha,e.fillStyle=h,e.strokeStyle=h,e.beginPath(),e.rect(o+.5,a+.5,l,1.4*s),e.fill(),e.fillStyle=h,e.strokeStyle=h,e.beginPath(),e.rect(o+.5,a+.5,l,c),e.fill(),e.globalAlpha=t.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(o+l,a+c),e.lineTo(o+l-r,a+c),e.lineTo(o+l,a+c-r),e.fill(),e.font=`${s}px Arial`,e.textAlign="left",e.fillText(this.title+(this.pinned?"📌":""),o+i,a+s),LiteGraph.highlight_selected_group&&this.selected&&strokeShape(e,this._bounding,{title_height:this.titleHeight,padding:i})}resize(t,e){return!this.pinned&&(this._size[0]=Math.max(LGraphGroup.minWidth,t),this._size[1]=Math.max(LGraphGroup.minHeight,e),!0)}move(t,e,i=!1){if(!this.pinned&&(this._pos[0]+=t,this._pos[1]+=e,!0!==i))for(const r of this._children)r.move(t,e)}snapToGrid(t){return!this.pinned&&snapPoint(this.pos,t)}recomputeInsideNodes(){if(!this.graph)throw new NullGraphError;const{nodes:t,reroutes:e,groups:i}=this.graph,r=this._children;this._nodes.length=0,r.clear();for(const n of t)containsCentre(this._bounding,n.boundingRect)&&(this._nodes.push(n),r.add(n));for(const n of e.values())isPointInRect(n.pos,this._bounding)&&r.add(n);for(const n of i)containsRect(this._bounding,n._bounding)&&r.add(n);i.sort(((t,e)=>t===this?r.has(e)?-1:0:e===this&&r.has(t)?1:0))}resizeTo(t,e=10){const i=createBounds(t,e);null!==i&&(this.pos[0]=i[0],this.pos[1]=i[1]-this.titleHeight,this.size[0]=i[2],this.size[1]=i[3]+this.titleHeight)}addNodes(t,e=10){(this._nodes||0!==t.length)&&this.resizeTo([...this.children,...this._nodes,...t],e)}getMenuOptions(){return[{content:this.pinned?"Unpin":"Pin",callback:()=>{this.pinned?this.unpin():this.pin(),this.setDirtyCanvas(!1,!0)}},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}]}isPointInTitlebar(t,e){const i=this.boundingRect;return isInRectangle(t,e,i[0],i[1],i[2],this.titleHeight)}isInResize(t,e){const i=this.boundingRect,r=i[0]+i[2],n=i[1]+i[3];return t<r&&e<n&&t-r+(e-n)>-LGraphGroup.resizeLength}}class Reroute{constructor(t,e,i,r,n,s){this.id=t,this.#N=new Float32Array(8),this.#k=this.#N.subarray(0,2),this.cos=0,this.sin=0,this.controlPoint=this.#N.subarray(4,6),this._pos=this.#N.subarray(6,8),this.#F=-1/0,this.#V=new WeakRef(e),this.parentId=r,i&&(this.pos=i),this.linkIds=new Set(n),this.floatingLinkIds=new Set(s)}static#c=(()=>this.radius=10)();static#h=(()=>this.maxSplineOffset=80)();static#R=(()=>this.drawIdBadge=!1)();#N;#V;#j;get parentId(){return this.#j}set parentId(t){t!==this.id&&null!==this.getReroutes()&&(this.#j=t)}get parent(){return this.#V.deref()?.getReroute(this.#j)}#k;get pos(){return this.#k}set pos(t){if(!(t?.length>=2))throw new TypeError("Reroute.pos is an x,y point, and expects an indexable with at least two values.");this.#k[0]=t[0],this.#k[1]=t[1]}get boundingRect(){const{radius:t}=Reroute,[e,i]=this.#k;return[e-t,i-t,2*t,2*t]}get totalLinks(){return this.linkIds.size+this.floatingLinkIds.size}#F;get firstLink(){const t=this.linkIds.values().next().value;return void 0===t?void 0:this.#V.deref()?.links.get(t)}get firstFloatingLink(){const t=this.floatingLinkIds.values().next().value;return void 0===t?void 0:this.#V.deref()?.floatingLinks.get(t)}get origin_id(){return this.firstLink?.origin_id}get origin_slot(){return this.firstLink?.origin_slot}update(t,e,i,r){this.parentId=t,e&&(this.pos=e),i&&(this.linkIds=new Set(i)),this.floating=r}validateLinks(t,e){const{linkIds:i,floatingLinkIds:r}=this;for(const n of i)t.has(n)||i.delete(n);for(const n of r)e.has(n)||r.delete(n);return i.size>0||r.size>0}getReroutes(t=new Set){if(void 0===this.#j)return[this];if(t.has(this))return null;t.add(this);const e=this.#V.deref()?.reroutes.get(this.#j);if(!e)return this.#j=void 0,[this];const i=e.getReroutes(t);return i?.push(this),i}findNextReroute(t,e=new Set){return this.#j===t?this:e.has(this)?null:(e.add(this),void 0!==this.#j?this.#V.deref()?.reroutes.get(this.#j)?.findNextReroute(t,e):void 0)}findSourceOutput(){const t=this.firstLink??this.firstFloatingLink;if(!t)return;const e=this.#V.deref()?.getNodeById(t.origin_id);return e?{node:e,output:e.outputs[t.origin_slot]}:void 0}findTargetInputs(){const t=this.#V.deref();if(!t)return;const e=[];return i(t,this.linkIds,t.links),i(t,this.floatingLinkIds,t.floatingLinks),e;function i(t,i,r){for(const n of i){const i=r.get(n);if(!i)continue;const s=t.getNodeById(i.target_id),o=s?.inputs[i.target_slot];o&&e.push({node:s,input:o,link:i})}}}getFloatingLinks(t){const e=this.#V.deref()?.floatingLinks;if(!e)return;const i="input"===t?"origin_id":"target_id",r=[];for(const n of this.floatingLinkIds){const t=e.get(n);-1===t?.[i]&&r.push(t)}return r}setFloatingLinkOrigin(t,e,i){const r=this.#V.deref(),n=this.getFloatingLinks("output");if(!n)throw new Error("[setFloatingLinkOrigin]: Invalid network.");if(n.length){e._floatingLinks??=new Set;for(const s of n)e._floatingLinks.add(s),r?.getNodeById(s.origin_id)?.outputs[s.origin_slot]?._floatingLinks?.delete(s),s.origin_id=t.id,s.origin_slot=i}}move(t,e){this.#k[0]+=t,this.#k[1]+=e}snapToGrid(t){if(!t)return!1;const{pos:e}=this;return e[0]=t*Math.round(e[0]/t),e[1]=t*Math.round(e[1]/t),!0}removeAllFloatingLinks(){for(const t of this.floatingLinkIds)this.removeFloatingLink(t)}removeFloatingLink(t){const e=this.#V.deref();if(!e)return;const i=e.floatingLinks.get(t);if(!i)return console.warn(`[Reroute.removeFloatingLink] Floating link not found: ${t}, ignoring and discarding ID.`),void this.floatingLinkIds.delete(t);e.removeFloatingLink(i)}removeLink(t){const e=this.#V.deref();if(!e)return;t===e.floatingLinks.get(t.id)?this.floatingLinkIds.delete(t.id):this.linkIds.delete(t.id)}remove(){const t=this.#V.deref();t&&t.removeReroute(this.id)}calculateAngle(t,e,i){if(!(t>this.#F))return;this.#F=t;const{id:r,pos:n}=this,s=[];let o=0;if(p(this.linkIds,e.links),p(this.floatingLinkIds,e.floatingLinks),!s.length)return this.cos=0,this.sin=0,this.controlPoint[0]=0,void(this.controlPoint[1]=0);o/=s.length;const a=Math.atan2(this.#k[1]-i[1],this.#k[0]-i[0]);let l=.5*(a-o);Math.abs(l)>.5*Math.PI&&(l+=Math.PI);const c=Math.min(Reroute.maxSplineOffset,.25*distance(i,this.#k)),h=a-l,u=Math.cos(h),d=Math.sin(h);function p(t,i){for(const a of t){const t=i.get(a),l=getNextPos(e,t,r);if(!l)continue;const c=getDirection(n,l);s.push(c),o+=c}}this.cos=u,this.sin=d,this.controlPoint[0]=c*-u,this.controlPoint[1]=c*-d}draw(t,e){const{globalAlpha:i}=t,{pos:r}=this;if(t.beginPath(),t.arc(r[0],r[1],Reroute.radius,0,2*Math.PI),0===this.linkIds.size&&(t.fillStyle=e??"#797979",t.fill(),t.globalAlpha=.33*i),t.fillStyle=this._colour??"#18184d",t.lineWidth=.1*Reroute.radius,t.strokeStyle="rgb(0,0,0,0.5)",t.fill(),t.stroke(),t.fillStyle="#ffffff55",t.strokeStyle="rgb(0,0,0,0.3)",t.beginPath(),t.arc(r[0],r[1],.8*Reroute.radius,0,2*Math.PI),t.fill(),t.stroke(),this.selected&&(t.strokeStyle="#fff",t.beginPath(),t.arc(r[0],r[1],1.2*Reroute.radius,0,2*Math.PI),t.stroke()),Reroute.drawIdBadge){const e=new LGraphBadge({text:this.id.toString()}),i=r[0]-.5*e.getWidth(t),n=r[1]-e.height-Reroute.radius-2;e.draw(t,i,n)}t.globalAlpha=i}drawHighlight(t,e){const{pos:i}=this,{strokeStyle:r,lineWidth:n}=t;t.strokeStyle=r,t.lineWidth=n,t.strokeStyle=e,t.lineWidth=1,t.beginPath(),t.arc(i[0],i[1],1.5*Reroute.radius,0,2*Math.PI),t.stroke(),t.strokeStyle=r,t.lineWidth=n}asSerialisable(){const{id:t,parentId:e,pos:i,linkIds:r}=this;return{id:t,parentId:e,pos:[i[0],i[1]],linkIds:[...r],floating:this.floating?{slotType:this.floating.slotType}:void 0}}}function getNextPos(t,e,i){if(!e)return;const r=LLink.findNextReroute(t,e,i)?.pos;return r||(-1!==e.target_id&&-1!==e.target_slot?t.getNodeById(e.target_id)?.getInputPos(e.target_slot):void 0)}function getDirection(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function getBoundaryNodes(t){const e=t?.find((t=>t));if(!e)return null;let i=e,r=e,n=e,s=e;for(const o of t){if(!o)continue;const[t,e]=o.pos,[a,l]=o.size;e<i.pos[1]&&(i=o),t+a>r.pos[0]+r.size[0]&&(r=o),e+l>n.pos[1]+n.size[1]&&(n=o),t<s.pos[0]&&(s=o)}return{top:i,right:r,bottom:n,left:s}}function distributeNodes(t,e){const i=t?.length;if(!(i>1))return;const r=e?0:1;let n=0,s=-1/0;for(const h of t){n+=h.size[r];const t=h.pos[r]+h.size[r];t>s&&(s=t)}const o=[...t].sort(((t,e)=>t.pos[r]-e.pos[r])),a=o[0].pos[r],l=(s-a-n)/(i-1);let c=a;for(let h=0;h<i;h++){const t=o[h];t.pos[r]=c+l*h,c+=t.size[r]}}function alignNodes(t,e,i){if(!t)return;const r=void 0===i?getBoundaryNodes(t):{top:i,right:i,bottom:i,left:i};if(null!==r)for(const n of t)switch(e){case"right":n.pos[0]=r.right.pos[0]+r.right.size[0]-n.size[0];break;case"left":n.pos[0]=r.left.pos[0];break;case"top":n.pos[1]=r.top.pos[1];break;case"bottom":n.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-n.size[1]}}class LGraphCanvas{constructor(t,e,i){this.state={draggingItems:!1,draggingCanvas:!1,readOnly:!1,hoveringOver:CanvasItem.Nothing,shouldSetCursor:!0},this._previously_dragging_canvas=null,this.#G=0,this.linkMarkerShape=LinkMarkerShape.Circle,this.low_quality_zoom_threshold=.6,this.renderedPaths=new Set,this.visible_links=[],this.linkConnector=new LinkConnector((t=>this.connecting_links=t)),this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.selected_nodes={},this.selectedItems=new Set,this.resizingGroup=null,this.selected_group=null,this.visible_nodes=[],this.#U=new Set,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_nodes=new Map,this.last_mouse=[0,0],this.last_mouseclick=0,this.#Y=!1,this.dragZoomEnabled=!1,this.#H=null,this.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";null==this.upVisibleArea&&(this.upVisibleArea={}),this.upVisibleArea[this.graph.id]={offset:[this.ds.offset[0],this.ds.offset[1]],scale:this.ds.scale},this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),null!=this.upVisibleArea[t.id]&&(this.ds.scale=this.upVisibleArea[t.id].scale,this.ds.offset=this.upVisibleArea[t.id].offset),this.checkPanels(),this.setDirty(!0,!0)},this.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){this.upVisibleArea[this.graph.id]={offset:[this.ds.offset[0],this.ds.offset[1]],scale:this.ds.scale};var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t])),null!=this.upVisibleArea[e.id]&&(this.ds.scale=this.upVisibleArea[e.id].scale,this.ds.offset=this.upVisibleArea[e.id].offset)}},this.showSubgraphPropertiesDialogRight=function(t){console.log("showing subgraph output properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var i=this.createPanel("Subgraph Outputs",{closable:!0,width:500});function r(){if(i.clear(),t.outputs)for(var e=0;e<t.outputs.length;++e){var n=t.outputs[e];if(!n.not_subgraph_output){var s=i.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");s.dataset.name=n.name,s.dataset.slot=e,s.querySelector(".name").innerText=n.name,s.querySelector(".type").innerText=n.type,s.querySelector("button").addEventListener("click",(function(e){t.removeOutput(Number(this.parentNode.dataset.slot)),r()}))}}}i.node=t,i.classList.add("subgraph_dialog");var n=i.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0);function s(){var e=this.parentNode,i=e.querySelector(".name").value,n=e.querySelector(".type").value;i&&-1==t.findOutputSlot(i)&&(t.addOutput(i,n),e.querySelector(".name").value="",e.querySelector(".type").value="",r())}return n.querySelector(".name").addEventListener("keydown",(function(t){13==t.keyCode&&s.apply(this)})),n.querySelector("button").addEventListener("click",(function(t){s.apply(this)})),r(),this.canvas.parentNode.appendChild(i),i},i||={},this.options=i,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,this.ds=new DragAndScale(t),this.pointer=new CanvasPointer(t),this.linkConnector.events.addEventListener("reset",(()=>{this.connecting_links=null})),this.linkConnector.events.addEventListener("dropped-on-canvas",(t=>{if(!this.connecting_links)return;const e=t.detail;this.emitEvent({subType:"empty-release",originalEvent:e,linkReleaseContext:{links:this.connecting_links}});const i=this.linkConnector.renderLinks[0];if(LiteGraph.release_link_on_empty_shows_menu){const t="input"===this.linkConnector.state.connectingTo?{node_from:i.node,slot_from:i.fromSlot,type_filter_in:i.fromSlot.type}:{node_to:i.node,slot_from:i.fromSlot,type_filter_out:i.fromSlot.type},r=i.fromReroute?.id;"shiftKey"in e&&e.shiftKey?this.allow_searchbox&&this.showSearchBox(e,t):"input"===this.linkConnector.state.connectingTo?this.showConnectionMenu({nodeFrom:i.node,slotFrom:i.fromSlot,e:e,afterRerouteId:r}):this.showConnectionMenu({nodeTo:i.node,slotTo:i.fromSlot,e:e,afterRerouteId:r})}})),this.zoom_modify_alpha=!0,this.zoom_speed=1.1,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.render_only_selected=!0,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_link_tooltip=!0,this.links_render_mode=LinkRenderType.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.connections_width=3,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.connecting_links=null,this.viewport=i.viewport||null,this.graph=e,e?.attachCanvas(this),this.canvas=void 0,this.bgcanvas=void 0,this.ctx=void 0,this.upVisibleArea={},this.setCanvas(t,i.skip_events),this.clear(),i.skip_render||this.startRendering(),this.autoresize=i.autoresize}static#X=(()=>new Float32Array(4))();static#z=(()=>new Float32Array(2))();static#W=(()=>new Float32Array(4))();static#Z=(()=>new Float32Array(4))();static#J=(()=>new Float32Array(4))();static#q=(()=>new Float32Array(2))();static#K=(()=>new Float32Array(2))();static#Q=(()=>new Float32Array(2))();static#c=(()=>this.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=")();static#h=(()=>this.DEFAULT_EVENT_LINK_COLOR="#A86")();static#R=(()=>this.link_type_colors={"-1":LGraphCanvas.DEFAULT_EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"})();static#O=(()=>this.gradients={})();static#B=(()=>this.search_limit=-1)();static#$=(()=>this.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}})();#tt(){if(!this.state.shouldSetCursor)return;let t="default";this.state.draggingCanvas?t="grabbing":this.state.readOnly?t="grab":this.state.hoveringOver&CanvasItem.ResizeSe?t="se-resize":this.state.hoveringOver&CanvasItem.Node&&(t="crosshair"),this.canvas.style.cursor=t}get read_only(){return this.state.readOnly}set read_only(t){this.state.readOnly=t,this.#tt()}get isDragging(){return this.state.draggingItems}set isDragging(t){this.state.draggingItems=t}get hoveringOver(){return this.state.hoveringOver}set hoveringOver(t){this.state.hoveringOver=t,this.#tt()}get pointer_is_down(){return this.pointer.isDown}get pointer_is_double(){return this.pointer.isDouble}get dragging_canvas(){return this.state.draggingCanvas}set dragging_canvas(t){this.state.draggingCanvas=t,this.#tt()}get title_text_font(){return`${LiteGraph.NODE_TEXT_SIZE}px Arial`}get inner_text_font(){return`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`}#G;get maximumFps(){return this.#G>Number.EPSILON?this.#G/1e3:0}set maximumFps(t){this.#G=t>Number.EPSILON?1e3/t:0}get round_radius(){return LiteGraph.ROUND_RADIUS}set round_radius(t){LiteGraph.ROUND_RADIUS=t}get low_quality(){return this.ds.scale<this.low_quality_zoom_threshold}#U;#et;#Y;#H;static onGroupAdd(t,e,i){const r=LGraphCanvas.active_canvas,n=new LiteGraph.LGraphGroup;if(n.pos=r.convertEventToCanvasOffset(i),!r.graph)throw new NullGraphError;r.graph.add(n)}static getBoundaryNodes(t){return getBoundaryNodes(Array.isArray(t)?t:Object.values(t))??{top:null,right:null,bottom:null,left:null}}static alignNodes(t,e,i){alignNodes(Object.values(t),e,i),LGraphCanvas.active_canvas.setDirty(!0,!0)}static onNodeAlign(t,e,i,r,n){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:i,callback:function(t){alignNodes(Object.values(LGraphCanvas.active_canvas.selected_nodes),t.toLowerCase(),n),LGraphCanvas.active_canvas.setDirty(!0,!0)},parentMenu:r})}static onGroupAlign(t,e,i,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:i,callback:function(t){alignNodes(Object.values(LGraphCanvas.active_canvas.selected_nodes),t.toLowerCase()),LGraphCanvas.active_canvas.setDirty(!0,!0)},parentMenu:r})}static createDistributeMenu(t,e,i,r){new LiteGraph.ContextMenu(["Vertically","Horizontally"],{event:i,callback:function(t){const e=LGraphCanvas.active_canvas;distributeNodes(Object.values(e.selected_nodes),"Horizontally"===t),e.setDirty(!0,!0)},parentMenu:r})}static onMenuAdd(t,e,i,r,n){const s=LGraphCanvas.active_canvas,o=s.getCanvasWindow(),{graph:a}=s;if(a)return function t(e,r){if(!a)return;const l=LiteGraph.getNodeTypesCategories(s.filter||a.filter).filter((t=>t.startsWith(e))),c=[];for(const i of l){if(!i)continue;const r=new RegExp(`^(${e})`),n=i.replace(r,"").split("/",1)[0],s=""===e?`${n}/`:`${e}${n}/`;let o=n;o.includes("::")&&(o=o.split("::",2)[1]);-1===c.findIndex((t=>t.value===s))&&c.push({value:s,content:o,has_submenu:!0,callback:function(e,i,r,n){t(e.value,n)}})}const h=LiteGraph.getNodeTypesInCategory(e.slice(0,-1),s.filter||a.filter);for(const i of h){if(i.skip_list)continue;const t={value:i.type,content:i.title,has_submenu:!1,callback:function(t,e,i,r){if(!s.graph)throw new NullGraphError;const o=r.getFirstEvent();s.graph.beforeChange();const a=LiteGraph.createNode(t.value);if(a){if(!o)throw new TypeError("Context menu event was null. This should not occure in normal usage.");a.pos=s.convertEventToCanvasOffset(o),s.graph.add(a)}n?.(a),s.graph.afterChange()}};c.push(t)}console.log("构建菜单选项",e,c),new LiteGraph.ContextMenu(c,{event:i,parentMenu:r},o)}("",r),!1}static onMenuCollapseAll(){}static onMenuNodeEdit(){}static showMenuNodeOptionalInputs(t,e,i,r,n){if(n){var s=this,o=LGraphCanvas.active_canvas.getCanvasWindow();e=n.optional_inputs;n.onGetInputs&&(e=n.onGetInputs());var a=[];if(e)for(var l=0;l<e.length;l++){var c=e[l];if(c){var h=c[0];c[2]||(c[2]={}),c[2].label&&(h=c[2].label),c[2].removable=!0;var u={content:h,value:c};c[1]==LiteGraph.ACTION&&(u.className="event"),a.push(u)}else a.push(null)}if(n.onMenuNodeInputs){var d=n.onMenuNodeInputs(a);d&&(a=d)}if(a.length)return new LiteGraph.ContextMenu(a,{event:i,callback:function(t,e,i){if(!n)return;t.callback&&t.callback.call(s,n,t,e,i);t.value&&(n.graph.beforeChange(),n.addInput(t.value[0],t.value[1],t.value[2]),n.onNodeInputAdd&&n.onNodeInputAdd(t.value),n.setDirtyCanvas(!0,!0),n.graph.afterChange())},parentMenu:r,node:n},o),!1;console.log("no input entries")}}static showMenuNodeOptionalOutputs(t,e,i,r,n){if(!n)return;const s=LGraphCanvas.active_canvas;var o=n.optional_outputs;n.onGetOutputs&&(o=n.onGetOutputs());let a=[];if(o)for(var l=0;l<o.length;l++){var c=o[l];if(c){var h=c[0];c[2]||(c[2]={}),c[2].label&&(h=c[2].label),c[2].removable=!0;var u={content:h,value:c};c[1]==LiteGraph.ACTION&&(u.className="event"),a.push(u)}else a.push(null)}LiteGraph.do_add_triggers_slots&&-1==n.findOutputSlot("onExecuted")&&a.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"});const d=n.onMenuNodeOutputs?.(a);if(d&&(a=d),a.length)return new LiteGraph.ContextMenu(a,{event:i,callback:function t(e,i,o){if(!n)return;e.callback&&e.callback.call(this,n,e,i,o);if(!e.value)return;const a=e.value[1];if(a&&("object"==typeof a||Array.isArray(a))){const e=[];for(const t in a)e.push({content:t,value:a[t]});return new LiteGraph.ContextMenu(e,{event:i,callback:t,parentMenu:r,node:n}),!1}const{graph:l}=n;if(!l)throw new NullGraphError;l.beforeChange(),n.addOutput(e.value[0],e.value[1],e.value[2]),n.onNodeOutputAdd?.(e.value),s.setDirty(!0,!0),l.afterChange()},parentMenu:r,node:n}),!1}static onShowMenuNodeProperties(t,e,i,r,n){if(!n||!n.properties)return;const s=LGraphCanvas.active_canvas,o=s.getCanvasWindow(),a=[];for(const l in n.properties){"object"==typeof(t=void 0!==n.properties[l]?n.properties[l]:" ")&&(t=JSON.stringify(t));const e=n.getPropertyInfo(l);"enum"!=e.type&&"combo"!=e.type||(t=LGraphCanvas.getPropertyPrintableValue(t,e.values)),t=LGraphCanvas.decodeHTML(stringOrEmpty(t)),a.push({content:`<span class='property_name'>${e.label||l}</span><span class='property_value'>${t}</span>`,value:l})}if(a.length)return new LiteGraph.ContextMenu(a,{event:i,callback:function(t){if(!n)return;const e=this.getBoundingClientRect();s.showEditPropertyValue(n,t.value,{position:[e.left,e.top]})},parentMenu:r,allow_html:!0,node:n},o),!1}static decodeHTML(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}static onMenuResizeNode(t,e,i,r,n){if(!n)return;const s=function(t){t.setSize(t.computeSize())},o=LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)s(n);else for(const a in o.selected_nodes)s(o.selected_nodes[a]);o.setDirty(!0,!0)}static onShowPropertyEditor(t,e,i,r,n){const s=t.property||"title",o=n[s],a=document.createElement("span");a.className="name",a.textContent=s;const l=document.createElement("input");Object.assign(l,{type:"text",className:"value",autofocus:!0});const c=document.createElement("button");c.textContent="OK";const h=Object.assign(document.createElement("div"),{is_modified:!1,className:"graphdialog",close:()=>h.remove()});h.append(a,l,c),l.value=String(o),l.addEventListener("blur",(function(){this.focus()})),l.addEventListener("keydown",(t=>{if(h.is_modified=!0,"Escape"==t.key)h.close();else if("Enter"==t.key)g();else if(!t.target||!("localName"in t.target)||"textarea"!=t.target.localName)return;t.preventDefault(),t.stopPropagation()}));const u=LGraphCanvas.active_canvas,d=u.canvas,p=d.getBoundingClientRect(),f=p?-20-p.left:-20,_=p?-20-p.top:-20;if(i?(h.style.left=`${i.clientX+f}px`,h.style.top=`${i.clientY+_}px`):(h.style.left=`${.5*d.width+f}px`,h.style.top=`${.5*d.height+_}px`),c.addEventListener("click",g),null==d.parentNode)throw new TypeError("canvasEl.parentNode was null");let m;function g(){l&&function(e){"Number"==t.type?e=Number(e):"Boolean"==t.type&&(e=Boolean(e));n[s]=e,h.remove(),u.setDirty(!0,!0)}(l.value)}d.parentNode.append(h),l.focus(),h.addEventListener("mouseleave",(function(){LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(m=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),h.addEventListener("mouseenter",(function(){LiteGraph.dialog_close_on_mouse_leave&&m&&clearTimeout(m)}))}static getPropertyPrintableValue(t,e){if(!e)return String(t);if(Array.isArray(e))return String(t);if("object"==typeof e){let i="";for(const r in e)if(e[r]==t){i=r;break}return`${String(t)} (${i})`}}static onMenuNodeCollapse(t,e,i,r,n){if(!n.graph)throw new NullGraphError;n.graph.beforeChange();const s=function(t){t.collapse()},o=LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)s(n);else for(const a in o.selected_nodes)s(o.selected_nodes[a]);n.graph.afterChange()}static onMenuToggleAdvanced(t,e,i,r,n){if(!n.graph)throw new NullGraphError;n.graph.beforeChange();const s=function(t){t.toggleAdvanced()},o=LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)s(n);else for(const a in o.selected_nodes)s(o.selected_nodes[a]);n.graph.afterChange()}static onMenuNodeMode(t,e,i,r,n){return new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:i,callback:function(t){if(!n)return;const e=Object.values(LiteGraph.NODE_MODES).indexOf(t),i=function(i){-1!==e&&LiteGraph.NODE_MODES[e]?i.changeMode(e):(console.warn(`unexpected mode: ${t}`),i.changeMode(LGraphEventMode.ALWAYS))},r=LGraphCanvas.active_canvas;if(!r.selected_nodes||Object.keys(r.selected_nodes).length<=1)i(n);else for(const n in r.selected_nodes)i(r.selected_nodes[n])},parentMenu:r,node:n}),!1}static onMenuNodeColors(t,e,i,r,n){if(!n)throw"no node for color";const s=[];s.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(const o in LGraphCanvas.node_colors){const e=LGraphCanvas.node_colors[o];t={value:o,content:`<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid ${e.color}; background-color:${e.bgcolor}'>${o}</span>`},s.push(t)}return new LiteGraph.ContextMenu(s,{event:i,callback:function(t){if(!n)return;const e=function(e){const i=t.value?LGraphCanvas.node_colors[t.value]:null;e.setColorOption(i)},i=LGraphCanvas.active_canvas;if(!i.selected_nodes||Object.keys(i.selected_nodes).length<=1)e(n);else for(const r in i.selected_nodes)e(i.selected_nodes[r]);i.setDirty(!0,!0)},parentMenu:r,node:n}),!1}static onMenuNodeShapes(t,e,i,r,n){if(!n)throw"no node passed";return new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:i,callback:function(t){if(!n)return;if(!n.graph)throw new NullGraphError;n.graph.beforeChange();const e=function(e){e.shape=t},i=LGraphCanvas.active_canvas;if(!i.selected_nodes||Object.keys(i.selected_nodes).length<=1)e(n);else for(const r in i.selected_nodes)e(i.selected_nodes[r]);n.graph.afterChange(),i.setDirty(!0)},parentMenu:r,node:n}),!1}static onMenuNodeRemove(){LGraphCanvas.active_canvas.deleteSelected()}onMenuNodeToSubgraph(t,e,i,r,n){var s=n.graph,o=LGraphCanvas.active_canvas;if(o){var a=Object.values(o.selected_nodes||{});a.length||(a=[n]);var l=LiteGraph.createNode("middle/graph/subgraph");l.pos=n.pos.concat(),s.add(l),l.buildFromNodes(a),o.deselectAllNodes(),n.setDirtyCanvas(!0,!0)}}static onMenuNodeClone(t,e,i,r,n){const{graph:s}=n;if(!s)throw new NullGraphError;s.beforeChange();const o=new Set,a=function(t,e){if(!1===t.clonable)return;const i=t.clone();if(i){if(i.pos=[t.pos[0]+5,t.pos[1]+5],!t.graph)throw new NullGraphError;t.graph.add(i),e.add(i)}},l=LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)a(n,o);else for(const c in l.selected_nodes)a(l.selected_nodes[c],o);o.size&&l.selectNodes([...o]),s.afterChange(),l.setDirty(!0,!0)}clear(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.selectedItems.clear(),this.onSelectionChange?.(this.selected_nodes),this.visible_nodes=[],this.node_over=void 0,this.node_capturing_input=null,this.connecting_links=null,this.highlighted_links={},this.dragging_canvas=!1,this.#it(),this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer.reset(),this.visible_area.set([0,0,0,0]),this.onClear?.()}setGraph(t,e){this.graph!=t&&(e||this.clear(),t||!this.graph?(t.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)):this.graph.detachCanvas(this))}getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}getCurrentGraph(){return this.graph}#rt(t){if("string"==typeof t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw"Error validating LiteGraph canvas: Canvas element not found";return e}return t}setCanvas(t,e){const i=this.#rt(t);if(i===this.canvas)return;if(i||!this.canvas||e||this.unbindEvents(),this.canvas=i,this.ds.element=i,this.pointer.element=i,!i)return;i.className+=" lgraphcanvas",i.data=this,this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height;const r=i.getContext?.("2d");if(null==r){if("canvas"!=i.localName)throw`Element supplied for LGraphCanvas must be a <canvas> element, you passed a ${i.localName}`;throw"This browser doesn't support Canvas"}this.ctx=r,e||this.bindEvents()}_doNothing(t){return t.preventDefault(),!1}_doReturnTrue(t){return t.preventDefault(),!0}bindEvents(){if(this._events_binded)return void console.warn("LGraphCanvas: events already binded");const{canvas:t}=this,{document:e}=this.getCanvasWindow();this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),this._mouseout_callback=this.processMouseOut.bind(this),this._mousecancel_callback=this.processMouseCancel.bind(this),t.addEventListener("pointerdown",this._mousedown_callback,!0),t.addEventListener("wheel",this._mousewheel_callback,!1),t.addEventListener("pointerup",this._mouseup_callback,!0),t.addEventListener("pointermove",this._mousemove_callback),t.addEventListener("pointerout",this._mouseout_callback),t.addEventListener("pointercancel",this._mousecancel_callback,!0),t.addEventListener("contextmenu",this._doNothing),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback,!0),e.addEventListener("keyup",this._key_callback,!0),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0}unbindEvents(){if(!this._events_binded)return void console.warn("LGraphCanvas: no events binded");const{document:t}=this.getCanvasWindow(),{canvas:e}=this;e.removeEventListener("pointercancel",this._mousecancel_callback),e.removeEventListener("pointerout",this._mouseout_callback),e.removeEventListener("pointermove",this._mousemove_callback),e.removeEventListener("pointerup",this._mouseup_callback),e.removeEventListener("pointerdown",this._mousedown_callback),e.removeEventListener("wheel",this._mousewheel_callback),e.removeEventListener("keydown",this._key_callback),t.removeEventListener("keyup",this._key_callback),e.removeEventListener("contextmenu",this._doNothing),e.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=void 0,this._mousewheel_callback=void 0,this._key_callback=void 0,this._events_binded=!1}setDirty(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)}#it(){this.dirty_canvas=!0,this.dirty_bgcanvas=!0}getCanvasWindow(){if(!this.canvas)return window;const t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow}startRendering(){this.is_rendering||(this.is_rendering=!0,function t(){this.pause_rendering||this.draw();const e=this.getCanvasWindow();if(this.is_rendering)if(this.#G>0){const e=this.#G-(LiteGraph.getTime()-this.last_draw_time);setTimeout(t.bind(this),Math.max(1,e))}else e.requestAnimationFrame(t.bind(this))}.call(this))}stopRendering(){this.is_rendering=!1}blockClick(){this.block_click=!0,this.last_mouseclick=0}getWidgetAtCursor(t){return t??=this.node_over,t?.getWidgetOnPos(this.graph_mouse[0],this.graph_mouse[1],!0)??null}updateMouseOverNodes(t,e){if(!this.graph)throw new NullGraphError;const i=this.graph._nodes;for(const r of i)r.mouseOver&&t!=r&&(r.mouseOver=null,this._highlight_input=void 0,this._highlight_pos=void 0,this.linkConnector.overWidget=void 0,r.lostFocusAt=LiteGraph.getTime(),this.node_over?.onMouseLeave?.(e),this.node_over=void 0,this.dirty_canvas=!0)}processMouseDown(t){if(this.dragZoomEnabled&&t.ctrlKey&&t.shiftKey&&!t.altKey&&t.buttons)return void(this.#H={pos:[t.x,t.y],scale:this.ds.scale});const{graph:e,pointer:i}=this;if(this.adjustMouseEvent(t),t.isPrimary&&i.down(t),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!e)return;const r=this.getCanvasWindow();LGraphCanvas.active_canvas=this;const n=t.clientX,s=t.clientY;this.ds.viewport=this.viewport;if(!(!this.viewport||isInRect(n,s,this.viewport)))return;const o=e.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes)??void 0;if(this.mouse[0]=n,this.mouse[1]=s,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],i.isDouble=i.isDown&&t.isPrimary,i.isDown=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(r),1!=this.onMouse?.(t)){if(0!==t.button||i.isDouble){if(1===t.button)this.#nt(t,o);else if((2===t.button||i.isDouble)&&this.allow_interaction&&!this.read_only){if(o)this.processSelect(o,t,!0);else if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const r=e.getRerouteOnPos(t.canvasX,t.canvasY);r&&(t.altKey?i.onClick=t=>{t.altKey&&(r.selected&&(this.deselect(r),this.onSelectionChange?.(this.selected_nodes)),r.remove())}:this.processSelect(r,t,!0))}i.onClick??=()=>this.processContextMenu(o,t)}}else this.#st(t,o);this.last_mouse=[n,s],this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,e.change(),(!r.document.activeElement||"input"!=r.document.activeElement.nodeName.toLowerCase()&&"textarea"!=r.document.activeElement.nodeName.toLowerCase())&&t.preventDefault(),t.stopPropagation(),this.onMouseDown?.(t)}}#st(t,e){const{pointer:i,graph:r,linkConnector:n}=this;if(!r)throw new NullGraphError;const s=t.canvasX,o=t.canvasY,a=t.ctrlKey||t.metaKey;if(a&&!t.altKey){const t=new Float32Array(4);return t[0]=s,t[1]=o,t[2]=1,t[3]=1,i.onClick=t=>{const i=e??r.getRerouteOnPos(t.canvasX,t.canvasY)??r.getGroupTitlebarOnPos(t.canvasX,t.canvasY);this.processSelect(i,t)},i.onDragStart=()=>this.dragging_rectangle=t,i.onDragEnd=e=>this.#ot(e,t),void(i.finally=()=>this.dragging_rectangle=null)}if(this.read_only)return i.finally=()=>this.dragging_canvas=!1,void(this.dragging_canvas=!0);if(LiteGraph.alt_drag_do_clone_nodes&&t.altKey&&!t.ctrlKey&&e&&this.allow_interaction){const t=e.clone()?.serialize();if(null!=t?.type){const e=LiteGraph.createNode(t.type);if(e)return e.configure(t),e.pos[0]+=5,e.pos[1]+=5,void(this.allow_dragnodes?(i.onDragStart=t=>{r.add(e,!1),this.#at(e,t)},i.onDragEnd=t=>this.#lt(t)):(r.beforeChange(),r.add(e,!1),r.afterChange()))}}if(e&&(this.allow_interaction||e.flags.allow_interaction))this.#ct(t,a,e);else{if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const e=r.getRerouteOnPos(s,o);if(e)return t.shiftKey&&(n.dragFromReroute(r,e),i.onDragEnd=t=>n.dropLinks(r,t),i.finally=()=>n.reset(!0),this.dirty_bgcanvas=!0),i.onClick=()=>this.processSelect(e,t),void(i.onDragEnd||(i.onDragStart=t=>this.#at(e,t,!0),i.onDragEnd=t=>this.#lt(t)))}const{lineWidth:e}=this.ctx;this.ctx.lineWidth=this.connections_width+7;const a=1;for(const c of this.renderedPaths){const l=c._pos;if(l)if((t.shiftKey||t.altKey)&&c.path&&this.ctx.isPointInStroke(c.path,s*a,o*a)){if(this.ctx.lineWidth=e,t.shiftKey&&!t.altKey)return n.dragFromLinkSegment(r,c),i.onDragEnd=t=>n.dropLinks(r,t),void(i.finally=()=>n.reset(!0));if(t.altKey&&!t.shiftKey){const t=r.createReroute([s,o],c);return i.onDragStart=e=>this.#at(t,e),void(i.onDragEnd=t=>this.#lt(t))}}else if(isInRectangle(s,o,l[0]-4,l[1]-4,8,8))return this.ctx.lineWidth=e,i.onClick=()=>this.showLinkMenu(c,t),i.onDragStart=()=>this.dragging_canvas=!0,i.finally=()=>this.dragging_canvas=!1,void(this.over_link_center=void 0)}this.ctx.lineWidth=e;const l=r.getGroupOnPos(s,o);if(this.selected_group=l??null,l){if(l.isInResize(s,o)){const t=l.boundingRect,e=s-(t[0]+t[2]),r=o-(t[1]+t[3]);i.onDragStart=()=>this.resizingGroup=l,i.onDrag=t=>{if(this.read_only)return;const i=[t.canvasX-l.pos[0]-e,t.canvasY-l.pos[1]-r];this.#et&&snapPoint(i,this.#et);l.resize(i[0],i[1])&&(this.dirty_bgcanvas=!0)},i.finally=()=>this.resizingGroup=null}else{const e=1.4*(l.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE);isInRectangle(s,o,l.pos[0],l.pos[1],l.size[0],e)&&(i.onClick=()=>this.processSelect(l,t),i.onDragStart=t=>{l.recomputeInsideNodes(),this.#at(l,t,!0)},i.onDragEnd=t=>this.#lt(t))}i.onDoubleClick=()=>{this.emitEvent({subType:"group-double-click",originalEvent:t,group:l})}}else i.onDoubleClick=()=>{this.allow_searchbox&&(this.showSearchBox(t),t.preventDefault()),this.emitEvent({subType:"empty-double-click",originalEvent:t})}}i.onDragStart||i.onClick||i.onDrag||!this.allow_dragcanvas||(i.onClick=()=>this.processSelect(null,t),i.finally=()=>this.dragging_canvas=!1,this.dragging_canvas=!0)}#ct(t,e,i){const{pointer:r,graph:n,linkConnector:s}=this;if(!n)throw new NullGraphError;const o=t.canvasX,a=t.canvasY;r.onClick=()=>this.processSelect(i,t),i.flags.pinned||this.bringToFront(i);const l=i.isPointInCollapse(o,a);if(l)r.onClick=()=>{i.collapse(),this.setDirty(!0,!0)};else if(!i.flags.collapsed){if(!1!==i.resizable&&i.inResizeCorner(o,a)){const t=i.boundingRect,e=o-(t[0]+t[2]),s=a-(t[1]+t[3]);return r.onDragStart=()=>{n.beforeChange(),this.resizing_node=i},r.onDrag=t=>{if(this.read_only)return;const r=[t.canvasX-i.pos[0]-e,t.canvasY-i.pos[1]-s];this.#et&&snapPoint(r,this.#et);const n=i.computeSize();r[0]=Math.max(n[0],r[0]),r[1]=Math.max(n[1],r[1]),i.setSize(r),this.#it()},r.onDragEnd=()=>{this.#it(),n.afterChange(this.resizing_node)},r.finally=()=>this.resizing_node=null,void(this.canvas.style.cursor="se-resize")}const{inputs:l,outputs:c}=i;if(c)for(const[h,u]of c.entries()){const l=i.getOutputPos(h);if(isInRectangle(o,a,l[0]-15,l[1]-10,30,20))return t.shiftKey&&(u.links?.length||u._floatingLinks?.size)?(s.moveOutputLink(n,u),r.onDragEnd=t=>s.dropLinks(n,t),void(r.finally=()=>s.reset(!0))):(s.dragNewFromOutput(n,i,u),r.onDragEnd=t=>s.dropLinks(n,t),r.finally=()=>s.reset(!0),LiteGraph.shift_click_do_break_link_from?t.shiftKey&&i.disconnectOutput(h):LiteGraph.ctrl_alt_click_do_break_link&&e&&t.altKey&&!t.shiftKey&&i.disconnectOutput(h),r.onDoubleClick=()=>i.onOutputDblClick?.(h,t),void(r.onClick=()=>i.onOutputClick?.(h,t)))}if(l)for(const[h,u]of l.entries()){const l=i.getInputPos(h);if(isInRectangle(o,a,l[0]-15,l[1]-10,30,20)){r.onDoubleClick=()=>i.onInputDblClick?.(h,t),r.onClick=()=>i.onInputClick?.(h,t);const o=LiteGraph.ctrl_alt_click_do_break_link&&e&&t.altKey&&!t.shiftKey;return(null!==u.link||u._floatingLinks?.size)&&(o||LiteGraph.click_do_break_link_to?i.disconnectInput(h,!0):(t.shiftKey||this.allow_reconnect_links)&&s.moveInputLink(n,u)),s.isConnecting||s.dragNewFromInput(n,i,u),r.onDragEnd=t=>s.dropLinks(n,t),r.finally=()=>s.reset(!0),void(this.dirty_bgcanvas=!0)}}}const c=[o-i.pos[0],a-i.pos[1]],h=i.getWidgetOnPos(o,a);if(h)this.#ht(t,i,h),this.node_widget=[i,h];else{if(r.onDoubleClick=()=>{c[1]<0&&!l&&i.onNodeTitleDblClick?.(t,c,this),i.onDblClick?.(t,c,this),this.emitEvent({subType:"node-double-click",originalEvent:t,node:i}),this.processNodeDblClicked(i)},i.onMouseDown?.(t,c,this)||!this.allow_dragnodes)return;r.onDragStart=t=>this.#at(i,t,!0),r.onDragEnd=t=>this.#lt(t)}this.dirty_canvas=!0}#ht(t,e,i){const{pointer:r}=this;if("function"==typeof i.onPointerDown){if(i.onPointerDown(r,e,this))return}const n=i.value,s=this.graph_mouse,o=s[0]-e.pos[0],a=s[1]-e.pos[1],l=WIDGET_TYPE_MAP[i.type];if(l){const n=toClass(l,i);r.onClick=()=>n.onClick({e:t,node:e,canvas:this}),r.onDrag=t=>n.onDrag?.({e:t,node:e,canvas:this})}else if(i.mouse){const r=i.mouse(t,[o,a],e);null!=r&&(this.dirty_canvas=r)}if(n!=i.value){if(e.onWidgetChanged?.(i.name,i.value,n,i),!e.graph)throw new NullGraphError;e.graph._version++}r.finally=()=>{if(i.mouse){const{eUp:t}=r;if(!t)return;const{canvasX:n,canvasY:s}=t;i.mouse(t,[n-e.pos[0],s-e.pos[1]],e)}this.node_widget=null}}#nt(t,e){const{pointer:i}=this;if(LiteGraph.middle_click_slot_add_default_node&&e&&this.allow_interaction&&!this.read_only&&!this.connecting_links&&!e.flags.collapsed){let r=!1,n=!1,s=!1;const{inputs:o,outputs:a}=e;if(a)for(const[i,l]of a.entries()){const o=e.getOutputPos(i);if(isInRectangle(t.canvasX,t.canvasY,o[0]-15,o[1]-10,30,20)){r=l,n=i,s=!0;break}}if(o)for(const[i,l]of o.entries()){const o=e.getInputPos(i);if(isInRectangle(t.canvasX,t.canvasY,o[0]-15,o[1]-10,30,20)){r=l,n=i,s=!1;break}}if(r&&!1!==n){const r=.5-(n+1)/(s?a.length:o.length),l=e.getBounding(),c=[s?l[0]+l[2]:l[0],t.canvasY-80];i.onClick=()=>this.createDefaultNodeForSlot({nodeFrom:s?e:null,slotFrom:s?n:null,nodeTo:s?null:e,slotTo:s?null:n,position:c,nodeType:"AUTO",posAdd:[s?30:-30,130*-r],posSizeFix:[s?0:-1,0]})}}this.allow_dragcanvas&&(i.onDragStart=()=>this.dragging_canvas=!0,i.finally=()=>this.dragging_canvas=!1)}#ut(t){if(!t.buttons)return void(this.#H=null);const e=this.#H;if(!e)throw new TypeError("Drag-zoom state object was null");if(!this.graph)throw new NullGraphError;const i=t.y-e.pos[1],r=e.scale-i/100;this.ds.changeScale(r,e.pos),this.graph.change()}processMouseMove(t){if(this.dragZoomEnabled&&t.ctrlKey&&t.shiftKey&&this.#H)return void this.#ut(t);this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);const{graph:e,resizingGroup:i,linkConnector:r}=this;if(!e)return;LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);const n=[t.clientX,t.clientY];this.mouse[0]=n[0],this.mouse[1]=n[1];const s=[n[0]-this.last_mouse[0],n[1]-this.last_mouse[1]];if(this.last_mouse=n,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,t.isPrimary&&this.pointer.move(t),this.block_click)return void t.preventDefault();if(t.dragging=this.last_mouse_dragging,this.node_widget){const[e,i]=this.node_widget;if(i?.mouse){const r=t.canvasX-e.pos[0],n=t.canvasY-e.pos[1],s=i.mouse(t,[r,n],e);null!=s&&(this.dirty_canvas=s)}}let o=CanvasItem.Nothing;const a=e.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),l=this.dragging_rectangle;if(l)l[2]=t.canvasX-l[0],l[3]=t.canvasY-l[1],this.dirty_canvas=!0;else if(i)o|=CanvasItem.ResizeSe|CanvasItem.Group;else if(this.dragging_canvas)this.ds.offset[0]+=s[0]/this.ds.scale,this.ds.offset[1]+=s[1]/this.ds.scale,this.#it();else if((this.allow_interaction||a?.flags.allow_interaction)&&!this.read_only){if(r.isConnecting&&(this.dirty_canvas=!0),this.updateMouseOverNodes(a,t),a){o|=CanvasItem.Node,a.redraw_on_mouse&&(this.dirty_canvas=!0);const e=[0,0],i=isOverNodeInput(a,t.canvasX,t.canvasY,e),n=isOverNodeOutput(a,t.canvasX,t.canvasY,e),s=a.getWidgetOnPos(t.canvasX,t.canvasY,!0);if(a.mouseOver||(a.mouseOver={inputId:null,outputId:null,overWidget:null},this.node_over=a,this.dirty_canvas=!0,a.onMouseEnter?.(t)),a.onMouseMove?.(t,[t.canvasX-a.pos[0],t.canvasY-a.pos[1]],this),a.mouseOver.inputId!==i||a.mouseOver.outputId!==n||a.mouseOver.overWidget!==s){if(a.mouseOver.inputId=i,a.mouseOver.outputId=n,a.mouseOver.overWidget=s,r.overWidget=void 0,r.isConnecting){const t=r.renderLinks.at(0);let s,o;if(t&&r.isNodeValidDrop(a)){if("input"===r.state.connectingTo)if(-1===i&&-1===n){if(!r.overWidget){const e=a.findInputByType(t.fromSlot.type);e&&(o=e.slot,s=a.getInputPos(e.index))}}else-1!=i&&a.inputs[i]&&LiteGraph.isValidConnection(t.fromSlot.type,a.inputs[i].type)&&(s=e,o=a.inputs[i]);else if("output"===r.state.connectingTo)if(-1===i&&-1===n){const e=a.findOutputByType(t.fromSlot.type);e&&(s=a.getOutputPos(e.index))}else-1!=n&&a.outputs[n]&&LiteGraph.isValidConnection(t.fromSlot.type,a.outputs[n].type)&&(s=e)}else;this._highlight_pos=s,this._highlight_input=o}this.dirty_canvas=!0}a.inResizeCorner(t.canvasX,t.canvasY)&&(o|=CanvasItem.ResizeSe)}else{const i=e.getRerouteOnPos(t.canvasX,t.canvasY);i?(o|=CanvasItem.Reroute,r.overReroute=i,r.isConnecting&&r.isRerouteValidDrop(i)&&(this._highlight_pos=i.pos)):(this._highlight_pos&&=void 0,r.overReroute&&=void 0);const n=this.#dt(t);if(this.over_link_center!==n&&(o|=CanvasItem.Link,this.over_link_center=n,this.dirty_bgcanvas=!0),this.canvas){const i=e.getGroupOnPos(t.canvasX,t.canvasY);i&&!t.ctrlKey&&!this.read_only&&i.isInResize(t.canvasX,t.canvasY)&&(o|=CanvasItem.ResizeSe)}}if(this.node_capturing_input&&this.node_capturing_input!=a&&this.node_capturing_input.onMouseMove?.(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]],this),this.isDragging){const e=this.selectedItems,i=t.ctrlKey?e:getAllNestedItems(e),r=s[0]/this.ds.scale,n=s[1]/this.ds.scale;for(const t of i)t.move(r,n,!0);this.#it()}this.resizing_node&&(o|=CanvasItem.ResizeSe)}this.hoveringOver=o,t.preventDefault()}#at(t,e,i=!1){this.emitBeforeChange(),this.graph?.beforeChange(),e.finally=()=>{this.isDragging=!1,this.graph?.afterChange(),this.emitAfterChange()},this.processSelect(t,e.eDown,i),this.isDragging=!0}#lt(t){const{graph:e}=this;(t.shiftKey||LiteGraph.alwaysSnapToGrid)&&e?.snapToGrid(this.selectedItems),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.onNodeMoved?.(findFirstNode(this.selectedItems))}processMouseUp(t){if(!1===t.isPrimary)return;const{graph:e,pointer:i}=this;if(!e)return;LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);const r=LiteGraph.getTime();t.click_time=r-this.last_mouseclick;if(!0===i.up(t))return i.isDown=!1,i.isDouble=!1,this.connecting_links=null,this.dragging_canvas=!1,e.change(),t.stopPropagation(),t.preventDefault(),this.last_mouse_dragging=!1,this.last_click_position=null,void(this.block_click&&(console.log("pointerevents: processMouseUp block_clicks"),this.block_click=!1));if(this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(console.log("pointerevents: processMouseUp block_clicks"),this.block_click=!1),0===t.button){this.selected_group=null,this.isDragging=!1;const e=t.canvasX,i=t.canvasY;this.linkConnector.isConnecting||(this.dirty_canvas=!0,this.node_over?.onMouseUp?.(t,[e-this.node_over.pos[0],i-this.node_over.pos[1]],this),this.node_capturing_input?.onMouseUp?.(t,[e-this.node_capturing_input.pos[0],i-this.node_capturing_input.pos[1]]))}else 1===t.button?(this.dirty_canvas=!0,this.dragging_canvas=!1):2===t.button&&(this.dirty_canvas=!0);i.isDown=!1,i.isDouble=!1,e.change(),t.stopPropagation(),t.preventDefault()}processMouseOut(t){}processMouseCancel(){console.warn("Pointer cancel!"),this.pointer.reset()}processMouseWheel(t){if(!this.graph||!this.allow_dragcanvas)return;const e=t.wheelDeltaY??-60*t.detail;this.adjustMouseEvent(t);const i=[t.clientX,t.clientY];if(this.viewport&&!isPointInRect(i,this.viewport))return;let{scale:r}=this.ds;e>0?r*=this.zoom_speed:e<0&&(r*=1/this.zoom_speed),this.ds.changeScale(r,[t.clientX,t.clientY]),this.graph.change(),t.preventDefault()}processKey(t){if(this.#Y=t.shiftKey,!this.graph)return;let e=!1;if("input"!=t.target.localName){if("keydown"==t.type){if(" "===t.key)this.read_only=!0,null===this._previously_dragging_canvas&&(this._previously_dragging_canvas=this.dragging_canvas),this.dragging_canvas=this.pointer.isDown,e=!0;else if("Escape"===t.key){if(this.linkConnector.isConnecting)return this.linkConnector.reset(),void t.preventDefault();this.node_panel?.close(),this.options_panel?.close(),e=!0}else 65===t.keyCode&&t.ctrlKey?(this.selectItems(),e=!0):67!==t.keyCode||!t.metaKey&&!t.ctrlKey||t.shiftKey?86===t.keyCode&&(t.metaKey||t.ctrlKey)?this.pasteFromClipboard({connectInputs:t.shiftKey}):"Delete"!==t.key&&"Backspace"!==t.key||"input"!=t.target.localName&&"textarea"!=t.target.localName&&(this.deleteSelected(),e=!0):this.selected_nodes&&(this.copyToClipboard(),e=!0);if(this.selected_nodes)for(const e in this.selected_nodes)this.selected_nodes[e].onKeyDown?.(t)}else if("keyup"==t.type&&(" "===t.key&&(this.read_only=!1,this.dragging_canvas=(this._previously_dragging_canvas??!1)&&this.pointer.isDown,this._previously_dragging_canvas=null),this.selected_nodes))for(const e in this.selected_nodes)this.selected_nodes[e].onKeyUp?.(t);return this.graph.change(),e?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}copyToClipboard(t){const e={nodes:[],groups:[],reroutes:[],links:[]};for(const i of t??this.selectedItems)if(i instanceof LGraphNode){if(!1===i.clonable)continue;const t=i.clone()?.serialize();if(!t)continue;if(t.id=i.id,e.nodes.push(t),i.inputs)for(const{link:r}of i.inputs){if(null==r)continue;const t=this.graph?._links.get(r)?.asSerialisable();t&&e.links.push(t)}}else i instanceof LGraphGroup?e.groups.push(i.serialize()):i instanceof Reroute&&e.reroutes.push(i.asSerialisable());localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(e))}emitEvent(t){this.canvas.dispatchEvent(new CustomEvent("litegraph:canvas",{bubbles:!0,detail:t}))}emitBeforeChange(){this.emitEvent({subType:"before-change"})}emitAfterChange(){this.emitEvent({subType:"after-change"})}_pasteFromClipboard(t={}){const{connectInputs:e=!1,position:i=this.graph_mouse}=t;if(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&e)return;const r=localStorage.getItem("litegrapheditor_clipboard");if(!r)return;const{graph:n}=this;if(!n)throw new NullGraphError;n.beforeChange();const s=JSON.parse(r);s.nodes??=[],s.groups??=[],s.reroutes??=[],s.links??=[];let o=1/0,a=1/0;for(const p of[...s.nodes,...s.reroutes]){if(null==p.pos)throw new TypeError("Invalid node encounterd on paste.  `pos` was null.");p.pos[0]<o&&(o=p.pos[0]),p.pos[1]<a&&(a=p.pos[1])}if(s.groups)for(const p of s.groups)p.bounding[0]<o&&(o=p.bounding[0]),p.bounding[1]<a&&(a=p.bounding[1]);const l={created:[],nodes:new Map,links:new Map,reroutes:new Map},{created:c,nodes:h,links:u,reroutes:d}=l;for(const p of s.groups){p.id=-1;const t=new LGraphGroup;t.configure(p),n.add(t),c.push(t)}for(const p of s.nodes){const t=null==p.type?null:LiteGraph.createNode(p.type);t&&(h.set(p.id,t),p.id=-1,t.configure(p),n.add(t),c.push(t))}for(const p of s.reroutes){const{id:t,...e}=p,i=n.setReroute(e);c.push(i),d.set(t,i)}for(const p of d.values()){if(null==p.parentId)continue;const t=d.get(p.parentId);t&&(p.parentId=t.id)}for(const p of s.links){let t,i=h.get(p.origin_id);null!=p.parentId&&(t=d.get(p.parentId)?.id),e&&LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&(i??=n.getNodeById(p.origin_id),t??=p.parentId);const r=h.get(p.target_id);if(r){const e=i?.connect(p.origin_slot,r,p.target_slot,t);e&&u.set(p.id,e)}}for(const p of d.values()){const t=[...p.linkIds].map((t=>u.get(t)?.id??t));p.update(p.parentId,void 0,t,p.floating),p.validateLinks(n.links,n.floatingLinks)||n.removeReroute(p.id)}for(const p of c)p.pos[0]+=i[0]-o,p.pos[1]+=i[1]-a;return this.selectItems(c),n.afterChange(),l}pasteFromClipboard(t={}){this.emitBeforeChange();try{this._pasteFromClipboard(t)}finally{this.emitAfterChange()}}processNodeDblClicked(t){this.onShowNodePanel?.(t),this.onNodeDblClicked?.(t),this.setDirty(!0)}#ot(t,e){const{graph:i,selectedItems:r}=this;if(!i)throw new NullGraphError;const n=Math.abs(e[2]),s=Math.abs(e[3]);e[2]<0&&(e[0]-=n),e[3]<0&&(e[1]-=s),e[2]=n,e[3]=s;const o=[],a=[];for(const l of i._nodes)overlapBounding(e,l.boundingRect)&&(l.selected&&r.has(l)?o.push(l):a.push(l));for(const l of i.groups)containsRect(e,l._bounding)&&(l.recomputeInsideNodes(),l.selected&&r.has(l)?o.push(l):a.push(l));for(const l of i.reroutes.values())isPointInRect(l.pos,e)&&(r.add(l),l.selected=!0,l.selected&&r.has(l)?o.push(l):a.push(l));if(t.shiftKey)for(const l of a)this.select(l);else if(t.altKey)for(const l of o)this.deselect(l);else{for(const t of r.values())o.includes(t)||this.deselect(t);for(const t of a)this.select(t)}this.onSelectionChange?.(this.selected_nodes)}processSelect(t,e,i=!1){const r=e?.shiftKey,n=null!=e&&(e.metaKey||e.ctrlKey),s=r||n,o=s||this.multi_select;if(t)if(t.selected&&this.selectedItems.has(t))if(o&&!i)this.deselect(t);else{if(i)return;this.deselectAll(t)}else o||this.deselectAll(t),this.select(t);else s&&!this.multi_select||this.deselectAll();this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0)}select(t){if((!t.selected||!this.selectedItems.has(t))&&(t.selected=!0,this.selectedItems.add(t),t instanceof LGraphNode)){if(t.onSelected?.(),this.selected_nodes[t.id]=t,this.onNodeSelected?.(t),t.inputs)for(const e of t.inputs)null!=e.link&&(this.highlighted_links[e.link]=!0);if(t.outputs)for(const e of t.outputs.flatMap((t=>t.links)))null!=e&&(this.highlighted_links[e]=!0)}}deselect(t){if(!t.selected&&!this.selectedItems.has(t))return;if(t.selected=!1,this.selectedItems.delete(t),!(t instanceof LGraphNode))return;t.onDeselected?.(),delete this.selected_nodes[t.id],this.onNodeDeselected?.(t);const{graph:e}=this;if(e){if(t.inputs)for(const i of t.inputs){if(null==i.link)continue;const t=LLink.getOriginNode(e,i.link);t&&this.selectedItems.has(t)||delete this.highlighted_links[i.link]}if(t.outputs)for(const i of t.outputs.flatMap((t=>t.links))){if(null==i)continue;const t=LLink.getTargetNode(e,i);t&&this.selectedItems.has(t)||delete this.highlighted_links[i]}}}processNodeSelected(t,e){this.processSelect(t,e,e&&(e.shiftKey||e.metaKey||e.ctrlKey||this.multi_select))}selectNode(t,e){null==t?this.deselectAll():this.selectNodes([t],e)}get empty(){if(!this.graph)throw new NullGraphError;return this.graph.empty}get positionableItems(){if(!this.graph)throw new NullGraphError;return this.graph.positionableItems()}selectItems(t,e){const i=t??this.positionableItems;e||this.deselectAll();for(const r of i)this.select(r);this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0)}selectNodes(t,e){this.selectItems(t,e)}deselectNode(t){this.deselect(t)}deselectAll(t){if(!this.graph)return;const e=this.selectedItems;if(!e.size)return;let i;for(const n of e)n!==t?(n.onDeselected?.(),n.selected=!1):i=n;e.clear(),i&&e.add(i),this.setDirty(!0);const r=null==t?.id?null:this.selected_nodes[t.id];if(this.selected_nodes={},this.current_node=null,this.highlighted_links={},t instanceof LGraphNode){if(r&&(this.selected_nodes[r.id]=r),t.inputs)for(const e of t.inputs)null!=e.link&&(this.highlighted_links[e.link]=!0);if(t.outputs)for(const e of t.outputs.flatMap((t=>t.links)))null!=e&&(this.highlighted_links[e]=!0)}this.onSelectionChange?.(this.selected_nodes)}deselectAllNodes(){this.deselectAll()}deleteSelected(){const{graph:t}=this;if(!t)throw new NullGraphError;this.emitBeforeChange(),t.beforeChange();for(const e of this.selectedItems)if(e instanceof LGraphNode){const i=e;if(i.block_delete)continue;i.connectInputToOutput(),t.remove(i),this.onNodeDeselected?.(i)}else e instanceof LGraphGroup?t.remove(e):e instanceof Reroute&&t.removeReroute(e.id);this.selected_nodes={},this.selectedItems.clear(),this.current_node=null,this.highlighted_links={},this.onSelectionChange?.(this.selected_nodes),this.setDirty(!0),t.afterChange(),this.emitAfterChange()}deleteSelectedNodes(){this.deleteSelected()}centerOnNode(t){this.ds.offset[0]=-t.pos[0]-.5*t.size[0]+.5*this.canvas.width/(1*this.ds.scale),this.ds.offset[1]=-t.pos[1]-.5*t.size[1]+.5*this.canvas.height/(1*this.ds.scale),this.setDirty(!0,!0)}adjustMouseEvent(t){let e=t.clientX,i=t.clientY;if(this.canvas){const t=this.canvas.getBoundingClientRect();e-=t.left,i-=t.top}t.safeOffsetX=e,t.safeOffsetY=i,void 0===t.deltaX&&(t.deltaX=e-this.last_mouse_position[0]),void 0===t.deltaY&&(t.deltaY=i-this.last_mouse_position[1]),this.last_mouse_position[0]=e,this.last_mouse_position[1]=i,t.canvasX=e/this.ds.scale-this.ds.offset[0],t.canvasY=i/this.ds.scale-this.ds.offset[1]}setZoom(t,e){this.ds.changeScale(t,e),this.#it()}convertOffsetToCanvas(t,e){return this.ds.convertOffsetToCanvas(t,e)}convertCanvasToOffset(t,e){return this.ds.convertCanvasToOffset(t,e)}convertEventToCanvasOffset(t){const e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])}bringToFront(t){const{graph:e}=this;if(!e)throw new NullGraphError;const i=e._nodes.indexOf(t);-1!=i&&(e._nodes.splice(i,1),e._nodes.push(t))}sendToBack(t){const{graph:e}=this;if(!e)throw new NullGraphError;const i=e._nodes.indexOf(t);-1!=i&&(e._nodes.splice(i,1),e._nodes.unshift(t))}computeVisibleNodes(t,e){const i=e||[];if(i.length=0,!this.graph)throw new NullGraphError;const r=t||this.graph._nodes;for(const n of r)n.updateArea(this.ctx),overlapBounding(this.visible_area,n.renderArea)&&i.push(n);return i}isNodeVisible(t){return this.#U.has(t.id)}draw(t,e){if(!this.canvas||0==this.canvas.width||0==this.canvas.height)return;const i=LiteGraph.getTime();this.render_time=.001*(i-this.last_draw_time),this.last_draw_time=i,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_canvas||t)&&(this.computeVisibleNodes(void 0,this.visible_nodes),this.#U=new Set(this.visible_nodes.map((t=>t.id)))),(this.dirty_bgcanvas||e||this.always_render_background||this.graph?._last_trigger_time&&i-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame++}drawFrontCanvas(){this.dirty_canvas=!1;const{ctx:t,canvas:e,linkConnector:i}=this;t.start2D&&!this.viewport&&(t.start2D(),t.restore(),t.setTransform(1,0,0,1,0,0));const r=this.viewport||this.dirty_area;if(r&&(t.save(),t.beginPath(),t.rect(r[0],r[1],r[2],r[3]),t.clip()),this.#et=this.#Y||LiteGraph.alwaysSnapToGrid?this.graph?.getSnapToGridSize():void 0,this.clear_background&&(r?t.clearRect(r[0],r[1],r[2],r[3]):t.clearRect(0,0,e.width,e.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender?.(e,t),this.show_info&&this.renderInfo(t,r?r[0]:0,r?r[1]:0),this.graph){t.save(),this.ds.toCanvasContext(t);const{visible_nodes:e}=this,r=this.#et&&this.isDragging;for(const i of e)t.save(),r&&this.selectedItems.has(i)&&this.drawSnapGuide(t,i),t.translate(i.pos[0],i.pos[1]),this.drawNode(i,t),t.restore();if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&this.drawConnections(t),i.isConnecting){const{renderLinks:e}=i,r=this.#pt();t.lineWidth=this.connections_width;for(const i of e){const{fromSlot:e,fromPos:n,fromDirection:s,dragDirection:o}=i,a=e.shape,l=e.type,c=l===LiteGraph.EVENT?LiteGraph.EVENT_LINK_COLOR:LiteGraph.CONNECTING_LINK_COLOR;this.renderLink(t,n,r,null,!1,null,c,s,o),t.beginPath(),l===LiteGraph.EVENT||a===RenderShape.BOX?(t.rect(n[0]-6+.5,n[1]-5+.5,14,10),t.fill(),t.beginPath(),t.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):a===RenderShape.ARROW?(t.moveTo(n[0]+8,n[1]+.5),t.lineTo(n[0]-4,n[1]+6+.5),t.lineTo(n[0]-4,n[1]-6+.5),t.closePath()):(t.arc(n[0],n[1],4,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,2*Math.PI)),t.fill()}this.#ft(t,r)}if(this.dragging_rectangle){const{eDown:e,eMove:i}=this.pointer;if(t.strokeStyle="#FFF",e&&i){const r=t.getTransform(),n=1;t.setTransform(n,0,0,n,0,0);const s=e.safeOffsetX,o=e.safeOffsetY;t.strokeRect(s,o,i.safeOffsetX-s,i.safeOffsetY-o),t.setTransform(r)}else{const[e,i,r,n]=this.dragging_rectangle;t.strokeRect(e,i,r,n)}}!this.isDragging&&this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip?.(t,null),this.onDrawForeground?.(t,this.visible_area),t.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(t),this.onDrawOverlay?.(t),r&&t.restore()}drawSubgraphPanel(t){var e=this.graph,i=e._subgraph_node;i?(this.drawSubgraphPanelLeft(e,i,t),this.drawSubgraphPanelRight(e,i,t)):console.warn("subgraph without subnode")}drawSubgraphPanelLeft(t,e,i){var r=e.inputs?e.inputs.length:0,n=200,s=Math.floor(1.6*LiteGraph.NODE_SLOT_HEIGHT);if(i.fillStyle="#111",i.globalAlpha=.8,i.beginPath(),i.roundRect(10,10,n,(r+1)*s+50,[8]),i.fill(),i.globalAlpha=1,i.fillStyle="#888",i.font="14px Arial",i.textAlign="left",i.fillText("Graph Inputs",20,34),this.drawButton(180,20,20,20,"X","#151515"))this.closeSubgraph();else{var o=50;if(i.font="14px Arial",e.inputs)for(var a=0;a<e.inputs.length;++a){var l=e.inputs[a];if(!l.not_subgraph_input){if(this.drawButton(20,o+2,180,s-2)){var c=e.constructor.input_node_type||"middle/graph/input";this.graph.beforeChange();var h=LiteGraph.createNode(c);h?(t.add(h),this.block_click=!1,this.last_click_position=null,this.selectNodes([h]),this.node_dragged=h,this.dragging_canvas=!1,h.setProperty("name",l.name),h.setProperty("type",l.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",c)}i.fillStyle="#9C9",i.beginPath(),i.arc(184,o+.5*s,5,0,2*Math.PI),i.fill(),i.fillStyle="#AAA",i.fillText(l.name,30,o+.75*s),i.fillStyle="#777",i.fillText(l.type,130,o+.75*s),o+=s}}this.drawButton(20,o+2,180,s-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(e)}}drawSubgraphPanelRight(t,e,i){var r=e.outputs?e.outputs.length:0,n=this.bgcanvas.width,s=200,o=Math.floor(1.6*LiteGraph.NODE_SLOT_HEIGHT);i.fillStyle="#111",i.globalAlpha=.8,i.beginPath(),i.roundRect(n-s-10,10,s,(r+1)*o+50,[8]),i.fill(),i.globalAlpha=1,i.fillStyle="#888",i.font="14px Arial",i.textAlign="left";var a="Graph Outputs",l=i.measureText(a).width;if(i.fillText(a,n-l-20,34),this.drawButton(n-s,20,20,20,"X","#151515"))this.closeSubgraph();else{var c=50;if(i.font="14px Arial",e.outputs)for(var h=0;h<e.outputs.length;++h){var u=e.outputs[h];if(!u.not_subgraph_input){if(this.drawButton(n-s,c+2,180,o-2)){var d=e.constructor.output_node_type||"middle/graph/output";this.graph.beforeChange();var p=LiteGraph.createNode(d);p?(t.add(p),this.block_click=!1,this.last_click_position=null,this.selectNodes([p]),this.node_dragged=p,this.dragging_canvas=!1,p.setProperty("name",u.name),p.setProperty("type",u.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",d)}i.fillStyle="#9C9",i.beginPath(),i.arc(n-s+16,c+.5*o,5,0,2*Math.PI),i.fill(),i.fillStyle="#AAA",i.fillText(u.name,n-s+30,c+.75*o),i.fillStyle="#777",i.fillText(u.type,n-s+130,c+.75*o),c+=o}}this.drawButton(n-s,c+2,180,o-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(e)}}drawButton(t,e,i,r,n,s,o,a){var l=this.ctx;s=s||LiteGraph.NODE_DEFAULT_COLOR,o=o||"#555",a=a||LiteGraph.NODE_TEXT_COLOR;var c=this.ds.convertOffsetToCanvas(this.graph_mouse),h=LiteGraph.isInsideRectangle(c[0],c[1],t,e,i,r);if(c=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null){var u=this.canvas.getBoundingClientRect();c[0]-=u.left,c[1]-=u.top}var d=c&&LiteGraph.isInsideRectangle(c[0],c[1],t,e,i,r);l.fillStyle=h?o:s,d&&(l.fillStyle="#AAA"),l.beginPath(),l.roundRect(t,e,i,r,[4]),l.fill(),null!=n&&n.constructor==String&&(l.fillStyle=a,l.textAlign="center",l.font=(.65*r|0)+"px Arial",l.fillText(n,t+.5*i,e+.75*r),l.textAlign="left");var p=d&&!this.block_click;return d&&this.blockClick(),p}isAreaClicked(t,e,i,r,n){var s=this.mouse;LiteGraph.isInsideRectangle(s[0],s[1],t,e,i,r);var o=(s=this.last_click_position)&&LiteGraph.isInsideRectangle(s[0],s[1],t,e,i,r),a=o&&!this.block_click;return o&&n&&this.blockClick(),a}#dt(t){for(const e of this.renderedPaths){const i=e._pos;if(i&&isInRectangle(t.canvasX,t.canvasY,i[0]-4,i[1]-4,8,8))return e}}#pt(){return LiteGraph.snaps_for_comfy?this._highlight_pos??this.graph_mouse:this.graph_mouse}#ft(t,e){if(!this._highlight_pos)return;t.fillStyle="#ffcc00",t.beginPath();const i=this._highlight_input?.shape;if(i===RenderShape.ARROW?(t.moveTo(e[0]+8,e[1]+.5),t.lineTo(e[0]-4,e[1]+6+.5),t.lineTo(e[0]-4,e[1]-6+.5),t.closePath()):t.arc(e[0],e[1],6,0,2*Math.PI),t.fill(),!LiteGraph.snap_highlights_node)return;const{linkConnector:r}=this,{overReroute:n,overWidget:s}=r;if(n){const{globalAlpha:e}=t;t.globalAlpha=1,n.drawHighlight(t,"#ffcc00aa"),t.globalAlpha=e}const o=this.node_over;if(!o||!r.isConnecting)return;const{strokeStyle:a,lineWidth:l}=t,c=o.boundingRect,h=LiteGraph.ROUND_RADIUS+3,u=c[0]-3,d=c[1]-3,p=c[2]+6,f=c[3]+6;t.beginPath(),t.roundRect(u,d,p,f,h);const _="output"===r.state.connectingTo?0:1,m=_?-1:1,g=e[0],y=e[1],v=p<f?p:p*Math.max(f/p,.5),b=t.createRadialGradient(g,y,0,g,y,v);b.addColorStop(1,"#00000000"),b.addColorStop(0,"#ffcc00aa");const x=t.createLinearGradient(u,d,u+p,d);if(x.addColorStop(.5,"#00000000"),x.addColorStop(_+.67*m,"#ddeeff33"),x.addColorStop(_+m,"#ffcc0055"),t.setLineDash([h,.001*h]),t.lineWidth=1,t.strokeStyle=x,t.stroke(),s){const{computedHeight:e}=s;t.beginPath();const{pos:[i,r]}=o,n=LiteGraph.NODE_WIDGET_HEIGHT;s.type.startsWith("custom")&&null!=e&&e>2*n?t.rect(i+9,r+s.y+9,(s.width??c[2])-18,e-18):t.roundRect(i+15,r+s.y,s.width??c[2],n,.5*n),t.stroke()}t.strokeStyle=b,t.stroke(),t.setLineDash([]),t.lineWidth=l,t.strokeStyle=a}renderInfo(t,e,i){e=e||10,i=i||this.canvas.offsetHeight-80,t.save(),t.translate(e,i),t.font="10px Arial",t.fillStyle="#888",t.textAlign="left",this.graph?(t.fillText(`T: ${this.graph.globaltime.toFixed(2)}s`,5,13),t.fillText(`I: ${this.graph.iteration}`,5,26),t.fillText(`N: ${this.graph._nodes.length} [${this.visible_nodes.length}]`,5,39),t.fillText(`V: ${this.graph._version}`,5,52),t.fillText(`FPS:${this.fps.toFixed(2)}`,5,65)):t.fillText("No graph selected",5,13),t.restore()}drawBackCanvas(){const t=this.bgcanvas;t.width==this.canvas.width&&t.height==this.canvas.height||(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));const e=this.bgctx;if(!e)throw new TypeError("Background canvas context was null.");const i=this.viewport||[0,0,e.canvas.width,e.canvas.height];if(this.clear_background&&e.clearRect(i[0],i[1],i[2],i[3]),this._graph_stack&&this._graph_stack.length){e.save(),this._graph_stack[this._graph_stack.length-1];var r=this.graph._subgraph_node;e.strokeStyle=r.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=r.bgcolor||"#AAA";for(var n="",s=1;s<this._graph_stack.length;++s)n+=this._graph_stack[s]._subgraph_node.getTitle()+" >> ";e.fillText(n+r.getTitle(),.5*t.width,40),e.restore()}const o=!!this.onRenderBackground&&this.onRenderBackground(t,e);if(!this.viewport){const t=1;e.restore(),e.setTransform(t,0,0,t,0,0)}if(this.graph){if(e.save(),this.ds.toCanvasContext(e),this.ds.scale<1.5&&!o&&this.clear_background_color&&(e.fillStyle=this.clear_background_color,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!o){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;const t=this;this._bg_img.addEventListener("load",(function(){t.draw(!0,!0)}))}let t=this._pattern;null==t&&this._bg_img.width>0&&(t=e.createPattern(this._bg_img,"repeat")??void 0,this._pattern_img=this._bg_img,this._pattern=t),t&&(e.fillStyle=t,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=!0}this.graph._groups.length&&this.drawGroups(t,e),this.onDrawBackground?.(e,this.visible_area),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}this.dirty_bgcanvas=!1,this.dirty_canvas=!0}drawNode(t,e){this.current_node=t;const i=t.renderingColor,r=t.renderingBgColor,{low_quality:n,editor_alpha:s}=this;if(e.globalAlpha=s,this.render_shadows&&!n?(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",t.flags.collapsed&&1==t.onDrawCollapsed?.(e,this))return;const o=t._shape||RenderShape.BOX,a=LGraphCanvas.#z;a.set(t.renderingSize),t.collapsed&&(e.font=this.inner_text_font),t.clip_area&&(e.save(),e.beginPath(),o==RenderShape.BOX?e.rect(0,0,a[0],a[1]):o==RenderShape.ROUND?e.roundRect(0,0,a[0],a[1],[10]):o==RenderShape.CIRCLE&&e.arc(.5*a[0],.5*a[1],.5*a[0],0,2*Math.PI),e.clip()),this.drawNodeShape(t,e,a,i,r,!!t.selected),n||t.drawBadges(e),e.shadowColor="transparent",e.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.onDrawForeground?.(e,this,this.canvas),e.font=this.inner_text_font,t.collapsed?this.render_collapsed_slots&&t.drawCollapsedSlots(e):(t.arrange(),t.drawSlots(e,{fromSlot:this.linkConnector.renderLinks[0]?.fromSlot,colorContext:this,editorAlpha:this.editor_alpha,lowQuality:this.low_quality}),e.textAlign="left",e.globalAlpha=1,this.drawNodeWidgets(t,null,e)),t.clip_area&&e.restore(),e.globalAlpha=1}drawLinkTooltip(t,e){const i=e._pos;if(t.fillStyle="black",t.beginPath(),this.linkMarkerShape===LinkMarkerShape.Arrow){const r=t.getTransform();t.translate(i[0],i[1]),Number.isFinite(e._centreAngle)&&t.rotate(e._centreAngle),t.moveTo(-2,-3),t.lineTo(4,0),t.lineTo(-2,3),t.setTransform(r)}else null!=this.linkMarkerShape&&this.linkMarkerShape!==LinkMarkerShape.Circle||t.arc(i[0],i[1],3,0,2*Math.PI);t.fill();const{data:r}=e;if(null==r)return;if(1==this.onDrawLinkTooltip?.(t,e,this))return;let n=null;if(n="number"==typeof r?r.toFixed(2):"string"==typeof r?`"${r}"`:"boolean"==typeof r?String(r):r.toToolTip?r.toToolTip():`[${r.constructor.name}]`,null==n)return;n=n.substring(0,30),t.font="14px Courier New";const s=t.measureText(n).width+20;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(i[0]-.5*s,i[1]-15-24,s,24,[3]),t.moveTo(i[0]-10,i[1]-15),t.lineTo(i[0]+10,i[1]-15),t.lineTo(i[0],i[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(n,i[0],i[1]-15-24*.3)}drawNodeShape(t,e,i,r,n,s){e.strokeStyle=r,e.fillStyle=n;const o=LiteGraph.NODE_TITLE_HEIGHT,{low_quality:a}=this,{collapsed:l}=t.flags,c=t.renderingShape,{title_mode:h}=t,u=h!=TitleMode.TRANSPARENT_TITLE&&h!=TitleMode.NO_TITLE,d=LGraphCanvas.#W;d.set(t.boundingRect),d[0]-=t.pos[0],d[1]-=t.pos[1];const p=e.globalAlpha;e.beginPath(),c==RenderShape.BOX||a?e.fillRect(d[0],d[1],d[2],d[3]):c==RenderShape.ROUND||c==RenderShape.CARD?e.roundRect(d[0],d[1],d[2],d[3],c==RenderShape.CARD?[LiteGraph.ROUND_RADIUS,LiteGraph.ROUND_RADIUS,0,0]:[LiteGraph.ROUND_RADIUS]):c==RenderShape.CIRCLE&&e.arc(.5*i[0],.5*i[1],.5*i[0],0,2*Math.PI),e.fill(),!l&&u&&(e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,d[2],2)),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas,this.graph_mouse),(u||h==TitleMode.TRANSPARENT_TITLE)&&(t.drawTitleBarBackground(e,{scale:this.ds.scale,low_quality:a}),t.drawTitleBox(e,{scale:this.ds.scale,low_quality:a,box_size:10}),e.globalAlpha=p,t.drawTitleText(e,{scale:this.ds.scale,default_title_color:this.node_title_color,low_quality:a}),t.onDrawTitle?.(e,this.graph_mouse));for(const f of Object.values(t.strokeStyles)){const i=f.call(t);i&&strokeShape(e,d,{shape:c,title_height:o,title_mode:h,collapsed:l,...i})}t.drawProgressBar(e),null!=t.execute_triggered&&t.execute_triggered>0&&t.execute_triggered--,null!=t.action_triggered&&t.action_triggered>0&&t.action_triggered--}drawSnapGuide(t,e,i=RenderShape.ROUND){const r=LGraphCanvas.#X;r.set(e.boundingRect);const{pos:n}=e,s=n[0]-r[0],o=n[1]-r[1];r[0]+=s,r[1]+=o,this.#et&&snapPoint(r,this.#et),r[0]-=s,r[1]-=o;const{globalAlpha:a}=t;t.globalAlpha=1,t.beginPath();const[l,c,h,u]=r;if(i===RenderShape.CIRCLE){const e=l+.5*h,i=c+.5*u,r=Math.min(.5*h,.5*u);t.arc(e,i,r,0,2*Math.PI)}else t.rect(l,c,h,u);t.lineWidth=.5,t.strokeStyle="#FFFFFF66",t.fillStyle="#FFFFFF22",t.fill(),t.stroke(),t.globalAlpha=a}drawConnections(t){if(this.renderedPaths.clear(),this.links_render_mode===LinkRenderType.HIDDEN_LINK)return;const{graph:e}=this;if(!e)throw new NullGraphError;const i=[],r=LiteGraph.getTime(),{visible_area:n}=this;LGraphCanvas.#Z[0]=n[0]-20,LGraphCanvas.#Z[1]=n[1]-20,LGraphCanvas.#Z[2]=n[2]+40,LGraphCanvas.#Z[3]=n[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;const s=e._nodes;for(const o of s){const{inputs:n}=o;if(n?.length)for(const[s,a]of n.entries()){if(!a||null==a.link)continue;const n=a.link,l=e._links.get(n);if(!l)continue;const c=o.getInputPos(s),h=e.getNodeById(l.origin_id);if(null==h)continue;const u=l.origin_slot,d=-1===u?[h.pos[0]+10,h.pos[1]+10]:h.getOutputPos(u),p=h.outputs[u];p&&this.#_t(t,l,d,c,i,r,p.dir,a.dir)}}e.floatingLinks.size>0&&this.#mt(t,e,i,r),i.sort(((t,e)=>t.linkIds.size-e.linkIds.size));for(const o of i)this.#et&&this.isDragging&&this.selectedItems.has(o)&&this.drawSnapGuide(t,o,RenderShape.CIRCLE),o.draw(t,this._pattern);t.globalAlpha=1}#mt(t,e,i,r){const{globalAlpha:n}=t;t.globalAlpha=.33*n;for(const s of e.floatingLinks.values()){const n=LLink.getReroutes(e,s),o=n[0],a=n.at(-1);if(o&&a?.floating)if("input"===a.floating.slotType){const n=e.getNodeById(s.target_id);if(!n)continue;const a=o.pos,l=n.getInputPos(s.target_slot),c=n.inputs[s.target_slot]?.dir;o._dragging=!0,this.#_t(t,s,a,l,i,r,LinkDirection.CENTER,c,!0)}else{const n=e.getNodeById(s.origin_id);if(!n)continue;const o=n.getOutputPos(s.origin_slot),l=a.pos,c=n.outputs[s.origin_slot]?.dir;s._dragging=!0,this.#_t(t,s,o,l,i,r,c,LinkDirection.CENTER,!0)}}t.globalAlpha=n}#_t(t,e,i,r,n,s,o,a,l=!1){const{graph:c,renderedPaths:h}=this;if(!c)return;const u=LLink.getReroutes(c,e),d=[i,...u.map((t=>t.pos)),r],p=d.map((t=>t[0])),f=d.map((t=>t[1]));if(LGraphCanvas.#J[0]=Math.min(...p),LGraphCanvas.#J[1]=Math.min(...f),LGraphCanvas.#J[2]=Math.max(...p)-LGraphCanvas.#J[0],LGraphCanvas.#J[3]=Math.max(...f)-LGraphCanvas.#J[1],!overlapBounding(LGraphCanvas.#J,LGraphCanvas.#Z))return;const _=o||LinkDirection.RIGHT,m=a||LinkDirection.LEFT;if(u.length){let s;const o=u.length;for(let d=0;d<o;d++){const o=u[d];if(!h.has(o)){h.add(o),n.push(o),o._colour=e.color||LGraphCanvas.link_type_colors[e.type]||this.default_link_color;const r=c.getReroute(o.parentId),a=r?.pos??i;o.calculateAngle(this.last_draw_time,c,a),o._dragging||this.renderLink(t,a,o.pos,e,!1,0,null,void 0===s?_:LinkDirection.CENTER,LinkDirection.CENTER,{startControl:s,endControl:o.controlPoint,reroute:o,disabled:l})}if(s||"input"!==u.at(-1)?.floating?.slotType){const t=u[d+1]?.pos??r,e=Math.min(Reroute.maxSplineOffset,.25*distance(o.pos,t));s=[e*o.cos,e*o.sin]}else s=[0,0]}if(e._dragging)return;const a=d.at(-2)??i;this.renderLink(t,a,r,e,!1,0,null,LinkDirection.CENTER,m,{startControl:s,disabled:l})}else e._dragging||this.renderLink(t,i,r,e,!1,0,null,_,m);if(h.add(e),e?._last_time&&s-e._last_time<1e3){const n=2-.002*(s-e._last_time),o=t.globalAlpha;t.globalAlpha=o*n,this.renderLink(t,i,r,e,!0,n,"white",_,m),t.globalAlpha=o}}renderLink(t,e,i,r,n,s,o,a,l,{startControl:c,endControl:h,reroute:u,num_sublines:d=1,disabled:p=!1}={}){const f=null!=r&&this.highlighted_links[r.id]?"#FFF":o||r?.color||null!=r?.type&&LGraphCanvas.link_type_colors[r.type]||this.default_link_color,_=a||LinkDirection.RIGHT,m=l||LinkDirection.LEFT,g=this.links_render_mode!=LinkRenderType.SPLINE_LINK||h&&c?0:distance(e,i);this.render_connections_border&&!this.low_quality&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",d||=1,d>1&&(t.lineWidth=.5);const y=new Path2D,v=u??r;v&&(v.path=y);const b=LGraphCanvas.#q,x=LGraphCanvas.#K,T=v?._pos??[0,0];for(let C=0;C<d;C++){const t=5*(C-.5*(d-1));if(b[0]=e[0],b[1]=e[1],x[0]=i[0],x[1]=i[1],this.links_render_mode==LinkRenderType.SPLINE_LINK){if(h?(x[0]=i[0]+h[0],x[1]=i[1]+h[1]):this.#gt(x,m,g),c?(b[0]=e[0]+c[0],b[1]=e[1]+c[1]):this.#gt(b,_,g),y.moveTo(e[0],e[1]+t),y.bezierCurveTo(b[0],b[1]+t,x[0],x[1]+t,i[0],i[1]+t),findPointOnCurve(T,e,i,b,x,.5),v&&this.linkMarkerShape===LinkMarkerShape.Arrow){const t=LGraphCanvas.#Q;findPointOnCurve(t,e,i,b,x,.51),v._centreAngle=Math.atan2(t[1]-T[1],t[0]-T[0])}}else{const r=this.links_render_mode==LinkRenderType.LINEAR_LINK?15:10;switch(_){case LinkDirection.LEFT:b[0]+=-r;break;case LinkDirection.RIGHT:b[0]+=r;break;case LinkDirection.UP:b[1]+=-r;break;case LinkDirection.DOWN:b[1]+=r}switch(m){case LinkDirection.LEFT:x[0]+=-r;break;case LinkDirection.RIGHT:x[0]+=r;break;case LinkDirection.UP:x[1]+=-r;break;case LinkDirection.DOWN:x[1]+=r}if(this.links_render_mode==LinkRenderType.LINEAR_LINK)y.moveTo(e[0],e[1]+t),y.lineTo(b[0],b[1]+t),y.lineTo(x[0],x[1]+t),y.lineTo(i[0],i[1]+t),T[0]=.5*(b[0]+x[0]),T[1]=.5*(b[1]+x[1]),v&&this.linkMarkerShape===LinkMarkerShape.Arrow&&(v._centreAngle=Math.atan2(x[1]-b[1],x[0]-b[0]));else{if(this.links_render_mode!=LinkRenderType.STRAIGHT_LINK)return;{const t=.5*(b[0]+x[0]);if(y.moveTo(e[0],e[1]),y.lineTo(b[0],b[1]),y.lineTo(t,b[1]),y.lineTo(t,x[1]),y.lineTo(x[0],x[1]),y.lineTo(i[0],i[1]),T[0]=t,T[1]=.5*(b[1]+x[1]),v&&this.linkMarkerShape===LinkMarkerShape.Arrow){const t=x[1]-b[1];Math.abs(t)<4?v._centreAngle=0:v._centreAngle=t>0?.5*Math.PI:-.5*Math.PI}}}}}if(!this.render_connections_border||this.low_quality||n||(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke(y)),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=f,t.stroke(y),this.ds.scale>=.6&&this.highquality_render&&v){if(this.render_connection_arrows){const r=this.computeConnectionPoint(e,i,.25,_,m),n=this.computeConnectionPoint(e,i,.26,_,m),s=this.computeConnectionPoint(e,i,.75,_,m),o=this.computeConnectionPoint(e,i,.76,_,m);let a=0,l=0;this.render_curved_connections?(a=-Math.atan2(n[0]-r[0],n[1]-r[1]),l=-Math.atan2(o[0]-s[0],o[1]-s[1])):l=a=i[1]>e[1]?0:Math.PI;const c=t.getTransform();t.translate(r[0],r[1]),t.rotate(a),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.setTransform(c),t.translate(s[0],s[1]),t.rotate(l),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.setTransform(c)}if(t.beginPath(),this.linkMarkerShape===LinkMarkerShape.Arrow){const e=t.getTransform();t.translate(T[0],T[1]),v._centreAngle&&t.rotate(v._centreAngle),t.moveTo(-3.2,-5),t.lineTo(7,0),t.lineTo(-3.2,5),t.setTransform(e)}else null!=this.linkMarkerShape&&this.linkMarkerShape!==LinkMarkerShape.Circle||t.arc(T[0],T[1],5,0,2*Math.PI);if(p){const{fillStyle:e,globalAlpha:i}=t;t.fillStyle=this._pattern??"#797979",t.globalAlpha=.75,t.fill(),t.globalAlpha=i,t.fillStyle=e}t.fill()}if(s){t.fillStyle=f;for(let r=0;r<5;++r){const n=(.001*LiteGraph.getTime()+.2*r)%1,s=this.computeConnectionPoint(e,i,n,_,m);t.beginPath(),t.arc(s[0],s[1],5,0,2*Math.PI),t.fill()}}}computeConnectionPoint(t,e,i,r,n){r||=LinkDirection.RIGHT,n||=LinkDirection.LEFT;const s=distance(t,e),o=[t[0],t[1]],a=[e[0],e[1]];this.#gt(o,r,s),this.#gt(a,n,s);const l=(1-i)*(1-i)*(1-i),c=(1-i)*(1-i)*3*i,h=3*(1-i)*(i*i),u=i*i*i;return[l*t[0]+c*o[0]+h*a[0]+u*e[0],l*t[1]+c*o[1]+h*a[1]+u*e[1]]}#gt(t,e,i,r=.25){switch(e){case LinkDirection.LEFT:t[0]+=i*-r;break;case LinkDirection.RIGHT:t[0]+=i*r;break;case LinkDirection.UP:t[1]+=i*-r;break;case LinkDirection.DOWN:t[1]+=i*r}}drawExecutionOrder(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;const{visible_nodes:e}=this;for(const i of e)t.fillStyle="black",t.fillRect(i.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,i.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),0==i.order&&t.strokeRect(i.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,i.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(stringOrEmpty(i.order),i.pos[0]+-.5*LiteGraph.NODE_TITLE_HEIGHT,i.pos[1]-6);t.globalAlpha=1}drawNodeWidgets(t,e,i){t.drawWidgets(i,{lowQuality:this.low_quality,editorAlpha:this.editor_alpha})}drawGroups(t,e){if(!this.graph)return;const i=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;const r=this.#et&&this.isDragging;for(const n of i)overlapBounding(this.visible_area,n._bounding)&&(r&&this.selectedItems.has(n)&&this.drawSnapGuide(e,n),n.draw(this,e));e.restore()}resize(t,e){if(!t&&!e){const i=this.canvas.parentElement;if(!i)throw new TypeError("Attempted to resize canvas, but parent element was null.");t=i.offsetWidth,e=i.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t??0,this.canvas.height=e??0,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}onNodeSelectionChange(){}boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(this.selected_nodes)}showLinkMenu(t,e){const{graph:i}=this;if(!i)throw new NullGraphError;const r="data"in t&&null!=t.data?t.data.constructor.name:void 0,{origin_id:n,origin_slot:s}=t;if(null==n||null==s)return new LiteGraph.ContextMenu(["Link has no origin"],{event:e,title:r}),!1;const o=i.getNodeById(n),a=o?.outputs?.[s]?.type,l=new LiteGraph.ContextMenu(["Add Node","Add Reroute",null,"Delete",null],{event:e,title:r,callback:function(e,r,n){if(!i)throw new NullGraphError;switch(e){case"Add Node":console.log("LGraphCanvas.onMenuAdd",l),LGraphCanvas.onMenuAdd(null,null,n,l,(e=>{if(!e?.inputs?.length||!e?.outputs?.length||null==s)return;const i={afterRerouteId:t.parentId};o?.connectByType(s,e,a??"*",i)&&(e.pos[0]-=.5*e.size[0])}));break;case"Add Reroute":try{this.emitBeforeChange(),this.adjustMouseEvent(n),i.createReroute(t._pos,t),this.setDirty(!1,!0)}catch(c){console.error(c)}finally{this.emitAfterChange()}break;case"Delete":i.removeLink(t.id)}}.bind(this)});return!1}createDefaultNodeForSlot(t){const e=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[0,0],nodeType:void 0,posAdd:[0,0],posSizeFix:[0,0]},t),{afterRerouteId:i}=e,r=e.nodeFrom&&null!==e.slotFrom,n=!r&&e.nodeTo&&null!==e.slotTo;if(!r&&!n)return console.warn("No data passed to createDefaultNodeForSlot",e.nodeFrom,e.slotFrom,e.nodeTo,e.slotTo),!1;if(!e.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;const s=r?e.nodeFrom:e.nodeTo;if(!s)throw new TypeError("nodeX was null when creating default node for slot.");let o=r?e.slotFrom:e.slotTo,a=!1;switch(typeof o){case"string":a=r?s.findOutputSlot(o,!1):s.findInputSlot(o,!1),o=r?s.outputs[o]:s.inputs[o];break;case"object":if(null===o)return console.warn("Cant get slot information",o),!1;a=r?s.findOutputSlot(o.name):s.findInputSlot(o.name);break;case"number":a=o,o=r?s.outputs[o]:s.inputs[o];break;default:return console.warn("Cant get slot information",o),!1}const l=o.type==LiteGraph.EVENT?"_event_":o.type,c=r?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(c?.[l]){let t=!1;if("object"==typeof c[l]){for(const i in c[l])if(e.nodeType==c[l][i]||"AUTO"==e.nodeType){t=c[l][i];break}}else e.nodeType!=c[l]&&"AUTO"!=e.nodeType||(t=c[l]);if(t){let n=!1;"object"==typeof t&&t.node&&(n=t,t=t.node);const s=LiteGraph.createNode(t);if(s){if(n){if(n.properties)for(const t in n.properties)s.addProperty(t,n.properties[t]);if(n.inputs){s.inputs=[];for(const t in n.inputs)s.addOutput(n.inputs[t][0],n.inputs[t][1])}if(n.outputs){s.outputs=[];for(const t in n.outputs)s.addOutput(n.outputs[t][0],n.outputs[t][1])}n.title&&(s.title=n.title),n.json&&s.configure(n.json)}if(!this.graph)throw new NullGraphError;if(this.graph.add(s),s.pos=[e.position[0]+e.posAdd[0]+(e.posSizeFix[0]?e.posSizeFix[0]*s.size[0]:0),e.position[1]+e.posAdd[1]+(e.posSizeFix[1]?e.posSizeFix[1]*s.size[1]:0)],r){if(!e.nodeFrom)throw new TypeError("createDefaultNodeForSlot - nodeFrom was null");e.nodeFrom.connectByType(a,s,l,{afterRerouteId:i})}else{if(!e.nodeTo)throw new TypeError("createDefaultNodeForSlot - nodeTo was null");e.nodeTo.connectByTypeOutput(a,s,l,{afterRerouteId:i})}return!0}console.log(`failed creating ${t}`)}}return!1}showConnectionMenu(t){const e=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:void 0,allow_searchbox:this.allow_searchbox,showSearchBox:this.showSearchBox},t||{}),i=this,{graph:r}=this,{afterRerouteId:n}=e,s=e.nodeFrom&&e.slotFrom,o=!s&&e.nodeTo&&e.slotTo;if(!s&&!o)return void console.warn("No data passed to showConnectionMenu");const a=s?e.nodeFrom:e.nodeTo;if(!a)throw new TypeError("nodeX was null when creating default node for slot.");let l,c=s?e.slotFrom:e.slotTo;switch(typeof c){case"string":l=s?a.findOutputSlot(c,!1):a.findInputSlot(c,!1),c=s?a.outputs[c]:a.inputs[c];break;case"object":if(null===c)return void console.warn("Cant get slot information",c);l=s?a.findOutputSlot(c.name):a.findInputSlot(c.name);break;case"number":l=c,c=s?a.outputs[c]:a.inputs[c];break;default:return void console.warn("Cant get slot information",c)}const h=["Add Node","Add Reroute",null];e.allow_searchbox&&h.push("Search",null);const u=c.type==LiteGraph.EVENT?"_event_":c.type,d=s?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(d?.[u])if("object"==typeof d[u])for(const _ in d[u])h.push(d[u][_]);else h.push(d[u]);const p=new LiteGraph.ContextMenu(h,{event:e.e,extra:c,title:(c&&""!=c.name?c.name+(u?" | ":""):"")+(c&&u?u:""),callback:function(t,o,a){switch(t){case"Add Node":console.log("LGraphCanvas.onMenuAdd",p),LGraphCanvas.onMenuAdd(null,null,a,p,(function(t){t&&(console.log("显示菜单项目node",t),s?e.nodeFrom?.connectByType(l,t,u,{afterRerouteId:n}):e.nodeTo?.connectByTypeOutput(l,t,u,{afterRerouteId:n}))}));break;case"Add Reroute":{const t=s?e.nodeFrom:e.nodeTo,i=o.extra;if(!r)throw new NullGraphError;if(!t)throw new TypeError("Cannot add reroute: node was null");if(!i)throw new TypeError("Cannot add reroute: slot was null");if(!e.e)throw new TypeError("Cannot add reroute: CanvasPointerEvent was null");if(!t.connectFloatingReroute([e.e.canvasX,e.e.canvasY],i,n))throw new Error("Failed to create reroute");f();break}case"Search":s?e.showSearchBox(a,{node_from:e.nodeFrom,slot_from:c,type_filter_in:u}):e.showSearchBox(a,{node_to:e.nodeTo,slot_from:c,type_filter_out:u});break;default:{const r={position:[e.e?.canvasX??0,e.e?.canvasY??0],nodeType:t,afterRerouteId:n},s=Object.assign(e,r);i.createDefaultNodeForSlot(s);break}}}}),f=()=>this.#it()}prompt(t,e,i,r,n){const s=this;t=t||"";const o={is_modified:!1,className:"graphdialog rounded",innerHTML:n?"<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",close(){s.prompt_box=null,l.parentNode&&l.remove()}},a=document.createElement("div"),l=Object.assign(a,o),c=LGraphCanvas.active_canvas,{canvas:h}=c;if(!h.parentNode)throw new TypeError("canvas element parentNode was null when opening a prompt.");let u;h.parentNode.append(l),this.ds.scale>1&&(l.style.transform=`scale(${this.ds.scale})`);let d=0;LiteGraph.pointerListenerAdd(l,"leave",(function(){d||LiteGraph.dialog_close_on_mouse_leave&&!l.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(l.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),LiteGraph.pointerListenerAdd(l,"enter",(function(){LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)}));const p=l.querySelectorAll("select");if(p)for(const x of p)x.addEventListener("click",(function(){d++})),x.addEventListener("blur",(function(){d=0})),x.addEventListener("change",(function(){d=-1}));this.prompt_box?.close(),this.prompt_box=l;const f=l.querySelector(".name");if(!f)throw new TypeError("name_element was null");f.textContent=t;const _=l.querySelector(".value");if(!_)throw new TypeError("value_element was null");_.value=e,_.select();const m=_;m.addEventListener("keydown",(function(t){if(l.is_modified=!0,"Escape"==t.key)l.close();else{if("Enter"!=t.key||"textarea"==t.target.localName)return;i&&i(this.value),l.close()}t.preventDefault(),t.stopPropagation()}));const g=l.querySelector("button");if(!g)throw new TypeError("button was null when opening prompt");g.addEventListener("click",(function(){i?.(m.value),s.setDirty(!0),l.close()}));const y=h.getBoundingClientRect();let v=-20,b=-20;return y&&(v-=y.left,b-=y.top),r?(l.style.left=`${r.clientX+v}px`,l.style.top=`${r.clientY+b}px`):(l.style.left=`${.5*h.width+v}px`,l.style.top=`${.5*h.height+b}px`),setTimeout((function(){m.focus();const t=Date.now();function e(i){i.target===h&&Date.now()-t>256&&(l.close(),h.parentElement?.removeEventListener("click",e),h.parentElement?.removeEventListener("touchend",e))}h.parentElement?.addEventListener("click",e),h.parentElement?.addEventListener("touchend",e)}),10),l}showSearchBox(t,e){const i={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};Object.assign(i,e);const r=this,n=LGraphCanvas.active_canvas,{canvas:s}=n,o=s.ownerDocument||document,a=document.createElement("div"),l=Object.assign(a,{close(){r.search_box=void 0,this.blur(),s.focus(),o.body.style.overflow="",setTimeout((()=>s.focus()),20),l.remove()}});l.className="litegraph litesearchbox graphdialog rounded",l.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",i.do_type_filter&&(l.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",l.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>");const c=document.createElement("div");let h,u;if(c.className="helper",l.append(c),o.fullscreenElement?o.fullscreenElement.append(l):(o.body.append(l),o.body.style.overflow="hidden"),i.do_type_filter&&(h=l.querySelector(".slot_in_type_filter"),u=l.querySelector(".slot_out_type_filter")),this.ds.scale>1&&(l.style.transform=`scale(${this.ds.scale})`),i.hide_on_mouse_leave){let t=!1,e=null;if(LiteGraph.pointerListenerAdd(l,"enter",(function(){e&&(clearTimeout(e),e=null)})),l.addEventListener("pointerleave",(function(){if(t)return;const r=i.hide_on_mouse_leave,n="number"==typeof r?r:500;e=setTimeout(l.close,n)})),i.do_type_filter){if(!h)throw new TypeError("selIn was null when showing search box");if(!u)throw new TypeError("selOut was null when showing search box");h.addEventListener("click",(function(){t++})),h.addEventListener("blur",(function(){t=0})),h.addEventListener("change",(function(){t=-1})),u.addEventListener("click",(function(){t++})),u.addEventListener("blur",(function(){t=0})),u.addEventListener("change",(function(){t=-1}))}}r.search_box?.close(),r.search_box=l;let d=null,p=null,f=null;const _=l.querySelector("input");if(!_)throw new TypeError("Could not create search input box.");const m=_;if(m&&(m.addEventListener("blur",(function(){this.focus()})),m.addEventListener("keydown",(function(t){if("ArrowUp"==t.key)x(!1);else if("ArrowDown"==t.key)x(!0);else if("Escape"==t.key)l.close();else{if("Enter"!=t.key)return p&&clearInterval(p),void(p=setTimeout(T,10));f instanceof HTMLElement?b(unescape(String(f.dataset.type))):d?b(d):l.close()}return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!0}))),i.do_type_filter){if(h){const t=LiteGraph.slot_types_in,e=t.length;i.type_filter_in!=LiteGraph.EVENT&&i.type_filter_in!=LiteGraph.ACTION||(i.type_filter_in="_event_");for(let r=0;r<e;r++){const e=document.createElement("option");e.value=t[r],e.innerHTML=t[r],h.append(e),!1!==i.type_filter_in&&String(i.type_filter_in).toLowerCase()==String(t[r]).toLowerCase()&&(e.selected=!0)}h.addEventListener("change",(function(){T()}))}if(u){const t=LiteGraph.slot_types_out;i.type_filter_out!=LiteGraph.EVENT&&i.type_filter_out!=LiteGraph.ACTION||(i.type_filter_out="_event_");for(const e of t){const t=document.createElement("option");t.value=e,t.innerHTML=e,u.append(t),!1!==i.type_filter_out&&String(i.type_filter_out).toLowerCase()==String(e).toLowerCase()&&(t.selected=!0)}u.addEventListener("change",(function(){T()}))}}const g=s.getBoundingClientRect(),y=(t?t.clientX:g.left+.5*g.width)-80,v=(t?t.clientY:g.top+.5*g.height)-20;function b(e){if(e)if(r.onSearchBoxSelection)r.onSearchBoxSelection(e,t,n);else{if(!n.graph)throw new NullGraphError;n.graph.beforeChange();const r=LiteGraph.createNode(e);if(r&&(r.pos=n.convertEventToCanvasOffset(t),n.graph.add(r,!1)),i.node_from){let t=!1;switch(typeof i.slot_from){case"string":t=i.node_from.findOutputSlot(i.slot_from);break;case"object":if(null==i.slot_from)throw new TypeError("options.slot_from was null when showing search box");t=i.slot_from.name?i.node_from.findOutputSlot(i.slot_from.name):-1,-1==t&&void 0!==i.slot_from.slot_index&&(t=i.slot_from.slot_index);break;case"number":t=i.slot_from;break;default:t=0}if(void 0!==i.node_from.outputs[t]&&!1!==t&&t>-1){if(null==r)throw new TypeError("options.slot_from was null when showing search box");i.node_from.connectByType(t,r,i.node_from.outputs[t].type)}}if(i.node_to){let t=!1;switch(typeof i.slot_from){case"string":t=i.node_to.findInputSlot(i.slot_from);break;case"object":if(null==i.slot_from)throw new TypeError("options.slot_from was null when showing search box");t=i.slot_from.name?i.node_to.findInputSlot(i.slot_from.name):-1,-1==t&&void 0!==i.slot_from.slot_index&&(t=i.slot_from.slot_index);break;case"number":t=i.slot_from;break;default:t=0}if(void 0!==i.node_to.inputs[t]&&!1!==t&&t>-1){if(null==r)throw new TypeError("options.slot_from was null when showing search box");i.node_to.connectByTypeOutput(t,r,i.node_to.inputs[t].type)}}n.graph.afterChange()}l.close()}function x(t){const e=f;f?f instanceof Element&&(f.classList.remove("selected"),f=t?f.nextSibling:f.previousSibling,f||=e):f=t?c.childNodes[0]:c.childNodes[c.childNodes.length],f instanceof Element&&(f.classList.add("selected"),f.scrollIntoView({block:"end",behavior:"smooth"}))}function T(){p=null;let t=m.value;if(d=null,c.innerHTML="",t||i.show_all_if_empty)if(r.onSearchBox){const i=r.onSearchBox(c,t,n);if(i)for(const t of i)e(t)}else{let s=function(e,r){r=r||{};const n=Object.assign({skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},r),s=LiteGraph.registered_node_types[e];if(a&&s.filter!=a)return!1;if((!i.show_all_if_empty||t)&&!e.toLowerCase().includes(t)&&(!s.title||!s.title.toLowerCase().includes(t)))return!1;if(i.do_type_filter&&!n.skipFilter){const t=e;let i=!1!==n.inTypeOverride?n.inTypeOverride:l.value;if(l&&i&&LiteGraph.registered_slot_in_types[i]?.nodes){if(!1===LiteGraph.registered_slot_in_types[i].nodes.includes(t))return!1}if(i=h.value,!1!==n.outTypeOverride&&(i=n.outTypeOverride),h&&i&&LiteGraph.registered_slot_out_types[i]?.nodes){if(!1===LiteGraph.registered_slot_out_types[i].nodes.includes(t))return!1}}return!0},o=0;if(t=t.toLowerCase(),!n.graph)throw new NullGraphError;const a=n.filter||n.graph.filter;let l=!1,h=!1;i.do_type_filter&&r.search_box&&(l=r.search_box.querySelector(".slot_in_type_filter"),h=r.search_box.querySelector(".slot_out_type_filter"));const u=Object.keys(LiteGraph.registered_node_types).filter((t=>s(t)));for(const t of u)if(e(t),-1!==LGraphCanvas.search_limit&&o++>LGraphCanvas.search_limit)break;if(i.show_general_after_typefiltered&&(l.value||h.value)){filtered_extra=[];for(const t in LiteGraph.registered_node_types)s(t,{inTypeOverride:!(!l||!l.value)&&"*",outTypeOverride:!(!h||!h.value)&&"*"})&&filtered_extra.push(t);for(const t of filtered_extra)if(e(t,"generic_type"),-1!==LGraphCanvas.search_limit&&o++>LGraphCanvas.search_limit)break}if((l.value||h.value)&&0==c.childNodes.length&&i.show_general_if_none_on_typefilter){filtered_extra=[];for(const t in LiteGraph.registered_node_types)s(t,{skipFilter:!0})&&filtered_extra.push(t);for(const t of filtered_extra)if(e(t,"not_in_filter"),-1!==LGraphCanvas.search_limit&&o++>LGraphCanvas.search_limit)break}}function e(t,e){const i=document.createElement("div");d||=t;const r=LiteGraph.registered_node_types[t];if(r?.title){i.textContent=r?.title;const e=document.createElement("span");e.className="litegraph lite-search-item-type",e.textContent=t,i.append(e)}else i.textContent=t;i.dataset.type=escape(t),i.className="litegraph lite-search-item",e&&(i.className+=` ${e}`),i.addEventListener("click",(function(){b(unescape(String(this.dataset.type)))})),c.append(i)}}return l.style.left=`${y}px`,l.style.top=`${v}px`,t.layerY>g.height-200&&(c.style.maxHeight=g.height-t.layerY-20+"px"),requestAnimationFrame((function(){m.focus()})),i.show_all_on_open&&T(),l}showEditPropertyValue(t,e,i){if(!t||void 0===t.properties[e])return;i=i||{};const r=t.getPropertyInfo(e),{type:n}=r;let s="";if("string"==n||"number"==n||"array"==n||"object"==n)s="<input autofocus type='text' class='value'/>";else if("enum"!=n&&"combo"!=n||!r.values){if("boolean"!=n&&"toggle"!=n)return void console.warn(`unknown type: ${n}`);s=`<input autofocus type='checkbox' class='value' ${t.properties[e]?"checked":""}/>`}else{s="<select autofocus type='text' class='value'>";for(const i in r.values){const n=Array.isArray(r.values)?r.values[i]:i;s+=`<option value='${n}' ${n==t.properties[e]?"selected":""}>${r.values[i]}</option>`}s+="</select>"}const o=this.createDialog(`<span class='name'>${r.label||e}</span>${s}<button>OK</button>`,i);let a;if("enum"!=n&&"combo"!=n||!r.values){if("boolean"==n||"toggle"==n)a=o.querySelector("input"),a?.addEventListener("click",(function(){o.modified(),u(!!a.checked)}));else if(a=o.querySelector("input"),a){a.addEventListener("blur",(function(){this.focus()}));let i=void 0!==t.properties[e]?t.properties[e]:"";"string"!==n&&(i=JSON.stringify(i)),a.value=i,a.addEventListener("keydown",(function(t){if("Escape"==t.key)o.close();else{if("Enter"!=t.key)return void o.modified();c()}t.preventDefault(),t.stopPropagation()}))}}else a=o.querySelector("select"),a?.addEventListener("change",(function(t){o.modified(),u(t.target?.value)}));a?.focus();const l=o.querySelector("button");if(!l)throw new TypeError("Show edit property value button was null.");function c(){u(a?.value)}l.addEventListener("click",c);const h=()=>this.#it();function u(s){r?.values&&"object"==typeof r.values&&null!=r.values[s]&&(s=r.values[s]),"number"==typeof t.properties[e]&&(s=Number(s)),"array"!=n&&"object"!=n||(s=JSON.parse(s)),t.properties[e]=s,t.graph&&t.graph._version++,t.onPropertyChanged?.(e,s),i.onclose?.(),o.close(),h()}return o}createDialog(t,e){e=Object.assign({checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0},e||{});const i={className:"graphdialog",innerHTML:t,is_modified:!1,modified(){this.is_modified=!0},close(){this.remove()}},r=document.createElement("div"),n=Object.assign(r,i),s=this.canvas.getBoundingClientRect();let o,a=-20,l=-20;if(s&&(a-=s.left,l-=s.top),e.position?(a+=e.position[0],l+=e.position[1]):e.event?(a+=e.event.clientX,l+=e.event.clientY):(a+=.5*this.canvas.width,l+=.5*this.canvas.height),n.style.left=`${a}px`,n.style.top=`${l}px`,!this.canvas.parentNode)throw new TypeError("Canvas parent element was null.");if(this.canvas.parentNode.append(n),e.checkForInput){const t=n.querySelectorAll("input");if(t)for(const e of t)e.addEventListener("keydown",(function(t){if(n.modified(),"Escape"==t.key)n.close();else if("Enter"!=t.key)return;t.preventDefault(),t.stopPropagation()})),e.focus()}let c=0;n.addEventListener("mouseleave",(function(){c||!n.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(o=setTimeout(n.close,LiteGraph.dialog_close_on_mouse_leave_delay))})),n.addEventListener("mouseenter",(function(){(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&o&&clearTimeout(o)}));const h=n.querySelectorAll("select");if(h)for(const u of h)u.addEventListener("click",(function(){c++})),u.addEventListener("blur",(function(){c=0})),u.addEventListener("change",(function(){c=-1}));return n}createPanel(t,e){const i=(e=e||{}).window||window,r=document.createElement("div");if(r.className="litegraph dialog",r.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",r.header=r.querySelector(".dialog-header"),e.width&&(r.style.width=e.width+("number"==typeof e.width?"px":"")),e.height&&(r.style.height=e.height+("number"==typeof e.height?"px":"")),e.closable){const t=document.createElement("span");t.innerHTML="&#10005;",t.classList.add("close"),t.addEventListener("click",(function(){r.close()})),r.header.append(t)}return r.title_element=r.querySelector(".dialog-title"),r.title_element.textContent=t,r.content=r.querySelector(".dialog-content"),r.alt_content=r.querySelector(".dialog-alt-content"),r.footer=r.querySelector(".dialog-footer"),r.close=function(){"function"==typeof r.onClose&&r.onClose(),r.remove(),this.remove()},r.toggleAltContent=function(t){let e,i;void 0!==t?(e=t?"block":"none",i=t?"none":"block"):(e="block"!=r.alt_content.style.display?"block":"none",i="block"!=r.alt_content.style.display?"none":"block"),r.alt_content.style.display=e,r.content.style.display=i},r.toggleFooterVisibility=function(t){let e;e=void 0!==t?t?"block":"none":"block"!=r.footer.style.display?"block":"none",r.footer.style.display=e},r.clear=function(){this.content.innerHTML=""},r.addHTML=function(t,e,i){const n=document.createElement("div");return e&&(n.className=e),n.innerHTML=t,i?r.footer.append(n):r.content.append(n),n},r.addButton=function(t,e,i){const n=document.createElement("button");return n.textContent=t,n.options=i,n.classList.add("btn"),n.addEventListener("click",e),r.footer.append(n),n},r.addSeparator=function(){const t=document.createElement("div");t.className="separator",r.content.append(t)},r.addWidget=function(t,e,n,s,o){s=s||{};let a=String(n);"number"==(t=t.toLowerCase())&&"number"==typeof n&&(a=n.toFixed(3));const l=document.createElement("div");l.className="property",l.innerHTML="<span class='property_name'></span><span class='property_value'></span>";const c=l.querySelector(".property_name");if(!c)throw new TypeError("Property name element was null.");c.textContent=s.label||e;const h=l.querySelector(".property_value");if(!h)throw new TypeError("Property name element was null.");if(h.textContent=a,l.dataset.property=e,l.dataset.type=s.type||t,l.options=s,l.value=n,"code"==t)l.addEventListener("click",(function(){r.inner_showCodePad(this.dataset.property)}));else if("boolean"==t)l.classList.add("boolean"),n&&l.classList.add("bool-on"),l.addEventListener("click",(()=>{const t=l.dataset.property;if(l.value=!l.value,l.classList.toggle("bool-on"),!h)throw new TypeError("Property name element was null.");h.textContent=l.value?"true":"false",u(t,l.value)}));else if("string"==t||"number"==t){if(!h)throw new TypeError("Property name element was null.");h.setAttribute("contenteditable","true"),h.addEventListener("keydown",(function(e){"Enter"!=e.code||"string"==t&&e.shiftKey||(e.preventDefault(),this.blur())})),h.addEventListener("blur",(function(){let t=this.textContent;const e=this.parentElement?.dataset.property,i=this.parentElement?.dataset.type;"number"==i&&(t=Number(t)),u(e,t)}))}else if("enum"==t||"combo"==t){const t=LGraphCanvas.getPropertyPrintableValue(n,s.values);if(!h)throw new TypeError("Property name element was null.");h.textContent=t??"",h.addEventListener("click",(function(t){const e=s.values||[],r=this.parentElement?.dataset.property;new LiteGraph.ContextMenu(e,{event:t,className:"dark",callback:t=>(this.textContent=t,u(r,t),!1)},i)}))}function u(t,e){s.callback?.(t,e,s),o?.(t,e,s)}return r.content.append(l),l},"function"==typeof r.onOpen&&r.onOpen(),r}closePanels(){document.querySelector("#node-panel")?.close?.(),document.querySelector("#option-panel")?.close?.()}showShowNodePanel(t){this.SELECTED_NODE=t,this.closePanels();const e=this.getCanvasWindow(),i=this.createPanel(t.title||"",{closable:!0,window:e,onOpen:()=>{this.NODEPANEL_IS_OPEN=!0},onClose:()=>{this.NODEPANEL_IS_OPEN=!1,this.node_panel=null}});this.node_panel=i,i.id="node-panel",i.node=t,i.classList.add("settings");const r=()=>{i.content.innerHTML="",i.addHTML(`<span class='node_type'>${t.type}</span><span class='node_desc'>${t.constructor.desc||""}</span><span class='separator'></span>`),i.addHTML("<h3>Properties</h3>");const e=(e,i)=>{if(!this.graph)throw new NullGraphError;switch(this.graph.beforeChange(t),e){case"Title":if("string"!=typeof i)throw new TypeError("Attempting to set title to non-string value.");t.title=i;break;case"Mode":{if("string"!=typeof i)throw new TypeError("Attempting to set mode to non-string value.");const e=Object.values(LiteGraph.NODE_MODES).indexOf(i);-1!==e&&LiteGraph.NODE_MODES[e]?t.changeMode(e):console.warn(`unexpected mode: ${i}`);break}case"Color":if("string"!=typeof i)throw new TypeError("Attempting to set colour to non-string value.");LGraphCanvas.node_colors[i]?(t.color=LGraphCanvas.node_colors[i].color,t.bgcolor=LGraphCanvas.node_colors[i].bgcolor):console.warn(`unexpected color: ${i}`);break;default:t.setProperty(e,i)}this.graph.afterChange(),this.dirty_canvas=!0};i.addWidget("string","Title",t.title,{},e);const r=null==t.mode?void 0:LiteGraph.NODE_MODES[t.mode];i.addWidget("combo","Mode",r,{values:LiteGraph.NODE_MODES},e);const n=void 0!==t.color?Object.keys(LGraphCanvas.node_colors).filter((function(e){return LGraphCanvas.node_colors[e].color==t.color})):"";i.addWidget("combo","Color",n,{values:Object.keys(LGraphCanvas.node_colors)},e);for(const s in t.properties){const r=t.properties[s],n=t.getPropertyInfo(s);t.onAddPropertyToPanel?.(s,i)||i.addWidget(n.widget||n.type,s,r,n,e)}i.addSeparator(),t.onShowCustomPanelInfo?.(i),i.footer.innerHTML="",i.addButton("Delete",(function(){if(!t.block_delete){if(!t.graph)throw new NullGraphError;t.graph.remove(t),i.close()}})).classList.add("delete")};if(i.inner_showCodePad=function(e){i.classList.remove("settings"),i.classList.add("centered"),i.alt_content.innerHTML="<textarea class='code'></textarea>";const n=i.alt_content.querySelector("textarea"),s=function(){i.toggleAltContent(!1),i.toggleFooterVisibility(!0),n.remove(),i.classList.add("settings"),i.classList.remove("centered"),r()};n.value=String(t.properties[e]),n.addEventListener("keydown",(function(i){"Enter"==i.code&&i.ctrlKey&&(t.setProperty(e,n.value),s())})),i.toggleAltContent(!0),i.toggleFooterVisibility(!1),n.style.height="calc(100% - 40px)";const o=i.addButton("Assign",(function(){t.setProperty(e,n.value),s()}));i.alt_content.append(o);const a=i.addButton("Close",s);a.style.float="right",i.alt_content.append(a)},r(),!this.canvas.parentNode)throw new TypeError("showNodePanel - this.canvas.parentNode was null");this.canvas.parentNode.append(i)}showSubgraphPropertiesDialog(t){console.log("showing subgraph input properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var i=this.createPanel("Subgraph Inputs",{closable:!0,width:500});function r(){if(i.clear(),t.inputs)for(var e=0;e<t.inputs.length;++e){var n=t.inputs[e];if(!n.not_subgraph_input){var s=i.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");s.dataset.name=n.name,s.dataset.slot=e,s.querySelector(".name").innerText=n.name,s.querySelector(".type").innerText=n.type,s.querySelector("button").addEventListener("click",(function(e){t.removeInput(Number(this.parentNode.dataset.slot)),r()}))}}}i.node=t,i.classList.add("subgraph_dialog");return i.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",(function(e){var i=this.parentNode,n=i.querySelector(".name").value,s=i.querySelector(".type").value;n&&-1==t.findInputSlot(n)&&(t.addInput(n,s),i.querySelector(".name").value="",i.querySelector(".type").value="",r())})),r(),this.canvas.parentNode.appendChild(i),i}checkPanels(){if(!this.canvas)return;if(!this.canvas.parentNode)throw new TypeError("checkPanels - this.canvas.parentNode was null");const t=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(const e of t)e.node&&(e.node.graph&&e.graph==this.graph||e.close())}getCanvasMenuOptions(){let t;this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&t.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)}));const e=this.getExtraMenuOptions?.(this,t);return Array.isArray(e)?t.concat(e):t}getNodeMenuOptions(t){let e;if(t.getMenuOptions?e=t.getMenuOptions(this):(e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},{content:"Properties Panel",callback:function(t,e,i,r,n){LGraphCanvas.active_canvas.showShowNodePanel(n)}},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],!1!==t.resizable&&e.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),t.collapsible&&e.push({content:t.collapsed?"Expand":"Collapse",callback:LGraphCanvas.onMenuNodeCollapse}),t.widgets?.some((t=>t.advanced))&&e.push({content:t.showAdvanced?"Hide Advanced":"Show Advanced",callback:LGraphCanvas.onMenuToggleAdvanced}),e.push({content:t.pinned?"Unpin":"Pin",callback:()=>{for(const t in this.selected_nodes){this.selected_nodes[t].pin()}this.setDirty(!0,!0)}},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),t.onGetInputs){var i=t.onGetInputs();i&&i.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var r=t.onGetOutputs();r&&r.length&&(e[1].disabled=!1)}const n=t.getExtraMenuOptions?.(this,e);return Array.isArray(n)&&n.length>0&&(n.push(null),e=n.concat(e)),!1!==t.clonable&&e.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&e.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign},{content:"Distribute Nodes",has_submenu:!0,callback:LGraphCanvas.createDistributeMenu}),e.push(null,{content:"Remove",disabled:!(!1!==t.removable&&!t.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),t.graph?.onGetNodeMenuOptions?.(e,t),e}getGroupMenuOptions(t){return console.warn("LGraphCanvas.getGroupMenuOptions is deprecated, use LGraphGroup.getMenuOptions instead"),t.getMenuOptions()}processContextMenu(t,e){const i=LGraphCanvas.active_canvas.getCanvasWindow();let r;const n={event:e,callback:function(e,i){if(!e)return;if("Remove Slot"==e.content){if(!t?.graph)throw new NullGraphError;const i=e.slot;if(!i)throw new TypeError("Found-slot info was null when processing context menu.");return t.graph.beforeChange(),i.input?t.removeInput(i.slot):i.output&&t.removeOutput(i.slot),void t.graph.afterChange()}if("Disconnect Links"==e.content){if(!t?.graph)throw new NullGraphError;const i=e.slot;if(!i)throw new TypeError("Found-slot info was null when processing context menu.");return t.graph.beforeChange(),i.output?t.disconnectOutput(i.slot):i.input&&t.disconnectInput(i.slot,!0),void t.graph.afterChange()}if("Rename Slot"==e.content){if(!t)throw new TypeError("`node` was null when processing the context menu.");const r=e.slot;if(!r)throw new TypeError("Found-slot info was null when processing context menu.");const n=r.input?t.getInputInfo(r.slot):t.getOutputInfo(r.slot),a=s(i),l=a.querySelector("input");l&&n&&(l.value=n.label||"");const c=function(){if(!t.graph)throw new NullGraphError;t.graph.beforeChange(),l?.value&&(n&&(n.label=l.value),o()),a.close(),t.graph.afterChange()};if(a.querySelector("button")?.addEventListener("click",c),!l)throw new TypeError("Input element was null when processing context menu.");l.addEventListener("keydown",(function(t){if(a.is_modified=!0,"Escape"==t.key)a.close();else if("Enter"==t.key)c();else if("textarea"!=t.target.localName)return;t.preventDefault(),t.stopPropagation()})),l.focus()}},extra:t};if(t){n.title=t.type??void 0,LGraphCanvas.active_node=t;const i=t.getSlotInPosition(e.canvasX,e.canvasY);if(i){if(r=[],t.getSlotMenuOptions)r=t.getSlotMenuOptions(i);else{(i.output?.links?.length||null!=i.input?.link)&&r.push({content:"Disconnect Links",slot:i});const e=i.input||i.output;if(!e)throw new TypeError("Both in put and output slots were null when processing context menu.");e.removable&&r.push(e.locked?"Cannot remove":{content:"Remove Slot",slot:i}),e.nameLocked||r.push({content:"Rename Slot",slot:i}),t.getExtraSlotMenuOptions&&r.push(...t.getExtraSlotMenuOptions(i))}n.title=(i.input?i.input.type:i.output.type)||"*",i.input&&i.input.type==LiteGraph.ACTION&&(n.title="Action"),i.output&&i.output.type==LiteGraph.EVENT&&(n.title="Event")}else r=this.getNodeMenuOptions(t)}else{if(r=this.getCanvasMenuOptions(),!this.graph)throw new NullGraphError;if(this.links_render_mode!==LinkRenderType.HIDDEN_LINK){const t=this.graph.getRerouteOnPos(e.canvasX,e.canvasY);t&&r.unshift({content:"Delete Reroute",callback:()=>{if(!this.graph)throw new NullGraphError;this.graph.removeReroute(t.id)}},null)}const t=this.graph.getGroupOnPos(e.canvasX,e.canvasY);t&&r.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:t,options:t.getMenuOptions()}})}if(!r)return;new LiteGraph.ContextMenu(r,n,i);const s=t=>this.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",t),o=()=>this.setDirty(!0)}animateToBounds(t,e={}){this.ds.animateToBounds(t,(()=>this.setDirty(!0,!0)),e)}fitViewToSelectionAnimated(t={}){const e=createBounds(this.selectedItems.size?Array.from(this.selectedItems):this.positionableItems);if(!e)throw new TypeError("Attempted to fit to view but could not calculate bounds.");this.ds.animateToBounds(e,(()=>this.setDirty(!0,!0)),t)}}class MapProxyHandler{getOwnPropertyDescriptor(t,e){const i=this.get(t,e);if(i)return{configurable:!0,enumerable:!0,value:i}}has(t,e){if("symbol"==typeof e)return!1;const i=parseInt(e,10);return t.has(isNaN(i)?e:i)}ownKeys(t){return[...t.keys()].map(String)}get(t,e){if(e in t)return Reflect.get(t,e,t);if("symbol"==typeof e)return;const i=parseInt(e,10);return t.get(isNaN(i)?e:i)}set(t,e,i){if("symbol"==typeof e)return!1;const r=parseInt(e,10);return t.set(isNaN(r)?e:r,i),!0}deleteProperty(t,e){return t.delete(e)}static bindAllMethods(t){t.clear=t.clear.bind(t),t.delete=t.delete.bind(t),t.forEach=t.forEach.bind(t),t.get=t.get.bind(t),t.has=t.has.bind(t),t.set=t.set.bind(t),t.entries=t.entries.bind(t),t.keys=t.keys.bind(t),t.values=t.values.bind(t)}}class LGraph{constructor(t){this.id=zeroUuid,this.revision=0,this._version=-1,this._links=new Map,this.status=LGraph.STATUS_STOPPED,this.state={lastGroupId:0,lastNodeId:0,lastLinkId:0,lastRerouteId:0},this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.iteration=0,this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.config={},this.vars={},this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.extra={},this.#yt=0,this.#vt=new Map,this.#bt=new Map,LiteGraph.debug&&console.log("Graph created");const e=this._links;MapProxyHandler.bindAllMethods(e);const i=new MapProxyHandler;this.links=new Proxy(e,i),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}static#c=(()=>this.serialisedSchemaVersion=1)();static#h=(()=>this.STATUS_STOPPED=1)();static#R=(()=>this.STATUS_RUNNING=2)();get empty(){return this._nodes.length+this._groups.length+this.reroutes.size===0}*positionableItems(){for(const t of this._nodes)yield t;for(const t of this._groups)yield t;for(const t of this.reroutes.values())yield t}#yt;#vt;get floatingLinks(){return this.#vt}#bt;get reroutes(){return this.#bt}get last_node_id(){return this.state.lastNodeId}set last_node_id(t){this.state.lastNodeId=t}get last_link_id(){return this.state.lastLinkId}set last_link_id(t){this.state.lastLinkId=t}clear(){if(console.log("lgCanvas开始执行clear"),this.stop(),this.status=LGraph.STATUS_STOPPED,this.id=zeroUuid,this.revision=0,this.state={lastGroupId:0,lastNodeId:0,lastLinkId:0,lastRerouteId:0},this._version=-1,this._nodes)for(const t of this._nodes)t.onRemoved?.();this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._links.clear(),this.reroutes.clear(),this.#vt.clear(),this.#yt=0,this._groups=[],this.iteration=0,this.config={audioArray:{}},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.canvasAction((t=>t.clear()))}get nodes(){return this._nodes}get groups(){return this._groups}attachCanvas(t){if(t.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";t.graph!=this&&t.graph?.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||=[],this.list_of_graphcanvas.push(t);for(const e of this._nodes)null!=e.onAttachCanvas&&e.onAttachCanvas()}detachCanvas(t){if(!this.list_of_graphcanvas)return;const e=this.list_of_graphcanvas.indexOf(t);if(-1!=e){t.graph=null,this.list_of_graphcanvas.splice(e,1);for(const t of this._nodes)null!=t.onDetachCanvas&&t.onDetachCanvas()}}async startLoadComplete(){return new Promise(((t,e)=>{this.checkAssestLoadComplete=()=>{this.config.assestTotal==this.config.assestLoaded&&(console.log("所有资源都加载好了",this.config.assestTotal),this.checkAssestLoadComplete=null,t(!0))}}))}async start(t){if(this.status!=LGraph.STATUS_RUNNING)if(this.status=LGraph.STATUS_RUNNING,this.config.assestTotal=0,this.config.assestLoaded=0,this.config.audioArray={},this.config.inPause=!1,this.sendEventToAllNodes("onStartBeforeLoad"),this.config.assestTotal!=this.config.assestLoaded&&await this.startLoadComplete(),this.sendEventToAllNodes("onStart"),this.onPlayEvent?.(),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,t||=0,0==t&&"undefined"!=typeof window&&window.requestAnimationFrame){const t=()=>{-1==this.execution_timer_id&&1!=this.config.inPause&&(window.requestAnimationFrame(t),this.onBeforeStep?.(),this.runStep(1,!this.catch_errors),this.onAfterStep?.())};this.execution_timer_id=-1,t(),this.sendEventToAllNodes("onStartAfter")}else this.execution_timer_id=setInterval((()=>{1!=this.config.inPause&&(this.onBeforeStep?.(),this.runStep(1,!this.catch_errors),this.onAfterStep?.())}),t)}pause(){this.config.inPause=!0,this.sendEventToAllNodes("onPause")}resume(){this.config.inPause=!1,this.sendEventToAllNodes("onResume")}stop(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent?.(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))}playSounds(t,e,i){let r,n=[];for(var s=0;s<t.length;s++){let e=LiteGraph.createNode("output/sound");this.add(e),e.setProperty("customeName",t[s]),null!=i&&e.setProperty("yinggui",i),0==s&&(r=e),n.push(e)}for(s=0;s<n.length;s++){let t=n[s],i=n[s+1];null!=i?t.connect(0,i,0):t.playEndCb=e}null!=r&&r.onAction("播放")}runStep(t,e,i){t=t||1;const r=LiteGraph.getTime();this.globaltime=.001*(r-this.starttime);const n=this._nodes_executable||this._nodes;if(!n)return;if(i=i||n.length,e){for(let e=0;e<t;e++){for(let t=0;t<i;++t){const e=n[t];e.mode==LGraphEventMode.ALWAYS&&e.onExecute&&e.doExecute?.()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep?.()}this.onAfterExecute?.()}else try{for(let e=0;e<t;e++){for(let t=0;t<i;++t){const e=n[t];e.mode==LGraphEventMode.ALWAYS&&e.onExecute?.()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep?.()}this.onAfterExecute?.(),this.errors_in_execution=!1}catch(a){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw a;LiteGraph.debug&&console.log("Error during execution:",a),this.stop()}const s=LiteGraph.getTime();let o=s-r;0==o&&(o=1),this.execution_time=.001*o,this.globaltime+=.001*o,this.iteration+=1,this.elapsed_time=.001*(s-this.last_update_time),this.last_update_time=s,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(const t of this._nodes_in_order)t.onExecute&&this._nodes_executable.push(t)}computeExecutionOrder(t,e){const i=[],r=[],n={},s={},o={};for(const l of this._nodes){if(t&&!l.onExecute)continue;n[l.id]=l;let i=0;if(l.inputs)for(const t of l.inputs)null!=t?.link&&(i+=1);0==i?(r.push(l),e&&(l._level=1)):(e&&(l._level=0),o[l.id]=i)}for(;;){const t=r.shift();if(void 0===t)break;if(i.push(t),delete n[t.id],t.outputs)for(const i of t.outputs)if(null!=i?.links&&0!=i.links.length)for(const n of i.links){const i=this._links.get(n);if(!i)continue;if(s[i.id])continue;const a=this.getNodeById(i.target_id);null!=a?(e&&(t._level??=0,(!a._level||a._level<=t._level)&&(a._level=t._level+1)),s[i.id]=!0,o[a.id]-=1,0==o[a.id]&&r.push(a)):s[i.id]=!0}}for(const l in n)i.push(n[l]);function a(t){const e=t.length;for(let i=0;i<e;++i)t[i].order=i}return i.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing"),a(i),i.sort((function(t,e){const i=t.constructor.priority||t.priority||0,r=e.constructor.priority||e.priority||0;return i==r?t.order-e.order:i-r})),a(i),i}getAncestors(t){const e=[],i=[t],r={};for(;i.length;){const n=i.shift();if(n?.inputs){r[n.id]||n==t||(r[n.id]=!0,e.push(n));for(let t=0;t<n.inputs.length;++t){const r=n.getInputNode(t);r&&!e.includes(r)&&i.push(r)}}}return e.sort((function(t,e){return t.order-e.order})),e}arrange(t,e){t=t||100;const i=this.computeExecutionOrder(!1,!0),r=[];for(const s of i){const t=s._level||1;r[t]||=[],r[t].push(s)}let n=t;for(const s of r){if(!s)continue;let i=100,r=t+LiteGraph.NODE_TITLE_HEIGHT;for(const o of s){o.pos[0]=e==LiteGraph.VERTICAL_LAYOUT?r:n,o.pos[1]=e==LiteGraph.VERTICAL_LAYOUT?n:r;const s=e==LiteGraph.VERTICAL_LAYOUT?1:0;o.size[s]>i&&(i=o.size[s]);const a=e==LiteGraph.VERTICAL_LAYOUT?0:1;r+=o.size[a]+t+LiteGraph.NODE_TITLE_HEIGHT}n+=i+t}this.setDirtyCanvas(!0,!0)}getTime(){return this.globaltime}getFixedTime(){return this.fixedtime}getElapsedTime(){return this.elapsed_time}sendEventToAllNodes(t,e){const i=this._nodes_in_order||this._nodes;if(i)for(const r of i)r.constructor!==LiteGraph.Subgraph||"onExecute"==t?r[t]&&(void 0===e?r[t]():e&&e.constructor===Array?r[t].apply(r,e):r[t](e)):r.sendEventToAllNodes(t,e)}canvasAction(t){const e=this.list_of_graphcanvas;if(e)for(const i of e)t(i)}sendActionToCanvas(t,e){const{list_of_graphcanvas:i}=this;if(i)for(const r of i)r[t]?.apply(r,e)}add(t,e){if(!t)return;const{state:i}=this;if(LiteGraph.alwaysSnapToGrid){const e=this.getSnapToGridSize();e&&t.snapToGrid(e)}if(t instanceof LGraphGroup)return null!=t.id&&-1!==t.id||(t.id=++i.lastGroupId),t.id>i.lastGroupId&&(i.lastGroupId=t.id),this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,void this._version++;if(-1!=t.id&&null!=this._nodes_by_id[t.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),t.id=LiteGraph.use_uuids?LiteGraph.uuidv4():++i.lastNodeId),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?null!=t.id&&-1!=t.id||(t.id=LiteGraph.uuidv4()):null==t.id||-1==t.id?t.id=++i.lastNodeId:"number"==typeof t.id&&i.lastNodeId<t.id&&(i.lastNodeId=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded?.(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded?.(t),this.setDirtyCanvas(!0),this.change(),t}remove(t){if(t instanceof LGraphGroup){const e=this._groups.indexOf(t);return-1!=e&&this._groups.splice(e,1),t.graph=void 0,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null==this._nodes_by_id[t.id])return;if(t.ignore_remove)return;this.beforeChange();const{inputs:e,outputs:i}=t;if(e)for(const[s,o]of e.entries())null!=o.link&&t.disconnectInput(s,!0);if(i)for(const[s,o]of i.entries())o.links?.length&&t.disconnectOutput(s);for(const s of this.floatingLinks.values())s.origin_id!==t.id&&s.target_id!==t.id||this.removeFloatingLink(s);t.onRemoved?.(),t.graph=null,this._version++;const{list_of_graphcanvas:r}=this;if(r)for(const s of r)s.selected_nodes[t.id]&&delete s.selected_nodes[t.id];const n=this._nodes.indexOf(t);-1!=n&&this._nodes.splice(n,1),delete this._nodes_by_id[t.id],this.onNodeRemoved?.(t),this.canvasAction((t=>t.checkPanels())),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}getNodeById(t){return null!=t?this._nodes_by_id[t]:null}findNodesByClass(t,e){(e=e||[]).length=0;const{_nodes:i}=this;for(const r of i)r.constructor===t&&e.push(r);return e}findNodesByType(t,e){const i=t.toLowerCase();(e=e||[]).length=0;const{_nodes:r}=this;for(const n of r)n.type?.toLowerCase()==i&&e.push(n);return e}findNodeByTitle(t){const{_nodes:e}=this;for(const i of e)if(i.title==t)return i;return null}findNodesByTitle(t){const e=[],{_nodes:i}=this;for(const r of i)r.title==t&&e.push(r);return e}getNodeOnPos(t,e,i){const r=i||this._nodes;let n=r.length;for(;--n>=0;){const i=r[n];if(i.isPointInside(t,e))return i}return null}getGroupOnPos(t,e){return this._groups.toReversed().find((i=>i.isPointInside(t,e)))}getGroupTitlebarOnPos(t,e){return this._groups.toReversed().find((i=>i.isPointInTitlebar(t,e)))}getRerouteOnPos(t,e){for(const i of this.reroutes.values()){const{pos:r}=i;if(isSortaInsideOctagon(t-r[0],e-r[1],2*Reroute.radius))return i}}snapToGrid(t){const e=this.getSnapToGridSize();if(e)for(const i of getAllNestedItems(t))i.pinned||i.snapToGrid(e)}getSnapToGridSize(){return LiteGraph.alwaysSnapToGrid?LiteGraph.CANVAS_GRID_SIZE||1:LiteGraph.CANVAS_GRID_SIZE}checkNodeTypes(){const{_nodes:t}=this;for(const[e,i]of t.entries()){const r=LiteGraph.registered_node_types[i.type];if(i.constructor==r)continue;console.log("node being replaced by newer version:",i.type);const n=LiteGraph.createNode(i.type);n&&(t[e]=n,n.configure(i.serialize()),n.graph=this,this._nodes_by_id[n.id]=n,i.inputs&&(n.inputs=[...i.inputs]),i.outputs&&(n.outputs=[...i.outputs]))}this.updateExecutionOrder()}onAction(t,e,i){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var r=0;r<this._input_nodes.length;++r){var n=this._input_nodes[r];if(n.properties.name==t){n.actionDo(t,e,i);break}}}trigger(t,e){this.onTrigger?.(t,e)}addInput(t,e,i){this.inputs[t]||(this.beforeChange(),this.inputs[t]={name:t,type:e,value:i},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())}setInputData(t,e){var i=this.inputs[t];i&&(i.value=e)}getInputData(t){var e=this.inputs[t];return e?e.value:null}renameInput(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}}changeInputType(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))}removeInput(t){return!!this.inputs[t]&&(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)}addOutput(t,e,i){this.outputs[t]={name:t,type:e,value:i},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}setOutputData(t,e){var i=this.outputs[t];i&&(i.value=e)}getOutputData(t){var e=this.outputs[t];return e?e.value:null}renameOutput(t,e){return!!this.outputs[t]&&(this.outputs[e]?(console.error("there is already one output with that name"),!1):(this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),void(this.onInputsOutputsChange&&this.onInputsOutputsChange())))}changeOutputType(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))}removeOutput(t){return!!this.outputs[t]&&(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0)}triggerInput(t,e){const i=this.findNodesByTitle(t);for(const r of i)r.onTrigger(e)}setCallback(t,e){const i=this.findNodesByTitle(t);for(const r of i)r.setTrigger(e)}beforeChange(t){this.onBeforeChange?.(this,t),this.canvasAction((t=>t.onBeforeChange?.(this)))}afterChange(t){this.onAfterChange?.(this,t),this.canvasAction((t=>t.onAfterChange?.(this)))}connectionChange(t){this.updateExecutionOrder(),this.onConnectionChange?.(t),this._version++,this.canvasAction((t=>t.onConnectionChange?.()))}clearTriggeredSlots(){for(const t of this._links.values())t&&t._last_time&&(t._last_time=0)}change(){this.canvasAction((t=>t.setDirty(!0,!0))),this.on_change?.(this)}setDirtyCanvas(t,e){this.canvasAction((i=>i.setDirty(t,e)))}addFloatingLink(t){-1===t.id&&(t.id=++this.#yt),this.#vt.set(t.id,t);const e=-1!==t.target_id?this.getNodeById(t.target_id)?.inputs?.[t.target_slot]:this.getNodeById(t.origin_id)?.outputs?.[t.origin_slot];e?(e._floatingLinks??=new Set,e._floatingLinks.add(t)):console.warn(`Adding invalid floating link: target/slot: [${t.target_id}/${t.target_slot}] origin/slot: [${t.origin_id}/${t.origin_slot}]`);const i=LLink.getReroutes(this,t);for(const r of i)r.floatingLinkIds.add(t.id);return t}removeFloatingLink(t){this.#vt.delete(t.id);const e=-1!==t.target_id?this.getNodeById(t.target_id)?.inputs?.[t.target_slot]:this.getNodeById(t.origin_id)?.outputs?.[t.origin_slot];e&&e._floatingLinks?.delete(t);const i=LLink.getReroutes(this,t);for(const r of i)r.floatingLinkIds.delete(t.id),0===r.floatingLinkIds.size&&delete r.floating,0===r.totalLinks&&this.removeReroute(r.id)}getReroute(t){return null==t?void 0:this.reroutes.get(t)}setReroute({id:t,parentId:e,pos:i,linkIds:r,floating:n}){t??=++this.state.lastRerouteId,t>this.state.lastRerouteId&&(this.state.lastRerouteId=t);const s=this.reroutes.get(t)??new Reroute(t,this);return s.update(e,i,r,n),this.reroutes.set(t,s),s}createReroute(t,e){const i=++this.state.lastRerouteId,r=e instanceof Reroute?e.linkIds:[e.id],n=e instanceof Reroute?e.floatingLinkIds:[e.id],s=new Reroute(i,this,t,e.parentId,r,n);this.reroutes.set(i,s);for(const o of r){const t=this._links.get(o);if(!t)continue;t.parentId===e.parentId&&(t.parentId=i);const r=LLink.getReroutes(this,t);for(const n of r.filter((t=>t.parentId===e.parentId)))n.parentId=i}for(const o of n){const t=this.floatingLinks.get(o);if(!t)continue;t.parentId===e.parentId&&(t.parentId=i);const r=LLink.getReroutes(this,t);for(const n of r.filter((t=>t.parentId===e.parentId)))n.parentId=i}return s}removeReroute(t){const{reroutes:e}=this,i=e.get(t);if(!i)return;const{parentId:r,linkIds:n,floatingLinkIds:s}=i;for(const o of e.values())o.parentId===t&&(o.parentId=r);for(const o of n){const e=this._links.get(o);e&&e.parentId===t&&(e.parentId=r)}for(const o of s){const e=this.floatingLinks.get(o);if(!e){console.warn(`Removed reroute had floating link ID that did not exist [${o}]`);continue}const n=LLink.getReroutes(this,e),s=n.at(-1),a=n.at(-2);i===s&&(1!==a?.totalLinks?this.removeFloatingLink(e):e.parentId===t&&(e.parentId=r,a.floating=i.floating))}e.delete(t),this.setDirtyCanvas(!1,!0)}removeLink(t){const e=this._links.get(t);if(!e)return;const i=this.getNodeById(e.target_id);i?.disconnectInput(e.target_slot,!1),e.disconnect(this)}serialize(t){const{config:e,state:i,groups:r,nodes:n,reroutes:s,extra:o,floatingLinks:a}=this.asSerialisable(t),l=[...this._links.values()],c=l.map((t=>t.serialize()));return s?.length&&(o.linkExtensions=l.filter((t=>void 0!==t.parentId)).map((t=>({id:t.id,parentId:t.parentId})))),o.reroutes=s?.length?s:void 0,{id:this.id,revision:this.revision,last_node_id:i.lastNodeId,last_link_id:i.lastLinkId,nodes:n,links:c,floatingLinks:a,groups:r,config:e,extra:o,version:LiteGraph.VERSION}}asSerialisable(t){const{id:e,revision:i,config:r,state:n,extra:s}=this,o=!LiteGraph.use_uuids&&t?.sortNodes?[...this._nodes].sort(((t,e)=>t.id-e.id)):this._nodes,a=o.map((t=>t.serialize())),l=this._groups.map((t=>t.serialize())),c=this._links.size?[...this._links.values()].map((t=>t.asSerialisable())):void 0,h=this.floatingLinks.size?[...this.floatingLinks.values()].map((t=>t.asSerialisable())):void 0,u=this.reroutes.size?[...this.reroutes.values()].map((t=>t.asSerialisable())):void 0,d={id:e,revision:i,version:LGraph.serialisedSchemaVersion,config:r,state:n,groups:l,nodes:a,links:c,floatingLinks:h,reroutes:u,extra:s};return this.onSerialize?.(d),d}configure(t,e){if(!t)return;let i;if(e||this.clear(),t.id&&(this.id=t.id),this.id===zeroUuid&&(this.id=createUuidv4()),.4===t.version){const{extra:e}=t;if(Array.isArray(t.links))for(const i of t.links){const t=LLink.createFromArray(i);this._links.set(t.id,t)}if(Array.isArray(e?.linkExtensions))for(const t of e.linkExtensions){const e=this._links.get(t.id);e&&(e.parentId=t.parentId)}i=e?.reroutes}else{if(t.state){const{state:{lastGroupId:e,lastLinkId:i,lastNodeId:r,lastRerouteId:n}}=t;null!=e&&(this.state.lastGroupId=e),null!=i&&(this.state.lastLinkId=i),null!=r&&(this.state.lastNodeId=r),null!=n&&(this.state.lastRerouteId=n)}if(Array.isArray(t.links))for(const e of t.links){const t=LLink.create(e);this._links.set(t.id,t)}i=t.reroutes}if(Array.isArray(i))for(const o of i)this.setReroute(o);const r=t.nodes;for(const o in t)["nodes","groups","links","state","reroutes","floatingLinks","id"].includes(o)||(this[o]=t[o]);let n=!1;if(this._nodes=[],r){for(const t of r){let e=LiteGraph.createNode(String(t.type),t.title);e||(LiteGraph.debug&&console.log("Node not found or has errors:",t.type),e=new LGraphNode(""),e.last_serialization=t,e.has_errors=!0,n=!0),e.id=t.id,this.add(e,!0)}for(const t of r){const e=this.getNodeById(t.id);e?.configure(t)}}if(Array.isArray(t.floatingLinks))for(const o of t.floatingLinks){const t=LLink.create(o);this.addFloatingLink(t),t.id>this.#yt&&(this.#yt=t.id)}for(const o of this.reroutes.values())o.validateLinks(this._links,this.floatingLinks)||this.reroutes.delete(o.id);this._groups.length=0;const s=t.groups;if(s)for(const o of s){const t=new LiteGraph.LGraphGroup;t.configure(o),this.add(t)}return this.updateExecutionOrder(),this.extra=t.extra||{},delete this.extra.linkExtensions,this.onConfigure?.(t),this._version++,this.setDirtyCanvas(!0,!0),n}load(t,e){const i=this;if(t instanceof Blob||t instanceof File){const r=new FileReader;return r.addEventListener("load",(function(t){const r=stringOrEmpty(t.target?.result),n=JSON.parse(r);i.configure(n),e?.()})),void r.readAsText(t)}const r=new XMLHttpRequest;r.open("GET",t,!0),r.send(null),r.addEventListener("load",(function(){if(200!==r.status)return void console.error("Error loading graph:",r.status,r.response);const t=JSON.parse(r.response);i.configure(t),e?.()})),r.addEventListener("error",(t=>{console.error("Error loading graph:",t)}))}}class LiteGraphGlobal{constructor(){this.SlotShape=SlotShape,this.SlotDirection=SlotDirection,this.SlotType=SlotType,this.LabelPosition=LabelPosition,this.VERSION=.4,this.CANVAS_GRID_SIZE=10,this.NODE_TITLE_HEIGHT=30,this.NODE_TITLE_TEXT_Y=20,this.NODE_SLOT_HEIGHT=20,this.NODE_WIDGET_HEIGHT=20,this.NODE_WIDTH=140,this.NODE_MIN_WIDTH=50,this.NODE_COLLAPSED_RADIUS=10,this.NODE_COLLAPSED_WIDTH=80,this.NODE_TITLE_COLOR="#999",this.NODE_SELECTED_TITLE_COLOR="#FFF",this.NODE_TEXT_SIZE=14,this.NODE_TEXT_COLOR="#AAA",this.NODE_TEXT_HIGHLIGHT_COLOR="#EEE",this.NODE_SUBTEXT_SIZE=12,this.NODE_DEFAULT_COLOR="#333",this.NODE_DEFAULT_BGCOLOR="#353535",this.NODE_DEFAULT_BOXCOLOR="#666",this.NODE_DEFAULT_SHAPE=RenderShape.ROUND,this.NODE_BOX_OUTLINE_COLOR="#FFF",this.NODE_ERROR_COLOUR="#E00",this.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",this.DEFAULT_GROUP_FONT=24,this.WIDGET_BGCOLOR="#222",this.WIDGET_OUTLINE_COLOR="#666",this.WIDGET_ADVANCED_OUTLINE_COLOR="rgba(56, 139, 253, 0.8)",this.WIDGET_TEXT_COLOR="#DDD",this.WIDGET_SECONDARY_TEXT_COLOR="#999",this.LINK_COLOR="#9A9",this.EVENT_LINK_COLOR="#A86",this.CONNECTING_LINK_COLOR="#AFA",this.MAX_NUMBER_OF_NODES=1e4,this.DEFAULT_POSITION=[100,100],this.VALID_SHAPES=["default","box","round","card"],this.ROUND_RADIUS=8,this.BOX_SHAPE=RenderShape.BOX,this.ROUND_SHAPE=RenderShape.ROUND,this.CIRCLE_SHAPE=RenderShape.CIRCLE,this.CARD_SHAPE=RenderShape.CARD,this.ARROW_SHAPE=RenderShape.ARROW,this.GRID_SHAPE=RenderShape.GRID,this.INPUT=NodeSlotType.INPUT,this.OUTPUT=NodeSlotType.OUTPUT,this.EVENT=-1,this.ACTION=-1,this.NODE_MODES=["Always","On Event","Never","On Trigger"],this.NODE_MODES_COLORS=["#0B8236","#FF8B00","#333","#2885D7","#626"],this.ALWAYS=LGraphEventMode.ALWAYS,this.ON_EVENT=LGraphEventMode.ON_EVENT,this.NEVER=LGraphEventMode.NEVER,this.ON_TRIGGER=LGraphEventMode.ON_TRIGGER,this.UP=LinkDirection.UP,this.DOWN=LinkDirection.DOWN,this.LEFT=LinkDirection.LEFT,this.RIGHT=LinkDirection.RIGHT,this.CENTER=LinkDirection.CENTER,this.LINK_RENDER_MODES=["Straight","Linear","Spline"],this.HIDDEN_LINK=LinkRenderType.HIDDEN_LINK,this.STRAIGHT_LINK=LinkRenderType.STRAIGHT_LINK,this.LINEAR_LINK=LinkRenderType.LINEAR_LINK,this.SPLINE_LINK=LinkRenderType.SPLINE_LINK,this.NORMAL_TITLE=TitleMode.NORMAL_TITLE,this.NO_TITLE=TitleMode.NO_TITLE,this.TRANSPARENT_TITLE=TitleMode.TRANSPARENT_TITLE,this.AUTOHIDE_TITLE=TitleMode.AUTOHIDE_TITLE,this.VERTICAL_LAYOUT="vertical",this.proxy=null,this.node_images_path="",this.debug=!1,this.catch_exceptions=!0,this.throw_errors=!0,this.allow_scripts=!1,this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.Globals={},this.searchbox_extras={},this.node_box_coloured_when_on=!1,this.node_box_coloured_by_mode=!1,this.dialog_close_on_mouse_leave=!1,this.dialog_close_on_mouse_leave_delay=500,this.shift_click_do_break_link_from=!1,this.click_do_break_link_to=!1,this.ctrl_alt_click_do_break_link=!0,this.snaps_for_comfy=!0,this.snap_highlights_node=!0,this.search_hide_on_mouse_leave=!0,this.search_filter_enabled=!1,this.search_show_all_on_open=!0,this.auto_load_slot_types=!1,this.registered_slot_in_types={},this.registered_slot_out_types={},this.slot_types_in=[],this.slot_types_out=[],this.slot_types_default_in={},this.slot_types_default_out={},this.alt_drag_do_clone_nodes=!1,this.do_add_triggers_slots=!1,this.allow_multi_output_for_events=!0,this.middle_click_slot_add_default_node=!1,this.release_link_on_empty_shows_menu=!1,this.pointerevents_method="pointer",this.ctrl_shift_v_paste_connect_unselected_outputs=!0,this.use_uuids=!1,this.highlight_selected_group=!0,this.context_menu_scaling=!1,this.LGraph=LGraph,this.LLink=LLink,this.LGraphNode=LGraphNode,this.LGraphGroup=LGraphGroup,this.DragAndScale=DragAndScale,this.LGraphCanvas=LGraphCanvas,this.ContextMenu=ContextMenu,this.CurveEditor=CurveEditor,this.Reroute=Reroute,this.InputIndicators=InputIndicators,this.uuidv4=createUuidv4,this.distance=distance,this.isInsideRectangle=isInsideRectangle,this.overlapBounding=overlapBounding}registerNodeType(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,this.debug&&console.log("Node registered:",t);const i=e.name,r=t.lastIndexOf("/");e.category=t.substring(0,r),e.title||=i;for(const s in LGraphNode.prototype)e.prototype[s]||=LGraphNode.prototype[s];const n=this.registered_node_types[t];n&&console.log("replacing node type:",t),this.registered_node_types[t]=e,e.constructor.name&&(this.Nodes[i]=e),this.onNodeTypeRegistered?.(t,e),n&&this.onNodeTypeReplaced?.(t,e,n),e.prototype.onPropertyChange&&console.warn(`LiteGraph node class ${t} has onPropertyChange method, it must be called onPropertyChanged with d at the end`),this.auto_load_slot_types&&new e(e.title||"tmpnode")}unregisterNodeType(t){const e="string"==typeof t?this.registered_node_types[t]:t;if(!e)throw`node type not found: ${String(t)}`;delete this.registered_node_types[String(e.type)];const i=e.constructor.name;i&&delete this.Nodes[i]}registerNodeAndSlotType(t,e,i){i||=!1;const r=("string"==typeof t&&"anonymous"!==this.registered_node_types[t]?this.registered_node_types[t]:t).constructor.type;let n=[];n="string"==typeof e?e.split(","):e==this.EVENT||e==this.ACTION?["_event_"]:["*"];for(let s of n){""===s&&(s="*");const t=i?"registered_slot_out_types":"registered_slot_in_types";void 0===this[t][s]&&(this[t][s]={nodes:[]}),this[t][s].nodes.includes(r)||this[t][s].nodes.push(r);const e=i?this.slot_types_out:this.slot_types_in;e.includes(s.toLowerCase())||(e.push(s.toLowerCase()),e.sort())}}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}createNode(t,e,i){const r=this.registered_node_types[t];if(!r)return this.debug&&console.warn(`GraphNode type "${t}" not registered.`),null;e=e||r.title||t;let n=null;if(this.catch_exceptions)try{n=new r(e)}catch(s){return console.error(s),null}else n=new r(e);if(n.type=t,!n.title&&e&&(n.title=e),n.properties||={},n.properties_info||=[],n.flags||={},n.size||=n.computeSize(),n.pos||=[this.DEFAULT_POSITION[0],this.DEFAULT_POSITION[1]],n.mode||=LGraphEventMode.ALWAYS,i)for(const o in i)n[o]=i[o];return n.onNodeCreated?.(),n}getNodeType(t){return this.registered_node_types[t]}getNodeTypesInCategory(t,e){const i=[];for(const r in this.registered_node_types){const n=this.registered_node_types[r];n.filter==e&&(""==t?null==n.category&&i.push(n):n.category==t&&i.push(n))}return i}getNodeTypesCategories(t){const e={"":1};for(const r in this.registered_node_types){const i=this.registered_node_types[r];if(i.category&&!i.skip_list){if(i.filter!=t)continue;e[i.category]=1}}const i=[];for(const r in e)i.push(r);return i}reloadNodes(t){const e=document.getElementsByTagName("script"),i=[];for(const s of e)i.push(s);const r=document.getElementsByTagName("head")[0];t=document.location.href+t;for(const s of i){const e=s.src;if(e&&e.substr(0,t.length)==t)try{this.debug&&console.log("Reloading:",e);const t=document.createElement("script");t.type="text/javascript",t.src=e,r.append(t),s.remove()}catch(n){if(this.throw_errors)throw n;this.debug&&console.log("Error while reloading",e)}}this.debug&&console.log("Nodes reloaded")}cloneObject(t,e){if(null==t)return null;const i=JSON.parse(JSON.stringify(t));if(!e)return i;for(const r in i)e[r]=i[r];return e}isValidConnection(t,e){if(""!=t&&"*"!==t||(t=0),""!=e&&"*"!==e||(e=0),!t||!e||t==e||t==this.EVENT&&e==this.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),!t.includes(",")&&!e.includes(","))return t==e;const i=t.split(","),r=e.split(",");for(const n of i)for(const t of r)if(this.isValidConnection(n,t))return!0;return!1}getParameterNames(t){return String(t).replaceAll(/\/\/.*$/gm,"").replaceAll(/\s+/g,"").replaceAll(/\/\*[^*/]*\*\//g,"").split("){",1)[0].replace(/^[^(]*\(/,"").replaceAll(/=[^,]+/g,"").split(",").filter(Boolean)}pointerListenerAdd(t,e,i,r=!1){if(!t||!t.addEventListener||!e||"function"!=typeof i)return;let n=this.pointerevents_method,s=e;if("pointer"==n&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log(`Converting pointer[${s}] : down move up cancel enter TO touchstart touchmove touchend, etc ..`),s){case"down":n="touch",s="start";break;case"move":case"cancel":n="touch";break;case"up":n="touch",s="end";break;case"enter":console.log("debug: Should I send a move event?");break;default:console.warn(`PointerEvent not available in this browser ? The event ${s} would not be called`)}switch(s){case"down":case"up":case"move":case"over":case"out":case"enter":t.addEventListener(n+s,i,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if("mouse"!=n)return t.addEventListener(n+s,i,r);default:return t.addEventListener(s,i,r)}}pointerListenerRemove(t,e,i,r=!1){if(t&&t.removeEventListener&&e&&"function"==typeof i)switch(e){case"down":case"up":case"move":case"over":case"out":case"enter":"pointer"!=this.pointerevents_method&&"mouse"!=this.pointerevents_method||t.removeEventListener(this.pointerevents_method+e,i,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if("pointer"==this.pointerevents_method)return t.removeEventListener(this.pointerevents_method+e,i,r);default:return t.removeEventListener(e,i,r)}}getTime(){return performance.now()}colorToString(t){return`rgba(${Math.round(255*t[0]).toFixed()},${Math.round(255*t[1]).toFixed()},${Math.round(255*t[2]).toFixed()},${4==t.length?t[3].toFixed(2):"1.0"})`}growBounding(t,e,i){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),i<t[1]?t[1]=i:i>t[3]&&(t[3]=i)}isInsideBounding(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}hex2num(t){"#"==t.charAt(0)&&(t=t.slice(1)),t=t.toUpperCase();const e="0123456789ABCDEF",i=new Array(3);let r,n,s=0;for(let o=0;o<6;o+=2)r=e.indexOf(t.charAt(o)),n=e.indexOf(t.charAt(o+1)),i[s]=16*r+n,s++;return i}num2hex(t){const e="0123456789ABCDEF";let i,r,n="#";for(let s=0;s<3;s++)i=t[s]/16,r=t[s]%16,n+=e.charAt(i)+e.charAt(r);return n}closeAllContextMenus(t=window){const e=[...t.document.querySelectorAll(".litecontextmenu")];if(e.length)for(const i of e)"close"in i&&"function"==typeof i.close?i.close():i.remove()}extendClass(t,e){for(const i in e)t.hasOwnProperty(i)||(t[i]=e[i]);if(e.prototype)for(const i in e.prototype)e.prototype.hasOwnProperty(i)&&(t.prototype.hasOwnProperty(i)||(e.prototype.__lookupGetter__(i)?t.prototype.__defineGetter__(i,e.prototype.__lookupGetter__(i)):t.prototype[i]=e.prototype[i],e.prototype.__lookupSetter__(i)&&t.prototype.__defineSetter__(i,e.prototype.__lookupSetter__(i))))}}function loadPolyfills(){"undefined"!=typeof window&&window.CanvasRenderingContext2D&&!window.CanvasRenderingContext2D.prototype.roundRect&&(window.CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,r,n,s){let o=0,a=0,l=0,c=0;if(0!==n){if(void 0===s&&(s=n),Array.isArray(n))if(1==n.length)o=a=l=c=n[0];else if(2==n.length)o=c=n[0],a=l=n[1];else{if(4!=n.length)return;o=n[0],a=n[1],l=n[2],c=n[3]}else{o=n||0,a=n||0;const t=!Array.isArray(s)&&s?s:0;l=t,c=t}this.moveTo(t+o,e),this.lineTo(t+i-a,e),this.quadraticCurveTo(t+i,e,t+i,e+a),this.lineTo(t+i,e+r-c),this.quadraticCurveTo(t+i,e+r,t+i-c,e+r),this.lineTo(t+c,e+r),this.quadraticCurveTo(t,e+r,t,e+r-l),this.lineTo(t,e+l),this.quadraticCurveTo(t,e,t+o,e)}else this.rect(t,e,i,r)}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})}Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const LiteGraph=new LiteGraphGlobal;function clamp(t,e,i){return e>t?e:i<t?i:t}loadPolyfills(),window._CCSettings={platform:"web-desktop",groupList:["default"],collisionMatrix:[[!0]],hasResourcesBundle:!0,hasStartSceneBundle:!1,remoteBundles:[],subpackages:[],launchScene:"db://assets/Scene/startScene.fire",orientation:"",jsList:[]},function(t,e,i){function r(i){var n=e[i];if(!n){var s=t[i];if(!s)return;var o={};n=e[i]={exports:o},s[0]((function(t){return r(s[1][t]||t)}),n,o)}return n.exports}for(var n=0;n<i.length;n++)r(i[n])}({1:[function(t){t("../core/platform/CCClass");var e=t("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(){cc.logID(1006)},update:function(){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction",extends:cc.Action,ctor:function(){this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Class({name:"cc.Speed",extends:cc.Action,ctor:function(t,e){this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(cc.errorID(1021),!1)},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Class({name:"cc.Follow",extends:cc.Action,ctor:function(t,e){this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,i=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoundarySet:function(t){this._boundarySet=t},setBoudarySet:function(t){this.setBoundarySet(t)},initWithTarget:function(t,e){if(!t)return cc.errorID(1022),!1;e=e||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=e,this._boundarySet=!(0===e.width&&0===e.height),this._boundaryFullyCovered=!1;var i=cc.winSize;return this._fullScreenSize=cc.v2(i.width,i.height),this._halfScreenSize=this._fullScreenSize.mul(.5),this._boundarySet&&(this.leftBoundary=-(e.x+e.width-this._fullScreenSize.x),this.rightBoundary=-e.x,this.topBoundary=-e.y,this.bottomBoundary=-(e.y+e.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(){var t=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),r=t.sub(i),n=this.target.parent.convertToNodeSpaceAR(r.add(this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(e.clampf(n.x,this.leftBoundary,this.rightBoundary),e.clampf(n.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(n.x,n.y)},isDone:function(){return!this._followedNode.activeInHierarchy},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}},{"../core/platform/CCClass":196,"../core/utils/misc":271}],2:[function(){function t(t,e){return t[Math.min(t.length-1,Math.max(e,0))]}function e(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(cc.v2(t[i].x,t[i].y));return e}function i(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.v2(t[i].x,t[i].y));return e}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null,void 0!==i&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return e&&0!==e.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0):(cc.errorID(1024),!1)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,i(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.v2(this.target.x,this.target.y),this._accumulatedDiff=cc.v2(0,0)},update:function(e){var i,r;e=this._computeEaseTime(e);var n=this._points;if(1===e)i=n.length-1,r=1;else{var s=this._deltaT;r=(e-s*(i=0|e/s))/s}var o,a,l=function(t,e,i,r,n,s){var o=s*s,a=o*s,l=(1-n)/2,c=l*(2*o-a-s),h=l*(-a+o)+(2*a-3*o)+1,u=l*(a-2*o+s)+-2*a+3*o,d=l*(a-o),p=t.x*c+e.x*h+i.x*u+r.x*d,f=t.y*c+e.y*h+i.y*u+r.y*d;return cc.v2(p,f)}(t(n,i-1),t(n,i-0),t(n,i+1),t(n,i+2),this._tension,r);if(cc.macro.ENABLE_STACKABLE_ACTIONS&&(o=this.target.x-this._previousPosition.x,a=this.target.y-this._previousPosition.y,0!==o||0!==a)){var c=this._accumulatedDiff;o=c.x+o,a=c.y+a,c.x=o,c.y=a,l.x+=o,l.y+=a}this.updatePosition(l)},reverse:function(){var t=e(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy",extends:cc.CardinalSplineTo,ctor:function(t,e,i){this._startPosition=cc.v2(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.x,this._startPosition.y=t.y},reverse:function(){for(var t,i=this._points.slice(),r=i[0],n=1;n<i.length;++n)t=i[n],i[n]=t.sub(r),r=t;var s=e(i);for(r=s[s.length-1],s.pop(),r.x=-r.x,r.y=-r.y,s.unshift(r),n=1;n<s.length;++n)(t=s[n]).x=-t.x,t.y=-t.y,t.x+=r.x,t.y+=r.y,s[n]=t,r=t;return cc.cardinalSplineBy(this._duration,s,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,r=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=r,this.target.setPosition(i,r)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,i(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo",extends:cc.CardinalSplineTo,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,i(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy",extends:cc.CardinalSplineBy,ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,i(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)}},{}],3:[function(){cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};var t={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return e}};cc.easeExponentialIn=function(){return t};var e={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return t}};cc.easeExponentialOut=function(){return e};var i={easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return i}};cc.easeExponentialInOut=function(){return i};var r={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return n}};cc.easeSineIn=function(){return r};var n={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return r}};cc.easeSineOut=function(){return n};var s={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return s}};cc.easeSineInOut=function(){return s};var o={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return a}};cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:o};var a={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return o}};function l(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:a},cc.easeElasticInOut=function(t){return{_period:t=t||.3,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t*=2,i||(i=this._period=.3*1.5);var r=i/4;e=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-r)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-r)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}};var c={easing:function(t){return 1-l(1-t)},reverse:function(){return h}};cc.easeBounceIn=function(){return c};var h={easing:function(t){return l(t)},reverse:function(){return c}};cc.easeBounceOut=function(){return h};var u={easing:function(t){return t<.5?.5*(1-l(1-(t*=2))):.5*l(2*t-1)+.5},reverse:function(){return u}};cc.easeBounceInOut=function(){return u};var d={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return p}};cc.easeBackIn=function(){return d};var p={easing:function(t){return 0===t?0:(t-=1)*t*(2.70158*t+1.70158)+1},reverse:function(){return d}};cc.easeBackOut=function(){return p};var f={easing:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1},reverse:function(){return f}};cc.easeBackInOut=function(){return f},cc.easeBezierAction=function(t,e,i,r){return{easing:function(n){return Math.pow(1-n,3)*t+3*n*Math.pow(1-n,2)*e+3*Math.pow(n,2)*(1-n)*i+Math.pow(n,3)*r},reverse:function(){return cc.easeBezierAction(r,i,e,t)}}};var _={easing:function(t){return Math.pow(t,2)},reverse:function(){return _}};cc.easeQuadraticActionIn=function(){return _};var m={easing:function(t){return-t*(t-2)},reverse:function(){return m}};cc.easeQuadraticActionOut=function(){return m};var g={easing:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1)},reverse:function(){return g}};cc.easeQuadraticActionInOut=function(){return g};var y={easing:function(t){return t*t*t*t},reverse:function(){return y}};cc.easeQuarticActionIn=function(){return y};var v={easing:function(t){return-((t-=1)*t*t*t-1)},reverse:function(){return v}};cc.easeQuarticActionOut=function(){return v};var b={easing:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},reverse:function(){return b}};cc.easeQuarticActionInOut=function(){return b};var x={easing:function(t){return t*t*t*t*t},reverse:function(){return x}};cc.easeQuinticActionIn=function(){return x};var T={easing:function(t){return(t-=1)*t*t*t*t+1},reverse:function(){return T}};cc.easeQuinticActionOut=function(){return T};var C={easing:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},reverse:function(){return C}};cc.easeQuinticActionInOut=function(){return C};var S={easing:function(t){return-1*(Math.sqrt(1-t*t)-1)},reverse:function(){return S}};cc.easeCircleActionIn=function(){return S};var w={easing:function(t){return t-=1,Math.sqrt(1-t*t)},reverse:function(){return w}};cc.easeCircleActionOut=function(){return w};var A={easing:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},reverse:function(){return A}};cc.easeCircleActionInOut=function(){return A};var E={easing:function(t){return t*t*t},reverse:function(){return E}};cc.easeCubicActionIn=function(){return E};var D={easing:function(t){return(t-=1)*t*t+1},reverse:function(){return D}};cc.easeCubicActionOut=function(){return D};var L={easing:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},reverse:function(){return L}};cc.easeCubicActionInOut=function(){return L}},{}],4:[function(){cc.ActionInstant=cc.Class({name:"cc.ActionInstant",extends:cc.FiniteTimeAction,isDone:function(){return!0},step:function(){this.update(1)},update:function(){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.Class({name:"cc.Show",extends:cc.ActionInstant,update:function(){for(var t=this.target.getComponentsInChildren(cc.RenderComponent),e=0;e<t.length;++e)t[e].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.Class({name:"cc.Hide",extends:cc.ActionInstant,update:function(){for(var t=this.target.getComponentsInChildren(cc.RenderComponent),e=0;e<t.length;++e)t[e].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility",extends:cc.ActionInstant,update:function(){for(var t=this.target.getComponentsInChildren(cc.RenderComponent),e=0;e<t.length;++e){var i=t[e];i.enabled=!i.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf",extends:cc.ActionInstant,ctor:function(t){this._isNeedCleanUp=!0,void 0!==t&&this.init(t)},update:function(){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.DestroySelf=cc.Class({name:"cc.DestroySelf",extends:cc.ActionInstant,update:function(){this.target.destroy()},reverse:function(){return new cc.DestroySelf},clone:function(){return new cc.DestroySelf}}),cc.destroySelf=function(){return new cc.DestroySelf},cc.FlipX=cc.Class({name:"cc.FlipX",extends:cc.ActionInstant,ctor:function(t){this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.Class({name:"cc.FlipY",extends:cc.ActionInstant,ctor:function(t){this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.Class({name:"cc.Place",extends:cc.ActionInstant,ctor:function(t,e){this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.Class({name:"cc.CallFunc",extends:cc.ActionInstant,ctor:function(t,e,i){this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}},{}],5:[function(){function t(t,e,i,r,n){return Math.pow(1-n,3)*t+3*n*Math.pow(1-n,2)*e+3*Math.pow(n,2)*(1-n)*i+Math.pow(n,3)*r}cc.ActionInterval=cc.Class({name:"cc.ActionInterval",extends:cc.FiniteTimeAction,ctor:function(t){this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=null,this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,void 0!==t&&cc.ActionInterval.prototype.initWithDuration.call(this,t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(){this._easeList?this._easeList.length=0:this._easeList=[];for(var t=0;t<arguments.length;t++)this._easeList.push(arguments[t]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,r=e.length;i<r;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(t){return t<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.Class({name:"cc.Sequence",extends:cc.ActionInterval,ctor:function(t){this._actions=[],this._split=null,this._last=0,this._reversed=!1;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(i>=0&&null==e[i]&&cc.logID(1015),i>=0){for(var r,n=e[0],s=1;s<i;s++)e[s]&&(r=n,n=cc.Sequence._actionOneTwo(r,e[s]));this.initWithTwoActions(n,e[i])}}else cc.errorID(1019)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1025),!1;var i=t._duration,r=e._duration,n=(i*=t._repeatMethod?t._timesForRepeat:1)+(r*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(n),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i,r=0,n=this._split,s=this._actions,o=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===r&&1===o&&this._reversed&&(s[1].update(0),s[1].stop())):(r=1,e=1===n?1:(t-n)/(1-n),-1===o&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),0===o&&(s[0].update(1),s[0].stop())),i=s[r],o===r&&i.isDone()||(o!==r&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=r)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1019),null;var i=e.length-1;i>=0&&null==e[i]&&cc.logID(1015);var r=null;if(i>=0){r=e[0];for(var n=1;n<=i;n++)e[n]&&(r=cc.Sequence._actionOneTwo(r,e[n]))}return r},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.Class({name:"cc.Repeat",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,r=this._times,n=this._nextDt;if(t>=n){for(;t>n&&this._total<r;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),n+=e._duration/i,this._nextDt=n>1?1:n;t>=1&&this._total<r&&(e.update(1),this._total++),this._actionInstant||(this._total===r?e.stop():e.update(t-(n-e._duration/i)))}else e.update(t*r%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.RepeatForever=cc.Class({name:"cc.RepeatForever",extends:cc.ActionInterval,ctor:function(t){this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?(this._innerAction=t,!0):(cc.errorID(1026),!1)},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.Class({name:"cc.Spawn",extends:cc.ActionInterval,ctor:function(t){this._one=null,this._two=null;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(i>=0&&null==e[i]&&cc.logID(1015),i>=0){for(var r,n=e[0],s=1;s<i;s++)e[s]&&(r=n,n=cc.Spawn._actionOneTwo(r,e[s]));this.initWithTwoActions(n,e[i])}}else cc.errorID(1020)},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1027),!1;var i=!1,r=t._duration,n=e._duration;return this.initWithDuration(Math.max(r,n))&&(this._one=t,this._two=e,r>n?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(r-n)):r<n&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(n-r))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1020),null;e.length>0&&null==e[e.length-1]&&cc.logID(1015);for(var i=e[0],r=1;r<e.length;r++)null!=e[r]&&(i=cc.Spawn._actionOneTwo(i,e[r]));return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.Class({name:"cc.RotateTo",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){this._startAngle=0,this._dstAngle=0,this._angle=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngle=e,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.angle%360,i=cc.RotateTo._reverse?this._dstAngle-e:this._dstAngle+e;i>180&&(i-=360),i<-180&&(i+=360),this._startAngle=e,this._angle=cc.RotateTo._reverse?i:-i},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._angle*t)}}),cc.rotateTo=function(t,e){return new cc.RotateTo(t,e)},cc.RotateBy=cc.Class({name:"cc.RotateBy",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){e*=cc.RotateBy._reverse?1:-1,this._deltaAngle=0,this._startAngle=0,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaAngle=e,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaAngle),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=t.angle},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._deltaAngle*t)},reverse:function(){var t=new cc.RotateBy;return t.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e){return new cc.RotateBy(t,e)},cc.MoveBy=cc.Class({name:"cc.MoveBy",extends:cc.ActionInterval,ctor:function(t,e,i){this._positionDelta=cc.v2(0,0),this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),void 0!==e&&cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,i=t.y;this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,r=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var n=this.target.x,s=this.target.y,o=this._previousPosition;r.x=r.x+n-o.x,r.y=r.y+s-o.y,e+=r.x,i+=r.y,o.x=e,o.y=i,this.target.setPosition(e,i)}else this.target.setPosition(r.x+e,r.y+i)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.Class({name:"cc.MoveTo",extends:cc.MoveBy,ctor:function(t,e,i){this._endPosition=cc.v2(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.x,this._positionDelta.y=this._endPosition.y-t.y}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.Class({name:"cc.SkewTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,this._deltaY=0,void 0!==i&&cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){var r=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,r=!0),r},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.Class({name:"cc.SkewBy",extends:cc.SkewTo,ctor:function(t,e,i){void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var r=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,r=!0),r},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.Class({name:"cc.JumpBy",extends:cc.ActionInterval,ctor:function(t,e,i,r,n){this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),this._delta=cc.v2(0,0),this._height=0,this._jumps=0,void 0!==r&&cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,r,n)},initWithDuration:function(t,e,i,r,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===n&&(n=r,r=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=r,this._jumps=n,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,i=t.y;this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var r=this._delta.x*t,n=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var s=this.target.x,o=this.target.y,a=this._previousPosition;n.x=n.x+s-a.x,n.y=n.y+o-a.y,r+=n.x,i+=n.y,a.x=r,a.y=i,this.target.setPosition(r,i)}else this.target.setPosition(n.x+r,n.y+i)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,r,n){return new cc.JumpBy(t,e,i,r,n)},cc.JumpTo=cc.Class({name:"cc.JumpTo",extends:cc.JumpBy,ctor:function(t,e,i,r,n){this._endPosition=cc.v2(0,0),void 0!==r&&this.initWithDuration(t,e,i,r,n)},initWithDuration:function(t,e,i,r,n){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,r,n)&&(void 0===n&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,r,n){return new cc.JumpTo(t,e,i,r,n)},cc.BezierBy=cc.Class({name:"cc.BezierBy",extends:cc.ActionInterval,ctor:function(t,e){this._config=[],this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),e&&cc.BezierBy.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var r=this._config[i];e.push(cc.v2(r.x,r.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x,i=t.y;this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(e){if(e=this._computeEaseTime(e),this.target){var i=this._config,r=i[0].x,n=i[1].x,s=i[2].x,o=i[0].y,a=i[1].y,l=i[2].y,c=t(0,r,n,s,e),h=t(0,o,a,l,e),u=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var d=this.target.x,p=this.target.y,f=this._previousPosition;u.x=u.x+d-f.x,u.y=u.y+p-f.y,c+=u.x,h+=u.y,f.x=c,f.y=h,this.target.setPosition(c,h)}else this.target.setPosition(u.x+c,u.y+h)}},reverse:function(){var t=this._config,e=t[0].x,i=t[0].y,r=t[1].x,n=t[1].y,s=t[2].x,o=t[2].y,a=[cc.v2(r-s,n-o),cc.v2(e-s,i-o),cc.v2(-s,-o)],l=new cc.BezierBy(this._duration,a);return this._cloneDecoration(l),this._reverseEaseList(l),l}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.Class({name:"cc.BezierTo",extends:cc.BezierBy,ctor:function(t,e){this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,r=this._config;r[0]=i[0].sub(e),r[1]=i[1].sub(e),r[2]=i[2].sub(e)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.Class({name:"cc.ScaleTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,this._deltaY=0,void 0!==e&&cc.ScaleTo.prototype.initWithDuration.call(this,t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.Class({name:"cc.ScaleBy",extends:cc.ScaleTo,startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.Class({name:"cc.Blink",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._originalState=!1,void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.opacity=i>e/2?255:0}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.Class({name:"cc.FadeTo",extends:cc.ActionInterval,ctor:function(t,e){this._toOpacity=0,this._fromOpacity=0,void 0!==e&&cc.FadeTo.prototype.initWithDuration.call(this,t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.Class({name:"cc.FadeIn",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.Class({name:"cc.FadeOut",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.Class({name:"cc.TintTo",extends:cc.ActionInterval,ctor:function(t,e,i,r){this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(r=e.b,i=e.g,e=e.r),void 0!==r&&this.initWithDuration(t,e,i,r)},initWithDuration:function(t,e,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,r),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&(this.target.color=cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,r){return new cc.TintTo(t,e,i,r)},cc.TintBy=cc.Class({name:"cc.TintBy",extends:cc.ActionInterval,ctor:function(t,e,i,r){this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,this._fromB=0,void 0!==r&&this.initWithDuration(t,e,i,r)},initWithDuration:function(t,e,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=r,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,r){return new cc.TintBy(t,e,i,r)},cc.DelayTime=cc.Class({name:"cc.DelayTime",extends:cc.ActionInterval,update:function(){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.Class({name:"cc.ReverseTime",extends:cc.ActionInterval,ctor:function(t){this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){return t?t===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(cc.errorID(1028),!1)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.TargetedAction=cc.Class({name:"cc.TargetedAction",extends:cc.ActionInterval,ctor:function(t,e){this._action=null,this._forcedTarget=null,e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}},{}],6:[function(t){t("../core/platform/CCClass");var e=t("../core/platform/js"),i=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1};cc.ActionManager=function(){this._hashTargets=e.createMap(!0),this._arrayTargets=[],this._currentTarget=null,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},_getElement:function(t,e){var r=this._elementPool.pop();return r||(r=new i),r.target=t,r.paused=!!e,r},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){if(t&&e){var r=this._hashTargets[e._id];r?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets[e._id]=r,this._arrayTargets.push(r)),r.actions.push(t),t.startWithTarget(e)}else cc.errorID(1e3)},removeAllActions:function(){for(var t=this._arrayTargets,i=0;i<t.length;i++){var r=t[i];r&&this._putElement(r)}this._arrayTargets.length=0,this._hashTargets=e.createMap(!0)},removeAllActionsFromTarget:function(t){if(null!=t){var e=this._hashTargets[t._id];e&&(e.actions.length=0,this._deleteHashElement(e))}},removeAction:function(t){if(t){var e=t.getOriginalTarget(),i=this._hashTargets[e._id];if(i)for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1),i.actionIndex>=r&&i.actionIndex--;break}}},_removeActionByTag:function(t,e,i){for(var r=0,n=e.actions.length;r<n;++r){var s=e.actions[r];if(s&&s.getTag()===t){if(i&&s.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,e);break}}},_removeAllActionsByTag:function(t,e,i){for(var r=e.actions.length-1;r>=0;--r){var n=e.actions[r];if(n&&n.getTag()===t){if(i&&n.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,e)}}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002);var i=this._hashTargets;if(e){var r=i[e._id];r&&this._removeActionByTag(t,r,e)}else for(var n in i){var s=i[n];this._removeActionByTag(t,s)}},removeAllActionsByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002);var i=this._hashTargets;if(e){var r=i[e._id];r&&this._removeAllActionsByTag(t,r,e)}else for(var n in i){var s=i[n];this._removeAllActionsByTag(t,s)}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1004);var i=this._hashTargets[e._id];if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n}cc.logID(1005,t)}return null},getNumberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t._id];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t._id];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t._id];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target._id]){delete this._hashTargets[t.target._id];for(var i=this._arrayTargets,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i=this._arrayTargets,r=0;r<i.length;r++){if(this._currentTarget=i[r],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var n=e.currentAction;e.currentAction=null,this.removeAction(n)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}}},{"../core/platform/CCClass":196,"../core/platform/js":217}],7:[function(t){t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom"),t("./tween")},{"./CCAction":1,"./CCActionCatmullRom":2,"./CCActionEase":3,"./CCActionInstant":4,"./CCActionInterval":5,"./CCActionManager":6,"./tween":8}],8:[function(t){var e=t("../animation/bezier"),i=0,r=cc.Class({name:"cc.TweenAction",extends:cc.ActionInterval,ctor:function(t,e,i){if(this._opts=i=i||Object.create(null),this._props=Object.create(null),i.progress=i.progress||this.progress,i.easing&&"string"==typeof i.easing){var r=i.easing;i.easing=cc.easing[r],!i.easing&&cc.warnID(1031,r)}var n=this._opts.relative;for(var s in e){var o=e[s],a=void 0,l=void 0;if(void 0!==o.value&&(o.easing||o.progress)&&("string"==typeof o.easing?!(a=cc.easing[o.easing])&&cc.warnID(1031,o.easing):a=o.easing,l=o.progress,o=o.value),"number"==typeof o||o.lerp&&(!n||o.add||o.mul)&&o.clone){var c=Object.create(null);c.value=o,c.easing=a,c.progress=l,this._props[s]=c}else cc.warn("Can not animate "+s+" property, because it do not have [lerp, (add|mul), clone] function.")}this._originProps=e,this.initWithDuration(t)},clone:function(){var t=new r(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,i=this._props;for(var r in i){var n=t[r],s=i[r];"number"==typeof n?(s.start=n,s.current=n,s.end=e?n+s.value:s.value):(s.start=n.clone(),s.current=n.clone(),s.end=e?(n.add||n.mul).call(n,s.value):s.value)}},update:function(t){var e=this._opts,i=t;e.easing&&(i=e.easing(t));var r=this.target;if(r){var n=this._props,s=e.progress;for(var o in n){var a=n[o],l=a.easing?a.easing(t):i,c=a.current=(a.progress||s)(a.start,a.end,a.current,l);r[o]=c}var h=e.onUpdate;h&&h(r,t)}},progress:function(t,e,i,r){return"number"==typeof t?i=t+(e-t)*r:t.lerp(e,r,i),i}}),n=cc.Class({name:"cc.SetAction",extends:cc.ActionInstant,ctor:function(t){this._props={},void 0!==t&&this.init(t)},init:function(t){for(var e in t)this._props[e]=t[e];return!0},update:function(){var t=this._props,e=this.target;for(var i in t)e[i]=t[i]},clone:function(){var t=new n;return t.init(this._props),t}});function s(t){this._actions=[],this._finalAction=null,this._target=t,this._tag=cc.Action.TAG_INVALID}s.stopAll=function(){cc.director.getActionManager().removeAllActions()},s.stopAllByTag=function(t){cc.director.getActionManager().removeAllActionsByTag(t)},s.stopAllByTarget=function(t){cc.director.getActionManager().removeAllActionsFromTarget(t)},s.prototype.then=function(t){return t instanceof cc.Action?this._actions.push(t.clone()):this._actions.push(t._union()),this},s.prototype.target=function(t){return this._target=t,this},s.prototype.start=function(){var t=this._target;return t?t instanceof cc.Object&&!t.isValid?void 0:(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),void 0===t._id&&(t._id=++i),this._finalAction.setTag(this._tag),cc.director.getActionManager().addAction(this._finalAction,t,!1),this):(cc.warn("Please set target to tween first"),this)},s.prototype.stop=function(){return this._finalAction&&(cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=null),this},s.prototype.tag=function(t){return this._tag=t,this},s.prototype.clone=function(t){var e=this._union();return cc.tween(t).then(e.clone())},s.prototype.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},s.prototype._union=function(){var t=this._actions;return 1===t.length?t[0]:cc.sequence(t)},Object.assign(s.prototype,{bezierTo:function(t,i,r,n,s){var o=i.x,a=i.y,l=r.x,c=r.y;return(s=s||Object.create(null)).progress=function(t,i,r,n){return r.x=(0,e.bezier)(t.x,o,l,i.x,n),r.y=(0,e.bezier)(t.y,a,c,i.y,n),r},this.to(t,{position:n},s)},bezierBy:function(t,i,r,n,s){var o=i.x,a=i.y,l=r.x,c=r.y;return(s=s||Object.create(null)).progress=function(t,i,r,n){var s=t.x,h=t.y;return r.x=(0,e.bezier)(s,o+s,l+s,i.x,n),r.y=(0,e.bezier)(h,a+h,c+h,i.y,n),r},this.by(t,{position:n},s)},flipX:function(){var t=this;return this.call((function(){t._target.scaleX*=-1}),this)},flipY:function(){var t=this;return this.call((function(){t._target.scaleY*=-1}),this)},blink:function(t,e,i){var r=1/e;return(i=i||Object.create(null)).progress=function(t,e,i,n){return n>=1?t:n%r>r/2?255:0},this.to(t,{opacity:1},i)}});var o=[];function a(t){return function(){o.length=0;for(var e=arguments.length,i=0;i<e;i++){var r=o[i]=arguments[i];r instanceof s&&(o[i]=r._union())}return t.apply(this,o)}}for(var l={to:function(t,e,i){return(i=i||Object.create(null)).relative=!1,new r(t,e,i)},by:function(t,e,i){return(i=i||Object.create(null)).relative=!0,new r(t,e,i)},set:function(t){return new n(t)},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:a(cc.sequence),parallel:a(cc.spawn)},c={repeat:cc.repeat,repeatForever:cc.repeatForever,reverseTime:cc.reverseTime},h=Object.keys(l),u=function(t){var e=h[t];s.prototype[e]=function(){var t=l[e].apply(this,arguments);return this._actions.push(t),this}},d=0;d<h.length;d++)u(d);h=Object.keys(c);for(var p=function(t){var e=h[t];s.prototype[e]=function(){var t=this._actions,i=arguments[arguments.length-1],r=arguments.length-1;i instanceof cc.Tween?i=i._union():i instanceof cc.Action||(i=t[t.length-1],t.length-=1,r+=1);for(var n=[i],s=0;s<r;s++)n.push(arguments[s]);return i=c[e].apply(this,n),t.push(i),this}},f=0;f<h.length;f++)p(f);cc.tween=function(t){return new s(t)},cc.Tween=s},{"../animation/bezier":14}],9:[function(t,e){var i=cc.js,r=t("./playable"),n=t("./animation-curves"),s=n.EventAnimCurve,o=n.EventInfo,a=t("./types").WrapModeMask,l=t("../core/utils/binary-search").binarySearchEpsilon;function c(t,e){r.call(this),this.target=t,this.animation=e,this._anims=new i.array.MutableForwardIterator([])}i.extend(c,r);var h=c.prototype;function u(t,e){var i=e.clip;e.duration=i.duration,e.speed=i.speed,e.wrapMode=i.wrapMode,e.frameRate=i.sample,(e.wrapMode&a.Loop)===a.Loop?e.repeatCount=1/0:e.repeatCount=1;var r=e.curves=i.createCurves(e,t),n=i.events;if(n)for(var c,h=0,u=n.length;h<u;h++){c||((c=new s).target=t,r.push(c));var d=n[h],p=d.frame/e.duration,f=void 0,_=l(c.ratios,p);_>=0?f=c.events[_]:(f=new o,c.ratios.push(p),c.events.push(f)),f.add(d.func,d.params)}}h.playState=function(t,e){t.clip&&(t.curveLoaded||u(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},h.stopStatesExcept=function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var r=i[e.i];r!==t&&this.stopState(r)}},h.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setEventTarget(this.animation)},h.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3907),t.animator=null},h.sample=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].sample()},h.stopState=function(t){t&&t.stop()},h.pauseState=function(t){t&&t.pause()},h.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},h.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this._anims.array,r=0;r<i.length;++r){var n=i[r];n.setTime(e),n.sample()}}},h.onStop=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].stop()},h.onPause=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null}},h.onResume=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume()}},h._reloadClip=function(t){u(this.target,t)},e.exports=c},{"../core/utils/binary-search":264,"./animation-curves":11,"./playable":18,"./types":19}],10:[function(t,e){var i=t("./types").WrapMode,r=t("./animation-curves"),n=r.DynamicAnimCurve,s=r.quickFindIndex,o=t("./motion-path-helper").sampleMotionPaths,a=t("../core/utils/binary-search").binarySearchEpsilon,l=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:cc.Float},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:i.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;var i=new l;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var r=[],n=1/i.sample,s=0,o=t.length;s<o;s++)r[s]={frame:s*n,value:t[s]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:r}}},i}},onLoad:function(){this._duration=Number.parseFloat(this.duration),this.speed=Number.parseFloat(this.speed),this.wrapMode=Number.parseInt(this.wrapMode),this.frameRate=Number.parseFloat(this.sample)},createPropCurve:function(t,e,i){var r=[],l=t instanceof cc.Node&&"position"===e,c=new n;c.target=t,c.prop=e;for(var h=0,u=i.length;h<u;h++){var d=i[h],p=d.frame/this.duration;c.ratios.push(p),l&&r.push(d.motionPath);var f=d.value;c.values.push(f);var _=d.curve;if(_){if("string"==typeof _){c.types.push(_);continue}if(Array.isArray(_)){_[0]===_[1]&&_[2]===_[3]?c.types.push(n.Linear):c.types.push(n.Bezier(_));continue}}c.types.push(n.Linear)}l&&o(r,c,this.duration,this.sample,t);for(var m,g,y=c.ratios,v=!0,b=1,x=y.length;b<x;b++)if(m=y[b]-y[b-1],1===b)g=m;else if(Math.abs(m-g)>1e-6){v=!1;break}c._findFrameIndex=v?s:a;var T=c.values[0];return null==T||c._lerp||("number"==typeof T?c._lerp=n.prototype._lerpNumber:T instanceof cc.Quat?c._lerp=n.prototype._lerpQuat:T instanceof cc.Vec2?c._lerp=n.prototype._lerpVector2:T instanceof cc.Vec3?c._lerp=n.prototype._lerpVector3:T.lerp&&(c._lerp=n.prototype._lerpObject)),c},createTargetCurves:function(t,e,i){var r=e.props,n=e.comps;if(r)for(var s in r){var o=r[s],a=this.createPropCurve(t,s,o);i.push(a)}if(n)for(var l in n){var c=t.getComponent(l);if(c){var h=n[l];for(var u in h){var d=h[u],p=this.createPropCurve(c,u,d);i.push(p)}}}},createCurves:function(t,e){var i=this.curveData,r=i.paths,n=[];for(var s in this.createTargetCurves(e,i,n),r){var o=cc.find(s,e);if(o){var a=r[s];this.createTargetCurves(o,a,n)}}return n}});cc.AnimationClip=e.exports=l},{"../core/utils/binary-search":264,"./animation-curves":11,"./motion-path-helper":17,"./types":19}],11:[function(t,e){var i=t("./bezier").bezierByTime,r=t("../core/utils/binary-search").binarySearchEpsilon,n=t("./types").WrapModeMask,s=t("./types").WrappedInfo;function o(t,e){if("string"==typeof e){var r=cc.easing[e];r?t=r(t):cc.errorID(3906,e)}else Array.isArray(e)&&(t=i(e,t));return t}var a,l=cc.Class({name:"cc.AnimCurve",sample:function(){},onTimeChangedManually:void 0}),c=cc.Class({name:"cc.DynamicAnimCurve",extends:l,ctor:function(){this._cachedIndex=0},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:r,_lerp:void 0,_lerpNumber:function(t,e,i){return t+(e-t)*i},_lerpObject:function(t,e,i){return t.lerp(e,i)},_lerpQuat:(a=cc.quat(),function(t,e,i){return t.lerp(e,i,a)}),_lerpVector2:function(){var t=cc.v2();return function(e,i,r){return e.lerp(i,r,t)}}(),_lerpVector3:function(){var t=cc.v3();return function(e,i,r){return e.lerp(i,r,t)}}(),sample:function(t,e){var i=this.values,r=this.ratios,n=r.length;if(0!==n){var s,a=!0,l=this._cachedIndex;if(l<0&&(l=~l)>0&&l<r.length){var c=r[l-1],h=r[l];e>c&&e<h&&(a=!1)}a&&(this._cachedIndex=this._findFrameIndex(r,e));var u=this._cachedIndex;if(u<0)if((u=~u)<=0)s=i[0];else if(u>=n)s=i[n-1];else{var d=i[u-1];if(this._lerp){var p=r[u-1],f=r[u],_=this.types[u-1],m=(e-p)/(f-p);_&&(m=o(m,_));var g=i[u];s=this._lerp(d,g,m)}else s=d}else s=i[u];this.target[this.prop]=s}}});c.Linear=null,c.Bezier=function(t){return t};var h=function(){this.events=[]};h.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var u=cc.Class({name:"cc.EventAnimCurve",extends:l,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new s}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&(t-=1),0|t},sample:function(t,e,i){var o=this.ratios.length,a=i.getWrappedInfo(i.time,this._wrappedInfo),l=a.direction,c=r(this.ratios,a.ratio);if(c<0&&(c=~c-1,l<0&&(c+=1)),this._ignoreIndex!==c&&(this._ignoreIndex=NaN),a.frameIndex=c,!this._lastWrappedInfo)return this._fireEvent(c),void(this._lastWrappedInfo=new s(a));var h=i.wrapMode,u=this._wrapIterations(a.iterations),d=this._lastWrappedInfo,p=this._wrapIterations(d.iterations),f=d.frameIndex,_=d.direction,m=-1!==p&&u!==p;if(f===c&&m&&1===o)this._fireEvent(0);else if(f!==c||m){l=_;do{if(f!==c){if(-1===l&&0===f&&c>0?((h&n.PingPong)===n.PingPong?l*=-1:f=o,p++):1===l&&f===o-1&&c<o-1&&((h&n.PingPong)===n.PingPong?l*=-1:f=-1,p++),f===c)break;if(p>u)break}f+=l,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[f])}while(f!==c&&f>-1&&f<o)}this._lastWrappedInfo.set(a)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var i=this.target._components,r=0;r<e.length;r++)for(var n=e[r],s=n.func,o=0;o<i.length;o++){var a=i[o],l=a[s];l&&l.apply(a,n.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var i=e.getWrappedInfo(t,this._wrappedInfo),n=i.direction,s=r(this.ratios,i.ratio);s<0&&(s=~s-1,n<0&&(s+=1),this._ignoreIndex=s)}});e.exports={AnimCurve:l,DynamicAnimCurve:c,EventAnimCurve:u,EventInfo:h,computeRatioByType:o,quickFindIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var r=t[0];if(e<r)return 0;var n=t[i];if(e>n)return~t.length;var s=(e=(e-r)/(n-r))/(1/i),o=0|s;return s-o<1e-6?o:o+1-s<1e-6?o+1:~(o+1)}}},{"../core/utils/binary-search":264,"./bezier":14,"./types":19}],12:[function(t,e){var i=cc.js,r=cc.Class({ctor:function(){this._anims=new i.array.MutableForwardIterator([]),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var r=i[e.i];r._isPlaying&&!r._isPaused&&r.update(t)}for(var n=this._delayEvents,s=0;s<n.length;s++){var o=n[s];o.target[o.func].apply(o.target,o.args)}n.length=0},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},removeAnimation:function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):cc.errorID(3907)},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}});cc.AnimationManager=e.exports=r},{}],13:[function(t,e){var i=cc.js,r=t("./playable"),n=t("./types"),s=n.WrappedInfo,o=n.WrapMode,a=n.WrapModeMask;function l(t,e){r.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new s,this._lastWrappedInfo=null,this._process=h,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=o.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,this.emit=function(){for(var t=new Array(arguments.length),e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}i.extend(l,r);var c=l.prototype;function h(){var t,e=this.sample();this._lastframeEventOn&&(t=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new s(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(e)),e.stopped&&(this.stop(),this.emit("finished",this))}function u(){var t=this.time,e=this.duration;t>e?0==(t%=e)&&(t=e):t<0&&0!=(t%=e)&&(t+=e);for(var i=t/e,r=this.curves,n=0,s=r.length;n<s;n++)r[n].sample(t,i,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}c._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},c.on=function(t,e,i){return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),this._target.on(t,e,i)):null},c.once=function(t,e,i){if(this._target&&this._target.isValid){"lastframe"===t&&(this._lastframeEventOn=!0);var r=this;return this._target.once(t,(function(t){e.call(i,t),r._lastframeEventOn=!1}))}return null},c.off=function(t,e,i){this._target&&this._target.isValid&&("lastframe"===t&&(this._target.hasEventListener(t)||(this._lastframeEventOn=!1)),this._target.off(t,e,i))},c._setEventTarget=function(t){this._target=t},c.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},c.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},c.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},c.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},c.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,i=0,r=e.length;i<r;i++){var n=e[i];n.onTimeChangedManually&&n.onTimeChangedManually(t,this)}},c.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},c._needRevers=function(t){var e=this.wrapMode,i=!1;return(e&a.PingPong)===a.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i)),(e&a.Reverse)===a.Reverse&&(i=!i),i},c.getWrappedInfo=function(t,e){e=e||new s;var i=!1,r=this.duration,n=this.repeatCount,o=t>0?t/r:-t/r;if(o>=n){o=n,i=!0;var l=n-(0|n);0===l&&(l=1),t=l*r*(t>0?1:-1)}if(t>r){var c=t%r;t=0===c?r:c}else t<0&&0!=(t%=r)&&(t+=r);var h=!1,u=this._wrapMode&a.ShouldWrap;u&&(h=this._needRevers(o));var d=h?-1:1;return this.speed<0&&(d*=-1),u&&h&&(t=r-t),e.ratio=t/r,e.time=t,e.direction=d,e.stopped=i,e.iterations=o,e},c.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,i=0,r=e.length;i<r;i++)e[i].sample(t.time,t.ratio,this);return t},i.get(c,"clip",(function(){return this._clip})),i.get(c,"name",(function(){return this._name})),i.obsolete(c,"AnimationState.length","duration"),i.getset(c,"curveLoaded",(function(){return this.curves.length>0}),(function(){this.curves.length=0})),i.getset(c,"wrapMode",(function(){return this._wrapMode}),(function(t){this._wrapMode=t,this.time=0,t&a.Loop?this.repeatCount=1/0:this.repeatCount=1})),i.getset(c,"repeatCount",(function(){return this._repeatCount}),(function(t){this._repeatCount=t;var e=this._wrapMode&a.ShouldWrap,i=(this.wrapMode&a.Reverse)===a.Reverse;this._process=t!==1/0||e||i?h:u})),i.getset(c,"delay",(function(){return this._delay}),(function(t){this._delayTime=this._delay=t})),cc.AnimationState=e.exports=l},{"./playable":18,"./types":19}],14:[function(t,e){var i=Math.cos,r=Math.acos,n=Math.max,s=2*Math.PI,o=Math.sqrt;function a(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function l(t,e){var l,c,h,u,d=e-0,p=e-t[0],f=3*d,_=3*p,m=3*(e-t[2]),g=1/(-d+_-m+(e-1)),y=(f-6*p+m)*g,v=y*(1/3),b=(-f+_)*g,x=1/3*(3*b-y*y),T=x*(1/3),C=(2*y*y*y-9*y*b+d*g*27)/27,S=C/2,w=S*S+T*T*T;if(w<0){var A=1/3*-x,E=o(A*A*A),D=-C/(2*E),L=r(D<-1?-1:D>1?1:D),I=2*a(E);return c=I*i(L*(1/3))-v,h=I*i((L+s)*(1/3))-v,u=I*i((L+2*s)*(1/3))-v,0<=c&&c<=1?0<=h&&h<=1?0<=u&&u<=1?n(c,h,u):n(c,h):0<=u&&u<=1?n(c,u):c:0<=h&&h<=1?0<=u&&u<=1?n(h,u):h:u}if(0===w)return h=-(l=S<0?a(-S):-a(S))-v,0<=(c=2*l-v)&&c<=1?0<=h&&h<=1?n(c,h):c:h;var P=o(w);return(l=a(-S+P))-a(S+P)-v}e.exports={bezier:function(t,e,i,r,n){var s=1-n;return s*(s*(t+(3*e-t)*n)+3*i*n*n)+r*n*n*n},bezierByTime:function(t,e){var i=l(t,e),r=t[1];return((1-i)*(r+(t[3]-r)*i)*3+i*i)*i}}},{}],15:[function(t,e){var i={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-i.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*i.bounceIn(2*t):.5*i.bounceOut(2*t-1)+.5},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};function r(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}i.quadOutIn=r(i.quadIn,i.quadOut),i.cubicOutIn=r(i.cubicIn,i.cubicOut),i.quartOutIn=r(i.quartIn,i.quartOut),i.quintOutIn=r(i.quintIn,i.quintOut),i.sineOutIn=r(i.sineIn,i.sineOut),i.expoOutIn=r(i.expoIn,i.expoOut),i.circOutIn=r(i.circIn,i.circOut),i.backOutIn=r(i.backIn,i.backOut),i.bounceIn=function(t){return 1-i.bounceOut(1-t)},i.bounceInOut=function(t){return t<.5?.5*i.bounceIn(2*t):.5*i.bounceOut(2*t-1)+.5},i.bounceOutIn=r(i.bounceIn,i.bounceOut),cc.easing=e.exports=i},{}],16:[function(t){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":9,"./animation-clip":10,"./animation-curves":11,"./animation-manager":12,"./animation-state":13,"./bezier":14,"./easing":15,"./motion-path-helper":17,"./types":19}],17:[function(t,e){var i=t("./animation-curves").DynamicAnimCurve,r=t("./animation-curves").computeRatioByType,n=t("./bezier").bezier,s=t("../core/utils/binary-search").binarySearchEpsilon,o=cc.v2;function a(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function l(){this.start=o(),this.end=o(),this.startCtrlPoint=o(),this.endCtrlPoint=o()}function c(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!Array.isArray(r)||6!==r.length)return!1}return!0}a.prototype.computeBeziers=function(){var t;this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var e=1;e<this.points.length;e++){var i=this.points[e-1],r=this.points[e];(t=new l).start=i.pos,t.startCtrlPoint=i.out,t.end=r.pos,t.endCtrlPoint=r.in,this.beziers.push(t),this.length+=t.getLength()}var n=0;for(e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=n+=this.ratios[e];return this.beziers},l.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},l.prototype.getPoint=function(t){var e=n(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=n(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new o(e,i)},l.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},l.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,r=[],n=this.getPoint(0),s=o(),a=0;for(r.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s.x=n.x-e.x,s.y=n.y-e.y,a+=s.mag(),r.push(a),n=e;return this.cacheArcLengths=r,r},l.prototype.getUtoTmapping=function(t,e){var i,r=this.getLengths(),n=0,s=r.length;i=e||t*r[s-1];for(var o,a=0,l=s-1;a<=l;)if((o=r[n=Math.floor(a+(l-a)/2)]-i)<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(r[n=l]===i)return n/(s-1);var c=r[n];return(n+(i-c)/(r[n+1]-c))/(s-1)},e.exports={sampleMotionPaths:function(t,e,n,l,h){function u(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:o(t[2],t[3]),pos:o(t[0],t[1]),out:o(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}var d=e.values=e.values.map((function(t){return Array.isArray(t)&&(t=2===t.length?cc.v2(t[0],t[1]):cc.v3(t[0],t[1],t[2])),t}));if(0!==t.length&&0!==d.length){for(var p=!1,f=0;f<t.length;f++){var _=t[f];if(_&&!c(_)&&(cc.errorID(3904,h?h.name:"","position",f),_=null),_&&_.length>0){p=!0;break}}if(p&&1!==d.length){for(var m=e.types,g=e.ratios,y=e.values=[],v=e.types=[],b=e.ratios=[],x=0,T=i.Linear,C=0,S=t.length;C<S-1;C++){var w,A=t[C],E=g[C],D=g[C+1]-E,L=d[C],I=d[C+1],P=m[C],M=[],R=x/D,O=1/(D*n*l);if(A&&A.length>0){var B=[];B.push(u(L));for(var N=0,k=A.length;N<k;N++){var F=u(A[N]);B.push(F)}B.push(u(I));var V=new a(B);V.computeBeziers();for(var j=V.progresses;1-R>1e-6;){var G,U,Y,H;if((w=r(w=R,P))<0)H=(0-w)*(U=V.beziers[0]).getLength(),Y=U.start.sub(U.endCtrlPoint).normalize(),G=U.start.add(Y.mul(H));else if(w>1)H=(w-1)*(U=V.beziers[V.beziers.length-1]).getLength(),Y=U.end.sub(U.startCtrlPoint).normalize(),G=U.end.add(Y.mul(H));else{var X=s(j,w);X<0&&(X=~X),w-=X>0?j[X-1]:0,w/=V.ratios[X],G=V.beziers[X].getPointAt(w)}M.push(G),R+=O}}else for(;1-R>1e-6;)w=r(w=R,P),M.push(L.lerp(I,w)),R+=O;for(T="constant"===P?P:i.Linear,N=0,k=M.length;N<k;N++){var z=E+x+O*N*D;W(M[N],T,z)}x=Math.abs(R-1)>1e-6?(R-1)*D:0}g[g.length-1]!==b[b.length-1]&&W(d[d.length-1],T,g[g.length-1])}}function W(t,e,i){y.push(t),v.push(e),b.push(i)}},Curve:a,Bezier:l}},{"../core/utils/binary-search":264,"./animation-curves":11,"./bezier":14}],18:[function(t,e){var i=cc.js,r=t("../core/CCDebug");function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var s=n.prototype;i.get(s,"isPlaying",(function(){return this._isPlaying}),!0),i.get(s,"isPaused",(function(){return this._isPaused}),!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(r.getError(3912)):(this._isPlaying=!0,this.onPlay())},s.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},s.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},s.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},s.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=n},{"../core/CCDebug":26}],19:[function(t,e){var i={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:i.Reverse,Loop:i.Loop,LoopReverse:i.Loop|i.Reverse,PingPong:i.PingPong,PingPongReverse:i.PingPong|i.Reverse});function n(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=r,n.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:i,WrapMode:r,WrappedInfo:n}},{}],20:[function(t,e){var i,r,n=t("../core/event/event-target"),s=t("../core/platform/CCSys"),o=t("../core/assets/CCAudioClip").LoadMode,a=!1,l=[],c=function t(e){n.call(this),this._shouldRecycleOnEnded=!1,this._src=e,this._element=null,this.id=0,this._state=t.State.INITIALZING;var i=this;this._onended=function(){i._state=t.State.STOPPED,i.emit("ended")},this._onendedSecond=function(){i._unbindEnded(i._onendedSecond),i._bindEnded()}};cc.js.extend(c,n),c.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3},(i=c.prototype)._bindEnded=function(t){if(!(t=t||this._onended)._binded){t._binded=!0;var e=this._element;this._src&&e instanceof HTMLAudioElement?e.addEventListener("ended",t):e.onended=t}},i._unbindEnded=function(t){if((t=t||this._onended)._binded){t._binded=!1;var e=this._element;e instanceof HTMLAudioElement?e.removeEventListener("ended",t):e&&(e.onended=null)}},i._onLoaded=function(){this._createElement(),this._state=c.State.INITIALZING,this.setVolume(1),this.setLoop(!1)},i._createElement=function(){var t=this._src._nativeAsset;t instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=t.src):this._element=new h(t,this)},i.play=function(){var t=this;this._src&&this._src._ensureLoaded((function(){t._state=c.State.PLAYING,t._bindEnded();var e=t._element.play();window.Promise&&e instanceof Promise&&e.catch((function(){})),t._touchToPlay()}))},i._touchToPlay=function(){if(this._src&&this._src.loadMode===o.DOM_AUDIO&&this._element.paused&&l.push({instance:this,offset:0,audio:this._element}),!a){a=!0;var t="ontouchend"in window?"touchend":"mousedown";cc.game.canvas.addEventListener(t,(function(){for(var t;t=l.pop();)t.audio.play(t.offset)}))}},i.destroy=function(){this._element=null},i.pause=function(){if(this.getState()===c.State.PLAYING){var t=this;this._src&&this._src._ensureLoaded((function(){t._unbindEnded(),t._element.pause(),t._state=c.State.PAUSED}))}},i.resume=function(){if(this.getState()===c.State.PAUSED){var t=this;this._src&&this._src._ensureLoaded((function(){t._bindEnded(),t._element.play(),t._state=c.State.PLAYING}))}},i.stop=function(){var t=this;this._src&&this._src._ensureLoaded((function(){t._element.pause(),t._element.currentTime=0;for(var e=0;e<l.length;e++)if(l[e].instance===t){l.splice(e,1);break}t._unbindEnded(),t.emit("stop"),t._state=c.State.STOPPED}))},i.setLoop=function(t){var e=this;this._src&&this._src._ensureLoaded((function(){e._element.loop=t}))},i.getLoop=function(){return!!this._element&&this._element.loop},i.setVolume=function(t){var e=this;this._src&&this._src._ensureLoaded((function(){e._element.volume=t}))},i.getVolume=function(){return this._element?this._element.volume:1},i.setCurrentTime=function(t){var e=this;this._src&&this._src._ensureLoaded((function(){e._unbindEnded(),e._bindEnded(e._onendedSecond),e._element.currentTime=t}))},i.getCurrentTime=function(){return this._element?this._element.currentTime:0},i.getDuration=function(){return this._src?this._src.duration:0},i.getState=function(t){return void 0===t&&(t=!0),t&&this._forceUpdatingState(),this._state},i._forceUpdatingState=function(){var t=this._element;t&&(c.State.PLAYING===this._state&&t.paused?this._state=c.State.STOPPED:c.State.STOPPED!==this._state||t.paused||(this._state=c.State.PLAYING))},Object.defineProperty(i,"src",{get:function(){return this._src},set:function(t){if(this._unbindEnded(),t&&t.isValid){if(t!==this._src)if(this._src=t,t.loaded)this._onLoaded();else{var e=this;t.once("load",(function(){t===e._src&&e._onLoaded()}))}}else this._src=null,this._element instanceof h?this._element=null:this._element&&(this._element.src=""),this._state=c.State.INITIALZING},enumerable:!0,configurable:!0}),Object.defineProperty(i,"paused",{get:function(){return!this._element||this._element.paused},enumerable:!0,configurable:!0}),r=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0;var h=function(t,e){this._audio=e,this._context=s.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this.volume=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currentTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};(function(t){t.play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._gainObj),e.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var i,r=this._buffer.duration,n=t;if(this._loop?e.start?e.start(0,n):e.notoGrainOn?e.noteGrainOn(0,n):e.noteOn(0,n):(i=r-t,e.start?e.start(0,n,i):e.noteGrainOn?e.noteGrainOn(0,n,i):e.noteOn(0,n,i)),this._currentSource=e,e.onended=this._endCallback,(!e.context.state||"suspended"===e.context.state)&&0===this._context.currentTime){var s=this;clearTimeout(this._currentTimer),this._currentTimer=setTimeout((function(){0===s._context.currentTime&&l.push({instance:s._audio,offset:t,audio:s})}),10)}var o=cc.sys;o.os===o.OS_IOS&&o.isBrowser&&o.isMobile&&("suspended"===e.context.state&&0!==this._context.currentTime||"interrupted"===e.context.state)&&e.context.resume()},t.pause=function(){if(clearTimeout(this._currentTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var t=this._currentSource;t&&(t.onended&&(t.onended._binded=!1,t.onended=null),t.stop(0)),this._currentSource=null,this._startTime=-1}},Object.defineProperty(t,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loop",{get:function(){return this._loop},set:function(t){this._currentSource&&(this._currentSource.loop=t),this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(t){if(this._volume=t,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(t,this._context.currentTime,r)}catch(e){this._gainObj.gain.setTargetAtTime(t,this._context.currentTime,.01)}else this._gainObj.gain.value=t;s.os===s.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentTime",{get:function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength},set:function(t){this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play())},enumerable:!0,configurable:!0}),Object.defineProperty(t,"duration",{get:function(){return this._buffer.duration},enumerable:!0,configurable:!0})})(h.prototype),e.exports=cc._Audio=c},{"../core/assets/CCAudioClip":63,"../core/event/event-target":143,"../core/platform/CCSys":205}],21:[function(t,e){var i=t("./CCAudio"),r=t("../core/assets/CCAudioClip"),n=cc.js,s=0,o=n.createMap(!0),a={},l=[],c=function(t){var e=++s,r=a[t];if(r||(r=a[t]=[]),d._maxAudioInstance<=r.length){var n=r.shift();h(n).stop()}var c=l.pop()||new i,u=function(){if(h(this.id)){delete o[this.id];var t=r.indexOf(this.id);cc.js.array.fastRemoveAt(r,t)}!function(t){t._shouldRecycleOnEnded&&(t._finishCallback=null,t.off("ended"),t.off("stop"),t.src=null,cc.sys.platform===cc.sys.ALIPAY_GAME?t.destroy():l.includes(t)||(l.length<d._maxPoolSize?l.push(t):t.destroy()),t._shouldRecycleOnEnded=!1)}(this)};return c.on("ended",(function(){this._finishCallback&&this._finishCallback(),this.getLoop()||u.call(this)}),c),c.on("stop",u,c),c.id=e,o[e]=c,r.push(e),c},h=function(t){return o[t]},u=function(t){return void 0===t?t=1:"string"==typeof t&&(t=Number.parseFloat(t)),t},d={AudioState:i.State,_maxAudioInstance:24,_maxPoolSize:32,_id2audio:o,play:function(t,e,i){if(!(t instanceof r))return cc.error("Wrong type of AudioClip.");var n=t.nativeUrl,s=c(n);return s.src=t,t._ensureLoaded(),s._shouldRecycleOnEnded=!0,s.setLoop(e||!1),i=u(i),s.setVolume(i),s.play(),s.id},setLoop:function(t,e){var i=h(t);i&&i.setLoop&&i.setLoop(e)},isLoop:function(t){var e=h(t);return!(!e||!e.getLoop)&&e.getLoop()},setVolume:function(t,e){var i=h(t);i&&i.setVolume(e)},getVolume:function(t){var e=h(t);return e?e.getVolume():1},setCurrentTime:function(t,e){var i=h(t);return!!i&&(i.setCurrentTime(e),!0)},getCurrentTime:function(t){var e=h(t);return e?e.getCurrentTime():0},getDuration:function(t){var e=h(t);return e?e.getDuration():0},getState:function(t){var e=h(t);return e?e.getState():this.AudioState.ERROR},isPlaying:function(t){return this.getState(t)===this.AudioState.PLAYING},setFinishCallback:function(t,e){var i=h(t);i&&(i._finishCallback=e)},pause:function(t){var e=h(t);return!!e&&(e.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var t in o){var e=o[t];e.getState()===i.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){var e=h(t);e&&e.resume()},resumeAll:function(){for(var t=0;t<this._pauseIDCache.length;++t){var e=this._pauseIDCache[t],i=h(e);i&&i.resume()}this._pauseIDCache.length=0},stop:function(t){var e=h(t);return!!e&&(e.stop(),!0)},stopAll:function(){for(var t in o){var e=o[t];e&&e.stop()}},setMaxAudioInstance:function(){},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),e=t;else{if(!t)return;e=t.nativeUrl}var i=a[e];if(i)for(;i.length>0;){var r=i.pop(),n=o[r];n&&(n.stop(),delete o[r])}},uncacheAll:function(){var t;for(var e in this.stopAll(),o)(t=o[e])&&t.destroy();for(;t=l.pop();)t.destroy();o=n.createMap(!0),a={}},_breakCache:null,_break:function(){for(var t in this._breakCache=[],o){var e=o[t];e.getState()===i.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var t=this._breakCache.pop(),e=h(t);e&&e.resume&&e.resume()}this._breakCache=null}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(t,e){var i=this._music;return this.stop(i.id),i.id=this.play(t,e,i.volume),i.loop=e,i.id},stopMusic:function(){this.stop(this._music.id)},pauseMusic:function(){return this.pause(this._music.id),this._music.id},resumeMusic:function(){return this.resume(this._music.id),this._music.id},getMusicVolume:function(){return this._music.volume},setMusicVolume:function(t){t=u(t);var e=this._music;return e.volume=t,this.setVolume(e.id,e.volume),e.volume},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING},playEffect:function(t,e){return this.play(t,e||!1,this._effect.volume)},setEffectsVolume:function(t){t=u(t);var e=this._music.id;for(var i in this._effect.volume=t,o){var r=o[i];r&&r.id!==e&&d.setVolume(i,t)}},getEffectsVolume:function(){return this._effect.volume},pauseEffect:function(t){return this.pause(t)},pauseAllEffects:function(){var t=this._music.id,e=this._effect;for(var i in e.pauseCache.length=0,o){var r=o[i];r&&r.id!==t&&r.getState()===this.AudioState.PLAYING&&(e.pauseCache.push(i),r.pause())}},resumeEffect:function(t){this.resume(t)},resumeAllEffects:function(){for(var t=this._effect.pauseCache,e=0;e<t.length;++e){var i=t[e],r=o[i];r&&r.resume()}},stopEffect:function(t){return this.stop(t)},stopAllEffects:function(){var t=this._music.id;for(var e in o){var i=o[e];i&&i.id!==t&&i.getState()===d.AudioState.PLAYING&&i.stop()}}};e.exports=cc.audioEngine=d},{"../core/assets/CCAudioClip":63,"./CCAudio":20}],22:[function(t,e){var i={name:"Jacob__Codec"};i.Base64=t("./base64"),i.GZip=t("./gzip"),i.unzip=function(){return i.GZip.gunzip.apply(i.GZip,arguments)},i.unzipBase64=function(){var t=i.Base64.decode.apply(i.Base64,arguments);try{return i.GZip.gunzip.call(i.GZip,t)}catch(e){return t.slice(7)}},i.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,s=this.unzipBase64(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o},i.unzipAsArray=function(t,e){e=e||1;var i,r,n,s=this.unzip(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o},cc.codec=e.exports=i},{"./base64":23,"./gzip":24}],23:[function(t,e){var i=t("../core/utils/misc").BASE64_VALUES,r={name:"Jacob__Codec__Base64",decode:function(t){var e,r,n,s,o,a,l=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=i[t.charCodeAt(c++)]<<2|(s=i[t.charCodeAt(c++)])>>4,r=(15&s)<<4|(o=i[t.charCodeAt(c++)])>>2,n=(3&o)<<6|(a=i[t.charCodeAt(c++)]),l.push(String.fromCharCode(e)),64!==o&&l.push(String.fromCharCode(r)),64!==a&&l.push(String.fromCharCode(n));return l.join("")},decodeAsArray:function(t,e){var i,r,n,s=this.decode(t),o=[];for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<8*r;return o}};e.exports=r},{"../core/utils/misc":271}],24:[function(t,e){var i=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(i.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};i.gunzip=function(t){return t.constructor===Array||t.constructor,new i(t).gunzip()[0][0]},i.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},i.LITERALS=288,i.NAMEMAX=256,i.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],i.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],i.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],i.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],i.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],i.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},i.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},i.prototype.byteAlign=function(){this.bb=1},i.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},i.prototype.readBits=function(t){for(var e=0,r=t;r--;)e=e<<1|this.readBit();return t&&(e=i.bitReverse[e]>>8-t),e},i.prototype.flushBuffer=function(){this.bIdx=0},i.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},i.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},i.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},i.prototype.CreateTree=function(t,e,i){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},i.prototype.DecodeValue=function(t){for(var e,i,r=0,n=t[r];;)if(this.readBit()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break}}else{if(!(32768&n.b0))return n.b0;n=t[++r]}return-1},i.prototype.DeflateLoop=function(){var t,e,r;do{var n,s;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),n=this.readByte(),n|=this.readByte()<<8,s=this.readByte(),65535&(n^~(s|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");n--;)o=this.readByte(),this.addBuffer(o);else if(1===e)for(;;)if((a=i.bitReverse[this.readBits(7)]>>1)>23?(a=a<<1|this.readBit())>199?a=(a-=128)<<1|this.readBit():(a-=48)>143&&(a+=136):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;for(a-=257,_=this.readBits(i.cplext[a])+i.cplens[a],a=i.bitReverse[this.readBits(5)]>>3,i.cpdext[a]>8?(m=this.readBits(8),m|=this.readBits(i.cpdext[a]-8)<<8):m=this.readBits(i.cpdext[a]),m+=i.cpdist[a],a=0;a<_;a++){var o=this.buf32k[this.bIdx-m&32767];this.addBuffer(o)}}else if(2===e){var a,l,c,h,u,d=new Array(320);for(c=257+this.readBits(5),h=1+this.readBits(5),u=4+this.readBits(4),a=0;a<19;a++)d[a]=0;for(a=0;a<u;a++)d[i.border[a]]=this.readBits(3);for(_=this.distanceTree.length,r=0;r<_;r++)this.distanceTree[r]=new i.HufNode;if(this.CreateTree(this.distanceTree,19,d,0))return this.flushBuffer(),1;for(l=c+h,r=0;r<l;)if((a=this.DecodeValue(this.distanceTree))<16)d[r++]=a;else if(16===a){var p;if(r+(a=3+this.readBits(2))>l)return this.flushBuffer(),1;for(p=r?d[r-1]:0;a--;)d[r++]=p}else{if(r+(a=17===a?3+this.readBits(3):11+this.readBits(7))>l)return this.flushBuffer(),1;for(;a--;)d[r++]=0}for(_=this.literalTree.length,r=0;r<_;r++)this.literalTree[r]=new i.HufNode;if(this.CreateTree(this.literalTree,c,d,0))return this.flushBuffer(),1;for(_=this.literalTree.length,r=0;r<_;r++)this.distanceTree[r]=new i.HufNode;var f=new Array;for(r=c;r<d.length;r++)f[r-c]=d[r];if(this.CreateTree(this.distanceTree,h,f,0))return this.flushBuffer(),1;for(;;)if((a=this.DecodeValue(this.literalTree))>=256){var _,m;if(0==(a-=256))break;for(a--,_=this.readBits(i.cplext[a])+i.cplens[a],a=this.DecodeValue(this.distanceTree),i.cpdext[a]>8?(m=this.readBits(8),m|=this.readBits(i.cpdext[a]-8)<<8):m=this.readBits(i.cpdext[a]),m+=i.cpdist[a];_--;)o=this.buf32k[this.bIdx-m&32767],this.addBuffer(o)}else this.addBuffer(a)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},i.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},i.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var r=this.readByte();r|=this.readByte()<<8;var n=this.readByte();for(n|=this.readByte()<<8,o=0,this.nameBuf=[];r--;){var s=this.readByte();"/"===s|":"===s?o=0:o<i.NAMEMAX-1&&(this.nameBuf[o++]=String.fromCharCode(s))}this.fileout||(this.fileout=this.nameBuf);for(var o=0;o<n;)s=this.readByte(),o++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},i.prototype.skipdir=function(){var t,e,r=[];if(8&this.gpflags&&(r[0]=this.readByte(),r[1]=this.readByte(),r[2]=this.readByte(),r[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),r[0]=this.readByte(),8!==r[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(r[0]=this.readByte(),r[2]=this.readByte(),this.len=r[0]+256*r[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<i.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()},e.exports=i},{}],25:[function(t,e){(function(){function t(t){throw t}var e=void 0,i=!0,r=this;function n(t,i){var n,s=t.split("."),o=r;!(s[0]in o)&&o.execScript&&o.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||i===e?o=o[n]?o[n]:o[n]={}:o[n]=i}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function o(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,s=1,o=0,a=t.length,l=0;0<a;){a-=n=1024<a?1024:a;do{o+=s+=t[l++]}while(--n);s%=65521,o%=65521}return(o<<16|s)>>>0}function a(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(s?Uint8Array:Array)?e:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(s?Uint8Array:Array)(i<<1);if(s)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},a.prototype.d=function(t,e,i){var r,n=this.buffer,s=this.index,o=this.i,a=n[s];if(i&&1<e&&(t=8<e?(p[255&t]<<24|p[t>>>8&255]<<16|p[t>>>16&255]<<8|p[t>>>24&255])>>32-e:p[t]>>8-e),8>e+o)a=a<<e|t,o+=e;else for(r=0;r<e;++r)a=a<<1|t>>e-r-1&1,8==++o&&(o=0,n[s++]=p[a],a=0,s===n.length&&(n=this.f()));n[s]=a,this.buffer=n,this.i=o,this.index=s},a.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=p[e[i]],i++),s?t=e.subarray(0,i):(e.length=i,t=e),t};var l,c=new(s?Uint8Array:Array)(256);for(l=0;256>l;++l){for(var h=d=l,u=7,d=d>>>1;d;d>>>=1)h<<=1,h|=1&d,--u;c[l]=(h<<u&255)>>>0}var p=c;function f(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function _(t){var e,i,r,n,o,a,l,c,h,u=t.length,d=0,p=Number.POSITIVE_INFINITY;for(c=0;c<u;++c)t[c]>d&&(d=t[c]),t[c]<p&&(p=t[c]);for(e=1<<d,i=new(s?Uint32Array:Array)(e),r=1,n=0,o=2;r<=d;){for(c=0;c<u;++c)if(t[c]===r){for(a=0,l=n,h=0;h<r;++h)a=a<<1|1&l,l>>=1;for(h=a;h<e;h+=o)i[h]=r<<16|c;++n}++r,n<<=1,o<<=1}return[i,d,p]}function m(t,e){this.h=y,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}f.prototype.getParent=function(t){return 2*((t-2)/4|0)},f.prototype.push=function(t,e){var i,r,n,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(r=this.getParent(i),s[i]>s[r]);)n=s[i],s[i]=s[r],s[r]=n,n=s[i+1],s[i+1]=s[r+1],s[r+1]=n,i=r;return this.length},f.prototype.pop=function(){var t,e,i,r,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&s[r+2]>s[r]&&(r+=2),s[r]>s[n]);)i=s[n],s[n]=s[r],s[r]=i,i=s[n+1],s[n+1]=s[r+1],s[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var g,y=2,v={NONE:0,r:1,j:y,N:3},b=[];for(g=0;288>g;g++)switch(i){case 143>=g:b.push([g+48,8]);break;case 255>=g:b.push([g-144+400,9]);break;case 279>=g:b.push([g-256+0,7]);break;case 287>=g:b.push([g-280+192,8]);break;default:t("invalid literal: "+g)}function x(t,e){this.length=t,this.G=e}function T(){var e=C;switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var r,n,o,l,c=this.input;switch(this.h){case 0:for(o=0,l=c.length;o<l;){var h,u,d,p=n=s?c.subarray(o,o+65535):c.slice(o,o+65535),f=(o+=n.length)===l,_=e,m=e,g=this.a,v=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=v+p.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(h=f?1:0,g[v++]=0|h,d=65536+~(u=p.length)&65535,g[v++]=255&u,g[v++]=u>>>8&255,g[v++]=255&d,g[v++]=d>>>8&255,s)g.set(p,v),v+=p.length,g=g.subarray(0,v);else{for(_=0,m=p.length;_<m;++_)g[v++]=p[_];g.length=v}this.b=v,this.a=g}break;case 1:var x=new a(new Uint8Array(this.a.buffer),this.b);x.d(1,1,i),x.d(1,2,i);var T,C,S,w=E(this,c);for(T=0,C=w.length;T<C;T++)if(S=w[T],a.prototype.d.apply(x,b[S]),256<S)x.d(w[++T],w[++T],i),x.d(w[++T],5),x.d(w[++T],w[++T],i);else if(256===S)break;this.a=x.finish(),this.b=this.a.length;break;case y:var A,I,P,M,R,O,B,N,k,F,V,j,G,U,Y,H=new a(new Uint8Array(this.a),this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(A=y,H.d(1,1,i),H.d(A,2,i),I=E(this,c),B=L(O=D(this.L,15)),k=L(N=D(this.K,7)),P=286;257<P&&0===O[P-1];P--);for(M=30;1<M&&0===N[M-1];M--);var W,Z,J,q,K,Q,$=P,tt=M,et=new(s?Uint32Array:Array)($+tt),it=new(s?Uint32Array:Array)(316),rt=new(s?Uint8Array:Array)(19);for(W=Z=0;W<$;W++)et[Z++]=O[W];for(W=0;W<tt;W++)et[Z++]=N[W];if(!s)for(W=0,q=rt.length;W<q;++W)rt[W]=0;for(W=K=0,q=et.length;W<q;W+=Z){for(Z=1;W+Z<q&&et[W+Z]===et[W];++Z);if(J=Z,0===et[W])if(3>J)for(;0<J--;)it[K++]=0,rt[0]++;else for(;0<J;)(Q=138>J?J:138)>J-3&&Q<J&&(Q=J-3),10>=Q?(it[K++]=17,it[K++]=Q-3,rt[17]++):(it[K++]=18,it[K++]=Q-11,rt[18]++),J-=Q;else if(it[K++]=et[W],rt[et[W]]++,3>--J)for(;0<J--;)it[K++]=et[W],rt[et[W]]++;else for(;0<J;)(Q=6>J?J:6)>J-3&&Q<J&&(Q=J-3),it[K++]=16,it[K++]=Q-3,rt[16]++,J-=Q}for(r=s?it.subarray(0,K):it.slice(0,K),F=D(rt,7),U=0;19>U;U++)z[U]=F[X[U]];for(R=19;4<R&&0===z[R-1];R--);for(V=L(F),H.d(P-257,5,i),H.d(M-1,5,i),H.d(R-4,4,i),U=0;U<R;U++)H.d(z[U],3,i);for(U=0,Y=r.length;U<Y;U++)if(j=r[U],H.d(V[j],F[j],i),16<=j){switch(U++,j){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:t("invalid code: "+j)}H.d(r[U],G,i)}var nt,st,ot,at,lt,ct,ht,ut,dt=[B,O],pt=[k,N];for(lt=dt[0],ct=dt[1],ht=pt[0],ut=pt[1],nt=0,st=I.length;nt<st;++nt)if(ot=I[nt],H.d(lt[ot],ct[ot],i),256<ot)H.d(I[++nt],I[++nt],i),at=I[++nt],H.d(ht[at],ut[at],i),H.d(I[++nt],I[++nt],i);else if(256===ot)break;this.a=H.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var C,S,w=[];for(C=3;258>=C;C++)S=T(),w[C]=S[2]<<24|S[1]<<16|S[0];var A=s?new Uint32Array(w):w;function E(r,n){function o(e,r){var n,s,o,a,l=e.G,c=[],h=0;switch(n=A[e.length],c[h++]=65535&n,c[h++]=n>>16&255,c[h++]=n>>24,i){case 1===l:s=[0,l-1,0];break;case 2===l:s=[1,l-2,0];break;case 3===l:s=[2,l-3,0];break;case 4===l:s=[3,l-4,0];break;case 6>=l:s=[4,l-5,1];break;case 8>=l:s=[5,l-7,1];break;case 12>=l:s=[6,l-9,2];break;case 16>=l:s=[7,l-13,2];break;case 24>=l:s=[8,l-17,3];break;case 32>=l:s=[9,l-25,3];break;case 48>=l:s=[10,l-33,4];break;case 64>=l:s=[11,l-49,4];break;case 96>=l:s=[12,l-65,5];break;case 128>=l:s=[13,l-97,5];break;case 192>=l:s=[14,l-129,6];break;case 256>=l:s=[15,l-193,6];break;case 384>=l:s=[16,l-257,7];break;case 512>=l:s=[17,l-385,7];break;case 768>=l:s=[18,l-513,8];break;case 1024>=l:s=[19,l-769,8];break;case 1536>=l:s=[20,l-1025,9];break;case 2048>=l:s=[21,l-1537,9];break;case 3072>=l:s=[22,l-2049,10];break;case 4096>=l:s=[23,l-3073,10];break;case 6144>=l:s=[24,l-4097,11];break;case 8192>=l:s=[25,l-6145,11];break;case 12288>=l:s=[26,l-8193,12];break;case 16384>=l:s=[27,l-12289,12];break;case 24576>=l:s=[28,l-16385,13];break;case 32768>=l:s=[29,l-24577,13];break;default:t("invalid distance")}for(n=s,c[h++]=n[0],c[h++]=n[1],c[h++]=n[2],o=0,a=c.length;o<a;++o)g[y++]=c[o];b[c[0]]++,T[c[3]]++,v=e.length+r-1,f=null}var a,l,c,h,u,d,p,f,_,m={},g=s?new Uint16Array(2*n.length):[],y=0,v=0,b=new(s?Uint32Array:Array)(286),T=new(s?Uint32Array:Array)(30),C=r.w;if(!s){for(c=0;285>=c;)b[c++]=0;for(c=0;29>=c;)T[c++]=0}for(b[256]=1,a=0,l=n.length;a<l;++a){for(c=u=0,h=3;c<h&&a+c!==l;++c)u=u<<8|n[a+c];if(m[u]===e&&(m[u]=[]),d=m[u],!(0<v--)){for(;0<d.length&&32768<a-d[0];)d.shift();if(a+3>=l){for(f&&o(f,-1),c=0,h=l-a;c<h;++c)_=n[a+c],g[y++]=_,++b[_];break}if(0<d.length){var S=e,w=e,E=0,D=e,L=e,I=e,P=n.length,M=(L=0,d.length);t:for(;L<M;L++){if(S=d[M-L-1],D=3,3<E){for(I=E;3<I;I--)if(n[S+I-1]!==n[a+I-1])continue t;D=E}for(;258>D&&a+D<P&&n[S+D]===n[a+D];)++D;if(D>E&&(w=S,E=D),258===D)break}p=new x(E,a-w),f?f.length<p.length?(_=n[a-1],g[y++]=_,++b[_],o(p,0)):o(f,-1):p.length<C?f=p:o(p,0)}else f?o(f,-1):(_=n[a],g[y++]=_,++b[_])}d.push(a)}return g[y++]=256,b[256]++,r.L=b,r.K=T,s?g.subarray(0,y):g}function D(t,e){function i(t){var e=C[t][S[t]];e===y?(i(t+1),i(t+1)):--x[e],++S[t]}var r,n,o,a,l,c=t.length,h=new f(572),u=new(s?Uint8Array:Array)(c);if(!s)for(a=0;a<c;a++)u[a]=0;for(a=0;a<c;++a)0<t[a]&&h.push(a,t[a]);if(r=Array(h.length/2),n=new(s?Uint32Array:Array)(h.length/2),1===r.length)return u[h.pop().index]=1,u;for(a=0,l=h.length/2;a<l;++a)r[a]=h.pop(),n[a]=r[a].value;var d,p,_,m,g,y=n.length,v=new(s?Uint16Array:Array)(e),b=new(s?Uint8Array:Array)(e),x=new(s?Uint8Array:Array)(y),T=Array(e),C=Array(e),S=Array(e),w=(1<<e)-y,A=1<<e-1;for(v[e-1]=y,p=0;p<e;++p)w<A?b[p]=0:(b[p]=1,w-=A),w<<=1,v[e-2-p]=(v[e-1-p]/2|0)+y;for(v[0]=b[0],T[0]=Array(v[0]),C[0]=Array(v[0]),p=1;p<e;++p)v[p]>2*v[p-1]+b[p]&&(v[p]=2*v[p-1]+b[p]),T[p]=Array(v[p]),C[p]=Array(v[p]);for(d=0;d<y;++d)x[d]=e;for(_=0;_<v[e-1];++_)T[e-1][_]=n[_],C[e-1][_]=_;for(d=0;d<e;++d)S[d]=0;for(1===b[e-1]&&(--x[0],++S[e-1]),p=e-2;0<=p;--p){for(m=d=0,g=S[p+1],_=0;_<v[p];_++)(m=T[p+1][g]+T[p+1][g+1])>n[d]?(T[p][_]=m,C[p][_]=y,g+=2):(T[p][_]=n[d],C[p][_]=d,++d);S[p]=0,1===b[p]&&i(p)}for(o=x,a=0,l=r.length;a<l;++a)u[r[a].index]=o[a];return u}function L(e){var i,r,n,o,a=new(s?Uint16Array:Array)(e.length),l=[],c=[],h=0;for(i=0,r=e.length;i<r;i++)l[e[i]]=1+(0|l[e[i]]);for(i=1,r=16;i<=r;i++)c[i]=h,(h+=0|l[i])>1<<i&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),i=0,r=e.length;i<r;i++)for(h=c[e[i]],c[e[i]]+=1,n=a[i]=0,o=e[i];n<o;n++)a[i]=a[i]<<1|1&h,h>>>=1;return a}function I(t,e){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=P.j;var i,r={};for(i in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.z=new m(this.input,r)}var P=v;function M(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(e):e,this.s=!1,this.m=O,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case R:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case O:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}I.prototype.n=function(){var e,i,r,n,a,l,c,h=0;if(c=this.a,(e=ht)===ht)i=Math.LOG2E*Math.log(32768)-8;else t(Error("invalid compression method"));if(r=i<<4|e,c[h++]=r,e===ht)switch(this.h){case P.NONE:a=0;break;case P.r:a=1;break;case P.j:a=2;break;default:t(Error("unsupported compression type"))}else t(Error("invalid compression method"));return n=a<<6,c[h++]=n|31-(256*r+n)%31,l=o(this.input),this.z.b=h,h=(c=this.z.n()).length,s&&((c=new Uint8Array(c.buffer)).length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=l>>24&255,c[h++]=l>>16&255,c[h++]=l>>8&255,c[h++]=255&l,c},n("Zlib.Deflate",I),n("Zlib.Deflate.compress",(function(t,e){return new I(t,e).n()})),n("Zlib.Deflate.CompressionType",P),n("Zlib.Deflate.CompressionType.NONE",P.NONE),n("Zlib.Deflate.CompressionType.FIXED",P.r),n("Zlib.Deflate.CompressionType.DYNAMIC",P.j);var R=0,O=1,B={D:R,C:O};M.prototype.p=function(){for(;!this.s;){var r=tt(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var n=this.input,o=this.c,a=this.a,l=this.b,c=e,h=e,u=e,d=a.length,p=e;switch(this.e=this.g=0,(c=n[o++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),h=c,(c=n[o++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),h|=c<<8,(c=n[o++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),u=c,(c=n[o++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),h===~(u|=c<<8)&&t(Error("invalid uncompressed block header: length verify")),o+h>n.length&&t(Error("input buffer is broken")),this.m){case R:for(;l+h>a.length;){if(h-=p=d-l,s)a.set(n.subarray(o,o+p),l),l+=p,o+=p;else for(;p--;)a[l++]=n[o++];this.b=l,a=this.f(),l=this.b}break;case O:for(;l+h>a.length;)a=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)a.set(n.subarray(o,o+h),l),l+=h,o+=h;else for(;h--;)a[l++]=n[o++];this.c=o,this.b=l,this.a=a;break;case 1:this.o(K,$);break;case 2:it(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var N,k,F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=s?new Uint16Array(F):F,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=s?new Uint16Array(j):j,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],Y=s?new Uint8Array(U):U,H=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],X=s?new Uint16Array(H):H,z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=s?new Uint8Array(z):z,Z=new(s?Uint8Array:Array)(288);for(N=0,k=Z.length;N<k;++N)Z[N]=143>=N?8:255>=N?9:279>=N?7:8;var J,q,K=_(Z),Q=new(s?Uint8Array:Array)(30);for(J=0,q=Q.length;J<q;++J)Q[J]=5;var $=_(Q);function tt(i,r){for(var n,s=i.g,o=i.e,a=i.input,l=i.c;o<r;)(n=a[l++])===e&&t(Error("input buffer is broken")),s|=n<<o,o+=8;return n=s&(1<<r)-1,i.g=s>>>r,i.e=o-r,i.c=l,n}function et(i,r){for(var n,s,o,a=i.g,l=i.e,c=i.input,h=i.c,u=r[0],d=r[1];l<d;)(n=c[h++])===e&&t(Error("input buffer is broken")),a|=n<<l,l+=8;return o=(s=u[a&(1<<d)-1])>>>16,i.g=a>>o,i.e=l-o,i.c=h,65535&s}function it(t){function e(t,e,i){var r,n,s,o;for(o=0;o<t;)switch(r=et(this,e)){case 16:for(s=3+tt(this,2);s--;)i[o++]=n;break;case 17:for(s=3+tt(this,3);s--;)i[o++]=0;n=0;break;case 18:for(s=11+tt(this,7);s--;)i[o++]=0;n=0;break;default:n=i[o++]=r}return i}var i,r,n,o,a=tt(t,5)+257,l=tt(t,5)+1,c=tt(t,4)+4,h=new(s?Uint8Array:Array)(V.length);for(o=0;o<c;++o)h[V[o]]=tt(t,3);i=_(h),r=new(s?Uint8Array:Array)(a),n=new(s?Uint8Array:Array)(l),t.o(_(e.call(t,a,i,r)),_(e.call(t,l,i,n)))}function rt(e,i){var r,n;if(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=e[this.c++],n=e[this.c++],(15&r)===ht)this.method=ht;else t(Error("unsupported compression method"));0!=((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new M(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}M.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,o,a,l=i.length-258;256!==(n=et(this,t));)if(256>n)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(a=G[s=n-257],0<Y[s]&&(a+=tt(this,Y[s])),n=et(this,e),o=X[n],0<W[n]&&(o+=tt(this,W[n])),r>=l&&(this.b=r,i=this.f(),r=this.b);a--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},M.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,o,a,l=i.length;256!==(n=et(this,t));)if(256>n)r>=l&&(l=(i=this.f()).length),i[r++]=n;else for(a=G[s=n-257],0<Y[s]&&(a+=tt(this,Y[s])),n=et(this,e),o=X[n],0<W[n]&&(o+=tt(this,W[n])),r+a>l&&(l=(i=this.f()).length);a--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},M.prototype.f=function(){var t,e,i=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(s)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,s)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},M.prototype.J=function(t){var e,i,r,n=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),i=2>n?(r=(o.length-this.c)/this.u[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*n,s?(e=new Uint8Array(i)).set(a):e=a,this.a=e},M.prototype.t=function(){var t,e,i,r,n,o=0,a=this.a,l=this.k,c=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(r=0,n=(t=l[e]).length;r<n;++r)c[o++]=t[r];for(e=32768,i=this.b;e<i;++e)c[o++]=a[e];return this.k=[],this.buffer=c},M.prototype.H=function(){var t,e=this.b;return s?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},rt.prototype.p=function(){var e,i=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==o(e)&&t(Error("invalid adler-32 checksum")),e},n("Zlib.Inflate",rt),n("Zlib.Inflate.BufferType",B),B.ADAPTIVE=B.C,B.BLOCK=B.D,n("Zlib.Inflate.prototype.decompress",rt.prototype.p);var nt,st,ot=new(s?Uint8Array:Array)(288);for(nt=0,st=ot.length;nt<st;++nt)ot[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;_(ot);var at,lt,ct=new(s?Uint8Array:Array)(30);for(at=0,lt=ct.length;at<lt;++at)ct[at]=5;_(ct);var ht=8}).call(window);var i=window.Zlib;i.Deflate=i.Deflate,i.Deflate.compress=i.Deflate.compress,i.Inflate=i.Inflate,i.Inflate.BufferType=i.Inflate.BufferType,i.Inflate.prototype.decompress=i.Inflate.prototype.decompress,e.exports=i},{}],26:[function(t,e){var i,r=t("./platform/utils"),n=(t("../../DebugInfos"),"https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md");function s(t){return function(){var e=arguments[0],i=t+" "+e+", please go to "+n+"#"+e+" to see details.";return 1===arguments.length?i:2===arguments.length?i+" Arguments: "+arguments[1]:i+" Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")}}cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log,cc._throw=function(t){r.callInNextTick((function(){throw t}))};var o=s("Log");cc.logID=function(){cc.log(o.apply(null,arguments))};var a=s("Warning");cc.warnID=function(){cc.warn(a.apply(null,arguments))};var l=s("Error");cc.errorID=function(){cc.error(l.apply(null,arguments))};var c=s("Assert");cc.assertID=function(t){t||cc.assert(!1,c.apply(null,cc.js.shiftArguments.apply(null,arguments)))};var h=cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});e.exports=cc.debug={DebugMode:h,_resetDebugSetting:function(t){if(cc.log=cc.warn=cc.error=cc.assert=function(){},t!==h.NONE){if(t>h.ERROR){var e=function(t){if(cc.game.canvas){if(!i){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc.game.canvas.height);var r=e.style;r.zIndex="99999",r.position="absolute",r.top=r.left="0",(i=document.createElement("textarea")).setAttribute("rows","20"),i.setAttribute("cols","30"),i.setAttribute("disabled","true");var n=i.style;n.backgroundColor="transparent",n.borderBottom="1px solid #cccccc",n.borderTopWidth=n.borderLeftWidth=n.borderRightWidth="0px",n.borderTopStyle=n.borderLeftStyle=n.borderRightStyle="none",n.padding="0px",n.margin=0,e.appendChild(i),cc.game.canvas.parentNode.appendChild(e)}i.value=i.value+t+"\r\n",i.scrollTop=i.scrollHeight}};cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,i){!t&&i&&(i=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),e("ASSERT: "+i))},t!==h.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===h.INFO_FOR_WEB_PAGE&&(cc.log=function(){e(cc.js.formatStr.apply(null,arguments))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t)throw e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(e)});t!==h.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===h.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)})}},getError:s("ERROR"),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!t)}}},{"../../DebugInfos":void 0,"./platform/utils":220}],27:[function(t,e){var i=t("./event/event-target"),r=t("./component-scheduler"),n=t("./node-activator"),s=t("./platform/CCObject"),o=t("./CCGame"),a=t("./renderer"),l=t("./event-manager"),c=t("./CCScheduler");cc.Director=function(){i.call(this),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._scene=null,this._loadingScene="",this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._startTime=0,this._maxParticleDeltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var t=this;o.on(o.EVENT_SHOW,(function(){t._lastUpdate=performance.now()})),o.once(o.EVENT_ENGINE_INITED,this.init,this)},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new c,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,c.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new r,this._nodeActivator=new n,l&&l.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,c.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,c.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,c.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc.Physics3DManager,this._physics3DManager=null,cc._widgetManager&&cc._widgetManager.init(this)},calculateDeltaTime:function(t){t||(t=performance.now()),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,this._lastUpdate=t},convertToGL:function(t){var e=o.container,i=cc.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=i._devicePixelRatio*(t.x-n),l=i._devicePixelRatio*(s+r.height-t.y);return i._isRotated?cc.v2(i._viewportRect.width-l,a):cc.v2(a,l)},convertToUI:function(t){var e=o.container,i=cc.view,r=e.getBoundingClientRect(),n=r.left+window.pageXOffset-e.clientLeft,s=r.top+window.pageYOffset-e.clientTop,a=cc.v2(0,0);return i._isRotated?(a.x=n+t.y/i._devicePixelRatio,a.y=s+r.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(a.x=n+t.x*i._devicePixelRatio,a.y=s+r.height-t.y*i._devicePixelRatio),a},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){cc.assetManager.releaseAll()},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),l&&l.setEnabled(!1),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,cc.renderer.clear(),cc.assetManager.builtins.clear(),cc.game.pause(),cc.assetManager.releaseAll()},reset:function(){this.purgeDirector(),l&&l.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),cc.game.resume()},runSceneImmediate:function(t,e,i){cc.assertID(t instanceof cc.Scene||t instanceof cc.SceneAsset,1216),t instanceof cc.SceneAsset&&(t=t.scene),t._load();for(var r=Object.keys(o._persistRootNodes).map((function(t){return o._persistRootNodes[t]})),n=0;n<r.length;n++){var a=r[n],l=t.getChildByUuid(a.uuid);if(l){var c=l.getSiblingIndex();l._destroyImmediate(),t.insertChild(a,c)}else a.parent=t}var h=this._scene;cc.assetManager._releaseManager._autoRelease(h,t,o._persistRootNodes),cc.isValid(h)&&h.destroy(),this._scene=null,s._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),cc.game.resume(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assertID(t,1205),cc.assertID(t instanceof cc.Scene||t instanceof cc.SceneAsset,1216),t instanceof cc.SceneAsset&&(t=t.scene),t._load(),this.once(cc.Director.EVENT_AFTER_DRAW,(function(){this.runSceneImmediate(t,e,i)}),this)},loadScene:function(t,e,i){if(this._loadingScene)return cc.warnID(1208,t,this._loadingScene),!1;var r=cc.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));if(r){this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t;var n=this;return console.time("LoadScene "+t),r.loadScene(t,(function(r,s){console.timeEnd("LoadScene "+t),n._loadingScene="",r?(r="Failed to load scene: "+r,cc.error(r),e&&e(r)):n.runSceneImmediate(s,i,e)})),!0}return cc.errorID(1209,t),!1},preloadScene:function(t,e,i){var r=cc.assetManager.bundles.find((function(e){return e.getSceneInfo(t)}));if(!r)return cc.errorID(1209,t),null;r.preloadScene(t,null,e,i)},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setDepthTest:function(t){cc.Camera.main&&(cc.Camera.main.depth=!!t)},setClearColor:function(t){cc.Camera.main&&(cc.Camera.main.backgroundColor=t)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/o.getFrameRate()},setAnimationInterval:function(t){o.setFrameRate(Math.round(1e3/t))},getDeltaTime:function(){return this._deltaTime},getTotalTime:function(){return performance.now()-this._startTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getPhysics3DManager:function(){return this._physics3DManager},startAnimation:function(){cc.game.resume()},stopAnimation:function(){cc.game.pause()},_resetDeltaTime:function(){this._lastUpdate=performance.now(),this._deltaTime=0},mainLoop:function(t){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else{this.calculateDeltaTime(t);var e=this._deltaTime;this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE,e),this._compScheduler.startPhase(),this._compScheduler.updatePhase(e),this._scheduler.update(e),this._compScheduler.lateUpdatePhase(e),this.emit(cc.Director.EVENT_AFTER_UPDATE,e),s._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW,e),a.render(this._scene,e),this.emit(cc.Director.EVENT_AFTER_DRAW,e),l.frameUpdateListeners(),this._totalFrames++}},__fastOn:function(t,e,i){this.on(t,e,i)},__fastOff:function(t,e,i){this.off(t,e,i)}},cc.js.addon(cc.Director.prototype,i.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics",cc.Director.EVENT_AFTER_PHYSICS="director_after_physics",cc.director=new cc.Director,e.exports=cc.director},{"./CCGame":28,"./CCScheduler":32,"./component-scheduler":100,"./event-manager":141,"./event/event-target":143,"./node-activator":169,"./platform/CCObject":202,"./renderer":227}],28:[function(t,e){var i=t("./event/event-target");t("../audio/CCAudioEngine");var r=t("./CCDebug"),n=t("./renderer/index.js"),s=t("../core/renderer/utils/dynamic-atlas/manager"),o={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(t){this.config.frameRate=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,(function(){for(var t in o._persistRootNodes)o.removePersistRootNode(o._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),o.pause(),cc.assetManager.builtins.init((function(){o.onStart(),o.emit(o.EVENT_RESTART)}))}))},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_loadPreviewScript:function(t){t()},_prepareFinished:function(t){var e=this;this._initEngine(),this._setAnimFrame(),cc.assetManager.builtins.init((function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION),e._prepared=!0,e._runMainLoop(),e.emit(e.EVENT_GAME_INITED),t&&t()}))},eventTargetOn:i.prototype.on,eventTargetOnce:i.prototype.once,on:function(t,e,i,r){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOn(t,e,i,r)},once:function(t,e,i){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOnce(t,e,i)},prepare:function(t){var e=this;this._prepared?t&&t():this._loadPreviewScript((function(){e._prepareFinished(t)}))},run:function(t,e){this._initConfig(t),this.onStart=e,this.prepare(o.onStart&&o.onStart.bind(o))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i))if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802)}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0,cc.assetManager._releaseManager._addPersistNodeRef(t)}}else cc.warnID(3800)},removePersistRootNode:function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,cc.assetManager._releaseManager._removePersistNodeRef(t))},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=performance.now();var t=o.config.frameRate;this._frameTime=1e3/t,cc.director._maxParticleDeltaTime=this._frameTime/1e3*2;var e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.requestAnimFrame=e?this._stTimeWithRAF:this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=e||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTimeWithRAF:function(t){var e=performance.now(),i=Math.max(0,o._frameTime-(e-o._lastTime)),r=window.setTimeout((function(){window.requestAnimationFrame(t)}),i);return o._lastTime=e+i,r},_stTime:function(t){var e=performance.now(),i=Math.max(0,o._frameTime-(e-o._lastTime)),r=window.setTimeout((function(){t()}),i);return o._lastTime=e+i,r},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){if(this._prepared){var t,e=this,i=e.config,n=cc.director,s=!0,o=i.frameRate;r.setDisplayStats(i.showFPS),t=function(i){if(!e._paused){if(e._intervalId=window.requestAnimFrame(t),30===o&&(s=!s))return;n.mainLoop(i)}},e._intervalId=window.requestAnimFrame(t),e._paused=!1}},_initConfig:function(t){"number"!=typeof t.debugMode&&(t.debugMode=0),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>2||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=1!==e&&!!t.showFPS,this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],r._resetDebugSetting(t.debugMode),this.config=t,this._configLoaded=!0},_determineRenderType:function(){var t=this.config,e=parseInt(t.renderMode)||0;this.renderType=this.RENDER_TYPE_CANVAS;var i=!1;if(0===e?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,i=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,i=!0):1===e&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,i=!0):2===e&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,i=!0),!i)throw new Error(r.getError(3820,e))},_initRenderer:function(){if(!this._rendererInitialized){var t,e,i,r,o=this.config.id,a=o instanceof HTMLElement?o:document.querySelector(o)||document.querySelector("#"+o);if("CANVAS"===a.tagName?(t=a.width,e=a.height,this.canvas=i=a,this.container=r=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(r,i)):("DIV"!==a.tagName&&cc.warnID(3819),t=a.clientWidth,e=a.clientHeight,this.canvas=i=document.createElement("CANVAS"),this.container=r=document.createElement("DIV"),a.appendChild(r)),r.setAttribute("id","Cocos2dGameContainer"),r.appendChild(i),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,function(t){(" "+t.className+" ").indexOf(" gameCanvas ")>-1||(t.className&&(t.className+=" "),t.className+="gameCanvas")}(i),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL){var l={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};n.initWebGL(i,l),this._renderContext=n.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&s&&(s.enabled=!0)}this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,n.initCanvas(i),this._renderContext=n.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0}},_initEvents:function(){var t,e=window;this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?t="hidden":void 0!==document.mozHidden?t="mozHidden":void 0!==document.msHidden?t="msHidden":void 0!==document.webkitHidden&&(t="webkitHidden");var i=!1;function r(){i||(i=!0,o.emit(o.EVENT_HIDE))}function n(t,e,r,n,s){i&&(i=!1,o.emit(o.EVENT_SHOW,t,e,r,n,s))}if(t)for(var s=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],a=0;a<s.length;a++)document.addEventListener(s[a],(function(e){var i=document[t];(i=i||e.hidden)?r():n()}));else e.addEventListener("blur",r),e.addEventListener("focus",n);navigator.userAgent.indexOf("MicroMessenger")>-1&&(e.onfocus=n),"onpageshow"in window&&"onpagehide"in window&&(e.addEventListener("pagehide",r),e.addEventListener("pageshow",n),document.addEventListener("pagehide",r),document.addEventListener("pageshow",n)),this.on(o.EVENT_HIDE,(function(){o.pause()})),this.on(o.EVENT_SHOW,(function(){o.resume()}))}};i.call(o),cc.js.addon(o,i.prototype),cc.game=e.exports=o},{"../audio/CCAudioEngine":21,"../core/renderer/utils/dynamic-atlas/manager":230,"./CCDebug":26,"./event/event-target":143,"./renderer/index.js":227}],29:[function(t,e){var i=t("./value-types"),r=t("./value-types/utils"),n=t("./utils/base-node"),s=t("./utils/prefab-helper"),o=t("./utils/trans-pool").NodeMemPool,a=t("./utils/affine-transform"),l=t("./event-manager"),c=t("./platform/CCMacro"),h=t("./platform/js"),u=(t("./event/event"),t("./event/event-target")),d=t("./renderer/render-flow"),p=cc.Object.Flags.Destroying,f=Math.PI/180,_=!!cc.ActionManager,m=function(){},g=new i.Vec3,y=new i.Quat,v=new i.Vec3,b=new i.Vec3,x=new i.Quat,T=new i.Quat,C=new i.Vec3,S=new i.Vec3,w=new i.Vec3,A=new i.Vec3,E=new i.Vec3,D=new i.Quat,L=new i.Quat,I=new i.Vec3,P=new i.Quat,M=new i.Vec3,R=new i.Quat,O=new i.Vec3,B=new i.Vec3,N=new i.Quat,k=new i.Quat,F=(new i.Quat,cc.mat4()),V=new i.Vec3,j=new h.Pool;j.get=function(){return this._get()||[]};var G=cc.Enum({DEBUG:31}),U=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535}),Y=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"}),H=[Y.TOUCH_START,Y.TOUCH_MOVE,Y.TOUCH_END,Y.TOUCH_CANCEL],X=[Y.MOUSE_DOWN,Y.MOUSE_ENTER,Y.MOUSE_MOVE,Y.MOUSE_LEAVE,Y.MOUSE_UP,Y.MOUSE_WHEEL],z=!0,W=function(t){0!==t&&(z&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),z=!1)},Z=null,J=function(t,e){var i=t.getLocation(),r=this.owner;return!!r._hitTest(i,this)&&(e.type=Y.TOUCH_START,e.touch=t,e.bubbles=!0,r.dispatchEvent(e),!0)},q=function(t,e){var i=this.owner;e.type=Y.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},K=function(t,e){var i=t.getLocation(),r=this.owner;r._hitTest(i,this)?e.type=Y.TOUCH_END:e.type=Y.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,r.dispatchEvent(e)},Q=function(t,e){t.getLocation();var i=this.owner;e.type=Y.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},$=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=Y.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t))},tt=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))this._previousIn||(Z&&Z._mouseListener&&(t.type=Y.MOUSE_LEAVE,Z.dispatchEvent(t),Z._mouseListener._previousIn=!1),Z=this.owner,t.type=Y.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=Y.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=Y.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,Z=null}t.stopPropagation()},et=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=Y.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},it=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=Y.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())};function rt(t,e){if(e){for(var i=0,r=null,n=t;n&&cc.Node.isNode(n);n=n._parent,++i)if(n.getComponent(e)){var s={index:i,node:n};r?r.push(s):r=[s]}return r}return null}function nt(t,e){if(!(t._objFlags&p)){if(t._bubblingListeners)for(var i=0,r=e.length;i<r;++i)if(t._bubblingListeners.hasEventListener(e[i]))return!0;if(t._capturingListeners)for(var n=0,s=e.length;n<s;++n)if(t._capturingListeners.hasEventListener(e[n]))return!0;return!1}return!0}function st(t){var e=t.groupIndex;return 0===e&&t.parent&&(e=st(t.parent)),e}function ot(t){var e=st(t);t._cullingMask=1<<e;for(var i=0;i<t._children.length;i++)ot(t._children[i])}function at(){if(this._localMatDirty&U.TRSS){var t=this._matrix,e=t.m;if(i.Trs.toMat4(t,this._trs),this._skewX||this._skewY){var r=e[0],n=e[1],s=e[4],o=e[5],a=Math.tan(this._skewX*f),l=Math.tan(this._skewY*f);a===1/0&&(a=99999999),l===1/0&&(l=99999999),e[0]=r+s*l,e[1]=n+o*l,e[4]=s+r*a,e[5]=o+n*a}this._localMatDirty&=~U.TRSS,this._worldMatDirty=!0}}function lt(){var t=this._localMatDirty;if(t&U.TRSS){var e=this._matrix.m,i=this._trs;if(t&(U.RS|U.SKEW)){var r=-this._eulerAngles.z,n=this._skewX||this._skewY,s=i[7],o=i[8];if(r||n){var a=1,l=0,c=0,h=1;if(r){var u=r*f;c=Math.sin(u),a=h=Math.cos(u),l=-c}if(e[0]=a*=s,e[1]=l*=s,e[4]=c*=o,e[5]=h*=o,n){var d=e[0],p=e[1],_=e[4],m=e[5],g=Math.tan(this._skewX*f),y=Math.tan(this._skewY*f);g===1/0&&(g=99999999),y===1/0&&(y=99999999),e[0]=d+_*y,e[1]=p+m*y,e[4]=_+d*g,e[5]=m+p*g}}else e[0]=s,e[1]=0,e[4]=0,e[5]=o}e[12]=i[0],e[13]=i[1],this._localMatDirty&=~U.TRSS,this._worldMatDirty=!0}}function ct(){if(this._localMatDirty&U.TRSS&&this._updateLocalMatrix(),this._parent){var t=this._parent._worldMatrix;i.Mat4.mul(this._worldMatrix,t,this._matrix)}else i.Mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1}function ht(){this._localMatDirty&U.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):i.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function ut(t,e,i){var r=e.m,n=i.m,s=t.m,o=r[0],a=r[1],l=r[4],c=r[5],h=r[12],u=r[13],d=n[0],p=n[1],f=n[4],_=n[5],m=n[12],g=n[13];0!==a||0!==l?(s[0]=d*o+p*l,s[1]=d*a+p*c,s[4]=f*o+_*l,s[5]=f*a+_*c,s[12]=o*m+l*g+h,s[13]=a*m+c*g+u):(s[0]=d*o,s[1]=p*c,s[4]=f*o,s[5]=_*c,s[12]=o*m+h,s[13]=c*g+u)}var dt=i.Mat4.mul,pt={name:"cc.Node",extends:n,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,_groupIndex:{default:0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex},set:function(t){this._groupIndex=t,ot(this),this.emit(Y.GROUP_CHANGED,this)}},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t)}},x:{get:function(){return this._trs[0]},set:function(t){var e=this._trs;t!==e[0]&&(e[0]=t,this.setLocalDirty(U.ALL_POSITION),1&this._eventMask&&this.emit(Y.POSITION_CHANGED))}},y:{get:function(){return this._trs[1]},set:function(t){var e=this._trs;t!==e[1]&&(e[1]=t,this.setLocalDirty(U.ALL_POSITION),1&this._eventMask&&this.emit(Y.POSITION_CHANGED))}},z:{get:function(){return this._trs[2]},set:function(t){var e=this._trs;t!==e[2]&&(e[2]=t,this.setLocalDirty(U.ALL_POSITION),this._renderFlag|=d.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(Y.POSITION_CHANGED))}},rotation:{get:function(){return-this.angle},set:function(t){this.angle=-t}},angle:{get:function(){return this._eulerAngles.z},set:function(t){i.Vec3.set(this._eulerAngles,0,0,t),i.Trs.fromAngleZ(this._trs,t),this.setLocalDirty(U.ALL_ROTATION),4&this._eventMask&&this.emit(Y.ROTATION_CHANGED)}},rotationX:{get:function(){return this._eulerAngles.x},set:function(t){this._eulerAngles.x!==t&&(this._eulerAngles.x=t,this._eulerAngles.x===this._eulerAngles.y?i.Trs.fromAngleZ(this._trs,-t):i.Trs.fromEulerNumber(this._trs,t,this._eulerAngles.y,0),this.setLocalDirty(U.ALL_ROTATION),4&this._eventMask&&this.emit(Y.ROTATION_CHANGED))}},rotationY:{get:function(){return this._eulerAngles.y},set:function(t){this._eulerAngles.y!==t&&(this._eulerAngles.y=t,this._eulerAngles.x===this._eulerAngles.y?i.Trs.fromAngleZ(this._trs,-t):i.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,t,0),this.setLocalDirty(U.ALL_ROTATION),4&this._eventMask&&this.emit(Y.ROTATION_CHANGED))}},eulerAngles:{get:function(){return i.Trs.toEuler(this._eulerAngles,this._trs)},set:function(t){i.Trs.fromEuler(this._trs,t),this.setLocalDirty(U.ALL_ROTATION),this._renderFlag|=d.FLAG_TRANSFORM,4&this._eventMask&&this.emit(Y.ROTATION_CHANGED)}},quat:{get:function(){var t=this._trs;return new i.Quat(t[3],t[4],t[5],t[6])},set:function(t){this.setRotation(t)}},scale:{get:function(){return this._trs[7]},set:function(t){this.setScale(t)}},scaleX:{get:function(){return this._trs[7]},set:function(t){this._trs[7]!==t&&(this._trs[7]=t,this.setLocalDirty(U.ALL_SCALE),2&this._eventMask&&this.emit(Y.SCALE_CHANGED))}},scaleY:{get:function(){return this._trs[8]},set:function(t){this._trs[8]!==t&&(this._trs[8]=t,this.setLocalDirty(U.ALL_SCALE),2&this._eventMask&&this.emit(Y.SCALE_CHANGED))}},scaleZ:{get:function(){return this._trs[9]},set:function(t){this._trs[9]!==t&&(this._trs[9]=t,this.setLocalDirty(U.ALL_SCALE),this._renderFlag|=d.FLAG_TRANSFORM,2&this._eventMask&&this.emit(Y.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(t){W(t),this._skewX=t,this.setLocalDirty(U.SKEW)}},skewY:{get:function(){return this._skewY},set:function(t){W(t),this._skewY=t,this.setLocalDirty(U.SKEW)}},opacity:{get:function(){return this._opacity},set:function(t){t=cc.misc.clampf(t,0,255),this._opacity!==t&&(this._opacity=t,this._renderFlag|=d.FLAG_OPACITY_COLOR)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.set(t),this._renderFlag|=d.FLAG_COLOR,32&this._eventMask&&this.emit(Y.COLOR_CHANGED,t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;e.x!==t&&(e.x=t,16&this._eventMask&&this.emit(Y.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;e.y!==t&&(e.y=t,16&this._eventMask&&this.emit(Y.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(t){t!==this._contentSize.width&&(this._contentSize.width=t,8&this._eventMask&&this.emit(Y.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(t){t!==this._contentSize.height&&(this._contentSize.height=t,8&this._eventMask&&this.emit(Y.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(t){t>c.MAX_ZINDEX?(cc.warnID(1636),t=c.MAX_ZINDEX):t<c.MIN_ZINDEX&&(cc.warnID(1637),t=c.MIN_ZINDEX),this.zIndex!==t&&(this._localZOrder=65535&this._localZOrder|t<<16,this.emit(Y.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged())}},is3DNode:{get:function(){return this._is3DNode},set:function(t){this._is3DNode!==t&&(this._is3DNode=t,this._update3DFunction())}},up:{get:function(){return i.Vec3.transformQuat(M,i.Vec3.UP,this.getWorldRotation(R)).clone()}},right:{get:function(){return i.Vec3.transformQuat(M,i.Vec3.RIGHT,this.getWorldRotation(R)).clone()}},forward:{get:function(){return i.Vec3.transformQuat(M,i.Vec3.FORWARD,this.getWorldRotation(R)).clone()}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._initDataFromPool(),this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._renderFlag=d.FLAG_TRANSFORM|d.FLAG_OPACITY_COLOR},statics:{EventType:Y,_LocalDirtyFlag:U,isNode:function(t){return t instanceof ft&&(t.constructor===ft||!(t instanceof cc.Scene))},BuiltinGroupIndex:G},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase(),_&&cc.director.getActionManager().removeAllActionsFromTarget(this),Z===this&&(Z=null),this._bubblingListeners&&this._bubblingListeners.clear(),this._capturingListeners&&this._capturingListeners.clear(),(this._touchListener||this._mouseListener)&&(l.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),this._backDataIntoPool(),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(t){var e=_?cc.director.getActionManager():null;t?(this._renderFlag|=d.FLAG_WORLD_TRANSFORM,e&&e.resumeTarget(this),l.resumeTarget(this),this._checkListenerMask()):(e&&e.pauseTarget(this),l.pauseTarget(this))},_onHierarchyChanged:function(t){this._updateOrderOfArrival(),ot(this),this._parent&&this._parent._delaySort(),this._renderFlag|=d.FLAG_WORLD_TRANSFORM|d.FLAG_OPACITY_COLOR,this._onHierarchyChangedBase(t),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0),t&&this._activeInHierarchy&&this._checkListenerMask()},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=at,this._calculWorldMatrix=ct,this._mulMat=dt):(this._updateLocalMatrix=lt,this._calculWorldMatrix=ht,this._mulMat=ut),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=d.FLAG_TRANSFORM,this._localMatDirty=U.ALL},_initDataFromPool:function(){this._spaceInfo||(this._spaceInfo=o.pop());var t=this._spaceInfo;this._matrix=cc.mat4(t.localMat),i.Mat4.identity(this._matrix),this._worldMatrix=cc.mat4(t.worldMat),i.Mat4.identity(this._worldMatrix),this._localMatDirty=U.ALL,this._worldMatDirty=!0;var e=this._trs=t.trs;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=1,e[7]=1,e[8]=1,e[9]=1},_backDataIntoPool:function(){o.push(this._spaceInfo),this._matrix=null,this._worldMatrix=null,this._trs=null,this._spaceInfo=null},_toEuler:function(){if(this.is3DNode)i.Trs.toEuler(this._eulerAngles,this._trs);else{var t=Math.asin(this._trs[5])/f*2;i.Vec3.set(this._eulerAngles,0,0,t)}},_fromEuler:function(){this.is3DNode?i.Trs.fromEuler(this._trs,this._eulerAngles):i.Trs.fromAngleZ(this._trs,this._eulerAngles.z)},_initProperties:function(){this._is3DNode&&this._update3DFunction();var t=this._trs;if(t){var e=t;t=this._trs=this._spaceInfo.trs,11===e.length?t.set(e.subarray(1)):t.set(e)}else t=this._trs=this._spaceInfo.trs;this._fromEuler()},_onBatchCreated:function(t){this._initProperties(),this._cullingMask=1<<st(this),this._activeInHierarchy||(_&&cc.director.getActionManager().pauseTarget(this),l.pauseTarget(this));for(var e=this._children,i=0,r=e.length;i<r;i++){var n=e[i];if(!t){var o=n._prefab;o&&o.sync&&o.root===n&&s.syncWithPrefab(n),n._updateOrderOfArrival()}n._onBatchCreated(t)}e.length>0&&(this._renderFlag|=d.FLAG_CHILDREN)},_checkListenerMask:function(){if(this._touchListener){var t=this._touchListener.mask=rt(this,cc.Mask);this._mouseListener&&(this._mouseListener.mask=t)}else this._mouseListener&&(this._mouseListener.mask=rt(this,cc.Mask))},_checknSetupSysEvent:function(t){var e=!1,i=!1;return-1!==H.indexOf(t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:rt(this,cc.Mask),onTouchBegan:J,onTouchMoved:q,onTouchEnded:K,onTouchCancelled:Q}),l.addListener(this._touchListener,this),e=!0),i=!0):-1!==X.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:rt(this,cc.Mask),onMouseDown:$,onMouseMove:tt,onMouseUp:et,onMouseScroll:it}),l.addListener(this._mouseListener,this),e=!0),i=!0),e&&!this._activeInHierarchy&&cc.director.getScheduler().schedule((function(){this._activeInHierarchy||l.pauseTarget(this)}),this,0,0,0,!1),i},on:function(t,e,i,r){if(this._checknSetupSysEvent(t))return this._onDispatch(t,e,i,r);switch(t){case Y.POSITION_CHANGED:this._eventMask|=1;break;case Y.SCALE_CHANGED:this._eventMask|=2;break;case Y.ROTATION_CHANGED:this._eventMask|=4;break;case Y.SIZE_CHANGED:this._eventMask|=8;break;case Y.ANCHOR_CHANGED:this._eventMask|=16;break;case Y.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new u),this._bubblingListeners.on(t,e,i)},once:function(t,e,i,r){var n=this,s=null;(s=this._checknSetupSysEvent(t)&&r?this._capturingListeners=this._capturingListeners||new u:this._bubblingListeners=this._bubblingListeners||new u).once(t,e,i),s.once(t,(function(){n.off(t,e,i)}),void 0)},_onDispatch:function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e){var n=null;return(n=r?this._capturingListeners=this._capturingListeners||new u:this._bubblingListeners=this._bubblingListeners||new u).hasEventListener(t,e,i)||(n.on(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e}cc.errorID(6800)},off:function(t,e,i,r){var n=-1!==H.indexOf(t),s=!n&&-1!==X.indexOf(t);if(n||s)this._offDispatch(t,e,i,r),n?this._touchListener&&!nt(this,H)&&(l.removeListener(this._touchListener),this._touchListener=null):s&&this._mouseListener&&!nt(this,X)&&(l.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners&&(this._bubblingListeners.off(t,e,i),!this._bubblingListeners.hasEventListener(t)))switch(t){case Y.POSITION_CHANGED:this._eventMask&=-2;break;case Y.SCALE_CHANGED:this._eventMask&=-3;break;case Y.ROTATION_CHANGED:this._eventMask&=-5;break;case Y.SIZE_CHANGED:this._eventMask&=-9;break;case Y.ANCHOR_CHANGED:this._eventMask&=-17;break;case Y.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e){var n=r?this._capturingListeners:this._bubblingListeners;n&&(n.off(t,e,i),i&&i.__eventTargets&&h.array.fastRemove(i.__eventTargets,this))}else this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},targetOff:function(t){var e=this._bubblingListeners;e&&(e.targetOff(t),1&this._eventMask&&!e.hasEventListener(Y.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!e.hasEventListener(Y.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!e.hasEventListener(Y.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!e.hasEventListener(Y.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!e.hasEventListener(Y.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!e.hasEventListener(Y.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(t),t&&t.__eventTargets&&h.array.fastRemove(t.__eventTargets,this),this._touchListener&&!nt(this,H)&&(l.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!nt(this,X)&&(l.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(t){var e=!1;return this._bubblingListeners&&(e=this._bubblingListeners.hasEventListener(t)),!e&&this._capturingListeners&&(e=this._capturingListeners.hasEventListener(t)),e},emit:function(t,e,i,r,n,s){this._bubblingListeners&&this._bubblingListeners.emit(t,e,i,r,n,s)},dispatchEvent:function(t){var e=j.get();(function(t,e,i){var r,n;for(e.target=t,i.length=0,t._getCapturingTargets(e.type,i),e.eventPhase=1,n=i.length-1;n>=0;--n)if((r=i[n])._capturingListeners&&(e.currentTarget=r,r._capturingListeners.emit(e.type,e,i),e._propagationStopped))return void(i.length=0);if(i.length=0,e.eventPhase=2,e.currentTarget=t,t._capturingListeners&&t._capturingListeners.emit(e.type,e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.emit(e.type,e),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,i),e.eventPhase=3,n=0;n<i.length;++n)if((r=i[n])._bubblingListeners&&(e.currentTarget=r,r._bubblingListeners.emit(e.type,e),e._propagationStopped))return void(i.length=0);i.length=0})(this,t,e),j.put(e)},pauseSystemEvents:function(t){l.pauseTarget(this,t)},resumeSystemEvents:function(t){l.resumeTarget(this,t)},_hitTest:function(t,e){var r=this._contentSize.width,n=this._contentSize.height,s=O,o=B,a=cc.Camera.findCamera(this);if(a?a.getScreenToWorldPoint(t,s):s.set(t),this._updateWorldMatrix(),!i.Mat4.invert(F,this._worldMatrix))return!1;i.Vec2.transformMat4(o,s,F),o.x+=this._anchorPoint.x*r,o.y+=this._anchorPoint.y*n;var l=!1;if(o.x>=0&&o.y>=0&&o.x<=r&&o.y<=n&&(l=!0,e&&e.mask))for(var c=e.mask,h=this,u=c?c.length:0,d=0,p=0;h&&p<u;++d,h=h.parent){var f=c[p];if(d===f.index){if(h!==f.node){c.length=p;break}var _=h.getComponent(cc.Mask);if(_&&_._enabled&&!_._hitTest(s)){l=!1;break}p++}else if(d>f.index){c.length=p;break}}return l},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i._capturingListeners&&i._capturingListeners.hasEventListener(t)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i._bubblingListeners&&i._bubblingListeners.hasEventListener(t)&&e.push(i),i=i.parent},runAction:_?function(t){if(this.active){cc.assertID(t,1618);var e=cc.director.getActionManager();return e._suppressDeprecation||(e._suppressDeprecation=!0,cc.warnID(1639)),e.addAction(t,this,!1),t}}:m,pauseAllActions:_?function(){cc.director.getActionManager().pauseTarget(this)}:m,resumeAllActions:_?function(){cc.director.getActionManager().resumeTarget(this)}:m,stopAllActions:_?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:m,stopAction:_?function(t){cc.director.getActionManager().removeAction(t)}:m,stopActionByTag:_?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:m,getActionByTag:_?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:_?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(t){return t=t||new i.Vec3,i.Trs.toPosition(t,this._trs)},setPosition:function(t,e,i){var r;void 0===e?(r=t.x,e=t.y,i=t.z):r=t;var n=this._trs;void 0===i&&(i=n[2]),(n[0]!==r||n[1]!==e||n[2]!==i)&&(n[0]=r,n[1]=e,n[2]=i,this.setLocalDirty(U.ALL_POSITION),this._renderFlag|=d.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(Y.POSITION_CHANGED))},getScale:function(t){return void 0!==t?i.Trs.toScale(t,this._trs):(cc.errorID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7])},setScale:function(t,e,i){var r;t&&"number"!=typeof t?(r=t.x,e=t.y,i=t.z):void 0!==t&&void 0===e?(r=t,e=t,i=t):r=t;var n=this._trs;void 0===i&&(i=n[9]),n[7]===r&&n[8]===e&&n[9]===i||(n[7]=r,n[8]=e,n[9]=i,this.setLocalDirty(U.ALL_SCALE),this._renderFlag|=d.FLAG_TRANSFORM,2&this._eventMask&&this.emit(Y.SCALE_CHANGED))},getRotation:function(t){return t instanceof i.Quat?i.Trs.toRotation(t,this._trs):-this.angle},setRotation:function(t,e,i,r){if("number"==typeof t&&void 0===e)this.angle=-t;else{var n=t;void 0===e&&(n=t.x,e=t.y,i=t.z,r=t.w);var s=this._trs;s[3]===n&&s[4]===e&&s[5]===i&&s[6]===r||(s[3]=n,s[4]=e,s[5]=i,s[6]=r,this.setLocalDirty(U.ALL_ROTATION),4&this._eventMask&&this.emit(Y.ROTATION_CHANGED))}},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if((0,r.approx)(t.width,i.width)&&(0,r.approx)(t.height,i.height))return;i.width=t.width,i.height=t.height}else{if((0,r.approx)(t,i.width)&&(0,r.approx)(e,i.height))return;i.width=t,i.height=e}8&this._eventMask&&this.emit(Y.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.setLocalDirty(U.ALL_POSITION),16&this._eventMask&&this.emit(Y.ANCHOR_CHANGED)},_invTransformPoint:function(t,e){this._parent?this._parent._invTransformPoint(t,e):i.Vec3.copy(t,e);var r=this._trs;return i.Trs.toPosition(v,r),i.Vec3.sub(t,t,v),i.Trs.toRotation(x,r),i.Quat.conjugate(T,x),i.Vec3.transformQuat(t,t,T),i.Trs.toScale(v,r),i.Vec3.inverseSafe(b,v),i.Vec3.mul(t,t,b),t},getWorldPosition:function(t){i.Trs.toPosition(t,this._trs);for(var e,r=this._parent;r;)e=r._trs,i.Trs.toScale(g,e),i.Vec3.mul(t,t,g),i.Trs.toRotation(y,e),i.Vec3.transformQuat(t,t,y),i.Trs.toPosition(g,e),i.Vec3.add(t,t,g),r=r._parent;return t},setWorldPosition:function(t){var e=this._trs;this._parent?this._parent._invTransformPoint(C,t):i.Vec3.copy(C,t),i.Trs.fromPosition(e,C),this.setLocalDirty(U.ALL_POSITION),1&this._eventMask&&this.emit(Y.POSITION_CHANGED)},getWorldRotation:function(t){i.Trs.toRotation(N,this._trs),i.Quat.copy(t,N);for(var e=this._parent;e;)i.Trs.toRotation(N,e._trs),i.Quat.mul(t,N,t),e=e._parent;return t},setWorldRotation:function(t){this._parent?(this._parent.getWorldRotation(k),i.Quat.conjugate(k,k),i.Quat.mul(k,k,t)):i.Quat.copy(k,t),i.Trs.fromRotation(this._trs,k),this.setLocalDirty(U.ALL_ROTATION)},getWorldScale:function(t){i.Trs.toScale(S,this._trs),i.Vec3.copy(t,S);for(var e=this._parent;e;)i.Trs.toScale(S,e._trs),i.Vec3.mul(t,t,S),e=e._parent;return t},setWorldScale:function(t){this._parent?(this._parent.getWorldScale(w),i.Vec3.div(w,t,w)):i.Vec3.copy(w,t),i.Trs.fromScale(this._trs,w),this.setLocalDirty(U.ALL_SCALE)},getWorldRT:function(t){var e=A,r=D,n=this._trs;i.Trs.toPosition(e,n),i.Trs.toRotation(r,n);for(var s=this._parent;s;)n=s._trs,i.Trs.toScale(E,n),i.Vec3.mul(e,e,E),i.Trs.toRotation(L,n),i.Vec3.transformQuat(e,e,L),i.Trs.toPosition(E,n),i.Vec3.add(e,e,E),i.Quat.mul(r,L,r),s=s._parent;return i.Mat4.fromRT(t,r,e),t},lookAt:function(t,e){this.getWorldPosition(I),i.Vec3.sub(I,I,t),i.Vec3.normalize(I,I),i.Quat.fromViewUp(P,I,e),this.setWorldRotation(P)},_updateLocalMatrix:lt,_calculWorldMatrix:function(){this._localMatDirty&U.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):i.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1},_mulMat:ut,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var t=this._children,e=0,i=t.length;e<i;e++)t[e]._worldMatDirty=!0}},setLocalDirty:function(t){this._localMatDirty|=t,this._worldMatDirty=!0,t===U.ALL_POSITION||t===U.POSITION?this._renderFlag|=d.FLAG_WORLD_TRANSFORM:this._renderFlag|=d.FLAG_TRANSFORM},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(t){return this._updateLocalMatrix(),i.Mat4.copy(t,this._matrix)},getWorldMatrix:function(t){return this._updateWorldMatrix(),i.Mat4.copy(t,this._worldMatrix)},convertToNodeSpaceAR:function(t,e){return this._updateWorldMatrix(),i.Mat4.invert(F,this._worldMatrix),t instanceof cc.Vec2?(e=e||new cc.Vec2,i.Vec2.transformMat4(e,t,F)):(e=e||new cc.Vec3,i.Vec3.transformMat4(e,t,F))},convertToWorldSpaceAR:function(t,e){return this._updateWorldMatrix(),t instanceof cc.Vec2?(e=e||new cc.Vec2,i.Vec2.transformMat4(e,t,this._worldMatrix)):(e=e||new cc.Vec3,i.Vec3.transformMat4(e,t,this._worldMatrix))},convertToNodeSpace:function(t){this._updateWorldMatrix(),i.Mat4.invert(F,this._worldMatrix);var e=new cc.Vec2;return i.Vec2.transformMat4(e,t,F),e.x+=this._anchorPoint.x*this._contentSize.width,e.y+=this._anchorPoint.y*this._contentSize.height,e},convertToWorldSpace:function(t){this._updateWorldMatrix();var e=new cc.Vec2(t.x-this._anchorPoint.x*this._contentSize.width,t.y-this._anchorPoint.y*this._contentSize.height);return i.Vec2.transformMat4(e,e,this._worldMatrix)},getNodeToParentTransform:function(t){t||(t=a.identity()),this._updateLocalMatrix();var e=this._contentSize;return V.x=-this._anchorPoint.x*e.width,V.y=-this._anchorPoint.y*e.height,i.Mat4.copy(F,this._matrix),i.Mat4.transform(F,F,V),a.fromMat4(t,F)},getNodeToParentTransformAR:function(t){return t||(t=a.identity()),this._updateLocalMatrix(),a.fromMat4(t,this._matrix)},getNodeToWorldTransform:function(t){t||(t=a.identity()),this._updateWorldMatrix();var e=this._contentSize;return V.x=-this._anchorPoint.x*e.width,V.y=-this._anchorPoint.y*e.height,i.Mat4.copy(F,this._worldMatrix),i.Mat4.transform(F,F,V),a.fromMat4(t,F)},getNodeToWorldTransformAR:function(t){return t||(t=a.identity()),this._updateWorldMatrix(),a.fromMat4(t,this._worldMatrix)},getParentToNodeTransform:function(t){return t||(t=a.identity()),this._updateLocalMatrix(),i.Mat4.invert(F,this._matrix),a.fromMat4(t,F)},getWorldToNodeTransform:function(t){return t||(t=a.identity()),this._updateWorldMatrix(),i.Mat4.invert(F,this._worldMatrix),a.fromMat4(t,F)},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var t=this._contentSize.width,e=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(i,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox()},_getBoundingBoxTo:function(){var t=this._contentSize.width,e=this._contentSize.height,i=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);if(this._calculWorldMatrix(),i.transformMat4(i,this._worldMatrix),!this._children)return i;for(var r=this._children,n=0;n<r.length;n++){var s=r[n];if(s&&s.active){var o=s._getBoundingBoxTo();o&&i.union(i,o)}}return i},_updateOrderOfArrival:function(){var t=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|t,this.emit(Y.SIBLING_ORDER_CHANGED)},setSelfGroupIndex:function(t){this._groupIndex=t||0,this._cullingMask=1<<t},addChild:function(t,e,i){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,void 0!==e&&(t.zIndex=e),void 0!==i&&(t.name=i)},cleanup:function(){_&&cc.director.getActionManager().removeAllActionsFromTarget(this),l.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)(e=this._children[t])&&e.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;this._childArrivalOrder=1;for(var e=0,i=t.length;e<i;e++)t[e]._updateOrderOfArrival();if(l._setDirtyForNode(this),t.length>1){for(var r,n,s=1,o=t.length;s<o;s++){r=t[s];for(var a=s;a>0&&(n=t[a-1])._localZOrder>r._localZOrder;a--)t[a]=n;t[a]=r}this.emit(Y.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_restoreProperties:!1,onRestore:!1},ft=cc.Class(pt),_t=ft.prototype;h.getset(_t,"position",_t.getPosition,_t.setPosition,!1,!0),cc.Node=e.exports=ft},{"./event-manager":141,"./event/event":144,"./event/event-target":143,"./platform/CCMacro":201,"./platform/js":217,"./renderer/render-flow":228,"./utils/affine-transform":262,"./utils/base-node":263,"./utils/prefab-helper":274,"./utils/trans-pool":280,"./value-types":286,"./value-types/utils":293}],30:[function(t,e){var i=t("./CCNode"),r=t("./renderer/render-flow"),n=(cc.Object.Flags.HideInHierarchy,i._LocalDirtyFlag),s=cc.Class({name:"cc.PrivateNode",extends:i,properties:{x:{get:function(){return this._originPos.x},set:function(t){var e=this._originPos;t!==e.x&&(e.x=t,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(t){var e=this._originPos;t!==e.y&&(e.y=t,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2()},_posDirty:function(t){this.setLocalDirty(n.POSITION),this._renderFlag|=r.FLAG_TRANSFORM,!0===t&&1&this._eventMask&&this.emit(i.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){if(this._localMatDirty){var t=this.parent;t&&(this._trs[0]=this._originPos.x-(t._anchorPoint.x-.5)*t._contentSize.width,this._trs[1]=this._originPos.y-(t._anchorPoint.y-.5)*t._contentSize.height),this._super()}},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(t,e){void 0===e&&(e=(t=t.x).y);var i=this._originPos;i.x===t&&i.y===e||(i.x=t,i.y=e,this._posDirty(!0))},setParent:function(t){var e=this._parent;this._super(t),e!==t&&(e&&e.off(i.EventType.ANCHOR_CHANGED,this._posDirty,this),t&&t.on(i.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}}),o=s.prototype;cc.js.getset(o,"parent",o.getParent,o.setParent),cc.js.getset(o,"position",o.getPosition,o.setPosition),cc.PrivateNode=e.exports=s},{"./CCNode":29,"./renderer/render-flow":228}],31:[function(t,e){cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:!1},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var t=this._children,e=0;e<t.length;++e)t[e].active=!1;this._active=!1,this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(!1),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene},{"./CCNode":29}],32:[function(t,e){var i=t("./platform/js"),r=new(t("./platform/id-generater"))("Scheduler"),n=function(t,e,i,r){this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=r},s=[];n.get=function(t,e,i,r){var o=s.pop();return o?(o.target=t,o.priority=e,o.paused=i,o.markedForDeletion=r):o=new n(t,e,i,r),o},n.put=function(t){s.length<20&&(t.target=null,s.push(t))};var o=function(t,e,i,r){this.list=t,this.entry=e,this.target=i,this.callback=r},a=[];o.get=function(t,e,i,r){var n=a.pop();return n?(n.list=t,n.entry=e,n.target=i,n.callback=r):n=new o(t,e,i,r),n},o.put=function(t){a.length<20&&(t.list=t.entry=t.target=t.callback=null,a.push(t))};var l=function(t,e,i,r,n,s){var o=this;o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=s},c=[];function h(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}l.get=function(t,e,i,r,n,s){var o=c.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=s):o=new l(t,e,i,r,n,s),o},l.put=function(t){c.length<20&&(t.timers=t.target=t.currentTimer=null,c.push(t))};var u=h.prototype;u.initWithCallback=function(t,e,i,r,n,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=s,this._useDelay=this._delay>0,this._repeat=n,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},u.getInterval=function(){return this._interval},u.setInterval=function(t){this._interval=t},u.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},u.getCallback=function(){return this._callback},u.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},u.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var d=[];h.get=function(){return d.pop()||new h},h.put=function(t){d.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,d.push(t))},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=i.createMap(!0),this._hashForTimers=i.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(t){delete this._hashForTimers[t.target._id];for(var e=this._arrayForTimers,i=0,r=e.length;i<r;i++)if(e[i]===t){e.splice(i,1);break}l.put(t)},_removeUpdateFromHash:function(t){var e=t.target._id,i=this._hashForUpdates[e];if(i){for(var r=i.list,s=i.entry,a=0,l=r.length;a<l;a++)if(r[a]===s){r.splice(a,1);break}delete this._hashForUpdates[e],n.put(s),o.put(i)}},_priorityIn:function(t,e,i){for(var r=0;r<t.length;r++)if(i<t[r].priority)return void t.splice(r,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},enableForTarget:function(t){t._id||(t.__instanceId?cc.warnID(1513):t._id=r.getNewId())},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,r,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,r=(i=this._updatesNegList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updates0List).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updatesPosList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updates0List;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updatesPosList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;this._updateHashLocked=!1,this._currentTarget=null},schedule:function(t,e,i,r,n,s){if("function"!=typeof t){var o=t;t=e,e=o}4!==arguments.length&&5!==arguments.length||(s=!!r,r=cc.macro.REPEAT_FOREVER,n=0),cc.assertID(e,1502);var a=e._id;a||(e.__instanceId?(cc.warnID(1513),a=e._id=e.__instanceId):cc.errorID(1510));var c,u,d=this._hashForTimers[a];if(d?d.paused!==s&&cc.warnID(1511):(d=l.get(null,e,0,null,null,s),this._arrayForTimers.push(d),this._hashForTimers[a]=d),null==d.timers)d.timers=[];else for(u=0;u<d.timers.length;++u)if((c=d.timers[u])&&t===c._callback)return cc.logID(1507,c.getInterval(),i),void(c._interval=i);(c=h.get()).initWithCallback(this,t,e,i,r,n),d.timers.push(c),this._currentTarget===d&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,i){var r=t._id;r||(t.__instanceId?(cc.warnID(1513),r=t._id=t.__instanceId):cc.errorID(1510));var s=this._hashForUpdates[r];if(s&&s.entry){if(s.entry.priority===e)return s.entry.markedForDeletion=!1,void(s.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),s.entry.markedForDeletion=!1,void(s.entry.paused=i);this.unscheduleUpdate(t)}var a,l=n.get(t,e,i,!1);0===e?(a=this._updates0List,this._appendIn(a,l)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,l,e)),this._hashForUpdates[r]=o.get(a,l,t,null)},unschedule:function(t,e){if(e&&t){var i=e._id;i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510));var r=this._hashForTimers[i];if(r)for(var n=r.timers,s=0,o=n.length;s<o;s++){var a=n[s];if(t===a._callback)return a!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(s,1),h.put(a),r.timerIndex>=s&&r.timerIndex--,void(0===n.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)))}}},unscheduleUpdate:function(t){if(t){var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}},unscheduleAllForTarget:function(t){if(t){var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));var i=this._hashForTimers[e];if(i){var r=i.timers;r.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var n=0,s=r.length;n<s;n++)h.put(r[n]);r.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,r,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,(r=this._updatesNegList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,(r=this._updates0List[e])&&this.unscheduleUpdate(r.target),s==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,(r=this._updatesPosList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=e._id;i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510));var r=this._hashForTimers[i];if(!r)return!1;if(null==r.timers)return!1;for(var n=r.timers,s=0;s<n.length;++s)if(t===n[s]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,r,n,s=[],o=this._arrayForTimers;for(i=0,r=o.length;i<r;i++)(e=o[i])&&(e.paused=!0,s.push(e.target));if(t<0)for(i=0;i<this._updatesNegList.length;i++)(n=this._updatesNegList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(n=this._updates0List[i])&&(n.paused=!0,s.push(n.target));for(i=0;i<this._updatesPosList.length;i++)(n=this._updatesPosList[i])&&n.priority>=t&&(n.paused=!0,s.push(n.target));return s},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assertID(t,1503);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));var i=this._hashForTimers[e];i&&(i.paused=!0);var r=this._hashForUpdates[e];r&&(r.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));var i=this._hashForTimers[e];i&&(i.paused=!1);var r=this._hashForUpdates[e];r&&(r.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));var i=this._hashForTimers[e];if(i)return i.paused;var r=this._hashForUpdates[e];return!!r&&r.entry.paused}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,e.exports=cc.Scheduler},{"./platform/id-generater":213,"./platform/js":217}],33:[function(t,e){var i=t("./preprocess"),r=t("./fetch"),n=t("./cache"),s=t("./helper"),o=t("./releaseManager"),a=t("./depend-util"),l=t("./load"),c=t("./pipeline"),h=t("./task"),u=t("./request-item"),d=t("./downloader"),p=t("./parser"),f=t("./pack-manager"),_=t("./bundle"),m=t("./builtins"),g=t("./factory"),y=t("./urlTransformer"),v=y.parse,b=y.combine,x=t("./utilities"),T=x.parseParameters,C=x.asyncify,S=t("./shared"),w=S.assets,A=S.files,E=S.parsed,D=S.pipeline,L=S.transformPipeline,I=S.fetchPipeline,P=S.RequestType,M=S.bundles,R=S.BuiltinBundleName;function O(){this._preprocessPipe=i,this._fetchPipe=r,this._loadPipe=l,this.pipeline=D.append(i).append(l),this.fetchPipeline=I.append(i).append(r),this.transformPipeline=L.append(v).append(b),this.bundles=M,this.assets=w,this._files=A,this._parsed=E,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=a,this._releaseManager=o,this.cacheAsset=!0,this.force=!1,this.utils=s,this.downloader=d,this.parser=p,this.builtins=m,this.packManager=f,this.factory=g,this.cacheManager=null,this.presets={default:{priority:0},preload:{maxConcurrency:2,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:8,maxRequestsPerFrame:8,priority:1},bundle:{maxConcurrency:8,maxRequestsPerFrame:8,priority:2},remote:{maxRetryCount:4},script:{maxConcurrency:1024,maxRequestsPerFrame:1024,priority:2}}}O.Pipeline=c,O.Task=h,O.Cache=n,O.RequestItem=u,O.Bundle=_,O.BuiltinBundleName=R,O.prototype={constructor:O,get main(){return M.get(R.MAIN)},get resources(){return M.get(R.RESOURCES)},get internal(){return M.get(R.INTERNAL)},init:function(t){t=t||Object.create(null),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.bundleVers,t.server),this.parser.init(),this.dependUtil.init(),this.generalImportBase=t.importBase,this.generalNativeBase=t.nativeBase},getBundle:function(t){return M.get(t)},removeBundle:function(t){t._destroy(),M.remove(t.name)},loadAny:function(t,e,i,r){var n=T(e,i,r);e=n.options,i=n.onProgress,r=n.onComplete,e.preset=e.preset||"default",t=Array.isArray(t)?t.concat():t;var s=new h({input:t,onProgress:i,onComplete:C(r),options:e});D.async(s)},preloadAny:function(t,e,i,r){var n=T(e,i,r);e=n.options,i=n.onProgress,r=n.onComplete,e.preset=e.preset||"preload",t=Array.isArray(t)?t.concat():t;var s=new h({input:t,onProgress:i,onComplete:C(r),options:e});I.async(s)},postLoadNative:function(t,e,i){if(!(t instanceof cc.Asset))throw new Error("input is not asset");var r=T(e,void 0,i);if(e=r.options,i=r.onComplete,!t._native||t._nativeAsset)return C(i)(null);var n=a.getNativeDep(t._uuid);if(n){if(!M.has(n.bundle)){var s=M.find((function(e){return e.getAssetInfo(t._uuid)}));s&&(n.bundle=s.name)}this.loadAny(n,e,(function(e,r){e?cc.error(e.message,e.stack):t.isValid&&!t._nativeAsset&&(t._nativeAsset=r),i&&i(e)}))}},loadRemote:function(t,e,i){var r=T(e,void 0,i);if(e=r.options,i=r.onComplete,this.assets.has(t))return C(i)(null,this.assets.get(t));e.__isNative__=!0,e.preset=e.preset||"remote",this.loadAny({url:t},e,null,(function(r,n){r?(cc.error(r.message,r.stack),i&&i(r,null)):g.create(t,n,e.ext||cc.path.extname(t),e,(function(t,e){i&&i(t,e)}))}))},loadScript:function(t,e,i){var r=T(e,void 0,i);e=r.options,i=r.onComplete,e.__requestType__=P.URL,e.preset=e.preset||"script",this.loadAny(t,e,i)},loadBundle:function(t,e,i){var r=T(e,void 0,i),n=(e=r.options,i=r.onComplete,cc.path.basename(t));if(this.bundles.has(n))return C(i)(null,this.getBundle(n));e.preset=e.preset||"bundle",e.ext="bundle",this.loadRemote(t,e,i)},releaseAsset:function(t){o.tryRelease(t,!0)},releaseUnusedAssets:function(){w.forEach((function(t){o.tryRelease(t)}))},releaseAll:function(){w.forEach((function(t){o.tryRelease(t,!0)}))},_transform:function(t,e){var i=h.create({input:t,options:e}),r=[];try{for(var n=L.sync(i),s=0,o=n.length;s<o;s++){var a=n[s],l=a.url;a.recycle(),r.push(l)}}catch(c){for(s=0,o=i.output.length;s<o;s++)i.output[s].recycle();cc.error(c.message,c.stack)}return i.recycle(),r.length>1?r:r[0]}},cc.AssetManager=O,cc.assetManager=new O,Object.defineProperty(cc,"resources",{get:function(){return M.get(R.RESOURCES)}}),e.exports=cc.assetManager},{"./builtins":34,"./bundle":35,"./cache":36,"./depend-util":38,"./downloader":45,"./factory":46,"./fetch":47,"./helper":49,"./load":51,"./pack-manager":52,"./parser":53,"./pipeline":54,"./preprocess":55,"./releaseManager":56,"./request-item":57,"./shared":58,"./task":59,"./urlTransformer":60,"./utilities":61}],34:[function(t,e){var i=t("./cache"),r=t("./releaseManager"),n=t("./shared").BuiltinBundleName,s={_assets:new i({material:new i,effect:new i}),_loadBuiltins:function(t,e){var i=t+"s",r=this._assets.get(t);return cc.assetManager.internal.loadDir(i,null,null,(function(t,i){if(t)cc.error(t.message,t.stack);else for(var n=0;n<i.length;n++){var s=i[n];r.add(s.name,s.addRef())}e()}))},init:function(t){var e=this;if(this.clear(),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS||!cc.assetManager.bundles.has(n.INTERNAL))return t&&t();this._loadBuiltins("effect",(function(){e._loadBuiltins("material",t)}))},getBuiltin:function(t,e){return 0===arguments.length?this._assets:1===arguments.length?this._assets.get(t):this._assets.get(t).get(e)},clear:function(){this._assets.forEach((function(t){t.forEach((function(t){r.tryRelease(t,!0)})),t.clear()}))}};e.exports=s},{"./cache":36,"./releaseManager":56,"./shared":58}],35:[function(t,e){var i=t("./config"),r=t("./releaseManager"),n=t("./utilities"),s=n.parseParameters,o=n.parseLoadResArgs,a=t("./shared"),l=a.RequestType,c=a.assets,h=a.bundles;function u(){this._config=new i}u.prototype={constructor:u,get name(){return this._config.name},get deps(){return this._config.deps},get base(){return this._config.base},getInfoWithPath:function(t,e){return this._config.getInfoWithPath(t,e)},getDirWithPath:function(t,e,i){return this._config.getDirWithPath(t,e,i)},getAssetInfo:function(t){return this._config.getAssetInfo(t)},getSceneInfo:function(t){return this._config.getSceneInfo(t)},init:function(t){this._config.init(t),h.add(t.name,this)},load:function(t,e,i,r){var n=o(e,i,r);e=n.type,i=n.onProgress,r=n.onComplete,cc.assetManager.loadAny(t,{__requestType__:l.PATH,type:e,bundle:this.name,__outputAsArray__:Array.isArray(t)},i,r)},preload:function(t,e,i,r){var n=o(e,i,r);e=n.type,i=n.onProgress,r=n.onComplete,cc.assetManager.preloadAny(t,{__requestType__:l.PATH,type:e,bundle:this.name},i,r)},loadDir:function(t,e,i,r){var n=o(e,i,r);e=n.type,i=n.onProgress,r=n.onComplete,cc.assetManager.loadAny(t,{__requestType__:l.DIR,type:e,bundle:this.name,__outputAsArray__:!0},i,r)},preloadDir:function(t,e,i,r){var n=o(e,i,r);e=n.type,i=n.onProgress,r=n.onComplete,cc.assetManager.preloadAny(t,{__requestType__:l.DIR,type:e,bundle:this.name},i,r)},loadScene:function(t,e,i,r){var n=s(e,i,r);e=n.options,i=n.onProgress,r=n.onComplete,e.preset=e.preset||"scene",e.bundle=this.name,cc.assetManager.loadAny({scene:t},e,i,(function(t,e){if(t)cc.error(t.message,t.stack),r&&r(t);else if(e instanceof cc.SceneAsset){var i=e.scene;i._id=e._uuid,i._name=e._name,r&&r(null,e)}else r&&r(new Error("The asset "+e._uuid+" is not a scene"))}))},preloadScene:function(t,e,i,r){var n=s(e,i,r);e=n.options,i=n.onProgress,r=n.onComplete,e.bundle=this.name,cc.assetManager.preloadAny({scene:t},e,i,(function(e){e&&cc.errorID(1210,t,e.message),r&&r(e)}))},get:function(t,e){var i=this.getInfoWithPath(t,e);return c.get(i&&i.uuid)},release:function(t,e){r.tryRelease(this.get(t,e),!0)},releaseUnusedAssets:function(){var t=this;c.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&r.tryRelease(e)}))},releaseAll:function(){var t=this;c.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&r.tryRelease(e,!0)}))},_destroy:function(){this._config.destroy()}},e.exports=u},{"./config":37,"./releaseManager":56,"./shared":58,"./utilities":61}],36:[function(t,e){var i=t("../platform/js");function r(t){t?(this._map=t,this._count=Object.keys(t).length):(this._map=i.createMap(!0),this._count=0)}r.prototype={constructor:r,add:function(t,e){return t in this._map||this._count++,this._map[t]=e},get:function(t){return this._map[t]},has:function(t){return t in this._map},remove:function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},clear:function(){0!==this._count&&(this._map=i.createMap(!0),this._count=0)},forEach:function(t){for(var e in this._map)t(this._map[e],e)},find:function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},get count(){return this._count},destroy:function(){this._map=null}},e.exports=r},{"../platform/js":217}],37:[function(t,e){var i=t("../platform/js"),r=t("./cache"),n=t("./helper").normalize,s=t("./utilities").processOptions;function o(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new r,this.scenes=new r,this.paths=new r}o.prototype={constructor:o,init:function(t){s(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect)},_initUuid:function(t){if(t){this.assetInfos.clear();for(var e=0,i=t.length;e<i;e++){var r=t[e];this.assetInfos.add(r,{uuid:r})}}},_initPath:function(t){if(t){var e=this.paths;for(var r in e.clear(),t){var n=t[r],s=n[0],o=n[1],a=3===n.length,l=this.assetInfos.get(r);l.path=s,l.ctor=i._getClassById(o),e.has(s)?a?e.get(s).push(l):e.get(s).unshift(l):e.add(s,[l])}}},_initScene:function(t){if(t){var e=this.scenes;e.clear();var i=this.assetInfos;for(var r in t){var n=t[r],s=i.get(n);s.url=r,e.add(r,s)}}},_initPackage:function(t){if(t){var e=this.assetInfos;for(var i in t){var r=t[i],n={uuid:i,packs:r,ext:".json"};e.add(i,n);for(var s=0,o=r.length;s<o;s++){var a=r[s],l=e.get(a),c=l.packs;c?1===o?c.unshift(n):c.push(n):l.packs=[n]}}}},_initVersion:function(t){if(t){var e=this.assetInfos,i=t.import;if(i)for(var r=0,n=i.length;r<n;r+=2){var s=i[r];e.get(s).ver=i[r+1]}if(i=t.native)for(r=0,n=i.length;r<n;r+=2)s=i[r],e.get(s).nativeVer=i[r+1]}},_initRedirect:function(t){if(t)for(var e=this.assetInfos,i=0,r=t.length;i<r;i+=2){var n=t[i];e.get(n).redirect=t[i+1]}},getInfoWithPath:function(t,e){if(!t)return null;t=n(t);var r=this.paths.get(t);if(r){if(!e)return r[0];for(var s=0,o=r.length;s<o;s++){var a=r[s];if(i.isChildClassOf(a.ctor,e))return a}}return null},getDirWithPath:function(t,e,r){"/"===(t=n(t))[t.length-1]&&(t=t.slice(0,-1));var s=r||[];return this.paths.forEach((function(r,n){if(n.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(n,t)||!t)for(var o=0,a=r.length;o<a;o++){var l=r[o];e&&!i.isChildClassOf(l.ctor,e)||s.push(l)}})),s},getAssetInfo:function(t){return this.assetInfos.get(t)},getSceneInfo:function(t){return t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,i){return i.endsWith(t)}))},destroy:function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()}},e.exports=o},{"../platform/js":217,"./cache":36,"./helper":49,"./utilities":61}],38:[function(t,e){var i=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=r(void 0);if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var o=n?Object.getOwnPropertyDescriptor(t,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=t[s]}return i.default=t,e&&e.set(t,i),i}(t("../platform/deserialize-compiled"));function r(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(r=function(t){return t?i:e})(t)}var n=t("./cache"),s=t("./deserialize"),o=t("./shared"),a=o.files,l=o.parsed,c={_depends:new n,init:function(){this._depends.clear()},getNativeDep:function(t){var e=this._depends.get(t);return e?e.nativeDep&&Object.assign({},e.nativeDep):null},getDeps:function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},getDepsRecursively:function(t){var e=Object.create(null),i=[];return this._descend(t,e,i),i},_descend:function(t,e,i){for(var r=this.getDeps(t),n=0;n<r.length;n++){var s=r[n];e[s]||(e[s]=!0,i.push(s),this._descend(s,e,i))}},remove:function(t){this._depends.remove(t)},parse:function(t,e){var r=null;if(Array.isArray(e)||e.__type__){if(r=this._depends.get(t))return r;if(Array.isArray(e)&&!(0,i.hasNativeDep)(e))r={deps:this._parseDepsFromJson(e)};else try{var n=s(e);(r=this._parseDepsFromAsset(n)).nativeDep&&(r.nativeDep.uuid=t),l.add(t+"@import",n)}catch(o){a.remove(t+"@import"),r={deps:[]}}}else{if((r=this._depends.get(t))&&r.parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},_parseDepsFromAsset:function(t){for(var e={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:t.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:t.constructor.preventDeferredLoadDependents},i=t.__depends__,r=0,n=i.length;r<n;r++){var s=i[r].uuid;e.deps.push(s)}return t.__nativeDepend__&&(e.nativeDep=t._nativeDep),e},_parseDepsFromJson:function(t){var e=(0,i.getDependUuidList)(t);return e.forEach((function(t,i){return e[i]=cc.assetManager.utils.decodeUuid(t)})),e}};e.exports=c},{"../platform/deserialize-compiled":211,"./cache":36,"./deserialize":40,"./shared":58}],39:[function(t){var e=t("../platform/js");t("../CCDirector");var i=t("./utilities"),r=t("./depend-util"),n=t("./releaseManager"),s=t("./downloader"),o=t("./factory"),a=t("./helper"),l=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm"],c=[".mp3",".ogg",".wav",".m4a"];function h(){return!0}var u={transformURL:function(t){var e=a.getUuidFromURL(t);if(!e)return t;var i=cc.assetManager.bundles.find((function(t){return!!t.getAssetInfo(e)}));if(!i)return t;var r,n=i.getAssetInfo(e);if(!(r=t.startsWith(i.base+i._config.nativeBase)?n.nativeVer||"":n.ver||"")||-1!==t.indexOf(r))return t;var s=!1;if(".ttf"===cc.path.extname(t)&&(s=!0),s){var o=cc.path.dirname(t),l=cc.path.basename(t);t=o+"."+r+"/"+l}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/,(function(t){return t+"."+r}));return t}},d={onProgress:null,_autoReleaseSetting:Object.create(null),get _cache(){return cc.assetManager.assets._map},load:function(t,e,i){void 0===i&&void 0!==e&&(i=e,e=null),t=Array.isArray(t)?t:[t];for(var r=0;r<t.length;r++){var n=t[r];"string"==typeof n?t[r]={url:n,__isNative__:!0}:(n.type&&(n.ext="."+n.type,n.type=void 0),n.url&&(n.__isNative__=!0))}var s=[],a=[];cc.assetManager.loadAny(t,null,(function(t,i,r){r.content&&(l.includes(r.ext)?s.push(r.content):c.includes(r.ext)&&a.push(r.content)),e&&e(t,i,r)}),(function(e,r){var n=null;if(!e){r=Array.isArray(r)?r:[r];for(var l=0;l<r.length;l++){var c=r[l];if(!(c instanceof cc.Asset)){var u=c,d=t[l].url;s.includes(u)?o.create(d,c,".png",null,(function(t,e){u=r[l]=e})):a.includes(u)&&o.create(d,c,".mp3",null,(function(t,e){u=r[l]=e})),cc.assetManager.assets.add(d,u)}}if(r.length>1){var p=Object.create(null);r.forEach((function(t){p[t._uuid]=t})),n={isCompleted:h,_map:p}}else n=r[0]}i&&i(e,n)}))},getXMLHttpRequest:function(){return new XMLHttpRequest},_parseLoadResArgs:i.parseLoadResArgs,getItem:function(t){return cc.assetManager.assets.has(t)?{content:cc.assetManager.assets.get(t)}:null},loadRes:function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=(e=n.type,n.onProgress),o=n.onComplete,a=cc.path.extname(t);a&&(t=t.slice(0,-a.length)),cc.resources.load(t,e,s,o)},loadResArray:function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=(e=n.type,n.onProgress),o=n.onComplete;t.forEach((function(e,i){var r=cc.path.extname(e);r&&(t[i]=e.slice(0,-r.length))})),cc.resources.load(t,e,s,o)},loadResDir:function(t,e,i,r){var n=this._parseLoadResArgs(e,i,r),s=(e=n.type,n.onProgress),o=n.onComplete;cc.resources.loadDir(t,e,s,(function(i,r){var n=[];i||(n=cc.resources.getDirWithPath(t,e).map((function(t){return t.path}))),o&&o(i,r,n)}))},getRes:function(t,e){return cc.assetManager.assets.has(t)?cc.assetManager.assets.get(t):cc.resources.get(t,e)},getResCount:function(){return cc.assetManager.assets.count},getDependsRecursively:function(t){return t?r.getDepsRecursively("string"==typeof t?t:t._uuid).concat([t._uuid]):[]},get assetLoader(){},get md5Pipe(){return u},get downloader(){return cc.assetManager.downloader},get loader(){return cc.assetManager.parser},addDownloadHandlers:function(t){var e=Object.create(null);for(var i in t){var r=t[i];e["."+i]=function(t,e,i){r({url:t},i)}}cc.assetManager.downloader.register(e)},addLoadHandlers:function(t){var e=Object.create(null);for(var i in t){var r=t[i];e["."+i]=function(t,e,i){r({content:t},i)}}cc.assetManager.parser.register(e)},flowInDeps:function(){},release:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];"string"==typeof i&&(i=cc.assetManager.assets.get(i)),cc.assetManager.builtins._assets.find((function(t){return t.find((function(t){return t===i}))}))||cc.assetManager.releaseAsset(i)}else if(t){if("string"==typeof t&&(t=cc.assetManager.assets.get(t)),cc.assetManager.builtins._assets.find((function(e){return e.find((function(e){return e===t}))})))return;cc.assetManager.releaseAsset(t)}},releaseAsset:function(t){cc.assetManager.releaseAsset(t)},releaseRes:function(t,e){cc.resources.release(t,e)},releaseResDir:function(){},releaseAll:function(){cc.assetManager.releaseAll(),cc.assetManager.assets.clear()},removeItem:function(t){cc.assetManager.assets.remove(t)},setAutoRelease:function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},setAutoReleaseRecursively:function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var i=r.getDepsRecursively(t),n=0;n<i.length;n++){var s=i[n];this._autoReleaseSetting[s]=e}},isAutoRelease:function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]}};s.loadSubpackage=function(t,e){cc.assetManager.loadBundle(t,null,e)};var p={init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,cc.assetManager.init(t),t.rawAssets&&(new cc.AssetManager.Bundle).init({name:cc.AssetManager.BuiltinBundleName.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets)})},loadAsset:function(t,e){cc.assetManager.loadAny(t,e)},getLibUrlNoExt:function(){},queryAssetInfo:function(){}};cc.url={normalize:function(t){return cc.warnID(1400,"cc.url.normalize","cc.assetManager.utils.normalize"),cc.assetManager.utils.normalize(t)},raw:function(t){return cc.warnID(1400,"cc.url.raw","cc.resources.load"),t.startsWith("resources/")?cc.assetManager._transform({path:cc.path.changeExtname(t.substr(10)),bundle:cc.AssetManager.BuiltinBundleName.RESOURCES,__isNative__:!0,ext:cc.path.extname(t)}):""}},Object.defineProperties(cc,{loader:{get:function(){return d}},AssetLibrary:{get:function(){return p}},LoadingItems:{get:function(){return cc.warnID(1400,"cc.LoadingItems","cc.AssetManager.Task"),cc.AssetManager.Task}},Pipeline:{get:function(){return cc.warnID(1400,"cc.Pipeline","cc.AssetManager.Pipeline"),cc.AssetManager.Pipeline}}}),e.obsolete(cc,"cc.RawAsset","cc.Asset"),e.obsolete(cc.Asset.prototype,"cc.Asset.url","nativeUrl"),Object.defineProperties(cc.macro,{DOWNLOAD_MAX_CONCURRENT:{get:function(){return cc.assetManager.downloader.maxConcurrency},set:function(t){cc.assetManager.downloader.maxConcurrency=t}}}),Object.assign(cc.director,{_getSceneUuid:function(t){cc.assetManager.main.getSceneInfo(t)}}),Object.defineProperties(cc.game,{_sceneInfos:{get:function(){var t=[];return cc.assetManager.main._config.scenes.forEach((function(e){t.push(e)})),t}}});var f=i.parseParameters;i.parseParameters=function(t,e,i){var r=f(t,e,i);return r.onProgress=r.onProgress||d.onProgress,r};var _=n._autoRelease;n._autoRelease=function(){_.apply(this,arguments);for(var t=d._autoReleaseSetting,e=Object.keys(t),i=0;i<e.length;i++){var r=e[i];if(!0===t[r]){var s=cc.assetManager.assets.get(r);s&&n.tryRelease(s)}}}},{"../CCDirector":27,"../platform/js":217,"./depend-util":38,"./downloader":45,"./factory":46,"./helper":49,"./releaseManager":56,"./utilities":61}],40:[function(t,e){var i=t("./helper");t("../platform/deserialize"),e.exports=function(t,e){var r;r=cc._MissingScript.safeFindClass;var n,s=null,o=(s=cc.deserialize.Details.pool).get();try{n=cc.deserialize(t,o,{classFinder:r,customEnv:e})}catch(f){throw s.put(o),f}for(var a=o.uuidList,l=o.uuidObjList,c=o.uuidPropList,h=[],u=0;u<a.length;u++){var d=a[u];h[u]={uuid:i.decodeUuid(d),owner:l[u],prop:c[u]}}return n.__depends__=h,n._native&&(n.__nativeDepend__=!0),s.put(o),n}},{"../platform/deserialize":212,"../platform/deserialize-compiled":211,"../platform/deserialize-editor":void 0,"./helper":49}],41:[function(t,e){var i=cc.sys.__audioSupport,r=t("./utilities").parseParameters;e.exports=function(t,e,n){var s=r(e,void 0,n),o=(e=s.options,n=s.onComplete,document.createElement("audio"));o.src=t;var a=function(){clearTimeout(l),o.removeEventListener("canplaythrough",c,!1),o.removeEventListener("error",h,!1),i.USE_LOADER_EVENT&&o.removeEventListener(i.USE_LOADER_EVENT,c,!1)},l=setTimeout((function(){0===o.readyState?h():c()}),8e3),c=function(){a(),n&&n(null,o)},h=function(){a();var e="load audio failure - "+t;cc.log(e),n&&n(new Error(e))};return o.addEventListener("canplaythrough",c,!1),o.addEventListener("error",h,!1),i.USE_LOADER_EVENT&&o.addEventListener(i.USE_LOADER_EVENT,c,!1),o}},{"./utilities":61}],42:[function(t,e){var i=t("./utilities").parseParameters;e.exports=function(t,e,r){var n=i(e,void 0,r),s=(e=n.options,r=n.onComplete,new Image);function o(){s.removeEventListener("load",o),s.removeEventListener("error",a),r&&r(null,s)}function a(){s.removeEventListener("load",o),s.removeEventListener("error",a),r&&r(new Error(cc.debug.getError(4930,t)))}return"file:"!==window.location.protocol&&(s.crossOrigin="anonymous"),s.addEventListener("load",o),s.addEventListener("error",a),s.src=t,s}},{"./utilities":61}],43:[function(t,e){var i=t("./utilities").parseParameters;e.exports=function(t,e,r,n){var s=i(e,r,n),o=(e=s.options,r=s.onProgress,n=s.onComplete,new XMLHttpRequest),a="download failed: "+t+", status: ";if(o.open("GET",t,!0),void 0!==e.responseType&&(o.responseType=e.responseType),void 0!==e.withCredentials&&(o.withCredentials=e.withCredentials),void 0!==e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),void 0!==e.timeout&&(o.timeout=e.timeout),e.header)for(var l in e.header)o.setRequestHeader(l,e.header[l]);return o.onload=function(){200===o.status||0===o.status?n&&n(null,o.response):n&&n(new Error(a+o.status+"(no response)"))},r&&(o.onprogress=function(t){t.lengthComputable&&r(t.loaded,t.total)}),o.onerror=function(){n&&n(new Error(a+o.status+"(error)"))},o.ontimeout=function(){n&&n(new Error(a+o.status+"(time out)"))},o.onabort=function(){n&&n(new Error(a+o.status+"(abort)"))},o.send(null),o}},{"./utilities":61}],44:[function(t,e){var i=t("./utilities").parseParameters,r={};e.exports=function(t,e,n){var s=i(e,void 0,n);if(e=s.options,n=s.onComplete,r[t])return n&&n(null);var o=document,a=document.createElement("script");function l(){a.parentNode.removeChild(a),a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),r[t]=!0,n&&n(null)}function c(){a.parentNode.removeChild(a),a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1),n&&n(new Error(cc.debug.getError(4928,t)))}"file:"!==window.location.protocol&&(a.crossOrigin="anonymous"),a.async=e.async,a.src=t,a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),o.body.appendChild(a)}},{"./utilities":61}],45:[function(t,e){var i=t("../platform/js"),r=t("../CCDebug"),n=t("./font-loader").loadFont,s=t("../platform/utils").callInNextTick,o=t("./download-dom-image"),a=t("./download-dom-audio"),l=t("./download-file"),c=t("./download-script.js"),h=t("./cache"),u=t("./shared").files,d=t("../platform/CCSys"),p=d.__audioSupport,f=d.capabilities,_=t("./utilities"),m=_.urlAppendTimestamp,g=_.retry,y=/^(?:\w+:\/\/|\.+\/).+/,v=function(t,e,i){e.audioLoadMode!==cc.AudioClip.LoadMode.DOM_AUDIO?C(t,e,i):a(t,e,i)},b=(v=0===(p.format||[]).length?function(t,e,i){i(new Error(r.getError(4927)))}:p.WEB_AUDIO?v:a,function(){(f.imageBitmap&&cc.macro.ALLOW_IMAGE_BITMAP?x:o).apply(this,arguments)}),x=function(t,e,i){e.responseType="blob",l(t,e,e.onFileProgress,i)},T=function(t,e,i){e.responseType="json",l(t,e,e.onFileProgress,(function(t,e){if(!t&&"string"==typeof e)try{e=JSON.parse(e)}catch(r){t=r}i&&i(t,e)}))},C=function(t,e,i){e.responseType="arraybuffer",l(t,e,e.onFileProgress,i)},S=function(t,e,i){e.responseType="text",l(t,e,e.onFileProgress,i)},w=function(t,e,i){i(null,t)},A=new h,E=[],D=!1,L=0,I=0,P=-1,M=!1,R=function(){var t=Date.now(),e=cc.director._deltaTime>B._maxInterval?B._maxInterval:cc.director._deltaTime;t-P>1e3*e&&(I=0,P=t)},O=function t(e,i){for(M=!1,R();E.length>0&&L<e&&I<i;){D&&(E.sort((function(t,e){return t.priority-e.priority})),D=!1);var r=E.pop();if(!r)break;L++,I++,r.invoke()}E.length>0&&L<e&&(s(t,e,i),M=!0)},B={_remoteServerAddress:"",_maxInterval:1/30,get remoteServerAddress(){return this._remoteServerAddress},maxConcurrency:6,maxRequestsPerFrame:6,maxRetryCount:3,appendTimeStamp:!1,limited:!0,retryInterval:2e3,bundleVers:null,downloadDomImage:o,downloadDomAudio:a,downloadFile:l,downloadScript:c,init:function(t,e){A.clear(),E.length=0,this._remoteServerAddress=e||"",this.bundleVers=t||Object.create(null)},register:function(t,e){"object"==typeof t?i.mixin(N,t):N[t]=e},download:function(t,e,i,r,n){var o,a,l=N[i]||N.default,c=this;if(o=u.get(t))n(null,o);else if(a=A.get(t)){a.push(n);for(var h=0,d=E.length;h<d;h++){var p=E[h];if(p.id===t){var f=r.priority||0;return void(p.priority<f&&(p.priority=f,D=!0))}}}else{var _=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,y=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,v=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame;g((function(i,o){if(0===i&&A.add(t,[n]),!c.limited)return l(m(e),r,o);function a(){l(m(e),r,(function(){L--,!M&&E.length>0&&(s(O,y,v),M=!0),o.apply(this,arguments)}))}R(),L<y&&I<v?(a(),L++,I++):(E.push({id:t,priority:r.priority||0,invoke:a}),D=!0,!M&&L<y&&(s(O,y,v),M=!0))}),_,this.retryInterval,(function(e,i){e||u.add(t,i);for(var r=A.remove(t),n=0,s=r.length;n<s;n++)r[n](e,i)}))}}},N={".png":b,".jpg":b,".bmp":b,".jpeg":b,".gif":b,".ico":b,".tiff":b,".webp":b,".image":b,".pvr":C,".pkm":C,".astc":C,".mp3":v,".ogg":v,".wav":v,".m4a":v,".txt":S,".xml":S,".vsh":S,".fsh":S,".atlas":S,".tmx":S,".tsx":S,".json":T,".ExportJson":T,".plist":S,".fnt":S,".font":n,".eot":n,".ttf":n,".woff":n,".svg":n,".ttc":n,".mp4":w,".avi":w,".mov":w,".mpg":w,".mpeg":w,".rm":w,".rmvb":w,".binary":C,".bin":C,".dbbin":C,".skel":C,".js":c,bundle:function(t,e,i){var r=cc.path.basename(t),n=t;y.test(n)||(n="assets/"+r);var s=e.version||B.bundleVers[r],o=0,a=null,l=null;T(n+"/config."+(s?s+".":"")+"json",e,(function(t,e){t&&(l=t),(a=e)&&(a.base=n+"/"),2==++o&&i(l,a)})),c(n+"/index."+(s?s+".":"")+"js",e,(function(t){t&&(l=t),2==++o&&i(l,a)}))},default:S};B._downloaders=N,e.exports=B},{"../CCDebug":26,"../platform/CCSys":205,"../platform/js":217,"../platform/utils":220,"./cache":36,"./download-dom-audio":41,"./download-dom-image":42,"./download-file":43,"./download-script.js":44,"./font-loader":48,"./shared":58,"./utilities":61}],46:[function(t,e){var i=t("./bundle"),r=t("./cache"),n=t("./shared"),s=n.assets,o=n.bundles,a=new r;function l(t,e,i,r){var n=null,s=null;try{(n=new cc.Texture2D)._nativeUrl=t,n._nativeAsset=e}catch(o){s=o}r&&r(s,n)}function c(t,e,i,r){var n=new cc.AudioClip;n._nativeUrl=t,n._nativeAsset=e,n.duration=e.duration,r&&r(null,n)}function h(t,e,i,r){var n=new cc.VideoClip;n._nativeUrl=t,n._nativeAsset=e,r&&r(null,n)}function u(t,e,i,r){var n=new cc.JsonAsset;n.json=e,r&&r(null,n)}function d(t,e,i,r){var n=new cc.TextAsset;n.text=e,r&&r(null,n)}function p(t,e,i,r){var n=new cc.TTFFont;n._nativeUrl=t,n._nativeAsset=e,r&&r(null,n)}function f(t,e,i,r){var n=new cc.BufferAsset;n._nativeUrl=t,n._nativeAsset=e,r&&r(null,n)}var _={register:function(t,e){"object"==typeof t?cc.js.mixin(m,t):m[t]=e},create:function(t,e,i,r,n){var o,l,c=m[i]||m.default;(o=s.get(t))?n(null,o):(l=a.get(t))?l.push(n):(a.add(t,[n]),c(t,e,r,(function(e,i){!e&&i instanceof cc.Asset&&(i._uuid=t,s.add(t,i));for(var r=a.remove(t),n=0,o=r.length;n<o;n++)r[n](e,i)})))}},m={".png":l,".jpg":l,".bmp":l,".jpeg":l,".gif":l,".ico":l,".tiff":l,".webp":l,".image":l,".pvr":l,".pkm":l,".astc":l,".mp3":c,".ogg":c,".wav":c,".m4a":c,".mp4":h,".avi":h,".mov":h,".mpg":h,".mpeg":h,".rm":h,".rmvb":h,".txt":d,".xml":d,".vsh":d,".fsh":d,".atlas":d,".tmx":d,".tsx":d,".fnt":d,".json":u,".ExportJson":u,".font":p,".eot":p,".ttf":p,".woff":p,".svg":p,".ttc":p,".binary":f,".bin":f,".dbbin":f,".skel":f,bundle:function(t,e,r,n){var s=o.get(e.name);s||(s=new i,e.base=e.base||t+"/",s.init(e)),n&&n(null,s)},default:function(t,e,i,r){var n=new cc.Asset;n._nativeUrl=t,n._nativeAsset=e,r&&r(null,n)}};e.exports=_},{"./bundle":35,"./cache":36,"./shared":58}],47:[function(t,e){var i=t("./pack-manager"),r=t("./task"),n=t("./utilities"),s=n.getDepends,o=n.clear,a=n.forEach,l=t("./shared"),c=l.assets,h=l.fetchPipeline;function u(t){for(var e=t.output,i=0,r=e.length;i<r;i++)e[i].content&&e[i].content.decRef(!1)}function d(t,e,i,r,n,o,a){var l=e.options.__exclude__,c=e.progress;t.content=i,t.file=r,e.output.push(t),n&&(l[t.uuid]=!0,s(t.uuid,r||i,l,o,!0,!1,t.config),c.total=a+o.length),c.canInvoke&&e.dispatch("progress",++c.finish,c.total,t)}e.exports=function(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var s=t.options,l=[],p=t.progress,f=p.total;s.__exclude__=s.__exclude__||Object.create(null),t.output=[],a(t.input,(function(r,s){if(!r.isNative&&c.has(r.uuid)){var o=c.get(r.uuid);return o.addRef(),d(r,t,o,null,o.__asyncLoadAssets__,l,f),s()}i.load(r,t.options,(function(i,o){i?t.isFinish||(!cc.assetManager.force||n?(cc.error(i.message,i.stack),p.canInvoke=!1,e(i)):d(r,t,null,null,!1,l,f)):t.isFinish||d(r,t,null,o,!r.isNative,l,f),s()}))}),(function(){if(t.isFinish)return o(t,!0),t.dispatch("error");if(l.length>0){var i=r.create({name:t.name+" dependencies",input:l,progress:p,options:s,onProgress:t.onProgress,onError:r.prototype.recycle,onComplete:function(r){r||(t.output.push.apply(t.output,this.output),i.recycle()),n&&u(t),e(r)}});h.async(i)}else n&&u(t),e()}))}},{"./pack-manager":52,"./shared":58,"./task":59,"./utilities":61}],48:[function(t,e){var i,r=t("../utils/text-utils"),n=null,s="BES bswy:->@123丁ぁᄁ",o=Object.create(null),a=-1,l=[],c=3e3,h=(i=void 0,function(){if(void 0===i)if(window.FontFace){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);i=t?parseInt(t[1],10)>42:!e}else i=!1;return i});function u(){for(var t=!0,e=Date.now(),i=l.length-1;i>=0;i--){var o=l[i],h=o.fontFamilyName;if(e-o.startTime>c)cc.warnID(4933,h),o.onComplete(null,h),l.splice(i,1);else{var u=o.refWidth,d="40px "+h;n.font=d,u!==r.safeMeasureText(n,s,d)?(l.splice(i,1),o.onComplete(null,h)):t=!1}}t&&(clearInterval(a),a=-1)}var d={loadFont:function(t,e,i){var p=d._getFontFamily(t);if(o[p])return i(null,p);if(!n){var f=document.createElement("canvas");f.width=100,f.height=100,n=f.getContext("2d")}var _="40px "+p;n.font=_;var m=r.safeMeasureText(n,s,_),g=document.createElement("style");g.type="text/css";var y="";isNaN(p-0)?y+="@font-face { font-family:"+p+"; src:":y+="@font-face { font-family:'"+p+"'; src:",y+="url('"+t+"');",g.textContent=y+"}",document.body.appendChild(g);var v,b,x,T,C,S,w=document.createElement("div"),A=w.style;if(A.fontFamily=p,w.innerHTML=".",A.position="absolute",A.left="-100px",A.top="-100px",document.body.appendChild(w),h())v=Date.now(),b=p,x=i,T=new Promise((function(t,e){!function i(){Date.now()-v>=c?e():document.fonts.load("40px "+b).then((function(e){e.length>=1?t():setTimeout(i,100)}),(function(){e()}))}()})),C=null,S=new Promise((function(t,e){C=setTimeout(e,c)})),Promise.race([S,T]).then((function(){C&&(clearTimeout(C),C=null),x(null,b)}),(function(){cc.warnID(4933,b),x(null,b)}));else{var E={fontFamilyName:p,refWidth:m,onComplete:i,startTime:Date.now()};l.push(E),-1===a&&(a=setInterval(u,100))}o[p]=g},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,r=t.lastIndexOf("/");return-1!==(i=-1===r?t.substring(0,e)+"_LABEL":t.substring(r+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}};e.exports=d},{"../utils/text-utils":278}],49:[function(t,e){var i,r=t("./shared").bundles,n={decodeUuid:t("../utils/decode-uuid"),getUuidFromURL:(i=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/,function(t){var e=t.match(i);return e?e[1]:""}),getUrlWithUuid:function(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.ext=e.nativeExt;var i=r.find((function(e){return e.getAssetInfo(t)}));return i&&(e.bundle=i.name),cc.assetManager._transform(t,e)},isScene:function(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)},normalize:function(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}};e.exports=n},{"../utils/decode-uuid":266,"./shared":58}],50:[function(t){t("./deprecated"),t("./CCAssetManager")},{"./CCAssetManager":33,"./deprecated":39}],51:[function(t,e){var i=t("./pack-manager"),r=t("./pipeline"),n=t("./parser"),s=t("./utilities"),o=s.getDepends,a=s.cache,l=s.gatherAsset,c=s.setProperties,h=s.forEach,u=s.clear,d=s.checkCircleReference,p=t("./shared"),f=p.assets,_=p.files,m=p.parsed,g=p.pipeline,y=t("./task"),v=new r("loadOneAsset",[function(t,e){var r=t.output=t.input,n=r.options,s=r.isNative,o=r.uuid,a=r.file,l=n.reload;if(a||!l&&!s&&f.has(o))return e();i.load(r,t.options,(function(t,i){r.file=i,e(t)}))},function(t,e){var i=t.output=t.input,r=t.progress,s=t.options.__exclude__,o=i.id,a=i.file,l=i.options;if(i.isNative)n.parse(o,a,i.ext,l,(function(n,s){if(n)return e(n);i.content=s,r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),_.remove(o),m.remove(o),e()}));else{var c=i.uuid;if(c in s){var h=s[c],u=h.finish,p=h.content,g=h.err,y=h.callbacks;r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),u||d(c,c,s)?(p&&p.addRef&&p.addRef(),i.content=p,e(g)):y.push({done:e,item:i})}else if(!l.reload&&f.has(c)){var v=f.get(c);l.__asyncLoadAssets__||!v.__asyncLoadAssets__?(i.content=v.addRef(),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),e()):x(t,v,e,!1)}else n.parse(o,a,"import",l,(function(i,r){if(i)return e(i);r._uuid=c,x(t,r,e,!0)}))}}]);function x(t,e,i,r){var n=t.input,s=t.progress,l=n.uuid,h=n.id,u=n.options,d=n.config,p=u.__asyncLoadAssets__,f=u.cacheAsset,v=[];e.addRef&&e.addRef(),o(l,e,Object.create(null),v,!1,p,d),s.canInvoke&&t.dispatch("progress",++s.finish,s.total+=v.length,n);var x=t.options.__exclude__[l]={content:e,finish:!1,callbacks:[{done:i,item:n}]},T=y.create({input:v,options:t.options,onProgress:t.onProgress,onError:y.prototype.recycle,progress:s,onComplete:function(t){if(e.decRef&&e.decRef(!1),e.__asyncLoadAssets__=p,x.finish=!0,x.err=t,!t){for(var i=Array.isArray(T.output)?T.output:[T.output],n=Object.create(null),s=0,o=i.length;s<o;s++){var u=i[s];u&&(n[u instanceof cc.Asset?u._uuid+"@import":l+"@native"]=u)}if(r){if(!c(l,e,n)&&!e.__onLoadInvoked__)try{e.onLoad&&e.onLoad(),e.__onLoadInvoked__=!0}catch(b){cc.error(b.message,b.stack)}_.remove(h),m.remove(h),a(l,e,void 0!==f?f:cc.assetManager.cacheAsset)}else if(e.__nativeDepend__&&!e._nativeAsset&&!c(l,e,n)&&!e.__onLoadInvoked__)try{e.onLoad&&e.onLoad(),e.__onLoadInvoked__=!0}catch(b){cc.error(b.message,b.stack)}T.recycle()}for(var d=x.callbacks,g=0,y=d.length;g<y;g++){var v=d[g];e.addRef&&e.addRef(),v.item.content=e,v.done(t)}d.length=0}});g.async(T)}e.exports=function(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var r=t.options,n=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],h(t.input,(function(s,o){var a=y.create({input:s,onProgress:t.onProgress,options:r,progress:n,onComplete:function(r,s){r&&!t.isFinish&&(!cc.assetManager.force||i?(cc.error(r.message,r.stack),n.canInvoke=!1,e(r)):n.canInvoke&&t.dispatch("progress",++n.finish,n.total,s)),t.output.push(s),a.recycle(),o()}});v.async(a)}),(function(){if(r.__exclude__=null,t.isFinish)return u(t,!0),t.dispatch("error");l(t),u(t,!0),e()}))}},{"./pack-manager":52,"./parser":53,"./pipeline":54,"./shared":58,"./task":59,"./utilities":61}],52:[function(t,e){var i=t("../platform/deserialize-compiled"),r=t("./downloader"),n=t("./cache"),s=t("../platform/js"),o=t("./shared").files,a=new n;function l(t){return a.has(t.uuid)}var c={unpackJson:function(t,e,r,n){var o=s.createMap(!0),a=null;if(Array.isArray(e)){(e=(0,i.unpackJSONs)(e)).length!==t.length&&cc.errorID(4915);for(var l=0;l<t.length;l++)o[t[l]+"@import"]=e[l]}else{var c=s._getClassId(cc.Texture2D);if(e.type===c){if(e.data){var h=e.data.split("|");h.length!==t.length&&cc.errorID(4915);for(var u=0;u<t.length;u++)o[t[u]+"@import"]=(0,i.packCustomObjData)(c,h[u],!0)}}else a=new Error("unmatched type pack!"),o=null}n&&n(a,o)},init:function(){a.clear()},register:function(t,e){"object"==typeof t?s.mixin(h,t):h[t]=e},unpack:function(t,e,i,r,n){e?(0,h[i])(t,e,r,n):n&&n(new Error("package data is wrong!"))},load:function(t,e,i){if(t.isNative||!t.info||!t.info.packs)return r.download(t.id,t.url,t.ext,t.options,i);if(o.has(t.id))return i(null,o.get(t.id));var n=t.info.packs,s=n.find(l);if(s)return a.get(s.uuid).push({onComplete:i,id:t.id});s=n[0],a.add(s.uuid,[{onComplete:i,id:t.id}]);var h=cc.assetManager._transform(s.uuid,{ext:s.ext,bundle:t.config.name});r.download(s.uuid,h,s.ext,t.options,(function(e,i){o.remove(s.uuid),e&&cc.error(e.message,e.stack),c.unpack(s.packs,i,s.ext,t.options,(function(t,e){if(t)t.message="unpack "+h+" failed! details: "+t.message;else for(var i in e)o.add(i,e[i]);for(var r=a.remove(s.uuid),n=0,l=r.length;n<l;n++){var c=r[n];if(t)c.onComplete(t);else{var u=e[c.id];u?c.onComplete(null,u):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}},h={".json":c.unpackJson};e.exports=c},{"../platform/deserialize-compiled":211,"../platform/js":217,"./cache":36,"./downloader":45,"./shared":58}],53:[function(t,e){var i=t("../platform/CCSAXParser").plistParser,r=t("../platform/js"),n=t("./deserialize"),s=t("./cache"),o=t("./helper").isScene,a=t("./shared"),l=a.parsed,c=a.files,h=t("../platform/CCSys"),u=h.__audioSupport,d=h.capabilities,p=new s,f={parseImage:function(t,e,i){if(d.imageBitmap&&t instanceof Blob){var r={};r.imageOrientation=e.__flipY__?"flipY":"none",r.premultiplyAlpha=e.__premultiplyAlpha__?"premultiply":"none",createImageBitmap(t,r).then((function(t){t.flipY=!!e.__flipY__,t.premultiplyAlpha=!!e.__premultiplyAlpha__,i&&i(null,t)}),(function(t){i&&i(t,null)}))}else i&&i(null,t)},parseAudio:function(t,e,i){t instanceof ArrayBuffer?u.context.decodeAudioData(t,(function(t){i&&i(null,t)}),(function(t){i&&i(t,null)})):i&&i(null,t)},parsePVRTex:function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(s,0,13);if(55727696!=o[0])throw new Error("Invalid magic number in PVR header");var a=o[7],l=o[6],c=o[12]+52;n={_data:new Uint8Array(s,c),_compressed:!0,width:a,height:l}}catch(h){r=h}i&&i(r,n)},parsePKMTex:function(){function t(t,e){return t[e]<<8|t[e+1]}return function(e,i,r){var n=null,s=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o),l=t(a,6);if(0!==l&&1!==l&&3!==l)return new Error("Invalid magic number in ETC header");var c=t(a,12),h=t(a,14);t(a,8),t(a,10),s={_data:new Uint8Array(o,16),_compressed:!0,width:c,height:h}}catch(u){n=u}r&&r(n,s)}}(),parseASTCTex:function(t,e,i){var r=null,n=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))return new Error("Invalid magic number in ASTC header");var a=o[4],l=o[5],c=o[6];if((a<3||a>6||l<3||l>6||c<3||c>6)&&(a<4||7===a||9===a||11===a||a>12||l<4||7===l||9===l||11===l||l>12||1!==c))return new Error("Invalid block number in ASTC header");var h=function(t,e){return 4===t?cc.Texture2D.PixelFormat.RGBA_ASTC_4x4:5===t?4===e?cc.Texture2D.PixelFormat.RGBA_ASTC_5x4:cc.Texture2D.PixelFormat.RGBA_ASTC_5x5:6===t?5===e?cc.Texture2D.PixelFormat.RGBA_ASTC_6x5:cc.Texture2D.PixelFormat.RGBA_ASTC_6x6:8===t?5===e?cc.Texture2D.PixelFormat.RGBA_ASTC_8x5:6===e?cc.Texture2D.PixelFormat.RGBA_ASTC_8x6:cc.Texture2D.PixelFormat.RGBA_ASTC_8x8:10===t?5===e?cc.Texture2D.PixelFormat.RGBA_ASTC_10x5:6===e?cc.Texture2D.PixelFormat.RGBA_ASTC_10x6:8===e?cc.Texture2D.PixelFormat.RGBA_ASTC_10x8:cc.Texture2D.PixelFormat.RGBA_ASTC_10x10:10===e?cc.Texture2D.PixelFormat.RGBA_ASTC_12x10:cc.Texture2D.PixelFormat.RGBA_ASTC_12x12}(a,l),u=o[7]+(o[8]<<8)+(o[9]<<16),d=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],n={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:d,format:h}}catch(f){r=f}i(r,n)},parsePlist:function(t,e,r){var n=null,s=i.parse(t);s||(n=new Error("parse failed")),r&&r(n,s)},parseImport:function(t,e,i){if(!t)return i&&i(new Error("Json is empty"));var r,s=null;try{r=n(t,e)}catch(o){s=o}i&&i(s,r)},init:function(){p.clear()},register:function(t,e){"object"==typeof t?r.mixin(_,t):_[t]=e},parse:function(t,e,i,r,n){var s,a,h;(s=l.get(t))?n(null,s):(a=p.get(t))?a.push(n):(h=_[i])?(p.add(t,[n]),h(e,r,(function(e,i){e?c.remove(t):o(i)||l.add(t,i);for(var r=p.remove(t),n=0,s=r.length;n<s;n++)r[n](e,i)}))):n(null,e)}},_={".png":f.parseImage,".jpg":f.parseImage,".bmp":f.parseImage,".jpeg":f.parseImage,".gif":f.parseImage,".ico":f.parseImage,".tiff":f.parseImage,".webp":f.parseImage,".image":f.parseImage,".pvr":f.parsePVRTex,".pkm":f.parsePKMTex,".astc":f.parseASTCTex,".mp3":f.parseAudio,".ogg":f.parseAudio,".wav":f.parseAudio,".m4a":f.parseAudio,".plist":f.parsePlist,import:f.parseImport};e.exports=f},{"../platform/CCSAXParser":203,"../platform/CCSys":205,"../platform/js":217,"./cache":36,"./deserialize":40,"./helper":49,"./shared":58}],54:[function(t,e){var i=t("./task"),r=0;function n(t,e){if(Array.isArray(e)){this.id=r++,this.name=t,this.pipes=[];for(var i=0,n=e.length;i<n;i++)"function"==typeof e[i]&&this.pipes.push(e[i])}else cc.warn("funcs must be an array")}n.prototype={constructor:n,insert:function(t,e){if(!("function"!=typeof t||e>this.pipes.length))return this.pipes.splice(e,0,t),this;cc.warnID(4921)},append:function(t){if("function"==typeof t)return this.pipes.push(t),this},remove:function(t){if("number"==typeof t)return this.pipes.splice(t,1),this},sync:function(t){var e=this.pipes;if(t instanceof i&&0!==e.length){null!=t.output&&(t.input=t.output,t.output=null),t._isFinish=!1;for(var r=0,n=e.length;r<n;){var s=(0,e[r])(t);if(s)return t._isFinish=!0,s;++r!==n&&(t.input=t.output,t.output=null)}return t._isFinish=!0,t.output}},async:function(t){var e=this.pipes;t instanceof i&&0!==e.length&&(null!=t.output&&(t.input=t.output,t.output=null),t._isFinish=!1,this._flow(0,t))},_flow:function(t,e){var i=this;(0,this.pipes[t])(e,(function(r){r?(e._isFinish=!0,e.onComplete&&e.onComplete(r)):++t<i.pipes.length?(e.input=e.output,e.output=null,i._flow(t,e)):(e._isFinish=!0,e.onComplete&&e.onComplete(r,e.output))}))}},e.exports=n},{"./task":59}],55:[function(t,e){var i=t("./task"),r=t("./shared"),n=r.transformPipeline,s=r.RequestType;e.exports=function(t,e){var r=t.options,o=Object.create(null),a=Object.create(null);for(var l in r)switch(l){case s.PATH:case s.UUID:case s.DIR:case s.SCENE:case s.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":o[l]=r[l];break;case"__exclude__":case"__outputAsArray__":a[l]=r[l];break;default:o[l]=r[l],a[l]=r[l]}t.options=a;var c=i.create({input:t.input,options:o}),h=null;try{t.output=t.source=n.sync(c)}catch(f){h=f;for(var u=0,d=c.output.length;u<d;u++)c.output[u].recycle()}c.recycle(),e(h)}},{"./shared":58,"./task":59}],56:[function(t,e){var i=t("./depend-util"),r=t("./cache");t("../assets/CCAsset");var n=t("./shared").assets,s=t("../platform/utils").callInNextTick;function o(t,e){t._uuid&&e.push(t._uuid)}function a(t,e){for(var i=Object.getOwnPropertyNames(t),r=0;r<i.length;r++){var n=i[r];if("node"!==n&&"__eventTargets"!==n){var s=t[n];if("object"==typeof s&&s)if(Array.isArray(s))for(var a=0;a<s.length;a++){var l=s[a];l instanceof cc.Asset&&o(l,e)}else if(s.constructor&&s.constructor!==Object)s instanceof cc.Asset&&o(s,e);else for(var c=Object.getOwnPropertyNames(s),h=0;h<c.length;h++){var u=s[c[h]];u instanceof cc.Asset&&o(u,e)}}}}var l=[];function c(t,e){for(var i=0;i<t._components.length;i++)a(t._components[i],e);for(var r=0;r<t._children.length;r++)c(t._children[r],e)}function h(t,e,r,s){r.push(t._uuid);for(var o=i.getDeps(t._uuid),a=0,l=o.length;a<l;a++){var c=n.get(o[a]);if(c){var u=c._uuid;if(u in e?e[u]+=s:e[u]=c.refCount+s,r.includes(u))continue;h(c,e,r,s)}}}var u=new r,d=new r,p=!1;function f(){p=!1,d.forEach((function(t){_._free(t)})),d.clear()}var _={init:function(){u.clear(),d.clear()},_addPersistNodeRef:function(t){var e=[];c(t,e);for(var i=0,r=e.length;i<r;i++){var s=n.get(e[i]);s&&s.addRef()}u.add(t.uuid,e)},_removePersistNodeRef:function(t){if(u.has(t.uuid)){for(var e=u.get(t.uuid),i=0,r=e.length;i<r;i++){var s=n.get(e[i]);s&&s.decRef()}u.remove(t.uuid)}},_autoRelease:function(t,e,r){if(t){for(var s=i.getDeps(t._id),o=0,a=s.length;o<a;o++){var l=n.get(s[o]);l&&l.decRef(t.autoReleaseAssets)}var c=i._depends.get(t._id);if(c&&c.persistDeps)for(var h=c.persistDeps,d=0,p=h.length;d<p;d++){var f=n.get(h[d]);f&&f.decRef(t.autoReleaseAssets)}t._id!==e._id&&i.remove(t._id)}var _=i._depends.get(e._id);for(var m in _&&(_.persistDeps=[]),r){for(var g=r[m],y=u.get(g.uuid),v=0,b=y.length;v<b;v++){var x=n.get(y[v]);x&&x.addRef()}_&&_.persistDeps.push.apply(_.persistDeps,y)}},_free:function(t,e){if(d.remove(t._uuid),cc.isValid(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,h(t,e,l,-1),l.length=0,0!==e[t._uuid])return e[t._uuid];for(var i in e)0!==e[i]&&h(n.get(i),e,l,1);return l.length=0,e[t._uuid]}(t)>0)){n.remove(t._uuid);for(var r=i.getDeps(t._uuid),s=0,o=r.length;s<o;s++){var a=n.get(r[s]);a&&(a.decRef(!1),_._free(a,!1))}t.destroy(),i.remove(t._uuid)}},tryRelease:function(t,e){t instanceof cc.Asset&&(e?_._free(t,e):(d.add(t._uuid,t),p||(p=!0,s(f))))}};e.exports=_},{"../assets/CCAsset":62,"../platform/utils":220,"./cache":36,"./depend-util":38,"./shared":58}],57:[function(t,e){var i=[];function r(){this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null)}r.prototype={constructor:r,get id(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id},recycle:function(){500!==i.length&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),i.push(this))}},r.create=function(){return 0!==i.length?i.pop():new r},e.exports=r},{}],58:[function(t,e){var i=t("./cache"),r=t("./pipeline"),n=new i,s=new i,o=new i,a=new i,l=new r("normal load",[]),c=new r("fetch",[]),h=new r("transform url",[]);e.exports={assets:n,files:s,parsed:o,pipeline:l,fetchPipeline:c,transformPipeline:h,RequestType:{UUID:"uuid",PATH:"path",DIR:"dir",URL:"url",SCENE:"scene"},bundles:a,BuiltinBundleName:{RESOURCES:"resources",INTERNAL:"internal",MAIN:"main",START_SCENE:"start-scene"}}},{"./cache":36,"./pipeline":54}],59:[function(t,e){var i=0,r=[];function n(t){this.id=i++,this._isFinish=!0,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.set(t)}n.prototype={constructor:n,set:function(t){t=t||Object.create(null),this.onComplete=t.onComplete,this.onProgress=t.onProgress,this.onError=t.onError,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},dispatch:function(t,e,i,r,n){switch(t){case"complete":this.onComplete&&this.onComplete(e,i,r,n);break;case"progress":this.onProgress&&this.onProgress(e,i,r,n);break;case"error":this.onError&&this.onError(e,i,r,n);break;default:var s="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[s]&&this[s](e,i,r,n)}},recycle:function(){500!==r.length&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,r.push(this))},get isFinish(){return this._isFinish}},n.create=function(t){var e=null;return 0!==r.length?(e=r.pop()).set(t):e=new n(t),e},e.exports=n},{}],60:[function(t,e){var i=t("./helper").decodeUuid,r=t("./request-item"),n=t("./shared"),s=n.RequestType,o=n.bundles;e.exports={parse:function(t){var e=t.input,n=t.options;e=Array.isArray(e)?e:[e],t.output=[];for(var a=0;a<e.length;a++){var l=e[a],c=r.create();if("string"==typeof l&&((l=Object.create(null))[n.__requestType__||s.UUID]=e[a]),"object"==typeof l)for(var h in cc.js.addon(l,n),l.preset&&cc.js.addon(l,cc.assetManager.presets[l.preset]),l){switch(h){case s.UUID:var u=c.uuid=i(l.uuid);if(o.has(l.bundle)){if((_=(m=o.get(l.bundle)._config).getAssetInfo(u))&&_.redirect){if(!o.has(_.redirect))throw new Error("Please load bundle "+_.redirect+" first");_=(m=o.get(_.redirect)._config).getAssetInfo(u)}c.config=m,c.info=_}c.ext=l.ext||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case s.DIR:if(o.has(l.bundle)){var d=[];o.get(l.bundle)._config.getDirWithPath(l.dir,l.type,d);for(var p=0,f=d.length;p<f;p++){var _=d[p];e.push({uuid:_.uuid,__isNative__:!1,ext:".json",bundle:l.bundle})}}c.recycle(),c=null;break;case s.PATH:if(o.has(l.bundle)){if((_=(m=o.get(l.bundle)._config).getInfoWithPath(l.path,l.type))&&_.redirect){if(!o.has(_.redirect))throw new Error("you need to load bundle "+_.redirect+" first");_=(m=o.get(_.redirect)._config).getAssetInfo(_.uuid)}if(!_)throw c.recycle(),new Error("Bundle "+l.bundle+" doesn't contain "+l.path);c.config=m,c.uuid=_.uuid,c.info=_}c.ext=l.ext||".json";break;case s.SCENE:if(o.has(l.bundle)){var m;if((_=(m=o.get(l.bundle)._config).getSceneInfo(l.scene))&&_.redirect){if(!o.has(_.redirect))throw new Error("you need to load bundle "+_.redirect+" first");_=(m=o.get(_.redirect)._config).getAssetInfo(_.uuid)}if(!_)throw c.recycle(),new Error("Bundle "+m.name+" doesn't contain scene "+l.scene);c.config=m,c.uuid=_.uuid,c.info=_}break;case"__isNative__":c.isNative=l.__isNative__;break;case s.URL:c.url=l.url,c.uuid=l.uuid||l.url,c.ext=l.ext||cc.path.extname(l.url),c.isNative=void 0===l.__isNative__||l.__isNative__;break;default:c.options[h]=l[h]}if(!c)break}if(c&&(t.output.push(c),!c.uuid&&!c.url))throw new Error("Can not parse this input:"+JSON.stringify(l))}return null},combine:function(t){for(var e=t.output=t.input,i=0;i<e.length;i++){var r=e[i];if(!r.url){var n,s,o=r.config;s=r.isNative?o&&o.nativeBase?o.base+o.nativeBase:cc.assetManager.generalNativeBase:o&&o.importBase?o.base+o.importBase:cc.assetManager.generalImportBase;var a=r.uuid,l="";r.info&&(l=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),n=".ttf"===r.ext?s+"/"+a.slice(0,2)+"/"+a+l+"/"+r.options.__nativeName__:s+"/"+a.slice(0,2)+"/"+a+l+r.ext,r.url=n}}return null}}},{"./helper":49,"./request-item":57,"./shared":58}],61:[function(t,e){var i=t("./depend-util"),r=t("./helper"),n=r.isScene,s=r.decodeUuid,o=t("./shared").assets,a=t("../platform/utils").callInNextTick;t("../assets/CCAsset");var l={processOptions:function(t){var e=t.uuids,i=t.paths,r=t.types,n=t.deps,o=t.paths=Object.create(null);if(!1===t.debug){for(var a=0,l=e.length;a<l;a++)e[a]=s(e[a]);for(var c in i){var h=i[c],u=h[1];h[1]=r[u]}}else{for(var d=Object.create(null),p=0,f=e.length;p<f;p++){var _=e[p];e[p]=d[_]=s(_)}e=d}for(var m in i){var g=i[m];o[e[m]]=g}var y=t.scenes;for(var v in y){var b=y[v];y[v]=e[b]}var x=t.packs;for(var T in x)for(var C=x[T],S=0;S<C.length;++S)C[S]=e[C[S]];var w=t.versions;if(w)for(var A in w)for(var E=w[A],D=0;D<E.length;D+=2){var L=E[D];E[D]=e[L]||L}var I=t.redirect;if(I)for(var P=0;P<I.length;P+=2)I[P]=e[I[P]],I[P+1]=n[I[P+1]]},clear:function(t,e){for(var i=0,r=t.input.length;i<r;i++){var n=t.input[i];e&&!n.isNative&&n.content&&n.content.decRef&&n.content.decRef(!1),n.recycle()}t.input=null},urlAppendTimestamp:function(t){return cc.assetManager.downloader.appendTimeStamp&&"string"==typeof t?/\?/.test(t)?t+"&_t="+(new Date-0):t+"?_t="+(new Date-0):t},retry:function(t,e,i,r,n){t(n=n||0,(function(s,o){n++,!s||n>e?r&&r(s,o):setTimeout((function(){l.retry(t,e,i,r,n)}),i)}))},getDepends:function(t,e,r,n,s,o,a){try{var l=i.parse(t,e),c=!0;if(e instanceof cc.Asset&&(!e.__nativeDepend__||e._nativeAsset)&&(c=!1),s){for(var h=0,u=l.deps.length;h<u;h++){var d=l.deps[h];d in r||(r[d]=!0,n.push({uuid:d,bundle:a&&a.name}))}c&&l.nativeDep&&(a&&(l.nativeDep.bundle=a.name),n.push(Object.assign({},l.nativeDep)))}else{o=!!e.asyncLoadAssets||o&&!l.preventDeferredLoadDependents;for(var p=0,f=l.deps.length;p<f;p++){var _=l.deps[p];_ in r||(r[_]=!0,n.push({uuid:_,__asyncLoadAssets__:o,bundle:a&&a.name}))}c&&!o&&!l.preventPreloadNativeObject&&l.nativeDep&&(a&&(l.nativeDep.bundle=a.name),n.push(Object.assign({},l.nativeDep)))}}catch(m){cc.error(m.message,m.stack)}},cache:function(t,e,i){e&&!n(e)&&i&&o.add(t,e)},setProperties:function(t,e,i){var r=!1,n=e.__depends__;if(n){for(var s=0,o=n.length;s<o;s++){var a=n[s],l=i[a.uuid+"@import"];l?a.owner[a.prop]=l.addRef():(cc.error("The asset "+a.uuid+" is missing!"),r=!0)}e.__depends__=void 0}return e.__nativeDepend__&&(e._nativeAsset||(i[t+"@native"]?e._nativeAsset=i[t+"@native"]:r=!0),e.__nativeDepend__=void 0),r},gatherAsset:function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var i=t.output=[],r=0,n=e.length;r<n;r++)i.push(e[r].content);else t.output=e[0].content},forEach:function(t,e,i){var r=0,n=[];0===t.length&&i&&i(n);for(var s=0,o=t.length;s<o;s++)e(t[s],(function(t){t&&n.push(t),++r===o&&i&&i(n)}))},parseParameters:function(t,e,i){if(void 0===i){var r="function"==typeof t;e?(i=e,r||(e=null)):void 0===e&&r&&(i=t,t=null,e=null),void 0!==e&&r&&(e=t,t=null)}return{options:t=t||Object.create(null),onProgress:e,onComplete:i}},parseLoadResArgs:function(t,e,i){if(void 0===i){var r=cc.js.isChildClassOf(t,cc.Asset);e?(i=e,r&&(e=null)):void 0!==e||r||(i=t,e=null,t=null),void 0===e||r||(e=t,t=null)}return{type:t,onProgress:e,onComplete:i}},checkCircleReference:function(t,e,r,n){if(n||(n=Object.create(null)),!r[e]||n[e])return!1;n[e]=!0;var s=!1,o=i.getDeps(e);if(o)for(var a=0,c=o.length;a<c;a++){var h=o[a];if(h===t||l.checkCircleReference(t,h,r,n)){s=!0;break}}return s},asyncify:function(t){return function(e,i){if(t){var r=[];Array.isArray(i)?i.forEach((function(t){return t instanceof cc.Asset&&r.push(t.addRef())})):i instanceof cc.Asset&&r.push(i.addRef()),a((function(){r.forEach((function(t){return t.decRef(!1)})),t(e,i)}))}}}};e.exports=l},{"../assets/CCAsset":62,"../platform/utils":220,"./depend-util":38,"./helper":49,"./shared":58}],62:[function(t,e){var i=t("../platform/CCObject");cc.Asset=cc.Class({name:"cc.Asset",extends:i,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0}),this.loaded=!0,this._nativeUrl="",this._ref=0},properties:{nativeUrl:{get:function(){if(!this._nativeUrl&&this._native){var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=cc.assetManager.utils.getUrlWithUuid(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=cc.assetManager.utils.getUrlWithUuid(this._uuid,{__nativeName__:t,nativeExt:cc.path.extname(t),isNative:!0})}return this._nativeUrl},visible:!1},refCount:{get:function(){return this._ref}},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(t){this._$nativeAsset=t}},_nativeDep:{get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},serialize:!1,createNode:null,_setRawAsset:function(t,e){this._native=!1!==e?t||void 0:"/"+t},addRef:function(){return this._ref++,this},decRef:function(t){return this._ref>0&&this._ref--,!1!==t&&cc.assetManager._releaseManager.tryRelease(this),this},destroy:function(){return this.loaded=!1,this._super()}}),e.exports=cc.Asset},{"../platform/CCObject":202}],63:[function(t,e){var i=t("./CCAsset"),r=t("../event/event-target"),n=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1}),s=cc.Class({name:"cc.AudioClip",extends:i,mixins:[r],ctor:function(){this._loading=!1,this.loaded=!1,this._audio=null},properties:{duration:0,loadMode:{default:n.WEB_AUDIO,type:n},_nativeAsset:{get:function(){return this._audio},set:function(t){t instanceof cc.AudioClip?this._audio=t._nativeAsset:this._audio=t,this._audio&&(this.loaded=!0,this.emit("load"))},override:!0},_nativeDep:{get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:cc.path.extname(this._native),__isNative__:!0}},override:!0}},statics:{LoadMode:n,_loadByUrl:function(t,e){var i=cc.assetManager.assets.get(t);i?e(null,i):cc.assetManager.loadRemote(t,(function(t,i){if(t)return e(t);e(null,i)}))}},_ensureLoaded:function(t){if(this.isValid){if(this.loaded)return t&&t();if(t&&this.once("load",t),!this._loading){this._loading=!0;var e=this;cc.assetManager.postLoadNative(this,(function(){e._loading=!1}))}}},destroy:function(){cc.audioEngine.uncache(this),this._super()}});cc.AudioClip=s,e.exports=s},{"../event/event-target":143,"./CCAsset":62}],64:[function(t,e){var i=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},r=function(t){this._letterDefinitions={},this._texture=t};r.prototype={constructor:r,addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var r=new i;cc.js.mixin(r,this._letterDefinitions[e]),t[e]=r}return t},getTexture:function(){return this._texture},getLetter:function(t){return this._letterDefinitions[t]},getLetterDefinitionForChar:function(t){var e=t.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(e)?this._letterDefinitions[e]:null},clear:function(){this._letterDefinitions={}}};var n=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var t=this.spriteFrame;this._fontDefDictionary||(this._fontDefDictionary=new r,t&&(this._fontDefDictionary._texture=t._texture));var e=this._fntConfig;if(e){var n=e.fontDefDictionary;for(var s in n){var o=new i,a=n[s].rect;o.offsetX=n[s].xOffset,o.offsetY=n[s].yOffset,o.w=a.width,o.h=a.height,o.u=a.x,o.v=a.y,o.textureID=0,o.valid=!0,o.xAdvance=n[s].xAdvance,this._fontDefDictionary.addLetterDefinitions(s,o)}}}});cc.BitmapFont=n,cc.BitmapFont.FontLetterDefinition=i,cc.BitmapFont.FontAtlas=r,e.exports=n},{}],65:[function(t,e){var i=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=e.exports=i},{}],66:[function(t,e){var i=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=e.exports=i},{}],67:[function(t,e){var i=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});e.exports=cc.JsonAsset=i},{}],68:[function(t,e){var i=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name)}});cc.LabelAtlas=i,e.exports=i},{}],69:[function(t,e){var i=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),r=cc.Class({name:"cc.Prefab",extends:cc.Asset,ctor:function(){this._createFunction=null,this._instantiatedTimes=0},properties:{data:null,optimizationPolicy:i.AUTO,asyncLoadAssets:!1,readonly:{default:!1,editorOnly:!0}},statics:{OptimizationPolicy:i,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var e=t("../platform/instantiate-jit");this._createFunction=e.compile(this.data)},_doInstantiate:function(t){return this.data._prefab||cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){var t;return this.optimizationPolicy!==i.SINGLE_INSTANCE&&(this.optimizationPolicy===i.MULTI_INSTANCE||this._instantiatedTimes+1>=r.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this._instantiatedTimes,t},destroy:function(){this.data&&this.data.destroy(),this._super()}});cc.Prefab=e.exports=r,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":215}],70:[function(t,e){var i,r=(i=t("../../renderer/gfx"))&&i.__esModule?i:{default:i},n=t("../renderer"),s=t("./CCTexture2D"),o=cc.Enum({RB_FMT_D24S8:r.default.RB_FMT_D24S8,RB_FMT_S8:r.default.RB_FMT_S8,RB_FMT_D16:r.default.RB_FMT_D16}),a=cc.Class({name:"cc.RenderTexture",extends:s,statics:{DepthStencilFormat:o},ctor:function(){this._framebuffer=null},initWithSize:function(t,e,i){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var s,o={colors:[this._texture]};this._depthStencilBuffer&&this._depthStencilBuffer.destroy(),i&&(s=new r.default.RenderBuffer(n.device,i,t,e),i===r.default.RB_FMT_D24S8?o.depthStencil=s:i===r.default.RB_FMT_S8?o.stencil=s:i===r.default.RB_FMT_D16&&(o.depth=s)),this._depthStencilBuffer=s,this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=new r.default.FrameBuffer(n.device,t,e,o),this._packable=!1,this.loaded=!0,this.emit("load")},updateSize:function(t,e){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var i=this._depthStencilBuffer;i&&i.update(this.width,this.height),this._framebuffer._width=t,this._framebuffer._height=e},drawTextureAt:function(t,e,i){t._image&&0!==t._image.width&&this._texture.updateSubImage({x:e,y:i,image:t._image,width:t.width,height:t.height,level:0,flipY:!1,premultiplyAlpha:t._premultiplyAlpha})},readPixels:function(t,e,i,r,n){if(!this._framebuffer||!this._texture)return t;e=e||0,i=i||0;var s=r||this.width,o=n||this.height;t=t||new Uint8Array(s*o*4);var a=cc.game._renderContext,l=a.getParameter(a.FRAMEBUFFER_BINDING);return a.bindFramebuffer(a.FRAMEBUFFER,this._framebuffer.getHandle()),a.readPixels(e,i,s,o,a.RGBA,a.UNSIGNED_BYTE,t),a.bindFramebuffer(a.FRAMEBUFFER,l),t},destroy:function(){this._super(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null)}});cc.RenderTexture=e.exports=a},{"../../renderer/gfx":319,"../renderer":227,"./CCTexture2D":77}],71:[function(t,e){var i=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=i,e.exports=i},{}],72:[function(){var t=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=t;var e=cc.Class({name:"cc.JavaScript",extends:t});cc._JavaScript=e;var i=cc.Class({name:"cc.TypeScript",extends:t});cc._TypeScript=i},{}],73:[function(t,e){var i=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){var e=this._spriteFrames[t];return e?(e.name||(e.name=t),e):null},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var i in e)t.push(this.getSpriteFrame(i));return t}});cc.SpriteAtlas=i,e.exports=i},{}],74:[function(t,e){var i=t("../event/event-target"),r=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],n=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[i],properties:{_textureSetter:{set:function(t){t&&this._texture!==t&&this._refreshTexture(t)}},insetTop:{get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]=t,this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]=t,this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]=t,this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]=t,this._texture&&this._calculateSlicedUV()}}},ctor:function(){i.call(this);var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3],s=arguments[4];this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this._flipX=!1,this._flipY=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],void 0!==t&&this.setTexture(t,e,r,n,s)},textureLoaded:function(){return this._texture&&this._texture.loaded},onTextureLoaded:function(t,e){return this.textureLoaded()?(t.call(e),!0):(this.once("load",t,e),this.ensureLoadTexture(),!1)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t,this._texture&&this._calculateUV()},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},setFlipX:function(t){this._flipX=t,this._texture&&this._calculateUV()},setFlipY:function(t){this._flipY=t,this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var t=this._texture;if(t){var e=t.width,i=t.height;this._rect?this._checkRect(this._texture):this._rect=cc.rect(0,0,e,i),this._originalSize||(this._originalSize=cc.size(e,i)),this._offset||(this._offset=cc.v2(0,0)),this._calculateUV(),this.emit("load")}},_refreshTexture:function(t){this._texture=t,t.loaded?this._textureLoadedCallback():t.once("load",this._textureLoadedCallback,this)},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new n(this._texture,this.getRect(),this._rotated,this.getOffset(),this.getOriginalSize())},setTexture:function(t,e,i,r,n){if(1!==arguments.length||t!==this._texture){if(this._rect=e||null,r?this.setOffset(r):this._offset=null,n?this.setOriginalSize(n):this._originalSize=null,this._rotated=i||!1,"string"!=typeof t)return t instanceof cc.Texture2D&&this._refreshTexture(t),!0;cc.errorID(3401)}},ensureLoadTexture:function(){this._texture&&(this._texture.loaded||(this._refreshTexture(this._texture),cc.assetManager.postLoadNative(this._texture)))},_checkRect:function(t){var e=this._rect,i=e.x,r=e.y;this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.width&&cc.errorID(3300,t.nativeUrl+"/"+this.name,i,t.width),r>t.height&&cc.errorID(3400,t.nativeUrl+"/"+this.name,r,t.height)},_flipXY:function(t){if(this._flipX){var e=t[0];t[0]=t[1],t[1]=e,e=t[2],t[2]=t[3],t[3]=e}if(this._flipY){var i=t[0];t[0]=t[2],t[2]=i,i=t[1],t[1]=t[3],t[3]=i}},_calculateSlicedUV:function(){var t=this._rect,e=this._texture.width,i=this._texture.height,n=this._capInsets[0],s=this._capInsets[2],o=t.width-n-s,a=this._capInsets[1],l=this._capInsets[3],c=t.height-a-l,h=this.uvSliced;if(h.length=0,this._rotated){r[0].u=t.x/e,r[1].u=(t.x+l)/e,r[2].u=(t.x+l+c)/e,r[3].u=(t.x+t.height)/e,r[3].v=t.y/i,r[2].v=(t.y+n)/i,r[1].v=(t.y+n+o)/i,r[0].v=(t.y+t.width)/i,this._flipXY(r);for(var u=0;u<4;++u)for(var d=r[u],p=0;p<4;++p){var f=r[3-p];h.push({u:d.u,v:f.v})}}else{r[0].u=t.x/e,r[1].u=(t.x+n)/e,r[2].u=(t.x+n+o)/e,r[3].u=(t.x+t.width)/e,r[3].v=t.y/i,r[2].v=(t.y+a)/i,r[1].v=(t.y+a+c)/i,r[0].v=(t.y+t.height)/i,this._flipXY(r);for(var _=0;_<4;++_)for(var m=r[_],g=0;g<4;++g){var y=r[g];h.push({u:y.u,v:m.v})}}},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._texture.loaded?this._calculateUV():this.ensureLoadTexture())},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,r=e.width,n=e.height;if(this._rotated){var s=0===r?0:t.x/r,o=0===r?0:(t.x+t.height)/r,a=0===n?0:(t.y+t.width)/n,l=0===n?0:t.y/n;i[0]=s,i[1]=l,i[2]=s,i[3]=a,i[4]=o,i[5]=l,i[6]=o,i[7]=a}else{var c=0===r?0:t.x/r,h=0===r?0:(t.x+t.width)/r,u=0===n?0:(t.y+t.height)/n,d=0===n?0:t.y/n;i[0]=c,i[1]=u,i[2]=h,i[3]=u,i[4]=c,i[5]=d,i[6]=h,i[7]=d}if(this._flipX){var p=i[0];i[0]=i[2],i[2]=p,p=i[1],i[1]=i[3],i[3]=p,p=i[4],i[4]=i[6],i[6]=p,p=i[5],i[5]=i[7],i[7]=p}if(this._flipY){var f=i[0];i[0]=i[4],i[4]=f,f=i[1],i[1]=i[5],i[5]=f,f=i[2],i[2]=i[6],i[6]=f,f=i[3],i[3]=i[7],i[7]=f}var _=this.vertices;if(_){_.nu.length=0,_.nv.length=0;for(var m=0;m<_.u.length;m++)_.nu[m]=_.u[m]/r,_.nv[m]=_.v[m]/n}this._calculateSlicedUV()},_serialize:!1,_deserialize:function(t){var e=t.rect;e&&(this._rect=new cc.Rect(e[0],e[1],e[2],e[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var i=t.capInsets;i&&(this._capInsets[0]=i[0],this._capInsets[1]=i[1],this._capInsets[2]=i[2],this._capInsets[3]=i[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])}}),s=n.prototype;s.copyWithZone=s.clone,s.copy=s.clone,s.initWithTexture=s.setTexture,cc.SpriteFrame=n,e.exports=n},{"../assets/CCAsset":62,"../event/event-target":143}],75:[function(t,e){var i=t("./CCFont"),r=cc.Class({name:"cc.TTFFont",extends:i,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"},override:!0},_nativeDep:{get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:cc.path.extname(this._native),__isNative__:!0}},override:!0}}});cc.TTFFont=e.exports=r},{"./CCFont":66}],76:[function(t,e){var i=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text}});e.exports=cc.TextAsset=i},{}],77:[function(t,e){var i,r=(i=t("../../renderer/gfx"))&&i.__esModule?i:{default:i},n=t("../event/event-target"),s=t("../renderer");t("../platform/CCClass");var o=new(t("../platform/id-generater"))("Tex"),a=1024,l=cc.Enum({RGB565:r.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:r.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:r.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:r.default.TEXTURE_FMT_RGB8,RGBA8888:r.default.TEXTURE_FMT_RGBA8,RGBA32F:r.default.TEXTURE_FMT_RGBA32F,A8:r.default.TEXTURE_FMT_A8,I8:r.default.TEXTURE_FMT_L8,AI8:r.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:r.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:r.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:a++,RGB_PVRTC_4BPPV1:r.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:r.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:a++,RGB_ETC1:r.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:a++,RGB_ETC2:r.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:r.default.TEXTURE_FMT_RGBA_ETC2,RGBA_ASTC_4x4:r.default.TEXTURE_FMT_RGBA_ASTC_4X4,RGBA_ASTC_5x4:r.default.TEXTURE_FMT_RGBA_ASTC_5X4,RGBA_ASTC_5x5:r.default.TEXTURE_FMT_RGBA_ASTC_5X5,RGBA_ASTC_6x5:r.default.TEXTURE_FMT_RGBA_ASTC_6X5,RGBA_ASTC_6x6:r.default.TEXTURE_FMT_RGBA_ASTC_6X6,RGBA_ASTC_8x5:r.default.TEXTURE_FMT_RGBA_ASTC_8X5,RGBA_ASTC_8x6:r.default.TEXTURE_FMT_RGBA_ASTC_8X6,RGBA_ASTC_8x8:r.default.TEXTURE_FMT_RGBA_ASTC_8X8,RGBA_ASTC_10x5:r.default.TEXTURE_FMT_RGBA_ASTC_10X5,RGBA_ASTC_10x6:r.default.TEXTURE_FMT_RGBA_ASTC_10X6,RGBA_ASTC_10x8:r.default.TEXTURE_FMT_RGBA_ASTC_10X8,RGBA_ASTC_10x10:r.default.TEXTURE_FMT_RGBA_ASTC_10X10,RGBA_ASTC_12x10:r.default.TEXTURE_FMT_RGBA_ASTC_12X10,RGBA_ASTC_12x12:r.default.TEXTURE_FMT_RGBA_ASTC_12X12}),c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),h=cc.Enum({LINEAR:9729,NEAREST:9728}),u={9728:0,9729:1},d=[],p={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};function f(){for(var t in p)p[t]=void 0;return d.length=0,p.images=d,p}var _=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCAsset"),mixins:[n],properties:{_nativeAsset:{get:function(){return this._image},set:function(t){t._compressed&&t._data?this.initWithData(t._data,this._format,t.width,t.height):this.initWithElement(t)},override:!0},_format:l.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:h.LINEAR,_magFilter:h.LINEAR,_mipFilter:h.LINEAR,_wrapS:c.CLAMP_TO_EDGE,_wrapT:c.CLAMP_TO_EDGE,_isAlphaAtlas:!1,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps},set:function(t){if(this._genMipmaps!==t){var e=f();e.genMipmaps=t,this.update(e)}}},_packable:!0,packable:{get:function(){return this._packable},set:function(t){this._packable=t}},_nativeDep:{get:function(){return{__isNative__:!0,uuid:this._uuid,ext:this._native,__flipY__:this._flipY,__premultiplyAlpha__:this._premultiplyAlpha}},override:!0}},statics:{PixelFormat:l,WrapMode:c,Filter:h,_FilterIndex:u,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],_parseExt:function(t,e){for(var i=cc.renderer.device,r=t.split("_"),n="",s="",o=999,a=e,c=cc.macro.SUPPORT_TEXTURE_FORMATS,h=0;h<r.length;h++){var u=r[h].split("@"),d=u[0];d=_.extnames[d.charCodeAt(0)-48]||d;var p=c.indexOf(d);if(-1!==p&&p<o){var f=u[1]?parseInt(u[1]):e;if(".astc"===d&&!i.ext("WEBGL_compressed_texture_astc"))continue;if(".pvr"===d&&!i.ext("WEBGL_compressed_texture_pvrtc"))continue;if(!(f!==l.RGB_ETC1&&f!==l.RGBA_ETC1||i.ext("WEBGL_compressed_texture_etc1")))continue;if(!(f!==l.RGB_ETC2&&f!==l.RGBA_ETC2||i.ext("WEBGL_compressed_texture_etc")))continue;if(".webp"===d&&!cc.sys.capabilities.webp)continue;o=p,s=d,a=f}else n||(n=d)}return{bestExt:s,bestFormat:a,defaultExt:n}}},ctor:function(){this._id=o.getNewId(),this.loaded=!1,this.width=0,this.height=0,this._hashDirty=!0,this._hash=0,this._texture=null},getImpl:function(){return this._texture||(this._texture=new s.Texture2D(s.device,{})),this._texture},getId:function(){return this._id},toString:function(){return this.nativeUrl||""},update:function(t){if(t){var e=!1;void 0!==t.width&&(this.width=t.width),void 0!==t.height&&(this.height=t.height),void 0!==t.minFilter&&(this._minFilter=t.minFilter,t.minFilter=u[t.minFilter]),void 0!==t.magFilter&&(this._magFilter=t.magFilter,t.magFilter=u[t.magFilter]),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter,t.mipFilter=u[t.mipFilter]),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format),void 0!==t.flipY&&(this._flipY=t.flipY,e=!0),void 0!==t.premultiplyAlpha&&(this._premultiplyAlpha=t.premultiplyAlpha,e=!0),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps),cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap?this._checkImageBitmap(this._upload.bind(this,t,e)):this._upload(t,e)}},_upload:function(t,e){e&&this._image&&(t.image=this._image),t.images&&t.images.length>0?this._image=t.images[0]:void 0!==t.image&&(this._image=t.image,t.images||(d.length=0,t.images=d),t.images.push(t.image)),this._texture&&this._texture.update(t),this._hashDirty=!0},initWithElement:function(t){if(t)if(this._image=t,t.complete||t instanceof HTMLCanvasElement)this.handleLoadedTexture();else if(cc.sys.capabilities.imageBitmap&&t instanceof ImageBitmap)this._checkImageBitmap(this.handleLoadedTexture.bind(this));else{var e=this;t.addEventListener("load",(function(){e.handleLoadedTexture()})),t.addEventListener("error",(function(t){cc.warnID(3119,t.message)}))}},initWithData:function(t,e,i,r){var n=f();return n.image=t,n.images=[n.image],n.genMipmaps=this._genMipmaps,n.premultiplyAlpha=this._premultiplyAlpha,n.flipY=this._flipY,n.minFilter=u[this._minFilter],n.magFilter=u[this._magFilter],n.wrapS=this._wrapS,n.wrapT=this._wrapT,n.format=this._getGFXPixelFormat(e),n.width=i,n.height=r,this._texture?this._texture.update(n):this._texture=new s.Texture2D(s.device,n),this.width=i,this.height=r,this._updateFormat(),this._checkPackable(),this.loaded=!0,this.emit("load"),!0},getHtmlElementObj:function(){return this._image},destroy:function(){cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap&&this._image.close&&this._image.close(),this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this),this._image=null,this._texture&&this._texture.destroy(),this._super()},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},isAlphaAtlas:function(){return this._isAlphaAtlas},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){this.width=this._image.width,this.height=this._image.height;var t=f();t.image=this._image,t.images=[t.image],t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._getGFXPixelFormat(this._format),t.premultiplyAlpha=this._premultiplyAlpha,t.flipY=this._flipY,t.minFilter=u[this._minFilter],t.magFilter=u[this._magFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,this._texture?this._texture.update(t):this._texture=new s.Texture2D(s.device,t),this._updateFormat(),this._checkPackable(),this.loaded=!0,this.emit("load"),cc.macro.CLEANUP_IMAGE_CACHE&&this._cleanupImageCache()}},_cleanupImageCache:function(){this._image instanceof HTMLImageElement?this._clearImage():cc.sys.capabilities.imageBitmap&&this._image instanceof ImageBitmap&&this._image.close&&this._image.close()},description:function(){return"<cc.Texture2D | Name = "+this.nativeUrl+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._image=null,this._texture&&this._texture.destroy()},setWrapMode:function(t,e){if(this._wrapS!==t||this._wrapT!==e){var i=f();i.wrapS=t,i.wrapT=e,this.update(i)}},setFilters:function(t,e){if(this._minFilter!==t||this._magFilter!==e){var i=f();i.minFilter=t,i.magFilter=e,this.update(i)}},setFlipY:function(t){if(this._flipY!==t){var e=f();e.flipY=t,e.premultiplyAlpha=this._premultiplyAlpha,this.update(e)}},setPremultiplyAlpha:function(t){if(this._premultiplyAlpha!==t){var e=f();e.flipY=this._flipY,e.premultiplyAlpha=t,this.update(e)}},_updateFormat:function(){this._isAlphaAtlas=this._format===l.RGBA_ETC1||this._format===l.RGB_A_PVRTC_4BPPV1||this._format===l.RGB_A_PVRTC_2BPPV1},_checkPackable:function(){var t=cc.dynamicAtlasManager;if(t)if(this._isCompressed())this._packable=!1;else{var e=this.width,i=this.height;!this._image||e>t.maxFrameSize||i>t.maxFrameSize||this._getHash()!==t.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)}},_getOpts:function(){var t=f();return t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._format,t.premultiplyAlpha=this._premultiplyAlpha,t.anisotropy=this._anisotropy,t.flipY=this._flipY,t.minFilter=u[this._minFilter],t.magFilter=u[this._magFilter],t.mipFilter=u[this._mipFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,t},_getGFXPixelFormat:function(t){return t===l.RGBA_ETC1?t=l.RGB_ETC1:t===l.RGB_A_PVRTC_4BPPV1?t=l.RGB_PVRTC_4BPPV1:t===l.RGB_A_PVRTC_2BPPV1&&(t=l.RGB_PVRTC_2BPPV1),t},_resetUnderlyingMipmaps:function(t){var e=this._getOpts();e.images=t||[null],this._texture?this._texture.update(e):this._texture=new s.Texture2D(s.device,e)},_serialize:!1,_deserialize:function(t){var e=t.split(","),i=e[0];if(i){var r=_._parseExt(i,this._format);if(r.bestExt)this._setRawAsset(r.bestExt),this._format=r.bestFormat;else{if(!r.defaultExt)throw new Error(cc.debug.getError(3121));this._setRawAsset(r.defaultExt),cc.warnID(3120,r.defaultExt,r.defaultExt)}}8===e.length&&(this._minFilter=parseInt(e[1]),this._magFilter=parseInt(e[2]),this._wrapS=parseInt(e[3]),this._wrapT=parseInt(e[4]),this._premultiplyAlpha=49===e[5].charCodeAt(0),this._genMipmaps=49===e[6].charCodeAt(0),this._packable=49===e[7].charCodeAt(0))},_getHash:function(){if(!this._hashDirty)return this._hash;var t=this._genMipmaps?1:0,e=this._premultiplyAlpha?1:0,i=this._flipY?1:0,r=this._minFilter===h.LINEAR?1:2,n=this._magFilter===h.LINEAR?1:2,s=this._wrapS===c.REPEAT?1:this._wrapS===c.CLAMP_TO_EDGE?2:3,o=this._wrapT===c.REPEAT?1:this._wrapT===c.CLAMP_TO_EDGE?2:3,a=this._format;return this._image,this._hash=Number(""+r+n+a+s+o+t+e+i),this._hashDirty=!1,this._hash},_isCompressed:function(){return this._format<l.A8||this._format>l.RGBA32F},_clearImage:function(){this._image.src=""},_checkImageBitmap:function(t){var e=this,i=this._image,r=this._flipY,n=this._premultiplyAlpha;this._flipY!==i.flipY||this._premultiplyAlpha!==i.premultiplyAlpha?createImageBitmap(i,{imageOrientation:r!==i.flipY?"flipY":"none",premultiplyAlpha:n?"premultiply":"none"}).then((function(s){i.close&&i.close(),s.flipY=r,s.premultiplyAlpha=n,e._image=s,t()}),(function(t){cc.error(t.message)})):t()}});cc.Texture2D=e.exports=_},{"../../renderer/gfx":319,"../assets/CCAsset":62,"../event/event-target":143,"../platform/CCClass":196,"../platform/id-generater":213,"../renderer":227}],78:[function(t,e){var i=t("./CCAsset"),r=t("../event/event-target"),n=cc.Class({name:"cc.VideoClip",extends:i,mixins:[r]});cc.VideoClip=n,e.exports=n},{"../event/event-target":143,"./CCAsset":62}],79:[function(t){t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCVideoClip"),t("./CCScripts"),t("./CCSceneAsset"),t("./CCSpriteFrame"),t("./CCTexture2D"),t("./CCRenderTexture"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas"),t("./CCTextAsset"),t("./CCJsonAsset"),t("./CCBufferAsset"),t("./material")},{"./CCAsset":62,"./CCAudioClip":63,"./CCBitmapFont":64,"./CCBufferAsset":65,"./CCFont":66,"./CCJsonAsset":67,"./CCLabelAtlas":68,"./CCPrefab":69,"./CCRenderTexture":70,"./CCSceneAsset":71,"./CCScripts":72,"./CCSpriteAtlas":73,"./CCSpriteFrame":74,"./CCTTFFont":75,"./CCTextAsset":76,"./CCTexture2D":77,"./CCVideoClip":78,"./material":86}],80:[function(t,e){var i,r=(i=t("../CCAsset"))&&i.__esModule?i:{default:i},n=t("./effect-parser"),s=cc.Class({name:"cc.EffectAsset",extends:r.default,ctor:function(){this._effect=null},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){for(var t=cc.renderer._forward._programLib,e=0;e<this.shaders.length;e++)t.define(this.shaders[e]);this._initEffect()}},_initEffect:function(){this._effect||(this._effect=(0,n.parseEffect)(this),Object.freeze(this._effect))},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone()},getEffect:function(){return this._initEffect(),this._effect}});e.exports=cc.EffectAsset=s},{"../CCAsset":62,"./effect-parser":83}],81:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("../CCAsset"),n=t("../CCTexture2D"),s=(n.PixelFormat,t("./CCEffectAsset")),o=(t("../../utils/texture-util"),cc.gfx),a=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"}),l=cc.Class({name:"cc.Material",extends:r,ctor:function(){this.loaded=!1,this._manualHash=!1,this._dirty=!0,this._effect=null},properties:{_defines:{default:void 0,type:Object},_props:{default:void 0,type:Object},_effectAsset:{type:s,default:null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset},set:function(t){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(this._effectAsset=t,t?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."))}},effect:{get:function(){return this._effect}},techniqueIndex:{get:function(){return this._techniqueIndex},set:function(t){this._techniqueIndex=t,this._effect.switchTechnique(t)}}},statics:{getBuiltinMaterial:function(t){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material:cc.assetManager.builtins.getBuiltin("material","builtin-"+t)},BUILTIN_NAME:a,createWithBuiltin:function(t,e){void 0===e&&(e=0);var i=cc.assetManager.builtins.getBuiltin("effect","builtin-"+t);return l.create(i,e)},create:function(t,e){if(void 0===e&&(e=0),!t)return null;var i=new l;return i.effectAsset=t,i.techniqueIndex=e,i}},setProperty:function(t,e,i,r){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof i&&(i=parseInt(i)),e instanceof n){var s=e.isAlphaAtlas(),o="CC_USE_ALPHA_ATLAS_"+t,a=this.getDefine(o,i);(s||a)&&this.define(o,s),e.loaded||cc.assetManager.postLoadNative(e)}this._effect.setProperty(t,e,i,r)}},getProperty:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getProperty(t,e)},define:function(t,e,i,r){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof i&&(i=parseInt(i)),this._effect.define(t,e,i,r))},getDefine:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getDefine(t,e)},setCullMode:function(t,e){void 0===t&&(t=o.CULL_BACK),this._effect.setCullMode(t,e)},setDepth:function(t,e,i,r){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=o.DS_FUNC_LESS),this._effect.setDepth(t,e,i,r)},setBlend:function(t,e,i,r,n,s,a,l,c){void 0===t&&(t=!1),void 0===e&&(e=o.BLEND_FUNC_ADD),void 0===i&&(i=o.BLEND_SRC_ALPHA),void 0===r&&(r=o.BLEND_ONE_MINUS_SRC_ALPHA),void 0===n&&(n=o.BLEND_FUNC_ADD),void 0===s&&(s=o.BLEND_SRC_ALPHA),void 0===a&&(a=o.BLEND_ONE_MINUS_SRC_ALPHA),void 0===l&&(l=4294967295),this._effect.setBlend(t,e,i,r,n,s,a,l,c)},setStencilEnabled:function(t,e){void 0===t&&(t=o.STENCIL_INHERIT),this._effect.setStencilEnabled(t,e)},setStencil:function(t,e,i,r,n,s,a,l,c){void 0===t&&(t=o.STENCIL_INHERIT),void 0===e&&(e=o.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===r&&(r=255),void 0===n&&(n=o.STENCIL_OP_KEEP),void 0===s&&(s=o.STENCIL_OP_KEEP),void 0===a&&(a=o.STENCIL_OP_KEEP),void 0===l&&(l=255),this._effect.setStencil(t,e,i,r,n,s,a,l,c)},updateHash:function(t){this._manualHash=t,this._effect&&this._effect.updateHash(t)},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash()},onLoad:function(){if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex),this._techniqueData=this._techniqueData||{};var t=this._techniqueData;for(var e in t){var i=t[e=parseInt(e)];if(i){for(var r in i.defines)this.define(r,i.defines[r],e);for(var n in i.props)this.setProperty(n,i.props[n],e)}}}}}),c=l;i.default=c,cc.Material=l,e.exports=i.default},{"../../utils/texture-util":279,"../CCAsset":62,"../CCTexture2D":77,"./CCEffectAsset":80}],82:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("../../../renderer/core/pass")),n=s(t("../../../renderer/enums"));function s(t){return t&&t.__esModule?t:{default:t}}var o=cc.gfx,a=function(){function t(){this._dirty=!0,this._name="",this._technique=null}var e,i,s=t.prototype;return s._createPassProp=function(t,e){var i=e._properties[t];if(i){var r=Object.create(null);return r.name=t,r.type=i.type,i.value instanceof Float32Array?r.value=new Float32Array(i.value):i.value instanceof Float64Array?r.value=new Float64Array(i.value):r.value=i.value,e._properties[t]=r,r}},s._setPassProperty=function(t,e,i,s){var o=i._properties;o.hasOwnProperty(t)||this._createPassProp(t,i);var a=o[t],l=e;return a.type===n.default.PARAM_TEXTURE_2D&&(l=e&&e.getImpl()),a.value===l||(this._dirty=!0,r.default.prototype.setProperty.call(i,t,e,s))},s.setProperty=function(t,e,i,r){var n=!1,s=this.passes,o=0,a=s.length;void 0!==i&&(o=i,a=i+1);for(var l=o;l<a;l++)this._setPassProperty(t,e,s[l],r)&&(n=!0);n||cc.warnID(9103,this.name,t)},s.getProperty=function(t,e){var i=this.passes;if(!(e>=i.length)){var r=0,n=i.length;void 0!==e&&(r=e,n=e+1);for(var s=r;s<n;s++){var o=i[s].getProperty(t);if(void 0!==o)return o}}},s.define=function(t,e,i,r){var n=!1,s=this.passes,o=0,a=s.length;void 0!==i&&(o=i,a=i+1);for(var l=o;l<a;l++)s[l].define(t,e,r)&&(n=!0);n||cc.warnID(9104,this.name,t)},s.getDefine=function(t,e){var i=this.passes;if(!(e>=i.length)){var r=0,n=i.length;void 0!==e&&(r=e,n=e+1);for(var s=r;s<n;s++){var o=i[s].getDefine(t);if(void 0!==o)return o}}},s.setCullMode=function(t,e){void 0===t&&(t=o.CULL_BACK);var i=this.passes,r=0,n=i.length;void 0!==e&&(r=e,n=e+1);for(var s=r;s<n;s++)i[s].setCullMode(t);this._dirty=!0},s.setDepth=function(t,e,i,r){var n=this.passes,s=0,o=n.length;void 0!==r&&(s=r,o=r+1);for(var a=s;a<o;a++)n[a].setDepth(t,e,i);this._dirty=!0},s.setBlend=function(t,e,i,r,n,s,o,a,l){var c=this.passes,h=0,u=c.length;void 0!==l&&(h=l,u=l+1);for(var d=h;d<u;d++)c[d].setBlend(t,e,i,r,n,s,o,a);this._dirty=!0},s.setStencilEnabled=function(t,e){void 0===t&&(t=o.STENCIL_INHERIT);var i=this.passes,r=0,n=i.length;void 0!==e&&(r=e,n=e+1);for(var s=r;s<n;s++)i[s].setStencilEnabled(t);this._dirty=!0},s.setStencil=function(t,e,i,r,n,s,o,a,l){var c=this.passes,h=0,u=c.length;void 0!==l&&(h=l,u=l+1);for(var d=h;d<u;d++){var p=c[d];p.setStencilFront(t,e,i,r,n,s,o,a),p.setStencilBack(t,e,i,r,n,s,o,a)}this._dirty=!0},e=t,(i=[{key:"name",get:function(){return this._name}},{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return[]}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=a,cc.EffectBase=a,e.exports=i.default},{"../../../renderer/core/pass":310,"../../../renderer/enums":314}],83:[function(t,e,i){i.__esModule=!0,i.parseEffect=function(t){var e=function(t){for(var e=t.techniques.length,i=new Array(e),n=0;n<e;++n){for(var s=t.techniques[n],o=s.name||n,l=s.passes.length,c=new Array(l),d=0;d<l;++d){var p=s.passes[d],f=p.name||d,_=t.name+"-"+o+"-"+f,m=p.stage||"opaque",g=h(t,p),y=u(p),v=c[d]=new r.default(f,_,p.program,m,g,y);p.rasterizerState&&v.setCullMode(p.rasterizerState.cullMode);var b=p.blendState&&p.blendState.targets[0];b&&v.setBlend(b.blend,b.blendEq,b.blendSrc,b.blendDst,b.blendAlphaEq,b.blendSrcAlpha,b.blendDstAlpha,b.blendColor);var x=p.depthStencilState;x&&(v.setDepth(x.depthTest,x.depthWrite,x.depthFunc),v.setStencilFront(x.stencilTest,x.stencilFuncFront,x.stencilRefFront,x.stencilMaskFront,x.stencilFailOpFront,x.stencilZFailOpFront,x.stencilZPassOpFront,x.stencilWriteMaskFront),v.setStencilBack(x.stencilTest,x.stencilFuncBack,x.stencilRefBack,x.stencilMaskBack,x.stencilFailOpBack,x.stencilZFailOpBack,x.stencilZPassOpBack,x.stencilWriteMaskBack))}i[n]=new a.default(o,c)}return i}(t);return new o.default(t.name,e,0,t)};var r=l(t("../../../renderer/core/pass")),n=t("../../../renderer/types"),s=l(t("../../../renderer/enums")),o=l(t("./effect")),a=l(t("../../../renderer/core/technique"));function l(t){return t&&t.__esModule?t:{default:t}}function c(t){return cc.renderer._forward._programLib.getTemplate(t)}function h(t,e){var i=e.properties||{},r=c(e.program),o=function(e){if(!r.uniforms.find((function(t){return t.name===e})))return cc.warnID(9107,t.name,e),"continue"};for(var a in i)o(a);var l={};return r.uniforms.forEach((function(t){var e,r=t.name,o=l[r]=Object.assign({},t),a=i[r];void 0===(e=a?a.type===s.default.PARAM_TEXTURE_2D?null:a.type===s.default.PARAM_INT||a.type===s.default.PARAM_FLOAT?Array.isArray(a.value)?a.value[0]:a.value:new Float32Array(a.value):n.enums2default[t.type])&&(e=null),o.value=e})),l}function u(t){var e={};return c(t.program).defines.forEach((function(t){e[t.name]=n.enums2default[t.type]})),e}},{"../../../renderer/core/pass":310,"../../../renderer/core/technique":312,"../../../renderer/enums":314,"../../../renderer/types":342,"./effect":85}],84:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("../../../renderer/murmurhash2_gc")),n=o(t("./utils")),s=o(t("./effect-base"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}cc.gfx;var l=function(t){var e,i;function s(e){var i;return(i=t.call(this)||this)._effect=void 0,i._passes=[],i._stagePasses={},i._hash=0,i.init(e),i}i=t,(e=s).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var o,l,c=s.prototype;return c._onEffectChanged=function(){},c.init=function(t){if(t instanceof s&&(t=t.effect),this._effect=t,this._dirty=!0,t){var e=t.passes,i=this._passes;i.length=0;for(var r=this._stagePasses={},n=0;n<e.length;n++){var o=i[n]=Object.setPrototypeOf({},e[n]);o._properties=Object.setPrototypeOf({},e[n]._properties),o._defines=Object.setPrototypeOf({},e[n]._defines),r[o._stage]||(r[o._stage]=[]),r[o._stage].push(o)}}},c.updateHash=function(){},c.getHash=function(){if(!this._dirty)return this._hash;this._dirty=!1;var t="";t+=n.default.serializePasses(this._passes);var e=this._effect;return e&&(t+=n.default.serializePasses(e.passes)),this._hash=(0,r.default)(t,666),this.updateHash(this._hash),this._hash},o=s,(l=[{key:"effect",get:function(){return this._effect}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)"}},{key:"passes",get:function(){return this._passes}},{key:"stagePasses",get:function(){return this._stagePasses}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(o.prototype,l),Object.defineProperty(o,"prototype",{writable:!1}),s}(s.default);i.default=l,cc.EffectVariant=l,e.exports=i.default},{"../../../renderer/murmurhash2_gc":337,"./effect-base":82,"./utils":89}],85:[function(t,e,i){var r;function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0;var s=function(t){var e,i;function r(e,i,r,n){var s;return(s=t.call(this)||this)._techniques=[],s._asset=null,s.init(e,i,r,n,!0),s}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var s,o,a=r.prototype;return a.init=function(t,e,i,r){this._name=t,this._techniques=e,this._technique=e[i],this._asset=r},a.switchTechnique=function(t){t>=this._techniques.length?cc.warn("Can not switch to technique with index ["+t+"]"):this._technique=this._techniques[t]},a.clear=function(){this._techniques=[]},a.clone=function(){for(var t=[],e=0;e<this._techniques.length;e++)t.push(this._techniques[e].clone());var i=this._techniques.indexOf(this._technique);return new r(this._name,t,i,this._asset)},s=r,(o=[{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return this._technique.passes}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(s.prototype,o),Object.defineProperty(s,"prototype",{writable:!1}),r}(((r=t("./effect-base"))&&r.__esModule?r:{default:r}).default);i.default=s,cc.Effect=s,e.exports=i.default},{"./effect-base":82}],86:[function(t){t("./CCEffectAsset"),t("./CCMaterial"),t("./material-variant")},{"./CCEffectAsset":80,"./CCMaterial":81,"./material-variant":88}],87:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("./utils")),n=s(t("../../utils/pool"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a=new(function(t){var e,i;function n(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).enabled=!1,e._pool={},e}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var s=n.prototype;return s.get=function(t,e){var i,n=this._pool;if(t instanceof cc.MaterialVariant){if(!t._owner)return t._owner=e,t;if(t._owner===e)return t;t=t.material}if(this.enabled){var s=t.effectAsset._uuid;if(n[s]){var o=r.default.serializeDefines(t._effect._defines)+r.default.serializeTechniques(t._effect._techniques);i=n[s][o]&&n[s][o].pop()}}return i?this.count--:((i=new cc.MaterialVariant(t))._name=t._name+" (Instance)",i._uuid=t._uuid),i._owner=e,i},s.put=function(t){if(this.enabled&&t._owner){var e=this._pool,i=t.effectAsset._uuid;e[i]||(e[i]={});var n=r.default.serializeDefines(t._effect._defines)+r.default.serializeTechniques(t._effect._techniques);e[i][n]||(e[i][n]=[]),this.count>this.maxSize||(this._clean(t),e[i][n].push(t),this.count++)}},s.clear=function(){this._pool={},this.count=0},s._clean=function(t){t._owner=null},n}(n.default));n.default.register("material",a);var l=a;i.default=l,e.exports=i.default},{"../../utils/pool":273,"./utils":89}],88:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=a(t("./CCMaterial")),s=a(t("./effect-variant")),o=a(t("./material-pool"));function a(t){return t&&t.__esModule?t:{default:t}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var c=(0,cc._decorator.ccclass)("cc.MaterialVariant")(r=function(t){var e,i,r,a;function c(e){var i;return(i=t.call(this)||this)._owner=null,i._material=null,i.init(e),i}return i=t,(e=c).prototype=Object.create(i.prototype),e.prototype.constructor=e,l(e,i),c.createWithBuiltin=function(t,e){return c.create(n.default.getBuiltinMaterial(t),e)},c.create=function(t,e){return t?o.default.get(t,e):null},c.prototype.init=function(t){this._effect=new s.default(t.effect),this._effectAsset=t._effectAsset,this._material=t},r=c,(a=[{key:"uuid",get:function(){return this._material._uuid}},{key:"owner",get:function(){return this._owner}},{key:"material",get:function(){return this._material}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,a),Object.defineProperty(r,"prototype",{writable:!1}),c}(n.default))||r;i.default=c,cc.MaterialVariant=c,e.exports=i.default},{"./CCMaterial":81,"./effect-variant":84,"./material-pool":87}],89:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../renderer/enums"))&&r.__esModule?r:{default:r},s=[];function o(t,e){for(var i=e.length,r=0;r<i;r++){var n=e[r];s[r]=n+t[n]}return s.length=i,s.join("")}function a(t,e){for(var i=0,r=0,o=e.length;r<o;r++){var a=t[e[r]],l=a.value;l&&(a.type===n.default.PARAM_TEXTURE_2D||a.type===n.default.PARAM_TEXTURE_CUBE?s[i]=l._id:s[i]=l.toString(),i++)}return s.length=i,s.join(";")}var l={serializeDefines:o,serializePasses:function(t){for(var e,i,r="",n=0;n<t.length;n++)r+=(i=void 0,i=(e=t[n])._programName+e._cullMode,e._blend&&(i+=e._blendEq+e._blendAlphaEq+e._blendSrc+e._blendDst+e._blendSrcAlpha+e._blendDstAlpha+e._blendColor),e._depthTest&&(i+=e._depthWrite+e._depthFunc),e._stencilTest&&(i+=e._stencilFuncFront+e._stencilRefFront+e._stencilMaskFront+e._stencilFailOpFront+e._stencilZFailOpFront+e._stencilZPassOpFront+e._stencilWriteMaskFront+e._stencilFuncBack+e._stencilRefBack+e._stencilMaskBack+e._stencilFailOpBack+e._stencilZFailOpBack+e._stencilZPassOpBack+e._stencilWriteMaskBack),i+=a(e._properties,e._propertyNames),i+=o(e._defines,e._defineNames));return r},serializeUniforms:a};i.default=l,e.exports=i.default},{"../../../renderer/enums":314}],90:[function(t,e){t("../CCNode").EventType;var i=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});var r=cc.Vec2.ZERO,n=cc.Vec2.ONE;function s(t,e){var i,s,o,a=e._target;a?function(t,e,i,r){for(var n=t._parent.scaleX,s=t._parent.scaleY,o=0,a=0,l=t._parent;;){if(o+=l.x,a+=l.y,!(l=l._parent))return i.x=i.y=0,void(r.x=r.y=1);if(l===e)break;var c=l.scaleX,h=l.scaleY;o*=c,a*=h,n*=c,s*=h}r.x=0!==n?1/n:1,r.y=0!==s?1/s:1,i.x=-o,i.y=-a}(t,i=a,s=r,o=n):i=t._parent;var l,c=(l=i)instanceof cc.Scene?cc.visibleRect:l._contentSize,h=i._anchorPoint,u=i instanceof cc.Scene,d=t.x,p=t.y,f=t._anchorPoint;if(56&e._alignFlags){var _,m,g=c.width;u?(_=cc.visibleRect.left.x,m=cc.visibleRect.right.x):m=(_=-h.x*g)+g,_+=e._isAbsLeft?e._left:e._left*g,m-=e._isAbsRight?e._right:e._right*g,a&&(_+=s.x,_*=o.x,m+=s.x,m*=o.x);var y,v=f.x,b=t.scaleX;if(b<0&&(v=1-v,b=-b),e.isStretchWidth)y=m-_,0!==b&&(t.width=y/b),d=_+v*y;else if(y=t.width*b,e.isAlignHorizontalCenter){var x=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*g,T=(.5-h.x)*c.width;a&&(x*=o.x,T+=s.x,T*=o.x),d=T+(v-.5)*y+x}else d=e.isAlignLeft?_+v*y:m+(v-1)*y}if(7&e._alignFlags){var C,S,w=c.height;u?(S=cc.visibleRect.bottom.y,C=cc.visibleRect.top.y):C=(S=-h.y*w)+w,S+=e._isAbsBottom?e._bottom:e._bottom*w,C-=e._isAbsTop?e._top:e._top*w,a&&(S+=s.y,S*=o.y,C+=s.y,C*=o.y);var A,E=f.y,D=t.scaleY;if(D<0&&(E=1-E,D=-D),e.isStretchHeight)A=C-S,0!==D&&(t.height=A/D),p=S+E*A;else if(A=t.height*D,e.isAlignVerticalCenter){var L=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*w,I=(.5-h.y)*c.height;a&&(L*=o.y,I+=s.y,I*=o.y),p=I+(E-.5)*A+L}else p=e.isAlignBottom?S+E*A:C+(E-1)*A}t.setPosition(d,p)}function o(t){var e=t._widget;e&&(s(t,e),e.alignMode!==i.ALWAYS?c.remove(e):l.push(e));for(var r=t._children,n=0;n<r.length;n++){var a=r[n];a._active&&o(a)}}function a(){var t=cc.director.getScene();if(t){if(c.isAligning=!0,c._nodesOrderDirty)l.length=0,o(t),c._nodesOrderDirty=!1;else{var e,i=c._activeWidgetsIterator;for(i.i=0;i.i<l.length;++i.i)s((e=l[i.i]).node,e)}c.isAligning=!1}}var l=[],c=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(l),init:function(t){t.on(cc.Director.EVENT_AFTER_UPDATE,a);var e=this.onResized.bind(this);cc.view.on("canvas-resize",e),window.addEventListener("orientationchange",e)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},onResized:function(){var t=cc.director.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=cc.Node.isNode(t)&&t.getComponent(cc.Widget);e&&e.enabled&&e.alignMode===i.ON_WINDOW_RESIZE&&this.add(e);for(var r=t._children,n=0;n<r.length;n++){var s=r[n];this.refreshWidgetOnResized(s)}},updateAlignment:function t(e){var i=e._parent;cc.Node.isNode(i)&&t(i);var r=e._widget||e.getComponent(cc.Widget);r&&i&&s(e,r)},AlignMode:i}},{"../CCNode":29}],91:[function(t,e){var i=t("../value-types"),r=t("../geom-utils"),n=t("../utils/affine-transform"),s=t("../renderer/index"),o=t("../renderer/render-flow"),a=t("../CCGame"),l=null;l=t("../../renderer/scene/camera");var c=cc.mat4(),h=cc.mat4(),u=cc.v3(),d=cc.v3(),p=cc.v3(),f=[];function _(){for(var t=0,e=Number.MAX_VALUE;t<f.length;t++){var i=f[t];i._depth<e&&(b.main=i,e=i._depth)}}var m=null;function g(){if(m){var t=m.getNode(),e=cc.game.canvas;t.z=e.height/1.1566,t.x=e.width/2,t.y=e.height/2}}var y=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),v=cc.Enum({OPAQUE:1,TRANSPARENT:2}),b=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){if(a.renderType!==a.RENDER_TYPE_CANVAS){var t=new l;t.setStages(["opaque"]),t.dirty=!0,this._inited=!1,this._camera=t}else this._inited=!0},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:y.DEPTH|y.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio},set:function(t){this._zoomRatio=t},tooltip:!1},fov:{get:function(){return this._fov},set:function(t){this._fov=t},tooltip:!1},orthoSize:{get:function(){return this._orthoSize},set:function(t){this._orthoSize=t},tooltip:!1},nearClip:{get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._updateClippingpPlanes()},tooltip:!1},farClip:{get:function(){return this._farClip},set:function(t){this._farClip=t,this._updateClippingpPlanes()},tooltip:!1},ortho:{get:function(){return this._ortho},set:function(t){this._ortho=t,this._updateProjection()},tooltip:!1},rect:{get:function(){return this._rect},set:function(t){this._rect=t,this._updateRect()},tooltip:!1},cullingMask:{get:function(){return this._cullingMask},set:function(t){this._cullingMask=t,this._updateCameraMask()},tooltip:!1},clearFlags:{get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&this._camera.setClearFlags(t)},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor.equals(t)||(this._backgroundColor.set(t),this._updateBackgroundColor())},tooltip:!1},depth:{get:function(){return this._depth},set:function(t){b.main===this?this._depth<t&&_():b.main&&t<b.main._depth&&f.includes(this)&&(b.main=this),this._depth=t,this._camera&&this._camera.setPriority(t)},tooltip:!1},targetTexture:{get:function(){return this._targetTexture},set:function(t){this._targetTexture=t,this._updateTargetTexture()},tooltip:!1},renderStages:{get:function(){return this._renderStages},set:function(t){this._renderStages=t,this._updateStages()},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen},set:function(t){this._alignWithScreen=t}},_is3D:{get:function(){return this.node&&this.node._is3DNode}}},statics:{main:null,cameras:f,ClearFlags:y,findCamera:function(t){for(var e=0,i=f.length;e<i;e++){var r=f[e];if(r.containsNode(t))return r}return null},_findRendererCamera:function(t){for(var e=s.scene._cameras,i=0;i<e._count;i++)if(e._data[i]._cullingMask&t._cullingMask)return e._data[i];return null},_setupDebugCamera:function(){if(!m&&a.renderType!==a.RENDER_TYPE_CANVAS){var t=new l;m=t,t.setStages(["opaque"]),t.setFov(60*Math.PI/180),t.setNear(.1),t.setFar(4096),t.dirty=!0,t.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,t.setPriority(cc.macro.MAX_ZINDEX),t.setClearFlags(0),t.setColor(0,0,0,0);var e=new cc.Node;t.setNode(e),g(),cc.view.on("design-resolution-changed",g),s.scene.addCamera(t)}}},_updateCameraMask:function(){if(this._camera){var t=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG);this._camera.cullingMask=t}},_updateBackgroundColor:function(){if(this._camera){var t=this._backgroundColor;this._camera.setColor(t.r/255,t.g/255,t.b/255,t.a/255)}},_updateTargetTexture:function(){if(this._camera){var t=this._targetTexture;this._camera.setFrameBuffer(t?t._framebuffer:null)}},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){if(this._camera){var t=this._ortho?1:0;this._camera.setType(t)}},_updateRect:function(){if(this._camera){var t=this._rect;this._camera.setRect(t.x,t.y,t.width,t.height)}},_updateStages:function(){var t=this._renderStages,e=[];t&v.OPAQUE&&e.push("opaque"),t&v.TRANSPARENT&&e.push("transparent"),this._camera.setStages(e)},_init:function(){if(!this._inited){this._inited=!0;var t=this._camera;t&&(t.setNode(this.node),t.setClearFlags(this._clearFlags),t.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw())}},__preload:function(){this._init()},onEnable:function(){a.renderType!==a.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),s.scene.addCamera(this._camera)),f.push(this),(!b.main||this._depth<b.main._depth)&&(b.main=this)},onDisable:function(){a.renderType!==a.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),s.scene.removeCamera(this._camera)),cc.js.array.fastRemove(f,this),b.main===this&&(b.main=null,_())},getScreenToWorldMatrix2D:function(t){return this.getWorldToScreenMatrix2D(t),i.Mat4.invert(t,t),t},getWorldToScreenMatrix2D:function(t){this.node.getWorldRT(c);var e=this.zoomRatio,r=c.m;r[0]*=e,r[1]*=e,r[4]*=e,r[5]*=e;var n=r[12],s=r[13],o=cc.visibleRect.center;return r[12]=o.x-(r[0]*n+r[4]*s),r[13]=o.y-(r[1]*n+r[5]*s),t!==c&&i.Mat4.copy(t,c),t},getScreenToWorldPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.screenToWorld(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getScreenToWorldMatrix2D(c),i.Vec2.transformMat4(e,t,c)),e},getWorldToScreenPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3,this._camera.worldToScreen(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2,this.getWorldToScreenMatrix2D(c),i.Vec2.transformMat4(e,t,c)),e},getRay:function(t){return cc.geomUtils?(i.Vec3.set(p,t.x,t.y,1),this._camera.screenToWorld(d,p,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(i.Vec3.set(p,t.x,t.y,-1),this._camera.screenToWorld(u,p,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(u),r.Ray.fromPoints(new r.Ray,u,d)):t},containsNode:function(t){return(t._cullingMask&this.cullingMask)>0},render:function(t){if(!(t=t||cc.director.getScene()))return null;this.node.getWorldMatrix(c),this.beforeDraw(),o.renderCamera(this._camera,t)},_onAlignWithScreen:function(){var t=cc.game.canvas.height/cc.view._scaleY;this._targetTexture&&(t=cc.visibleRect.height);var e=this._fov*cc.macro.RAD;this.node.z=t/(2*Math.tan(e/2)),e=2*Math.atan(Math.tan(e/2)/this.zoomRatio),this._camera.setFov(e),this._camera.setOrthoHeight(t/2/this.zoomRatio),this.node.setRotation(0,0,0,1)},beforeDraw:function(){if(this._camera){if(this._alignWithScreen)this._onAlignWithScreen();else{var t=this._fov*cc.macro.RAD;t=2*Math.atan(Math.tan(t/2)/this.zoomRatio),this._camera.setFov(t),this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)}this._camera.dirty=!0}}});cc.js.mixin(b.prototype,{getNodeToCameraTransform:function(t){var e=n.identity();return t.getWorldMatrix(h),this.containsNode(t)&&(this.getWorldToCameraMatrix(c),i.Mat4.mul(h,h,c)),n.fromMat4(e,h),e},getCameraToWorldPoint:function(t,e){return this.getScreenToWorldPoint(t,e)},getWorldToCameraPoint:function(t,e){return this.getWorldToScreenPoint(t,e)},getCameraToWorldMatrix:function(t){return this.getScreenToWorldMatrix2D(t)},getWorldToCameraMatrix:function(t){return this.getWorldToScreenMatrix2D(t)}}),e.exports=cc.Camera=b},{"../../renderer/scene/camera":339,"../CCGame":28,"../geom-utils":151,"../renderer/index":227,"../renderer/render-flow":228,"../utils/affine-transform":262,"../value-types":286}],92:[function(t,e){cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}},resetInEditor:!1});var i=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=e.exports=i},{}],93:[function(t,e){cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}},resetInEditor:!1});var i=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=e.exports=i},{}],94:[function(t,e){var i=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=e.exports=i},{}],95:[function(t,e){var i,r=(i=t("../value-types/vec2"))&&i.__esModule?i:{default:i},n=t("./CCContact"),s=n.CollisionType,o=t("../CCNode").EventType,a=new r.default;var l=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(){if(this.enabled){var t,e,i=this._colliders;for(t=0,e=i.length;t<e;t++)this.updateCollider(i[t]);var r=this._contacts,n=[];for(t=0,e=r.length;t<e;t++){var o=r[t].updateState();o!==s.None&&n.push([o,r[t]])}for(t=0,e=n.length;t<e;t++){var a=n[t];this._doCollide(a[0],a[1])}this.drawColliders()}},_doCollide:function(t,e){var i;switch(t){case s.CollisionEnter:i="onCollisionEnter";break;case s.CollisionStay:i="onCollisionStay";break;case s.CollisionExit:i="onCollisionExit"}var r,n,o,a=e.collider1,l=e.collider2,c=a.node._components,h=l.node._components;for(r=0,n=c.length;r<n;r++)(o=c[r])[i]&&o[i](l,a);for(r=0,n=h.length;r<n;r++)(o=h[r])[i]&&o[i](a,l)},shouldCollide:function(t,e){var i=t.node,r=e.node,n=cc.game.collisionMatrix;return i!==r&&n[i.groupIndex][r.groupIndex]},initCollider:function(t){if(!t.world){var e=t.world={};e.aabb=cc.rect(),e.preAabb=cc.rect(),e.matrix=cc.mat4(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.map((function(t){return cc.v2(t.x,t.y)}))):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null)}},updateCollider:function(t){var e=t.offset,i=t.world,n=i.aabb,s=i.matrix;t.node.getWorldMatrix(s);var o=i.preAabb;if(o.x=n.x,o.y=n.y,o.width=n.width,o.height=n.height,t instanceof cc.BoxCollider){var l=t.size;n.x=e.x-l.width/2,n.y=e.y-l.height/2,n.width=l.width,n.height=l.height;var c=i.points,h=c[0],u=c[1],d=c[2],p=c[3];!function(t,e,i,r,n,s){var o=t.x,a=t.y,l=t.width,c=t.height,h=e.m,u=h[0],d=h[1],p=h[4],f=h[5],_=u*o+p*a+h[12],m=d*o+f*a+h[13],g=u*l,y=d*l,v=p*c,b=f*c;r.x=_,r.y=m,n.x=g+_,n.y=y+m,i.x=v+_,i.y=b+m,s.x=g+v+_,s.y=y+b+m}(n,s,h,u,d,p);var f=Math.min(h.x,u.x,d.x,p.x),_=Math.min(h.y,u.y,d.y,p.y),m=Math.max(h.x,u.x,d.x,p.x),g=Math.max(h.y,u.y,d.y,p.y);n.x=f,n.y=_,n.width=m-f,n.height=g-_}else if(t instanceof cc.CircleCollider){r.default.transformMat4(a,t.offset,s),i.position.x=a.x,i.position.y=a.y;var y=s.m,v=y[12],b=y[13];y[12]=y[13]=0,a.x=t.radius,a.y=0,r.default.transformMat4(a,a,s);var x=Math.sqrt(a.x*a.x+a.y*a.y);i.radius=x,n.x=i.position.x-x,n.y=i.position.y-x,n.width=2*x,n.height=2*x,y[12]=v,y[13]=b}else if(t instanceof cc.PolygonCollider){var T=t.points,C=i.points;C.length=T.length;for(var S=1e6,w=1e6,A=-1e6,E=-1e6,D=0,L=T.length;D<L;D++){C[D]||(C[D]=cc.v2()),a.x=T[D].x+e.x,a.y=T[D].y+e.y,r.default.transformMat4(a,a,s);var I=a.x,P=a.y;C[D].x=I,C[D].y=P,I>A&&(A=I),I<S&&(S=I),P>E&&(E=P),P<w&&(w=P)}n.x=S,n.y=w,n.width=A-S,n.height=E-w}},addCollider:function(t){var e=this._colliders;if(-1===e.indexOf(t)){for(var i=0,r=e.length;i<r;i++){var s=e[i];if(this.shouldCollide(t,s)){var a=new n(t,s);this._contacts.push(a)}}e.push(t),this.initCollider(t)}t.node.on(o.GROUP_CHANGED,this.onNodeGroupChanged,this)},removeCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(i>=0){e.splice(i,1);for(var r=this._contacts,n=r.length-1;n>=0;n--){var a=r[n];a.collider1!==t&&a.collider2!==t||(a.touching&&this._doCollide(s.CollisionExit,a),r.splice(n,1))}t.node.off(o.GROUP_CHANGED,this.onNodeGroupChanged,this)}else cc.errorID(6600)},onNodeGroupChanged:function(t){for(var e=t.getComponents(cc.Collider),i=0,r=e.length;i<r;i++){var n=e[i];cc.PhysicsCollider&&n instanceof cc.PhysicsCollider||(this.removeCollider(n),this.addCollider(n))}},drawColliders:function(){if(this._enabledDebugDraw){this._checkDebugDrawValid();var t=this._debugDrawer;t.clear();for(var e=this._colliders,i=0,r=e.length;i<r;i++){var n=e[i];if(t.strokeColor=cc.Color.WHITE,n instanceof cc.BoxCollider||n instanceof cc.PolygonCollider){var s=n.world.points;if(s.length>0){t.moveTo(s[0].x,s[0].y);for(var o=1;o<s.length;o++)t.lineTo(s[o].x,s[o].y);t.close(),t.stroke()}}else n instanceof cc.CircleCollider&&(t.circle(n.world.position.x,n.world.position.y,n.world.radius),t.stroke());if(this.enabledDrawBoundingBox){var a=n.world.aabb;t.strokeColor=cc.Color.BLUE,t.moveTo(a.xMin,a.yMin),t.lineTo(a.xMin,a.yMax),t.lineTo(a.xMax,a.yMax),t.lineTo(a.xMax,a.yMin),t.close(),t.stroke()}}}},_checkDebugDrawValid:function(){if(!this._debugDrawer||!this._debugDrawer.isValid){var t=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW");t.zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics)}}});cc.js.getset(l.prototype,"enabledDebugDraw",(function(){return this._enabledDebugDraw}),(function(t){t&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1),this._enabledDebugDraw=t})),cc.CollisionManager=e.exports=l},{"../CCNode":29,"../value-types/vec2":295,"./CCContact":96}],96:[function(t,e){var i=t("./CCIntersection"),r=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});function n(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var r=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider,s=t instanceof cc.CircleCollider,o=e instanceof cc.CircleCollider;r&&n?this.testFunc=i.polygonPolygon:s&&o?this.testFunc=i.circleCircle:r&&o?this.testFunc=i.polygonCircle:s&&n?(this.testFunc=i.polygonCircle,this.collider1=e,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(e))}n.prototype.test=function(){var t=this.collider1.world,e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===i.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===i.circleCircle?this.testFunc(t,e):this.testFunc===i.polygonCircle&&this.testFunc(t.points,e))},n.prototype.updateState=function(){var t=this.test(),e=r.None;return t&&!this.touching?(this.touching=!0,e=r.CollisionEnter):t&&this.touching?e=r.CollisionStay:!t&&this.touching&&(this.touching=!1,e=r.CollisionExit),e},n.CollisionType=r,e.exports=n},{"./CCIntersection":97}],97:[function(t,e){var i={};function r(t,e,i,r){var n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!==o){var a=n/o,l=s/o;if(0<=a&&a<=1&&0<=l&&l<=1)return!0}return!1}function n(t,e,i){for(var n=i.length,s=0;s<n;++s)if(r(t,e,i[s],i[(s+1)%n]))return!0;return!1}function s(t,e){for(var i=!1,r=t.x,n=t.y,s=e.length,o=0,a=s-1;o<s;a=o++){var l=e[o].x,c=e[o].y,h=e[a].x,u=e[a].y;c>n!=u>n&&r<(h-l)*(n-c)/(u-c)+l&&(i=!i)}return i}function o(t,e,i,r){var n,s=i.x-e.x,o=i.y-e.y,a=s*s+o*o,l=((t.x-e.x)*s+(t.y-e.y)*o)/a;return n=r?a?l<0?e:l>1?i:cc.v2(e.x+l*s,e.y+l*o):e:cc.v2(e.x+l*s,e.y+l*o),s=t.x-n.x,o=t.y-n.y,Math.sqrt(s*s+o*o)}i.lineLine=r,i.lineRect=function(t,e,i){var n=new cc.Vec2(i.x,i.y),s=new cc.Vec2(i.x,i.yMax),o=new cc.Vec2(i.xMax,i.yMax),a=new cc.Vec2(i.xMax,i.y);return!!(r(t,e,n,s)||r(t,e,s,o)||r(t,e,o,a)||r(t,e,a,n))},i.linePolygon=n,i.rectRect=function(t,e){var i=t.x,r=t.y,n=t.x+t.width,s=t.y+t.height,o=e.x,a=e.y,l=e.x+e.width,c=e.y+e.height;return i<=l&&n>=o&&r<=c&&s>=a},i.rectPolygon=function(t,e){var i,r,o=new cc.Vec2(t.x,t.y),a=new cc.Vec2(t.x,t.yMax),l=new cc.Vec2(t.xMax,t.yMax),c=new cc.Vec2(t.xMax,t.y);if(n(o,a,e))return!0;if(n(a,l,e))return!0;if(n(l,c,e))return!0;if(n(c,o,e))return!0;for(i=0,r=e.length;i<r;++i)if(s(e[i],t))return!0;return!!(s(o,e)||s(a,e)||s(l,e)||s(c,e))},i.polygonPolygon=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(n(t[i],t[(i+1)%r],e))return!0;for(i=0,r=e.length;i<r;++i)if(s(e[i],t))return!0;for(i=0,r=t.length;i<r;++i)if(s(t[i],e))return!0;return!1},i.circleCircle=function(t,e){return t.position.sub(e.position).mag()<t.radius+e.radius},i.polygonCircle=function(t,e){var i=e.position;if(s(i,t))return!0;for(var r=0,n=t.length;r<n;r++)if(o(i,0===r?t[t.length-1]:t[r-1],t[r],!0)<e.radius)return!0;return!1},i.pointInPolygon=s,i.pointLineDistance=o,cc.Intersection=e.exports=i},{}],98:[function(t,e){cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var i=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=e.exports=i},{}],99:[function(t){t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")},{"./CCBoxCollider":92,"./CCCircleCollider":93,"./CCCollider":94,"./CCCollisionManager":95,"./CCPolygonCollider":98}],100:[function(t,e){t("./platform/CCClass");var i=t("./platform/CCObject").Flags,r=t("./platform/js").array,n=i.IsStartCalled,s=i.IsOnEnableCalled;function o(t,e){for(var i=e.constructor._executionOrder,r=e._id,n=0,s=t.length-1,o=s>>>1;n<=s;o=n+s>>>1){var a=t[o],l=a.constructor._executionOrder;if(l>i)s=o-1;else if(l<i)n=o+1;else{var c=a._id;if(c>r)s=o-1;else{if(!(c<r))return o;n=o+1}}}return~n}function a(t,e){for(var i=t.array,r=t.i+1;r<i.length;){var n=i[r];n._enabled&&n.node&&n.node._activeInHierarchy?++r:(t.removeAt(r),e&&(n._objFlags&=~e))}}i.IsEditorOnEnableCalled;var l=cc.Class({__ctor__:function(t){var e=r.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:a},add:null,remove:null,invoke:null});function c(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}var h=cc.Class({extends:l,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){a(this._zero,t),a(this._neg,t),a(this._pos,t)},invoke:function(){var t=this._neg;t.array.length>0&&(t.array.sort(c),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(c),this._invoke(e),e.array.length=0)}}),u=cc.Class({extends:l,add:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,r=o(i,t);r<0&&i.splice(~r,0,t)}},remove:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,r=o(i.array,t);r>=0&&i.removeAt(r)}},invoke:function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)}});function d(t,e,i,r){var n="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}";return r=e?Function("it","dt",n):Function("it",n),t=Function("c","dt",t),function(e,n){try{r(e,n)}catch(o){cc._throw(o);var s=e.array;for(i&&(s[e.i]._objFlags|=i),++e.i;e.i<s.length;++e.i)try{t(s[e.i],n)}catch(o){cc._throw(o),i&&(s[e.i]._objFlags|=i)}}}}var p=d("c.start();c._objFlags|="+n,!1,n),f=d("c.update(dt)",!0),_=d("c.lateUpdate(dt)",!0);function m(){this.startInvoker=new h(p),this.updateInvoker=new u(f),this.lateUpdateInvoker=new u(_),this._deferredComps=[],this._updating=!1}var g=cc.Class({ctor:m,unscheduleAll:m,statics:{LifeCycleInvoker:l,OneOffInvoker:h,createInvokeImpl:d,invokeOnEnable:function(t){var e=cc.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var r=i[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=s,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~s;var e=this._deferredComps.indexOf(t);e>=0?r.fastRemoveAt(this._deferredComps,e):(!t.start||t._objFlags&n||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&s)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&s&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){"function"!=typeof t.start||t._objFlags&n||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this._deferredComps,e=0,i=t.length;e<i;e++)this._scheduleImmediate(t[e]);t.length=0},_startForNewComps:function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},startPhase:function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()}});e.exports=g},{"./platform/CCClass":196,"./platform/CCObject":202,"./platform/js":217,"./utils/misc":271}],101:[function(t,e){var i=t("../../animation/animation-animator"),r=t("../../animation/animation-clip"),n=t("../event/event-target"),s=t("../platform/js"),o=function(t,e){return t===e},a=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),l=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[n],editor:!1,statics:{EventType:a},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=s.createMap(!0),this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_writableClips:{get:function(){return this._clips},set:function(t){this._didInit=!1,this._clips=t,this._init()},type:[r]},_clips:{default:[],type:[r],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&(!this._animator||!this._animator.isPlaying)){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){var i=this.playAdditive(t,e);return this._animator.stopStatesExcept(i),i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(i){this.enabled=!0;var r=this._animator;r.isPlaying&&i.isPlaying?i.isPaused?r.resumeState(i):(r.stopState(i),r.playState(i,e)):r.playState(i,e),this.enabledInHierarchy||r.pause(),this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this.enabled=!1},resume:function(t){if(this._didInit)if(t){var e=this.getAnimationState(t);e&&this._animator.resumeState(e)}else this.enabled=!0},setCurrentTime:function(t,e){if(this._init(),e){var i=this.getAnimationState(e);i&&this._animator.setStateTime(i,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},hasAnimationState:function(t){return this._init(),!!this._nameToState[t]},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;var r=this._clips.indexOf(i.clip);-1!==r&&this._clips.splice(r,1)}var n=new cc.AnimationState(t,e);return this._nameToState[e]=n,n}cc.warnID(3900)},removeClip:function(t,e){if(t){var i;for(var r in this._init(),this._nameToState)if(i=this._nameToState[r],o(i.clip,t))break;if(t===this._defaultClip){if(!e)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter((function(e){return!o(e,t)})),i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(t){if(this._init(),t){var e=this.getAnimationState(t);e&&e.sample()}else this._animator.sample()},on:function(t,e,i,r){this._init();var n=this._EventTargetOn(t,e,i,r);if("lastframe"===t){var s=this._nameToState;for(var o in s)s[o]._lastframeEventOn=!0}return n},off:function(t,e,i,r){if(this._init(),"lastframe"===t){var n=this._nameToState;for(var s in n)n[s]._lastframeEventOn=!1}this._EventTargetOff(t,e,i,r)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new i(this.node,this),this._createStates())},_createStates:function(){this._nameToState=s.createMap(!0);for(var t=null,e=!1,i=0;i<this._clips.length;++i){var r=this._clips[i];r&&(t=new cc.AnimationState(r),this._nameToState[t.name]=t,o(this._defaultClip,r)&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});l.prototype._EventTargetOn=n.prototype.on,l.prototype._EventTargetOff=n.prototype.off,cc.Animation=e.exports=l},{"../../animation/animation-animator":9,"../../animation/animation-clip":10,"../event/event-target":143,"../platform/js":217,"./CCComponent":106}],102:[function(t,e){var i=t("../utils/misc"),r=t("./CCComponent"),n=t("../assets/CCAudioClip"),s=cc.Class({name:"cc.AudioSource",extends:r,editor:!1,ctor:function(){this.audio=new cc._Audio},properties:{_clip:{default:null,type:n},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},_firstlyEnabled:!0,isPlaying:{get:function(){return this.audio.getState()===cc._Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){if(t!==this._clip){if(!(t instanceof n))return cc.error("Wrong type of AudioClip.");this._clip=t,this.audio.stop(),this.audio.src=this._clip,this.preload&&this._clip._ensureLoaded()}},type:n,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){return t=i.clamp01(t),this._volume=t,this._mute||this.audio.setVolume(t),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_pausedCallback:function(){this.audio.getState()===cc._Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1},onLoad:function(){this.audio.src||(this.audio.src=this._clip),this.preload&&this._clip._ensureLoaded()},onEnable:function(){this.playOnLoad&&this._firstlyEnabled&&(this._firstlyEnabled=!1,this.play()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.audio.destroy()},play:function(){if(this._clip){var t=this.audio;t.setVolume(this._mute?0:this._volume),t.setLoop(this._loop),t.setCurrentTime(0),t.play()}},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},resume:function(){this.audio.resume()},rewind:function(){this.audio.setCurrentTime(0)},getCurrentTime:function(){return this.audio.getCurrentTime()},setCurrentTime:function(t){return this.audio.setCurrentTime(t),t},getDuration:function(){return this.audio.getDuration()}});cc.AudioSource=e.exports=s},{"../assets/CCAudioClip":63,"../utils/misc":271,"./CCComponent":106}],103:[function(t,e){var i=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(t){t.stopPropagation()}var n=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var t=0;t<i.length;t++)this.node.on(i[t],r,this)},onDisable:function(){for(var t=0;t<i.length;t++)this.node.off(i[t],r,this)}});cc.BlockInputEvents=e.exports=n},{"./CCComponent":106}],104:[function(t,e){var i=t("./CCComponent"),r=t("../utils/gray-sprite-state"),n=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),s=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3}),o=cc.Class({name:"cc.Button",extends:i,mixins:[r],ctor:function(){this._pressed=!1,this._hovered=!1,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=cc.Vec2.ZERO,this._toScale=cc.Vec2.ZERO,this._originalScale=null,this._graySpriteMaterial=null,this._spriteMaterial=null,this._sprite=null},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState(!0)}},transition:{default:n.NONE,tooltip:!1,type:n,animatable:!1,notify:function(t){this._updateTransition(t)},formerlySerializedAs:"transition"},normalColor:{default:cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===s.NORMAL&&(this._getTarget().opacity=this.normalColor.a),this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===s.PRESSED&&(this._getTarget().opacity=this.pressedColor.a),this._updateState()},formerlySerializedAs:"pressedColor"},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===s.HOVER&&(this._getTarget().opacity=this.hoverColor.a),this._updateState()},formerlySerializedAs:"hoverColor"},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===s.DISABLED&&(this._getTarget().opacity=this.disabledColor.a),this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(t){this._applyTarget(),t&&this.target!==t&&this._unregisterTargetEvent(t)}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:n},__preload:function(){this._applyTarget(),this._resetState()},_resetState:function(){this._pressed=!1,this._hovered=!1;var t=this._getTarget(),e=this.transition,i=this._originalScale;e===n.COLOR&&this.interactable?this._setTargetColor(this.normalColor):e===n.SCALE&&i&&t.setScale(i.x,i.y),this._transitionFinished=!0},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerNodeEvent(),this._updateState()},onDisable:function(){this._resetState(),this._unregisterNodeEvent()},_getTarget:function(){return this.target?this.target:this.node},_onTargetSpriteFrameChanged:function(t){this.transition===n.SPRITE&&this._setCurrentStateSprite(t.spriteFrame)},_onTargetColorChanged:function(t){this.transition===n.COLOR&&this._setCurrentStateColor(t)},_onTargetScaleChanged:function(){var t=this._getTarget();this._originalScale&&(this.transition!==n.SCALE||this._transitionFinished)&&(this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY)},_setTargetColor:function(t){var e=this._getTarget(),i=t.clone();e.opacity=i.a,i.a=255,e.color=i},_getStateColor:function(t){switch(t){case s.NORMAL:return this.normalColor;case s.HOVER:return this.hoverColor;case s.PRESSED:return this.pressedColor;case s.DISABLED:return this.disabledColor}},_getStateSprite:function(t){switch(t){case s.NORMAL:return this.normalSprite;case s.HOVER:return this.hoverSprite;case s.PRESSED:return this.pressedSprite;case s.DISABLED:return this.disabledSprite}},_setCurrentStateColor:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalColor=t;break;case s.HOVER:this.hoverColor=t;break;case s.PRESSED:this.pressedColor=t;break;case s.DISABLED:this.disabledColor=t}},_setCurrentStateSprite:function(t){switch(this._getButtonState()){case s.NORMAL:this.normalSprite=t;break;case s.HOVER:this.hoverSprite=t;break;case s.PRESSED:this.pressedSprite=t;break;case s.DISABLED:this.disabledSprite=t}},update:function(t){var e=this._getTarget();if(!this._transitionFinished&&(this.transition===n.COLOR||this.transition===n.SCALE)){this.time+=t;var i=1;if(this.duration>0&&(i=this.time/this.duration),i>=1&&(i=1),this.transition===n.COLOR){var r=this._fromColor.lerp(this._toColor,i);this._setTargetColor(r)}else this.transition===n.SCALE&&this._originalScale&&(e.scale=this._fromScale.lerp(this._toScale,i));1===i&&(this._transitionFinished=!0)}},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_registerTargetEvent:function(t){t.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_unregisterTargetEvent:function(t){t.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_getTargetSprite:function(t){var e=null;return t&&(e=t.getComponent(cc.Sprite)),e},_applyTarget:function(){var t=this._getTarget();this._sprite=this._getTargetSprite(t),this._originalScale||(this._originalScale=cc.Vec2.ZERO),this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY,this._registerTargetEvent(t)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var e,i=t.touch,r=this.node._hitTest(i.getLocation()),o=this._getTarget(),a=this._originalScale;this.transition===n.SCALE&&a?r?(this._fromScale.x=a.x,this._fromScale.y=a.y,this._toScale.x=a.x*this.zoomScale,this._toScale.y=a.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,o.setScale(a.x,a.y)):(e=r?s.PRESSED:s.NORMAL,this._applyTransition(e)),t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==n.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},_getButtonState:function(){return this.interactable?this._pressed?s.PRESSED:this._hovered?s.HOVER:s.NORMAL:s.DISABLED},_updateColorTransitionImmediately:function(t){var e=this._getStateColor(t);this._setTargetColor(e),this._fromColor=e.clone(),this._toColor=e},_updateColorTransition:function(t){if(t===s.DISABLED)this._updateColorTransitionImmediately(t);else{var e=this._getTarget(),i=this._getStateColor(t);this._fromColor=e.color.clone(),this._toColor=i,this.time=0,this._transitionFinished=!1}},_updateSpriteTransition:function(t){var e=this._getStateSprite(t);this._sprite&&e&&(this._sprite.spriteFrame=e)},_updateScaleTransition:function(t){t===s.PRESSED?this._zoomUp():this._zoomBack()},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1)},_zoomBack:function(){if(this._originalScale){var t=this._getTarget();this._fromScale.x=t.scaleX,this._fromScale.y=t.scaleY,this._toScale.x=this._originalScale.x,this._toScale.y=this._originalScale.y,this.time=0,this._transitionFinished=!1}},_updateTransition:function(t){t===n.COLOR?this._updateColorTransitionImmediately(s.NORMAL):t===n.SPRITE&&this._updateSpriteTransition(s.NORMAL),this._updateState()},_applyTransition:function(t){var e=this.transition;e===n.COLOR?this._updateColorTransition(t):e===n.SPRITE?this._updateSpriteTransition(t):e===n.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(t){if(this._sprite&&(this.enableAutoGrayEffect||t)){var e=!1;this.transition===n.SPRITE&&this.disabledSprite||(e=this.enableAutoGrayEffect&&!this.interactable),this._switchGrayMaterial(e,this._sprite)}}});cc.Button=e.exports=o},{"../utils/gray-sprite-state":268,"./CCComponent":106}],105:[function(t,e){var i=t("../camera/CCCamera"),r=t("./CCComponent"),n=cc.Class({name:"cc.Canvas",extends:r,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(n.instance)return cc.warnID(6700,this.node.name,n.instance.node.name);n.instance=this,this.applySettings();var t=this.getComponent(cc.Widget);t&&t.updateAlignment()},start:function(){if(!i.main&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){var t=new cc.Node("Main Camera");t.parent=this.node,t.setSiblingIndex(0);var e=t.addComponent(i),r=i.ClearFlags;e.clearFlags=r.COLOR|r.DEPTH|r.STENCIL,e.depth=-1}},onDestroy:function(){n.instance===this&&(n.instance=null)},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=n},{"../camera/CCCamera":91,"./CCComponent":106}],106:[function(t,e){var i=t("../platform/CCObject"),r=t("../platform/js"),n=new(t("../platform/id-generater"))("Comp"),s=(i.Flags.IsOnEnableCalled,i.Flags.IsOnLoadCalled),o=!!cc.ActionManager,a=cc.Class({name:"cc.Component",extends:i,ctor:function(){this._id=n.getNewId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},uuid:{get:function(){return this._id},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)){var e=cc.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&s}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){o&&cc.director.getActionManager().removeAllActionsFromTarget(this),this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=t.length-1;e>=0;--e){var i=t[e];i&&i.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return t||(t=cc.instantiate._clone(this,this)),t.node=null,t},schedule:function(t,e,i,r){cc.assertID(t,1619),e=e||0,cc.assertID(e>=0,1620),i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,r=r||0;var n=cc.director.getScheduler(),s=n.isTargetPaused(this);n.schedule(t,this,e,i,r,s)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});a._requireComponent=null,a._executionOrder=0,r.value(a,"_registerEditorProps",(function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);var r=e.executionOrder;r&&"number"==typeof r&&(t._executionOrder=r)})),a.prototype.__scriptUuid="",cc.Component=e.exports=a},{"../platform/CCObject":202,"../platform/id-generater":213,"../platform/js":217}],107:[function(){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){var e;if(arguments.length>0)for(var i=0,r=(e=new Array(arguments.length-1)).length;i<r;i++)e[i]=arguments[i+1];for(var n=0,s=t.length;n<s;n++){var o=t[n];o instanceof cc.Component.EventHandler&&o.emit(e)}}},emit:function(t){var e=this.target;if(cc.isValid(e)){this._genCompIdIfNeeded();var i=cc.js._getClassById(this._componentId),r=e.getComponent(i);if(cc.isValid(r)){var n=r[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(r,t))}}},_compName2Id:function(t){var e=cc.js.getClassByName(t);return cc.js._getClassId(e)},_compId2Name:function(t){var e=cc.js._getClassById(t);return cc.js.getClassName(e)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],108:[function(t,e){var i=t("../platform/CCMacro"),r=t("./CCRenderComponent"),n=(t("../assets/material/CCMaterial"),t("../renderer/utils/label/label-frame")),s=t("../utils/blend-func"),o=t("../renderer/utils/utils").deleteFromDynamicAtlas,a=i.TextAlignment,l=i.VerticalTextAlignment,c=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),h=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),u=cc.Class({name:"cc.Label",extends:r,mixins:[s],ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._ttfTexture=null,this._letterTexture=null,cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterial=this._updateMaterialCanvas:this._updateMaterial=this._updateMaterialWebgl},editor:!1,properties:{_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(t){var e=this._string;this._string=""+t,this.string!==e&&this.setVertsDirty(),this._checkStringEmpty()},multiline:!0,tooltip:!1},horizontalAlign:{default:a.LEFT,type:a,tooltip:!1,notify:function(t){this.horizontalAlign!==t&&this.setVertsDirty()},animatable:!1},verticalAlign:{default:l.TOP,type:l,tooltip:!1,notify:function(t){this.verticalAlign!==t&&this.setVertsDirty()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.setVertsDirty())},range:[0,512],tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(t){this.fontFamily!==t&&this.setVertsDirty()},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.setVertsDirty())},tooltip:!1},overflow:{default:c.NONE,type:c,tooltip:!1,notify:function(t){this.overflow!==t&&this.setVertsDirty()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.setVertsDirty())},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){this.font!==t&&(t||(this._isSystemFontUsed=!0),this._N$file=t,t&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this.enabledInHierarchy&&this._forceUpdateRenderData())},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){if(this._isSystemFontUsed!==t){if(this._isSystemFontUsed=!!t,t){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData()}this.markForValidate()}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.setVertsDirty()},tooltip:!1},_batchAsBitmap:!1,cacheMode:{default:h.NONE,type:h,tooltip:!1,notify:function(t){this.cacheMode!==t&&(t!==h.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),t===h.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData())},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags)},set:function(t){t?this._styleFlags|=1:this._styleFlags&=-2,this.setVertsDirty()},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags)},set:function(t){t?this._styleFlags|=2:this._styleFlags&=-3,this.setVertsDirty()},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags)},set:function(t){t?this._styleFlags|=4:this._styleFlags&=-5,this.setVertsDirty()},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.setVertsDirty())},tooltip:!1}},statics:{HorizontalAlign:a,VerticalAlign:l,Overflow:c,CacheMode:h,_shareAtlas:null,clearCharCache:function(){u._shareAtlas&&u._shareAtlas.clearAllCache()}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===h.NONE&&(this.cacheMode=h.BITMAP,this._batchAsBitmap=!1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=h.NONE)},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._nodeColorChanged,this),this._forceUpdateRenderData()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._nodeColorChanged,this)},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null),this._super()},onRestore:!1,_nodeSizeChanged:function(){this.overflow!==c.NONE&&this.setVertsDirty()},_nodeColorChanged:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty()},setVertsDirty:function(){this._super()},_updateColor:function(){this.font instanceof cc.BitmapFont||this._srcBlendFactor===cc.macro.BlendFactor.SRC_ALPHA&&this.node._renderFlag&cc.RenderFlow.FLAG_OPACITY||this.setVertsDirty(),r.prototype._updateColor.call(this)},_validateRender:function(){if(this.string){if(this._materials[0]){var t=this.font;if(!(t instanceof cc.BitmapFont))return;var e=t.spriteFrame;if(e&&e.textureLoaded()&&t._fntConfig)return}this.disableRender()}else this.disableRender()},_resetAssembler:function(){this._resetFrame(),r.prototype._resetAssembler.call(this)},_resetFrame:function(){!this._frame||this.font instanceof cc.BitmapFont||(o(this,this._frame),this._frame=null)},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._resetAssembler(),this._applyFontTexture()},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture,this.markForRender(!0),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)},_onBlendChanged:function(){this.useSystemFont&&this.enabledInHierarchy&&this._forceUpdateRenderData()},_applyFontTexture:function(){var t=this.font;if(t instanceof cc.BitmapFont){var e=t.spriteFrame;this._frame=e,e&&e.onTextureLoaded(this._onBMFontTextureLoaded,this)}else this._nativeTTF()||(this._frame||(this._frame=new n),this.cacheMode===h.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D,this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==h.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture),this._srcBlendFactor===cc.macro.BlendFactor.ONE&&this._ttfTexture.setPremultiplyAlpha(!0)),this._updateMaterial()),this._assembler&&this._assembler.updateRenderData(this);this.markForValidate()},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture._nativeUrl=this.uuid+"_texture")},_updateMaterialWebgl:function(){var t=this.getMaterial(0);this._nativeTTF()?t&&this._assembler._updateTTFMaterial(this):this._frame&&(t&&t.setProperty("texture",this._frame._texture),s.prototype._updateMaterial.call(this))},_forceUseCanvas:!1,_useNativeTTF:function(){return cc.macro.ENABLE_NATIVE_TTF_RENDERER&&!this._forceUseCanvas},_nativeTTF:function(){return this._useNativeTTF()&&!!this._assembler&&!!this._assembler._updateTTFMaterial},_forceUpdateRenderData:function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture()},_enableBold:function(t){this.enableBold=!!t},_enableItalics:function(t){this.enableItalic=!!t},_enableUnderline:function(t){this.enableUnderline=!!t}});cc.Label=e.exports=u},{"../assets/material/CCMaterial":81,"../platform/CCMacro":201,"../renderer/utils/label/label-frame":232,"../renderer/utils/utils":235,"../utils/blend-func":265,"./CCRenderComponent":117}],109:[function(t,e){var i=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||this._color.set(t),this._updateRenderData()}},width:{tooltip:!1,get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.setVertsDirty()}});cc.LabelOutline=e.exports=i},{"./CCComponent":106}],110:[function(t,e){var i=cc.Class({name:"cc.LabelShadow",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||this._color.set(t),this._updateRenderData()}},offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},blur:{tooltip:!1,get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.setVertsDirty()}});cc.LabelShadow=e.exports=i},{"./CCComponent":106}],111:[function(t,e){var i=t("../CCNode").EventType,r=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),n=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),s=cc.Enum({HORIZONTAL:0,VERTICAL:1}),o=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),a=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),l=cc.Class({name:"cc.Layout",extends:t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:n.NONE,_N$layoutType:r.NONE,type:{type:r,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:n,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(t){this.type===r.NONE&&t===n.CHILDREN||(this._resize=t,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:s.HORIZONTAL,tooltip:!1,type:s,notify:function(){this._doLayoutDirty()},animatable:!1},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:o.TOP_TO_BOTTOM,type:o,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:a.LEFT_TO_RIGHT,type:a,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},affectedByScale:{default:!1,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:!1}},statics:{Type:r,VerticalDirection:o,HorizontalDirection:a,ResizeMode:n,AxisDirection:s},onEnable:function(){this._addEventListeners(),this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(i.SIZE_CHANGED,this._resized,this),this.node.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(i.CHILD_ADDED,this._childAdded,this),this.node.on(i.CHILD_REMOVED,this._childRemoved,this),this.node.on(i.CHILD_REORDER,this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(i.SIZE_CHANGED,this._resized,this),this.node.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(i.CHILD_ADDED,this._childAdded,this),this.node.off(i.CHILD_REMOVED,this._childRemoved,this),this.node.off(i.CHILD_REORDER,this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var r=t[e];r.on(i.SCALE_CHANGED,this._doScaleDirty,this),r.on(i.SIZE_CHANGED,this._doLayoutDirty,this),r.on(i.POSITION_CHANGED,this._doLayoutDirty,this),r.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this),r.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_removeChildrenEventListeners:function(){for(var t=this.node.children,e=0;e<t.length;++e){var r=t[e];r.off(i.SCALE_CHANGED,this._doScaleDirty,this),r.off(i.SIZE_CHANGED,this._doLayoutDirty,this),r.off(i.POSITION_CHANGED,this._doLayoutDirty,this),r.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this),r.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_childAdded:function(t){t.on(i.SCALE_CHANGED,this._doScaleDirty,this),t.on(i.SIZE_CHANGED,this._doLayoutDirty,this),t.on(i.POSITION_CHANGED,this._doLayoutDirty,this),t.on(i.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){t.off(i.SCALE_CHANGED,this._doScaleDirty,this),t.off(i.SIZE_CHANGED,this._doLayoutDirty,this),t.off(i.POSITION_CHANGED,this._doLayoutDirty,this),t.off(i.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(t,e,i,s){var l=this.node.getAnchorPoint(),c=this.node.children,h=1,u=this.paddingLeft,d=-l.x*t;this.horizontalDirection===a.RIGHT_TO_LEFT&&(h=-1,d=(1-l.x)*t,u=this.paddingRight);for(var p=d+h*u-h*this.spacingX,f=0,_=0,m=0,g=0,y=0,v=0,b=0,x=0;x<c.length;++x)(C=c[x]).activeInHierarchy&&b++;var T=this.cellSize.width;for(this.type!==r.GRID&&this.resizeMode===n.CHILDREN&&(T=(t-(this.paddingLeft+this.paddingRight)-(b-1)*this.spacingX)/b),x=0;x<c.length;++x){var C=c[x],S=this._getUsedScaleValue(C.scaleX),w=this._getUsedScaleValue(C.scaleY);if(C.activeInHierarchy){this._resize===n.CHILDREN&&(C.width=T/S,this.type===r.GRID&&(C.height=this.cellSize.height/w));var A=C.anchorX,E=C.width*S,D=C.height*w;m>_&&(_=m),D>=_&&(m=_,_=D,v=C.getAnchorPoint().y),this.horizontalDirection===a.RIGHT_TO_LEFT&&(A=1-C.anchorX),p=p+h*A*E+h*this.spacingX;var L=h*(1-A)*E;if(e){var I=p+L+h*(h>0?this.paddingRight:this.paddingLeft),P=this.horizontalDirection===a.LEFT_TO_RIGHT&&I>(1-l.x)*t,M=this.horizontalDirection===a.RIGHT_TO_LEFT&&I<-l.x*t;(P||M)&&(D>=_?(0===m&&(m=_),f+=m,m=_):(f+=_,m=D,_=0),p=d+h*(u+A*E),g++)}var R=i(C,f,g);t>=E+this.paddingLeft+this.paddingRight&&s&&C.setPosition(cc.v2(p,R));var O,B=1,N=0===_?D:_;this.verticalDirection===o.TOP_TO_BOTTOM?(y=y||this.node._contentSize.height,(O=R+(B=-1)*(N*v+this.paddingBottom))<y&&(y=O)):(y=y||-this.node._contentSize.height,(O=R+B*(N*v+this.paddingTop))>y&&(y=O)),p+=L}}return y},_getVerticalBaseHeight:function(t){var e=0,i=0;if(this.resizeMode===n.CONTAINER){for(var r=0;r<t.length;++r){var s=t[r];s.activeInHierarchy&&(i++,e+=s.height*this._getUsedScaleValue(s.scaleY))}e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop}else e=this.node.getContentSize().height;return e},_doLayoutVertically:function(t,e,i,s){var l=this.node.getAnchorPoint(),c=this.node.children,h=1,u=this.paddingBottom,d=-l.y*t;this.verticalDirection===o.TOP_TO_BOTTOM&&(h=-1,d=(1-l.y)*t,u=this.paddingTop);for(var p=d+h*u-h*this.spacingY,f=0,_=0,m=0,g=0,y=0,v=0,b=0,x=0;x<c.length;++x)(C=c[x]).activeInHierarchy&&b++;var T=this.cellSize.height;for(this.type!==r.GRID&&this.resizeMode===n.CHILDREN&&(T=(t-(this.paddingTop+this.paddingBottom)-(b-1)*this.spacingY)/b),x=0;x<c.length;++x){var C=c[x],S=this._getUsedScaleValue(C.scaleX),w=this._getUsedScaleValue(C.scaleY);if(C.activeInHierarchy){this.resizeMode===n.CHILDREN&&(C.height=T/w,this.type===r.GRID&&(C.width=this.cellSize.width/S));var A=C.anchorY,E=C.width*S,D=C.height*w;m>_&&(_=m),E>=_&&(m=_,_=E,v=C.getAnchorPoint().x),this.verticalDirection===o.TOP_TO_BOTTOM&&(A=1-C.anchorY),p=p+h*A*D+h*this.spacingY;var L=h*(1-A)*D;if(e){var I=p+L+h*(h>0?this.paddingTop:this.paddingBottom),P=this.verticalDirection===o.BOTTOM_TO_TOP&&I>(1-l.y)*t,M=this.verticalDirection===o.TOP_TO_BOTTOM&&I<-l.y*t;(P||M)&&(E>=_?(0===m&&(m=_),f+=m,m=_):(f+=_,m=E,_=0),p=d+h*(u+A*D),g++)}var R=i(C,f,g);t>=D+(this.paddingTop+this.paddingBottom)&&s&&C.setPosition(cc.v2(R,p));var O,B=1,N=0===_?E:_;this.horizontalDirection===a.RIGHT_TO_LEFT?(B=-1,y=y||this.node._contentSize.width,(O=R+B*(N*v+this.paddingLeft))<y&&(y=O)):(y=y||-this.node._contentSize.width,(O=R+B*(N*v+this.paddingRight))>y&&(y=O)),p+=L}}return y},_doLayoutBasic:function(){for(var t=this.node.children,e=null,i=0;i<t.length;++i){var r=t[i];r.activeInHierarchy&&(e?e.union(e,r.getBoundingBoxToWorld()):e=r.getBoundingBoxToWorld())}if(e){var n=this.node.convertToNodeSpaceAR(cc.v2(e.x,e.y));n=cc.v2(n.x-this.paddingLeft,n.y-this.paddingBottom);var s=this.node.convertToNodeSpaceAR(cc.v2(e.xMax,e.yMax)),o=(s=cc.v2(s.x+this.paddingRight,s.y+this.paddingTop)).sub(n);if(0!==(o=cc.size(parseFloat(o.x.toFixed(2)),parseFloat(o.y.toFixed(2)))).width){var a=-n.x/o.width;this.node.anchorX=parseFloat(a.toFixed(2))}if(0!==o.height){var l=-n.y/o.height;this.node.anchorY=parseFloat(l.toFixed(2))}this.node.setContentSize(o)}},_doLayoutGridAxisHorizontal:function(t,e){var i=e.width,r=1,s=-t.y*e.height,a=this.paddingBottom;this.verticalDirection===o.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*e.height,a=this.paddingTop);var l=function(t,e,i){return s+r*(e+t.anchorY*t.height*this._getUsedScaleValue(t.scaleY)+a+i*this.spacingY)}.bind(this),c=0;if(this.resizeMode===n.CONTAINER){var h=this._doLayoutHorizontally(i,!0,l,!1);(c=s-h)<0&&(c*=-1),s=-t.y*c,this.verticalDirection===o.TOP_TO_BOTTOM&&(r=-1,s=(1-t.y)*c)}this._doLayoutHorizontally(i,!0,l,!0),this.resizeMode===n.CONTAINER&&this.node.setContentSize(i,c)},_doLayoutGridAxisVertical:function(t,e){var i=e.height,r=1,s=-t.x*e.width,o=this.paddingLeft;this.horizontalDirection===a.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*e.width,o=this.paddingRight);var l=function(t,e,i){return s+r*(e+t.anchorX*t.width*this._getUsedScaleValue(t.scaleX)+o+i*this.spacingX)}.bind(this),c=0;if(this.resizeMode===n.CONTAINER){var h=this._doLayoutVertically(i,!0,l,!1);(c=s-h)<0&&(c*=-1),s=-t.x*c,this.horizontalDirection===a.RIGHT_TO_LEFT&&(r=-1,s=(1-t.x)*c)}this._doLayoutVertically(i,!0,l,!0),this.resizeMode===n.CONTAINER&&this.node.setContentSize(c,i)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();this.startAxis===s.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===s.VERTICAL&&this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0,i=0;if(this.resizeMode===n.CONTAINER){for(var r=0;r<t.length;++r){var s=t[r];s.activeInHierarchy&&(i++,e+=s.width*this._getUsedScaleValue(s.scaleX))}e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight}else e=this.node.getContentSize().width;return e},_doLayout:function(){if(this.type===r.HORIZONTAL){var t=this._getHorizontalBaseWidth(this.node.children);this._doLayoutHorizontally(t,!1,(function(t){return t.y}),!0),this.node.width=t}else if(this.type===r.VERTICAL){var e=this._getVerticalBaseHeight(this.node.children);this._doLayoutVertically(e,!1,(function(t){return t.x}),!0),this.node.height=e}else this.type===r.NONE?this.resizeMode===n.CONTAINER&&this._doLayoutBasic():this.type===r.GRID&&this._doLayoutGrid()},_getUsedScaleValue:function(t){return this.affectedByScale?Math.abs(t):1},updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&this.node.children.find((function(t){return t.activeInHierarchy}))&&(this._doLayout(),this._layoutDirty=!1)}});cc.Layout=e.exports=l},{"../CCNode":29,"./CCComponent":106}],112:[function(t,e){var i=o(t("../../renderer/gfx")),r=o(t("../value-types/mat4")),n=o(t("../value-types/vec2")),s=o(t("../assets/material/material-variant"));function o(t){return t&&t.__esModule?t:{default:t}}var a=t("../utils/misc"),l=t("./CCRenderComponent"),c=t("../renderer/render-flow"),h=t("../graphics/graphics"),u=new n.default,d=new r.default,p=[];var f=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),_=cc.Class({name:"cc.Mask",extends:l,editor:!1,ctor:function(){this._graphics=null,this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:f.RECT,type:{get:function(){return this._type},set:function(t){this._type!==t&&this._resetAssembler(),this._type=t,this._type!==f.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._activateMaterial()},type:f,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame},set:function(t){var e=this._spriteFrame;e!==t&&(e&&e.off("load",this.setVertsDirty,this),this._spriteFrame=t,this.setVertsDirty(),this._updateMaterial())}},alphaThreshold:{default:.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202)}},_segments:64,segements:{get:function(){return this._segments},set:function(t){this._segments=a.clampf(t,3,1e4),this._updateGraphics()},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:f},onRestore:function(){this._activateMaterial()},onEnable:function(){this._super(),this._type!==f.IMAGE_STENCIL?this._updateGraphics():this._spriteFrame&&this._spriteFrame.once("load",this.setVertsDirty,this),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~c.FLAG_POST_RENDER},onDestroy:function(){this._super(),this._removeGraphics(),this._spriteFrame&&this._spriteFrame.off("load",this.setVertsDirty,this)},_resizeNodeToTargetNode:!1,_validateRender:function(){if(this._type===f.IMAGE_STENCIL){var t=this._spriteFrame;t&&t.textureLoaded()||this.disableRender()}},_activateMaterial:function(){this._createGraphics();var t=this._materials[0];(t=t?s.default.create(t,this):s.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0),this._type===f.IMAGE_STENCIL?(t.define("CC_USE_MODEL",!1),t.define("USE_TEXTURE",!0)):(t.define("CC_USE_MODEL",!0),t.define("USE_TEXTURE",!1)),this._enableMaterial||(this._enableMaterial=s.default.createWithBuiltin("2d-sprite",this)),this._exitMaterial||(this._exitMaterial=s.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(i.default.STENCIL_DISABLE)),this._clearMaterial||(this._clearMaterial=s.default.createWithBuiltin("clear-stencil",this)),this.setMaterial(0,t),this._graphics._materials[0]=t,this._updateMaterial()},_updateMaterial:function(){var t=this._materials[0];if(t){if(this._type===f.IMAGE_STENCIL&&this.spriteFrame){var e=this.spriteFrame.getTexture();t.setProperty("texture",e)}t.setProperty("alphaThreshold",this.alphaThreshold)}},_createGraphics:function(){this._graphics||(this._graphics=new h,cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0))},_updateGraphics:function(){if(this.enabledInHierarchy){var t=this.node,e=this._graphics;e.clear(!1);var i=t._contentSize.width,r=t._contentSize.height,n=-i*t._anchorPoint.x,s=-r*t._anchorPoint.y;if(this._type===f.RECT)e.rect(n,s,i,r);else if(this._type===f.ELLIPSE){for(var o=function(t,e,i){p.length=0;for(var r=2*Math.PI/i,n=0;n<i;++n)p.push(cc.v2(e.x*Math.cos(r*n)+t.x,e.y*Math.sin(r*n)+t.y));return p}(cc.v2(n+i/2,s+r/2),{x:i/2,y:r/2},this._segments),a=0;a<o.length;++a){var l=o[a];0===a?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}e.close()}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?e.stroke():e.fill(),this.setVertsDirty()}},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},_hitTest:function(t){var e=this.node,i=e.getContentSize(),s=i.width,o=i.height,a=u;if(e._updateWorldMatrix(),!r.default.invert(d,e._worldMatrix))return!1;n.default.transformMat4(a,t,d),a.x+=e._anchorPoint.x*s,a.y+=e._anchorPoint.y*o;var l=!1;if(this.type===f.RECT||this.type===f.IMAGE_STENCIL)l=a.x>=0&&a.y>=0&&a.x<=s&&a.y<=o;else if(this.type===f.ELLIPSE){var c=s/2,h=o/2,p=a.x-.5*s,_=a.y-.5*o;l=p*p/(c*c)+_*_/(h*h)<1}return this.inverted&&(l=!l),l},markForRender:function(t){var e=c.FLAG_RENDER|c.FLAG_UPDATE_RENDER_DATA|c.FLAG_POST_RENDER;t?(this.node._renderFlag|=e,this.markForValidate()):t||(this.node._renderFlag&=~e)},disableRender:function(){this.node._renderFlag&=~(c.FLAG_RENDER|c.FLAG_UPDATE_RENDER_DATA|c.FLAG_POST_RENDER)}});cc.Mask=e.exports=_},{"../../renderer/gfx":319,"../assets/material/material-variant":88,"../graphics/graphics":159,"../renderer/render-flow":228,"../utils/misc":271,"../value-types/mat4":288,"../value-types/vec2":295,"./CCRenderComponent":117}],113:[function(t,e){var i=t("../components/CCRenderComponent"),r=t("../../core/utils/blend-func"),n=cc.Class({name:"cc.MotionStreak",extends:i,mixins:[r],editor:!1,ctor:function(){this._points=[],this._lastWPos=new cc.Vec2,this._lastWPosUpdated=!1},properties:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t},animatable:!1,tooltip:!1},_texture:{default:null,type:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this._updateMaterial())},type:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||this._color.set(t)},type:cc.Color,tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t},animatable:!1,tooltip:!1}},onEnable:function(){this._super(),this.reset()},_updateMaterial:function(){var t=this.getMaterial(0);t&&t.setProperty("texture",this._texture),r.prototype._updateMaterial.call(this)},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear(),this._lastWPosUpdated=!1},lateUpdate:function(t){this._assembler&&this._assembler.update(this,t)}});cc.MotionStreak=e.exports=n},{"../../core/utils/blend-func":265,"../components/CCRenderComponent":117}],114:[function(t,e){var i=cc.Enum({Unified:0,Free:1}),r=cc.Enum({Horizontal:0,Vertical:1}),n=cc.Enum({PAGE_TURNING:0}),s=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=cc.v2(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{default:i.Unified,type:i,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:r.Horizontal,type:r,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:i,Direction:r,EventType:n},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(t){this.scrollToPage(t,!0)},getPages:function(){return this._pages},addPage:function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView())},insertPage:function(t,e){e<0||!t||-1!==this._pages.indexOf(t)||!this.content||(e>=this._pages.length?this.addPage(t):(this._pages.splice(e,0,t),this.content.addChild(t),this._updatePageView()))},removePage:function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):cc.warnID(4300,t.name)}},removePageAtIndex:function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},removeAllPages:function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(t,e){t<0||t>=this._pages.length||(e=void 0!==e?e:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===r.Horizontal,this.vertical=this.direction===r.Vertical},_syncSizeMode:function(){if(this.content){var t=this.content.getComponent(cc.Layout);if(t){if(this.sizeMode===i.Free&&this._pages.length>0){var e=this._pages[this._pages.length-1];this.direction===r.Horizontal?(t.paddingLeft=(this._view.width-this._pages[0].width)/2,t.paddingRight=(this._view.width-e.width)/2):this.direction===r.Vertical&&(t.paddingTop=(this._view.height-this._pages[0].height)/2,t.paddingBottom=(this._view.height-e.height)/2)}t.updateLayout()}}},_updatePageView:function(){var t=this.content.getComponent(cc.Layout);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,n=0;n<e;++n){var s=this._pages[n];s.setSiblingIndex(n),this.direction===r.Horizontal?this._scrollCenterOffsetX[n]=Math.abs(i.x+s.x):this._scrollCenterOffsetY[n]=Math.abs(i.y+s.y)}this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===i.Unified&&this._view)for(var t=this._pages,e=this._view.getContentSize(),r=0,n=t.length;r<n;r++)t[r].setContentSize(e)},_initPages:function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,n.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(t,e,n){if(this.sizeMode===i.Free){var s,o;if(this.direction===r.Horizontal)return s=this._scrollCenterOffsetX[e],o=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(s-o)*this.scrollThreshold;if(this.direction===r.Vertical)return s=this._scrollCenterOffsetY[e],o=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(s-o)*this.scrollThreshold}else{if(this.direction===r.Horizontal)return Math.abs(t.x)>=this._view.width*this.scrollThreshold;if(this.direction===r.Vertical)return Math.abs(t.y)>=this._view.height*this.scrollThreshold}},_isQuicklyScrollable:function(t){if(this.direction===r.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===r.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(t){var e=cc.v2(0,0);return this.sizeMode===i.Free?this.direction===r.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===r.Vertical&&(e.y=this._scrollCenterOffsetY[t]):this.direction===r.Horizontal?e.x=t*this._view.width:this.direction===r.Vertical&&(e.y=t*this._view.height),e},_getDragDirection:function(t){return this.direction===r.Horizontal?0===t.x?0:t.x>0?1:-1:this.direction===r.Vertical?0===t.y?0:t.y<0?1:-1:void 0},_handleReleaseLogic:function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_autoScrollToPage:function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();((t=this._clampDelta(t)).x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=this._touchBeganPosition.sub(this._touchEndPosition),i=this._curPageIdx,r=i+this._getDragDirection(e),n=this.pageTurningSpeed*Math.abs(i-r);if(r<this._pages.length){if(this._isScrollable(e,i,r))return void this.scrollToPage(r,n);var s=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(s))return void this.scrollToPage(r,n)}this.scrollToPage(i,n)}},_onTouchBegan:function(t,e){this._touchBeganPosition=t.touch.getLocation(),this._super(t,e)},_onTouchMoved:function(t,e){this._super(t,e)},_onTouchEnded:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onTouchCancelled:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onMouseWheel:function(){}});cc.PageView=e.exports=s},{}],115:[function(t,e){var i=cc.Enum({HORIZONTAL:0,VERTICAL:1}),r=cc.Class({name:"cc.PageViewIndicator",extends:t("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1},direction:{default:i.HORIZONTAL,type:i,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:i},onLoad:function(){this._updateLayout()},setPageView:function(t){this._pageView=t,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===i.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===i.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var t=new cc.Node,e=t.addComponent(cc.Sprite);return e.spriteFrame=this.spriteFrame,e.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t},_changedState:function(){var t=this._indicators;if(0!==t.length){var e=this._pageView._curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i)t[i].opacity=127.5;t[e].opacity=255}}},_refresh:function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}}});cc.PageViewIndicator=e.exports=r},{"./CCComponent":106}],116:[function(t,e){var i=t("../utils/misc"),r=t("./CCComponent"),n=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),s=cc.Class({name:"cc.ProgressBar",extends:r,editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=this.node.getContentSize(),i=this.node.getAnchorPoint(),r=t.getContentSize();t.parent===this.node&&this.node.setContentSize(r),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=n.FILLED);var s=t.getContentSize();if(this.mode===n.HORIZONTAL?this.totalLength=s.width:this.mode===n.VERTICAL?this.totalLength=s.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node){var o=-e.width*i.x;t.setPosition(cc.v2(o,0))}}},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e,r,s,o=t.getAnchorPoint(),a=t.getContentSize(),l=t.getPosition(),c=cc.v2(0,.5),h=i.clamp01(this.progress),u=this.totalLength*h;switch(this.mode){case n.HORIZONTAL:this.reverse&&(c=cc.v2(1,.5)),e=cc.size(u,a.height),r=this.totalLength,s=a.height;break;case n.VERTICAL:c=this.reverse?cc.v2(.5,1):cc.v2(.5,0),e=cc.size(a.width,u),r=a.width,s=this.totalLength}if(this.mode===n.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(u*=-1),this.barSprite.fillRange=u);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var d=c.x-o.x,p=c.y-o.y,f=cc.v2(r*d,s*p);t.setPosition(l.x+f.x,l.y+f.y),t.setAnchorPoint(c),t.setContentSize(e)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:n.HORIZONTAL,type:n,tooltip:!1,notify:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=t.getContentSize();this.mode===n.HORIZONTAL?this.totalLength=e.width:this.mode===n.VERTICAL?this.totalLength=e.height:this.mode===n.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(t){this.mode===n.FILLED&&(t=i.clamp01(t)),this._N$totalLength=t,this._updateBarStatus()}},progress:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:n}});cc.ProgressBar=e.exports=s},{"../utils/misc":271,"./CCComponent":106}],117:[function(t,e){var i=s(t("../renderer/assembler")),r=s(t("../assets/material/material-variant")),n=t("../value-types");function s(t){return t&&t.__esModule?t:{default:t}}var o=t("./CCComponent"),a=t("../renderer/render-flow"),l=t("../assets/material/CCMaterial"),c=new n.Color,h=cc.Class({name:"RenderComponent",extends:o,editor:!1,properties:{_materials:{default:[],type:l},materials:{get:function(){return this._materials},set:function(t){this._materials=t,this._activateMaterial()},type:[l],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0,this._assembler=null},_resetAssembler:function(){i.default.init(this),this._updateColor(),this.setVertsDirty()},__preload:function(){this._resetAssembler(),this._activateMaterial()},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),this.node._renderComponent=this,this.node._renderFlag|=a.FLAG_OPACITY_COLOR,this.setVertsDirty()},onDisable:function(){this.node._renderComponent=null,this.disableRender()},onDestroy:function(){for(var t=this._materials,e=0;e<t.length;e++)cc.pool.material.put(t[e]);t.length=0,cc.pool.assembler.put(this._assembler),this.disableRender()},setVertsDirty:function(){this._vertsDirty=!0,this.markForRender(!0)},_on3DNodeChanged:function(){this._resetAssembler()},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this)},markForRender:function(t){var e=a.FLAG_RENDER|a.FLAG_UPDATE_RENDER_DATA;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e},disableRender:function(){this.node._renderFlag&=~(a.FLAG_RENDER|a.FLAG_UPDATE_RENDER_DATA)},getMaterial:function(t){if(t<0||t>=this._materials.length)return null;var e=this._materials[t];if(!e)return null;var i=r.default.create(e,this);return i!==e&&this.setMaterial(t,i),i},getMaterials:function(){for(var t=this._materials,e=0;e<t.length;e++)t[e]=r.default.create(t[e],this);return t},setMaterial:function(t,e){return e!==this._materials[t]&&(e=r.default.create(e,this),this._materials[t]=e),this._updateMaterial(),this.markForRender(!0),e},_getDefaultMaterial:function(){return l.getBuiltinMaterial("2d-sprite")},_activateMaterial:function(){var t=this._materials;if(!t[0]){var e=this._getDefaultMaterial();t[0]=e}for(var i=0;i<t.length;i++)t[i]=r.default.create(t[i],this);this._updateMaterial()},_updateMaterial:function(){},_updateColor:function(){if(this._assembler.updateColor){var t=this.srcBlendFactor===cc.macro.BlendFactor.ONE;t&&n.Color.premultiplyAlpha(c,this.node._color);var e=t?c._val:null;this._assembler.updateColor(this,e)}},_checkBacth:function(t,e){var i=this._materials[0];(i&&i.getHash()!==t.material.getHash()||t.cullingMask!==e)&&(t._flush(),t.node=i.getDefine("CC_USE_MODEL")?this.node:t._dummyNode,t.material=i,t.cullingMask=e)}});cc.RenderComponent=e.exports=h},{"../assets/material/CCMaterial":81,"../assets/material/material-variant":88,"../renderer/assembler":224,"../renderer/render-flow":228,"../value-types":286,"./CCComponent":106}],118:[function(t,e){var i=t("../platform/js"),r=t("../platform/CCMacro"),n=t("../utils/text-utils"),s=new(t("../utils/html-text-parser")),o=r.TextAlignment,a=r.VerticalTextAlignment,l=cc.Label.CacheMode,c=new i.Pool((function(t){if(!cc.isValid(t))return!1;var e=t.getComponent(cc.LabelOutline);return e&&(e.width=0),!0}),20);c.get=function(){var t=this._get();t||((t=new cc.PrivateNode("RICHTEXT_CHILD"))._objFlags|=cc.Object.Flags.DontSave),t.setPosition(0,0),t.setAnchorPoint(.5,.5),t.skewX=0;var e=t.getComponent(cc.Label);return e||(e=t.addComponent(cc.Label)),e.string="",e.horizontalAlign=o.LEFT,e.verticalAlign=a.CENTER,e._forceUseCanvas=!0,t};var h=cc.Class({name:"cc.RichText",extends:cc.Component,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:o.LEFT,type:o,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},_fontFamily:"Arial",fontFamily:{tooltip:!1,get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())},animatable:!1,tooltip:!1},cacheMode:{default:l.NONE,type:l,tooltip:!1,notify:function(t){this.cacheMode!==t&&this._updateRichTextStatus()},animatable:!1},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:o,VerticalAlign:a},onEnable:function(){this.handleTouchEvent&&this._addEventListeners(),this._onTTFLoaded(),this._activateChildren(!0)},onDisable:function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},_onColorChanged:function(t){this.node.children.forEach((function(e){e.color=t}))},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t,null,!0)}.bind(this))},_createFontLabel:function(t){return c.get(t,this)},_onTTFLoaded:function(){if(this.font instanceof cc.TTFFont)if(this.font._nativeAsset)this._layoutDirty=!0,this._updateRichTextStatus();else{var t=this;cc.assetManager.postLoadNative(this.font,(function(){t._layoutDirty=!0,t._updateRichTextStatus()}))}else this._layoutDirty=!0,this._updateRichTextStatus()},_measureText:function(t,e){var i=this,r=function(e){var r;return 0===i._labelSegmentsCache.length?(r=i._createFontLabel(e),i._labelSegmentsCache.push(r)):r=i._labelSegmentsCache[0],r._styleIndex=t,i._applyTextAttribute(r,e,!0),r.getContentSize().width};return e?r(e):r},_onTouchEnded:function(t){for(var e=this,i=this.node.getComponents(cc.Component),r=function(r){var n=e._labelSegments[r],s=n._clickHandler,o=n._clickParam;s&&e._containsTouchLocation(n,t.touch.getLocation())&&(i.forEach((function(e){e.enabledInHierarchy&&e[s]&&e[s](t,o)})),t.stopPropagation())},n=0;n<this._labelSegments.length;++n)r(n)},_containsTouchLocation:function(t,e){return t.getBoundingBoxToWorld().contains(e)},_resetState:function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.parent===this.node?i.parent=null:t.splice(e,1),"RICHTEXT_CHILD"===i.name&&c.put(i))}this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},onRestore:!1,_activateChildren:function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}},_addLabelSegment:function(t,e){var i;return(i=0===this._labelSegmentsCache.length?this._createFontLabel(t):this._labelSegmentsCache.pop())._styleIndex=e,i._lineCount=this._lineCount,i.active=this.node.active,i.setAnchorPoint(0,0),this._applyTextAttribute(i,t,!1),this.node.addChild(i),this._labelSegments.push(i),i},_updateRichTextWithMaxWidth:function(t,e,i){var r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this.maxWidth)for(var s=0;this._lineOffsetX<=this.maxWidth;){var o=this._getFirstWordLen(t,s,t.length),a=t.substr(s,o),l=this._measureText(i,a);if(!(this._lineOffsetX+l<=this.maxWidth)){if(s>0){var c=t.substr(0,s);this._addLabelSegment(c,i),t=t.substr(s,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=l,s+=o}if(r>this.maxWidth)for(var h=n.fragmentText(t,r,this.maxWidth,this._measureText(i)),u=0;u<h.length;++u){var d=h[u],p=this._addLabelSegment(d,i).getContentSize();this._lineOffsetX+=p.width,h.length>1&&u<h.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,i)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],r=t[e];if(i.text!==r.text)return!0;var n=i.style,s=r.style;if(n){if(s){if(!n.outline!=!s.outline)return!0;if(n.size!==s.size||!n.italic!=!s.italic||n.isImage!==s.isImage)return!0;if(n.src!==s.src||n.imageAlign!==s.imageAlign||n.imageHeight!==s.imageHeight||n.imageWidth!==s.imageWidth||n.imageOffset!==s.imageOffset)return!0}else if(n.size||n.italic||n.isImage||n.outline)return!0}else if(s&&(s.size||s.italic||s.isImage||s.outline))return!0}return!1},_addRichTextImageElement:function(t){var e=t.style.src,i=this.imageAtlas.getSpriteFrame(e);if(i){var r=new cc.PrivateNode("RICHTEXT_Image_CHILD");r._objFlags|=cc.Object.Flags.DontSave;var n=r.addComponent(cc.Sprite);switch(t.style.imageAlign){case"top":r.setAnchorPoint(0,1);break;case"center":r.setAnchorPoint(0,.5);break;default:r.setAnchorPoint(0,0)}t.style.imageOffset&&(r._imageOffset=t.style.imageOffset),n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.node.addChild(r),this._labelSegments.push(r);var s=i.getRect(),o=1,a=s.width,l=s.height,c=t.style.imageWidth,h=t.style.imageHeight;h>0?(a*=o=h/l,l*=o):(a*=o=this.lineHeight/l,l*=o),c>0&&(a=c),this.maxWidth>0?(this._lineOffsetX+a>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.spriteFrame=i,r.setContentSize(a,l),r._lineCount=this._lineCount,t.style.event?(t.style.event.click&&(r._clickHandler=t.style.event.click),t.style.event.param?r._clickParam=t.style.event.param:r._clickParam=""):r._clickHandler=null}else cc.warnID(4400)},_updateRichText:function(){if(this.enabledInHierarchy){var t=s.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e,i=!1,r=0;r<this._textArray.length;++r){var o=this._textArray[r],a=o.text;if(""===a){if(o.style&&o.style.newline){this._updateLineInfo();continue}if(o.style&&o.style.isImage&&this.imageAtlas){this._addRichTextImageElement(o);continue}}for(var l=a.split("\n"),c=0;c<l.length;++c){var h=l[c];if(""!==h)if(i=!1,this.maxWidth>0){var u=this._measureText(r,h);this._updateRichTextWithMaxWidth(h,u,r),l.length>1&&c<l.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,r).getContentSize(),this._lineOffsetX+=e.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),l.length>1&&c<l.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&c===l.length-1)continue;this._updateLineInfo(),i=!0}}}i||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=(this._lineCount+n.BASELINE_RATIO)*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(n.isUnicodeCJK(r)||n.isUnicodeSpace(r))return 1;for(var s=1,o=e+1;o<i&&(r=t.charAt(o),!n.isUnicodeSpace(r)&&!n.isUnicodeCJK(r));++o)s++;return s},_updateRichTextPosition:function(){for(var t=0,e=1,i=this._lineCount,r=0;r<this._labelSegments.length;++r){var s=this._labelSegments[r],a=s._lineCount;a>e&&(t=0,e=a);var l=0;switch(this.horizontalAlign){case o.LEFT:l=-this._labelWidth/2;break;case o.CENTER:l=-this._linesWidth[a-1]/2;break;case o.RIGHT:l=this._labelWidth/2-this._linesWidth[a-1]}s.x=t+l;var c=s.getContentSize();if(s.y=this.lineHeight*(i-a)-this._labelHeight/2,a===e&&(t+=c.width),s.getComponent(cc.Sprite)){var h=this.lineHeight,u=this.lineHeight*(1+n.BASELINE_RATIO);switch(s.anchorY){case 1:s.y+=h+(u-h)/2;break;case.5:s.y+=u/2;break;default:s.y+=(u-h)/2}if(s._imageOffset){var d=s._imageOffset.split(",");if(1===d.length&&d[0]){var p=parseFloat(d[0]);Number.isInteger(p)&&(s.y+=p)}else if(2===d.length){var f=parseFloat(d[0]),_=parseFloat(d[1]);Number.isInteger(f)&&(s.x+=f),Number.isInteger(_)&&(s.y+=_)}}}var m=s.getComponent(cc.LabelOutline);m&&m.width&&(s.y=s.y-m.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]?cc.Color[e]:cc.color().fromHEX(t)},_applyTextAttribute:function(t,e,i){var r=t.getComponent(cc.Label);if(r){var n=t._styleIndex,s=null;if(this._textArray[n]&&(s=this._textArray[n].style),s&&s.color?t.color=this._convertLiteralColorValue(s.color):t.color=this.node.color,r.cacheMode=this.cacheMode,this.font instanceof cc.Font&&!this._isSystemFontUsed?r.font=this.font:r.fontFamily=this.fontFamily,r.useSystemFont=this._isSystemFontUsed,r.lineHeight=this.lineHeight,r.enableBold=s&&s.bold,r.enableItalics=s&&s.italic,s&&s.italic&&(t.skewX=12),r.enableUnderline=s&&s.underline,s&&s.outline){var o=t.getComponent(cc.LabelOutline);o||(o=t.addComponent(cc.LabelOutline)),o.color=this._convertLiteralColorValue(s.outline.color),o.width=s.outline.width}s&&s.size?r.fontSize=s.size:r.fontSize=this.fontSize,null!==e&&("string"!=typeof e&&(e=""+e),r.string=e),i&&r._forceUpdateRenderData(),s&&s.event?(s.event.click&&(t._clickHandler=s.event.click),s.event.param?t._clickParam=s.event.param:t._clickParam=""):t._clickHandler=null}},onDestroy:function(){for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(),c.put(this._labelSegments[t])}});cc.RichText=e.exports=h},{"../platform/CCMacro":201,"../platform/js":217,"../utils/html-text-parser":269,"../utils/text-utils":278}],119:[function(t,e){var i=t("./CCWidget"),r=t("../base-ui/CCWidgetManager"),n=cc.Class({name:"cc.SafeArea",extends:t("./CCComponent"),editor:!1,onEnable:function(){this.updateArea(),cc.view.on("canvas-resize",this.updateArea,this)},onDisable:function(){cc.view.off("canvas-resize",this.updateArea,this)},updateArea:function(){var t=this.node.getComponent(i);if(t){t.updateAlignment();var e=this.node.position,n=this.node.getAnchorPoint();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var s=cc.winSize.width,o=cc.winSize.height,a=cc.sys.getSafeAreaRect();t.top=o-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=s-a.x-a.width,t.updateAlignment();var l=this.node.position,c=n.x-(l.x-e.x)/this.node.width,h=n.y-(l.y-e.y)/this.node.height;this.node.setAnchorPoint(c,h),r.add(t)}}});cc.SafeArea=e.exports=n},{"../base-ui/CCWidgetManager":90,"./CCComponent":106,"./CCWidget":129}],120:[function(t,e){var i=t("../utils/misc"),r=(t("./CCComponent"),cc.Enum({HORIZONTAL:0,VERTICAL:1})),n=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},direction:{default:r.HORIZONTAL,type:r,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:r},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=this._scrollView.node,i=t.convertToWorldSpaceAR(cc.v2(-t.anchorX*t.width,-t.anchorY*t.height)),r=e.convertToNodeSpaceAR(i);return r.x+=e.anchorX*e.width,r.y+=e.anchorY*e.height,r},_setOpacity:function(t){this.handle&&(this.node.opacity=t,this.handle.node.opacity=t)},_onScroll:function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e.getContentSize(),n=this._scrollView.node.getContentSize(),s=this.node.getContentSize();if(this._conditionalDisableScrollBar(i,n))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var o=0,a=0,l=0,c=0,h=0;this.direction===r.HORIZONTAL?(o=i.width,a=n.width,h=s.width,l=t.x,c=-this._convertToScrollViewSpace(e).x):this.direction===r.VERTICAL&&(o=i.height,a=n.height,h=s.height,l=t.y,c=-this._convertToScrollViewSpace(e).y);var u=this._calculateLength(o,a,h,l),d=this._calculatePosition(o,a,h,c,l,u);this._updateLength(u),this._updateHanlderPosition(d)}}},_updateHanlderPosition:function(t){if(this.handle){var e=this._fixupHandlerPosition();this.handle.node.setPosition(t.x+e.x,t.y+e.y)}},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this.handle.node.getContentSize(),n=this.handle.node.parent,s=this.node.convertToWorldSpaceAR(cc.v2(-t.width*e.x,-t.height*e.y)),o=n.convertToNodeSpaceAR(s);return this.direction===r.HORIZONTAL?o=cc.v2(o.x,o.y+(t.height-i.height)/2):this.direction===r.VERTICAL&&(o=cc.v2(o.x+(t.width-i.width)/2,o.y)),this.handle.node.setPosition(o),o},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===r.HORIZONTAL||t.height<=e.height&&this.direction===r.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),i=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i,r){var n=t;return r&&(n+=20*(r>0?r:-r)),i*(e/n)},_calculatePosition:function(t,e,n,s,o,a){var l=t-e;o&&(l+=Math.abs(o));var c=0;l&&(c=s/l,c=i.clamp01(c));var h=(n-a)*c;return this.direction===r.VERTICAL?cc.v2(0,h):cc.v2(h,0)},_updateLength:function(t){if(this.handle){var e=this.handle.node,i=e.getContentSize();e.setAnchorPoint(cc.v2(0,0)),this.direction===r.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=n},{"../utils/misc":271,"./CCComponent":106}],121:[function(t,e){var i=t("../CCNode").EventType,r=cc.v2(),n=cc.v2(),s=function(){return(new Date).getMilliseconds()},o=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),a={"scroll-to-top":o.SCROLL_TO_TOP,"scroll-to-bottom":o.SCROLL_TO_BOTTOM,"scroll-to-left":o.SCROLL_TO_LEFT,"scroll-to-right":o.SCROLL_TO_RIGHT,scrolling:o.SCROLLING,"bounce-bottom":o.BOUNCE_BOTTOM,"bounce-left":o.BOUNCE_LEFT,"bounce-right":o.BOUNCE_RIGHT,"bounce-top":o.BOUNCE_TOP,"scroll-ended":o.SCROLL_ENDED,"touch-up":o.TOUCH_UP,"scroll-ended-with-threshold":o.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":o.SCROLL_BEGAN},l=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(){this._calculateBoundary()}},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:o},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToOffset:function(t,e,i){var r=this.getMaxScrollOffset(),n=cc.v2(0,0);0===r.x?n.x=0:n.x=t.x/r.x,0===r.y?n.y=1:n.y=(r.y-t.y)/r.y,this.scrollTo(n,e,i)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(e,t)},getMaxScrollOffset:function(){var t=this._view.getContentSize(),e=this.content.getContentSize(),i=e.width-t.width,r=e.height-t.height;return i=i>=0?i:0,r=r>=0?r:0,cc.v2(i,r)},scrollToPercentHorizontal:function(t,e,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},scrollTo:function(t,e,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},scrollToPercentVertical:function(t,e,i){var r=this._calculateMovePercentDelta({anchor:cc.v2(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){t.fuzzyEquals(this.getContentPosition(),1e-4)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){if(this.enabledInHierarchy&&!this.hasNestedViewGroup(t,e)){var i=cc.v2(0,0),r=-.1;cc.sys.os===cc.sys.OS_WINDOWS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(r=-.1/3),this.vertical?i=cc.v2(0,t.getScrollY()*r):this.horizontal&&(i=cc.v2(t.getScrollY()*r,0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},_checkMouseWheel:function(t){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,r=t.applyToVertical;this._calculateBoundary(),e=e.clampf(cc.v2(0,0),cc.v2(1,1));var n=this._view.getContentSize(),s=this.content.getContentSize(),o=this._getContentBottomBoundary()-this._bottomBoundary;o=-o;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var l=cc.v2(0,0),c=0;return i&&(c=s.width-n.width,l.x=a-c*e.x),r&&(c=s.height-n.height,l.y=o-c*e.y),l},_moveContentToTopLeft:function(t){var e=this.content.getContentSize(),i=this._getContentBottomBoundary()-this._bottomBoundary;i=-i;var r=cc.v2(0,0),n=0,s=this._getContentLeftBoundary()-this._leftBoundary;s=-s,e.height<t.height&&(n=e.height-t.height,r.y=i-n),e.width<t.width&&(n=e.width-t.width,r.x=s),this._updateScrollBarState(),this._moveContent(r),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t.updateLayout();var e=this._view.getContentSize(),i=e.width*this._view.anchorX,r=e.height*this._view.anchorY;this._leftBoundary=-i,this._bottomBoundary=-r,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e)}},hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var r=e[i];if(this.node===r)return!!t.target.getComponent(cc.ViewGroup);if(r.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){if(this.enabledInHierarchy&&!this.hasNestedViewGroup(t,e)){var i=t.touch;this.content&&this._handlePressLogic(i),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},_onTouchMoved:function(t,e){if(this.enabledInHierarchy&&!this.hasNestedViewGroup(t,e)){var i=t.touch;if(this.content&&this._handleMoveLogic(i),this.cancelInnerEvents){if(i.getLocation().sub(i.getStartLocation()).mag()>7&&!this._touchMoved&&t.target!==this.node){var r=new cc.Event.EventTouch(t.getTouches(),t.bubbles);r.type=cc.Node.EventType.TOUCH_CANCEL,r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},_onTouchEnded:function(t,e){if(this.enabledInHierarchy&&!this.hasNestedViewGroup(t,e)){this._dispatchEvent("touch-up");var i=t.touch;this.content&&this._handleReleaseLogic(i),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)}},_onTouchCancelled:function(t,e){if(this.enabledInHierarchy&&!this.hasNestedViewGroup(t,e)){if(!t.simulate){var i=t.touch;this.content&&this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_getLocalAxisAlignDelta:function(t){return this.node.convertToNodeSpaceAR(t.getLocation(),r),this.node.convertToNodeSpaceAR(t.getPreviousLocation(),n),r.sub(n)},_handleMoveLogic:function(t){var e=this._getLocalAxisAlignDelta(t);this._processDeltaMove(e)},_scrollChildren:function(t){var e,i=t=this._clampDelta(t);this.elastic&&(e=this._getHowMuchOutOfBoundary(),i.x*=0===e.x?1:.5,i.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(i),i=i.add(e));var r="",n="";this.vertical&&(i.y>0?this.content.y-this.content.anchorY*this.content.height+i.y>=this._bottomBoundary&&(r="scroll-to-bottom"):i.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+i.y<=this._topBoundary&&(r="scroll-to-top")),this.horizontal&&(i.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+i.x<=this._rightBoundary&&(n="scroll-to-right"):i.x>0&&this.content.x-this.content.anchorX*this.content.width+i.x>=this._leftBoundary&&(n="scroll-to-left")),this._moveContent(i,!1),(this.horizontal&&0!==i.x||this.vertical&&0!==i.y)&&(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),""!==r&&this._dispatchEvent(r),""!==n&&this._dispatchEvent(n)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=s(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this._view.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var e=s();this._touchMoveTimeDeltas.push((e-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=e},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).fuzzyEquals(cc.v2(0,0),1e-4))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),t.x>0&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.fuzzyEquals(cc.v2(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var e=this._getLocalAxisAlignDelta(t);this._gatherTouchMove(e),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var r,n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(r=n,n=(r-=1)*r*r*r*r+1);var s=this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(n)),o=Math.abs(n-1)<=1e-4;if(Math.abs(n-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var a=s.sub(this._autoScrollBrakingStartPosition);e&&(a=a.mul(i)),s=this._autoScrollBrakingStartPosition.add(a)}else{var l=s.sub(this.getContentPosition()),c=this._getHowMuchOutOfBoundary(l);c.fuzzyEquals(cc.v2(0,0),1e-4)||(s=s.add(c),o=!0)}o&&(this._autoScrolling=!1);var h=s.sub(this.getContentPosition());this._moveContent(this._clampDelta(h),o),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var e=t.mul(.7);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,e){var i=this._calculateAutoScrollTimeByInitalSpeed(e.mag()),r=t.normalize(),n=this.content.getContentSize(),s=this._view.getContentSize(),o=n.width-s.width,a=n.height-s.height,l=this._calculateAttenuatedFactor(o),c=this._calculateAttenuatedFactor(a);r=cc.v2(r.x*o*(1-this.brake)*l,r.y*a*c*(1-this.brake));var h=t.mag(),u=r.mag()/h;r=r.add(t),this.brake>0&&u>7&&(u=Math.sqrt(u),r=t.mul(u).add(t)),this.brake>0&&u>3&&(i*=u=3),0===this.brake&&u>1&&(i*=u),this._startAutoScroll(r,i,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,e,i){var r=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=r,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),t))<=0||t>=.5)return cc.v2(0,0);var e=cc.v2(0,0);return e=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e)}),e),cc.v2(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},_moveContent:function(t,e){var i=this._flattenVectorByDirection(t),r=this.getContentPosition().add(i);this.setContentPosition(r);var n=this._getHowMuchOutOfBoundary();this._updateScrollBar(n),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if((t=t||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.v2(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.fuzzyEquals(cc.v2(0,0),1e-4)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},_updateScrollBarState:function(){if(this.content){var t=this.content.getContentSize(),e=this._view.getContentSize();this.verticalScrollBar&&(t.height<e.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(t.width<e.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<a[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,a[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var t=this._getHowMuchOutOfBoundary(cc.v2(0,0)),e=this.getContentPosition().add(t);this.content&&(this.content.setPosition(e),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(i.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(i.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(i.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(i.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(i.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(i.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(i.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(i.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(i.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(i.SIZE_CHANGED,this._calculateBoundary,this))),this._updateScrollBarState()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=l},{"../CCNode":29,"./CCViewGroup":128}],122:[function(t,e){var i=t("../utils/misc"),r=t("./CCComponent"),n=cc.Enum({Horizontal:0,Vertical:1}),s=cc.Class({name:"cc.Slider",extends:r,editor:!1,ctor:function(){this._offset=cc.v2(),this._touchHandle=!1,this._dragging=!1},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:n.Horizontal,type:n,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:n},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,this._touchHandle=!0,this._offset=this.handle.node.convertToNodeSpaceAR(t.touch.getLocation()),t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,this._touchHandle=!1,this._offset=cc.v2(),t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){if(this.handle){var e=this.node,r=e.convertToNodeSpaceAR(t.getLocation());this.direction===n.Horizontal?this.progress=i.clamp01((r.x-this._offset.x+e.anchorX*e.width)/e.width):this.progress=i.clamp01((r.y-this._offset.y+e.anchorY*e.height)/e.height)}},_updateHandlePosition:function(){if(this.handle){var t;t=this.direction===n.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var e=this.node.convertToWorldSpaceAR(t);this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(e)}}});cc.Slider=e.exports=s},{"../utils/misc":271,"./CCComponent":106}],123:[function(t,e){var i=t("../utils/misc"),r=(t("../CCNode").EventType,t("./CCRenderComponent")),n=t("../utils/blend-func"),s=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),o=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),a=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),l=cc.Enum({NORMAL:0,GRAY:1}),c=cc.Class({name:"cc.Sprite",extends:r,mixins:[n],editor:!1,properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:s.SIMPLE,_sizeMode:a.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t){var e=this._spriteFrame;e!==t&&(this._spriteFrame=t,this._applySpriteFrame(e))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.setVertsDirty(),this._resetAssembler())},type:s,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){t!==this._fillType&&(this._fillType=t,this.setVertsDirty(),this._resetAssembler())},type:o,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===s.FILLED&&this.setVertsDirty()},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=i.clampf(t,-1,1),this._type===s.FILLED&&this.setVertsDirty()},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=i.clampf(t,-1,1),this._type===s.FILLED&&this.setVertsDirty()},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type!==s.SIMPLE&&this._type!==s.MESH||this.setVertsDirty())},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){this._sizeMode=t,t!==a.CUSTOM&&this._applySpriteSize()},animatable:!1,type:a,tooltip:!1}},statics:{FillType:o,Type:s,SizeMode:a,State:l},setVisible:function(t){this.enabled=t},setState:function(){},getState:function(){},__preload:function(){this._super(),this._applySpriteFrame()},onEnable:function(){this._super(),this._validateRender(),this._spriteFrame&&this._spriteFrame.isValid&&this._spriteFrame.ensureLoadTexture(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onRestore:!1,_updateMaterial:function(){var t=null;this._spriteFrame&&(t=this._spriteFrame.getTexture());var e=this.getMaterial(0);if(e){var i=e.getDefine("USE_TEXTURE");void 0===i||i||e.define("USE_TEXTURE",!0);var r=t&&t.getImpl();e.getProperty("texture")!==r&&e.setProperty("texture",t)}n.prototype._updateMaterial.call(this)},_applyAtlas:!1,_validateRender:function(){var t=this._spriteFrame;this._materials[0]&&t&&t.textureLoaded()||this.disableRender()},_applySpriteSize:function(){if(this.isValid&&this._spriteFrame&&this._spriteFrame.isValid){if(a.RAW===this._sizeMode){var t=this._spriteFrame._originalSize;this.node.setContentSize(t)}else if(a.TRIMMED===this._sizeMode){var e=this._spriteFrame._rect;this.node.setContentSize(e.width,e.height)}this.setVertsDirty()}},_applySpriteFrame:function(t){if(this.isValid){var e=t&&t.isValid&&t.getTexture();e&&!e.loaded&&t.off("load",this._applySpriteSize,this);var i=this._spriteFrame,r=i&&i.isValid,n=r&&i.getTexture();e!==n&&this._updateMaterial(),n&&n.loaded?this._applySpriteSize():(this.disableRender(),r&&i.once("load",this._applySpriteSize,this))}}});cc.Sprite=e.exports=c},{"../CCNode":29,"../utils/blend-func":265,"../utils/misc":271,"./CCRenderComponent":117}],124:[function(t,e){var i=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),r=cc.Enum({VERTICAL:0,HORIZONTAL:1}),n=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),s=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),o=cc.Class({name:"cc.StudioComponent",extends:cc.Component,editor:!1,properties:!1,statics:{ComponentType:i,ListDirection:r,VerticalAlign:n,HorizontalAlign:s}});cc.StudioComponent=e.exports=o;var a=cc.Class({name:"cc.StudioWidget",extends:cc.Widget,editor:!1,_validateTargetInDEV:function(){}});cc.StudioWidget=e.exports=a},{}],125:[function(t,e){var i=t("../utils/gray-sprite-state"),r=cc.Class({name:"cc.Toggle",extends:t("./CCButton"),mixins:[i],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked},set:function(t){if(t!==this._N$isChecked){var e=this.toggleGroup||this._toggleContainer;e&&e.enabled&&this._N$isChecked&&!e.allowSwitchOff||(this._N$isChecked=t,this._updateCheckMark(),e&&e.enabled&&e.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents())}},tooltip:!1},toggleGroup:{default:null,tooltip:!1,type:t("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this)},_hideCheckMark:function(){this._N$isChecked=!1,this._updateCheckMark()},toggle:function(t){this.isChecked=!this.isChecked,cc.Toggle._triggerEventInScript_isChecked||!cc.Toggle._triggerEventInScript_check&&!t||this._emitToggleEvents()},check:function(){this.isChecked=!0,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},uncheck:function(){this.isChecked=!1,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){if(this._super(),this.enableAutoGrayEffect&&this.checkMark){var t=!this.interactable;this._switchGrayMaterial(t,this.checkMark)}},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)}});cc.Toggle=e.exports=r,t("../platform/js").get(r.prototype,"_toggleContainer",(function(){var t=this.node.parent;return cc.Node.isNode(t)?t.getComponent(cc.ToggleContainer):null}))},{"../platform/js":217,"../utils/gray-sprite-state":268,"./CCButton":104,"./CCToggleGroup":127}],126:[function(t,e){var i=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},checkEvents:{default:[],type:cc.Component.EventHandler}},updateToggles:function(t){this.enabledInHierarchy&&t.isChecked&&(this.toggleItems.forEach((function(e){e!==t&&e.isChecked&&e.enabled&&e._hideCheckMark()})),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,t))},_allowOnlyOneToggleChecked:function(){var t=!1;return this.toggleItems.forEach((function(e){t?e._hideCheckMark():e.isChecked&&(t=!0)})),t},_makeAtLeastOneToggleChecked:function(){if(!this._allowOnlyOneToggleChecked()&&!this.allowSwitchOff){var t=this.toggleItems;t.length>0&&t[0].check()}},onEnable:function(){this._makeAtLeastOneToggleChecked(),this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)}});t("../platform/js").get(i.prototype,"toggleItems",(function(){return this.node._children.map((function(t){return t.getComponent(cc.Toggle)})).filter(Boolean)})),cc.ToggleContainer=e.exports=i},{"../platform/js":217}],127:[function(t,e){var i=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(t){this.enabledInHierarchy&&this._toggleItems.forEach((function(e){t.isChecked&&e!==t&&e.isChecked&&e.enabled&&e._hideCheckMark()}))},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){var e=this._toggleItems.indexOf(t);e>-1&&this._toggleItems.splice(e,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var t=!1;return this._toggleItems.forEach((function(e){t&&e.enabled&&e._hideCheckMark(),e.isChecked&&e.enabled&&(t=!0)})),t},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),r=t("../platform/js"),n=!1;r.get(cc,"ToggleGroup",(function(){return n||(cc.errorID(1405,"cc.ToggleGroup","cc.ToggleContainer"),n=!0),i})),e.exports=i},{"../platform/js":217}],128:[function(t,e){var i=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=i},{"./CCComponent":106}],129:[function(t,e){var i=t("../base-ui/CCWidgetManager"),r=i.AlignMode,n=i._AlignFlags,s=n.TOP,o=n.MID,a=n.BOT,l=n.LEFT,c=n.CENTER,h=n.RIGHT,u=s|a,d=l|h,p=cc.Class({name:"cc.Widget",extends:t("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(t){this._target=t},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return(this._alignFlags&s)>0},set:function(t){this._setAlign(s,t)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return(this._alignFlags&o)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=o):this._alignFlags&=~o},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return(this._alignFlags&a)>0},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return(this._alignFlags&l)>0},set:function(t){this._setAlign(l,t)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&c)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=c):this._alignFlags&=~c},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return(this._alignFlags&h)>0},set:function(t){this._setAlign(h,t)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&d)===d},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&u)===u},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:!1},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:!1},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},alignMode:{default:r.ON_WINDOW_RESIZE,type:r,tooltip:!1},_wasAlignOnce:{default:void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:r},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?r.ONCE:r.ALWAYS,this._wasAlignOnce=void 0)},onEnable:function(){i.add(this)},onDisable:function(){i.remove(this)},_validateTargetInDEV:!1,_setAlign:function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&d)>0;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t)}},updateAlignment:function(){i.updateAlignment(this.node)}});Object.defineProperty(p.prototype,"isAlignOnce",{get:function(){return this.alignMode===r.ONCE},set:function(t){this.alignMode=t?r.ONCE:r.ALWAYS}}),cc.Widget=e.exports=p},{"../base-ui/CCWidgetManager":90,"./CCComponent":106}],130:[function(t,e){var i=t("../../platform/CCMacro"),r=t("../editbox/EditBoxImplBase"),n=t("../CCLabel"),s=t("./types"),o=s.InputMode,a=s.InputFlag,l=s.KeyboardReturnType;var c=cc.Class({name:"cc.EditBox",extends:cc.Component,editor:!1,properties:{_string:"",string:{tooltip:!1,get:function(){return this._string},set:function(t){t=""+t,this.maxLength>=0&&t.length>=this.maxLength&&(t=t.slice(0,this.maxLength)),this._string=t,this._updateString(t)}},textLabel:{tooltip:!1,default:null,type:n,notify:function(t){this.textLabel&&this.textLabel!==t&&(this._updateTextLabel(),this._updateLabels())}},placeholderLabel:{tooltip:!1,default:null,type:n,notify:function(t){this.placeholderLabel&&this.placeholderLabel!==t&&(this._updatePlaceholderLabel(),this._updateLabels())}},background:{tooltip:!1,default:null,type:cc.Sprite,notify:function(t){this.background&&this.background!==t&&this._updateBackgroundSprite()}},_N$backgroundImage:{default:void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null},set:function(t){this.background&&(this.background.spriteFrame=t)}},returnType:{default:l.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:l},_N$returnType:{default:void 0,type:cc.Float},inputFlag:{tooltip:!1,default:a.DEFAULT,type:a,notify:function(){this._updateString(this._string)}},inputMode:{tooltip:!1,default:o.ANY,type:o,notify:function(t){this.inputMode!==t&&(this._updateTextLabel(),this._updatePlaceholderLabel())}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:0},set:function(t){this.textLabel&&(this.textLabel.fontSize=t)}},_N$fontSize:{default:void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:0},set:function(t){this.textLabel&&(this.textLabel.lineHeight=t)}},_N$lineHeight:{default:void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:cc.Color.BLACK},set:function(t){this.textLabel&&(this.textLabel.node.color=t,this.textLabel.node.opacity=t.a)}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:""},set:function(t){this.placeholderLabel&&(this.placeholderLabel.string=t)}},_N$placeholder:{default:void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:0},set:function(t){this.placeholderLabel&&(this.placeholderLabel.fontSize=t)}},_N$placeholderFontSize:{default:void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:cc.Color.BLACK},set:function(t){this.placeholderLabel&&(this.placeholderLabel.node.color=t,this.placeholderLabel.node.opacity=t.a)}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,default:20},_N$maxLength:{default:void 0,type:cc.Float},stayOnTop:{default:!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.")}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{_ImplClass:r,KeyboardReturnType:l,InputFlag:a,InputMode:o},_init:function(){this._upgradeComp(),this._isLabelVisible=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this),(this._impl=new c._ImplClass).init(this),this._updateString(this._string),this._syncSize()},_updateBackgroundSprite:function(){var t=this.background;if(!t){var e=this.node.getChildByName("BACKGROUND_SPRITE");e||(e=new cc.Node("BACKGROUND_SPRITE")),(t=e.getComponent(cc.Sprite))||(t=e.addComponent(cc.Sprite)),e.parent=this.node,this.background=t}t.type=cc.Sprite.Type.SLICED,void 0!==this._N$backgroundImage&&(t.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0)},_updateTextLabel:function(){var t=this.textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||(e=new cc.Node("TEXT_LABEL")),(t=e.getComponent(n))||(t=e.addComponent(n)),e.parent=this.node,this.textLabel=t}t.node.setAnchorPoint(0,1),t.overflow=n.Overflow.CLAMP,this.inputMode===o.ANY?(t.verticalAlign=i.VerticalTextAlignment.TOP,t.enableWrapText=!0):(t.verticalAlign=i.VerticalTextAlignment.CENTER,t.enableWrapText=!1),t.string=this._updateLabelStringStyle(this._string),void 0!==this._N$fontColor&&(t.node.color=this._N$fontColor,t.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0),void 0!==this._N$fontSize&&(t.fontSize=this._N$fontSize,this._N$fontSize=void 0),void 0!==this._N$lineHeight&&(t.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0)},_updatePlaceholderLabel:function(){var t=this.placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new cc.Node("PLACEHOLDER_LABEL")),(t=e.getComponent(n))||(t=e.addComponent(n)),e.parent=this.node,this.placeholderLabel=t}t.node.setAnchorPoint(0,1),t.overflow=n.Overflow.CLAMP,this.inputMode===o.ANY?(t.verticalAlign=i.VerticalTextAlignment.TOP,t.enableWrapText=!0):(t.verticalAlign=i.VerticalTextAlignment.CENTER,t.enableWrapText=!1),t.string=this.placeholder,void 0!==this._N$placeholderFontColor&&(t.node.color=this._N$placeholderFontColor,t.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0),void 0!==this._N$placeholderFontSize&&(t.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0)},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0),void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0),void 0!==this._N$backgroundImage&&this._updateBackgroundSprite(),void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel(),void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel(),void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0)},_syncSize:function(){if(this._impl){var t=this.node.getContentSize();this._impl.setSize(t.width,t.height)}},_showLabels:function(){this._isLabelVisible=!0,this._updateLabels()},_hideLabels:function(){this._isLabelVisible=!1,this.textLabel&&(this.textLabel.node.active=!1),this.placeholderLabel&&(this.placeholderLabel.node.active=!1)},_updateLabels:function(){if(this._isLabelVisible){var t=this._string;this.textLabel&&(this.textLabel.node.active=""!==t),this.placeholderLabel&&(this.placeholderLabel.node.active=""===t)}},_updateString:function(t){var e=this.textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},_updateLabelStringStyle:function(t,e){var i=this.inputFlag;if(e||i!==a.PASSWORD)i===a.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===a.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===a.INITIAL_CAPS_SENTENCE&&(t=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(t));else{for(var r="",n=t.length,s=0;s<n;++s)r+="●";t=r}return t},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,cc.Component.EventHandler.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onEnable:function(){this._registerEvent(),this._impl&&this._impl.enable()},onDisable:function(){this._unregisterEvent(),this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&this._impl.clear()},__preload:function(){this._init()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){t.stopPropagation()},_onTouchCancel:function(t){t.stopPropagation()},_onTouchEnded:function(t){this._impl&&this._impl.beginEditing(),t.stopPropagation()},setFocus:function(){cc.errorID(1400,"setFocus()","focus()"),this._impl&&this._impl.setFocus(!0)},focus:function(){this._impl&&this._impl.setFocus(!0)},blur:function(){this._impl&&this._impl.setFocus(!1)},isFocused:function(){return!!this._impl&&this._impl.isFocused()},update:function(){this._impl&&this._impl.update()}});cc.EditBox=e.exports=c,cc.sys.isBrowser&&t("./WebEditBoxImpl")},{"../../platform/CCMacro":201,"../CCLabel":108,"../editbox/EditBoxImplBase":131,"./WebEditBoxImpl":132,"./types":134}],131:[function(t,e){var i=cc.Class({ctor:function(){this._delegate=null,this._editing=!1},init:function(){},enable:function(){},disable:function(){this._editing&&this.endEditing()},clear:function(){},update:function(){},setTabIndex:function(){},setSize:function(){},setFocus:function(t){t?this.beginEditing():this.endEditing()},isFocused:function(){return this._editing},beginEditing:function(){},endEditing:function(){}});e.exports=i},{}],132:[function(t){var e,i=(e=t("../../value-types/mat4"))&&e.__esModule?e:{default:e},r=t("../../platform/utils"),n=t("../../platform/CCMacro"),s=t("./types"),o=t("../CCLabel"),a=t("./tabIndexUtil"),l=cc.EditBox,c=cc.js,h=s.InputMode,u=s.InputFlag,d=s.KeyboardReturnType,p={zoomInvalid:!1};cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(p.zoomInvalid=!0);var f=0,_=cc.v3(),m=null,g=!1,y=!1,v=l._ImplClass;function b(){v.call(this),this._domId="EditBoxId_"+ ++f,this._placeholderStyleSheet=null,this._elem=null,this._isTextArea=!1,this._worldMat=new i.default,this._cameraMat=new i.default,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this._cacheViewportRect=cc.rect(0,0,0,0),this._inputMode=null,this._inputFlag=null,this._returnType=null,this._eventListeners={},this._textLabelFont=null,this._textLabelFontSize=null,this._textLabelFontColor=null,this._textLabelAlign=null,this._placeholderLabelFont=null,this._placeholderLabelFontSize=null,this._placeholderLabelFontColor=null,this._placeholderLabelAlign=null,this._placeholderLineHeight=null}c.extend(b,v),l._ImplClass=b,Object.assign(b.prototype,{init:function(t){t&&(this._delegate=t,t.inputMode===h.ANY?this._createTextArea():this._createInput(),a.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),g=cc.view.isAutoFullScreenEnabled(),y=cc.view._resizeWithBrowserSize)},clear:function(){this._removeEventListeners(),this._removeDomFromGameContainer(),a.remove(this),m===this&&(m=null)},update:function(){this._updateMatrix()},setTabIndex:function(t){this._elem.tabIndex=t,a.resort()},setSize:function(t,e){var i=this._elem;i.style.width=t+"px",i.style.height=e+"px"},beginEditing:function(){m&&m!==this&&m.setFocus(!1),this._editing=!0,m=this,this._delegate.editBoxEditingDidBegan(),this._showDom(),this._elem.focus()},endEditing:function(){this._elem&&this._elem.blur()},_createInput:function(){this._isTextArea=!1,this._elem=document.createElement("input")},_createTextArea:function(){this._isTextArea=!0,this._elem=document.createElement("textarea")},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem),document.head.appendChild(this._placeholderStyleSheet)},_removeDomFromGameContainer:function(){r.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem),r.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet),delete this._elem,delete this._placeholderStyleSheet},_showDom:function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._elem.style.display="",this._delegate._hideLabels(),cc.sys.isMobile&&this._showDomOnMobile()},_hideDom:function(){this._elem.style.display="none",this._delegate._showLabels(),cc.sys.isMobile&&this._hideDomOnMobile()},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(g&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),y&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll())},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(y&&cc.view.resizeWithBrowserSize(!0),setTimeout((function(){m||g&&cc.view.enableAutoFullScreen(!0)}),800))},_adjustWindowScroll:function(){var t=this;setTimeout((function(){window.scrollY<100&&t._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),800)},_scrollBackWindow:function(){setTimeout((function(){var t=cc.sys;t.browserType!==t.BROWSER_TYPE_WECHAT||t.os!==t.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),800)},_updateCameraMatrix:function(){var t=this._delegate.node;t.getWorldMatrix(this._worldMat);var e=this._worldMat,r=t._contentSize,n=t._anchorPoint;_.x=-n.x*r.width,_.y=-n.y*r.height,i.default.transform(e,e,_);var s=cc.Camera.findCamera(t);return!!s&&(s.getWorldToScreenMatrix2D(this._cameraMat),i.default.mul(this._cameraMat,this._cameraMat,e),!0)},_updateMatrix:function(){if(this._updateCameraMatrix()){var t=this._cameraMat.m,e=this._delegate.node,i=cc.view;if(this._m00!==t[0]||this._m01!==t[1]||this._m04!==t[4]||this._m05!==t[5]||this._m12!==t[12]||this._m13!==t[13]||this._w!==e._contentSize.width||this._h!==e._contentSize.height||!this._cacheViewportRect.equals(i._viewportRect)){this._m00=t[0],this._m01=t[1],this._m04=t[4],this._m05=t[5],this._m12=t[12],this._m13=t[13],this._w=e._contentSize.width,this._h=e._contentSize.height,this._cacheViewportRect.set(i._viewportRect);var r=i._scaleX,n=i._scaleY,s=i._viewportRect,o=i._devicePixelRatio;r/=o,n/=o;var a=cc.game.container,l=t[0]*r,c=t[1],h=t[4],u=t[5]*n,d=a&&a.style.paddingLeft&&parseInt(a.style.paddingLeft);d+=s.x/o;var f=a&&a.style.paddingBottom&&parseInt(a.style.paddingBottom);f+=s.y/o;var _=t[12]*r+d,m=t[13]*n+f;p.zoomInvalid&&(this.setSize(e.width*l,e.height*u),l=1,u=1);var g=this._elem,y="matrix("+l+","+-c+","+-h+","+u+","+_+","+-m+")";g.style.transform=y,g.style["-webkit-transform"]=y,g.style["transform-origin"]="0px 100% 0px",g.style["-webkit-transform-origin"]="0px 100% 0px"}}},_updateInputType:function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,r=t.returnType,n=this._elem;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==r){if(this._inputMode=e,this._inputFlag=i,this._returnType=r,this._isTextArea){var s="none";return i===u.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":i===u.INITIAL_CAPS_WORD&&(s="capitalize"),void(n.style.textTransform=s)}if(i===u.PASSWORD)return n.type="password",void(n.style.textTransform="none");var o=n.type;e===h.EMAIL_ADDR?o="email":e===h.NUMERIC||e===h.DECIMAL?o="number":e===h.PHONE_NUMBER?(o="number",n.pattern="[0-9]*",n.onmousewheel=function(){return!1}):e===h.URL?o="url":(o="text",r===d.SEARCH&&(o="search")),n.type=o;var a="none";i===u.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":i===u.INITIAL_CAPS_WORD&&(a="capitalize"),n.style.textTransform=a}},_updateMaxLength:function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._elem.maxLength=t},_initStyleSheet:function(){var t=this._elem;t.style.display="none",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflow_y="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")},_updateStyleSheet:function(){var t=this._delegate,e=this._elem;e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel)},_updateTextLabel:function(t){if(t){var e=t.font;e=!e||e instanceof cc.BitmapFont?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scaleY;if(this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign){this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign;var r=this._elem;switch(r.style.fontSize=i+"px",r.style.color=t.node.color.toCSS(),r.style.fontFamily=e,t.horizontalAlign){case o.HorizontalAlign.LEFT:r.style.textAlign="left";break;case o.HorizontalAlign.CENTER:r.style.textAlign="center";break;case o.HorizontalAlign.RIGHT:r.style.textAlign="right"}}}},_updatePlaceholderLabel:function(t){if(t){var e=t.font;e=!e||e instanceof cc.BitmapFont?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scaleY;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r,n=this._placeholderStyleSheet,s=t.node.color.toCSS(),a=t.fontSize;switch(t.horizontalAlign){case o.HorizontalAlign.LEFT:r="left";break;case o.HorizontalAlign.CENTER:r="center";break;case o.HorizontalAlign.RIGHT:r="right"}n.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+e+"; font-size: "+i+"px; color: "+s+"; line-height: "+a+"px; text-align: "+r+";}",cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(n.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},_registerEventListeners:function(){var t=this,e=this._elem,i=!1,r=this._eventListeners;r.compositionStart=function(){i=!0},r.compositionEnd=function(){i=!1,t._delegate.editBoxTextChanged(e.value)},r.onInput=function(){if(!i){var r=t._delegate.maxLength;r>=0&&(e.value=e.value.slice(0,r)),t._delegate.editBoxTextChanged(e.value)}},r.onClick=function(){t._editing&&cc.sys.isMobile&&t._adjustWindowScroll()},r.onKeydown=function(i){i.keyCode===n.KEY.enter?(i.stopPropagation(),t._delegate.editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===n.KEY.tab&&(i.stopPropagation(),i.preventDefault(),a.next(t))},r.onBlur=function(){cc.sys.isMobile&&i&&r.compositionEnd(),t._editing=!1,m=null,t._hideDom(),t._delegate.editBoxEditingDidEnded()},e.addEventListener("compositionstart",r.compositionStart),e.addEventListener("compositionend",r.compositionEnd),e.addEventListener("input",r.onInput),e.addEventListener("keydown",r.onKeydown),e.addEventListener("blur",r.onBlur),e.addEventListener("touchstart",r.onClick)},_removeEventListeners:function(){var t=this._elem,e=this._eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}})},{"../../platform/CCMacro":201,"../../platform/utils":220,"../../value-types/mat4":288,"../CCLabel":108,"./tabIndexUtil":133,"./types":134}],133:[function(t,e){e.exports={_tabIndexList:[],add:function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},remove:function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},resort:function(){this._tabIndexList.sort((function(t,e){return t._delegate._tabIndex-e._delegate._tabIndex}))},next:function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var r=e[i+1];r&&r._delegate._tabIndex>=0&&r.setFocus(!0)}}}},{}],134:[function(t,e){var i=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5}),r=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),n=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});e.exports={KeyboardReturnType:i,InputMode:r,InputFlag:n}},{}],135:[function(t,e){t("./CCComponent"),t("./CCComponentEventHandler"),t("./missing-script");var i=t("./SubContextView");i||(i=cc.Class({name:"cc.SubContextView",extends:cc.Component}),cc.SubContextView=cc.WXSubContextView=cc.SwanSubContextView=i);var r=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./editbox/CCEditBox"),t("./CCLabelOutline"),t("./CCLabelShadow"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents"),t("./CCMotionStreak"),t("./CCSafeArea"),i];e.exports=r},{"./CCAnimation":101,"./CCAudioSource":102,"./CCBlockInputEvents":103,"./CCButton":104,"./CCCanvas":105,"./CCComponent":106,"./CCComponentEventHandler":107,"./CCLabel":108,"./CCLabelOutline":109,"./CCLabelShadow":110,"./CCLayout":111,"./CCMask":112,"./CCMotionStreak":113,"./CCPageView":114,"./CCPageViewIndicator":115,"./CCProgressBar":116,"./CCRichText":118,"./CCSafeArea":119,"./CCScrollBar":120,"./CCScrollView":121,"./CCSlider":122,"./CCSprite":123,"./CCToggle":125,"./CCToggleContainer":126,"./CCToggleGroup":127,"./CCWidget":129,"./SubContextView":void 0,"./editbox/CCEditBox":130,"./missing-script":136}],136:[function(t,e){var i=cc.js,r=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t){return i._getClassById(t)||(cc.deserialize.reportMissingClass(t),r)}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=e.exports=r},{}],137:[function(t,e){var i=cc.js;t("../event/event");var r=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};i.extend(r,cc.Event);var n=r.prototype;n.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(t,e){this._x=t,this._y=e},n.getLocation=function(){return cc.v2(this._x,this._y)},n.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)},n._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},n.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)},n.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.setButton=function(t){this._button=t},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},r.NONE=0,r.DOWN=1,r.UP=2,r.MOVE=3,r.SCROLL=4,r.BUTTON_LEFT=0,r.BUTTON_RIGHT=2,r.BUTTON_MIDDLE=1,r.BUTTON_4=3,r.BUTTON_5=4,r.BUTTON_6=5,r.BUTTON_7=6,r.BUTTON_8=7;var s=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null};i.extend(s,cc.Event),(n=s.prototype).getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n._setEventCode=function(t){this._eventCode=t},n._setTouches=function(t){this._touches=t},n.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},n.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},n.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},n.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},n.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},n.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},s.MAX_TOUCHES=5,s.BEGAN=0,s.MOVED=1,s.ENDED=2,s.CANCELED=3;var o=function(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t};i.extend(o,cc.Event);var a=function(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e};i.extend(a,cc.Event),cc.Event.EventMouse=r,cc.Event.EventTouch=s,cc.Event.EventAcceleration=o,cc.Event.EventKeyboard=a,e.exports=cc.Event},{"../event/event":144}],138:[function(t,e){var i=t("../platform/js");cc.EventListener=function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8;var r=cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"},n=function(t,e){this._onCustomEvent=e,cc.EventListener.call(this,cc.EventListener.CUSTOM,t,this._callback)};i.extend(n,cc.EventListener),i.mixin(n.prototype,{_onCustomEvent:null,_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new n(this._listenerID,this._onCustomEvent)}});var s=function(){cc.EventListener.call(this,cc.EventListener.MOUSE,r.MOUSE,this._callback)};i.extend(s,cc.EventListener),i.mixin(s.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new s;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}});var o=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,r.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[]};i.extend(o,cc.EventListener),i.mixin(o.prototype,{constructor:o,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new o;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}});var a=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,r.TOUCH_ALL_AT_ONCE,null)};i.extend(a,cc.EventListener),i.mixin(a.prototype,{constructor:a,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var t=new a;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}});var l=function(t){this._onAccelerationEvent=t,cc.EventListener.call(this,cc.EventListener.ACCELERATION,r.ACCELERATION,this._callback)};i.extend(l,cc.EventListener),i.mixin(l.prototype,{constructor:l,_onAccelerationEvent:null,_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new l(this._onAccelerationEvent)}});var c=function(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,r.KEYBOARD,this._callback)};i.extend(c,cc.EventListener),i.mixin(c.prototype,{constructor:c,onKeyPressed:null,onKeyReleased:null,_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new c;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e=t.event;delete t.event;var i=null;for(var r in e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new o:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new a:e===cc.EventListener.MOUSE?i=new s:e===cc.EventListener.CUSTOM?(i=new n(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new c:e===cc.EventListener.ACCELERATION&&(i=new l(t.callback),delete t.callback),t)i[r]=t[r];return i},e.exports=cc.EventListener},{"../platform/js":217}],139:[function(t,e){var i=t("../platform/js");t("./CCEventListener");var r=cc.EventListener.ListenerID,n=function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0};n.prototype={constructor:n,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}};var s={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!1,_currentTouch:null,_currentTouchListener:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){var e=this._nodeListenersMap[t._id];if(e)for(var i=0,r=e.length;i<r;i++){var n=e[i]._getListenerID();null==this._dirtyListeners[n]&&(this._dirtyListeners[n]=!0)}if(t.childrenCount>0)for(var s=t._children,o=0,a=s.length;o<a;o++)this._setDirtyForNode(s[o])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode){var i,r,n=this._nodeListenersMap[t._id];if(n)for(i=0,r=n.length;i<r;i++){var s=n[i];s._setPaused(!0),s._claimedTouches&&s._claimedTouches.includes(this._currentTouch)&&this._clearCurTouch()}if(!0===e){var o=t._children;for(i=0,r=o?o.length:0;i<r;i++)this.pauseTarget(o[i],!0)}}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode){var i,r,n=this._nodeListenersMap[t._id];if(n)for(i=0,r=n.length;i<r;i++)n[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e){var s=t._children;for(i=0,r=s?s.length:0;i<r;i++)this.resumeTarget(s[i],!0)}}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new n,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var r=t._getSceneGraphPriority();null===r&&cc.logID(3507),this._associateNodeAndEventListener(r,t),r.activeInHierarchy&&this.resumeTarget(r)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){var t=this._dirtyListeners;for(var e in t)this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(t){if(t)for(var e,i=t.length-1;i>=0;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(t,i)},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var r=i.getFixedPriorityListeners(),n=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(n),this._removeAllListenersInVector(r),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var s,o=this._toAddedListeners;for(e=o.length-1;e>=0;e--)(s=o[e])&&s._getListenerID()===t&&cc.js.array.removeAt(o,e)},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(t))},_sortListenersOfSceneGraphPriority:function(t){var e=this._getListeners(t);if(e){var i=e.getSceneGraphPriorityListeners();i&&0!==i.length&&e.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();if(!(e&&r&&r._activeInHierarchy&&null!==r._parent))return-1;if(!t||!i||!i._activeInHierarchy||null===i._parent)return 1;for(var n=i,s=r,o=!1;n._parent._id!==s._parent._id;)n=null===n._parent._parent?(o=!0)&&r:n._parent,s=null===s._parent._parent?(o=!0)&&i:s._parent;if(n._id===s._id){if(n._id===r._id)return-1;if(n._id===i._id)return 1}return o?n._localZOrder-s._localZOrder:s._localZOrder-n._localZOrder},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var r=0,n=i.length;r<n&&!(i[r]._getFixedPriority()>=0);)++r;e.gt0Index=r}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,r,n=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),o=this._toRemovedListeners;if(s)for(e=s.length-1;e>=0;e--)(i=s[e])._isRegistered()||(cc.js.array.removeAt(s,e),-1!==(r=o.indexOf(i))&&o.splice(r,1));if(n)for(e=n.length-1;e>=0;e--)(i=n[e])._isRegistered()||(cc.js.array.removeAt(n,e),-1!==(r=o.indexOf(i))&&o.splice(r,1));s&&0===s.length&&t.clearSceneGraphListeners(),n&&0===n.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var r=this._toAddedListeners;if(0!==r.length){for(var n=0,s=r.length;n<s;n++)this._forceAddEventListener(r[n]);r.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(){var t=this._inDispatch;if(cc.assertID(t>0,3508),!(t>1)){var e;(e=this._listenersMap[r.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(e),(e=this._listenersMap[r.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(e),cc.assertID(1===t,3509);var i=this._toAddedListeners;if(0!==i.length){for(var n=0,s=i.length;n<s;n++)this._forceAddEventListener(i[n]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],r=this._listenersMap[i._getListenerID()];if(r){var n,s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();o&&-1!==(n=o.indexOf(i))&&o.splice(n,1),s&&-1!==(n=s.indexOf(i))&&s.splice(n,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered())return!1;var i=e.event,r=i.currentTouch;i.currentTarget=t._node;var n,o=!1,a=i.getEventCode(),l=cc.Event.EventTouch;if(a===l.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&s._currentTouch){var c=s._currentTouchListener._node;if(c&&c.activeInHierarchy)return!1}t.onTouchBegan&&(o=t.onTouchBegan(r,i))&&t._registered&&(t._claimedTouches.push(r),s._currentTouchListener=t,s._currentTouch=r)}else if(t._claimedTouches.length>0&&-1!==(n=t._claimedTouches.indexOf(r))){if(o=!0,!cc.macro.ENABLE_MULTI_TOUCH&&s._currentTouch&&s._currentTouch!==r)return!1;a===l.MOVED&&t.onTouchMoved?t.onTouchMoved(r,i):a===l.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,i),t._registered&&t._claimedTouches.splice(n,1),s._clearCurTouch()):a===l.CANCELED&&(t.onTouchCancelled&&t.onTouchCancelled(r,i),t._registered&&t._claimedTouches.splice(n,1),s._clearCurTouch())}return i.isStopped()?(s._updateTouchListeners(i),!0):!(!o||!t.swallowTouches||(e.needsMutableSet&&e.touches.splice(r,1),0))},_dispatchTouchEvent:function(t){this._sortEventListeners(r.TOUCH_ONE_BY_ONE),this._sortEventListeners(r.TOUCH_ALL_AT_ONCE);var e=this._getListeners(r.TOUCH_ONE_BY_ONE),i=this._getListeners(r.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var n=t.getTouches(),s=cc.js.array.copy(n),o={event:t,needsMutableSet:e&&i,touches:s,selTouch:null};if(e)for(var a=0;a<n.length;a++)t.currentTouch=n[a],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,o);i&&s.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:s}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,r=e.event,n=e.touches,o=r.getEventCode();return r.currentTarget=t._node,o===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(n,r):o===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(n,r):o===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(n,r):o===i.CANCELED&&t.onTouchesCancelled&&t.onTouchesCancelled(n,r),!!r.isStopped()&&(s._updateTouchListeners(r),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i||(i=[],this._nodeListenersMap[t._id]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t._id])},_dispatchEventToListeners:function(t,e,i){var r,n,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),l=0;if(o&&0!==o.length)for(;l<t.gt0Index;++l)if((n=o[l]).isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}if(a&&!s)for(r=0;r<a.length;r++)if((n=a[r]).isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}if(o&&!s)for(;l<o.length;++l)if((n=o[l]).isEnabled()&&!n._isPaused()&&n._isRegistered()&&e(n,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){var i=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var r in i){var n=i[r],s=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(o,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(s,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),n.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break}if(!e)for(var a=this._toAddedListeners,l=a.length-1;l>=0;l--){var c=a[l];if(c===t){cc.js.array.removeAt(a,l),c._setRegistered(!1);break}}this._currentTouchListener===t&&this._clearCurTouch()}},_clearCurTouch:function(){this._currentTouchListener=null,this._currentTouch=null},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=t.length-1;i>=0;i--){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){var i=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode)if(void 0!==t._id){var n,s=i._nodeListenersMap[t._id];if(s){var o=cc.js.array.copy(s);for(n=0;n<o.length;n++)i.removeListener(o[n]);delete i._nodeListenersMap[t._id]}var a=i._toAddedListeners;for(n=0;n<a.length;){var l=a[n];l._getSceneGraphPriority()===t?(l._setSceneGraphPriority(null),l._setRegistered(!1),a.splice(n,1)):++n}if(!0===e){var c,h=t.children;for(n=0,c=h.length;n<c;n++)i.removeListeners(h[n],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(r.TOUCH_ONE_BY_ONE):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(r.TOUCH_ALL_AT_ONCE):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(r.MOUSE):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(r.ACCELERATION):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(r.KEYBOARD):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var r in i){var n=i[r].getFixedPriorityListeners();if(n&&-1!==n.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=function(t){var e=cc.Event,i=t.type;return i===e.ACCELERATION?r.ACCELERATION:i===e.KEYBOARD?r.KEYBOARD:i.startsWith(e.MOUSE)?r.MOUSE:(i.startsWith(e.TOUCH)&&cc.logID(2e3),"")}(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}else cc.errorID(3511)},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}};i.get(cc,"eventManager",(function(){return cc.errorID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),s})),e.exports=cc.internal.eventManager=s},{"../platform/js":217,"./CCEventListener":138}],140:[function(){cc.Touch=function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e)},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.v2(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.v2(t.x,t.y):cc.v2(t||0,e||0)}}},{}],141:[function(t,e){t("./CCEvent"),t("./CCTouch"),t("./CCEventListener");var i=t("./CCEventManager");e.exports=i},{"./CCEvent":137,"./CCEventListener":138,"./CCEventManager":139,"./CCTouch":140}],142:[function(t,e){var i=cc.js,r=t("../platform/callbacks-invoker");function n(){r.call(this)}i.extend(n,r),n.prototype.emit=function(t,e){var i=t.type,r=this._callbackTable[i];if(r){var n=!r.isInvoking;r.isInvoking=!0;for(var s=r.callbackInfos,o=0,a=s.length;o<a;++o){var l=s[o];if(l&&l.callback&&(l.callback.call(l.target,t,e),t._propagationImmediateStopped))break}n&&(r.isInvoking=!1,r.containCanceled&&r.purgeCanceled())}},e.exports=n},{"../platform/callbacks-invoker":209}],143:[function(t,e){var i=t("../platform/js"),r=t("../platform/callbacks-invoker"),n=i.array.fastRemove;function s(){r.call(this)}i.extend(s,r);var o=s.prototype;o.__on=o.on,o.on=function(t,e,i,r){if(e)return this.hasEventListener(t,e,i)||(this.__on(t,e,i,r),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800)},o.__off=o.off,o.off=function(t,e,i){if(e)this.__off(t,e,i),i&&i.__eventTargets&&n(i.__eventTargets,this);else{var r=this._callbackTable[t];if(!r)return;for(var s=r.callbackInfos,o=0;o<s.length;++o){var a=s[o]&&s[o].target;a&&a.__eventTargets&&n(a.__eventTargets,this)}this.removeAll(t)}},o.targetOff=function(t){this.removeAll(t),t&&t.__eventTargets&&n(t.__eventTargets,this)},o.once=function(t,e,i){this.on(t,e,i,!0)},o.dispatchEvent=function(t){this.emit(t.type,t)},o.clear=function(){for(var t in this._callbackTable)for(var e=this._callbackTable[t].callbackInfos,i=e.length-1;i>=0;i--){var r=e[i];r&&this.off(t,r.callback,r.target)}},cc.EventTarget=e.exports=s},{"../platform/callbacks-invoker":209,"../platform/js":217}],144:[function(t,e){var i=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};i.extend(r,cc.Event),r.prototype.reset=r,r.prototype.setUserData=function(t){this.detail=t},r.prototype.getUserData=function(){return this.detail},r.prototype.getEventName=cc.Event.prototype.getType;var n=new i.Pool(10);r.put=function(t){n.put(t)},r.get=function(t,e){var i=n._get();return i?i.reset(t,e):i=new r(t,e),i},cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":217}],145:[function(t){t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")},{"./event":144,"./event-listeners":142,"./event-target":143,"./system-event":146}],146:[function(t,e){var i=t("../event/event-target"),r=t("../event-manager"),n=t("../platform/CCInputManager"),s=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),o=null,a=null,l=cc.Class({name:"SystemEvent",extends:i,statics:{EventType:s},setAccelerometerEnabled:function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){console.log("Device Motion Event request permission: "+t),n.setAccelerometerEnabled("granted"===t)})):n.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){n.setAccelerometerInterval(t)},on:function(t,e,i,n){this._super(t,e,i,n),t!==s.KEY_DOWN&&t!==s.KEY_UP||(o||(o=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=s.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=s.KEY_UP,cc.systemEvent.dispatchEvent(e)}})),r.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||r.addListener(o,1)),t===s.DEVICEMOTION&&(a||(a=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=s.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}})),r.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||r.addListener(a,1))},off:function(t,e,i){if(this._super(t,e,i),o&&(t===s.KEY_DOWN||t===s.KEY_UP)){var n=this.hasEventListener(s.KEY_DOWN),l=this.hasEventListener(s.KEY_UP);n||l||r.removeListener(o)}a&&t===s.DEVICEMOTION&&r.removeListener(a)}});cc.SystemEvent=e.exports=l,cc.systemEvent=new cc.SystemEvent},{"../event-manager":141,"../event/event-target":143,"../platform/CCInputManager":200}],147:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("../value-types/vec3")),n=o(t("../value-types/mat3")),s=o(t("./enums"));function o(t){return t&&t.__esModule?t:{default:t}}var a=new r.default,l=new r.default,c=new n.default,h=function(){function t(t,e,i,n,o,a){this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=s.default.SHAPE_AABB,this.center=new r.default(t,e,i),this.halfExtents=new r.default(n,o,a)}t.create=function(e,i,r,n,s,o){return new t(e,i,r,n,s,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return r.default.copy(t.center,e.center),r.default.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,i){return r.default.scale(t.center,r.default.add(a,e,i),.5),r.default.scale(t.halfExtents,r.default.sub(l,i,e),.5),t},t.set=function(t,e,i,n,s,o,a){return r.default.set(t.center,e,i,n),r.default.set(t.halfExtents,s,o,a),t};var e=t.prototype;return e.getBoundary=function(t,e){r.default.sub(t,this.center,this.halfExtents),r.default.add(e,this.center,this.halfExtents)},e.transform=function(t,e,i,n,s){s||(s=this),r.default.transformMat4(s.center,this.center,t),function(t,e,i){var n=c.m,s=i.m;n[0]=Math.abs(s[0]),n[1]=Math.abs(s[1]),n[2]=Math.abs(s[2]),n[3]=Math.abs(s[4]),n[4]=Math.abs(s[5]),n[5]=Math.abs(s[6]),n[6]=Math.abs(s[8]),n[7]=Math.abs(s[9]),n[8]=Math.abs(s[10]),r.default.transformMat3(t,e,c)}(s.halfExtents,this.halfExtents,t)},t}();i.default=h,e.exports=i.default},{"../value-types/mat3":287,"../value-types/vec3":296,"./enums":149}],148:[function(t,e,i){i.__esModule=!0,i.point_plane=d,i.pt_point_aabb=function(t,e,i){return r.Vec3.copy(t,e),r.Vec3.subtract(l,i.center,i.halfExtents),r.Vec3.add(c,i.center,i.halfExtents),t.x=t.x<l.x?l.x:t.x,t.y=t.y<l.x?l.y:t.y,t.z=t.z<l.x?l.z:t.z,t.x=t.x>c.x?c.x:t.x,t.y=t.y>c.x?c.y:t.y,t.z=t.z>c.x?c.z:t.z,t},i.pt_point_obb=function(t,e,i){var l=i.orientation.m;r.Vec3.set(n,l[0],l[1],l[2]),r.Vec3.set(s,l[3],l[4],l[5]),r.Vec3.set(o,l[6],l[7],l[8]),h[0]=n,h[1]=s,h[2]=o,u[0]=i.halfExtents.x,u[1]=i.halfExtents.y,u[2]=i.halfExtents.z,r.Vec3.subtract(a,e,i.center),r.Vec3.set(t,i.center.x,i.center.y,i.center.z);for(var c=0;c<3;c++){var d=r.Vec3.dot(a,h[c]);d>u[c]&&(d=u[c]),d<-u[c]&&(d=-u[c]),t.x+=d*h[c].x,t.y+=d*h[c].y,t.z+=d*h[c].z}return t},i.pt_point_plane=function(t,e,i){var n=d(e,i);return r.Vec3.subtract(t,e,r.Vec3.multiplyScalar(t,i.n,n))};var r=t("../value-types"),n=new r.Vec3,s=new r.Vec3,o=new r.Vec3,a=new r.Vec3,l=new r.Vec3,c=new r.Vec3,h=new Array(3),u=new Array(3);function d(t,e){return r.Vec3.dot(e.n,t)-e.d}},{"../value-types":286}],149:[function(t,e,i){i.__esModule=!0,i.default=void 0,i.default={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256},e.exports=i.default},{}],150:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("../value-types"),n=o(t("./enums")),s=o(t("./plane"));function o(t){return t&&t.__esModule?t:{default:t}}var a=new Array(8);a[0]=new r.Vec3(1,1,1),a[1]=new r.Vec3(-1,1,1),a[2]=new r.Vec3(-1,-1,1),a[3]=new r.Vec3(1,-1,1),a[4]=new r.Vec3(1,1,-1),a[5]=new r.Vec3(-1,1,-1),a[6]=new r.Vec3(-1,-1,-1),a[7]=new r.Vec3(1,-1,-1);var l,c=function(){function t(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=n.default.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=s.default.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new r.Vec3}t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)s.default.copy(t.planes[i],e.planes[i]);for(var n=0;n<8;++n)r.Vec3.copy(t.vertices[n],e.vertices[n]);return t};var e,i,o=t.prototype;return o.update=function(t,e){var i=t.m;if(r.Vec3.set(this.planes[0].n,i[3]+i[0],i[7]+i[4],i[11]+i[8]),this.planes[0].d=-(i[15]+i[12]),r.Vec3.set(this.planes[1].n,i[3]-i[0],i[7]-i[4],i[11]-i[8]),this.planes[1].d=-(i[15]-i[12]),r.Vec3.set(this.planes[2].n,i[3]+i[1],i[7]+i[5],i[11]+i[9]),this.planes[2].d=-(i[15]+i[13]),r.Vec3.set(this.planes[3].n,i[3]-i[1],i[7]-i[5],i[11]-i[9]),this.planes[3].d=-(i[15]-i[13]),r.Vec3.set(this.planes[4].n,i[3]+i[2],i[7]+i[6],i[11]+i[10]),this.planes[4].d=-(i[15]+i[14]),r.Vec3.set(this.planes[5].n,i[3]-i[2],i[7]-i[6],i[11]-i[10]),this.planes[5].d=-(i[15]-i[14]),this._type===n.default.SHAPE_FRUSTUM_ACCURATE){for(var s=0;s<6;s++){var o=this.planes[s],l=1/o.n.length();r.Vec3.multiplyScalar(o.n,o.n,l),o.d*=l}for(var c=0;c<8;c++)r.Vec3.transformMat4(this.vertices[c],a[c],e)}},o.transform=function(t){if(this._type===n.default.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)r.Vec3.transformMat4(this.vertices[e],this.vertices[e],t);s.default.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),s.default.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),s.default.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),s.default.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),s.default.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),s.default.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},e=t,(i=[{key:"accurate",set:function(t){this._type=t?n.default.SHAPE_FRUSTUM_ACCURATE:n.default.SHAPE_FRUSTUM}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=c,c.createOrtho=(l=new r.Vec3,function(t,e,i,n,o,a){var c=e/2,h=i/2;r.Vec3.set(l,c,h,n),r.Vec3.transformMat4(t.vertices[0],l,a),r.Vec3.set(l,-c,h,n),r.Vec3.transformMat4(t.vertices[1],l,a),r.Vec3.set(l,-c,-h,n),r.Vec3.transformMat4(t.vertices[2],l,a),r.Vec3.set(l,c,-h,n),r.Vec3.transformMat4(t.vertices[3],l,a),r.Vec3.set(l,c,h,o),r.Vec3.transformMat4(t.vertices[4],l,a),r.Vec3.set(l,-c,h,o),r.Vec3.transformMat4(t.vertices[5],l,a),r.Vec3.set(l,-c,-h,o),r.Vec3.transformMat4(t.vertices[6],l,a),r.Vec3.set(l,c,-h,o),r.Vec3.transformMat4(t.vertices[7],l,a),s.default.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),s.default.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),s.default.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),s.default.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),s.default.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),s.default.fromPoints(t.planes[0],t.vertices[7],t.vertices[5],t.vertices[6])}),e.exports=i.default},{"../value-types":286,"./enums":149,"./plane":155}],151:[function(t,e,i){i.__esModule=!0;var r={enums:!0,Triangle:!0,Aabb:!0,Ray:!0,intersect:!0,Sphere:!0,Obb:!0,Frustum:!0,Line:!0,Plane:!0};i.intersect=i.enums=i.Triangle=i.Sphere=i.Ray=i.Plane=i.Obb=i.Line=i.Frustum=i.Aabb=void 0;var n=_(t("./enums"));i.enums=n.default;var s=_(t("./triangle"));i.Triangle=s.default;var o=_(t("./aabb"));i.Aabb=o.default;var a=_(t("./ray"));i.Ray=a.default;var l=_(t("./intersect"));i.intersect=l.default;var c=_(t("./sphere"));i.Sphere=c.default;var h=_(t("./obb"));i.Obb=h.default;var u=_(t("./frustum"));i.Frustum=u.default;var d=_(t("./line"));i.Line=d.default;var p=_(t("./plane"));i.Plane=p.default;var f=t("./distance");function _(t){return t&&t.__esModule?t:{default:t}}Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(r,t)||t in i&&i[t]===f[t]||(i[t]=f[t]))})),cc.geomUtils=e.exports},{"./aabb":147,"./distance":148,"./enums":149,"./frustum":150,"./intersect":152,"./line":153,"./obb":154,"./plane":155,"./ray":156,"./sphere":157,"./triangle":158}],152:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=d(t("../../renderer/gfx")),n=d(t("../../renderer/memop/recycle-pool")),s=t("../value-types"),o=d(t("./aabb")),a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u(void 0);if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var s=r?Object.getOwnPropertyDescriptor(t,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}(t("./distance")),l=d(t("./enums")),c=d(t("./ray")),h=d(t("./triangle"));function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(u=function(t){return t?i:e})(t)}function d(t){return t&&t.__esModule?t:{default:t}}var p,f,_,m,g,y,v,b,x,T,C,S,w,A,E,D=function(){var t=h.default.create(),e=1/0;function i(t,e,i,r){s.Vec3.set(t,e[i*r],e[i*r+1],e[i*r+2])}return function(n,s){e=1/0;for(var o=s._subMeshes,a=0;a<o.length;a++)if(o[a]._primitiveType===r.default.PT_TRIANGLES)for(var l=s._subDatas[a]||s._subDatas[0],c=s._getAttrMeshData(a,r.default.ATTR_POSITION),h=l.getIData(Uint16Array),u=l.vfm.element(r.default.ATTR_POSITION).num,d=0;d<h.length;d+=3){i(t.a,c,h[d],u),i(t.b,c,h[d+1],u),i(t.c,c,h[d+2],u);var p=M(n,t);p>0&&p<e&&(e=p)}return e}}(),L=function(){function t(e,i){for(var r=e.children,n=r.length-1;n>=0;n--)t(r[n],i);i(e)}function e(t,e){return t.distance-e.distance}function i(t,e,i){var r=i.m,n=e.x,s=e.y,o=e.z,a=r[3]*n+r[7]*s+r[11]*o;return a=a?1/a:1,t.x=(r[0]*n+r[4]*s+r[8]*o)*a,t.y=(r[1]*n+r[5]*s+r[9]*o)*a,t.z=(r[2]*n+r[6]*s+r[10]*o)*a,t}var r=new n.default((function(){return{distance:0,node:null}}),1),a=[],l=o.default.create(),h=new s.Vec3,u=new s.Vec3,d=new c.default,p=cc.mat4(),f=cc.mat4(),_=new s.Vec3;function m(t){return t>0&&t<1/0}return function(n,c,g,y){return r.reset(),a.length=0,t(n=n||cc.director.getScene(),(function(t){if(!y||y(t)){s.Mat4.invert(f,t.getWorldMatrix(p)),s.Vec3.transformMat4(d.o,c.o,f),s.Vec3.normalize(d.d,i(d.d,c.d,f));var e=1/0,n=t._renderComponent;if(n instanceof cc.MeshRenderer?e=k(d,n._boundingBox):t.width&&t.height&&(s.Vec3.set(h,-t.width*t.anchorX,-t.height*t.anchorY,t.z),s.Vec3.set(u,t.width*(1-t.anchorX),t.height*(1-t.anchorY),t.z),o.default.fromPoints(l,h,u),e=k(d,l)),m(e)&&(g&&(e=g(d,t,e)),m(e))){s.Vec3.scale(_,d.d,e),i(_,_,p);var v=r.add();v.node=t,v.distance=s.Vec3.mag(_),a.push(v)}}})),a.sort(e),a}}(),I=(p=new s.Vec3(0,0,0),function(t,e){var i=s.Vec3.dot(t.d,e.n);if(Math.abs(i)<Number.EPSILON)return 0;s.Vec3.multiplyScalar(p,e.n,e.d);var r=s.Vec3.dot(s.Vec3.subtract(p,p,t.o),e.n)/i;return r<0?0:r}),P=(f=new s.Vec3(0,0,0),function(t,e){s.Vec3.subtract(f,t.e,t.s);var i=(e.d-s.Vec3.dot(t.s,e.n))/s.Vec3.dot(f,e.n);return i<0||i>1?0:i}),M=function(){var t=new s.Vec3(0,0,0),e=new s.Vec3(0,0,0),i=new s.Vec3(0,0,0),r=new s.Vec3(0,0,0),n=new s.Vec3(0,0,0);return function(o,a,l){s.Vec3.subtract(t,a.b,a.a),s.Vec3.subtract(e,a.c,a.a),s.Vec3.cross(i,o.d,e);var c=s.Vec3.dot(t,i);if(c<Number.EPSILON&&(!l||c>-Number.EPSILON))return 0;var h=1/c;s.Vec3.subtract(r,o.o,a.a);var u=s.Vec3.dot(r,i)*h;if(u<0||u>1)return 0;s.Vec3.cross(n,r,t);var d=s.Vec3.dot(o.d,n)*h;if(d<0||u+d>1)return 0;var p=s.Vec3.dot(e,n)*h;return p<0?0:p}}(),R=M,O=function(){var t=new s.Vec3(0,0,0),e=new s.Vec3(0,0,0),i=new s.Vec3(0,0,0),r=new s.Vec3(0,0,0),n=new s.Vec3(0,0,0),o=new s.Vec3(0,0,0);return function(a,l,c){s.Vec3.subtract(t,l.b,l.a),s.Vec3.subtract(e,l.c,l.a),s.Vec3.subtract(i,a.s,a.e),s.Vec3.cross(n,t,e);var h=s.Vec3.dot(i,n);if(h<=0)return 0;s.Vec3.subtract(r,a.s,l.a);var u=s.Vec3.dot(r,n);if(u<0||u>h)return 0;s.Vec3.cross(o,i,r);var d=s.Vec3.dot(e,o);if(d<0||d>h)return 0;var p=-s.Vec3.dot(t,o);if(p<0||d+p>h)return 0;if(c){var f=1/h,_=1-(d*=f)-(p*=f);s.Vec3.set(c,l.a.x*_+l.b.x*d+l.c.x*p,l.a.y*_+l.b.y*d+l.c.y*p,l.a.z*_+l.b.z*d+l.c.z*p)}return 1}}(),B=(_=new s.Vec3(0,0,0),m=new s.Vec3(0,0,0),g=new s.Vec3(0,0,0),y=new s.Vec3(0,0,0),v=new s.Vec3(0,0,0),b=new s.Vec3(0,0,0),x=new s.Vec3(0,0,0),function(t,e,i,r,n,o,a){s.Vec3.subtract(_,e,t),s.Vec3.subtract(m,i,t),s.Vec3.subtract(g,r,t),s.Vec3.subtract(y,n,t),s.Vec3.cross(b,y,_);var l=s.Vec3.dot(m,b);if(l>=0){var c=-s.Vec3.dot(g,b);if(c<0)return 0;var h=s.Vec3.dot(s.Vec3.cross(x,_,g),m);if(h<0)return 0;if(a){var u=1/(c+l+h);c*=u,l*=u,h*=u,s.Vec3.set(a,i.x*c+r.x*l+n.x*h,i.y*c+r.y*l+n.y*h,i.z*c+r.z*l+n.z*h)}}else{s.Vec3.subtract(v,o,t);var d=s.Vec3.dot(v,b);if(d<0)return 0;var p=s.Vec3.dot(s.Vec3.cross(x,_,m),v);if(p<0)return 0;if(a){var f=1/(d+(l=-l)+p);d*=f,l*=f,p*=f,s.Vec3.set(a,i.x*d+o.x*l+n.x*p,i.y*d+o.y*l+n.y*p,i.z*d+o.z*l+n.z*p)}}return 1}),N=function(){var t=new s.Vec3(0,0,0);return function(e,i){var r=i.radius,n=i.center,o=e.o,a=e.d,l=r*r;s.Vec3.subtract(t,n,o);var c=t.lengthSqr(),h=s.Vec3.dot(t,a),u=l-(c-h*h);if(u<0)return 0;var d=Math.sqrt(u),p=c<l?h+d:h-d;return p<0?0:p}}(),k=(T=new s.Vec3,C=new s.Vec3,function(t,e){var i=t.o,r=t.d,n=1/r.x,o=1/r.y,a=1/r.z;s.Vec3.subtract(T,e.center,e.halfExtents),s.Vec3.add(C,e.center,e.halfExtents);var l=(T.x-i.x)*n,c=(C.x-i.x)*n,h=(T.y-i.y)*o,u=(C.y-i.y)*o,d=(T.z-i.z)*a,p=(C.z-i.z)*a,f=Math.max(Math.max(Math.min(l,c),Math.min(h,u)),Math.min(d,p)),_=Math.min(Math.min(Math.max(l,c),Math.max(h,u)),Math.max(d,p));return _<0||f>_?0:f}),F=k,V=function(){var t=new s.Vec3,e=new s.Vec3,i=new s.Vec3,r=new s.Vec3,n=new s.Vec3,o=new s.Vec3,a=new s.Vec3,l=new Array(3),c=new Array(3),h=new Array(3),u=new Array(6);return function(d,p){l[0]=p.halfExtents.x,l[1]=p.halfExtents.y,l[2]=p.halfExtents.z,t=p.center,e=d.o,i=d.d;var f=p.orientation.m;s.Vec3.set(r,f[0],f[1],f[2]),s.Vec3.set(n,f[3],f[4],f[5]),s.Vec3.set(o,f[6],f[7],f[8]),s.Vec3.subtract(a,t,e),c[0]=s.Vec3.dot(r,i),c[1]=s.Vec3.dot(n,i),c[2]=s.Vec3.dot(o,i),h[0]=s.Vec3.dot(r,a),h[1]=s.Vec3.dot(n,a),h[2]=s.Vec3.dot(o,a);for(var _=0;_<3;++_){if(0===c[_]){if(-h[_]-l[_]>0||-h[_]+l[_]<0)return 0;c[_]=1e-7}u[2*_+0]=(h[_]+l[_])/c[_],u[2*_+1]=(h[_]-l[_])/c[_]}var m=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),g=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return g<0||m>g||m<0?0:m}}(),j=(S=new s.Vec3,w=new s.Vec3,A=new s.Vec3,E=new s.Vec3,function(t,e){return s.Vec3.subtract(S,t.center,t.halfExtents),s.Vec3.add(w,t.center,t.halfExtents),s.Vec3.subtract(A,e.center,e.halfExtents),s.Vec3.add(E,e.center,e.halfExtents),S.x<=E.x&&w.x>=A.x&&S.y<=E.y&&w.y>=A.y&&S.z<=E.z&&w.z>=A.z});function G(t,e,i,r,n,o){s.Vec3.set(o[0],t.x+i.x*e.x+r.x*e.y+n.x*e.z,t.y+i.y*e.x+r.y*e.y+n.y*e.z,t.z+i.z*e.x+r.z*e.y+n.z*e.z),s.Vec3.set(o[1],t.x-i.x*e.x+r.x*e.y+n.x*e.z,t.y-i.y*e.x+r.y*e.y+n.y*e.z,t.z-i.z*e.x+r.z*e.y+n.z*e.z),s.Vec3.set(o[2],t.x+i.x*e.x-r.x*e.y+n.x*e.z,t.y+i.y*e.x-r.y*e.y+n.y*e.z,t.z+i.z*e.x-r.z*e.y+n.z*e.z),s.Vec3.set(o[3],t.x+i.x*e.x+r.x*e.y-n.x*e.z,t.y+i.y*e.x+r.y*e.y-n.y*e.z,t.z+i.z*e.x+r.z*e.y-n.z*e.z),s.Vec3.set(o[4],t.x-i.x*e.x-r.x*e.y-n.x*e.z,t.y-i.y*e.x-r.y*e.y-n.y*e.z,t.z-i.z*e.x-r.z*e.y-n.z*e.z),s.Vec3.set(o[5],t.x+i.x*e.x-r.x*e.y-n.x*e.z,t.y+i.y*e.x-r.y*e.y-n.y*e.z,t.z+i.z*e.x-r.z*e.y-n.z*e.z),s.Vec3.set(o[6],t.x-i.x*e.x+r.x*e.y-n.x*e.z,t.y-i.y*e.x+r.y*e.y-n.y*e.z,t.z-i.z*e.x+r.z*e.y-n.z*e.z),s.Vec3.set(o[7],t.x-i.x*e.x-r.x*e.y+n.x*e.z,t.y-i.y*e.x-r.y*e.y+n.y*e.z,t.z-i.z*e.x-r.z*e.y+n.z*e.z)}function U(t,e){for(var i=s.Vec3.dot(e,t[0]),r=i,n=1;n<8;++n){var o=s.Vec3.dot(e,t[n]);i=o<i?o:i,r=o>r?o:r}return[i,r]}var Y,H=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new s.Vec3(0,0,0);for(var i=new Array(8),r=new Array(8),n=0;n<8;n++)i[n]=new s.Vec3(0,0,0),r[n]=new s.Vec3(0,0,0);var o=new s.Vec3,a=new s.Vec3;return function(e,n){var l=n.orientation.m;s.Vec3.set(t[0],1,0,0),s.Vec3.set(t[1],0,1,0),s.Vec3.set(t[2],0,0,1),s.Vec3.set(t[3],l[0],l[1],l[2]),s.Vec3.set(t[4],l[3],l[4],l[5]),s.Vec3.set(t[5],l[6],l[7],l[8]);for(var c=0;c<3;++c)s.Vec3.cross(t[6+3*c],t[c],t[0]),s.Vec3.cross(t[7+3*c],t[c],t[1]),s.Vec3.cross(t[7+3*c],t[c],t[2]);s.Vec3.subtract(o,e.center,e.halfExtents),s.Vec3.add(a,e.center,e.halfExtents),function(t,e,i){s.Vec3.set(i[0],t.x,e.y,e.z),s.Vec3.set(i[1],t.x,e.y,t.z),s.Vec3.set(i[2],t.x,t.y,e.z),s.Vec3.set(i[3],t.x,t.y,t.z),s.Vec3.set(i[4],e.x,e.y,e.z),s.Vec3.set(i[5],e.x,e.y,t.z),s.Vec3.set(i[6],e.x,t.y,e.z),s.Vec3.set(i[7],e.x,t.y,t.z)}(o,a,i),G(n.center,n.halfExtents,t[3],t[4],t[5],r);for(var h=0;h<15;++h){var u=U(i,t[h]),d=U(r,t[h]);if(d[0]>u[1]||u[0]>d[1])return 0}return 1}}(),X=function(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),r=s.Vec3.dot(e.n,t.center);return r+i<e.d?-1:r-i>e.d?0:1},z=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===X(t,e.planes[i]))return 0;return 1},W=function(){for(var t=new Array(8),e=0,i=0,r=0;r<t.length;r++)t[r]=new s.Vec3(0,0,0);return function(r,n){for(var o=0,a=!1,l=0;l<n.planes.length;l++){if(-1===(o=X(r,n.planes[l])))return 0;1===o&&(a=!0)}if(!a)return 1;for(var c=0;c<n.vertices.length;c++)s.Vec3.subtract(t[c],n.vertices[c],r.center);e=0,i=0;for(var h=0;h<n.vertices.length;h++)t[h].x>r.halfExtents.x?e++:t[h].x<-r.halfExtents.x&&i++;if(e===n.vertices.length||i===n.vertices.length)return 0;e=0,i=0;for(var u=0;u<n.vertices.length;u++)t[u].y>r.halfExtents.y?e++:t[u].y<-r.halfExtents.y&&i++;if(e===n.vertices.length||i===n.vertices.length)return 0;e=0,i=0;for(var d=0;d<n.vertices.length;d++)t[d].z>r.halfExtents.z?e++:t[d].z<-r.halfExtents.z&&i++;return e===n.vertices.length||i===n.vertices.length?0:1}}(),Z=function(){var t=new s.Vec3(0,0,0),e=new s.Mat3;return function(i,r){return s.Vec3.subtract(t,r,i.center),s.Vec3.transformMat3(t,t,s.Mat3.transpose(e,i.orientation)),n=t,o=i.halfExtents,Math.abs(n.x)<o.x&&Math.abs(n.y)<o.y&&Math.abs(n.z)<o.z;var n,o}}(),J=(Y=function(t,e,i,r){return Math.abs(t.x*e+t.y*i+t.z*r)},function(t,e){var i=t.orientation.m,r=t.halfExtents.x*Y(e.n,i[0],i[1],i[2])+t.halfExtents.y*Y(e.n,i[3],i[4],i[5])+t.halfExtents.z*Y(e.n,i[6],i[7],i[8]),n=s.Vec3.dot(e.n,t.center);return n+r<e.d?-1:n-r>e.d?0:1}),q=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===J(t,e.planes[i]))return 0;return 1},K=function(){for(var t=new Array(8),e=0,i=0,r=0,n=0;n<t.length;n++)t[n]=new s.Vec3(0,0,0);var o=function(t,e,i,r){return t.x*e+t.y*i+t.z*r};return function(n,a){for(var l=0,c=!1,h=0;h<a.planes.length;h++){if(-1===(l=J(n,a.planes[h])))return 0;1===l&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)s.Vec3.subtract(t[u],a.vertices[u],n.center);i=0,r=0;for(var d=n.orientation.m,p=0;p<a.vertices.length;p++)(e=o(t[p],d[0],d[1],d[2]))>n.halfExtents.x?i++:e<-n.halfExtents.x&&r++;if(i===a.vertices.length||r===a.vertices.length)return 0;i=0,r=0;for(var f=0;f<a.vertices.length;f++)(e=o(t[f],d[3],d[4],d[5]))>n.halfExtents.y?i++:e<-n.halfExtents.y&&r++;if(i===a.vertices.length||r===a.vertices.length)return 0;i=0,r=0;for(var _=0;_<a.vertices.length;_++)(e=o(t[_],d[6],d[7],d[8]))>n.halfExtents.z?i++:e<-n.halfExtents.z&&r++;return i===a.vertices.length||r===a.vertices.length?0:1}}(),Q=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new s.Vec3(0,0,0);for(var i=new Array(8),r=new Array(8),n=0;n<8;n++)i[n]=new s.Vec3(0,0,0),r[n]=new s.Vec3(0,0,0);return function(e,n){var o=e.orientation.m,a=n.orientation.m;s.Vec3.set(t[0],o[0],o[1],o[2]),s.Vec3.set(t[1],o[3],o[4],o[5]),s.Vec3.set(t[2],o[6],o[7],o[8]),s.Vec3.set(t[3],a[0],a[1],a[2]),s.Vec3.set(t[4],a[3],a[4],a[5]),s.Vec3.set(t[5],a[6],a[7],a[8]);for(var l=0;l<3;++l)s.Vec3.cross(t[6+3*l],t[l],t[0]),s.Vec3.cross(t[7+3*l],t[l],t[1]),s.Vec3.cross(t[7+3*l],t[l],t[2]);G(e.center,e.halfExtents,t[0],t[1],t[2],i),G(n.center,n.halfExtents,t[3],t[4],t[5],r);for(var c=0;c<15;++c){var h=U(i,t[c]),u=U(r,t[c]);if(u[0]>h[1]||h[0]>u[1])return 0}return 1}}(),$=function(t,e){var i=s.Vec3.dot(e.n,t.center),r=t.radius*e.n.length();return i+r<e.d?-1:i-r>e.d?0:1},tt=function(t,e){for(var i=0;i<e.planes.length;i++)if(-1===$(t,e.planes[i]))return 0;return 1},et=function(){var t=new s.Vec3(0,0,0),e=[1,-1,1,-1,1,-1];return function(i,r){for(var n=0;n<6;n++){var o=r.planes[n],a=i.radius,l=i.center,c=o.n,h=o.d,u=s.Vec3.dot(c,l);if(u+a<h)return 0;if(!(u-a>h)){s.Vec3.add(t,l,s.Vec3.multiplyScalar(t,c,a));for(var d=0;d<6;d++)if(d!==n&&d!==n+e[n]){var p=r.planes[d];if(s.Vec3.dot(p.n,t)<p.d)return 0}}}return 1}}(),it=function(t,e){var i=t.radius+e.radius;return s.Vec3.squaredDistance(t.center,e.center)<i*i},rt=function(){var t=new s.Vec3;return function(e,i){return a.pt_point_aabb(t,e.center,i),s.Vec3.squaredDistance(e.center,t)<e.radius*e.radius}}(),nt=function(){var t=new s.Vec3;return function(e,i){return a.pt_point_obb(t,e.center,i),s.Vec3.squaredDistance(e.center,t)<e.radius*e.radius}}(),st={rayAabb:F,rayMesh:D,raycast:L,rayTriangle:R,ray_sphere:N,ray_aabb:k,ray_obb:V,ray_plane:I,ray_triangle:M,line_plane:P,line_triangle:O,line_quad:B,sphere_sphere:it,sphere_aabb:rt,sphere_obb:nt,sphere_plane:$,sphere_frustum:tt,sphere_frustum_accurate:et,aabb_aabb:j,aabb_obb:H,aabb_plane:X,aabb_frustum:z,aabb_frustum_accurate:W,obb_obb:Q,obb_plane:J,obb_frustum:q,obb_frustum_accurate:K,obb_point:Z,resolve:function(t,e,i){void 0===i&&(i=null);var r=t._type,n=e._type,s=this[r|n];return r<n?s(t,e,i):s(e,t,i)}};st[l.default.SHAPE_RAY|l.default.SHAPE_SPHERE]=N,st[l.default.SHAPE_RAY|l.default.SHAPE_AABB]=k,st[l.default.SHAPE_RAY|l.default.SHAPE_OBB]=V,st[l.default.SHAPE_RAY|l.default.SHAPE_PLANE]=I,st[l.default.SHAPE_RAY|l.default.SHAPE_TRIANGLE]=M,st[l.default.SHAPE_LINE|l.default.SHAPE_PLANE]=P,st[l.default.SHAPE_LINE|l.default.SHAPE_TRIANGLE]=O,st[l.default.SHAPE_SPHERE]=it,st[l.default.SHAPE_SPHERE|l.default.SHAPE_AABB]=rt,st[l.default.SHAPE_SPHERE|l.default.SHAPE_OBB]=nt,st[l.default.SHAPE_SPHERE|l.default.SHAPE_PLANE]=$,st[l.default.SHAPE_SPHERE|l.default.SHAPE_FRUSTUM]=tt,st[l.default.SHAPE_SPHERE|l.default.SHAPE_FRUSTUM_ACCURATE]=et,st[l.default.SHAPE_AABB]=j,st[l.default.SHAPE_AABB|l.default.SHAPE_OBB]=H,st[l.default.SHAPE_AABB|l.default.SHAPE_PLANE]=X,st[l.default.SHAPE_AABB|l.default.SHAPE_FRUSTUM]=z,st[l.default.SHAPE_AABB|l.default.SHAPE_FRUSTUM_ACCURATE]=W,st[l.default.SHAPE_OBB]=Q,st[l.default.SHAPE_OBB|l.default.SHAPE_PLANE]=J,st[l.default.SHAPE_OBB|l.default.SHAPE_FRUSTUM]=q,st[l.default.SHAPE_OBB|l.default.SHAPE_FRUSTUM_ACCURATE]=K;var ot=st;i.default=ot,e.exports=i.default},{"../../renderer/gfx":319,"../../renderer/memop/recycle-pool":334,"../value-types":286,"./aabb":147,"./distance":148,"./enums":149,"./ray":156,"./triangle":158}],153:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types"),s=(r=t("./enums"))&&r.__esModule?r:{default:r},o=function(){function t(t,e,i,r,o,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=s.default.SHAPE_LINE,this.s=new n.Vec3(t,e,i),this.e=new n.Vec3(r,o,a)}return t.create=function(e,i,r,n,s,o){return new t(e,i,r,n,s,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return n.Vec3.copy(t.s,e.s),n.Vec3.copy(t.e,e.e),t},t.fromPoints=function(t,e,i){return n.Vec3.copy(t.s,e),n.Vec3.copy(t.e,i),t},t.set=function(t,e,i,r,n,s,o){return t.s.x=e,t.s.y=i,t.s.z=r,t.e.x=n,t.e.y=s,t.e.z=o,t},t.len=function(t){return n.Vec3.distance(t.s,t.e)},t.prototype.length=function(){return n.Vec3.distance(this.s,this.e)},t}();i.default=o,e.exports=i.default},{"../value-types":286,"./enums":149}],154:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types"),s=(r=t("./enums"))&&r.__esModule?r:{default:r};var o=new n.Vec3,a=new n.Vec3,l=new n.Mat3,c=function(){function t(t,e,i,r,o,a,l,c,h,u,d,p,f,_,m){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===l&&(l=1),void 0===c&&(c=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===d&&(d=1),void 0===p&&(p=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===m&&(m=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=s.default.SHAPE_OBB,this.center=new n.Vec3(t,e,i),this.halfExtents=new n.Vec3(r,o,a),this.orientation=new n.Mat3(l,c,h,u,d,p,f,_,m)}t.create=function(e,i,r,n,s,o,a,l,c,h,u,d,p,f,_){return new t(e,i,r,n,s,o,a,l,c,h,u,d,p,f,_)},t.clone=function(e){var i=e.orientation.m;return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},t.copy=function(t,e){return n.Vec3.copy(t.center,e.center),n.Vec3.copy(t.halfExtents,e.halfExtents),n.Mat3.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,i){return n.Vec3.multiplyScalar(t.center,n.Vec3.add(o,e,i),.5),n.Vec3.multiplyScalar(t.halfExtents,n.Vec3.subtract(a,i,e),.5),n.Mat3.identity(t.orientation),t},t.set=function(t,e,i,r,s,o,a,l,c,h,u,d,p,f,_,m){return n.Vec3.set(t.center,e,i,r),n.Vec3.set(t.halfExtents,s,o,a),n.Mat3.set(t.orientation,l,c,h,u,d,p,f,_,m),t};var e,i,r=t.prototype;return r.getBoundary=function(t,e){var i,r,s,a,c;i=o,r=this.halfExtents,s=this.orientation,a=l.m,c=s.m,a[0]=Math.abs(c[0]),a[1]=Math.abs(c[1]),a[2]=Math.abs(c[2]),a[3]=Math.abs(c[3]),a[4]=Math.abs(c[4]),a[5]=Math.abs(c[5]),a[6]=Math.abs(c[6]),a[7]=Math.abs(c[7]),a[8]=Math.abs(c[8]),n.Vec3.transformMat3(i,r,l),n.Vec3.subtract(t,this.center,o),n.Vec3.add(e,this.center,o)},r.transform=function(t,e,i,r,s){n.Vec3.transformMat4(s.center,this.center,t),n.Mat3.fromQuat(s.orientation,i),n.Vec3.multiply(s.halfExtents,this.halfExtents,r)},r.translateAndRotate=function(t,e,i){n.Vec3.transformMat4(i.center,this.center,t),n.Mat3.fromQuat(i.orientation,e)},r.setScale=function(t,e){n.Vec3.multiply(e.halfExtents,this.halfExtents,t)},e=t,(i=[{key:"type",get:function(){return this._type}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=c,e.exports=i.default},{"../value-types":286,"./enums":149}],155:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types"),s=(r=t("./enums"))&&r.__esModule?r:{default:r},o=new n.Vec3(0,0,0),a=new n.Vec3(0,0,0),l=cc.mat4(),c=cc.v4(),h=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=s.default.SHAPE_PLANE,this.n=new n.Vec3(t,e,i),this.d=r}return t.create=function(e,i,r,n){return new t(e,i,r,n)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return n.Vec3.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,i,r){return n.Vec3.subtract(o,i,e),n.Vec3.subtract(a,r,e),n.Vec3.normalize(t.n,n.Vec3.cross(t.n,o,a)),t.d=n.Vec3.dot(t.n,e),t},t.set=function(t,e,i,r,n){return t.n.x=e,t.n.y=i,t.n.z=r,t.d=n,t},t.fromNormalAndPoint=function(t,e,i){return n.Vec3.copy(t.n,e),t.d=n.Vec3.dot(e,i),t},t.normalize=function(t,e){var i=e.n.len();return n.Vec3.normalize(t.n,e.n),i>0&&(t.d=e.d/i),t},t.prototype.transform=function(t){n.Mat4.invert(l,t),n.Mat4.transpose(l,l),n.Vec4.set(c,this.n.x,this.n.y,this.n.z,this.d),n.Vec4.transformMat4(c,c,l),n.Vec3.set(this.n,c.x,c.y,c.z),this.d=c.w},t}();i.default=h,e.exports=i.default},{"../value-types":286,"./enums":149}],156:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types"),s=(r=t("./enums"))&&r.__esModule?r:{default:r},o=function(){function t(t,e,i,r,o,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=s.default.SHAPE_RAY,this.o=new n.Vec3(t,e,i),this.d=new n.Vec3(r,o,a)}return t.create=function(e,i,r,n,s,o){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=1),new t(e,i,r,n,s,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return n.Vec3.copy(t.o,e.o),n.Vec3.copy(t.d,e.d),t},t.fromPoints=function(t,e,i){return n.Vec3.copy(t.o,e),n.Vec3.normalize(t.d,n.Vec3.subtract(t.d,i,e)),t},t.set=function(t,e,i,r,n,s,o){return t.o.x=e,t.o.y=i,t.o.z=r,t.d.x=n,t.d.y=s,t.d.z=o,t},t.prototype.computeHit=function(t,e){n.Vec3.normalize(t,this.d),n.Vec3.scaleAndAdd(t,this.o,t,e)},t}();i.default=o,e.exports=i.default},{"../value-types":286,"./enums":149}],157:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types"),s=(r=t("./enums"))&&r.__esModule?r:{default:r},o=new n.Vec3,a=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.center=void 0,this.radius=void 0,this._type=void 0,this._type=s.default.SHAPE_SPHERE,this.center=new n.Vec3(t,e,i),this.radius=r}t.create=function(e,i,r,n){return new t(e,i,r,n)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return n.Vec3.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,i){return n.Vec3.multiplyScalar(t.center,n.Vec3.add(o,e,i),.5),t.radius=.5*n.Vec3.subtract(o,i,e).len(),t},t.set=function(t,e,i,r,n){return t.center.x=e,t.center.y=i,t.center.z=r,t.radius=n,t};var e=t.prototype;return e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){n.Vec3.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),n.Vec3.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,i,r,s){n.Vec3.transformMat4(s.center,this.center,t),s.radius=this.radius*r.maxAxis()},e.translateAndRotate=function(t,e,i){n.Vec3.transformMat4(i.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*t.maxAxis()},t}();i.default=a,e.exports=i.default},{"../value-types":286,"./enums":149}],158:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("../value-types/vec3")),n=s(t("./enums"));function s(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(t,e,i,s,o,a,l,c,h){this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this.a=new r.default(t,e,i),this.b=new r.default(s,o,a),this.c=new r.default(l,c,h),this._type=n.default.SHAPE_TRIANGLE}return t.create=function(e,i,r,n,s,o,a,l,c){return new t(e,i,r,n,s,o,a,l,c)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return r.default.copy(t.a,e.a),r.default.copy(t.b,e.b),r.default.copy(t.c,e.c),t},t.fromPoints=function(t,e,i,n){return r.default.copy(t.a,e),r.default.copy(t.b,i),r.default.copy(t.c,n),t},t.set=function(t,e,i,r,n,s,o,a,l,c){return t.a.x=e,t.a.y=i,t.a.z=r,t.b.x=n,t.b.y=s,t.b.z=o,t.c.x=a,t.c.y=l,t.c.z=c,t},t}();i.default=o,e.exports=i.default},{"../value-types/vec3":296,"./enums":149}],159:[function(t,e){var i=t("../components/CCRenderComponent"),r=t("../assets/material/CCMaterial"),n=t("./types"),s=n.LineCap,o=n.LineJoin,a=cc.Class({name:"cc.Graphics",extends:i,editor:!1,ctor:function(){this._impl=new a._Impl(this)},properties:{_lineWidth:2,_strokeColor:cc.Color.BLACK,_lineJoin:o.MITER,_lineCap:s.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._impl.lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this._impl.lineJoin=t},type:o},lineCap:{get:function(){return this._lineCap},set:function(t){this._lineCap=t,this._impl.lineCap=t},type:s},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._impl.strokeColor=this._strokeColor=cc.color(t)}},fillColor:{get:function(){return this._fillColor},set:function(t){this._impl.fillColor=this._fillColor=cc.color(t)}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._miterLimit=t,this._impl.miterLimit=t}}},statics:{LineJoin:o,LineCap:s},onRestore:function(){this._impl||(this._impl=new a._Impl(this))},onDestroy:function(){this.clear(!0),this._super(),this._impl=null},_getDefaultMaterial:function(){return r.getBuiltinMaterial("2d-graphics")},_updateMaterial:function(){var t=this._materials[0];t&&(void 0!==t.getDefine("CC_USE_MODEL")&&t.define("CC_USE_MODEL",!0),void 0!==t.getDefine("CC_SUPPORT_standard_derivatives")&&cc.sys.glExtension("OES_standard_derivatives")&&t.define("CC_SUPPORT_standard_derivatives",!0))},moveTo:function(t,e){this._impl.moveTo(t,e)},lineTo:function(t,e){this._impl.lineTo(t,e)},bezierCurveTo:function(t,e,i,r,n,s){this._impl.bezierCurveTo(t,e,i,r,n,s)},quadraticCurveTo:function(t,e,i,r){this._impl.quadraticCurveTo(t,e,i,r)},arc:function(t,e,i,r,n,s){this._impl.arc(t,e,i,r,n,s)},ellipse:function(t,e,i,r){this._impl.ellipse(t,e,i,r)},circle:function(t,e,i){this._impl.circle(t,e,i)},rect:function(t,e,i,r){this._impl.rect(t,e,i,r)},roundRect:function(t,e,i,r,n){this._impl.roundRect(t,e,i,r,n)},fillRect:function(t,e,i,r){this.rect(t,e,i,r),this.fill()},clear:function(t){this._impl.clear(t),this._assembler&&this._assembler.clear(t)},close:function(){this._impl.close()},stroke:function(){this._assembler||this._resetAssembler(),this._assembler.stroke(this)},fill:function(){this._assembler||this._resetAssembler(),this._assembler.fill(this)}});cc.Graphics=e.exports=a,cc.Graphics.Types=n,cc.Graphics.Helper=t("./helper")},{"../assets/material/CCMaterial":81,"../components/CCRenderComponent":117,"./helper":160,"./types":162}],160:[function(t,e){var i=t("./types").PointFlags,r=Math.PI,n=Math.min,s=Math.max,o=Math.cos,a=Math.sin,l=Math.abs,c=Math.sign,h=.5522847493;e.exports={arc:function(t,e,i,c,h,u,d){var p,f,_,m=0,g=0,y=0,v=0,b=0,x=0,T=0,C=0,S=0,w=0,A=0,E=0,D=0;if(g=u-h,d=d||!1)if(l(g)>=2*r)g=2*r;else for(;g<0;)g+=2*r;else if(l(g)>=2*r)g=2*-r;else for(;g>0;)g-=2*r;for(_=0|s(1,n(l(g)/(.5*r)+.5,5)),y=l(4/3*(1-o(p=g/_/2))/a(p)),d||(y=-y),f=0;f<=_;f++)x=e+(v=o(m=h+g*(f/_)))*c,T=i+(b=a(m))*c,C=-b*c*y,S=v*c*y,0===f?t.moveTo(x,T):t.bezierCurveTo(w+E,A+D,x-C,T-S,x,T),w=x,A=T,E=C,D=S},ellipse:function(t,e,i,r,n){t.moveTo(e-r,i),t.bezierCurveTo(e-r,i+n*h,e-r*h,i+n,e,i+n),t.bezierCurveTo(e+r*h,i+n,e+r,i+n*h,e+r,i),t.bezierCurveTo(e+r,i-n*h,e+r*h,i-n,e,i-n),t.bezierCurveTo(e-r*h,i-n,e-r,i-n*h,e-r,i),t.close()},roundRect:function(t,e,i,r,s,o){if(o<.1)t.rect(e,i,r,s);else{var a=n(o,.5*l(r))*c(r),u=n(o,.5*l(s))*c(s);t.moveTo(e,i+u),t.lineTo(e,i+s-u),t.bezierCurveTo(e,i+s-u*(1-h),e+a*(1-h),i+s,e+a,i+s),t.lineTo(e+r-a,i+s),t.bezierCurveTo(e+r-a*(1-h),i+s,e+r,i+s-u*(1-h),e+r,i+s-u),t.lineTo(e+r,i+u),t.bezierCurveTo(e+r,i+u*(1-h),e+r-a*(1-h),i,e+r-a,i),t.lineTo(e+a,i),t.bezierCurveTo(e+a*(1-h),i,e,i+u*(1-h),e,i+u),t.close()}},tesselateBezier:function t(e,r,n,s,o,a,c,h,u,d,p){var f,_,m,g,y,v,b,x,T,C,S,w,A,E,D,L;d>10||(y=.5*(a+h),v=.5*(c+u),b=.5*((f=.5*(r+s))+(m=.5*(s+a))),x=.5*((_=.5*(n+o))+(g=.5*(o+c))),((D=l((s-h)*(E=u-n)-(o-u)*(A=h-r)))+(L=l((a-h)*E-(c-u)*A)))*(D+L)<e._tessTol*(A*A+E*E)?e._addPoint(h,u,0===p?p|i.PT_BEVEL:p):(t(e,r,n,f,_,b,x,S=.5*(b+(T=.5*(m+y))),w=.5*(x+(C=.5*(g+v))),d+1,0),t(e,S,w,T,C,y,v,h,u,d+1,p)))}}},{"./types":162}],161:[function(t){t("./graphics")},{"./graphics":159}],162:[function(t,e){var i=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),n=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});e.exports={LineCap:i,LineJoin:r,PointFlags:n}},{}],163:[function(t){t("./platform"),t("./assets"),t("./CCNode"),t("./CCPrivateNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./geom-utils"),t("./mesh"),t("./3d"),t("./base-ui/CCWidgetManager")},{"./3d":void 0,"./CCNode":29,"./CCPrivateNode":30,"./CCScene":31,"./assets":79,"./base-ui/CCWidgetManager":90,"./camera/CCCamera":91,"./collider":99,"./collider/CCIntersection":97,"./components":135,"./geom-utils":151,"./graphics":161,"./mesh":166,"./physics":181,"./platform":214}],164:[function(t,e){var i=s(t("../../renderer/core/input-assembler")),r=s(t("../../renderer/gfx")),n=t("./mesh-data");function s(t){return t&&t.__esModule?t:{default:t}}var o=t("../renderer"),a=t("../event/event-target");function l(t,e,i){t[e]=i._val}function c(t,e,i){t[e]=i.x,t[e+1]=i.y}function h(t,e,i){t[e]=i.x,t[e+1]=i.y,t[e+2]=i.z}var u,d={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"},p={5120:"setInt8",5121:"setUint8",5122:"setInt16",5123:"setUint16",5124:"setInt32",5125:"setUint32",5126:"setFloat32"},f=(u=new ArrayBuffer(2),new DataView(u).setInt16(0,256,!0),256===new Int16Array(u)[0]),_=cc.Class({name:"cc.Mesh",extends:cc.Asset,mixins:[a],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer},set:function(t){this._buffer=ArrayBuffer.isView(t)?t.buffer:t,this.initWithBuffer()}},_vertexBundles:{default:null,type:n.VertexBundle},_primitives:{default:null,Primitive:n.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes},set:function(t){this._subMeshes=t}},subDatas:{get:function(){return this._subDatas}}},ctor:function(){this._subMeshes=[],this._subDatas=[],this.loaded=!1},initWithBuffer:function(){this._subMeshes.length=0;for(var t=this._primitives,e=0;e<t.length;e++){var s=t[e],a=s.data,l=new Uint8Array(this._buffer,a.offset,a.length),c=this._vertexBundles[s.vertexBundleIndices[0]],h=c.data,u=new r.default.VertexFormat(c.formats),d=new Uint8Array(this._buffer,h.offset,h.length),p=this._canVertexFormatBatch(u),f=new n.MeshData;f.vData=d,f.iData=l,f.vfm=u,f.offset=h.offset,f.canBatch=p,this._subDatas.push(f);var _=new r.default.VertexBuffer(o.device,u,r.default.USAGE_STATIC,d),m=new r.default.IndexBuffer(o.device,s.indexUnit,r.default.USAGE_STATIC,l);this._subMeshes.push(new i.default(_,m))}this.loaded=!0,this.emit("load")},_canVertexFormatBatch:function(t){var e=t._attr2el[r.default.ATTR_POSITION];return!e||e.type===r.default.ATTR_TYPE_FLOAT32&&t._bytes%4==0},init:function(t,e,s,a){void 0===s&&(s=!1),void 0===a&&(a=0);var l=new Uint8Array(t._bytes*e),c=new n.MeshData;c.vData=l,c.vfm=t,c.vDirty=!0,c.canBatch=this._canVertexFormatBatch(t);var h=new r.default.VertexBuffer(o.device,t,s?r.default.USAGE_DYNAMIC:r.default.USAGE_STATIC,l);c.vb=h,this._subMeshes[a]=new i.default(c.vb);var u=this._subDatas[a];u&&(u.vb&&u.vb.destroy(),u.ib&&u.ib.destroy()),this._subDatas[a]=c,this.loaded=!0,this.emit("load"),this.emit("init-format")},setVertices:function(t,e,i){i=i||0;var n=this._subDatas[i],s=n.vfm.element(t);if(!s)return cc.warn("Cannot find "+t+" attribute in vertex defines.");var o,a="number"==typeof e[0],u=s.num,d=a?e.length/u|0:e.length;n.vData.byteLength<d*s.stride&&n.setVData(new Uint8Array(d*n.vfm._bytes));var p=4;t===r.default.ATTR_COLOR?a?(o=n.getVData(),p=1):o=n.getVData(Uint32Array):o=n.getVData(Float32Array);var f=s.stride/p,_=s.offset/p;if(a)for(var m=0,g=e.length/u;m<g;m++)for(var y=m*u,v=m*f+_,b=0;b<u;b++)o[v+b]=e[y+b];else{var x;x=t===r.default.ATTR_COLOR?l:2===u?c:h;for(var T=0,C=e.length;T<C;T++)x(o,T*f+_,e[T])}n.vDirty=!0},setIndices:function(t,e,i){e=e||0;var n=t;t instanceof Uint16Array?n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(n=new Uint16Array(t),n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength));var s=i?r.default.USAGE_DYNAMIC:r.default.USAGE_STATIC,a=this._subDatas[e];if(a.ib)a.iData=n,a.iDirty=!0;else{a.iData=n;var l=new r.default.IndexBuffer(o.device,r.default.INDEX_FMT_UINT16,s,n,n.byteLength/r.default.IndexBuffer.BYTES_PER_INDEX[r.default.INDEX_FMT_UINT16]);a.ib=l,this._subMeshes[e]._indexBuffer=a.ib}},setPrimitiveType:function(t,e){e=e||0,this._subMeshes[e]?this._subMeshes[e]._primitiveType=t:cc.warn("Do not have sub mesh at index "+e)},clear:function(){this._subMeshes.length=0;for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var r=t[e].vb;r&&r.destroy();var n=t[e].ib;n&&n.destroy()}t.length=0},setBoundingBox:function(t,e){this._minPos=t,this._maxPos=e},destroy:function(){this.clear()},_uploadData:function(){for(var t=this._subDatas,e=0,i=t.length;e<i;e++){var r=t[e];if(r.vDirty){var n=r.vb,s=r.vData;n.update(0,s),r.vDirty=!1}if(r.iDirty){var o=r.ib,a=r.iData;o.update(0,a),r.iDirty=!1}}},_getAttrMeshData:function(t,e){var i=this._subDatas[t];if(!i)return[];var r=i.vfm,n=r.element(e);if(!n)return[];i.attrDatas||(i.attrDatas={});var s=i.attrDatas,o=s[e];if(o)return o;o=s[e]=[];for(var a=i.vData,l=new DataView(a.buffer,a.byteOffset,a.byteLength),c=n.stride,h=n.offset,u=n.num,p=n.bytes/u,_=d[n.type],m=a.byteLength/r._bytes,g=0;g<m;g++)for(var y=g*c+h,v=0;v<u;v++){var b=l[_](y+v*p,f);o.push(b)}return o},copyAttribute:function(t,e,i,r,n){var s=!1,o=this._subDatas[t];if(!o)return s;var a=o.vfm,l=a.element(e);if(!l)return s;var c=p[l.type];if(!c)return s;var h=this._getAttrMeshData(t,e),u=o.vData.byteLength/a._bytes,d=l.bytes/l.num;if(h.length>0){for(var _=new DataView(i,n),m=r,g=l.num,y=0;y<u;++y)for(var v=y*g,b=0;b<g;++b){var x=v+b,T=m*y+d*b;_[c](T,h[x],f)}s=!0}return s},copyIndices:function(t,e){var i=this._subDatas[t];if(!i)return!1;for(var n=i.iData,s=n.length/2,o=new DataView(n.buffer,n.byteOffset,n.byteLength),a=d[r.default.INDEX_FMT_UINT8],l=0;l<s;++l)e[l]=o[a](2*l);return!0}});cc.Mesh=e.exports=_},{"../../renderer/core/input-assembler":309,"../../renderer/gfx":319,"../event/event-target":143,"../renderer":227,"./mesh-data":167}],165:[function(t,e){var i=s(t("../../renderer/gfx")),r=(s(t("../../renderer/core/input-assembler")),s(t("../geom-utils/aabb"))),n=(s(t("../value-types/vec3")),s(t("../value-types/mat4")),s(t("../assets/material/material-variant")));function s(t){return t&&t.__esModule?t:{default:t}}var o=t("../components/CCRenderComponent"),a=t("./CCMesh"),l=t("../renderer/render-flow"),c=(t("../renderer"),t("../assets/material/CCMaterial")),h=cc.Enum({OFF:0,ON:1}),u=cc.Class({name:"cc.MeshRenderer",extends:o,editor:!1,properties:{_mesh:{default:null,type:a},_receiveShadows:!1,_shadowCastingMode:h.OFF,_enableAutoBatch:!1,mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._setMesh(t),t?(this.markForRender(!0),this.node._renderFlag|=l.FLAG_TRANSFORM):this.disableRender())},type:a,animatable:!1},textures:{default:[],type:cc.Texture2D,visible:!1},receiveShadows:{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows=t,this._updateReceiveShadow()},animatable:!1},shadowCastingMode:{get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()},type:h,animatable:!1},enableAutoBatch:{get:function(){return this._enableAutoBatch},set:function(t){this._enableAutoBatch=t}}},statics:{ShadowCastingMode:h},ctor:function(){this._boundingBox=cc.geomUtils&&new r.default},onEnable:function(){var t=this;this._super(),this._mesh&&!this._mesh.loaded?(this.disableRender(),this._mesh.once("load",(function(){t.isValid&&(t._setMesh(t._mesh),t.markForRender(!0))})),cc.assetManager.postLoadNative(this._mesh)):this._setMesh(this._mesh),this._updateRenderNode(),this._updateMaterial()},onDestroy:function(){this._setMesh(null),cc.pool.assembler.put(this._assembler)},_updateRenderNode:function(){this._assembler.setRenderNode(this.node)},_setMesh:function(t){cc.geomUtils&&t&&r.default.fromPoints(this._boundingBox,t._minPos,t._maxPos),this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this),t&&t.on("init-format",this._updateMeshAttribute,this),this._mesh=t,this._assembler&&(this._assembler._worldDatas={}),this._updateMeshAttribute()},_getDefaultMaterial:function(){return c.getBuiltinMaterial("unlit")},_validateRender:function(){var t=this._mesh;t&&t._subDatas.length>0||this.disableRender()},_updateMaterial:function(){var t=this.textures;if(t&&t.length>0)for(var e=this._getDefaultMaterial(),i=0;i<t.length;i++){var r=this._materials[i];r&&r._uuid!==e._uuid||(r||(r=n.default.create(e,this),this.setMaterial(i,r)),r.setProperty("diffuseTexture",t[i]))}this._updateReceiveShadow(),this._updateCastShadow(),this._updateMeshAttribute()},_updateReceiveShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_USE_SHADOW_MAP",this._receiveShadows,void 0,!0)},_updateCastShadow:function(){for(var t=this.getMaterials(),e=0;e<t.length;e++)t[e].define("CC_CASTING_SHADOW",this._shadowCastingMode===h.ON,void 0,!0)},_updateMeshAttribute:function(){var t=this._mesh&&this._mesh.subDatas;if(t)for(var e=this.getMaterials(),r=0;r<e.length&&t[r];r++){var n=t[r].vfm,s=e[r];s.define("CC_USE_ATTRIBUTE_COLOR",!!n.element(i.default.ATTR_COLOR),void 0,!0),s.define("CC_USE_ATTRIBUTE_UV0",!!n.element(i.default.ATTR_UV0),void 0,!0),s.define("CC_USE_ATTRIBUTE_NORMAL",!!n.element(i.default.ATTR_NORMAL),void 0,!0),s.define("CC_USE_ATTRIBUTE_TANGENT",!!n.element(i.default.ATTR_TANGENT),void 0,!0)}},_checkBacth:function(){}});cc.MeshRenderer=e.exports=u},{"../../renderer/core/input-assembler":309,"../../renderer/gfx":319,"../assets/material/CCMaterial":81,"../assets/material/material-variant":88,"../components/CCRenderComponent":117,"../geom-utils/aabb":147,"../renderer":227,"../renderer/render-flow":228,"../value-types/mat4":288,"../value-types/vec3":296,"./CCMesh":164}],166:[function(t){t("./CCMesh"),t("./CCMeshRenderer"),t("./mesh-renderer")},{"./CCMesh":164,"./CCMeshRenderer":165,"./mesh-renderer":168}],167:[function(t,e,i){i.__esModule=!0,i.BufferRange=void 0,i.MeshData=c,i.VertexFormat=i.VertexBundle=i.Primitive=void 0;var r,n=(r=t("../../renderer/gfx"))&&r.__esModule?r:{default:r},s=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}});i.BufferRange=s;var o=cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}});i.VertexFormat=o;var a=cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{default:null,type:s},formats:{default:[],type:o},verticesCount:0}});i.VertexBundle=a;var l=cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{default:[],type:cc.Float},data:{default:null,type:s},indexUnit:n.default.INDEX_FMT_UINT16,topology:n.default.PT_TRIANGLES}});function c(){this.vData=null,this.float32VData=null,this.uint32VData=null,this.iData=null,this.uint16IData=null,this.vfm=null,this.offset=0,this.vb=null,this.ib=null,this.vDirty=!1,this.iDirty=!1,this.enable=!0}i.Primitive=l,c.prototype.setVData=function(t){this.vData=t,this.float32VData=null,this.uint32VData=null},c.prototype.getVData=function(t){return t===Float32Array?(this.float32VData||(this.float32VData=new Float32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.float32VData):t===Uint32Array?(this.uint32VData||(this.uint32VData=new Uint32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.uint32VData):this.vData},c.prototype.getIData=function(t){return t===Uint16Array?(this.uint16IData||(this.uint16IData=new Uint16Array(this.iData.buffer,this.iData.byteOffset,this.iData.byteLength/2)),this.uint16IData):this.iData}},{"../../renderer/gfx":319}],168:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("../renderer/assembler")),n=o(t("../../renderer/gfx")),s=o(t("../value-types/vec3"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=t("./CCMeshRenderer"),c=new s.default,h=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var o=r.prototype;return o.init=function(e){t.prototype.init.call(this,e),this._worldDatas={},this._renderNode=null},o.setRenderNode=function(t){this._renderNode=t},o.fillBuffers=function(t,e){if(t.mesh){t.mesh._uploadData();for(var i=e.cullingMask===t.node._cullingMask,r=t.enableAutoBatch,s=t._materials,o=t.mesh._subMeshes,a=t.mesh.subDatas,l=0;l<o.length;l++){var c=o[l],h=a[l],u=s[l]||s[0];r&&h.canBatch&&c._primitiveType===n.default.PT_TRIANGLES?(i&&u.getHash()===e.material.getHash()||e._flush(),e.material=u,e.cullingMask=t.node._cullingMask,e.node=e._dummyNode,this._fillBuffer(t,h,e,l)):(e._flush(),e.material=u,e.cullingMask=t.node._cullingMask,e.node=this._renderNode,e._flushIA(c))}}},o._fillBuffer=function(t,e,i,r){var n=e.getVData(Float32Array),s=e.vfm,o=n.byteLength/s._bytes|0,a=e.getIData(Uint16Array),l=a.length,c=i.getBuffer("mesh",s),h=c.request(o,l),u=h.indiceOffset,d=h.byteOffset>>2,p=h.vertexOffset,f=c._vData,_=c._iData;!i.worldMatDirty&&this._worldDatas[r]||this._updateWorldVertices(r,o,n,s,t.node._worldMatrix),f.set(this._worldDatas[r],d);for(var m=0;m<l;m++)_[u+m]=p+a[m]},o._updateWorldVertices=function(t,e,i,r,o){var a=this._worldDatas[t];a||(a=this._worldDatas[t]=new Float32Array(i.length)).set(i);for(var l=r._bytes/4,h=r._elements,u=0,d=h.length;u<d;u++){var p=h[u],f=p.offset/4;if(p.name===n.default.ATTR_POSITION||p.name===n.default.ATTR_NORMAL)for(var _=p.name===n.default.ATTR_NORMAL?s.default.transformMat4Normal:s.default.transformMat4,m=0;m<e;m++){var g=m*l+f;c.x=i[g],c.y=i[g+1],c.z=i[g+2],_(c,c,o),a[g]=c.x,a[g+1]=c.y,a[g+2]=c.z}}},o._drawDebugDatas=function(t,e,i){var r=t._debugDatas[i];if(r)for(var n=0;n<r.length;n++){var s=r[n];if(s){var o=s.material;e.material=o,e._flushIA(s.ia)}}},r}(r.default);i.default=h,r.default.register(l,h),e.exports=i.default},{"../../renderer/gfx":319,"../renderer/assembler":224,"../value-types/vec3":296,"./CCMeshRenderer":165}],169:[function(t,e){var i=t("./component-scheduler"),r=t("./platform/CCObject").Flags,n=t("./platform/js"),s=r.IsPreloadStarted,o=r.IsOnLoadStarted,a=r.IsOnLoadCalled,l=r.Deactivating,c=cc.Class({extends:i.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){i.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),h=i.createInvokeImpl("c.__preload();"),u=i.createInvokeImpl("c.onLoad();c._objFlags|="+a,!1,a),d=new n.Pool(4);function p(t,e,i){e?t._removeComponent(e):n.array.removeAt(t._components,i)}function f(){this._activatingStack=[]}d.get=function(){var t=this._get()||{preload:new c(h),onLoad:new i.OneOffInvoker(u),onEnable:new i.OneOffInvoker(i.invokeOnEnable)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var _=cc.Class({ctor:f,reset:f,_activateNodeRecursively:function(t,e,i,r){if(t._objFlags&l)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var n=t._components.length,s=0;s<n;++s){var o=t._components[s];o instanceof cc.Component?this.activateComp(o,e,i,r):(p(t,o,s),--s,--n)}t._childArrivalOrder=t._children.length;for(var a=0,c=t._children.length;a<c;++a){var h=t._children[a];h._localZOrder=4294901760&h._localZOrder|a+1,h._active&&this._activateNodeRecursively(h,e,i,r)}t._onPostActivated(!0)}},_deactivateNodeRecursively:function(t){t._objFlags|=l,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var r=t._components[i];if(r._enabled&&(cc.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~l)}for(var n=0,s=t._children.length;n<s;++n){var o=t._children[n];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~l)}t._onPostActivated(!1),t._objFlags&=~l},activateNode:function(t,e){if(e){var i=d.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),d.put(i)}else{this._deactivateNodeRecursively(t);for(var r=this._activatingStack,n=0;n<r.length;n++){var a=r[n];a.preload.cancelInactive(s),a.onLoad.cancelInactive(o),a.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,i,r){if(cc.isValid(t,!0)&&(t._objFlags&s||(t._objFlags|=s,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&o||(t._objFlags|=o,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=a):t._objFlags|=a),t._enabled)){if(!t.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(t,r)}},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&a&&t.onDestroy()},resetComp:!1});e.exports=_},{"./component-scheduler":100,"./platform/CCObject":202,"./platform/js":217,"./utils/misc":271}],170:[function(t,e){var i=t("./CCPhysicsTypes").PTM_RATIO,r=t("./CCPhysicsTypes").ContactType,n=[],s=[cc.v2(),cc.v2()],o=new b2.WorldManifold,a={points:[],separations:[],normal:cc.v2()};function l(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0}var c=[new l,new l],h=(new b2.Manifold,{type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]}),u={normalImpulses:[],tangentImpulses:[]};function d(){}d.prototype.init=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=t,t._contact=this},d.prototype.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null},d.prototype.getWorldManifold=function(){var t=a.points,e=a.separations,r=a.normal;this._b2contact.GetWorldManifold(o);var n=o.points,l=o.separations,c=this._b2contact.GetManifold().pointCount;t.length=e.length=c;for(var h=0;h<c;h++){var u=s[h];u.x=n[h].x*i,u.y=n[h].y*i,t[h]=u,e[h]=l[h]*i}return r.x=o.normal.x,r.y=o.normal.y,this._inverted&&(r.x*=-1,r.y*=-1),a},d.prototype.getManifold=function(){for(var t=h.points,e=h.localNormal,r=h.localPoint,n=this._b2contact.GetManifold(),s=n.points,o=t.length=n.pointCount,a=0;a<o;a++){var l=c[a],u=s[a];l.localPoint.x=u.localPoint.x*i,l.localPoint.Y=u.localPoint.Y*i,l.normalImpulse=u.normalImpulse*i,l.tangentImpulse=u.tangentImpulse,t[a]=l}return r.x=n.localPoint.x*i,r.y=n.localPoint.y*i,e.x=n.localNormal.x,e.y=n.localNormal.y,h.type=n.type,this._inverted&&(e.x*=-1,e.y*=-1),h},d.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var e=u.normalImpulses,r=u.tangentImpulses,n=t.count,s=0;s<n;s++)e[s]=t.normalImpulses[s]*i,r[s]=t.tangentImpulses[s];return r.length=e.length=n,u},d.prototype.emit=function(t){var e;switch(t){case r.BEGIN_CONTACT:e="onBeginContact";break;case r.END_CONTACT:e="onEndContact";break;case r.PRE_SOLVE:e="onPreSolve";break;case r.POST_SOLVE:e="onPostSolve"}var i,n,s,o,a=this.colliderA,l=this.colliderB,c=a.body,h=l.body;if(c.enabledContactListener)for(i=c.node._components,this._inverted=!1,n=0,s=i.length;n<s;n++)(o=i[n])[e]&&o[e](this,a,l);if(h.enabledContactListener)for(i=h.node._components,this._inverted=!0,n=0,s=i.length;n<s;n++)(o=i[n])[e]&&o[e](this,l,a);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},d.get=function(t){var e;return(e=0===n.length?new cc.PhysicsContact:n.pop()).init(t),e},d.put=function(t){var e=t._contact;e&&(n.push(e),e.reset())};var p=d.prototype;p.setEnabled=function(t){this._b2contact.SetEnabled(t)},p.isTouching=function(){return this._b2contact.IsTouching()},p.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/i)},p.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*i},p.setFriction=function(t){this._b2contact.SetFriction(t)},p.getFriction=function(){return this._b2contact.GetFriction()},p.resetFriction=function(){return this._b2contact.ResetFriction()},p.setRestitution=function(t){this._b2contact.SetRestitution(t)},p.getRestitution=function(){return this._b2contact.GetRestitution()},p.resetRestitution=function(){return this._b2contact.ResetRestitution()},d.ContactType=r,cc.PhysicsContact=e.exports=d},{"./CCPhysicsTypes":172}],171:[function(t,e){var i=t("./CCPhysicsTypes"),r=i.ContactType,n=i.BodyType,s=i.RayCastType,o=i.DrawBits,a=i.PTM_RATIO,l=(i.ANGLE_TO_PHYSICS_ANGLE,i.PHYSICS_ANGLE_TO_ANGLE),c=t("./utils").convertToNodeRotation,h=t("./platform/CCPhysicsDebugDraw"),u=new b2.AABB,d=new b2.Vec2,p=new b2.Vec2,f=cc.v2(),_=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:o,PTM_RATIO:a,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._joints=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.enabledAccumulator=!1},pushDelayEvent:function(t,e,i){this._steping?this._delayEvents.push({target:t,func:e,args:i}):t[e].apply(t,i)},update:function(t){var e=this._world;if(e&&this.enabled){this.emit("before-step"),this._steping=!0;var i=_.VELOCITY_ITERATIONS,r=_.POSITION_ITERATIONS;if(this.enabledAccumulator){this._accumulator+=t;var n=_.FIXED_TIME_STEP,s=_.MAX_ACCUMULATOR;for(this._accumulator>s&&(this._accumulator=s);this._accumulator>n;)e.Step(n,i,r),this._accumulator-=n}else{var o=1/cc.game.config.frameRate;e.Step(o,i,r)}this.debugDrawFlags&&(this._checkDebugDrawValid(),this._debugDrawer.clear(),e.DrawDebugData()),this._steping=!1;for(var a=this._delayEvents,l=0,c=a.length;l<c;l++){var h=a[l];h.target[h.func].apply(h.target,h.args)}a.length=0,this._syncNode()}},testPoint:function(t){var e=d.x=t.x/a,i=d.y=t.y/a,r=.2/a;u.lowerBound.x=e-r,u.lowerBound.y=i-r,u.upperBound.x=e+r,u.upperBound.y=i+r;var n=this._aabbQueryCallback;n.init(d),this._world.QueryAABB(n,u);var s=n.getFixture();return s?s.collider:null},testAABB:function(t){u.lowerBound.x=t.xMin/a,u.lowerBound.y=t.yMin/a,u.upperBound.x=t.xMax/a,u.upperBound.y=t.yMax/a;var e=this._aabbQueryCallback;return e.init(),this._world.QueryAABB(e,u),e.getFixtures().map((function(t){return t.collider}))},rayCast:function(t,e,i){if(t.equals(e))return[];i=i||s.Closest,d.x=t.x/a,d.y=t.y/a,p.x=e.x/a,p.y=e.y/a;var r=this._raycastQueryCallback;r.init(i),this._world.RayCast(r,d,p);var n=r.getFixtures();if(n.length>0){for(var o=r.getPoints(),l=r.getNormals(),c=r.getFractions(),h=[],u=0,f=n.length;u<f;u++){var _=n[u],m=_.collider;if(i===s.AllClosest){var g=h.find((function(t){return t.collider===m}));if(g){c[u]<g.fraction&&(g.fixtureIndex=m._getFixtureIndex(_),g.point.x=o[u].x*a,g.point.y=o[u].y*a,g.normal.x=l[u].x,g.normal.y=l[u].y,g.fraction=c[u]);continue}}h.push({collider:m,fixtureIndex:m._getFixtureIndex(_),point:cc.v2(o[u].x*a,o[u].y*a),normal:cc.v2(l[u]),fraction:c[u]})}return h}return[]},syncPosition:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncPosition()},syncRotation:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncRotation()},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t)},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t)},_addBody:function(t,e){var i=this._world,r=t.node;i&&r&&(t._b2Body=i.CreateBody(e),t._b2Body.body=t,this._bodies.push(t))},_removeBody:function(t){var e=this._world;e&&(t._b2Body.body=null,e.DestroyBody(t._b2Body),t._b2Body=null,cc.js.array.remove(this._bodies,t))},_addJoint:function(t,e){var i=this._world.CreateJoint(e);i&&(i._joint=t,t._joint=i,this._joints.push(t))},_removeJoint:function(t){t._isValid()&&this._world.DestroyJoint(t._joint),t._joint&&(t._joint._joint=null),cc.js.array.remove(this._joints,t)},_initCallback:function(){if(this._world){if(!this._contactListener){var t=new cc.PhysicsContactListener;t.setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback,this._raycastQueryCallback=new cc.PhysicsRayCastCallback}}else cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0,this.debugDrawFlags=o.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){for(var t=this._bodies,e=0,i=t.length;e<i;e++){var r=t[e],s=r.node,o=r._b2Body,h=o.GetPosition();f.x=h.x*a,f.y=h.y*a;var u=o.GetAngle()*l;null!==s.parent.parent&&(f=s.parent.convertToNodeSpaceAR(f),u=c(s.parent,u));var d=s._eventMask;s._eventMask=0,s.position=f,s.angle=-u,s._eventMask=d,r.type===n.Animated&&r.resetVelocity()}},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(r.BEGIN_CONTACT)},_onEndContact:function(t){var e=t._contact;e&&(e.emit(r.END_CONTACT),cc.PhysicsContact.put(t))},_onPreSolve:function(t){var e=t._contact;e&&e.emit(r.PRE_SOLVE)},_onPostSolve:function(t,e){var i=t._contact;i&&(i._impulse=e,i.emit(r.POST_SOLVE),i._impulse=null)},_checkDebugDrawValid:function(){if(!this._debugDrawer||!this._debugDrawer.isValid){var t=new cc.Node("PHYSICS_MANAGER_DEBUG_DRAW");t.zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics);var e=new h(this._debugDrawer);e.SetFlags(this.debugDrawFlags),this._world.SetDebugDraw(e)}}});cc.js.getset(_.prototype,"enabled",(function(){return this._enabled}),(function(t){if(t&&!this._world){var e=new b2.World(new b2.Vec2(0,-10));e.SetAllowSleeping(!0),this._world=e,this._initCallback()}this._enabled=t})),cc.js.getset(_.prototype,"debugDrawFlags",(function(){return this._debugDrawFlags}),(function(t){t&&!this._debugDrawFlags?this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!0):!t&&this._debugDrawFlags&&this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!1),t&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t)),this._debugDrawFlags=t,t&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t))})),cc.js.getset(_.prototype,"gravity",(function(){if(this._world){var t=this._world.GetGravity();return cc.v2(t.x*a,t.y*a)}return cc.v2()}),(function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/a,t.y/a))})),cc.PhysicsManager=e.exports=_},{"./CCPhysicsTypes":172,"./platform/CCPhysicsDebugDraw":193,"./utils":195}],172:[function(t,e){var i=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3});cc.RigidBodyType=i;var r=cc.Enum({Closest:0,Any:1,AllClosest:2,All:3});cc.RayCastType=r,e.exports={BodyType:i,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:r,DrawBits:b2.DrawFlags,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}},{}],173:[function(t,e){function i(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]}function r(t,e,r){for(var n=[];e<t;)e+=r.length;for(;t<=e;++t)n.push(i(t,r));return n}function n(t,e,r){if(s(t,r)){if(l(i(t,r),i(t-1,r),i(e,r))&&c(i(t,r),i(t+1,r),i(e,r)))return!1}else if(c(i(t,r),i(t+1,r),i(e,r))||l(i(t,r),i(t-1,r),i(e,r)))return!1;if(s(e,r)){if(l(i(e,r),i(e-1,r),i(t,r))&&c(i(e,r),i(e+1,r),i(t,r)))return!1}else if(c(i(e,r),i(e+1,r),i(t,r))||l(i(e,r),i(e-1,r),i(t,r)))return!1;for(var n=0;n<r.length;++n)if((n+1)%r.length!=t&&n!=t&&(n+1)%r.length!=e&&n!=e){var o=cc.v2();if(f(i(t,r),i(e,r),i(n,r),i(n+1,r),o))return!1}return!0}function s(t,e){return o(t,e)}function o(t,e,r){if(void 0===r){var n=t,s=e;t=i(n-1,s),e=i(n,s),r=i(n+1,s)}return _(t,e,r)<0}function a(t,e,i){return _(t,e,i)>0}function l(t,e,i){return _(t,e,i)>=0}function c(t,e,i){return _(t,e,i)<=0}function h(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function u(t){d(t)||t.reverse()}function d(t){return t.length<3||function(t){var e,i=0;for(e=0;e<t.length;e++){var r=(e+1)%t.length;i+=t[e].x*t[r].y,i-=t[e].y*t[r].x}return i/2}(t)>0}function p(t,e,i,r){var n,s=cc.v2(),o=e.y-t.y,a=t.x-e.x,l=o*t.x+a*t.y,c=r.y-i.y,h=i.x-r.x,u=c*i.x+h*i.y,d=o*h-c*a;return n=d,Math.abs(n-0)<=1e-6||(s.x=(h*l-a*u)/d,s.y=(o*u-c*l)/d),s}function f(t,e,i,r,n){if(t==i||t==r||e==i||e==r)return!1;var s=t.x,o=t.y,a=e.x,l=e.y,c=i.x,h=i.y,u=r.x,d=r.y;if(Math.max(s,a)<Math.min(c,u)||Math.max(c,u)<Math.min(s,a))return!1;if(Math.max(o,l)<Math.min(h,d)||Math.max(h,d)<Math.min(o,l))return!1;var p=(u-c)*(o-h)-(d-h)*(s-c),f=(a-s)*(o-h)-(l-o)*(s-c),_=(d-h)*(a-s)-(u-c)*(l-o);return!(Math.abs(_)<1e-6)&&(f/=_,0<(p/=_)&&p<1&&0<f&&f<1&&(n.x=s+p*(a-s),n.y=o+p*(l-o),!0))}function _(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}e.exports={ConvexPartition:function t(e){u(e);for(var d,f,_,m,g,y,v=[],b=null,x=null,T=0,C=0,S=0;S<e.length;++S)if(s(S,e)){f=_=Number.MAX_SAFE_INTEGER||9999999999999;for(var w=0;w<e.length;++w)a(i(S-1,e),i(S,e),i(w,e))&&c(i(S-1,e),i(S,e),i(w-1,e))&&(m=p(i(S-1,e),i(S,e),i(w,e),i(w-1,e)),o(i(S+1,e),i(S,e),m)&&(d=h(i(S,e),m))<f&&(f=d,b=m,T=w)),a(i(S+1,e),i(S,e),i(w+1,e))&&c(i(S+1,e),i(S,e),i(w,e))&&(m=p(i(S+1,e),i(S,e),i(w,e),i(w+1,e)),a(i(S-1,e),i(S,e),m)&&(d=h(i(S,e),m))<_&&(_=d,C=w,x=m));if(T==(C+1)%e.length){var A=b.add(x).div(2);(g=r(S,C,e)).push(A),(y=r(T,S,e)).push(A)}else{for(var E=0,D=T;C<T;)C+=e.length;for(w=T;w<=C;++w)if(n(S,w,e)){var L=1/(h(i(S,e),i(w,e))+1);s(w,e)?c(i(w-1,e),i(w,e),i(S,e))&&l(i(w+1,e),i(w,e),i(S,e))?L+=3:L+=2:L+=1,L>E&&(D=w,E=L)}g=r(S,D,e),y=r(D,S,e)}return(v=v.concat(t(g))).concat(t(y))}for(v.push(e),S=v.length-1;S>=0;S--)0==v[S].length&&v.splice(S,0);return v},ForceCounterClockWise:u,IsCounterClockWise:d}},{}],174:[function(t,e){var i=t("../CCNode").EventType,r=t("./CCPhysicsTypes").PTM_RATIO,n=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,o=t("./utils").getWorldRotation,a=t("./CCPhysicsTypes").BodyType,l=new b2.Vec2,c=new b2.Vec2,h=cc.Vec2.ZERO,u=cc.Class({name:"cc.RigidBody",extends:cc.Component,editor:!1,properties:{_type:a.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID(8200)},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:a,tooltip:!1,get:function(){return this._type},set:function(t){this._type=t,this._b2Body&&(t===a.Animated?this._b2Body.SetType(a.Kinematic):this._b2Body.SetType(t))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetSleepingAllowed(t)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t=this._linearVelocity;if(this._b2Body){var e=this._b2Body.GetLinearVelocity();t.x=e.x*r,t.y=e.y*r}return t},set:function(t){this._linearVelocity=t;var e=this._b2Body;if(e){var i=e.m_linearVelocity;i.Set(t.x/r,t.y/r),e.SetLinearVelocity(i)}}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*s:this._angularVelocity},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*n)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t)}},awake:{visible:!1,tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(t){this._b2Body&&this._b2Body.SetAwake(t)}},awakeOnLoad:{default:!0,tooltip:!1,animatable:!1},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(t){this._b2Body&&this._b2Body.SetActive(t)}}},getLocalPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){l.Set(t.x/r,t.y/r);var i=this._b2Body.GetLocalPoint(l,e);e.x=i.x*r,e.y=i.y*r}return e},getWorldPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){l.Set(t.x/r,t.y/r);var i=this._b2Body.GetWorldPoint(l,e);e.x=i.x*r,e.y=i.y*r}return e},getWorldVector:function(t,e){if(e=e||cc.v2(),this._b2Body){l.Set(t.x/r,t.y/r);var i=this._b2Body.GetWorldVector(l,e);e.x=i.x*r,e.y=i.y*r}return e},getLocalVector:function(t,e){if(e=e||cc.v2(),this._b2Body){l.Set(t.x/r,t.y/r);var i=this._b2Body.GetLocalVector(l,e);e.x=i.x*r,e.y=i.y*r}return e},getWorldPosition:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetPosition();t.x=e.x*r,t.y=e.y*r}return t},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*s:0},getLocalCenter:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetLocalCenter();t.x=e.x*r,t.y=e.y*r}return t},getWorldCenter:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetWorldCenter();t.x=e.x*r,t.y=e.y*r}return t},getLinearVelocityFromWorldPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){l.Set(t.x/r,t.y/r);var i=this._b2Body.GetLinearVelocityFromWorldPoint(l,e);e.x=i.x*r,e.y=i.y*r}return e},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*r*r:0},getJointList:function(){if(!this._b2Body)return[];var t=[],e=this._b2Body.GetJointList();if(!e)return[];t.push(e.joint._joint);for(var i=e.prev;i;)t.push(i.joint._joint),i=i.prev;for(var r=e.next;r;)t.push(r.joint._joint),r=r.next;return t},applyForce:function(t,e,i){this._b2Body&&(l.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyForce(l,c,i))},applyForceToCenter:function(t,e){this._b2Body&&(l.Set(t.x/r,t.y/r),this._b2Body.ApplyForceToCenter(l,e))},applyTorque:function(t,e){this._b2Body&&this._b2Body.ApplyTorque(t/r,e)},applyLinearImpulse:function(t,e,i){this._b2Body&&(l.Set(t.x/r,t.y/r),c.Set(e.x/r,e.y/r),this._b2Body.ApplyLinearImpulse(l,c,i))},applyAngularImpulse:function(t,e){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/r/r,e)},syncPosition:function(t){var e=this._b2Body;if(e){var i,n=this.node.convertToWorldSpaceAR(h);if((i=this.type===a.Animated?e.GetLinearVelocity():e.GetPosition()).x=n.x/r,i.y=n.y/r,this.type===a.Animated&&t){var s=e.GetPosition(),o=cc.game.config.frameRate;i.x=(i.x-s.x)*o,i.y=(i.y-s.y)*o,e.SetAwake(!0),e.SetLinearVelocity(i)}else e.SetTransformVec(i,e.GetAngle())}},syncRotation:function(t){var e=this._b2Body;if(e){var i=n*o(this.node);if(this.type===a.Animated&&t){var r=e.GetAngle(),s=cc.game.config.frameRate;e.SetAwake(!0),e.SetAngularVelocity((i-r)*s)}else e.SetTransformVec(e.GetPosition(),i)}},resetVelocity:function(){var t=this._b2Body;if(t){var e=t.m_linearVelocity;e.Set(0,0),t.SetLinearVelocity(e),t.SetAngularVelocity(0)}},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var t=this.node;t.on(i.POSITION_CHANGED,this._onNodePositionChanged,this),t.on(i.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.on(i.SCALE_CHANGED,this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var t=this.node;t.off(i.POSITION_CHANGED,this._onNodePositionChanged,this),t.off(i.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.off(i.SCALE_CHANGED,this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(){this.syncRotation(!0)},_onNodeScaleChanged:function(){if(this._b2Body)for(var t=this.getComponents(cc.PhysicsCollider),e=0;e<t.length;e++)t[e].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){this._registerNodeEvents();var t=new b2.BodyDef;this.type===a.Animated?t.type=a.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping;var e=this.linearVelocity;t.linearVelocity=new b2.Vec2(e.x/r,e.y/r),t.angularVelocity=this.angularVelocity*n,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet;var i=this.node,s=i.convertToWorldSpaceAR(h);t.position=new b2.Vec2(s.x/r,s.y/r),t.angle=-Math.PI/180*o(i),t.awake=this.awakeOnLoad,cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0}},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=e.exports=u},{"../CCNode":29,"./CCPhysicsTypes":172,"./utils":195}],175:[function(t){var e=t("../../../external/box2d/box2d");for(var i in window.b2={},e)if(-1===i.indexOf("b2_")){var r=i.replace("b2","");b2[r]=e[i]}b2.maxPolygonVertices=8},{"../../../external/box2d/box2d":381}],176:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsBoxCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,help:"i18n:COMPONENT.help_url.edit-collider-component",requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),r=Math.abs(t.y),n=this.size.width/2/i*e,s=this.size.height/2/i*r,o=this.offset.x/i*e,a=this.offset.y/i*r,l=new b2.PolygonShape;return l.SetAsBox(n,s,new b2.Vec2(o,a),0),l}});cc.PhysicsBoxCollider=e.exports=r},{"../CCPhysicsTypes":172}],177:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsChainCollider",extends:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,help:"i18n:COMPONENT.help_url.edit-collider-component",requireComponent:cc.RigidBody},properties:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){for(var e=new b2.ChainShape,r=this.points,n=[],s=0;s<r.length;s++){var o=r[s];n.push(new b2.Vec2(o.x/i*t.x,o.y/i*t.y))}return this.loop?e.CreateLoop(n,n.length):e.CreateChain(n,n.length),e},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=e.exports=r},{"../CCPhysicsTypes":172}],178:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsCircleCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,help:"i18n:COMPONENT.help_url.edit-collider-component",requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),r=Math.abs(t.y),n=this.offset.x/i*e,s=this.offset.y/i*r,o=new b2.CircleShape;return o.m_radius=this.radius/i*e,o.m_p=new b2.Vec2(n,s),o}});cc.PhysicsCircleCollider=e.exports=r},{"../CCPhysicsTypes":172}],179:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../utils").getWorldScale,n=new b2.AABB,s=cc.Class({name:"cc.PhysicsCollider",extends:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect()},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(t){this._density=t}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(t){this._sensor=t}},friction:{tooltip:!1,get:function(){return this._friction},set:function(t){this._friction=t}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(t){this._restitution=t}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(t){return this._fixtures.indexOf(t)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var e=t._getBody();if(e){var i=t.node,n=r(i);this._scale=n;var s=0===n.x&&0===n.y?[]:this._createShape(n);s instanceof Array||(s=[s]);for(var o=1<<i.groupIndex,a=0,l=cc.game.collisionMatrix[i.groupIndex],c=0;c<l.length;c++)l[c]&&(a|=1<<c);for(var h={categoryBits:o,maskBits:a,groupIndex:0},u=cc.director.getPhysicsManager(),d=0;d<s.length;d++){var p=s[d],f=new b2.FixtureDef;f.density=this.density,f.isSensor=this.sensor,f.friction=this.friction,f.restitution=this.restitution,f.shape=p,f.filter=h;var _=e.CreateFixture(f);_.collider=this,t.enabledContactListener&&u._registerContactFixture(_),this._shapes.push(p),this._fixtures.push(_)}this.body=t,this._inited=!0}}}},__destroy:function(){if(this._inited){for(var t=this._fixtures,e=this.body._getBody(),i=cc.director.getPhysicsManager(),r=t.length-1;r>=0;r--){var n=t[r];n.collider=null,i._unregisterContactFixture(n),e&&e.DestroyFixture(n)}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_createShape:function(){},apply:function(){this._destroy(),this._init()},getAABB:function(){for(var t=1e7,e=1e7,r=-1e7,s=-1e7,o=this.body._getBody().GetTransform(),a=this._fixtures,l=0;l<a.length;l++)for(var c=a[l].GetShape(),h=c.GetChildCount(),u=0;u<h;u++)c.ComputeAABB(n,o,u),n.lowerBound.x<t&&(t=n.lowerBound.x),n.lowerBound.y<e&&(e=n.lowerBound.y),n.upperBound.x>r&&(r=n.upperBound.x),n.upperBound.y>s&&(s=n.upperBound.y);t*=i,e*=i,r*=i,s*=i;var d=this._rect;return d.x=t,d.y=e,d.width=r-t,d.height=s-e,d}});cc.PhysicsCollider=e.exports=s},{"../CCPhysicsTypes":172,"../utils":195}],180:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPolygonSeparator"),n=cc.Class({name:"cc.PhysicsPolygonCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,help:"i18n:COMPONENT.help_url.edit-collider-component",requireComponent:cc.RigidBody},_createShape:function(t){var e=[],n=this.points;n.length>0&&n[0].equals(n[n.length-1])&&(n.length-=1);for(var s=r.ConvexPartition(n),o=this.offset,a=0;a<s.length;a++){for(var l=s[a],c=null,h=[],u=null,d=0,p=l.length;d<p;d++){c||(c=new b2.PolygonShape);var f=l[d],_=(f.x+o.x)/i*t.x,m=(f.y+o.y)/i*t.y,g=new b2.Vec2(_,m);h.push(g),u||(u=g),h.length===b2.maxPolygonVertices&&(c.Set(h,h.length),e.push(c),c=null,d<p-1&&(h=[u,h[h.length-1]]))}c&&(c.Set(h,h.length),e.push(c))}return e}});cc.PhysicsPolygonCollider=e.exports=n},{"../CCPhysicsTypes":172,"../CCPolygonSeparator":173}],181:[function(t){t("./box2d-adapter"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback")},{"./CCPhysicsContact":170,"./CCPhysicsManager":171,"./CCRigidBody":174,"./box2d-adapter":175,"./collider/CCPhysicsBoxCollider":176,"./collider/CCPhysicsChainCollider":177,"./collider/CCPhysicsCircleCollider":178,"./collider/CCPhysicsCollider":179,"./collider/CCPhysicsPolygonCollider":180,"./joint/CCDistanceJoint":182,"./joint/CCJoint":183,"./joint/CCMotorJoint":184,"./joint/CCMouseJoint":185,"./joint/CCPrismaticJoint":186,"./joint/CCRevoluteJoint":187,"./joint/CCRopeJoint":188,"./joint/CCWeldJoint":189,"./joint/CCWheelJoint":190,"./platform/CCPhysicsAABBQueryCallback":191,"./platform/CCPhysicsContactListner":192,"./platform/CCPhysicsRayCastCallback":194}],182:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.DistanceJoint",extends:cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.DistanceJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.length=this.distance/i,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.DistanceJoint=e.exports=r},{"../CCPhysicsTypes":172}],183:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.Joint",extends:cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy(),this._init()},getWorldAnchor:function(){if(this._joint){var t=this._joint.GetAnchorA();return cc.v2(t.x*i,t.y*i)}return cc.Vec2.ZERO},getWorldConnectedAnchor:function(){if(this._joint){var t=this._joint.GetAnchorB();return cc.v2(t.x*i,t.y*i)}return cc.Vec2.ZERO},getReactionForce:function(t){var e=cc.v2();return this._joint?this._joint.GetReactionForce(t,e):e},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited&&(this.body=this.getComponent(cc.RigidBody),this._isValid())){var t=this._createJointDef();if(!t)return;t.bodyA=this.body._getBody(),t.bodyB=this.connectedBody._getBody(),t.collideConnected=this.collideConnected,cc.director.getPhysicsManager()._addJoint(this,t),this._inited=!0}},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeJoint(this),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=e.exports=r},{"../CCPhysicsTypes":172}],184:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,n=cc.Class({name:"cc.MotorJoint",extends:cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/i,t.y/i))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}},_createJointDef:function(){var t=new b2.MotorJointDef;return t.linearOffset=new b2.Vec2(this.linearOffset.x/i,this.linearOffset.y/i),t.angularOffset=this.angularOffset*r,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t}});cc.MotorJoint=e.exports=n},{"../CCPhysicsTypes":172}],185:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=new b2.Vec2,n=cc.Class({name:"cc.MouseJoint",extends:cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(t){this._target=t,this._joint&&(r.x=t.x/i,r.y=t.y/i,this._joint.SetTarget(r))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(t){var e=cc.director.getPhysicsManager(),i=this._pressPoint=t.touch.getLocation();cc.Camera&&cc.Camera.main&&(i=cc.Camera.main.getScreenToWorldPoint(i));var r=e.testPoint(i);r&&((this.connectedBody=r.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=i,this._init())},onTouchMove:function(t){this._pressPoint=t.touch.getLocation()},onTouchEnd:function(){this._destroy(),this._pressPoint=null},_createJointDef:function(){var t=new b2.MouseJointDef;return r.x=this.target.x/i,r.y=this.target.y/i,t.target=r,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t},update:function(){if(this._pressPoint&&this._isValid()){var t=cc.Camera.findCamera(this.node);this.target=t?t.getScreenToWorldPoint(this._pressPoint):this._pressPoint}}});cc.MouseJoint=e.exports=n},{"../CCPhysicsTypes":172}],186:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,n=cc.Class({name:"cc.PrismaticJoint",extends:cc.Joint,editor:!1,properties:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}}},_createJointDef:function(){var t=new b2.PrismaticJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*r,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/i,t.upperTranslation=this.upperLimit/i,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t}});cc.PrismaticJoint=e.exports=n},{"../CCPhysicsTypes":172}],187:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,n=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,s=cc.Class({name:"cc.RevoluteJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*n:0},setLimits:function(t,e){if(this._joint)return this._joint.SetLimits(t*r,e*r)},_createJointDef:function(){var t=new b2.RevoluteJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.lowerAngle=this.upperAngle*r,t.upperAngle=this.lowerAngle*r,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*r,t}});cc.RevoluteJoint=e.exports=s},{"../CCPhysicsTypes":172}],188:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.RopeJoint",extends:cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t)}}},_createJointDef:function(){var t=new b2.RopeJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.maxLength=this.maxLength/i,t}});cc.RopeJoint=e.exports=r},{"../CCPhysicsTypes":172}],189:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,n=cc.Class({name:"cc.WeldJoint",extends:cc.Joint,editor:!1,properties:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WeldJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.referenceAngle=this.referenceAngle*r,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t}});cc.WeldJoint=e.exports=n},{"../CCPhysicsTypes":172}],190:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,n=cc.Class({name:"cc.WheelJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetSpringFrequencyHz(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WheelJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/i,this.anchor.y/i),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/i,this.connectedAnchor.y/i),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.WheelJoint=e.exports=n},{"../CCPhysicsTypes":172}],191:[function(t,e){var i=t("../CCPhysicsTypes").BodyType;function r(){this._point=new b2.Vec2,this._isPoint=!1,this._fixtures=[]}r.prototype.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},r.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===i.Dynamic)if(this._isPoint){if(t.TestPoint(this._point))return this._fixtures.push(t),!1}else this._fixtures.push(t);return!0},r.prototype.getFixture=function(){return this._fixtures[0]},r.prototype.getFixtures=function(){return this._fixtures},cc.PhysicsAABBQueryCallback=e.exports=r},{"../CCPhysicsTypes":172}],192:[function(t,e){function i(){this._contactFixtures=[]}i.prototype.setBeginContact=function(t){this._BeginContact=t},i.prototype.setEndContact=function(t){this._EndContact=t},i.prototype.setPreSolve=function(t){this._PreSolve=t},i.prototype.setPostSolve=function(t){this._PostSolve=t},i.prototype.BeginContact=function(t){if(this._BeginContact){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=this._contactFixtures;t._shouldReport=!1,-1===r.indexOf(e)&&-1===r.indexOf(i)||(t._shouldReport=!0,this._BeginContact(t))}},i.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},i.prototype.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e)},i.prototype.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e)},i.prototype.registerContactFixture=function(t){this._contactFixtures.push(t)},i.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t)},cc.PhysicsContactListener=e.exports=i},{}],193:[function(t,e){var i=t("../CCPhysicsTypes").PTM_RATIO,r=cc.v2(),n=cc.Color.GREEN,s=cc.Color.RED;function o(t){b2.Draw.call(this),this._drawer=t,this._xf=this._dxf=new b2.Transform}cc.js.extend(o,b2.Draw),cc.js.mixin(o.prototype,{_DrawPolygon:function(t,e){for(var n=this._drawer,s=0;s<e;s++){b2.Transform.MulXV(this._xf,t[s],r);var o=r.x*i,a=r.y*i;0===s?n.moveTo(o,a):n.lineTo(o,a)}n.close()},DrawPolygon:function(t,e,i){this._applyStrokeColor(i),this._DrawPolygon(t,e),this._drawer.stroke()},DrawSolidPolygon:function(t,e,i){this._applyFillColor(i),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke()},_DrawCircle:function(t,e){var r=this._xf.p;this._drawer.circle((t.x+r.x)*i,(t.y+r.y)*i,e*i)},DrawCircle:function(t,e,i){this._applyStrokeColor(i),this._DrawCircle(t,e),this._drawer.stroke()},DrawSolidCircle:function(t,e,i,r){this._applyFillColor(r),this._DrawCircle(t,e),this._drawer.fill()},DrawSegment:function(t,e,n){var s=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(n),this._DrawCircle(t,2/i),void s.fill();this._applyStrokeColor(n),b2.Transform.MulXV(this._xf,t,r),s.moveTo(r.x*i,r.y*i),b2.Transform.MulXV(this._xf,e,r),s.lineTo(r.x*i,r.y*i),s.stroke()},DrawTransform:function(t){var e=this._drawer;e.strokeColor=s,r.x=r.y=0,b2.Transform.MulXV(t,r,r),e.moveTo(r.x*i,r.y*i),r.x=1,r.y=0,b2.Transform.MulXV(t,r,r),e.lineTo(r.x*i,r.y*i),e.stroke(),e.strokeColor=n,r.x=r.y=0,b2.Transform.MulXV(t,r,r),e.moveTo(r.x*i,r.y*i),r.x=0,r.y=1,b2.Transform.MulXV(t,r,r),e.lineTo(r.x*i,r.y*i),e.stroke()},DrawPoint:function(){},_applyStrokeColor:function(t){var e=this._drawer.strokeColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.strokeColor=e},_applyFillColor:function(t){var e=this._drawer.fillColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.fillColor=e},PushTransform:function(t){this._xf=t},PopTransform:function(){this._xf=this._dxf}}),e.exports=o},{"../CCPhysicsTypes":172}],194:[function(t,e){function i(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[]}i.prototype.init=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},i.prototype.ReportFixture=function(t,e,i,r){return 0===this._type?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=i,this._fractions[0]=r,r):(this._fixtures.push(t),this._points.push(cc.v2(e)),this._normals.push(cc.v2(i)),this._fractions.push(r),1===this._type?0:this._type>=2?1:r)},i.prototype.getFixtures=function(){return this._fixtures},i.prototype.getPoints=function(){return this._points},i.prototype.getNormals=function(){return this._normals},i.prototype.getFractions=function(){return this._fractions},cc.PhysicsRayCastCallback=e.exports=i},{}],195:[function(t,e){e.exports={getWorldRotation:function(t){for(var e=t.angle,i=t.parent;i.parent;)e+=i.angle,i=i.parent;return-e},getWorldScale:function(t){for(var e=t.scaleX,i=t.scaleY,r=t.parent;r.parent;)e*=r.scaleX,i*=r.scaleY,r=r.parent;return cc.v2(e,i)},convertToNodeRotation:function(t,e){e-=-t.angle;for(var i=t.parent;i.parent;)e-=-i.angle,i=i.parent;return e}}},{}],196:[function(t,e){var i=t("./js"),r=t("./CCEnum"),n=t("./utils"),s=(n.isPlainEmptyObj_DEV,n.cloneable_DEV,t("./attribute")),o=s.DELIMETER,a=t("./preprocess-class");t("./requiring-frame");var l=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"];function c(t,e){t.indexOf(e)<0&&t.push(e)}var h={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var r=t[e],n=r.cls,s=r.props;"function"==typeof s&&(s=s());var o=i.getClassName(n);s?S(n,o,s,n.$super,r.mixins):cc.errorID(3633,o)}this.datas=null}}};function u(t,e,i,r){var n=r.default;s.setClassAttr(t,i,"default",n),function(t,e){c(t.__props__,e)}(t,i),E(t,r,0,i)}function d(t,e,r,n,o){var a=n.get,l=n.set,c=t.prototype,h=!Object.getOwnPropertyDescriptor(c,r);a&&(E(t,n,0,r),s.setClassAttr(t,r,"serializable",!1),o||i.get(c,r,a,h,h)),l&&(o||i.set(c,r,l,h,h))}function p(t){return"function"==typeof t?t():t}function f(t,e,r){for(var n in e)t.hasOwnProperty(n)||r&&!r(n)||Object.defineProperty(t,n,i.getPropertyDescriptor(e,n))}function _(t,e,r,n){var o,a,l=n.__ctor__,c=n.ctor,h=n.__ES6__;h?(o=[c],a=c):(o=l?[l]:x(e,r,n),a=b(o,e,t,n),i.value(a,"extend",(function(t){return t.extends=this,w(t)}),!0)),i.value(a,"__ctors__",o.length>0?o:null,!0);var u=a.prototype;if(e&&(h||(i.extend(a,e),u=a.prototype),a.$super=e),r){for(var d=r.length-1;d>=0;d--){var p=r[d];f(u,p.prototype),f(a,p,(function(t){return p.hasOwnProperty(t)&&!0})),w._isCCClass(p)&&f(s.getClassAttrs(a),s.getClassAttrs(p))}u.constructor=a}return h||(u.__initProps__=v),i.setClassName(t,a),a}function m(t){for(var e=i.getClassName(t),r=t.constructor,n="new "+e+"(",s=0;s<r.__props__.length;s++)n+=t[r.__props__[s]],s<r.__props__.length-1&&(n+=",");return n+")"}function g(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}var y=/^[A-Za-z_$][0-9A-Za-z_$]*$/;function v(t){var e=s.getClassAttrs(t),i=t.__props__;null===i&&(h.init(),i=t.__props__);var r=function(t,e){for(var i=[],r="",n=0;n<e.length;n++){var s=e[n],a=s+o+"default";if(a in t){var l,c;l=y.test(s)?"this."+s+"=":"this["+g(s)+"]=";var h=t[a];if("object"==typeof h&&h)c=h instanceof cc.ValueType?m(h):Array.isArray(h)?"[]":"{}";else if("function"==typeof h){var u=i.length;i.push(h),c="F["+u+"]()"}else c="string"==typeof h?g(h):h;r+=l=l+c+";\n"}}return 0===i.length?Function(r):Function("F","return (function(){\n"+r+"})")(i)}(e,i);t.prototype.__initProps__=r,r.call(this)}var b=function(t,e,i,r){var n="return function CCClass(){\n";e&&C(e,r)&&(n+="this._super=null;\n"),n+="this.__initProps__(CCClass);\n";var s=t.length;if(s>0){var o="].apply(this,arguments);\n";if(1===s)n+="CCClass.__ctors__[0"+o;else{n+="var cs=CCClass.__ctors__;\n";for(var a=0;a<s;a++)n+="cs["+a+o}}return n+="}",Function(n)()};function x(t,e,i){for(var r,n=[],s=[t].concat(e),o=0;o<s.length;o++){var a=s[o];if(a)for(var l=(r=a,w._isCCClass(r)?r.__ctors__||[]:[r]),h=0;h<l.length;h++)c(n,l[h])}var u=i.ctor;return u&&n.push(u),n}var T=/xyz/.test((function(){xyz}))?/\b\._super\b/:/.*/;function C(t,e){var r=!1;for(var n in e)if(!(l.indexOf(n)>=0)){var s=e[n];if("function"==typeof s){var o=i.getPropertyDescriptor(t.prototype,n);if(o){var a=o.value;if("function"==typeof a){T.test(s)&&(r=!0,e[n]=function(t,e){return function(){var i=this._super;this._super=t;var r=e.apply(this,arguments);return this._super=i,r}}(a,s));continue}}}}return r}function S(t,e,i,r,n,l){if(t.__props__=[],r&&r.__props__&&(t.__props__=r.__props__.slice()),n)for(var c=0;c<n.length;++c){var h=n[c];h.__props__&&(t.__props__=t.__props__.concat(h.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(i)for(var p in a.preprocessAttrs(i,e,t,l),i){var f=i[p];"default"in f?u(t,0,p,f):d(t,0,p,f,l)}var _=s.getClassAttrs(t);t.__values__=t.__props__.filter((function(t){return!1!==_[t+o+"serializable"]}))}function w(t){var e=(t=t||{}).name,r=t.extends,n=t.mixins,s=function(t,e,r,n){var s=cc.Component,o=cc._RF.peek();if(o&&i.isChildClassOf(e,s)){if(i.isChildClassOf(o.cls,s))return cc.errorID(3615),null;t=t||o.script}var a=_(t,e,r,n);if(o)if(i.isChildClassOf(e,s)){var l=o.uuid;l&&i._setClassId(l,a),o.cls=a}else i.isChildClassOf(o.cls,s)||(o.cls=a);return a}(e,r,n,t);e||(e=cc.js.getClassName(s)),s._sealed=!0,r&&(r._sealed=!1);var o=t.properties;"function"==typeof o||r&&null===r.__props__||n&&n.some((function(t){return null===t.__props__}))?(h.push({cls:s,props:o,mixins:n}),s.__props__=s.__values__=null):S(s,e,o,r,t.mixins,t.__ES6__);var c,u=t.statics;if(u)for(c in u)s[c]=u[c];for(var d in t)if(!(l.indexOf(d)>=0)){var p=t[d];a.validateMethodWithProps(p,d,e,s,r)&&i.value(s.prototype,d,p,!0,!0)}var f=t.editor;return f&&cc.Component._registerEditorProps(s,f),s}w._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},w._fastDefine=function(t,e,r){i.setClassName(t,e);for(var n=e.__props__=e.__values__=Object.keys(r),a=s.getClassAttrs(e),l=0;l<n.length;l++){var c=n[l];a[c+o+"visible"]=!1,a[c+o+"default"]=r[c]}},w.Attr=s,w.attr=s.attr,w.getInheritanceChain=function(t){for(var e=[];t=i.getSuper(t);)t!==Object&&e.push(t);return e};var A={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function E(t,e,i,n){var a=null,l="";function c(){return l=n+o,a=s.getClassAttrs(t)}var h=e.type;function u(t,i){if(t in e){var r=e[t];typeof r===i&&((a||c())[l+t]=r)}}h&&(A[h]?(a||c())[l+"type"]=h:"Object"===h||(h===s.ScriptUuid?((a||c())[l+"type"]="Script",a[l+"ctor"]=cc.ScriptAsset):"object"==typeof h?r.isEnum(h)&&((a||c())[l+"type"]="Enum",a[l+"enumList"]=r.getList(h)):"function"==typeof h&&((a||c())[l+"type"]="Object",a[l+"ctor"]=h))),e.editorOnly&&((a||c())[l+"editorOnly"]=!0),!1===e.serializable&&((a||c())[l+"serializable"]=!1),u("formerlySerializedAs","string");var d=e.range;d&&Array.isArray(d)&&d.length>=2&&((a||c())[l+"min"]=d[0],a[l+"max"]=d[1],d.length>2&&(a[l+"step"]=d[2])),u("min","number"),u("max","number"),u("step","number"),u("userData","object")}cc.Class=w,e.exports={isArray:function(t){return t=p(t),Array.isArray(t)},fastDefine:w._fastDefine,getNewValueTypeCode:m,IDENTIFIER_RE:y,escapeForJS:g,getDefault:p}},{"./CCEnum":198,"./attribute":208,"./js":217,"./preprocess-class":218,"./requiring-frame":219,"./utils":220}],197:[function(t,e){t("./CCClass");var i=t("./preprocess-class"),r=t("./js"),n="__ccclassCache__";function s(t){return t}function o(t,e){return t[e]||(t[e]={})}function a(t){return function(e){return"function"==typeof e?t(e):function(i){return t(i,e)}}}function l(t,e){return function(t){return function(i){return e(i,t)}}}var c=l.bind(null,!1);function h(){return l.bind(null,!1)}var u=h(),d=h();function p(t){return o(t,n)}function f(t,e,n,s,o,a){var l,c=o&&(o.get||o.set);s&&(l=i.getFullFormOfProperty(s,c));var h=e[n],u=r.mixin(h||{},l||s||{});if(c)o.get&&(u.get=o.get),o.set&&(u.set=o.set);else{var d=void 0;if(o)o.initializer&&(d=function(t){var e;try{e=t()}catch(i){return t}return"object"!=typeof e||null===e?e:t}(o.initializer));else{var p=a.default||(a.default=function(t){var e;try{e=new t}catch(i){return{}}return e}(t));p.hasOwnProperty(n)&&(d=p[n])}u.default=d}e[n]=u}var _=a((function(t,e){var i=r.getSuper(t);i===Object&&(i=null);var s={name:e,extends:i,ctor:t,__ES6__:!0},o=t[n];if(o){var a=o.proto;a&&r.mixin(s,a),t[n]=void 0}return cc.Class(s)}));function m(t,e,i){return t((function(t,i){var r=p(t);if(r){var n=i,s=o(r,"proto");o(s,"editor")[e]=n}}),e)}function g(t){return t(s)}var y=g(a),v=m(c,"requireComponent"),b=g(u),x=m(d,"executionOrder"),T=g(a),C=g(a),S=g(u),w=g(u),A=g(u);cc._decorator=e.exports={ccclass:_,property:function(t,e,i){var r=null;function n(t,e,i){var n=p(t.constructor);if(n){var s=o(n,"proto"),a=o(s,"properties");f(t.constructor,a,e,r,i,n)}}if(void 0===e)return r=t,n;n(t,e,i)},executeInEditMode:y,requireComponent:v,menu:b,executionOrder:x,disallowMultiple:T,playOnFocus:C,inspector:S,icon:w,help:A,mixins:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var i=p(e);i&&(o(i,"proto").mixins=t)}}}},{"./CCClass":196,"./js":217,"./preprocess-class":218,"./utils":220}],198:[function(t,e){var i=t("./js");function r(t){if("__enums__"in t)return t;i.value(t,"__enums__",null,!0);for(var e=-1,r=Object.keys(t),n=0;n<r.length;n++){var s=r[n],o=t[s];if(-1===o)o=++e,t[s]=o;else if("number"==typeof o)e=o;else if("string"==typeof o&&Number.isInteger(parseFloat(s)))continue;var a=""+o;s!==a&&i.value(t,a,s)}return t}r.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},r.getList=function(t){if(t.__enums__)return t.__enums__;var e=t.__enums__=[];for(var i in t){var r=t[i];Number.isInteger(r)&&e.push({name:i,value:r})}return e.sort((function(t,e){return t.value-e.value})),e},e.exports=cc.Enum=r},{"./js":217}],199:[function(t){var e,i=t("../event-manager"),r=t("./CCInputManager");cc.Acceleration=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=r||0},r.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();i.enableForTarget(e),e._accelEnabled?(e._registerAccelerometerEvent(),e._accelCurTime=0,i.scheduleUpdate(e)):(e._unregisterAccelerometerEvent(),e._accelCurTime=0,i.unscheduleUpdate(e))}},r.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},r._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",(function(t){i.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()}),!1),cc.game.canvas.addEventListener("keyup",(function(t){i.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()}),!1)},r._registerAccelerometerEvent=function(){var t=window,i=this;i._acceleration=new cc.Acceleration,i._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(i._accelDeviceEvent=window.DeviceOrientationEvent);var r=i._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(i._minus=-1),e=i.didAccelerate.bind(i),t.addEventListener(r,e,!1)},r._unregisterAccelerometerEvent=function(){var t=window,i=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";e&&t.removeEventListener(i,e,!1)},r.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var r,n,s,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;r=e._accelMinus*a.x*.1,n=e._accelMinus*a.y*.1,s=.1*a.z}else r=t.gamma/90*.981,n=-t.beta/90*.981,s=t.alpha/90*.981;if(cc.view._isRotated){var l=r;r=-n,n=l}o.x=r,o.y=n,o.z=s,o.timestamp=t.timeStamp||Date.now();var c=o.x;90===i.orientation?(o.x=-o.y,o.y=c):-90===i.orientation?(o.x=o.y,o.y=-c):180===i.orientation&&(o.x=-o.x,o.y=-o.y),cc.sys.os!==cc.sys.OS_ANDROID&&cc.sys.os!==cc.sys.OS_OPENHARMONY||cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ||(o.x=-o.x,o.y=-o.y)}}},{"../event-manager":141,"./CCInputManager":200}],200:[function(t,e){var i=t("./CCMacro"),r=t("./CCSys"),n=t("../event-manager"),s=cc.v2(),o={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_maxTouches:10,_touchesIntegerDict:{},_indexBitsUsed:0,_touchesCache:{},_touchCount:0,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){for(var t=cc.sys.now(),e=i.TOUCH_TIMEOUT,r=this._indexBitsUsed,n=-1,s=this._touches,o=this._touchesIntegerDict,a=this._touchesCache,l=0;l<this._maxTouches;l++){if(1&r){var c=s[l];if(c&&t-c._lastModified>e){var h=c.getID();delete o[h],delete a[h],this._touchCount--,-1===n?(n=l,this._indexBitsUsed|=1<<l):this._indexBitsUsed&=~(1<<l)}}else-1===n&&(n=l,this._indexBitsUsed|=1<<l);r>>=1}return n},_glView:null,_updateCanvasBoundingRect:function(){var t=cc.game.canvas,e=this._canvasBoundingRect,i=document.documentElement,r=window.pageXOffset-i.clientLeft,n=window.pageYOffset-i.clientTop;if(t.getBoundingClientRect){var s=t.getBoundingClientRect();e.left=s.left+r,e.top=s.top+n,e.width=s.width,e.height=s.height}else t instanceof HTMLCanvasElement?(e.left=r,e.top=n,e.width=t.width,e.height=t.height):(e.left=r,e.top=n,e.width=parseInt(t.style.width),e.height=parseInt(t.style.height))},handleTouchesBegin:function(t){for(var e,i,s=r.now(),o=[],a=this._touches,l=this._touchesIntegerDict,c=this._touchesCache,h=0,u=t.length;h<u;h++)if(void 0===l[i=(e=t[h]).getID()]){var d=this._getUnUsedIndex();if(-1===d){cc.logID(2300,d);continue}var p=new cc.Touch(e._point.x,e._point.y,i);p._setPrevPoint(e._prevPoint),p._lastModified=s,a[d]=p,l[i]=d,c[i]=p,this._touchCount++,o.push(p)}if(o.length>0){this._glView._convertTouchesWithScale(o);var f=new cc.Event.EventTouch(o);f._eventCode=cc.Event.EventTouch.BEGAN,n.dispatchEvent(f)}},handleTouchesMove:function(t){for(var e,i,s=r.now(),o=[],a=this._touches,l=this._touchesIntegerDict,c=0,h=t.length;c<h;c++)if(void 0!==(i=l[(e=t[c]).getID()])){var u=a[i];u&&(u._setPoint(e._point),u._setPrevPoint(e._prevPoint),u._lastModified=s,o.push(u))}if(o.length>0){this._glView._convertTouchesWithScale(o);var d=new cc.Event.EventTouch(o);d._eventCode=cc.Event.EventTouch.MOVED,n.dispatchEvent(d)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,n.dispatchEvent(i)}this._preTouchPool.length=0},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELED,n.dispatchEvent(i)}this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(t){for(var e,i,r,n=[],s=this._touches,o=this._touchesIntegerDict,a=this._touchesCache,l=0,c=t.length;l<c;l++)if(void 0!==(i=o[r=(e=t[l]).getID()])){var h=s[i];h&&(h._setPoint(e._point),h._setPrevPoint(e._prevPoint),n.push(h),delete o[r],delete a[r],this._touchCount--,this._indexBitsUsed&=~(1<<i))}return n},getGlobalTouchCount:function(){return this._touchCount},getGlobalTouches:function(){return this._touchesCache},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){e=i[n];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,r=t.getID(),n=i.length-1;n>=0;n--)if(i[n].getID()===r){i[n]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var r=this._preTouchPoint,n=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(n.x,n.y,0);return s._setPrevPoint(r.x,r.y),r.x=n.x,r.y=n.y,s},getMouseEvent:function(t,e,i){var r=this._prevMousePoint,n=new cc.Event.EventMouse(i);return n._setPrevCursor(r.x,r.y),r.x=t.x,r.y=t.y,this._glView._convertMouseToLocationInView(r,e),n.setLocation(r.x,r.y),n},getPointByEvent:function(t,e){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,o,a=[],l=this._glView,c=this._preTouchPoint,h=t.changedTouches.length,u=0;u<h;u++)if(i=t.changedTouches[u]){var d;d=r.BROWSER_TYPE_FIREFOX===r.browserType?l.convertToLocationInView(i.pageX,i.pageY,e,s):l.convertToLocationInView(i.clientX,i.clientY,e,s),null!=i.identifier?(n=new cc.Touch(d.x,d.y,i.identifier),o=this.getPreTouch(n).getLocation(),n._setPrevPoint(o.x,o.y),this.setPreTouch(n)):(n=new cc.Touch(d.x,d.y))._setPrevPoint(c.x,c.y),c.x=d.x,c.y=d.y,a.push(n)}return a},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=cc.view;var e=this,i=this._canvasBoundingRect;window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this));var s=r.isMobile,o="mouse"in r.capabilities,a="touches"in r.capabilities;if(o&&function(){s||(window.addEventListener("mousedown",(function(){e._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(t){if(e._mousePressed){e._mousePressed=!1;var r=e.getPointByEvent(t,i);if(!cc.rect(i.left,i.top,i.width,i.height).contains(r)){e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,i)]);var s=e.getMouseEvent(r,i,cc.Event.EventMouse.UP);s.setButton(t.button),n.dispatchEvent(s)}}}),!1));for(var r=cc.Event.EventMouse,o=[!s&&["mousedown",r.DOWN,function(i,r,n,s){e._mousePressed=!0,e.handleTouchesBegin([e.getTouchByXY(n.x,n.y,s)]),t.focus()}],!s&&["mouseup",r.UP,function(t,i,r,n){e._mousePressed=!1,e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,n)])}],!s&&["mousemove",r.MOVE,function(t,i,r,n){e.handleTouchesMove([e.getTouchByXY(r.x,r.y,n)]),e._mousePressed||i.setButton(null)}],["mousewheel",r.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",r.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],a=0;a<o.length;++a){var l=o[a];l&&function(){var s=l[0],o=l[1],a=l[2];t.addEventListener(s,(function(t){var s=e.getPointByEvent(t,i),l=e.getMouseEvent(s,i,o),c=t.button;o===r.MOVE&&(1&t.buttons?c=r.BUTTON_LEFT:2&t.buttons?c=r.BUTTON_RIGHT:4&t.buttons&&(c=r.BUTTON_MIDDLE)),l.setButton(c),a(t,l,s,i),n.dispatchEvent(l),t.stopPropagation(),t.preventDefault()}),!1)}()}}(),window.navigator.msPointerEnabled){var l={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel},c=function(r){var n=l[r];t.addEventListener(r,(function(t){var r=document.documentElement;i.adjustedLeft=i.left-r.scrollLeft,i.adjustedTop=i.top-r.scrollTop,n.call(e,[e.getTouchByXY(t.clientX,t.clientY,i)]),t.stopPropagation()}),!1)};for(var h in l)c(h)}if(a){var u={touchstart:function(i){e.handleTouchesBegin(i),t.focus()},touchmove:function(t){e.handleTouchesMove(t)},touchend:function(t){e.handleTouchesEnd(t)},touchcancel:function(t){e.handleTouchesCancel(t)}},d=function(r){var n=u[r];t.addEventListener(r,(function(t){if(t.changedTouches){var r=document.body;i.adjustedLeft=i.left-(r.scrollLeft||window.scrollX||0),i.adjustedTop=i.top-(r.scrollTop||window.scrollY||0),n(e.getTouchesByEvent(t,i)),t.stopPropagation(),t.preventDefault()}}),!1)};for(var p in u)d(p)}this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,n.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};e.exports=cc.internal.inputManager=o},{"../event-manager":141,"./CCMacro":201,"./CCSys":205}],201:[function(t,e){cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ENABLE_MULTI_TOUCH:!0,ALLOW_IMAGE_BITMAP:!cc.sys.isMobile,ENABLE_NATIVE_TTF_RENDERER:!0},Object.defineProperty(cc.macro,"ROTATE_ACTION_CCW",{set:function(t){cc.RotateTo&&cc.RotateBy&&(cc.RotateTo._reverse=cc.RotateBy._reverse=t)}}),cc.macro.SUPPORT_TEXTURE_FORMATS=[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e.exports=cc.macro},{}],202:[function(t,e){var i=t("./js"),r=t("./CCClass");function n(){this._name="",this._objFlags=0}r.fastDefine("cc.Object",n,{_name:"",_objFlags:0}),i.value(n,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var s=[];i.value(n,"_deferredDestroy",(function(){for(var t=s.length,e=0;e<t;++e){var i=s[e];1&i._objFlags||i._destroyImmediate()}t===s.length?s.length=0:s.splice(0,t)}));var o=n.prototype;i.getset(o,"name",(function(){return this._name}),(function(t){this._name=t}),!0),i.get(o,"isValid",(function(){return!(1&this._objFlags)}),!0),o.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,s.push(this),0))},o._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i,n=t instanceof cc._BaseNode||t instanceof cc.Component,s=n?"_id":null,o={};for(i in t)if(t.hasOwnProperty(i)){if(i===s)continue;switch(typeof t[i]){case"string":o[i]="";break;case"object":case"function":o[i]=null}}if(cc.Class._isCCClass(e))for(var a=cc.Class.Attr.getClassAttrs(e),l=e.__props__,c=0;c<l.length;c++){var h=(i=l[c])+cc.Class.Attr.DELIMETER+"default";if(h in a){if(n&&"_id"===i)continue;switch(typeof a[h]){case"string":o[i]="";break;case"object":case"function":o[i]=null;break;case"undefined":o[i]=void 0}}}var u="";for(i in o){var d;d=r.IDENTIFIER_RE.test(i)?"o."+i+"=":"o["+r.escapeForJS(i)+"]=";var p=o[i];""===p&&(p='""'),u+=d+p+";\n"}return Function("o",u)}(this,t),i.value(t,"__destruct__",e,!0)),e(this)},o._onPreDestroy=null,o._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},o._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t},cc.Object=e.exports=n},{"./CCClass":196,"./js":217}],203:[function(t,e){var i=t("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}},cc.PlistParser=function(){cc.SAXParser.call(this)},i.extend(cc.PlistParser,cc.SAXParser),i.mixin(cc.PlistParser.prototype,{parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warnID(5100),{};for(var r=null,n=0,s=i.childNodes.length;n<s&&1!==(r=i.childNodes[n]).nodeType;n++);return e=null,this._parseNode(r)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var r=0;r<t.childNodes.length;r++)e+=t.childNodes[r].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,r=t.childNodes.length;i<r;i++){var n=t.childNodes[i];1===n.nodeType&&e.push(this._parseNode(n))}return e},_parseDict:function(t){for(var e={},i=null,r=0,n=t.childNodes.length;r<n;r++){var s=t.childNodes[r];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,e.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":217}],204:[function(){cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};var t,e,i,r,n=this._fnMap;for(t=0,e=n.length;t<e;t++)if((i=n[t])&&void 0!==document[i[1]]){for(t=0,r=i.length;t<r;t++)this._fn[n[0][t]]=i[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchend"in window?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(t,e,i){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&t.readyState>0)return void(t.webkitEnterFullscreen&&t.webkitEnterFullscreen());t.setAttribute("x5-video-player-fullscreen","true")}if(this._supportsFullScreen){if(t=t||document.documentElement,e){var r=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(r,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(r,e,!1)}if(i){var n=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(n,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(n,i,{once:!0})}var s=t[this._fn.requestFullscreen]();void 0===document[this._fn.fullscreenerror]&&window.Promise&&s instanceof Promise&&s.catch((function(){}))}},exitFullScreen:function(t){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(t.webkitExitFullscreen&&t.webkitExitFullscreen());t.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e)},disableAutoFullScreen:function(t){var e=cc.game.canvas||t,i=this._touchEvent;this._preOnTouch&&(e.removeEventListener(i,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(t,e){var i=this,r=cc.game.canvas||t,n=this._fn.fullscreenerror,s=this._touchEvent;function o(){i._preOnFullScreenError=null,i._preOnTouch&&r.removeEventListener(s,i._preOnTouch),i._preOnTouch=function(){i._preOnTouch=null,i.requestFullScreen(t,e)},r.addEventListener(s,i._preOnTouch,{once:!0})}this._preOnFullScreenError&&t.removeEventListener(n,this._preOnFullScreenError),this._preOnFullScreenError=o,t.addEventListener(n,o,{once:!0})}},cc.screen.init()},{}],205:[function(t,e){window._CCSettings&&_CCSettings.platform;var i="undefined"==typeof window?global:window,r=cc&&cc.sys?cc.sys:function(){cc.sys={};var t,e,r=cc.sys;if(r.LANGUAGE_ENGLISH="en",r.LANGUAGE_CHINESE="zh",r.LANGUAGE_FRENCH="fr",r.LANGUAGE_ITALIAN="it",r.LANGUAGE_GERMAN="de",r.LANGUAGE_SPANISH="es",r.LANGUAGE_DUTCH="du",r.LANGUAGE_RUSSIAN="ru",r.LANGUAGE_KOREAN="ko",r.LANGUAGE_JAPANESE="ja",r.LANGUAGE_HUNGARIAN="hu",r.LANGUAGE_PORTUGUESE="pt",r.LANGUAGE_ARABIC="ar",r.LANGUAGE_NORWEGIAN="no",r.LANGUAGE_POLISH="pl",r.LANGUAGE_TURKISH="tr",r.LANGUAGE_UKRAINIAN="uk",r.LANGUAGE_ROMANIAN="ro",r.LANGUAGE_BULGARIAN="bg",r.LANGUAGE_UNKNOWN="unknown",r.OS_OPENHARMONY="OpenHarmony",r.OS_IOS="iOS",r.OS_ANDROID="Android",r.OS_WINDOWS="Windows",r.OS_MARMALADE="Marmalade",r.OS_LINUX="Linux",r.OS_BADA="Bada",r.OS_BLACKBERRY="Blackberry",r.OS_OSX="OS X",r.OS_WP8="WP8",r.OS_WINRT="WINRT",r.OS_UNKNOWN="Unknown",r.UNKNOWN=-1,r.WIN32=0,r.LINUX=1,r.MACOS=2,r.ANDROID=3,r.IPHONE=4,r.IPAD=5,r.BLACKBERRY=6,r.NACL=7,r.EMSCRIPTEN=8,r.TIZEN=9,r.WINRT=10,r.WP8=11,r.OPENHARMONY=12,r.MOBILE_BROWSER=100,r.DESKTOP_BROWSER=101,r.EDITOR_PAGE=102,r.EDITOR_CORE=103,r.WECHAT_GAME=104,r.QQ_PLAY=105,r.FB_PLAYABLE_ADS=106,r.BAIDU_GAME=107,r.VIVO_GAME=108,r.OPPO_GAME=109,r.HUAWEI_GAME=110,r.XIAOMI_GAME=111,r.JKW_GAME=112,r.ALIPAY_GAME=113,r.WECHAT_GAME_SUB=114,r.BAIDU_GAME_SUB=115,r.QTT_GAME=116,r.BYTEDANCE_GAME=117,r.BYTEDANCE_GAME_SUB=118,r.LINKSURE=119,r.TAOBAO=120,r.TAOBAO_MINIGAME=121,r.BROWSER_TYPE_WECHAT="wechat",r.BROWSER_TYPE_ANDROID="androidbrowser",r.BROWSER_TYPE_IE="ie",r.BROWSER_TYPE_EDGE="edge",r.BROWSER_TYPE_QQ="qqbrowser",r.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",r.BROWSER_TYPE_UC="ucbrowser",r.BROWSER_TYPE_UCBS="ucbs",r.BROWSER_TYPE_360="360browser",r.BROWSER_TYPE_BAIDU_APP="baiduboxapp",r.BROWSER_TYPE_BAIDU="baidubrowser",r.BROWSER_TYPE_MAXTHON="maxthon",r.BROWSER_TYPE_OPERA="opera",r.BROWSER_TYPE_OUPENG="oupeng",r.BROWSER_TYPE_MIUI="miuibrowser",r.BROWSER_TYPE_FIREFOX="firefox",r.BROWSER_TYPE_SAFARI="safari",r.BROWSER_TYPE_CHROME="chrome",r.BROWSER_TYPE_LIEBAO="liebao",r.BROWSER_TYPE_QZONE="qzone",r.BROWSER_TYPE_SOUGOU="sogou",r.BROWSER_TYPE_HUAWEI="huawei",r.BROWSER_TYPE_UNKNOWN="unknown",r.isNative=!1,r.isBrowser="object"==typeof window&&"object"==typeof document&&!0,r.glExtension=function(t){return!!cc.renderer.device.ext(t)},r.getMaxJointMatrixSize=function(){if(!r._maxJointMatrixSize){var t=cc.game._renderContext,e=Math.floor(t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)/4)-10;r._maxJointMatrixSize=e<50?0:50}return r._maxJointMatrixSize},r.getSafeAreaRect=function(){var t=cc.view.getVisibleSize();return cc.rect(0,0,t.width,t.height)},i.__globalAdapter&&i.__globalAdapter.adaptSys)i.__globalAdapter.adaptSys(r);else{var n=window,s=n.navigator,o=document,a=o.documentElement,l=s.userAgent.toLowerCase();r.isMobile=/mobile|android|iphone|ipad/.test(l),"undefined"!=typeof FbPlayableAd?r.platform=r.FB_PLAYABLE_ADS:r.platform=r.isMobile?r.MOBILE_BROWSER:r.DESKTOP_BROWSER;var c=s.language;c=c||s.browserLanguage,r.languageCode=c.toLowerCase(),c=c?c.split("-")[0]:r.LANGUAGE_ENGLISH,r.language=c;var h=!1,u=!1,d="",p=0,f=/android\s*(\d+(?:\.\d+)*)/i.exec(l)||/android\s*(\d+(?:\.\d+)*)/i.exec(s.platform);f&&(h=!0,d=f[1]||"",p=parseInt(d)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(l))?(u=!0,d=f[2]||"",p=parseInt(d)||0):(/(iPhone|iPad|iPod)/.exec(s.platform)||"MacIntel"===s.platform&&s.maxTouchPoints&&s.maxTouchPoints>1)&&(u=!0,d="",p=0);var _=r.OS_UNKNOWN;-1!==s.appVersion.indexOf("Win")?_=r.OS_WINDOWS:u?_=r.OS_IOS:-1!==s.appVersion.indexOf("Mac")?_=r.OS_OSX:-1!==s.appVersion.indexOf("X11")&&-1===s.appVersion.indexOf("Linux")?_=r.OS_UNIX:h?_=r.OS_ANDROID:-1===s.appVersion.indexOf("Linux")&&-1===l.indexOf("ubuntu")||(_=r.OS_LINUX),r.os=_,r.osVersion=d,r.osMainVersion=p,r.browserType=r.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(l)||/qq|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(l)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(l),e=t?t[0].toLowerCase():r.BROWSER_TYPE_UNKNOWN;("safari"===e&&h||"qq"===e&&l.match(/android.*applewebkit/i))&&(e=r.BROWSER_TYPE_ANDROID);var i={micromessenger:r.BROWSER_TYPE_WECHAT,trident:r.BROWSER_TYPE_IE,edge:r.BROWSER_TYPE_EDGE,"360 aphone":r.BROWSER_TYPE_360,mxbrowser:r.BROWSER_TYPE_MAXTHON,"opr/":r.BROWSER_TYPE_OPERA,ubrowser:r.BROWSER_TYPE_UC,huaweibrowser:r.BROWSER_TYPE_HUAWEI};"qqbrowser"!==e&&"mqqbrowser"!==e||l.match(/wechat|micromessenger/i)&&(e=r.BROWSER_TYPE_WECHAT),r.browserType=i[e]||e}(),r.browserVersion="",(e=l.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||(e=l.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),r.browserVersion=e?e[4]:"";var m=window.innerWidth||document.documentElement.clientWidth,g=window.innerHeight||document.documentElement.clientHeight,y=window.devicePixelRatio||1;r.windowPixelResolution={width:y*m,height:y*g},r._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var v=document.createElement("canvas");try{var b=r.localStorage=n.localStorage;b.setItem("storage",""),b.removeItem("storage"),b=null}catch(D){var x=function(){cc.warnID(5200)};r.localStorage={getItem:x,setItem:x,removeItem:x,clear:x}}var T=v.toDataURL("image/webp").startsWith("data:image/webp"),C=!!v.getContext("2d"),S=!1;n.WebGLRenderingContext&&(S=!0);var w,A=r.capabilities={canvas:C,opengl:S,webp:T,imageBitmap:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(v.width=v.height=2,createImageBitmap(v,{}).then((function(t){A.imageBitmap=!0,t.close&&t.close()})).catch((function(){}))),(void 0!==a.ontouchstart||void 0!==o.ontouchstart||s.msPointerEnabled||"string"==typeof __wxjs_environment&&"miniprogram"===__wxjs_environment)&&(A.touches=!0),void 0!==a.onmouseup&&(A.mouse=!0),void 0!==a.onkeyup&&(A.keyboard=!0),(n.DeviceMotionEvent||n.DeviceOrientationEvent)&&(A.accelerometer=!0),function(){r.browserVersion;var t=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);w={ONLY_ONE:!1,WEB_AUDIO:t,DELAY_CREATE_CTX:!1},r.os===r.OS_IOS&&(w.USE_LOADER_EVENT="loadedmetadata"),r.browserType===r.BROWSER_TYPE_FIREFOX&&(w.DELAY_CREATE_CTX=!0,w.USE_LOADER_EVENT="canplay"),r.os===r.OS_ANDROID&&r.browserType===r.BROWSER_TYPE_UC&&(w.ONE_SOURCE=!0)}();try{w.WEB_AUDIO&&(w.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),w.DELAY_CREATE_CTX&&setTimeout((function(){w.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}),0))}catch(L){w.WEB_AUDIO=!1,cc.logID(5201)}var E=[];(t=document.createElement("audio")).canPlayType&&(t.canPlayType('audio/ogg; codecs="vorbis"')&&E.push(".ogg"),t.canPlayType("audio/mpeg")&&E.push(".mp3"),t.canPlayType('audio/wav; codecs="1"')&&E.push(".wav"),t.canPlayType("audio/mp4")&&E.push(".mp4"),t.canPlayType("audio/x-m4a")&&E.push(".m4a")),w.format=E,r.__audioSupport=w}return r.NetworkType={NONE:0,LAN:1,WWAN:2},r.getNetworkType=function(){return r.NetworkType.LAN},r.getBatteryLevel=function(){return 1},r.garbageCollect=function(){},r.restartVM=function(){},r.isObjectValid=function(t){return!!t},r.dump=function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t)},r.openURL=function(t){window.open(t)},r.now=function(){return Date.now?Date.now():+new Date},r}();e.exports=r},{}],206:[function(t,e){var i=t("../event/event-target"),r=t("../platform/js"),n=t("../renderer");t("../platform/CCClass");var s={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(s.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),s.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:s.meta["minimal-ui"]="true",s.availWidth=function(t){return t.clientWidth},s.availHeight=function(t){return t.clientHeight}}var o=null,a=function(){i.call(this);var t=this,e=cc.ContainerStrategy,r=cc.ContentStrategy;s.init(this),t._frameSize=cc.size(0,0),t._designResolutionSize=cc.size(0,0),t._originalDesignResolutionSize=cc.size(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=cc.rect(0,0,0,0),t._visibleRect=cc.rect(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=cc.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._antiAliasEnabled=!1,t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,r.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,r.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,r.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,r.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,r.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)};cc.js.extend(a,i),cc.js.mixin(a.prototype,{init:function(){this._initFrameSize();var t=cc.game.canvas.width,e=cc.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(t){var e;e=this.setDesignResolutionSize?this:cc.view;var i=cc.sys;if(i.browserType!==i.BROWSER_TYPE_UC||i.os!==i.OS_IOS){var r=e._frameSize.width,n=e._frameSize.height,s=e._isRotated;if(cc.sys.isMobile){var o=cc.game.container.style,a=o.margin;o.margin="0",o.display="none",e._initFrameSize(),o.margin=a,o.display="block"}else e._initFrameSize();if(!0===t||e._isRotated!==s||e._frameSize.width!==r||e._frameSize.height!==n){var l=e._originalDesignResolutionSize.width,c=e._originalDesignResolutionSize.height;e._resizing=!0,l>0&&e.setDesignResolutionSize(l,c,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}}else setTimeout((function(){e._resizeEvent(t)}),0)},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent(),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout((function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1)}),500)},_resize:function(){cc.view._resizeEvent(!1)},resizeWithBrowserSize:function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resize),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if((t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t){this._orientation=t;var e=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(e,i,this._resolutionPolicy)}},_initFrameSize:function(){var t=this._frameSize,e=s.availWidth(cc.game.frame),i=s.availHeight(cc.game.frame),r=e>=i;!cc.sys.isMobile||r&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout((function(){cc.view._orientationChanging=!1}),1e3)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var r,n,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;for(n in r=a?a.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1==r.indexOf(n)?r+=","+n+"="+t[n]:e&&(s=new RegExp(n+"s*=s*[^,]+"),r=r.replace(s,n+"="+t[n]));/^,/.test(r)&&(r=r.substr(1)),i.content=r,a&&(a.content=r),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(s.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(t){this._isAdjustViewport=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(cc.warnID(9200),this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL)cc.assetManager.assets.forEach((function(e){if(e instanceof cc.Texture2D){var i=cc.Texture2D.Filter;t?e.setFilters(i.LINEAR,i.LINEAR):e.setFilters(i.NEAREST,i.NEAREST)}}));else if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){var e=cc.game.canvas.getContext("2d");e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(t,e){var i=cc.game.canvas,r=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(t>0&&e>0){this.setResolutionPolicy(i);var r=this._resolutionPolicy;if(r&&r.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),r){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var s=r.apply(this,this._designResolutionSize);if(s.scale&&2===s.scale.length&&(this._scaleX=s.scale[0],this._scaleY=s.scale[1]),s.viewport){var o=this._viewportRect,a=this._visibleRect,l=s.viewport;o.x=l.x,o.y=l.y,o.width=l.width,o.height=l.height,a.x=0,a.y=0,a.width=l.width/this._scaleX,a.height=l.height/this._scaleY}r.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),n.updateCameraViewport(),cc.internal.inputManager._updateCanvasBoundingRect(),this.emit("design-resolution-changed")}else cc.logID(2201)}else cc.errorID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewportInPoints:function(t,e,i,r){var n=this._scaleX,s=this._scaleY;cc.game._renderContext.viewport(t*n+this._viewportRect.x,e*s+this._viewportRect.y,i*n,r*s)},setScissorInPoints:function(t,e,i,r){var n=this._scaleX,s=this._scaleY,a=Math.ceil(t*n+this._viewportRect.x),l=Math.ceil(e*s+this._viewportRect.y),c=Math.ceil(i*n),h=Math.ceil(r*s),u=cc.game._renderContext;if(!o){var d=u.getParameter(u.SCISSOR_BOX);o=cc.rect(d[0],d[1],d[2],d[3])}o.x===a&&o.y===l&&o.width===c&&o.height===h||(o.x=a,o.y=l,o.width=c,o.height=h,u.scissor(a,l,c,h))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!o){var t=gl.getParameter(gl.SCISSOR_BOX);o=cc.rect(t[0],t[1],t[2],t[3])}var e=1/this._scaleX,i=1/this._scaleY;return cc.rect((o.x-this._viewportRect.x)*e,(o.y-this._viewportRect.y)*i,o.width*e,o.height*i)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i,r){var n=r||cc.v2(),s=i.adjustedLeft?i.adjustedLeft:i.left,o=i.adjustedTop?i.adjustedTop:i.top,a=this._devicePixelRatio*(t-s),l=this._devicePixelRatio*(o+i.height-e);return this._isRotated?(n.x=cc.game.canvas.width-l,n.y=a):(n.x=a,n.y=l),n},_convertMouseToLocationInView:function(t,e){var i=this._viewportRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,r,n=this._viewportRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)i=(e=t[a])._point,r=e._prevPoint,i.x=(i.x-n.x)/s,i.y=(i.y-n.y)/o,r.x=(r.x-n.x)/s,r.y=(r.y-n.y)/o}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(){},apply:function(){},postApply:function(){},_setupContainer:function(t,e,i){var r=cc.game.canvas;this._setupStyle(t,e,i);var n=t._devicePixelRatio=1;t.isRetinaEnabled()&&(n=t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),r.width=e*n,r.height=i*n},_setupStyle:function(t,e,i){var r=cc.game.canvas,n=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),n.style.width=r.style.width=e+"px",n.style.height=r.style.height=i+"px"},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.game.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(t,e,i,r,n,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-r)<2&&(r=e);var o=cc.rect((t-i)/2,(e-r)/2,i,r);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[n,s],this._result.viewport=o,this._result},preApply:function(){},apply:function(){return{scale:[1,1]}},postApply:function(){}}),function(){var t=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(t){var e=t._frameSize.height,i=cc.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"}}),e=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(t,e){var i,r,n=t._frameSize.width,s=t._frameSize.height,o=cc.game.container.style,a=e.width,l=e.height,c=n/a,h=s/l;c<h?(i=n,r=l*c):(i=a*h,r=s);var u=Math.round((n-i)/2),d=Math.round((s-r)/2);i=n-2*u,r=s-2*d,this._setupContainer(t,i,r),t._isRotated?o.margin="0 0 0 "+s+"px":o.margin="0px",o.paddingLeft=u+"px",o.paddingRight=u+"px",o.paddingTop=d+"px",o.paddingBottom=d+"px"}}),i=(cc.Class({name:"EqualToWindow",extends:t,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),cc.Class({name:"ProportionalToWindow",extends:e,preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}})),r=("undefined"==typeof window?global:window).__globalAdapter;r&&(r.adaptContainerStrategy&&r.adaptContainerStrategy(cc.ContainerStrategy.prototype),r.adaptView&&r.adaptView(a.prototype)),cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=i/e.width,s=r/e.height;return this._buildResult(i,r,i,r,n,s)}}),s=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(t,e){var i,r,n=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,a=e.height,l=n/o,c=s/a,h=0;return l<c?(i=n,r=a*(h=l)):(i=o*(h=c),r=s),this._buildResult(n,s,i,r,h,h)}}),o=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(t,e){var i,r,n,s=cc.game.canvas.width,o=cc.game.canvas.height,a=e.width,l=e.height,c=s/a,h=o/l;return c<h?(r=a*(i=h),n=o):(r=s,n=l*(i=c)),this._buildResult(s,o,r,n,i,i)}}),l=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=r/e.height,s=i,o=r;return this._buildResult(i,r,s,o,n,n)}}),c=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=i/e.width,s=i,o=r;return this._buildResult(i,r,s,o,n,n)}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new s,cc.ContentStrategy.NO_BORDER=new o,cc.ContentStrategy.FIXED_HEIGHT=new l,cc.ContentStrategy.FIXED_WIDTH=new c}(),cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(t,e){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),r.get(cc.ResolutionPolicy.prototype,"canvasSize",(function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)})),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new a,cc.winSize=cc.size(),e.exports=cc.view},{"../event/event-target":143,"../platform/CCClass":196,"../platform/js":217,"../renderer":227}],207:[function(){cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,r=t.x,n=t.y,s=n+i,o=r+e;this.topLeft.x=r,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=r+e/2,this.top.y=s,this.bottomLeft.x=r,this.bottomLeft.y=n,this.bottomRight.x=o,this.bottomRight.y=n,this.bottom.x=r+e/2,this.bottom.y=n,this.center.x=r+e/2,this.center.y=n+i/2,this.left.x=r,this.left.y=n+i/2,this.right.x=o,this.right.y=n+i/2}}},{}],208:[function(t,e){var i=t("./js"),r=(t("./utils").isPlainEmptyObj_DEV,"$_$");function n(t,e){var r=e?Object.create(e):{};return i.value(t,"__attrs__",r),r}function s(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){if("function"!=typeof t)return n(t,s(t.constructor));for(var e,i=cc.Class.getInheritanceChain(t),r=i.length-1;r>=0;r--){var o=i[r];o.hasOwnProperty("__attrs__")&&o.__attrs__||n(o,(e=i[r+1])&&e.__attrs__)}return n(t,(e=i[0])&&e.__attrs__),t.__attrs__}(t)}function o(t,e){this.name=t,this.default=e}o.prototype.toString=function(){return this.name},cc.Integer=new o("Integer",0),cc.Float=new o("Float",0),cc.Boolean=new o("Boolean",!1),cc.String=new o("String",""),e.exports={PrimitiveType:o,attr:function(t,e){var i=s(t),n=e+r,o={};for(var a in i)a.startsWith(n)&&(o[a.slice(n.length)]=i[a]);return o},getClassAttrs:s,setClassAttr:function(t,e,i,n){s(t)[e+r+i]=n},DELIMETER:r,getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}}},{"./CCClass":196,"./js":217,"./utils":220}],209:[function(t,e){var i=t("./js"),r=i.array.fastRemoveAt;function n(){}function s(){this.callback=n,this.target=void 0,this.once=!1}s.prototype.set=function(t,e,i){this.callback=t,this.target=e,this.once=!!i};var o=new i.Pool((function(t){return t.callback=n,t.target=void 0,t.once=!1,!0}),32);function a(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}o.get=function(){return this._get()||new s};var l=a.prototype;l.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(o.put(i),r(this.callbackInfos,e),--e)}},l.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(o.put(i),r(this.callbackInfos,e),--e)}},l.cancel=function(t){var e=this.callbackInfos[t];e&&(o.put(e),this.callbackInfos[t]=null),this.containCanceled=!0},l.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(o.put(e),this.callbackInfos[t]=null)}this.containCanceled=!0},l.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||r(this.callbackInfos,t);this.containCanceled=!1},l.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1};var c=new i.Pool((function(t){return t.callbackInfos=[],t.isInvoking=!1,t.containCanceled=!1,!0}),16);function h(){this._callbackTable=i.createMap(!0)}c.get=function(){return this._get()||new a},(l=h.prototype).on=function(t,e,i,r){var n=this._callbackTable[t];n||(n=this._callbackTable[t]=c.get());var s=o.get();s.set(e,i,r),n.callbackInfos.push(s)},l.hasEventListener=function(t,e,i){var r=this._callbackTable[t];if(!r)return!1;var n=r.callbackInfos;if(!e){if(r.isInvoking){for(var s=0;s<n.length;++s)if(n[s])return!0;return!1}return n.length>0}for(var o=0;o<n.length;++o){var a=n[o];if(a&&a.callback===e&&a.target===i)return!0}return!1},l.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),c.put(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking)for(var n=r.callbackInfos,s=0;s<n.length;++s){var o=n[s];o&&o.target===t&&r.cancel(s)}else r.removeByTarget(t)}},l.off=function(t,e,i){var n=this._callbackTable[t];if(n)for(var s=n.callbackInfos,a=0;a<s.length;++a){var l=s[a];if(l&&l.callback===e&&l.target===i){n.isInvoking?n.cancel(a):(r(s,a),o.put(l));break}}},l.emit=function(t,e,i,r,n,s){var o=this._callbackTable[t];if(o){var a=!o.isInvoking;o.isInvoking=!0;for(var l=o.callbackInfos,c=0,h=l.length;c<h;++c){var u=l[c];if(u){var d=u.target,p=u.callback;u.once&&this.off(t,p,d),d?p.call(d,e,i,r,n,s):p(e,i,r,n,s)}}a&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},e.exports=h},{"./js":217}],210:[function(t,e){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?i(t,n):t.push(n)}}e.exports={flattenCodeArray:function(t){var e=[];return i(e,t),e.join("")}}},{}],211:[function(t,e,i){i.__esModule=!0,i.default=P,i.getDependUuidList=function(t){var e=t[1];return t[10].map((function(t){return e[t]}))},i.hasNativeDep=function(t){var e=t[5],i=e[e.length-1];return"number"==typeof i&&i<0},i.packCustomObjData=function(t,e,i){return[1,p,p,[t],p,i?[e,-1]:[e],[0],p,[],[],[]]},i.unpackJSONs=function(t,e){if(t[0]<1)throw new Error(cc.debug.getError(5304,t[0]));L(t,!0,e),I(t);for(var i=new M(t[0]),r=t[1],n=t[2],s=t[3],o=t[4],a=t[y],l=0;l<a.length;++l)a[l].unshift(i,r,n,s,o);return a};var r=d(t("./js")),n=d(t("../value-types/vec2")),s=d(t("../value-types/vec3")),o=d(t("../value-types/vec4")),a=d(t("../value-types/color")),l=d(t("../value-types/size")),c=d(t("../value-types/rect")),h=d(t("../value-types/quat")),u=d(t("../value-types/mat4"));function d(t){return t&&t.__esModule?t:{default:t}}var p=0,f=[n.default,s.default,o.default,h.default,a.default,l.default,c.default,u.default];function _(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var m=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},_,_,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){u.default.fromArray(t,e,1)}],g=0,y=5,v=function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var e=t.prototype;return e.init=function(t){this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]},e.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},e.push=function(t,e,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i)},t}();function b(t,e){for(var i=t[4][e[0]],r=i[0],n=new r[0],s=r[1],o=r[2],a=i[i.length-1],l=1;l<a;++l)n[s[i[l]]]=e[l];for(;l<e.length;++l){var c=s[i[l]],h=r[i[l]+o];(0,A[h])(t,n,c,e[l])}return n}function x(t,e,i){var n=new e;return n._deserialize?n._deserialize(i,t[0]):cc.errorID(5303,r.default.getClassName(e)),n}function T(t,e,i,r){r>=0?e[i]=t[5][r]:t[7][3*~r]=e}function C(t){return function(e,i,r,n){i[r]=n;for(var s=0;s<n.length;++s)t(e,n,s,n[s])}}function S(t,e,i,r){e[i]=null,t[8][r]=e}function w(t,e,i,r){e[i]=b(t,r)}v.pool=new r.default.Pool((function(t){t.reset()}),5),v.pool.get=function(){return this._get()||new v};var A=new Array(13);function E(t,e){return t||P.reportMissingClass(e),Object}function D(t,e,i,r,n,s){var o=t(e);if(!o){if(n)return void(i[r]=function(e,i,r){return function(){var n=t(r)||E(s,r);return e[i]=n,new n}}(i,r,e));o=E(s,e)}i[r]=o}function L(t,e,i){for(var n=i||r.default._getClassById,s=t[3],o=0;o<s.length;++o){var a=s[o];"string"!=typeof a?D(n,a[0],a,g,e,i):D(n,a,s,o,e,i)}}function I(t){var e=t[4];if(e)for(var i=t[3],r=0;r<e.length;++r){var n=e[r];n[0]=i[n[0]]}}function P(t,e,i){"string"==typeof t&&(t=JSON.parse(t));var r=!e;(e=e||v.pool.get()).init(t),i=i||{};var n=t[0],s=!1;if("object"==typeof n&&(s=n.preprocessed,n=n.version),n<1)throw new Error(cc.debug.getError(5304,n));i._version=n,i.result=e,t[0]=i,s||(L(t,!1,i.classFinder),I(t)),cc.game._isCloning=!0;var o=t[5],a=function(t){var e=t[5],i=t[6],r=0===i?0:i.length,n=e[e.length-1],s=e.length-r;"number"!=typeof n?n=0:(n<0&&(n=~n),--s);for(var o=0;o<s;++o)e[o]=b(t,e[o]);for(var a=t[3],l=0;l<r;++l,++o){var c=i[l],h=e[o];if(c>=0){var u=a[c];e[o]=x(t,u,h)}else(0,A[c=~c])(t,e,o,h)}return n}(t);return cc.game._isCloning=!1,t[7]&&function(t,e,i){for(var r=t.length-1,n=0,s=3*t[r];n<s;n+=3){var o=t[n],a=e[t[n+2]],l=t[n+1];l>=0?o[i[l]]=a:o[~l]=a}for(;n<r;n+=3){var c=e[t[n]],h=e[t[n+2]],u=t[n+1];u>=0?c[i[u]]=h:c[~u]=h}}(t[7],o,t[2]),function(t){for(var e=t[5],i=t[2],r=t[1],n=t[8],s=t[9],o=t[10],a=0;a<n.length;++a){var l=n[a];"number"==typeof l&&(n[a]=e[l]);var c=s[a];"number"==typeof c&&(c=c>=0?i[c]:~c,s[a]=c);var h=o[a];"number"==typeof h&&(o[a]=r[h])}}(t),r&&v.pool.put(e),o[a]}A[0]=function(t,e,i,r){e[i]=r},A[1]=T,A[2]=C(T),A[3]=C(S),A[4]=w,A[5]=function(t,e,i,r){m[r[0]](e[i],r)},A[6]=S,A[7]=function(t,e,i,r){e[i].set(r)},A[8]=function(t,e,i,r){var n=new f[r[0]];m[r[0]](n,r),e[i]=n},A[9]=C(w),A[10]=function(t,e,i,r){var n=t[3][r[0]];e[i]=x(t,n,r[1])},A[11]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=1;s<r.length;s+=3){var o=r[s],a=r[s+1],l=r[s+2];(0,A[a])(t,n,o,l)}},A[12]=function(t,e,i,r){var n=r[0];e[i]=n;for(var s=0;s<n.length;++s){var o=n[s],a=r[s+1];0!==a&&(0,A[a])(t,n,s,o)}},P.Details=v;var M=function(t){this.preprocessed=!0,this.version=t}},{"../value-types/color":285,"../value-types/mat4":288,"../value-types/quat":289,"../value-types/rect":290,"../value-types/size":291,"../value-types/vec2":295,"../value-types/vec3":296,"../value-types/vec4":297,"./js":217}],212:[function(t){var e,i=(e=t("./deserialize-compiled"))&&e.__esModule?e:{default:e};i.default.reportMissingClass=function(t){cc.warnID(5302,t)},cc.deserialize=i.default},{"./deserialize-compiled":211,"./deserialize-editor":void 0}],213:[function(t,e){function i(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}i.prototype.getNewId=function(){return this.prefix+ ++this.id},i.global=new i("global"),e.exports=i},{}],214:[function(t){t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCVisibleRect")},{"./CCClass":196,"./CCClassDecorator":197,"./CCEnum":198,"./CCMacro":201,"./CCObject":202,"./CCSys":205,"./CCVisibleRect":207,"./callbacks-invoker":209,"./deserialize":212,"./instantiate":216,"./instantiate-jit":215,"./js":217,"./requiring-frame":219}],215:[function(t,e){var i=t("./CCObject"),r=i.Flags.Destroyed,n=i.Flags.PersistentMask,s=t("./attribute"),o=t("./js"),a=t("./CCClass"),l=t("./compiler"),c=s.DELIMETER+"default",h=a.IDENTIFIER_RE,u=a.escapeForJS,d="var ",p="o",f={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};try{!Float32Array.name&&(Float32Array.name="Float32Array"),!Float64Array.name&&(Float64Array.name="Float64Array"),!Int8Array.name&&(Int8Array.name="Int8Array"),!Int16Array.name&&(Int16Array.name="Int16Array"),!Int32Array.name&&(Int32Array.name="Int32Array"),!Uint8Array.name&&(Uint8Array.name="Uint8Array"),!Uint16Array.name&&(Uint16Array.name="Uint16Array"),!Uint32Array.name&&(Uint32Array.name="Uint32Array"),!Uint8ClampedArray.name&&(Uint8ClampedArray.name="Uint8ClampedArray")}catch(C){}function _(t,e){this.varName=t,this.expression=e}function m(t,e){return e instanceof _?new _(e.varName,t+e.expression):t+e}function g(t,e,i){Array.isArray(i)?(i[0]=m(e,i[0]),t.push(i)):t.push(m(e,i)+";")}function y(t){this._exps=[],this._targetExp=t}function v(t,e){if("function"==typeof t)try{t=t()}catch(C){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof cc.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return o.isEmptyObject(t)&&o.isEmptyObject(e)}return!1}function b(t){return h.test(t)?"."+t:"["+u(t)+"]"}function x(t,e){var i;this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=o.createMap(),o.mixin(this.funcModuleCache,f),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push(d+p+",t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),o.value(t,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(i=d+this.globalVariables.join(",")+";");var r=l.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",r)(this.objs,this.funcs);for(var n=0,s=this.objsToClear_iN$t.length;n<s;++n)this.objsToClear_iN$t[n]._iN$t=null;this.objsToClear_iN$t.length=0}_.prototype.toString=function(){return d+this.varName+"="+this.expression+";"},y.prototype.append=function(t,e){this._exps.push([t,e])},y.prototype.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var r=this._exps[i];g(t,e+b(r[0])+"=",r[1])}},y.pool=new o.Pool((function(t){t._exps.length=0,t._targetExp=null}),1),y.pool.get=function(t){var e=this._get()||new y;return e._targetExp=t,e};var T=x.prototype;T.getFuncModule=function(t,e){var i=o.getClassName(t);if(i){var r=this.funcModuleCache[i];if(r)return r;if(void 0===r){var n=-1!==i.indexOf(".");if(n)try{if(n=t===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(C){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var a="F["+s+"]";return e&&(a="("+a+")"),this.funcModuleCache[i]=a,a},T.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},T.setValueType=function(t,e,i,r){var n=y.pool.get(r),s=e.constructor.__props__;s||(s=Object.keys(e));for(var o=0;o<s.length;o++){var a=s[o],l=i[a];if(e[a]!==l){var c=this.enumerateField(i,a,l);n.append(a,c)}}n.writeCode(t),y.pool.put(n)},T.enumerateCCClass=function(t,e,i){for(var r=i.__values__,n=s.getClassAttrs(i),o=0;o<r.length;o++){var l=r[o],h=e[l],u=n[l+c];if(!v(u,h))if("object"==typeof h&&h instanceof cc.ValueType&&(u=a.getDefault(u))&&u.constructor===h.constructor){var d=p+b(l);this.setValueType(t,u,h,d)}else this.setObjProp(t,e,l,h)}},T.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new _(e,"new Array("+t.length+")")];o.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)g(i,e+"["+r+"]=",this.enumerateField(t,r,t[r]));return i},T.instantiateTypedArray=function(t){var e=t.constructor.name||function(t){if(t===Float32Array)return"Float32Array";if(t===Float64Array)return"Float64Array";if(t===Int8Array)return"Int8Array";if(t===Int16Array)return"Int16Array";if(t===Int32Array)return"Int32Array";if(t===Uint8Array)return"Uint8Array";if(t===Uint16Array)return"Uint16Array";if(t===Uint32Array)return"Uint32Array";if(t===Uint8ClampedArray)return"Uint8ClampedArray";throw new Error("Unknown TypedArray to instantiate: "+t)}(t.constructor);if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId,r=[new _(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)0!==t[n]&&g(r,i+"["+n+"]=",t[n]);return r},T.enumerateField=function(t,e,r){if("object"==typeof r&&r){var s=r._iN$t;if(s){var o=s.globalVar;if(!o){o=s.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(o);var a=s.source[0];s.source[0]=m(o+"=",a)}return o}return ArrayBuffer.isView(r)?this.instantiateTypedArray(r):Array.isArray(r)?this.instantiateArray(r):this.instantiateObj(r)}return"function"==typeof r?this.getFuncModule(r):"string"==typeof r?u(r):("_objFlags"===e&&t instanceof i&&(r&=n),r)},T.setObjProp=function(t,e,i,r){g(t,p+b(i)+"=",this.enumerateField(e,i,r))},T.enumerateObject=function(t,e){var i=e.constructor;if(cc.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var n=e[r];"object"==typeof n&&n&&n===e._iN$t||this.setObjProp(t,e,r,n)}},T.instantiateObj=function(t){if(t instanceof cc.ValueType)return a.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&r)return null;var e,i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component){var n;if(null==(n=t.node)||!n.isChildOf(this.parent))return this.getObjRef(t)}e=new _(p,"new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new _(p,"{}");else{if(i)return this.getObjRef(t);e=new _(p,"Object.create(null)")}var s=[e];return o.value(t,"_iN$t",{globalVar:"",source:s},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(s,t),["(function(){",s,"return o;})();"]},e.exports={compile:function(t){return new x(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:v}},{"./CCClass":196,"./CCObject":202,"./attribute":208,"./compiler":210,"./js":217}],216:[function(t,e){var i=t("./CCObject"),r=t("../value-types/value-type"),n=i.Flags.Destroyed,s=i.Flags.PersistentMask,o=t("./utils").isDomNode,a=t("./js");function l(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var r;if(t instanceof i){if(t._instantiate)return cc.game._isCloning=!0,r=t._instantiate(null,!0),cc.game._isCloning=!1,r;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,r=h(t),cc.game._isCloning=!1,r}var c=[];function h(t,e){if(Array.isArray(t))return null;if(o&&o(t))return null;var i;d(t,i=t._iN$t?t._iN$t:t.constructor?new t.constructor:Object.create(null),e);for(var r=0,n=c.length;r<n;++r)c[r]._iN$t=null;return c.length=0,i}function u(t,e,i,n){for(var s=t.__values__,o=0;o<s.length;o++){var a=s[o],l=e[a];if("object"==typeof l&&l){var c=i[a];c instanceof r&&c.constructor===l.constructor?c.set(l):i[a]=l._iN$t||p(l,n)}else i[a]=l}}function d(t,e,r){a.value(t,"_iN$t",e,!0),c.push(t);var n=t.constructor;if(cc.Class._isCCClass(n))u(n,t,e,r);else for(var o in t)if(t.hasOwnProperty(o)&&(95!==o.charCodeAt(0)||95!==o.charCodeAt(1)||"__type__"===o)){var l=t[o];if("object"==typeof l&&l){if(l===e)continue;e[o]=l._iN$t||p(l,r)}else e[o]=l}t instanceof i&&(e._objFlags&=s)}function p(t,e){if(t instanceof r)return t.clone();if(t instanceof cc.Asset)return t;var i;if(ArrayBuffer.isView(t)){var s=t.length;i=new t.constructor(s),t._iN$t=i,c.push(t);for(var o=0;o<s;++o)i[o]=t[o];return i}if(Array.isArray(t)){var l=t.length;i=new Array(l),a.value(t,"_iN$t",i,!0),c.push(t);for(var h=0;h<l;++h){var u=t[h];i[h]="object"==typeof u&&u?u._iN$t||p(u,e):u}return i}if(t._objFlags&n)return null;var f=t.constructor;if(cc.Class._isCCClass(f)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component){var _;if(null==(_=t.node)||!_.isChildOf(e))return t}i=new f}else if(f===Object)i={};else{if(f)return t;i=Object.create(null)}return d(t,i,e),i}l._clone=h,cc.instantiate=l,e.exports=l},{"../value-types/value-type":294,"./CCObject":202,"./js":217,"./utils":220}],217:[function(t,e){var i=new(t("./id-generater"))("TmpCId.");function r(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function n(t,e,i){var n=r(e,t);Object.defineProperty(i,t,n)}var s={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r){if("object"!=typeof r){cc.errorID(5402,r);continue}for(var s in r)s in t||n(s,r,t)}}return t},mixin:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r){if("object"!=typeof r){cc.errorID(5403,r);continue}for(var s in r)n(s,r,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){var e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor},isChildClassOf:function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=s.getSuper(t)))return!1;if(t===e)return!0}}return!1},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},isEmptyObject:function(t){for(var e in t)return!1;return!0},getPropertyDescriptor:r},o={value:void 0,enumerable:!1,writable:!1,configurable:!0};s.value=function(t,e,i,r,n){o.value=i,o.writable=r,o.enumerable=n,Object.defineProperty(t,e,o),o.value=void 0};var a={get:null,set:null,enumerable:!1};s.getset=function(t,e,i,r,n,s){"function"!=typeof r&&(n=r,r=void 0),a.get=i,a.set=r,a.enumerable=n,a.configurable=s,Object.defineProperty(t,e,a),a.get=null,a.set=null};var l={get:null,enumerable:!1,configurable:!1};s.get=function(t,e,i,r,n){l.get=i,l.enumerable=r,l.configurable=n,Object.defineProperty(t,e,l),l.get=null};var c={set:null,enumerable:!1,configurable:!1};s.set=function(t,e,i,r,n){c.set=i,c.enumerable=r,c.configurable=n,Object.defineProperty(t,e,c),c.set=null},s.getClassName=function(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var i="";if(t.name&&(i=t.name),t.toString){var r,n=t.toString();(r="["===n.charAt(0)?n.match(/\[\w+\s*(\w+)\]/):n.match(/function\s*(\w+)/))&&2===r.length&&(i=r[1])}return"Object"!==i?i:""}return t&&t.constructor?s.getClassName(t.constructor):""},function(){var t={},e={};function r(t,e,i){return s.getset(s,e,(function(){return Object.assign({},i)}),(function(t){s.clear(i),Object.assign(i,t)})),function(e,r){if(r.prototype.hasOwnProperty(t)&&delete i[r.prototype[t]],s.value(r.prototype,t,e),e){var n=i[e];if(n&&n!==r){var o="A Class already exists with the same "+t+' : "'+e+'".';cc.error(o)}else i[e]=r}}}s._setClassId=r("__cid__","_registeredClassIds",t);var n=r("__classname__","_registeredClassNames",e);s.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var r=t||i.getNewId();r&&s._setClassId(r,e)}},s.unregisterClass=function(){for(var i=0;i<arguments.length;i++){var r=arguments[i].prototype,n=r.__cid__;n&&delete t[n];var s=r.__classname__;s&&delete e[s]}},s._getClassById=function(e){return t[e]},s.getClassByName=function(t){return e[t]},s._getClassId=function(t,e){if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""}}(),s.obsolete=function(t,e,i,r){var n=/([^.]+)$/,o=n.exec(e)[0],a=n.exec(i)[0];function l(){return this[a]}r?s.getset(t,o,l,(function(t){this[a]=t})):s.get(t,o,l)},s.obsoletes=function(t,e,i,r){for(var n in i){var o=i[n];s.obsolete(t,e+"."+n,o,r)}};var h=/(%d)|(%s)/,u=/%s/;function d(t,e){t.splice(e,1)}function p(t,e){var i=t.indexOf(e);return i>=0&&(d(t,i),!0)}function f(t,e){void 0===e&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}s.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&h.test(e))for(var i=1;i<t;++i){var r=arguments[i],n="number"==typeof r?h:u;if(n.test(e)){var s=""+r;e=e.replace(n,s)}else e+=" "+r}else for(var o=1;o<t;++o)e+=" "+arguments[o];return e},s.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e},s.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e},s.array={remove:p,fastRemove:function(t,e){var i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],--t.length)},removeAt:d,fastRemoveAt:function(t,e){var i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)},contains:function(t,e){return t.indexOf(e)>=0},verifyType:function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0},removeArray:function(t,e){for(var i=0,r=e.length;i<r;i++)p(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,r=new Array(i);for(e=0;e<i;e+=1)r[e]=t[e];return r},MutableForwardIterator:t("../utils/mutable-forward-iterator")},f.prototype._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},f.prototype.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},f.prototype.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},s.Pool=f,cc.js=s,e.exports=s},{"../utils/mutable-forward-iterator":272,"./id-generater":213}],218:[function(t,e,i){var r=t("./js"),n=t("./attribute"),s={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function o(t,e,i,r){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var n="_N$"+e;t.get=function(){return this[n]},t.set=function(t){var e=this[n];this[n]=t,i.call(this,e)};var o={};for(var a in r[n]=o,s){var l=s[a];t.hasOwnProperty(a)&&(o[a]=t[a],l.canUsedInGet||delete t[a])}}}function a(t,e,i,r){if(Array.isArray(e)){if(!(e.length>0))return cc.errorID(5508,i,r);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=cc.String:e===Boolean?t.type=cc.Boolean:e===Number&&(t.type=cc.Float))}function l(t,e,i){var r=t?{_short:!0}:{_short:!0,default:e};return i&&(r.type=i),r}i.getFullFormOfProperty=function(t,e){return t&&t.constructor===Object?null:Array.isArray(t)&&t.length>0?l(e,[],t):"function"==typeof t?l(e,r.isChildClassOf(t,cc.ValueType)?new t:null,t):t instanceof n.PrimitiveType?l(e,t.default):l(e,t)},i.preprocessAttrs=function(t,e){for(var r in t){var n=t[r],s=i.getFullFormOfProperty(n,!1);if(s&&(n=t[r]=s),n){var l=n.notify;l&&o(n,r,l,t),"type"in n&&a(n,n.type,e,r)}}},i.validateMethodWithProps=function(t){return"function"==typeof t||null===t}},{"./CCClass":196,"./attribute":208,"./js":217}],219:[function(){var t=[];cc._RF={push:function(e,i,r){void 0===r&&(r=i,i=""),t.push({uuid:i,script:r,module:e,exports:e.exports,beh:null})},pop:function(){var e=t.pop(),i=e.module,r=i.exports;if(r===e.exports){for(var n in r)return;i.exports=r=e.cls}},peek:function(){return t[t.length-1]}}},{}],220:[function(t,e){t("./js"),e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout((function(){t(e,i)}),0)}}},{"./js":217}],221:[function(t){t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./asset-manager"),t("./CCDirector"),t("./renderer"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager")},{"./CCDirector":27,"./CCScheduler":32,"./asset-manager":50,"./event":145,"./event-manager":141,"./platform/CCInputExtension":199,"./platform/CCInputManager":200,"./platform/CCMacro":201,"./platform/CCScreen":204,"./platform/CCSys":205,"./platform/CCView":206,"./platform/js":217,"./renderer":227,"./utils":270,"./value-types":286}],222:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("./assembler")),n=o(t("./utils/dynamic-atlas/manager")),s=o(t("./webgl/render-data"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,i;function r(){var e;return(e=t.call(this)||this)._renderData=new s.default,e._renderData.init(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)),e.initData(),e.initLocal(),e}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var o,l,c=r.prototype;return c.initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},c.initLocal=function(){this._local=[],this._local.length=4},c.updateColor=function(t,e){var i=this._renderData.uintVDatas[0];if(i){e=null!=e?e:t.node.color._val;for(var r=this.floatsPerVert,n=this.colorOffset,s=i.length;n<s;n+=r)i[n]=e}},c.getBuffer=function(){return cc.renderer._handle._meshBuffer},c.updateWorldVerts=function(t){var e=this._local,i=this._renderData.vDatas[0],r=t.node._worldMatrix.m,n=r[0],s=r[1],o=r[4],a=r[5],l=r[12],c=r[13],h=e[0],u=e[2],d=e[1],p=e[3],f=this.floatsPerVert,_=0;if(1===n&&0===s&&0===o&&1===a)i[_]=h+l,i[_+1]=d+c,i[_+=f]=u+l,i[_+1]=d+c,i[_+=f]=h+l,i[_+1]=p+c,i[_+=f]=u+l,i[_+1]=p+c;else{var m=n*h,g=n*u,y=s*h,v=s*u,b=o*d,x=o*p,T=a*d,C=a*p;i[_]=m+b+l,i[_+1]=y+T+c,i[_+=f]=g+b+l,i[_+1]=v+T+c,i[_+=f]=m+x+l,i[_+1]=y+C+c,i[_+=f]=g+x+l,i[_+1]=v+C+c}},c.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var i=this._renderData,r=i.vDatas[0],n=i.iDatas[0],s=this.getBuffer(e),o=s.request(this.verticesCount,this.indicesCount),a=o.byteOffset>>2,l=s._vData;r.length+a>l.length?l.set(r.subarray(0,l.length-a),a):l.set(r,a);for(var c=s._iData,h=o.indiceOffset,u=o.vertexOffset,d=0,p=n.length;d<p;d++)c[h++]=u+n[d]},c.packToDynamicAtlas=function(t,e){if(!e._original&&n.default&&e._texture.packable&&e._texture.loaded){var i=n.default.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}var r=t._materials[0];r&&r.getProperty("texture")!==e._texture._texture&&(t._vertsDirty=!0,t._updateMaterial())},o=r,(l=[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(o.prototype,l),Object.defineProperty(o,"prototype",{writable:!1}),r}(r.default);i.default=l,cc.js.addon(l.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4}),cc.Assembler2D=l,e.exports=i.default},{"./assembler":224,"./utils/dynamic-atlas/manager":230,"./webgl/render-data":258}],223:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../utils/pool"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=0;function a(t){return Object.getOwnPropertyDescriptor(t,"__assemblerId__")||(t.__assemblerId__=++o),t.__assemblerId__}var l=new(function(t){var e,i;function r(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._pool={},e}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.put=function(t){if(t&&this.enabled){var e=a(t.constructor),i=this._pool;i[e]||(i[e]=[]),this.count>this.maxSize||(this._clean(t),i[e].push(t),this.count++)}},n.get=function(t){var e;if(this.enabled){var i=this._pool,r=a(t);e=i[r]&&i[r].pop()}return e?this.count--:e=new t,e},n.clear=function(){this._pool={},this.count=0},n._clean=function(t){t._renderComp=null},r}(n.default));n.default.register("assembler",l);var c=l;i.default=c,e.exports=i.default},{"../utils/pool":273}],224:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("./webgl/vertex-format"),s=(r=t("./assembler-pool"))&&r.__esModule?r:{default:r},o=function(){function t(){this._extendNative&&this._extendNative()}var e=t.prototype;return e.init=function(t){this._renderComp=t},e.updateRenderData=function(){},e.fillBuffers=function(){},e.getVfmt=function(){return n.vfmtPosUvColor},t}();i.default=o,o.register=function(t,e){t.__assembler__=e},o.init=function(t){for(var e=t.constructor,i=e.__assembler__;!i;){if(!(e=e.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(t)+"]");i=e.__assembler__}if(i.getConstructor&&(i=i.getConstructor(t)),!t._assembler||t._assembler.constructor!==i){var r=s.default.get(i);r.init(t),t._assembler=r}},cc.Assembler=o,e.exports=i.default},{"./assembler-pool":223,"./webgl/vertex-format":260}],225:[function(t,e){var i=function(t){var e;try{e=t.getContext("2d")}catch(i){return void console.error(i)}this._canvas=t,this._ctx=e,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0};i.prototype._restoreTexture=function(){},i.prototype.setViewport=function(t,e,i,r){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===r||(this._vx=t,this._vy=e,this._vw=i,this._vh=r)},i.prototype.setScissor=function(t,e,i,r){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===r||(this._sx=t,this._sy=e,this._sw=i,this._sh=r)},i.prototype.clear=function(t){var e=this._ctx;e.clearRect(this._vx,this._vy,this._vw,this._vh),!t||0===t[0]&&0===t[1]&&0===t[2]||(e.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",e.globalAlpha=t[3],e.fillRect(this._vx,this._vy,this._vw,this._vh))},i.prototype.resetDrawCalls=function(){this._stats.drawcalls=0},i.prototype.getDrawCalls=function(){return this._stats.drawcalls},e.exports=i},{}],226:[function(t,e){var i=function(t,e){this._device=t,this._width=4,this._height=4,this._image=null,e&&(void 0!==e.width&&(this._width=e.width),void 0!==e.height&&(this._height=e.height),this.updateImage(e))};i.prototype.update=function(t){this.updateImage(t)},i.prototype.updateImage=function(t){if(t.images&&t.images[0]){var e=t.images[0];e&&e!==this._image&&(this._image=e)}},i.prototype.destroy=function(){this._image=null},e.exports=i},{}],227:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("../../renderer/gfx")),n=o(t("../../renderer/core/input-assembler")),s=o(t("../../renderer/core/pass"));function o(t){return t&&t.__esModule?t:{default:t}}var a=cc.renderer={Texture2D:null,InputAssembler:n.default,Pass:s.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(e,i){t("./webgl/assemblers");var n=t("./webgl/model-batcher");this.Texture2D=r.default.Texture2D,this.canvas=e,this._flow=cc.RenderFlow;var s=t("../../renderer/scene/scene"),o=t("../../renderer/renderers/forward-renderer");this.device=new r.default.Device(e,i),this.scene=new s;var a,l=(a=this.device,{defaultTexture:new r.default.Texture2D(a,{images:[],width:128,height:128,wrapS:r.default.WRAP_REPEAT,wrapT:r.default.WRAP_REPEAT,format:r.default.TEXTURE_FMT_RGB8,genMipmaps:!1}),programTemplates:[],programChunks:{}});this._forward=new o(this.device,l),this._handle=new n(this.device,this.scene),this._flow.init(this._handle,this._forward)},initCanvas:function(e){var i=t("./canvas"),r=t("./canvas/Texture2D"),n=t("./canvas/Device");this.Device=n,this.Texture2D=r,this.canvas=e,this.device=new n(e),this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0},this._handle=new i.RenderComponentHandle(this.device,this._camera),this._forward=new i.ForwardRenderer,this._flow=cc.RenderFlow,this._flow.init(this._handle,this._forward)},updateCameraViewport:function(){if(cc.director){var t=cc.director.getScene();t&&t.setScale(1,1,1)}if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){var e=cc.view.getViewportRect();this.device.setViewport(e.x,e.y,e.width,e.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=e.x,this._camera.ty=e.y+e.height}},render:function(t,e){this.device.resetDrawCalls(),t&&(this._flow.render(t,e),this.drawCalls=this.device.getDrawCalls())},clear:function(){this._handle.reset(),this._forward.clear()}};i.default=a,e.exports=i.default},{"../../renderer/core/input-assembler":309,"../../renderer/core/pass":310,"../../renderer/gfx":319,"../../renderer/renderers/forward-renderer":338,"../../renderer/scene/scene":341,"./canvas":void 0,"./canvas/Device":225,"./canvas/Texture2D":226,"./webgl/assemblers":239,"./webgl/model-batcher":256}],228:[function(t,e){var i,r,n=0,s=1<<n++,o=1<<n++,a=1<<n++,l=1<<n++,c=a|l,h=1<<n++,u=1<<n++,d=1<<n++,p=u|d,f=1<<n++,_=1<<n++,m=1<<n++,g=1<<n++,y=0;function v(){this._func=S,this._next=null}var b=v.prototype;b._doNothing=function(){},b._localTransform=function(t){t._updateLocalMatrix(),t._renderFlag&=~a,this._next._func(t)},b._worldTransform=function(t){i.worldMatDirty++;var e=t._matrix,r=t._trs,n=e.m;n[12]=r[0],n[13]=r[1],n[14]=r[2],t._mulMat(t._worldMatrix,t._parent._worldMatrix,e),t._renderFlag&=~l,this._next._func(t),i.worldMatDirty--},b._updateRenderData=function(t){var e=t._renderComponent;e._assembler.updateRenderData(e),t._renderFlag&=~h,this._next._func(t)},b._opacity=function(t){i.parentOpacityDirty++,this._next._func(t),t._renderFlag&=~u,i.parentOpacityDirty--},b._color=function(t){var e=t._renderComponent;e&&e._updateColor(),t._renderFlag&=~d,this._next._func(t)},b._render=function(t){var e=t._renderComponent;e._checkBacth(i,t._cullingMask),e._assembler.fillBuffers(e,i),this._next._func(t)},b._children=function(t){for(var e=y,r=i,n=r.parentOpacity,s=r.parentOpacity*=t._opacity/255,o=(r.worldMatDirty?l:0)|(r.parentOpacityDirty?p:0),a=t._children,c=0,h=a.length;c<h;c++){var u=a[c];if(u._renderFlag|=o,u._activeInHierarchy&&0!==u._opacity){y=u._cullingMask=0===u.groupIndex?e:1<<u.groupIndex;var d=u._color._val;u._color._fastSetA(u._opacity*s),T[u._renderFlag]._func(u),u._color._val=d}}r.parentOpacity=n,this._next._func(t)},b._postRender=function(t){var e=t._renderComponent;e._checkBacth(i,t._cullingMask),e._assembler.postFillBuffers(e,i),this._next._func(t)};var x=new v;x._func=x._doNothing,x._next=x;var T={};function C(t,e){if(t===s||t===o)return x;var i=new v;switch(i._next=e||x,t){case a:i._func=i._localTransform;break;case l:i._func=i._worldTransform;break;case h:i._func=i._updateRenderData;break;case u:i._func=i._opacity;break;case d:i._func=i._color;break;case f:i._func=i._render;break;case _:i._func=i._children;break;case m:i._func=i._postRender}return i}function S(t){var e=t._renderFlag;(T[e]=function(t){for(var e=null,i=g;i>0;)i&t&&(e=C(i,e)),i>>=1;return e}(e))._func(t)}v.flows=T,v.createFlow=C;var w=[];v.registerValidate=function(t){t._inValidateList||(w.push(t),t._inValidateList=!0)},v.validateRenderers=function(){for(var t=0,e=w.length;t<e;t++){var i=w[t];i.isValid&&(i.enabledInHierarchy?i._validateRender():i.disableRender(),i._inValidateList=!1)}w.length=0},v.visitRootNode=function(t){v.validateRenderers();var e=y;y=t._cullingMask,t._renderFlag&l?(i.worldMatDirty++,t._calculWorldMatrix(),t._renderFlag&=~l,T[t._renderFlag]._func(t),i.worldMatDirty--):T[t._renderFlag]._func(t),y=e},v.render=function(t,e){i.reset(),i.walking=!0,v.visitRootNode(t),i.terminate(),i.walking=!1,r.render(i._renderScene,e)},v.renderCamera=function(t,e){i.reset(),i.walking=!0,v.visitRootNode(e),i.terminate(),i.walking=!1,r.renderCamera(t,i._renderScene)},v.init=function(t,e){i=t,r=e,T[0]=x;for(var n=1;n<g;n++)T[n]=new v},v.getBachther=function(){return i},v.FLAG_DONOTHING=s,v.FLAG_BREAK_FLOW=o,v.FLAG_LOCAL_TRANSFORM=a,v.FLAG_WORLD_TRANSFORM=l,v.FLAG_TRANSFORM=c,v.FLAG_UPDATE_RENDER_DATA=h,v.FLAG_OPACITY=u,v.FLAG_COLOR=d,v.FLAG_OPACITY_COLOR=p,v.FLAG_RENDER=f,v.FLAG_CHILDREN=_,v.FLAG_POST_RENDER=m,v.FLAG_FINAL=g,e.exports=cc.RenderFlow=v},{}],229:[function(t,e){var i=t("../../../assets/CCRenderTexture");function r(t,e){var r=new i;r.initWithSize(t,e),r.update(),this._texture=r,this._x=2,this._y=2,this._nexty=2,this._width=t,this._height=e,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}r.DEFAULT_HASH=(new i)._getHash(),cc.js.mixin(r.prototype,{insertSpriteFrame:function(t){var e=t._rect,i=t._texture,r=this._innerTextureInfos[i._id],n=e.x,s=e.y;if(r)n+=r.x,s+=r.y;else{var o=i.width,a=i.height;if(this._x+o+2>this._width&&(this._x=2,this._y=this._nexty),this._y+a+2>this._nexty&&(this._nexty=this._y+a+2),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((o<=8||a<=8)&&(this._texture.drawTextureAt(i,this._x-1,this._y-1),this._texture.drawTextureAt(i,this._x-1,this._y+1),this._texture.drawTextureAt(i,this._x+1,this._y-1),this._texture.drawTextureAt(i,this._x+1,this._y+1)),this._texture.drawTextureAt(i,this._x-1,this._y),this._texture.drawTextureAt(i,this._x+1,this._y),this._texture.drawTextureAt(i,this._x,this._y-1),this._texture.drawTextureAt(i,this._x,this._y+1)),this._texture.drawTextureAt(i,this._x,this._y),this._innerTextureInfos[i._id]={x:this._x,y:this._y,texture:i},this._count++,n+=this._x,s+=this._y,this._x+=o+2,this._dirty=!0}var l={x:n,y:s,texture:this._texture};return this._innerSpriteFrames.push(t),l},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},deleteInnerTexture:function(t){t&&this._innerTextureInfos[t._id]&&(delete this._innerTextureInfos[t._id],this._count--)},isEmpty:function(){return this._count<=0},reset:function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},destroy:function(){this.reset(),this._texture.destroy()}}),e.exports=r},{"../../../assets/CCRenderTexture":70}],230:[function(t,e){var i=t("./atlas"),r=[],n=-1,s=5,o=2048,a=512,l=!0,c=null;function h(){var t=r[++n];return t||(t=new i(o,o),r.push(t)),t}function u(){p.reset()}var d=!1,p={Atlas:i,get enabled(){return d},set enabled(t){d!==t&&(t?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u),d=t)},get maxAtlasCount(){return s},set maxAtlasCount(t){s=t},get atlasCount(){return r.length},get textureBleeding(){return l},set textureBleeding(t){l=t},get textureSize(){return o},set textureSize(t){o=t},get maxFrameSize(){return a},set maxFrameSize(t){a=t},insertSpriteFrame:function(t){if(!d||n===s||!t||t._original)return null;if(!t._texture.packable)return null;var e=r[n];e||(e=h());var i=e.insertSpriteFrame(t);return i||n===s?i:(e=h()).insertSpriteFrame(t)},reset:function(){for(var t=0,e=r.length;t<e;t++)r[t].destroy();r.length=0,n=-1},deleteAtlasSpriteFrame:function(t){if(t._original){var e=t._original._texture;this.deleteAtlasTexture(e)}},deleteAtlasTexture:function(t){if(t)for(var e=r.length-1;e>=0;e--)r[e].deleteInnerTexture(t),r[e].isEmpty()&&(r[e].destroy(),r.splice(e,1),n--)},showDebug:function(t){if(t){if(!c||!c.isValid){var e=cc.visibleRect.width,i=cc.visibleRect.height;(c=new cc.Node("DYNAMIC_ATLAS_DEBUG_NODE")).width=e,c.height=i,c.x=e/2,c.y=i/2,c.zIndex=cc.macro.MAX_ZINDEX,c.parent=cc.director.getScene(),c.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera();var s=c.addComponent(cc.ScrollView),a=new cc.Node("CONTENT"),l=a.addComponent(cc.Layout);l.type=cc.Layout.Type.VERTICAL,l.resizeMode=cc.Layout.ResizeMode.CONTAINER,a.parent=c,a.width=o,a.anchorY=1,a.x=o,s.content=a;for(var h=0;h<=n;h++){var u=new cc.Node("ATLAS"),d=(r[h]._texture,new cc.SpriteFrame);d.setTexture(r[h]._texture),u.addComponent(cc.Sprite).spriteFrame=d,u.parent=a}}return c}c&&(c.parent=null,c=null)},update:function(){if(this.enabled)for(var t=0;t<=n;t++)r[t].update()}};e.exports=cc.dynamicAtlasManager=p},{"./atlas":229}],231:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../assembler-2d"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("../../../utils/text-utils"),a=t("../../../platform/CCMacro"),l=t("../../../components/CCLabel").Overflow,c=t("../utils").shareLabelInfo,h=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},u=cc.rect(),d=null,p=[],f=[],_=[],m=[],g=null,y=0,v=0,b=0,x=0,T=0,C=1,S=null,w=cc.size(),A="",E=0,D=0,L=0,I=0,P=0,M=0,R=0,O=!1,B=0,N=0,k=0,F=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.updateRenderData=function(t){t._vertsDirty&&d!==t&&(d=t,this._reserveQuads(t,t.string.toString().length),this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),this.updateWorldVerts(t),d._actualFontSize=E,d.node.setContentSize(w),d._vertsDirty=!1,d=null,this._resetProperties())},n._updateFontScale=function(){C=E/D},n._updateFontFamily=function(t){var e=t.font;S=e.spriteFrame,g=e._fntConfig,c.fontAtlas=e._fontDefDictionary,this.packToDynamicAtlas(t,S)},n._updateLabelInfo=function(){c.hash="",c.margin=0},n._updateProperties=function(t){A=t.string.toString(),E=t.fontSize,D=g?g.fontSize:t.fontSize,L=t.horizontalAlign,I=t.verticalAlign,P=t.spacingX,R=t.overflow,M=t._lineHeight,w.width=t.node.width,w.height=t.node.height,R===l.NONE?(O=!1,w.width+=2*c.margin,w.height+=2*c.margin):R===l.RESIZE_HEIGHT?(O=!0,w.height+=2*c.margin):O=t.enableWrapText,c.lineHeight=M,c.fontSize=E,this._setupBMFontOverflowMetrics()},n._resetProperties=function(){g=null,S=null,c.hash="",c.margin=0},n._updateContent=function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},n._computeHorizontalKerningForText=function(){var t,e=A,i=e.length,r=p;if(g&&(t=g.kerningDict),t&&!cc.js.isEmptyObject(t))for(var n=-1,s=0;s<i;++s){var o=e.charCodeAt(s),a=t[n<<16|65535&o]||0;r[s]=s<i-1?a:0,n=o}else r.length=0},n._multilineTextWrap=function(t){for(var e=A.length,i=0,r=0,n=0,s=0,a=0,h=0,u=0,d=null,f=cc.v2(0,0),m=0;m<e;){var b=A.charAt(m);if("\n"!==b){for(var S=t(A,m,e),E=h,D=u,L=a,I=r,F=!1,V=0;V<S;++V){var j=m+V;if("\r"!==(b=A.charAt(j)))if(d=c.fontAtlas.getLetterDefinitionForChar(b,c)){var G=I+d.offsetX*C-c.margin;if(O&&k>0&&r>0&&G+d.w*C>k&&!o.isUnicodeSpace(b)){_.push(a),a=0,i++,r=0,n-=M*this._getFontScale()+0,F=!0;break}f.x=G,f.y=n-d.offsetY*C+c.margin,this._recordLetterInfo(f,b,j,i),j+1<p.length&&j<e-1&&(I+=p[j+1]),I+=d.xAdvance*C+P-2*c.margin,L=f.x+d.w*C-c.margin,E<f.y&&(E=f.y),D>f.y-d.h*C&&(D=f.y-d.h*C)}else{this._recordPlaceholderInfo(j,b);var U="";g&&(U=g.atlasName),console.log("Can't find letter definition in texture atlas "+U+" for letter:"+b)}else this._recordPlaceholderInfo(j,b)}F||(r=I,h<E&&(h=E),u>D&&(u=D),s<(a=L)&&(s=a),m+=S)}else _.push(a),a=0,i++,r=0,n-=M*this._getFontScale()+0,this._recordPlaceholderInfo(m,b),m++}return _.push(a),v=(y=i+1)*M*this._getFontScale(),y>1&&(v+=0*(y-1)),w.width=B,w.height=N,B<=0&&(w.width=parseFloat(s.toFixed(2))+2*c.margin),N<=0&&(w.height=parseFloat(v.toFixed(2))+2*c.margin),x=w.height,T=0,R!==l.CLAMP&&(h>0&&(x=w.height+h),u<-v&&(T=v+u)),!0},n._getFirstCharLen=function(){return 1},n._getFontScale=function(){return R===l.SHRINK?C:1},n._getFirstWordLen=function(t,e,i){var r=t.charAt(e);if(o.isUnicodeCJK(r)||"\n"===r||o.isUnicodeSpace(r))return 1;var n=1,s=c.fontAtlas.getLetterDefinitionForChar(r,c);if(!s)return n;for(var a=s.xAdvance*C+P,l=e+1;l<i&&(r=t.charAt(l),s=c.fontAtlas.getLetterDefinitionForChar(r,c));++l){if(a+s.offsetX*C+s.w*C>k&&!o.isUnicodeSpace(r)&&k>0)return n;if(a+=s.xAdvance*C+P,"\n"===r||o.isUnicodeSpace(r)||o.isUnicodeCJK(r))break;n++}return n},n._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},n._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},n._recordPlaceholderInfo=function(t,e){if(t>=f.length){var i=new h;f.push(i)}f[t].char=e,f[t].hash=e.charCodeAt(0)+c.hash,f[t].valid=!1},n._recordLetterInfo=function(t,e,i,r){if(i>=f.length){var n=new h;f.push(n)}var s=e.charCodeAt(0)+c.hash;f[i].line=r,f[i].char=e,f[i].hash=s,f[i].valid=c.fontAtlas.getLetter(s).valid,f[i].x=t.x,f[i].y=t.y},n._alignText=function(){v=0,_.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),R===l.SHRINK&&E>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||R===l.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},n._scaleFontSizeDown=function(t){var e=!0;t||(t=.1,e=!1),E=t,e&&this._updateContent()},n._shrinkLabelToContentSize=function(t){for(var e=0,i=0|E,r=0;e<i;){var n=r=e+i+1>>1;if(n<=0)break;C=n/D,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=r-1:e=r}var s=e;s>=0&&this._scaleFontSizeDown(s)},n._isVerticalClamp=function(){return v>w.height},n._isHorizontalClamp=function(){for(var t=!1,e=0,i=A.length;e<i;++e){var r=f[e];if(r.valid){var n=c.fontAtlas.getLetter(r.hash),s=r.x+n.w*C,o=r.line;if(B>0)if(O){if(_[o]>w.width&&(s>w.width||s<0)){t=!0;break}}else if(s>w.width){t=!0;break}}}return t},n._isHorizontalClamped=function(t,e){var i=_[e],r=t>w.width||t<0;return O?i>w.width&&r:r},n._updateQuads=function(){var t=S?S._texture:c.fontAtlas.getTexture(),e=d.node;this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0);for(var i=w,r=e._anchorPoint.x*i.width,n=e._anchorPoint.y*i.height,s=!0,o=0,a=A.length;o<a;++o){var h=f[o];if(h.valid){var p=c.fontAtlas.getLetter(h.hash);u.height=p.h,u.width=p.w,u.x=p.u,u.y=p.v;var _=h.y+b;if(N>0){if(_>x){var g=_-x;u.y+=g,u.height-=g,_-=g}_-p.h*C<T&&R===l.CLAMP&&(u.height=_<T?0:(_-T)/C)}var y=h.line,v=h.x+p.w/2*C+m[y];if(B>0&&this._isHorizontalClamped(v,y))if(R===l.CLAMP)u.width=0;else if(R===l.SHRINK){if(w.width>p.w){s=!1;break}u.width=0}if(u.height>0&&u.width>0){var E=this._determineRect(u),D=h.x+m[h.line];this.appendQuad(d,t,u,E,D-r,_-n,C)}}}return this._quadsUpdated(d),s},n._determineRect=function(t){var e=S.isRotated(),i=S._originalSize,r=S._rect,n=S._offset,s=n.x+(i.width-r.width)/2,o=n.y-(i.height-r.height)/2;if(e){var a=t.x;t.x=r.x+r.height-t.y-t.height-o,t.y=a+r.y-s,t.y<0&&(t.height=t.height+o)}else t.x+=r.x-s,t.y+=r.y+o;return e},n._computeAlignmentOffset=function(){switch(m.length=0,L){case a.TextAlignment.LEFT:for(var t=0;t<y;++t)m.push(0);break;case a.TextAlignment.CENTER:for(var e=0,i=_.length;e<i;e++)m.push((w.width-_[e])/2);break;case a.TextAlignment.RIGHT:for(var r=0,n=_.length;r<n;r++)m.push(w.width-_[r])}if(b=w.height,I!==a.VerticalTextAlignment.TOP){var s=w.height-v+M*this._getFontScale()-D*C;I===a.VerticalTextAlignment.BOTTOM?b-=s:b-=s/2}},n._setupBMFontOverflowMetrics=function(){var t=w.width,e=w.height;R===l.RESIZE_HEIGHT&&(e=0),R===l.NONE&&(t=0,e=0),B=t,N=e,k=t},n.updateWorldVerts=function(){},n.appendQuad=function(){},n._quadsUpdated=function(){},n._reserveQuads=function(){},r}(n.default);i.default=F,e.exports=i.default},{"../../../components/CCLabel":108,"../../../platform/CCMacro":201,"../../../utils/text-utils":278,"../../assembler-2d":222,"../utils":235}],232:[function(t,e){function i(){this._rect=null,this.uv=[],this._texture=null,this._original=null}i.prototype={constructor:i,getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t,this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(t){this._texture=t,this._rect=cc.rect(0,0,t.width,t.height),this._calculateUV()},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,r=e.width,n=e.height,s=0===r?0:t.x/r,o=0===r?0:(t.x+t.width)/r,a=0===n?0:(t.y+t.height)/n,l=0===n?0:t.y/n;i[0]=s,i[1]=a,i[2]=o,i[3]=a,i[4]=s,i[5]=l,i[6]=o,i[7]=l}},e.exports=i},{}],233:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../webgl/assemblers/label/2d/bmfont"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("../../../components/CCLabel"),a=t("../../../components/CCLabelOutline"),l=t("../../../utils/text-utils"),c=t("../../../components/CCComponent"),h=t("../../../assets/CCRenderTexture"),u=cc.js.isChildClassOf(a,c),d=t("../utils").getFontFamily,p=t("../utils").shareLabelInfo,f=cc.BitmapFont.FontLetterDefinition,_=cc.BitmapFont.FontAtlas,m=cc.Color.WHITE,g=(1/255).toFixed(3);function y(t,e){this._texture=null,this._labelInfo=e,this._char=t,this._hash=null,this._data=null,this._canvas=null,this._context=null,this._width=0,this._height=0,this._offsetY=0,this._hash=t.charCodeAt(0)+e.hash}function v(t,e){var i=new h;i.initWithSize(t,e),i.update(),this._fontDefDictionary=new _(i),this._x=0,this._y=0,this._nexty=0,this._width=t,this._height=e,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}y.prototype={constructor:y,updateRenderData:function(){this._updateProperties(),this._updateTexture()},_updateProperties:function(){this._texture=new cc.Texture2D,this._data=o._canvasPool.get(),this._canvas=this._data.canvas,this._context=this._data.context,this._context.font=this._labelInfo.fontDesc;var t=l.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc),e=2*this._labelInfo.margin+2;this._width=parseFloat(t.toFixed(2))+e,this._height=(1+l.BASELINE_RATIO)*this._labelInfo.fontSize+e,this._offsetY=-this._labelInfo.fontSize*l.BASELINE_RATIO/2,this._canvas.width!==this._width&&(this._canvas.width=this._width),this._canvas.height!==this._height&&(this._canvas.height=this._height),this._texture.initWithElement(this._canvas)},_updateTexture:function(){var t=this._context,e=this._labelInfo,i=this._canvas.width,r=this._canvas.height,n=this._labelInfo.fontSize,s=i/2,o=r/2+n*l.MIDDLE_RATIO+n*l.BASELINE_OFFSET,a=e.color;if(t.lineJoin="round",t.textAlign="center",t.clearRect(0,0,i,r),t.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", "+g+")",t.fillRect(0,0,i,r),t.font=e.fontDesc,t.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", 1)",e.isOutlined&&e.margin>0){var c=e.out||m;t.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this._char,s,o)}t.fillText(this._char,s,o),this._texture.handleLoadedTexture()},destroy:function(){this._texture.destroy(),this._texture=null,o._canvasPool.put(this._data)}},cc.js.mixin(v.prototype,{insertLetterTexture:function(t){var e=t._texture,i=e.width,r=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nexty),this._y+r>this._nexty&&(this._nexty=this._y+r+0),this._nexty>this._height)return null;this._fontDefDictionary._texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var n=new f;return n.u=this._x+1,n.v=this._y+1,n.texture=this._fontDefDictionary._texture,n.valid=!0,n.w=t._width-2,n.h=t._height-2,n.xAdvance=n.w,n.offsetY=t._offsetY,this._x+=i+0,this._fontDefDictionary.addLetterDefinitions(t._hash,n),n},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1)},reset:function(){this._x=0,this._y=0,this._nexty=0;for(var t=this._fontDefDictionary._letterDefinitions,e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r.destroy()}this._fontDefDictionary.clear()},destroy:function(){this.reset(),this._fontDefDictionary._texture.destroy(),this._fontDefDictionary._texture=null},beforeSceneLoad:function(){this.clearAllCache()},clearAllCache:function(){this.destroy();var t=new h;t.initWithSize(this._width,this._height),t.update(),this._fontDefDictionary._texture=t},getLetter:function(t){return this._fontDefDictionary._letterDefinitions[t]},getTexture:function(){return this._fontDefDictionary.getTexture()},getLetterDefinitionForChar:function(t,e){var i=t.charCodeAt(0)+e.hash,r=this._fontDefDictionary._letterDefinitions[i];if(!r){var n=new y(t,e);n.updateRenderData(),r=this.insertLetterTexture(n),n.destroy()}return r}});var b=null,x=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n._getAssemblerData=function(){return b||(b=new v(2048,2048),cc.Label._shareAtlas=b),b.getTexture()},n._updateFontFamily=function(t){p.fontAtlas=b,p.fontFamily=d(t);var e=u&&t.getComponent(a);e&&e.enabled?(p.isOutlined=!0,p.margin=e.width,p.out=e.color.clone(),p.out.a=e.color.a*t.node.color.a/255):(p.isOutlined=!1,p.margin=0)},n._updateLabelInfo=function(t){var e,i,r;p.fontDesc=this._getFontDesc(),p.color=t.node.color,p.hash=(i=(e=p).color.toHEX(),r="",e.isOutlined&&e.margin>0&&(r=r+e.margin+e.out.toHEX()),""+e.fontSize+e.fontFamily+i+r)},n._getFontDesc=function(){return p.fontSize.toString()+"px "+p.fontFamily},n._computeHorizontalKerningForText=function(){},n._determineRect=function(){return!1},r}(n.default);i.default=x,e.exports=i.default},{"../../../assets/CCRenderTexture":70,"../../../components/CCComponent":106,"../../../components/CCLabel":108,"../../../components/CCLabelOutline":109,"../../../utils/text-utils":278,"../../webgl/assemblers/label/2d/bmfont":240,"../utils":235}],234:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../assembler-2d"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o,a=t("../../../utils/text-utils"),l=t("../../../platform/CCMacro"),c=t("../../../components/CCLabel"),h=t("../../../components/CCLabelOutline"),u=t("../../../components/CCLabelShadow"),d=c.Overflow,p=t("../utils").deleteFromDynamicAtlas,f=t("../utils").getFontFamily,_=(1/255).toFixed(3),m=null,g=null,y=null,v="",b="",x=0,T=0,C=[],S=cc.Size.ZERO,w=0,A=0,E=0,D=null,L="",I=d.NONE,P=!1,M=!1,R=null,O=cc.Color.WHITE,B=null,N=cc.Color.BLACK,k=cc.rect(),F=cc.Size.ZERO,V=cc.Size.ZERO,j=!1,G=!1,U=!1,Y=0,H=cc.Vec2.ZERO,X=0,z=["left","center","right"],W=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n._getAssemblerData=function(){return(o=c._canvasPool.get()).canvas.width=o.canvas.height=1,o},n._resetAssemblerData=function(t){t&&c._canvasPool.put(t)},n.updateRenderData=function(e){t.prototype.updateRenderData.call(this,e),e._vertsDirty&&(this._updateProperties(e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(e),this._calDynamicAtlas(e),e._actualFontSize=x,e.node.setContentSize(V),this.updateVerts(e),e._vertsDirty=!1,m=null,g=null,y=null)},n.updateVerts=function(){},n._updatePaddingRect=function(){var t=0,e=0,i=0,r=0,n=0;if(F.width=F.height=0,R&&(t=e=i=r=n=R.width,F.width=F.height=2*n),B){var s=B.blur+n;i=Math.max(i,-B._offset.x+s),r=Math.max(r,B._offset.x+s),t=Math.max(t,B._offset.y+s),e=Math.max(e,-B._offset.y+s)}if(G){var o=T*Math.tan(.20943951);r+=o,F.width+=o}k.x=i,k.y=t,k.width=i+r,k.height=t+e},n._updateProperties=function(t){var e=t._assemblerData;m=e.context,g=e.canvas,y=t._frame._original?t._frame._original._texture:t._frame._texture,b=t.string.toString(),x=t._fontSize,T=x,Y=t.underlineHeight||T/8,I=t.overflow,S.width=t.node.width,S.height=t.node.height,V=t.node.getContentSize(),w=t._lineHeight,A=t.horizontalAlign,E=t.verticalAlign,D=t.node.color,j=t.enableBold,G=t.enableItalic,U=t.enableUnderline,L=f(t),M=t.srcBlendFactor===cc.macro.BlendFactor.ONE,P=I!==d.NONE&&(I===d.RESIZE_HEIGHT||t.enableWrapText),(R=(R=h&&t.getComponent(h))&&R.enabled&&R.width>0?R:null)&&O.set(R.color),(B=(B=u&&t.getComponent(u))&&B.enabled?B:null)&&(N.set(B.color),N.a=N.a*t.node.color.a/255),this._updatePaddingRect()},n._calculateFillTextStartPosition=function(){var t=0;A===l.TextAlignment.RIGHT?t=S.width-k.width:A===l.TextAlignment.CENTER&&(t=(S.width-k.width)/2);var e=this._getLineHeight()*(C.length-1),i=x*(1-a.BASELINE_RATIO/2);if(E!==l.VerticalTextAlignment.TOP){var r=e+k.height+x-S.height;E===l.VerticalTextAlignment.BOTTOM?i-=r+=a.BASELINE_RATIO/2*x:i-=r/2}return i+=a.BASELINE_OFFSET*x,cc.v2(t+k.x,i+k.y)},n._setupOutline=function(){m.strokeStyle="rgba("+O.r+", "+O.g+", "+O.b+", "+O.a/255+")",m.lineWidth=2*R.width},n._setupShadow=function(){m.shadowColor="rgba("+N.r+", "+N.g+", "+N.b+", "+N.a/255+")",m.shadowBlur=B.blur,m.shadowOffsetX=B.offset.x,m.shadowOffsetY=-B.offset.y},n._drawTextEffect=function(t,e){if(B||R||U){var i=C.length>1&&B,r=this._measureText(m,v),n=0,s=0;B&&this._setupShadow(),R&&this._setupOutline();for(var o=0;o<C.length;++o)n=t.x,s=t.y+o*e,i&&(R&&m.strokeText(C[o],n,s),m.fillText(C[o],n,s)),U&&(X=r(C[o]),A===l.TextAlignment.RIGHT?H.x=t.x-X:A===l.TextAlignment.CENTER?H.x=t.x-X/2:H.x=t.x,H.y=s+T/8,m.fillRect(H.x,H.y,X,Y));i&&(m.shadowColor="transparent")}},n._updateTexture=function(){if(m.clearRect(0,0,g.width,g.height),m.lineJoin="round",M)m.fillStyle="rgba("+D.r+", "+D.g+", "+D.b+", "+D.a/255+")";else{var t=R?O:D;m.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+_+")",m.fillRect(0,0,g.width,g.height),m.fillStyle="rgba("+D.r+", "+D.g+", "+D.b+", 1)"}var e=this._calculateFillTextStartPosition(),i=this._getLineHeight(),r=e.x,n=0;this._drawTextEffect(e,i);for(var s=0;s<C.length;++s)n=e.y+s*i,R&&m.strokeText(C[s],r,n),m.fillText(C[s],r,n);B&&(m.shadowColor="transparent"),y.handleLoadedTexture()},n._calDynamicAtlas=function(t){if(t.cacheMode===c.CacheMode.BITMAP){var e=t._frame;p(t,e),e._original||e.setRect(cc.rect(0,0,g.width,g.height)),this.packToDynamicAtlas(t,e)}},n._updateLabelDimensions=function(){var t=cc.renderer.device.caps?cc.renderer.device.caps.maxTextureSize:2048;(S.width>t||S.height>t)&&cc.warn("The maximum texture size supported by the device is "+t),S.width=Math.min(S.width,t),S.height=Math.min(S.height,t);var e=!1;g.width!==S.width&&(g.width=S.width,e=!0),g.height!==S.height&&(g.height=S.height,e=!0),e&&(m.font=v),m.textAlign=z[A]},n._getFontDesc=function(){var t=x.toString()+"px ";return t+=L,j&&(t="bold "+t),G&&(t="italic "+t),t},n._getLineHeight=function(){return 0|(0===w?x:w*x/T)},n._calculateParagraphLength=function(t,e){for(var i=[],r=0;r<t.length;++r){var n=a.safeMeasureText(e,t[r],v);i.push(n)}return i},n._measureText=function(t,e){return function(i){return a.safeMeasureText(t,i,e)}},n._calculateShrinkFont=function(t){var e=this._calculateParagraphLength(t,m),i=0,r=0,n=0;if(P){var s=V.width,o=V.height;if(s<0||o<0)return;r=o+1;for(var l=0,c=0|x+1,h=0;l<c;){if((h=l+c+1>>1)<=0){cc.logID(4003);break}x=h,v=this._getFontDesc(),m.font=v;var u=this._getLineHeight();for(r=0,i=0;i<t.length;++i){var d=a.safeMeasureText(m,t[i],v);r+=a.fragmentText(t[i],d,s,this._measureText(m,v)).length*u}r>o?c=h-1:l=h}0===l?cc.logID(4003):(x=l,v=this._getFontDesc(),m.font=v)}else{for(r=t.length*this._getLineHeight(),i=0;i<t.length;++i)n<e[i]&&(n=e[i]);var p=(S.width-k.width)/n,f=S.height/r;x=T*Math.min(1,p,f)|0,v=this._getFontDesc(),m.font=v}},n._calculateWrapText=function(t){if(P){C=[];for(var e=V.width,i=0;i<t.length;++i){var r=a.safeMeasureText(m,t[i],v),n=a.fragmentText(t[i],r,e,this._measureText(m,v));C=C.concat(n)}}},n._calculateLabelFont=function(){var t=b.split("\n");switch(C=t,v=this._getFontDesc(),m.font=v,I){case d.NONE:for(var e=0,i=0,r=0;r<t.length;++r){var n=a.safeMeasureText(m,t[r],v);e=e>n?e:n}i=(C.length+a.BASELINE_RATIO)*this._getLineHeight();var s=parseFloat(e.toFixed(2)),o=parseFloat(i.toFixed(2));S.width=s+k.width,S.height=o+k.height,V.width=s+F.width,V.height=o+F.height;break;case d.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case d.CLAMP:this._calculateWrapText(t);break;case d.RESIZE_HEIGHT:this._calculateWrapText(t);var l=(C.length+a.BASELINE_RATIO)*this._getLineHeight();S.height=l+k.height,V.height=l+F.height}},r}(n.default);i.default=W,e.exports=i.default},{"../../../components/CCLabel":108,"../../../components/CCLabelOutline":109,"../../../components/CCLabelShadow":110,"../../../platform/CCMacro":201,"../../../utils/text-utils":278,"../../assembler-2d":222,"../utils":235}],235:[function(t,e){var i=t("./dynamic-atlas/manager"),r=cc.Color.WHITE,n={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:r,isOutlined:!1,out:r,margin:0};e.exports={deleteFromDynamicAtlas:function(t,e){e&&e._original&&i&&(i.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame())},getFontFamily:function(t){return t.useSystemFont?t.fontFamily||"Arial":t.font?t.font._nativeAsset?t.font._nativeAsset:(cc.assetManager.postLoadNative(t.font,(function(){t.isValid&&t.setVertsDirty()})),"Arial"):"Arial"},shareLabelInfo:n}},{"./dynamic-atlas/manager":230}],236:[function(t,e){function i(t,e,i){i=i||2;var n,o,a,l,c,u,d,p=e&&e.length,f=p?e[0]*i:t.length,_=r(t,0,f,i,!0),m=[];if(!_)return m;if(p&&(_=h(t,e,_,i)),t.length>80*i){n=a=t[0],o=l=t[1];for(var g=i;g<f;g+=i)(c=t[g])<n&&(n=c),(u=t[g+1])<o&&(o=u),c>a&&(a=c),u>l&&(l=u);d=Math.max(a-n,l-o)}return s(_,m,i,n,o,d),m}function r(t,e,i,r,n){var s,o;if(n===A(t,e,i,r)>0)for(s=e;s<i;s+=r)o=C(s,t[s],t[s+1],o);else for(s=i-r;s>=e;s-=r)o=C(s,t[s],t[s+1],o);return o&&v(o,o.next)&&(S(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)return null;i=!0}}while(i||r!==e);return e}function s(t,e,i,r,h,u,d){if(t){!d&&u&&p(t,r,h,u);for(var f,_,m=t;t.prev!==t.next;)if(f=t.prev,_=t.next,u?a(t,r,h,u):o(t))e.push(f.i/i),e.push(t.i/i),e.push(_.i/i),S(t),t=_.next,m=_.next;else if((t=_)===m){d?1===d?s(t=l(t,e,i),e,i,r,h,u,2):2===d&&c(t,e,i,r,h,u):s(n(t),e,i,r,h,u,1);break}}}function o(t){var e=t.prev,i=t,r=t.next;if(y(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(m(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&y(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(t,e,i,r){var n=t.prev,s=t,o=t.next;if(y(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,h=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,u=f(a,l,e,i,r),d=f(c,h,e,i,r),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function l(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!v(n,s)&&b(n,r,r.next,s)&&x(n,s)&&x(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),S(r),S(r.next),r=t=s),r=r.next}while(r!==t);return r}function c(t,e,i,r,o,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var h=T(l,c);return l=n(l,l.next),h=n(h,h.next),s(l,e,i,r,o,a),void s(h,e,i,r,o,a)}c=c.next}l=l.next}while(l!==t)}function h(t,e,i,s){var o,a,l,c=[];for(o=0,a=e.length;o<a;o++)(l=r(t,e[o]*s,o<a-1?e[o+1]*s:t.length,s,!1))===l.next&&(l.steiner=!0),c.push(_(l));for(c.sort(u),o=0;o<c.length;o++)d(c[o],i),i=n(i,i.next);return i}function u(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var i,r=e,n=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===o)return i.prev;var l,c=i,h=i.x,u=i.y,d=1/0;for(r=i.next;r!==c;)n>=r.x&&r.x>=h&&m(s<u?n:o,s,h,u,s<u?o:n,s,r.x,r.y)&&((l=Math.abs(s-r.y)/(n-r.x))<d||l===d&&r.x>i.x)&&x(r,t)&&(i=r,d=l),r=r.next;return i}(t,e)){var i=T(e,t);n(i,i.next)}}function p(t,e,i,r){var n=t;do{null===n.z&&(n.z=f(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0===a?(n=r,r=r.nextZ,l--):0!==l&&r?i.z<=r.z?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,a--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(o>1)}(n)}function f(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,r,n,s,o,a){return(n-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&x(t,e)&&x(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,r){return!!(v(t,e)&&v(i,r)||v(t,r)&&v(i,e))||y(t,e,i)>0!=y(t,e,r)>0&&y(i,r,t)>0!=y(i,r,e)>0}function x(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function T(t,e){var i=new w(t.i,t.x,t.y),r=new w(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function C(t,e,i,r){var n=new w(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function w(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,r){for(var n=0,s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}cc.Graphics.earcut=e.exports=i,i.deviation=function(t,e,i,r){var n=e&&e.length,s=n?e[0]*i:t.length,o=Math.abs(A(t,0,s,i));if(n)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,h=a<l-1?e[a+1]*i:t.length;o-=Math.abs(A(t,c,h,i))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},i.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[n][s][o]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}},{}],237:[function(t,e){var i=t("../../../../graphics/helper"),r=t("../../../../graphics/types").PointFlags,n=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(){this.reset()},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}});function s(){this.reset()}function o(){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[]}cc.js.mixin(s.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]}}),cc.js.mixin(o.prototype,{moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,r.PT_CORNER),this._commandx=t,this._commandy=e},lineTo:function(t,e){this._addPoint(t,e,r.PT_CORNER),this._commandx=t,this._commandy=e},bezierCurveTo:function(t,e,n,s,o,a){var l=this._curPath,c=l.points[l.points.length-1];c.x!==t||c.y!==e||n!==o||s!==a?(i.tesselateBezier(this,c.x,c.y,t,e,n,s,o,a,0,r.PT_CORNER),this._commandx=o,this._commandy=a):this.lineTo(o,a)},quadraticCurveTo:function(t,e,i,r){var n=this._commandx,s=this._commandy;this.bezierCurveTo(n+2/3*(t-n),s+2/3*(e-s),i+2/3*(t-i),r+2/3*(e-r),i,r)},arc:function(t,e,r,n,s,o){i.arc(this,t,e,r,n,s,o)},ellipse:function(t,e,r,n){i.ellipse(this,t,e,r,n),this._curPath.complex=!1},circle:function(t,e,r){i.ellipse(this,t,e,r,r),this._curPath.complex=!1},rect:function(t,e,i,r){this.moveTo(t,e),this.lineTo(t,e+r),this.lineTo(t+i,e+r),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},roundRect:function(t,e,r,n,s){i.roundRect(this,t,e,r,n,s),this._curPath.complex=!1},clear:function(t){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t&&(this._paths.length=0,this._points.length=0)},close:function(){this._curPath.closed=!0},_addPath:function(){var t=this._pathLength,e=this._paths[t];return e?e.reset():(e=new s,this._paths.push(e)),this._pathLength++,this._curPath=e,e},_addPoint:function(t,e,i){var r=this._curPath;if(r){var s,o=this._points,a=r.points;(s=o[this._pointsOffset++])?(s.x=t,s.y=e):(s=new n(t,e),o.push(s)),s.flags=i,a.push(s)}}}),cc.Graphics._Impl=o,e.exports=o},{"../../../../graphics/helper":160,"../../../../graphics/types":162}],238:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("../../../assembler")),n=s(t("../../../../../renderer/core/input-assembler"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a=t("../../mesh-buffer"),l=t("../../../index"),c=t("../../../../graphics/graphics"),h=t("../../../../graphics/types").PointFlags,u=c.LineJoin,d=c.LineCap,p=t("./earcut");t("./impl");var f=Math.PI,_=Math.min,m=Math.max,g=Math.ceil,y=Math.acos,v=Math.cos,b=Math.sin,x=Math.atan2;function T(t,e,i){return t<e?e:t>i?i:t}var C=cc.gfx,S=new C.VertexFormat([{name:C.ATTR_POSITION,type:C.ATTR_TYPE_FLOAT32,num:2},{name:C.ATTR_COLOR,type:C.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_dist",type:C.ATTR_TYPE_FLOAT32,num:1}]);S.name="vfmtPosColorSdf";var w=function(t){var e,i;function r(e){var i;return(i=t.call(this,e)||this)._buffer=null,i._buffers=[],i._bufferOffset=0,i}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var s=r.prototype;return s.getVfmt=function(){return S},s.getVfmtFloatCount=function(){return 4},s.requestBuffer=function(){var t={indiceStart:0,vertexStart:0},e=new a(l._handle,this.getVfmt());t.meshbuffer=e;var i=new n.default(e._vb,e._ib);return t.ia=i,this._buffers.push(t),t},s.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers},s.clear=function(t){this._bufferOffset=0;var e=this._buffers;if(t){for(var i=0,r=e.length;i<r;i++){var n=e[i];n.meshbuffer.destroy(),n.meshbuffer=null}e.length=0}else for(var s=0,o=e.length;s<o;s++){var a=e[s];a.indiceStart=0,a.vertexStart=0,a.meshbuffer.reset()}},s.fillBuffers=function(t,e){e._flush(),e.node=t.node,e.material=t._materials[0];for(var i=this.getBuffers(),r=0,n=i.length;r<n;r++){var s=i[r],o=s.meshbuffer;s.ia._count=s.indiceStart,e._flushIA(s.ia),o.uploadData()}},s.genBuffer=function(t,e){var i=this.getBuffers(),r=i[this._bufferOffset],n=r.meshbuffer,s=r.vertexStart+e;return(s>65535||3*s>131070)&&(++this._bufferOffset,s=e,this._bufferOffset<i.length?r=i[this._bufferOffset]:(r=this.requestBuffer(t),i[this._bufferOffset]=r),n=r.meshbuffer),s>n.vertexOffset&&n.requestStatic(e,3*e),this._buffer=r,r},s.stroke=function(t){this._curColor=t._strokeColor._val,this._flattenPaths(t._impl),this._expandStroke(t),t._impl._updatePathOffset=!0},s.fill=function(t){this._curColor=t._fillColor._val,this._expandFill(t),t._impl._updatePathOffset=!0},s._expandStroke=function(t){var e,i,r,n,s=.5*t.lineWidth,o=t.lineCap,a=t.lineJoin,l=t.miterLimit,c=t._impl,p=(e=s,i=f,r=c._tessTol,n=2*y(e/(e+r)),m(2,g(i/n)));this._calculateJoins(c,s,a,l);for(var _=c._paths,v=0,b=c._pathOffset,x=c._pathLength;b<x;b++){var T=_[b],C=T.points.length;a===u.ROUND?v+=2*(C+T.nbevel*(p+2)+1):v+=2*(C+5*T.nbevel+1),T.closed||(o===d.ROUND?v+=2*(2*p+2):v+=12)}for(var S=this.genBuffer(t,v),w=S.meshbuffer,A=w._vData,E=w._iData,D=c._pathOffset,L=c._pathLength;D<L;D++){var I,P=_[D],M=P.points,R=M.length,O=S.vertexStart,B=void 0,N=void 0,k=void 0,F=void 0;if((I=P.closed)?(B=M[R-1],N=M[0],k=0,F=R):(B=M[0],N=M[1],k=1,F=R-1),N=N||B,!I){var V=N.sub(B);V.normalizeSelf();var j=V.x,G=V.y;o===d.BUTT?this._buttCapStart(B,j,G,s,0):o===d.SQUARE?this._buttCapStart(B,j,G,s,s):o===d.ROUND&&this._roundCapStart(B,j,G,s,p)}for(var U=k;U<F;++U)a===u.ROUND?this._roundJoin(B,N,s,s,p):N.flags&(h.PT_BEVEL|h.PT_INNERBEVEL)?this._bevelJoin(B,N,s,s):(this._vset(N.x+N.dmx*s,N.y+N.dmy*s,1),this._vset(N.x-N.dmx*s,N.y-N.dmy*s,-1)),B=N,N=M[U+1];if(I){var Y=this.getVfmtFloatCount(),H=O*Y;this._vset(A[H],A[H+1],1),this._vset(A[H+Y],A[H+Y+1],-1)}else{var X=N.sub(B);X.normalizeSelf();var z=X.x,W=X.y;o===d.BUTT?this._buttCapEnd(N,z,W,s,0):o===d.SQUARE?this._buttCapEnd(N,z,W,s,s):o===d.ROUND&&this._roundCapEnd(N,z,W,s,p)}for(var Z=S.indiceStart,J=O+2,q=S.vertexStart;J<q;J++)E[Z++]=J-2,E[Z++]=J-1,E[Z++]=J;S.indiceStart=Z}},s._expandFill=function(t){for(var e=t._impl,i=e._paths,r=0,n=e._pathOffset,s=e._pathLength;n<s;n++)r+=i[n].points.length;for(var o=this.genBuffer(t,r),a=o.meshbuffer,l=a._vData,c=a._iData,h=e._pathOffset,u=e._pathLength;h<u;h++){var d=i[h],f=d.points,_=f.length;if(0!==_){for(var m=o.vertexStart,g=0;g<_;++g)this._vset(f[g].x,f[g].y);var y=o.indiceStart;if(d.complex){for(var v=[],b=this.getVfmtFloatCount(),x=m,T=o.vertexStart;x<T;x++){var C=x*b;v.push(l[C]),v.push(l[C+1])}var S=p(v,null,2);if(!S||0===S.length)continue;for(var w=0,A=S.length;w<A;w++)c[y++]=S[w]+m}else for(var E=m,D=m+2,L=o.vertexStart;D<L;D++)c[y++]=E,c[y++]=D-1,c[y++]=D;o.indiceStart=y}}},s._calculateJoins=function(t,e,i,r){var n=0,s=e*e;e>0&&(n=1/e);for(var o=t._paths,a=t._pathOffset,l=t._pathLength;a<l;a++){var c=o[a],d=c.points,p=d.length,f=d[p-1],g=d[0];c.nbevel=0;for(var y=0;y<p;y++){var v,b,x=f.dy,T=-f.dx,C=g.dy,S=-g.dx;if(g.dmx=.5*(x+C),g.dmy=.5*(T+S),(v=g.dmx*g.dmx+g.dmy*g.dmy)>1e-6){var w=1/v;w>600&&(w=600),g.dmx*=w,g.dmy*=w}g.dx*f.dy-f.dx*g.dy>0&&(g.flags|=h.PT_LEFT),v*(b=m(11,_(f.len,g.len)*n))*b<1&&(g.flags|=h.PT_INNERBEVEL);var A=g.dmx*e,E=g.dmy*e,D=A*A+E*E;D>g.len*g.len+s&&D>f.len*f.len+s&&(g.flags|=h.PT_INNERBEVEL),g.flags&h.PT_CORNER&&(v*r*r<1||i===u.BEVEL||i===u.ROUND)&&(g.flags|=h.PT_BEVEL),!!(g.flags&(h.PT_BEVEL|h.PT_INNERBEVEL))&&c.nbevel++,f=g,g=d[y+1]}}},s._flattenPaths=function(t){for(var e=t._paths,i=t._pathOffset,r=t._pathLength;i<r;i++){var n=e[i],s=n.points,o=s[s.length-1],a=s[0];s.length>2&&o.equals(a)&&(n.closed=!0,s.pop(),o=s[s.length-1]);for(var l=0,c=s.length;l<c;l++){var h=a.sub(o);o.len=h.mag(),(h.x||h.y)&&h.normalizeSelf(),o.dx=h.x,o.dy=h.y,o=a,a=s[l+1]}}},s._chooseBevel=function(t,e,i,r){var n,s,o,a,l=i.x,c=i.y;return 0!==t?(n=l+e.dy*r,s=c-e.dx*r,o=l+i.dy*r,a=c-i.dx*r):(n=o=l+i.dmx*r,s=a=c+i.dmy*r),[n,s,o,a]},s._buttCapStart=function(t,e,i,r,n){var s=t.x-e*n,o=t.y-i*n,a=i,l=-e;this._vset(s+a*r,o+l*r,1),this._vset(s-a*r,o-l*r,-1)},s._buttCapEnd=function(t,e,i,r,n){var s=t.x+e*n,o=t.y+i*n,a=i,l=-e;this._vset(s+a*r,o+l*r,1),this._vset(s-a*r,o-l*r,-1)},s._roundCapStart=function(t,e,i,r,n){for(var s=t.x,o=t.y,a=i,l=-e,c=0;c<n;c++){var h=c/(n-1)*f,u=v(h)*r,d=b(h)*r;this._vset(s-a*u-e*d,o-l*u-i*d,1),this._vset(s,o,0)}this._vset(s+a*r,o+l*r,1),this._vset(s-a*r,o-l*r,-1)},s._roundCapEnd=function(t,e,i,r,n){var s=t.x,o=t.y,a=i,l=-e;this._vset(s+a*r,o+l*r,1),this._vset(s-a*r,o-l*r,-1);for(var c=0;c<n;c++){var h=c/(n-1)*f,u=v(h)*r,d=b(h)*r;this._vset(s,o,0),this._vset(s-a*u+e*d,o-l*u+i*d,1)}},s._roundJoin=function(t,e,i,r,n){var s=t.dy,o=-t.dx,a=e.dy,l=-e.dx,c=e.x,u=e.y;if(e.flags&h.PT_LEFT){var d=this._chooseBevel(e.flags&h.PT_INNERBEVEL,t,e,i),p=d[0],_=d[1],m=d[2],y=d[3],C=x(-o,-s),S=x(-l,-a);S>C&&(S-=2*f),this._vset(p,_,1),this._vset(c-s*r,e.y-o*r,-1);for(var w=T(g((C-S)/f)*n,2,n),A=0;A<w;A++){var E=C+A/(w-1)*(S-C),D=c+v(E)*r,L=u+b(E)*r;this._vset(c,u,0),this._vset(D,L,-1)}this._vset(m,y,1),this._vset(c-a*r,u-l*r,-1)}else{var I=this._chooseBevel(e.flags&h.PT_INNERBEVEL,t,e,-r),P=I[0],M=I[1],R=I[2],O=I[3],B=x(o,s),N=x(l,a);N<B&&(N+=2*f),this._vset(c+s*r,u+o*r,1),this._vset(P,M,-1);for(var k=T(g((N-B)/f)*n,2,n),F=0;F<k;F++){var V=B+F/(k-1)*(N-B),j=c+v(V)*i,G=u+b(V)*i;this._vset(j,G,1),this._vset(c,u,0)}this._vset(c+a*r,u+l*r,1),this._vset(R,O,-1)}},s._bevelJoin=function(t,e,i,r){var n,s,o,a,l,c,u,d,p=t.dy,f=-t.dx,_=e.dy,m=-e.dx;if(e.flags&h.PT_LEFT){var g=this._chooseBevel(e.flags&h.PT_INNERBEVEL,t,e,i);l=g[0],c=g[1],u=g[2],d=g[3],this._vset(l,c,1),this._vset(e.x-p*r,e.y-f*r,-1),this._vset(u,d,1),this._vset(e.x-_*r,e.y-m*r,-1)}else{var y=this._chooseBevel(e.flags&h.PT_INNERBEVEL,t,e,-r);n=y[0],s=y[1],o=y[2],a=y[3],this._vset(e.x+p*i,e.y+f*i,1),this._vset(n,s,-1),this._vset(e.x+_*i,e.y+m*i,1),this._vset(o,a,-1)}},s._vset=function(t,e,i){void 0===i&&(i=0);var r=this._buffer,n=r.meshbuffer,s=r.vertexStart*this.getVfmtFloatCount(),o=n._vData,a=n._uintVData;o[s]=t,o[s+1]=e,a[s+2]=this._curColor,o[s+3]=i,r.vertexStart++,n._dirty=!0},r}(r.default);i.default=w,r.default.register(cc.Graphics,w),e.exports=i.default},{"../../../../../renderer/core/input-assembler":309,"../../../../graphics/graphics":159,"../../../../graphics/types":162,"../../../assembler":224,"../../../index":227,"../../mesh-buffer":255,"./earcut":236,"./impl":237}],239:[function(t){cc.assemblers={},t("./sprite"),t("./mask-assembler"),t("./graphics"),t("./label"),t("./motion-streak")},{"./graphics":238,"./label":244,"./mask-assembler":245,"./motion-streak":246,"./sprite":253}],240:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../../utils/label/bmfont"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=0,a=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},n._reserveQuads=function(t,e){var i=4*e,r=6*e,n=this._renderData._flexBuffer;n.reserve(i,r),n.used(i,r);for(var s=this._renderData.iDatas[0],a=0,l=0,c=r;a<c;a+=6,l+=4)s[a]=l,s[a+1]=l+1,s[a+2]=l+2,s[a+3]=l+1,s[a+4]=l+3,s[a+5]=l+2;o=0},n._quadsUpdated=function(){o=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},n._getColor=function(t){return t.node._color._val},n.appendQuad=function(t,e,i,r,n,s,a){var l=this._renderData,c=l.vDatas[0],h=l.uintVDatas[0];this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3;var u,d,p,f,_=e.width,m=e.height,g=i.width,y=i.height,v=this._getColor(t),b=this.floatsPerVert,x=o+this.uvOffset;r?(u=i.x/_,p=(i.x+y)/_,d=(i.y+g)/m,f=i.y/m,c[x]=u,c[x+1]=f,c[x+=b]=u,c[x+1]=d,c[x+=b]=p,c[x+1]=f,c[x+=b]=p,c[x+1]=d):(u=i.x/_,p=(i.x+g)/_,d=(i.y+y)/m,f=i.y/m,c[x]=u,c[x+1]=d,c[x+=b]=p,c[x+1]=d,c[x+=b]=u,c[x+1]=f,c[x+=b]=p,c[x+1]=f),u=n,p=n+g*a,d=s-y*a,f=s,this.appendVerts(t,o,u,p,d,f);for(var T=o+this.colorOffset,C=0;C<4;C++)h[T]=v,T+=b;o+=4*this.floatsPerVert},n.appendVerts=function(t,e,i,r,n,s){var o=this._local,a=this.floatsPerVert;o[e]=i,o[e+1]=n,o[e+=a]=r,o[e+1]=n,o[e+=a]=i,o[e+1]=s,o[e+=a]=r,o[e+1]=s},n.updateWorldVerts=function(t){for(var e=t.node._worldMatrix.m,i=e[0],r=e[1],n=e[4],s=e[5],o=e[12],a=e[13],l=this._local,c=this._renderData.vDatas[0],h=this.floatsPerVert,u=0;u<l.length;u+=h){var d=l[u],p=l[u+1];c[u]=d*i+p*n+o,c[u+1]=d*r+p*s+a}},r}(n.default);i.default=a,e.exports=i.default},{"../../../../utils/label/bmfont":231}],241:[function(t,e,i){function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0,t("../../../../../platform/js"),t("./bmfont");var n=t("../../../../utils/label/letter-font"),s=cc.color(255,255,255,255),o=function(t){var e,i;function n(){return t.apply(this,arguments)||this}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,r(e,i);var o=n.prototype;return o.createData=function(t){return t.requestRenderData()},o._getColor=function(t){return s._fastSetA(t.node._color.a),s._val},o.updateColor=function(e){var i=this._getColor(e);t.prototype.updateColor.call(this,e,i)},n}(n);i.default=o,e.exports=i.default},{"../../../../../platform/js":217,"../../../../utils/label/letter-font":233,"./bmfont":240}],242:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../../../assets/material/material-variant"))&&r.__esModule?r:{default:r};t("../../../../../components/CCLabel"),t("../../../../../components/CCLabelShadow"),t("../../../../../components/CCLabelOutline"),t("../../../../../assets/material/CCMaterial");var s=function(){function t(){}var e=t.prototype;return e.init=function(t){this.labelMaterial=null,this._label=this._renderComp=t,renderer.CustomAssembler.prototype.ctor.call(this),t.node._proxy.setAssembler(this),this._layout=new jsb.LabelRenderer,this._layout.init(t),this._cfg=new DataView(this._layout._cfg),this._layoutInfo=new DataView(this._layout._layout),this._cfgFields="string"==typeof jsb.LabelRenderer._cfgFields?JSON.parse(jsb.LabelRenderer._cfgFields):jsb.LabelRenderer._cfgFields,this._layoutFields="string"==typeof jsb.LabelRenderer._layoutFields?JSON.parse(jsb.LabelRenderer._layoutFields):jsb.LabelRenderer._layoutFields,this._layout.bindNodeProxy(t.node._proxy),this._bindMaterial(t)},e._setBufferFlag=function(t,e,i,r,n){if("int8"==r&&1==i){var s=t.getInt8(e);t.setInt8(e,n|s)}else if("int32"==r&&4==i){var o=t.getInt32(e,jsb.__isLittleEndian__);t.setInt32(e,n|o,jsb.__isLittleEndian__)}else cc.warn("flag storage type should be int8/int32 only, type/size -> "+r+"/"+i+".")},e._updateCfgFlag=function(t){var e=this._cfgFields.updateFlags;this._setBufferFlag(this._cfg,e.offset,e.size,e.type,t)},e._setBufferValue=function(t,e,i,r,n){"float"==r&&4==i?t.setFloat32(e,n,jsb.__isLittleEndian__):"int32"==r&&4==i?t.setInt32(e,n,jsb.__isLittleEndian__):"bool"==r&&1==i?t.setInt8(e,n?1:0,jsb.__isLittleEndian__):"Color4B"==r&&4==i?(t.setUint8(e,n.r),t.setUint8(e+1,n.g),t.setUint8(e+2,n.b),t.setUint8(e+3,n.a)):"int8"==r&&1==i?t.setUint8(e,n):cc.warn("dont know how to set value to buffer, type/size -> "+r+"/"+i+".")},e._setFieldValue=function(t,e,i,r){var n=e[i];this._setBufferValue(t,n.offset,n.size,n.type,r)},e._getBufferValue=function(t,e,i,r){return"float"==r&&4==i?t.getFloat32(e,jsb.__isLittleEndian__):"int32"==r&&4==i?t.getInt32(e,jsb.__isLittleEndian__):"bool"==r&&1==i?0!=t.getInt8(e,jsb.__isLittleEndian__):"Color4B"==r&&4==i?{r:t.getUint8(e),g:t.getUint8(e+1),b:t.getUint8(e+2),a:t.getUint8(e+3)}:"int8"==r&&1==i?t.getUint8(e):void cc.warn("dont know how to get value from buffer, type/size -> "+r+"/"+i+".")},e._getFieldValue=function(t,e,i){var r=e[i];return this._getBufferValue(t,r.offset,r.size,r.type)},e._getLayoutValue=function(t){return this._getFieldValue(this._layoutInfo,this._layoutFields,t)},e._setLayoutValue=function(t,e){return this._setFieldValue(this._layoutInfo,this._layoutFields,t,e)},e._updateCfgFlag_Content=function(){this._updateCfgFlag(1)},e._updateCfgFlag_Font=function(){this._updateCfgFlag(2)},e._colorEqual=function(t,e){return t.r==e.r&&t.g==e.g&&t.b==e.b&&t.a==e.a},e._colorToObj=function(t,e,i,r){return{r:t,g:e,b:i,a:r}},e.setString=function(t){t!=this._layout.string&&(this._layout.string=t,this._updateCfgFlag_Content())},e.setFontPath=function(t){t!=this._layout.fontPath&&(this._layout.fontPath=t,this._updateCfgFlag_Font())},e.setFontSize=function(t,e){this._getFieldValue(this._cfg,this._cfgFields,"fontSize")!=t&&(this._setFieldValue(this._cfg,this._cfgFields,"fontSize",t),this._setFieldValue(this._cfg,this._cfgFields,"fontSizeRetina",e),this._updateCfgFlag_Font())},e.setOutline=function(t){var e=this._getLayoutValue("outlineSize");e>0!=t>0&&this._updateCfgFlag_Font(),e!=t&&(this._updateCfgFlag_Content(),this._setLayoutValue("outlineSize",t))},e.setOutlineColor=function(t){var e=this._getLayoutValue("outlineColor");this._colorEqual(e,t)||(this._setLayoutValue("outlineColor",t),this._updateCfgFlag_Content())},e.setLineHeight=function(t){this._getLayoutValue("lineHeight")!=t&&(this._setLayoutValue("lineHeight",t),this._updateCfgFlag_Content())},e.setOverFlow=function(t){this._getLayoutValue("overflow")!=t&&(this._setLayoutValue("overflow",t),this._updateCfgFlag_Content())},e.setEnableWrap=function(t){this._getLayoutValue("wrap")!=t&&(this._setLayoutValue("wrap",t),this._updateCfgFlag_Content())},e.setVerticalAlign=function(t){this._getLayoutValue("valign")!=t&&(this._setLayoutValue("valign",t),this._updateCfgFlag_Content())},e.setHorizontalAlign=function(t){this._getLayoutValue("halign")!=t&&(this._setLayoutValue("halign",t),this._updateCfgFlag_Content())},e.setContentSize=function(t,e){var i=this._getLayoutValue("width"),r=this._getLayoutValue("height");i==t&&r==e||(this._setLayoutValue("height",e),this._setLayoutValue("width",t),this._updateCfgFlag_Content())},e.setAnchorPoint=function(t,e){var i=this._getLayoutValue("anchorX"),r=this._getLayoutValue("anchorY");i==t&&r==e||(this._setLayoutValue("anchorX",t),this._setLayoutValue("anchorY",e),this._updateCfgFlag_Content())},e.setColor=function(t){var e=this._getLayoutValue("color");this._colorEqual(e,t)||(this._setLayoutValue("color",t),this._updateCfgFlag_Content())},e.setShadow=function(t,e,i){var r=this._getLayoutValue("shadowBlur"),n=this._getLayoutValue("shadowX"),s=this._getLayoutValue("shadowY");r>0!=i>0&&this._updateCfgFlag_Font();var o=!1;r!=i&&(this._setLayoutValue("shadowBlur",i),o=!0),n!=t&&(this._setLayoutValue("shadowX",t),o=!0),s!=e&&(this._setLayoutValue("shadowY",e),o=!0),o&&this._updateCfgFlag_Content()},e.setShadowColor=function(t){var e=this._getLayoutValue("shadowColor");this._colorEqual(e,t)||(this._setLayoutValue("shadowColor",t),this._updateCfgFlag_Content())},e.setItalic=function(t){this._getLayoutValue("italic")!=t&&(this._setLayoutValue("italic",t),this._updateCfgFlag_Content())},e.setBold=function(t){this._getLayoutValue("bold")!=t&&(this._setLayoutValue("bold",t),this._updateCfgFlag_Content(),this._updateCfgFlag_Font())},e.setUnderline=function(t){this._getLayoutValue("underline")!=t&&(this._setLayoutValue("underline",t),this._updateCfgFlag_Content())},e.setSpacingX=function(t){this._getLayoutValue("spaceX")==t||"number"!=typeof t||isNaN(t)||(this._setLayoutValue("spaceX",t),this._updateCfgFlag_Content())},e.updateRenderData=function(t){if(t._vertsDirty){t.font&&t.font.nativeUrl&&this.setFontPath(cc.assetManager.cacheManager.getCache(t.font.nativeUrl)||t.font.nativeUrl);var e=this._layout,i=t.node.color,r=t.node,n=t.fontSize;this.setString(t.string),this.setFontSize(t.fontSize,n/72*t.fontSize),this.setLineHeight(t.lineHeight),this.setEnableWrap(t.enableWrapText),this.setItalic(t.enableItalic),this.setUnderline(t.enableUnderline),this.setBold(t.enableBold),this.setOverFlow(t.overflow),this.setVerticalAlign(t.verticalAlign),this.setHorizontalAlign(t.horizontalAlign),this.setSpacingX(t.spacingX),this.setContentSize(r.getContentSize().width,r.getContentSize().height),this.setAnchorPoint(r.anchorX,r.anchorY),this.setColor(this._colorToObj(i.getR(),i.getG(),i.getB(),Math.ceil(i.getA()*r.opacity/255)));var s=r.getComponent(cc.LabelShadow);if(s&&s.enabled){var o=s.color;this.setShadow(s.offset.x,s.offset.y,s.blur),this.setShadowColor(this._colorToObj(o.getR(),o.getG(),o.getB(),Math.ceil(o.getA()*r.opacity/255)))}else this.setShadow(0,0,-1);this._updateTTFMaterial(t),e.render()}},e._bindMaterial=function(t){var e=this.labelMaterial;return e||(e=n.default.createWithBuiltin("2d-label",t),this.labelMaterial=e),e},e._updateTTFMaterial=function(t){var e=this._bindMaterial(t),i=this._label.node,r=this._layout,n=i.getComponent(cc.LabelOutline),s=0;if(n&&n.enabled&&n.width>0){s=Math.max(Math.min(n.width/10,.4),.1);var o=n.color;this.setOutlineColor(this._colorToObj(o.getR(),o.getG(),o.getB(),Math.ceil(o.getA()*i.opacity/255)))}this.setOutline(s),e.define("CC_USE_MODEL",!0),e.define("USE_TEXTURE_ALPHAONLY",!0),e.define("USE_SDF",s>0||t.enableBold),e.define("USE_SDF_EXTEND",t.enableBold?1:0),void 0!==e.getDefine("CC_SUPPORT_standard_derivatives")&&cc.sys.glExtension("OES_standard_derivatives")&&e.define("CC_SUPPORT_standard_derivatives",!0),r.setEffect(e.effect._nativeObj)},e.fillBuffers=function(){this._layout.render()},e.getVfmt=function(){},t}();i.default=s,e.exports=i.default},{"../../../../../assets/material/CCMaterial":81,"../../../../../assets/material/material-variant":88,"../../../../../components/CCLabel":108,"../../../../../components/CCLabelOutline":109,"../../../../../components/CCLabelShadow":110}],243:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../../utils/label/ttf"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("../../../../../components/CCLabelShadow"),a=cc.color(255,255,255,255),l=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t._frame.uv,r=this.uvOffset,n=this.floatsPerVert,s=0;s<4;s++){var o=2*s,a=n*s+r;e[a]=i[o],e[a+1]=i[o+1]}},n.updateColor=function(e){a._fastSetA(e.node._color.a);var i=a._val;t.prototype.updateColor.call(this,e,i)},n.updateVerts=function(t){var e=t.node,i=t._ttfTexture.width,r=t._ttfTexture.height,n=e.anchorX*e.width,s=e.anchorY*e.height,a=o&&t.getComponent(o);if(a&&a._enabled){var l=(i-e.width)/2,c=(r-e.height)/2,h=a.offset;-h.x>l?n+=i-e.width:l>h.x&&(n+=l-h.x),-h.y>c?s+=r-e.height:c>h.y&&(s+=c-h.y)}var u=this._local;u[0]=-n,u[1]=-s,u[2]=i-n,u[3]=r-s,this.updateUVs(t),this.updateWorldVerts(t)},r}(n.default);i.default=l,e.exports=i.default},{"../../../../../components/CCLabelShadow":110,"../../../../utils/label/ttf":234}],244:[function(t){var e=c(t("../../../assembler")),i=c(t("../../../../components/CCLabel")),r=c(t("./2d/ttf")),n=c(t("./2d/bmfont")),s=c(t("./2d/letter")),o=c(t("./3d/ttf")),a=c(t("./3d/bmfont")),l=c(t("./3d/letter"));function c(t){return t&&t.__esModule?t:{default:t}}i.default._canvasPool={pool:[],get:function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i},i.textBaseline="alphabetic"}return t},put:function(t){this.pool.length>=32||this.pool.push(t)}},e.default.register(cc.Label,{getConstructor:function(t){var e=t.node.is3DNode,c=e?o.default:r.default;return t.font instanceof cc.BitmapFont?c=e?a.default:n.default:t.cacheMode===i.default.CacheMode.CHAR&&(cc.sys.platform===cc.sys.WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):c=e?l.default:s.default),c},TTF:r.default,Bmfont:n.default,Letter:s.default,TTF3D:o.default,Bmfont3D:a.default,Letter3D:l.default,NativeTTF:void 0})},{"../../../../components/CCLabel":108,"../../../assembler":224,"./2d/bmfont":240,"./2d/letter":241,"./2d/nativeTTF":242,"./2d/ttf":243,"./3d/bmfont":void 0,"./3d/letter":void 0,"./3d/ttf":void 0}],245:[function(t,e,i){i.__esModule=!0,i.MaskAssembler=void 0;var r,n=(r=t("../../assembler"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("../../../components/CCMask"),a=t("../../render-flow"),l=t("./sprite/2d/simple"),c=t("./graphics"),h=t("../../../../renderer/gfx"),u=t("../vertex-format").vfmtPos,d=[];function p(){return 1<<d.length-1}function f(t,e,i,r,n,s){var o=t.effect,a=h.STENCIL_OP_KEEP,l=h.STENCIL_OP_KEEP;o.setStencil(h.STENCIL_ENABLE,e,r,n,i,a,l,s)}function _(t){var e=h.DS_FUNC_EQUAL,i=h.STENCIL_OP_KEEP,r=function(){for(var t=0,e=0;e<d.length;++e)t+=1<<e;return t}(),n=r,s=p(),o=d[d.length-1];f(o._enableMaterial,e,i,r,n,s),t._flushMaterial(o._enableMaterial)}var m=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.updateRenderData=function(t){t._type===o.Type.IMAGE_STENCIL?t.spriteFrame?l.prototype.updateRenderData.call(this,t):t.setMaterial(0,null):(t._graphics.setMaterial(0,t._materials[0]),c.prototype.updateRenderData.call(t._graphics._assembler,t._graphics,t._graphics))},n.fillBuffers=function(t,e){(t._type!==o.Type.IMAGE_STENCIL||t.spriteFrame)&&(function(t){d.length+1>8&&cc.errorID(9e3,8),d.push(t)}(t),function(t,e){var i=h.DS_FUNC_NEVER,r=p(),n=r,s=r,o=t.inverted?h.STENCIL_OP_REPLACE:h.STENCIL_OP_ZERO;f(t._clearMaterial,i,o,r,n,s);var a=e.getBuffer("mesh",u),l=a.request(4,6),c=l.indiceOffset,d=l.byteOffset>>2,_=l.vertexOffset,m=a._vData,g=a._iData;m[d++]=-1,m[d++]=-1,m[d++]=-1,m[d++]=1,m[d++]=1,m[d++]=1,m[d++]=1,m[d++]=-1,g[c++]=_,g[c++]=_+3,g[c++]=_+1,g[c++]=_+1,g[c++]=_+3,g[c++]=_+2,e.node=e._dummyNode,e.material=t._clearMaterial,e._flush()}(t,e),function(t,e){var i=h.DS_FUNC_NEVER,r=p(),n=r,s=r,a=t.inverted?h.STENCIL_OP_ZERO:h.STENCIL_OP_REPLACE;f(t._materials[0],i,a,r,n,s),e.material=t._materials[0],t._type===o.Type.IMAGE_STENCIL?(e.node=e._dummyNode,l.prototype.fillBuffers.call(t._assembler,t,e),e._flush()):(e.node=t.node,c.prototype.fillBuffers.call(t._graphics._assembler,t._graphics,e))}(t,e),_(e)),t.node._renderFlag|=a.FLAG_UPDATE_RENDER_DATA},n.postFillBuffers=function(t,e){(t._type!==o.Type.IMAGE_STENCIL||t.spriteFrame)&&function(t,e){0===d.length&&cc.errorID(9001),d.pop(),0===d.length?e._flushMaterial(t._exitMaterial):_(e)}(t,e),t.node._renderFlag|=a.FLAG_UPDATE_RENDER_DATA},r}(l);i.MaskAssembler=m,n.default.register(o,m)},{"../../../../renderer/gfx":319,"../../../components/CCMask":112,"../../assembler":224,"../../render-flow":228,"../vertex-format":260,"./graphics":238,"./sprite/2d/simple":250}],246:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("../../assembler-2d")),n=s(t("../../../value-types/mat4"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a=t("../../../components/CCMotionStreak"),l=t("../../render-flow");function c(t,e){this.point=t||cc.v2(),this.dir=e||cc.v2(),this.distance=0,this.time=0}c.prototype.setPoint=function(t,e){this.point.x=t,this.point.y=e},c.prototype.setDir=function(t,e){this.dir.x=t,this.dir.y=e},cc.v2(),cc.v2();var h=cc.v2(),u=cc.v2(),d=new n.default;function p(t,e){return t.x=-e.y,t.y=e.x,t}var f=function(t){var e,i;function r(){var e;return(e=t.call(this)||this)._tailShortenTime=0,e}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var n=r.prototype;return n.initData=function(){this._renderData.createFlexData(0,16,42)},n.update=function(t,e){var i=t._stroke/2;t.node.getWorldMatrix(d);var r=d.m[12],n=d.m[13],s=t._points,o=t._lastWPos,a=t._fadeTime;if(t._lastWPosUpdated&&(o.x!==r||o.y!==n)){var l,f=!1;if(0===s.length){var _=new c;_.setPoint(o.x,o.y),this._tailShortenTime=_.time=a,s.push(_),l=new c,s.unshift(l)}else{l=s[0];var m=s[1],g=m.point.x-r,y=m.point.y-n;f=g*g+y*y>=t.minSeg*t.minSeg}l.setPoint(r,n),l.time=a+e;var v=s[1];if(l.distance=l.point.sub(v.point,u).mag(),u.normalizeSelf(),l.setDir(u.x,u.y),2===s.length&&v.setDir(u.x,u.y),f){var b=new c(l.point.clone(),l.dir.clone());b.distance=l.distance,b.time=l.time,s.unshift(b)}}if(o.x=r,o.y=n,t._lastWPosUpdated=!0,!(s.length<2)){var x,T=t._color,C=T.a,S=T.b<<16|T.g<<8|T.r,w=0,A=this._renderData._flexBuffer;A.reserve(2*s.length,6*(s.length-1));for(var E=A.vData,D=A.uintVData,L=s.length-1;L>=0;L--){var I=s[L],P=I.point,M=I.dir;I.time-=e;var R=L===s.length-1;if(I.time<=0)R&&L-1>=0&&(this._tailShortenTime=s[L-1].time-e),s.splice(L,1);else{var O=I.time/a;if(R){var B=s[L-1];if(!B){s.splice(L,1);continue}if(s.length>=3){var N=I.time/this._tailShortenTime;N<=1&&(P.x=B.point.x-B.distance*B.dir.x*N,P.y=B.point.y-B.distance*B.dir.y*N)}else this._tailShortenTime=I.time}p(h,M);var k=O*C<<24>>>0|S,F=5*w;E[F]=P.x+h.x*i,E[F+1]=P.y+h.y*i,E[F+2]=1,E[F+3]=O,D[F+4]=k,E[F+=5]=P.x-h.x*i,E[F+1]=P.y-h.y*i,E[F+2]=0,E[F+3]=O,D[F+4]=k,w+=2}}x=w<=2?0:3*(w-2),A.used(w,x)}},n.fillBuffers=function(t,e){var i=this._renderData._flexBuffer,r=i.vData,n=i.usedVertices,s=i.usedIndices,o=i.usedVerticesFloats,a=e._meshBuffer,c=a.request(n,s),h=c.byteOffset>>2,u=a._vData;r.length+h>u.length?u.set(r.subarray(0,o),h):u.set(r,h);for(var d=a._iData,p=c.indiceOffset,f=c.vertexOffset,_=0,m=n;_<m;_+=2){var g=f+_;d[p++]=g,d[p++]=g+2,d[p++]=g+1,d[p++]=g+1,d[p++]=g+2,d[p++]=g+3}t.node._renderFlag|=l.FLAG_UPDATE_RENDER_DATA},r}(r.default);i.default=f,f.register(a,f),e.exports=i.default},{"../../../components/CCMotionStreak":113,"../../../value-types/mat4":288,"../../assembler-2d":222,"../../render-flow":228}],247:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("../../../../../components/CCSprite").FillType,a=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.updateRenderData=function(t){var e=t._spriteFrame;if(this.packToDynamicAtlas(t,e),t._vertsDirty){var i=t._fillStart,r=t._fillRange;r<0&&(i+=r,r=-r),r=(r=(r=i+r)>1?1:r)<0?0:r;var n=(i=(i=i>1?1:i)<0?0:i)+(r=(r-=i)<0?0:r);n=n>1?1:n,this.updateUVs(t,i,n),this.updateVerts(t,i,n),t._vertsDirty=!1}},n.updateUVs=function(t,e,i){var r,n,s,a,l,c,h,u,d,p,f=t._spriteFrame,_=f._texture.width,m=f._texture.height,g=f._rect;f._rotated?(r=g.x/_,n=(g.y+g.width)/m,s=l=r,h=d=(g.x+g.height)/_,c=p=n,a=u=g.y/m):(r=g.x/_,n=(g.y+g.height)/m,s=h=r,l=d=(g.x+g.width)/_,a=c=n,u=p=g.y/m);var y=this._renderData.vDatas[0],v=this.uvOffset,b=this.floatsPerVert;switch(t._fillType){case o.HORIZONTAL:y[v]=s+(l-s)*e,y[v+1]=a+(c-a)*e,y[v+b]=s+(l-s)*i,y[v+b+1]=a+(c-a)*i,y[v+2*b]=h+(d-h)*e,y[v+2*b+1]=u+(p-u)*e,y[v+3*b]=h+(d-h)*i,y[v+3*b+1]=u+(p-u)*i;break;case o.VERTICAL:y[v]=s+(h-s)*e,y[v+1]=a+(u-a)*e,y[v+b]=l+(d-l)*e,y[v+b+1]=c+(p-c)*e,y[v+2*b]=s+(h-s)*i,y[v+2*b+1]=a+(u-a)*i,y[v+3*b]=l+(d-l)*i,y[v+3*b+1]=c+(p-c)*i;break;default:cc.errorID(2626)}},n.updateVerts=function(t,e,i){var r,n=t.node,s=n.width,a=n.height,l=n.anchorX*s,c=n.anchorY*a,h=-l,u=-c,d=s-l,p=a-c;switch(t._fillType){case o.HORIZONTAL:r=h+(d-h)*i,h+=(d-h)*e,d=r;break;case o.VERTICAL:r=u+(p-u)*i,u+=(p-u)*e,p=r;break;default:cc.errorID(2626)}var f=this._local;f[0]=h,f[1]=u,f[2]=d,f[3]=p,this.updateWorldVerts(t)},r}(n.default);i.default=a,e.exports=i.default},{"../../../../../components/CCSprite":123,"../../../../assembler-2d":222}],248:[function(t,e,i){var r;function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0;var s=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var s=r.prototype;return s.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},s.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame);var e=t.spriteFrame;if(e){var i=e.vertices;if(i){this.verticesCount=i.x.length,this.indicesCount=i.triangles.length;var r=this._renderData._flexBuffer;r.reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(t),t._vertsDirty=!0),r.used(this.verticesCount,this.indicesCount),this.updateIndices(i.triangles),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),this.updateWorldVerts(t),t._vertsDirty=!1)}}},s.updateIndices=function(t){this._renderData.iDatas[0].set(t)},s.updateUVs=function(t){for(var e=t.spriteFrame.vertices,i=e.nu,r=e.nv,n=this.uvOffset,s=this.floatsPerVert,o=this._renderData.vDatas[0],a=0;a<i.length;a++){var l=s*a+n;o[l]=i[a],o[l+1]=r[a]}},s.updateVerts=function(t){var e=t.node,i=Math.abs(e.width),r=Math.abs(e.height),n=e.anchorX*i,s=e.anchorY*r,o=t.spriteFrame,a=o.vertices,l=a.x,c=a.y,h=o._originalSize.width,u=o._originalSize.height,d=o._rect.width,p=o._rect.height,f=o._offset.x+(h-d)/2,_=o._offset.y+(u-p)/2,m=i/(t.trim?d:h),g=r/(t.trim?p:u),y=this._local;if(t.trim)for(var v=0,b=l.length;v<b;v++){var x=2*v;y[x]=(l[v]-f)*m-n,y[x+1]=(u-c[v]-_)*g-s}else for(var T=0,C=l.length;T<C;T++){var S=2*T;y[S]=l[T]*m-n,y[S+1]=(u-c[T])*g-s}if(o._flipX)for(var w=0,A=this.verticesCount;w<A;w++)y[2*w]=i-y[2*w]-2*n;if(o._flipY)for(var E=0,D=this.verticesCount;E<D;E++)y[2*E+1]=r-y[2*E+1]-2*s},s.updateWorldVerts=function(t){for(var e=t.node._worldMatrix.m,i=e[0],r=e[1],n=e[4],s=e[5],o=e[12],a=e[13],l=this._local,c=this._renderData.vDatas[0],h=this.floatsPerVert,u=0,d=this.verticesCount;u<d;u++){var p=l[2*u],f=l[2*u+1];c[h*u]=p*i+f*n+o,c[h*u+1]=p*r+f*s+a}},r}(((r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r}).default);i.default=s,e.exports=i.default},{"../../../../assembler-2d":222}],249:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=2*Math.PI,a=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],l=[0,0,0,0],c=[0,0,0,0,0,0,0,0],h=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],u=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],d=cc.v2(0,0),p=[];function f(t,e,i,r,n,s,o){var a,l,c=Math.sin(s),h=Math.cos(s);if(0!==Math.cos(s)){if(a=c/h,(t-n.x)*h>0){var u=n.y+a*(t-n.x);o[0].x=t,o[0].y=u}if((e-n.x)*h>0){var d=n.y+a*(e-n.x);o[2].x=e,o[2].y=d}}if(0!==Math.sin(s)){if(l=h/c,(r-n.y)*c>0){var p=n.x+l*(r-n.y);o[3].x=p,o[3].y=r}if((i-n.y)*c>0){var f=n.x+l*(i-n.y);o[1].x=f,o[1].y=i}}}function _(t){var e=t.node,i=e.width,r=e.height,n=e.anchorX*i,s=e.anchorY*r,o=-n,c=-s,h=i-n,u=r-s,f=l;f[0]=o,f[1]=c,f[2]=h,f[3]=u;var _=t._fillCenter,m=d.x=Math.min(Math.max(0,_.x),1)*(h-o)+o,g=d.y=Math.min(Math.max(0,_.y),1)*(u-c)+c;a[0].x=a[3].x=o,a[1].x=a[2].x=h,a[0].y=a[1].y=c,a[2].y=a[3].y=u,p.length=0,m!==f[0]&&(p[0]=[3,0]),m!==f[2]&&(p[2]=[1,2]),g!==f[1]&&(p[1]=[0,1]),g!==f[3]&&(p[3]=[2,3])}function m(t,e){var i,r;if(i=e.x-t.x,r=e.y-t.y,0!==i||0!==r){if(0===i)return r>0?.5*Math.PI:1.5*Math.PI;var n=Math.atan(r/i);return i<0&&(n+=Math.PI),n}}var g=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt()),this.updateIndices()},n.updateRenderData=function(e){t.prototype.updateRenderData.call(this,e);var i,r,n,s,a,p,m,g,y,v=e.spriteFrame;if(this.packToDynamicAtlas(e,v),e._vertsDirty){var b=e._fillStart,x=e._fillRange;for(x<0&&(b+=x,x=-x);b>=1;)b-=1;for(;b<0;)b+=1;b*=o,x*=o,_(e),p=(i=v)._texture.width,m=i._texture.height,g=i._rect,y=c,i._rotated?(r=g.x/p,n=(g.x+g.height)/p,s=g.y/m,a=(g.y+g.width)/m,y[0]=y[2]=r,y[4]=y[6]=n,y[3]=y[7]=a,y[1]=y[5]=s):(r=g.x/p,n=(g.x+g.width)/p,s=g.y/m,a=(g.y+g.height)/m,y[0]=y[4]=r,y[2]=y[6]=n,y[1]=y[3]=a,y[5]=y[7]=s),f(l[0],l[2],l[1],l[3],d,b,h),f(l[0],l[2],l[1],l[3],d,b+x,u),this.updateVerts(e,b,x),e._vertsDirty=!1}},n.updateVerts=function(t,e,i){var r=e+i,n=this._local;n.length=0;for(var s=0,l=3*this.floatsPerVert,c=0;c<4;++c){var f=p[c];if(f)if(i>=o)n.length=s+l,this._generateTriangle(n,s,d,a[f[0]],a[f[1]]),s+=l;else{var _=m(d,a[f[0]]),g=m(d,a[f[1]]);g<_&&(g+=o),_-=o,g-=o;for(var y=0;y<3;++y)_>=r||(_>=e?(n.length=s+l,g>=r?this._generateTriangle(n,s,d,a[f[0]],u[c]):this._generateTriangle(n,s,d,a[f[0]],a[f[1]]),s+=l):g<=e||(g<=r?(n.length=s+l,this._generateTriangle(n,s,d,h[c],a[f[1]]),s+=l):(n.length=s+l,this._generateTriangle(n,s,d,h[c],u[c]),s+=l))),_+=o,g+=o}}this.allocWorldVerts(t),this.updateWorldVerts(t)},n.allocWorldVerts=function(t){var e=t.node._color._val,i=this._renderData,r=this.floatsPerVert,n=this._local,s=n.length/r;this.verticesCount=this.indicesCount=s;var o=i._flexBuffer;o.reserve(s,s)&&this.updateIndices(),o.used(this.verticesCount,this.indicesCount);for(var a=i.vDatas[0],l=i.uintVDatas[0],c=this.uvOffset,h=0;h<n.length;h+=r){var u=h+c;a[u]=n[u],a[u+1]=n[u+1],l[u+2]=e}},n.updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0;e<t.length;e++)t[e]=e},n.updateWorldVerts=function(t){for(var e=t.node._worldMatrix.m,i=e[0],r=e[1],n=e[4],s=e[5],o=e[12],a=e[13],l=this._local,c=this._renderData.vDatas[0],h=this.floatsPerVert,u=0;u<l.length;u+=h){var d=l[u],p=l[u+1];c[u]=d*i+p*n+o,c[u+1]=d*r+p*s+a}},n._generateTriangle=function(t,e,i,r,n){var s=l[0],o=l[1],a=l[2],c=l[3],h=this.floatsPerVert;t[e]=i.x,t[e+1]=i.y,t[e+h]=r.x,t[e+h+1]=r.y,t[e+2*h]=n.x,t[e+2*h+1]=n.y;var u,d,p=this.uvOffset;u=(i.x-s)/(a-s),d=(i.y-o)/(c-o),this._generateUV(u,d,t,e+p),u=(r.x-s)/(a-s),d=(r.y-o)/(c-o),this._generateUV(u,d,t,e+h+p),u=(n.x-s)/(a-s),d=(n.y-o)/(c-o),this._generateUV(u,d,t,e+2*h+p)},n._generateUV=function(t,e,i,r){var n=c[0]+(c[2]-c[0])*t,s=c[4]+(c[6]-c[4])*t,o=c[1]+(c[3]-c[1])*t,a=c[5]+(c[7]-c[5])*t;i[r]=n+(s-n)*e,i[r+1]=o+(a-o)*e},r}(n.default);i.default=g,e.exports=i.default},{"../../../../assembler-2d":222}],250:[function(t,e,i){var r;function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0;var s=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var s=r.prototype;return s.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},s.updateUVs=function(t){for(var e=t._spriteFrame.uv,i=this.uvOffset,r=this.floatsPerVert,n=this._renderData.vDatas[0],s=0;s<4;s++){var o=2*s,a=r*s+i;n[a]=e[o],n[a+1]=e[o+1]}},s.updateVerts=function(t){var e,i,r,n,s=t.node,o=s.width,a=s.height,l=s.anchorX*o,c=s.anchorY*a;if(t.trim)e=-l,i=-c,r=o-l,n=a-c;else{var h=t.spriteFrame,u=h._originalSize.width,d=h._originalSize.height,p=h._rect.width,f=h._rect.height,_=h._offset,m=o/u,g=a/d,y=_.x+(u-p)/2,v=_.x-(u-p)/2;e=y*m-l,i=(_.y+(d-f)/2)*g-c,r=o+v*m-l,n=a+(_.y-(d-f)/2)*g-c}var b=this._local;b[0]=e,b[1]=i,b[2]=r,b[3]=n,this.updateWorldVerts(t)},r}(((r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r}).default);i.default=s,e.exports=i.default},{"../../../../assembler-2d":222}],251:[function(t,e,i){var r;function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0;var s=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var s=r.prototype;return s.initData=function(){if(!(this._renderData.meshCount>0)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);for(var t=this._renderData.iDatas[0],e=0,i=0;i<3;++i)for(var r=0;r<3;++r){var n=4*i+r;t[e++]=n,t[e++]=n+1,t[e++]=n+4,t[e++]=n+1,t[e++]=n+5,t[e++]=n+4}}},s.initLocal=function(){this._local=[],this._local.length=8},s.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},s.updateVerts=function(t){var e=t.node,i=e.width,r=e.height,n=e.anchorX*i,s=e.anchorY*r,o=t.spriteFrame,a=o.insetLeft,l=o.insetRight,c=o.insetTop,h=o.insetBottom,u=i-a-l,d=r-c-h,p=i/(a+l),f=r/(c+h);p=isNaN(p)||p>1?1:p,f=isNaN(f)||f>1?1:f,u=u<0?0:u,d=d<0?0:d;var _=this._local;_[0]=-n,_[1]=-s,_[2]=a*p-n,_[3]=h*f-s,_[4]=_[2]+u,_[5]=_[3]+d,_[6]=i-n,_[7]=r-s,this.updateWorldVerts(t)},s.updateUVs=function(t){for(var e=this._renderData.vDatas[0],i=t.spriteFrame.uvSliced,r=this.uvOffset,n=this.floatsPerVert,s=0;s<4;++s)for(var o=0;o<4;++o){var a=4*s+o,l=i[a],c=a*n;e[c+r]=l.u,e[c+r+1]=l.v}},s.updateWorldVerts=function(t){for(var e=t.node._worldMatrix.m,i=e[0],r=e[1],n=e[4],s=e[5],o=e[12],a=e[13],l=this._local,c=this._renderData.vDatas[0],h=this.floatsPerVert,u=0;u<4;++u)for(var d=l[2*u+1],p=0;p<4;++p){var f=l[2*p],_=(4*u+p)*h;c[_]=f*i+d*n+o,c[_+1]=f*r+d*s+a}},r}(((r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r}).default);i.default=s,Object.assign(s.prototype,{verticesCount:16,indicesCount:54}),e.exports=i.default},{"../../../../assembler-2d":222}],252:[function(t,e,i){var r;function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}i.__esModule=!0,i.default=void 0;var s=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var s=r.prototype;return s.initData=function(){this.verticesCount=0,this.contentWidth=0,this.contentHeight=0,this.rectWidth=0,this.rectHeight=0,this.hRepeat=0,this.vRepeat=0,this.row=0,this.col=0,this._renderData.createFlexData(0,4,6,this.getVfmt()),this._updateIndices()},s.initLocal=function(){this._local={x:[],y:[]}},s._updateIndices=function(){for(var t=this._renderData.iDatas[0],e=0,i=0,r=t.length;e<r;e+=6,i+=4)t[e]=i,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+1,t[e+4]=i+3,t[e+5]=i+2},s.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e);var i=t.node,r=this.contentWidth=Math.abs(i.width),n=this.contentHeight=Math.abs(i.height),s=e._rect,o=e.insetLeft,a=e.insetRight,l=s.width-o-a,c=e.insetTop,h=e.insetBottom,u=s.height-c-h;this.sizableWidth=r-o-a,this.sizableHeight=n-c-h,this.sizableWidth=this.sizableWidth>0?this.sizableWidth:0,this.sizableHeight=this.sizableHeight>0?this.sizableHeight:0;var d=this.hRepeat=0===l?this.sizableWidth:this.sizableWidth/l,p=this.vRepeat=0===u?this.sizableHeight:this.sizableHeight/u,f=(this.row=Math.ceil(p+2))*(this.col=Math.ceil(d+2));this.verticesCount=4*f,this.indicesCount=6*f;var _=this._renderData._flexBuffer;_.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(t)),_.used(this.verticesCount,this.indicesCount),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1)},s.updateVerts=function(t){var e=t._spriteFrame,i=e._rect,r=t.node,n=r.anchorX*r.width,s=r.anchorY*r.height,o=this.row,a=this.col,l=this.contentWidth,c=this.contentHeight,h=this._local,u=h.x,d=h.y;u.length=d.length=0;var p,f,_=e.insetLeft,m=e.insetRight,g=i.width-_-m,y=e.insetTop,v=e.insetBottom,b=i.height-y-v,x=r.width/(_+m)>1?1:r.width/(_+m),T=r.height/(y+v)>1?1:r.height/(y+v);p=g>0?Math.floor(1e3*this.sizableWidth)/1e3%g==0?g:this.sizableWidth%g:this.sizableWidth,f=b>0?Math.floor(1e3*this.sizableHeight)/1e3%b==0?b:this.sizableHeight%b:this.sizableHeight;for(var C=0;C<=a;C++)0===C?u[C]=-n:C>0&&C<a?u[C]=1===C?_*x+Math.min(g,this.sizableWidth)-n:g>0?C===a-1?_+p+g*(C-2)-n:_+Math.min(g,this.sizableWidth)+g*(C-2)-n:_+this.sizableWidth-n:C===a&&(u[C]=Math.min(_+this.sizableWidth+m,l)-n);for(var S=0;S<=o;S++)0===S?d[S]=-s:S>0&&S<o?d[S]=1===S?v*T+Math.min(b,this.sizableHeight)-s:b>0?S===o-1?v+f+(S-2)*b-s:v+Math.min(b,this.sizableHeight)+(S-2)*b-s:v+this.sizableHeight-s:S===o&&(d[S]=Math.min(v+this.sizableHeight+y,c)-s);this.updateWorldVerts(t)},s.updateWorldVerts=function(t){for(var e,i,r,n,s=this._renderData,o=this._local,a=o.x,l=o.y,c=s.vDatas[0],h=this.row,u=this.col,d=t.node._worldMatrix.m,p=d[0],f=d[1],_=d[4],m=d[5],g=d[12],y=d[13],v=this.floatsPerVert,b=0,x=0,T=h;x<T;++x){r=l[x],n=l[x+1];for(var C=0,S=u;C<S;++C)e=a[C],i=a[C+1],c[b]=e*p+r*_+g,c[b+1]=e*f+r*m+y,c[b+=v]=i*p+r*_+g,c[b+1]=i*f+r*m+y,c[b+=v]=e*p+n*_+g,c[b+1]=e*f+n*m+y,c[b+=v]=i*p+n*_+g,c[b+1]=i*f+n*m+y,b+=v}},s.updateUVs=function(t){var e=this._renderData.vDatas[0];if(e)for(var i=t._spriteFrame,r=i._rect,n=i.insetLeft,s=i.insetRight,o=r.width-n-s,a=i.insetTop,l=i.insetBottom,c=r.height-a-l,h=this.row,u=this.col,d=this.hRepeat,p=this.vRepeat,f=0,_=0,m=t.spriteFrame.uv,g=t.spriteFrame.uvSliced,y=t.spriteFrame._rotated,v=this.floatsPerVert,b=this.uvOffset,x=[],T=[],C=0,S=h;C<S;++C){_=this.sizableHeight>c?this.sizableHeight>=C*c?1:p%1:p;for(var w=0,A=u;w<A;++w)f=this.sizableWidth>o?this.sizableWidth>=w*o?1:d%1:d,y?(0===C?(x[0]=g[0].u,x[1]=g[0].u,x[2]=g[4].u+(g[8].u-g[4].u)*_):C<h-1?(x[0]=g[4].u,x[1]=g[4].u,x[2]=g[4].u+(g[8].u-g[4].u)*_):C===h-1&&(x[0]=g[8].u,x[1]=g[8].u,x[2]=g[12].u),0===w?(T[0]=g[0].v,T[1]=g[1].v+(g[2].v-g[1].v)*f,T[2]=g[0].v):w<u-1?(T[0]=g[1].v,T[1]=g[1].v+(g[2].v-g[1].v)*f,T[2]=g[1].v):w===u-1&&(T[0]=g[2].v,T[1]=g[3].v,T[2]=g[2].v),x[3]=x[2],T[3]=T[1]):(0===w?(x[0]=g[0].u,x[1]=g[1].u+(g[2].u-g[1].u)*f,x[2]=m[0]):w<u-1?(x[0]=g[1].u,x[1]=g[1].u+(g[2].u-g[1].u)*f,x[2]=g[1].u):w===u-1&&(x[0]=g[2].u,x[1]=g[3].u,x[2]=g[2].u),0===C?(T[0]=g[0].v,T[1]=g[0].v,T[2]=g[4].v+(g[8].v-g[4].v)*_):C<h-1?(T[0]=g[4].v,T[1]=g[4].v,T[2]=g[4].v+(g[8].v-g[4].v)*_):C===h-1&&(T[0]=g[8].v,T[1]=g[8].v,T[2]=g[12].v),x[3]=x[1],T[3]=T[2]),e[b]=x[0],e[b+1]=T[0],e[b+=v]=x[1],e[b+1]=T[1],e[b+=v]=x[2],e[b+1]=T[2],e[b+=v]=x[3],e[b+1]=T[3],b+=v}},r}(((r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r}).default);i.default=s,e.exports=i.default},{"../../../../assembler-2d":222}],253:[function(t){var e=_(t("../../../assembler")),i=t("../../../../components/CCSprite"),r=_(t("./2d/simple")),n=_(t("./2d/sliced")),s=_(t("./2d/tiled")),o=_(t("./2d/radial-filled")),a=_(t("./2d/bar-filled")),l=_(t("./2d/mesh")),c=_(t("./3d/simple")),h=_(t("./3d/sliced")),u=_(t("./3d/tiled")),d=_(t("./3d/radial-filled")),p=_(t("./3d/bar-filled")),f=_(t("./3d/mesh"));function _(t){return t&&t.__esModule?t:{default:t}}var m={getConstructor:function(t){var e=t.node.is3DNode,_=e?c.default:r.default;switch(t.type){case i.Type.SLICED:_=e?h.default:n.default;break;case i.Type.TILED:_=e?u.default:s.default;break;case i.Type.FILLED:_=t._fillType===i.FillType.RADIAL?e?d.default:o.default:e?p.default:a.default;break;case i.Type.MESH:_=e?f.default:l.default}return _},Simple:r.default,Sliced:n.default,Tiled:s.default,RadialFilled:o.default,BarFilled:a.default,Mesh:l.default,Simple3D:c.default,Sliced3D:h.default,Tiled3D:u.default,RadialFilled3D:d.default,BarFilled3D:p.default,Mesh3D:f.default};e.default.register(cc.Sprite,m)},{"../../../../components/CCSprite":123,"../../../assembler":224,"./2d/bar-filled":247,"./2d/mesh":248,"./2d/radial-filled":249,"./2d/simple":250,"./2d/sliced":251,"./2d/tiled":252,"./3d/bar-filled":void 0,"./3d/mesh":void 0,"./3d/radial-filled":void 0,"./3d/simple":void 0,"./3d/sliced":void 0,"./3d/tiled":void 0}],254:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e,i,r,n){this._handler=t,this._index=e,this._vfmt=n,this._verticesBytes=n._bytes,this._initVerticesCount=i,this._initIndicesCount=r,this.reset()}var e=t.prototype;return e._reallocVData=function(t,e){this.vData=new Float32Array(t),this.uintVData=new Uint32Array(this.vData.buffer),e&&this.vData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},e._reallocIData=function(t,e){this.iData=new Uint16Array(t),e&&this.iData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData)},e.reserve=function(t,e){var i=t*this._verticesBytes>>2,r=this.vData.length,n=!1;if(i>r){for(;r<i;)r*=2;this._reallocVData(r,this.vData),n=!0}var s=this.iData.length;if(e>s){for(;s<e;)s*=2;this._reallocIData(e,this.iData),n=!0}return n},e.used=function(t,e){this.usedVertices=t,this.usedIndices=e,this.usedVerticesFloats=t*this._verticesBytes>>2,this._handler.updateMeshRange(t,e)},e.reset=function(){var t=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(t),this._reallocIData(this._initIndicesCount),this.usedVertices=0,this.usedVerticesFloats=0,this.usedIndices=0},t}();i.default=r,cc.FlexBuffer=r,e.exports=i.default},{}],255:[function(t,e){var i,r,n,s=(i=t("../../../renderer/gfx"))&&i.__esModule?i:{default:i};r=cc.sys.platform===cc.sys.WECHAT_GAME?(cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_OSX)&&(null==(n=GameGlobal)?void 0:n.isIOSHighPerformanceMode)&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent):(cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_OSX)&&cc.sys.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent);var o=cc.Class({name:"cc.MeshBuffer",ctor:function(t,e){this.init(t,e)},init:function(t,e){this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1,this._vertexFormat=e,this._vertexBytes=this._vertexFormat._bytes,this._arrOffset=0,this._vbArr=[],this._vb=new s.default.VertexBuffer(t._device,e,s.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[0]=this._vb,this._ibArr=[],this._ib=new s.default.IndexBuffer(t._device,s.default.INDEX_FMT_UINT16,s.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[0]=this._ib,this._vData=null,this._uintVData=null,this._iData=null,this._batcher=t,this._initVDataCount=256*e._bytes,this._initIDataCount=1536,this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0},this._reallocBuffer()},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this._iData.buffer,0,this.indiceOffset);this._vb.update(0,t),this._ib.update(0,e),this._dirty=!1}},switchBuffer:function(){var t=++this._arrOffset;this.byteOffset=0,this.vertexOffset=0,this.indiceOffset=0,this.indiceStart=0,t<this._vbArr.length?(this._vb=this._vbArr[t],this._ib=this._ibArr[t]):(this._vb=new s.default.VertexBuffer(this._batcher._device,this._vertexFormat,s.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[t]=this._vb,this._ib=new s.default.IndexBuffer(this._batcher._device,s.default.INDEX_FMT_UINT16,s.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[t]=this._ib)},checkAndSwitchBuffer:function(t){this.vertexOffset+t>65535&&(this.uploadData(),this._batcher._flush(),this.switchBuffer())},requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,r=this.indiceOffset+e,n=this._vData.byteLength,s=this._iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}this._updateOffset(t,e,i)},_updateOffset:function(t,e,i){var r=this._offsetInfo;r.vertexOffset=this.vertexOffset,this.vertexOffset+=t,r.indiceOffset=this.indiceOffset,this.indiceOffset+=e,r.byteOffset=this.byteOffset,this.byteOffset=i,this._dirty=!0},request:function(t,e){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(t,e),this._offsetInfo},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(!0)},_reallocVData:function(t){var e;this._vData&&(e=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer);var i=new Uint8Array(this._uintVData.buffer);if(e&&t)for(var r=0,n=e.length;r<n;r++)i[r]=e[r]},_reallocIData:function(t){var e=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this._iData,r=0,n=e.length;r<n;r++)i[r]=e[r]},reset:function(){this._arrOffset=0,this._vb=this._vbArr[0],this._ib=this._ibArr[0],this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1},destroy:function(){this.reset();for(var t=0;t<this._vbArr.length;t++)this._vbArr[t].destroy();this._vbArr=null;for(var e=0;e<this._ibArr.length;e++)this._ibArr[e].destroy();this._ibArr=null,this._ib=null,this._vb=null},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset}});r&&(o.prototype.checkAndSwitchBuffer=function(t){this.vertexOffset+t>65535&&(this.uploadData(),this._batcher._flush())},o.prototype.forwardIndiceStartToOffset=function(){this.uploadData(),this.switchBuffer()}),cc.MeshBuffer=e.exports=o},{"../../../renderer/gfx":319}],256:[function(t,e){var i=s(t("../../../renderer/core/input-assembler")),r=s(t("../../../renderer/memop/recycle-pool")),n=s(t("../../../renderer/scene/model"));function s(t){return t&&t.__esModule?t:{default:t}}var o=t("./vertex-format"),a=o.vfmtPosUvColor,l=o.vfmt3D,c=t("./quad-buffer"),h=t("./mesh-buffer"),u=t("./spine-buffer"),d=t("../../assets/material/CCMaterial"),p=(new(t("../../platform/id-generater"))("VertextFormat"),{}),f=new d,_=new i.default;_._count=0;var m=function(t,e){this._renderScene=e,this._device=t,this.walking=!1,this.material=f,this.cullingMask=1,this._iaPool=new r.default((function(){return new i.default}),16),this._modelPool=new r.default((function(){return new n.default}),16),this._quadBuffer=this.getBuffer("quad",a),this._meshBuffer=this.getBuffer("mesh",a),this._quadBuffer3D=this.getBuffer("quad",l),this._meshBuffer3D=this.getBuffer("mesh",l),this._buffer=this._meshBuffer,this._batchedModels=[],this._dummyNode=new cc.Node,this._sortKey=0,this.node=this._dummyNode,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0};m.prototype={constructor:m,reset:function(){this._iaPool.reset();for(var t=this._renderScene,e=this._batchedModels,i=0;i<e.length;++i)e[i].setInputAssembler(null),e[i].setEffect(null),t.removeModel(e[i]);for(var r in this._modelPool.reset(),e.length=0,this._sortKey=0,p)p[r].reset();this._buffer=this._meshBuffer,this.node=this._dummyNode,this.material=f,this.cullingMask=1,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0},_flushMaterial:function(t){if(t){this.material=t;var e=t.effect;if(e){var i=this._modelPool.add();this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(e,null),i.setInputAssembler(_),this._renderScene.addModel(i)}}},_flush:function(){var t=this.material,e=this._buffer,i=e.indiceOffset-e.indiceStart;if(this.walking&&t&&!(i<=0)){var r=t.effect;if(r){var n=this._iaPool.add();n._vertexBuffer=e._vb,n._indexBuffer=e._ib,n._start=e.indiceStart,n._count=i;var s=this._modelPool.add();this._batchedModels.push(s),s.sortKey=this._sortKey++,s._cullingMask=this.cullingMask,s.setNode(this.node),s.setEffect(r),s.setInputAssembler(n),this._renderScene.addModel(s),e.forwardIndiceStartToOffset()}}},_flushIA:function(t){if(t){var e=this.material.effect;if(e){var i=this._modelPool.add();this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(e),i.setInputAssembler(t),this._renderScene.addModel(i)}}},terminate:function(){for(var t in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),p)p[t].uploadData();this.walking=!1},getBuffer:function(t,e){var i=t+e.getHash(),r=p[i];if(!r){if("mesh"===t)r=new h(this,e);else if("quad"===t)r=new c(this,e);else{if("spine"!==t)return cc.error("Not support buffer type ["+t+"]"),null;r=new u(this,e)}p[i]=r}return r}},e.exports=m},{"../../../renderer/core/input-assembler":309,"../../../renderer/memop/recycle-pool":334,"../../../renderer/scene/model":340,"../../assets/material/CCMaterial":81,"../../platform/id-generater":213,"./mesh-buffer":255,"./quad-buffer":257,"./spine-buffer":259,"./vertex-format":260}],257:[function(t,e){var i=t("./mesh-buffer"),r=cc.Class({name:"cc.QuadBuffer",extends:i,_fillQuadBuffer:function(){for(var t=this._initIDataCount/6,e=this._iData,i=0,r=0;i<t;i++){var n=4*i;e[r++]=n,e[r++]=n+1,e[r++]=n+2,e[r++]=n+1,e[r++]=n+3,e[r++]=n+2}var s=new Uint16Array(this._iData.buffer,0,6*t);this._ib.update(0,s)},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2);this._vb.update(0,t),this._dirty=!1}},switchBuffer:function(){this._super();var t=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,t)},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(),this._fillQuadBuffer()}});cc.QuadBuffer=e.exports=r},{"./mesh-buffer":255}],258:[function(t,e,i){i.__esModule=!0,i.default=o;var r,n=(r=t("./flex-buffer"))&&r.__esModule?r:{default:r},s=t("./vertex-format");function o(){this.vDatas=[],this.uintVDatas=[],this.iDatas=[],this.meshCount=0,this._infos=null,this._flexBuffer=null}cc.js.mixin(o.prototype,{init:function(){},clear:function(){this.vDatas.length=0,this.iDatas.length=0,this.uintVDatas.length=0,this.meshCount=0,this._infos=null,this._flexBuffer&&this._flexBuffer.reset()},updateMesh:function(t,e,i){this.vDatas[t]=e,this.uintVDatas[t]=new Uint32Array(e.buffer,0,e.length),this.iDatas[t]=i,this.meshCount=this.vDatas.length},updateMeshRange:function(){},createData:function(t,e,i){var r=new Float32Array(e),n=new Uint16Array(i);this.updateMesh(t,r,n)},createQuadData:function(t,e,i){this.createData(t,e,i),this.initQuadIndices(this.iDatas[t])},createFlexData:function(t,e,i,r){r=r||s.vfmtPosUvColor,this._flexBuffer=new n.default(this,t,e,i,r)},initQuadIndices:function(t){for(var e=t.length/6,i=0,r=0;i<e;i++){var n=4*i;t[r++]=n,t[r++]=n+1,t[r++]=n+2,t[r++]=n+1,t[r++]=n+3,t[r++]=n+2}}}),cc.RenderData=o,e.exports=i.default},{"./flex-buffer":254,"./vertex-format":260}],259:[function(t,e){var i=cc.Class({name:"cc.SpineBuffer",extends:t("./mesh-buffer"),requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes,r=this.indiceOffset+e,n=this._vData.byteLength,s=this._iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}var o=this._offsetInfo;o.vertexOffset=this.vertexOffset,o.indiceOffset=this.indiceOffset,o.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.SpineBuffer=e.exports=i},{"./mesh-buffer":255}],260:[function(t,e){var i,r=(i=t("../../../renderer/gfx"))&&i.__esModule?i:{default:i},n=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:3},{name:r.default.ATTR_UV0,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);n.name="vfmt3D",r.default.VertexFormat.XYZ_UV_Color=n;var s=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_UV0,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);s.name="vfmtPosUvColor",r.default.VertexFormat.XY_UV_Color=s;var o=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_UV0,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:r.default.ATTR_COLOR0,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);o.name="vfmtPosUvTwoColor",r.default.VertexFormat.XY_UV_Two_Color=o;var a=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_UV0,type:r.default.ATTR_TYPE_FLOAT32,num:2}]);a.name="vfmtPosUv",r.default.VertexFormat.XY_UV=a;var l=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:2},{name:r.default.ATTR_COLOR,type:r.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);l.name="vfmtPosColor",r.default.VertexFormat.XY_Color=l;var c=new r.default.VertexFormat([{name:r.default.ATTR_POSITION,type:r.default.ATTR_TYPE_FLOAT32,num:2}]);c.name="vfmtPos",r.default.VertexFormat.XY=c,e.exports={vfmt3D:n,vfmtPosUvColor:s,vfmtPosUvTwoColor:o,vfmtPosUv:a,vfmtPosColor:l,vfmtPos:c}},{"../../../renderer/gfx":319}],261:[function(t,e){t("../platform/CCSys");var i=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,n=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=i.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var r=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!r)return t;var n=r[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?n.substring(0,n.length-e.length):n},dirname:function(t){var e=r.exec(t);return e?e[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),r="";return i>0&&(r=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+r:t.substring(0,i)+e+r},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var r=t.indexOf("?"),n="",s=i?this.extname(t):"";return r>0&&(n=t.substring(r),t=t.substring(0,r)),r=(r=t.lastIndexOf("/"))<=0?0:r+1,t.substring(0,r)+e+s+n},_normalize:function(t){var e=t=String(t);do{e=t,t=t.replace(n,"")}while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path},{"../platform/CCSys":205}],262:[function(t,e){var i=function(t,e,i,r,n,s){this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s};i.create=function(t,e,i,r,n,s){return{a:t,b:e,c:i,d:r,tx:n,ty:s}},i.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},i.clone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},i.concat=function(t,e,i){var r=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,l=e.ty;return t.a=r*i.a+n*i.c,t.b=r*i.b+n*i.d,t.c=s*i.a+o*i.c,t.d=s*i.b+o*i.d,t.tx=a*i.a+l*i.c+i.tx,t.ty=a*i.b+l*i.d+i.ty,t},i.invert=function(t,e){var i=e.a,r=e.b,n=e.c,s=e.d,o=1/(i*s-r*n),a=e.tx,l=e.ty;return t.a=o*s,t.b=-o*r,t.c=-o*n,t.d=o*i,t.tx=o*(n*l-s*a),t.ty=o*(r*a-i*l),t},i.fromMat4=function(t,e){var i=e.m;return t.a=i[0],t.b=i[1],t.c=i[4],t.d=i[5],t.tx=i[12],t.ty=i[13],t},i.transformVec2=function(t,e,i,r){var n,s;return void 0===r?(r=i,n=e.x,s=e.y):(n=e,s=i),t.x=r.a*n+r.c*s+r.tx,t.y=r.b*n+r.d*s+r.ty,t},i.transformSize=function(t,e,i){return t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height,t},i.transformRect=function(t,e,i){var r=e.x,n=e.y,s=r+e.width,o=n+e.height,a=i.a*r+i.c*n+i.tx,l=i.b*r+i.d*n+i.ty,c=i.a*s+i.c*n+i.tx,h=i.b*s+i.d*n+i.ty,u=i.a*r+i.c*o+i.tx,d=i.b*r+i.d*o+i.ty,p=i.a*s+i.c*o+i.tx,f=i.b*s+i.d*o+i.ty,_=Math.min(a,c,u,p),m=Math.max(a,c,u,p),g=Math.min(l,h,d,f),y=Math.max(l,h,d,f);return t.x=_,t.y=g,t.width=m-_,t.height=y-g,t},i.transformObb=function(t,e,i,r,n,s){var o=n.x,a=n.y,l=n.width,c=n.height,h=s.a*o+s.c*a+s.tx,u=s.b*o+s.d*a+s.ty,d=s.a*l,p=s.b*l,f=s.c*c,_=s.d*c;e.x=h,e.y=u,i.x=d+h,i.y=p+u,t.x=f+h,t.y=_+u,r.x=d+f+h,r.y=p+_+u},cc.AffineTransform=e.exports=i},{}],263:[function(t,e){var i=t("../platform/CCObject").Flags,r=t("./misc"),n=t("../platform/js"),s=t("../platform/id-generater"),o=t("../event-manager"),a=t("../renderer/render-flow"),l=i.Destroying,c=i.DontDestroy,h=i.Deactivating,u=new s("Node");function d(t){return t?"string"==typeof t?n.getClassByName(t):t:(cc.errorID(3804),null)}function p(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var r=t._components[i];if(r.constructor===e)return r}else for(var n=0;n<t._components.length;++n){var s=t._components[n];if(s instanceof e)return s}return null}function f(t,e,i){if(e._sealed)for(var r=0;r<t._components.length;++r){var n=t._components[r];n.constructor===e&&i.push(n)}else for(var s=0;s<t._components.length;++s){var o=t._components[s];o instanceof e&&i.push(o)}}function _(t,e){for(var i=0;i<t.length;++i){var r=t[i],n=p(r,e);if(n)return n;if(r._children.length>0&&(n=_(r._children,e)))return n}return null}function m(t,e,i){for(var r=0;r<t.length;++r){var n=t[r];f(n,e,i),n._children.length>0&&m(n._children,e,i)}}var g=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&c)>0},set:function(t){t?this._objFlags|=c:this._objFlags&=~c}},name:{get:function(){return this._name},set:function(t){this._name=t}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this._id=u.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[]},getParent:function(){return this._parent},setParent:function(t){if(this._parent!==t){var e=this._parent;if(this._parent=t||null,this._onSetParent(t),t&&(o._setDirtyForNode(this),t._children.push(this),t.emit&&t.emit("child-added",this),t._renderFlag|=a.FLAG_CHILDREN),e){if(!(e._objFlags&l)){var i=e._children.indexOf(this);e._children.splice(i,1),e.emit&&e.emit("child-removed",this),this._onHierarchyChanged(e),0===e._children.length&&(e._renderFlag&=~a.FLAG_CHILDREN)}}else t&&this._onHierarchyChanged(null)}},attr:function(t){n.mixin(this,t)},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent)if(this._parent._objFlags&h)cc.errorID(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},walk:function(t,e){var i,r,n,s,o=cc._BaseNode,a=1,l=o._stacks[o._stackId];l||(l=[],o._stacks.push(l)),o._stackId++,l.length=0,l[0]=this;var c=null;for(s=!1;a;)if(r=l[--a])if(!s&&t?t(r):s&&e&&e(r),l[a]=null,s){if(c===this._parent)break;if(s=!1,i)if(i[++n])l[a]=i[n],a++;else if(c&&(l[a]=c,a++,s=!0,c._parent?(n=(i=c._parent._children).indexOf(c),c=c._parent):(c=null,i=null),n<0))break}else r._children.length>0?(c=r,i=r._children,n=0,l[a]=i[n],a++):(l[a]=r,a++,s=!0);l.length=0,o._stackId--},cleanup:function(){},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){this._children.indexOf(t)>-1&&((e||void 0===e)&&t.cleanup(),t.parent=null)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;i>=0;i--){var r=e[i];r&&(t&&r.cleanup(),r.parent=null)}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},getComponent:function(t){var e=d(t);return e?p(this,e):null},getComponents:function(t){var e=d(t),i=[];return e&&f(this,e,i),i},getComponentInChildren:function(t){var e=d(t);return e?_(this._children,e):null},getComponentsInChildren:function(t){var e=d(t),i=[];return e&&(f(this,e,i),m(this._children,e,i)),i},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=n.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;e=t}if("function"!=typeof e)return cc.errorID(3809),null;if(!n.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;var i=e._requireComponent;if(i&&!this.getComponent(i)&&!this.addComponent(i))return null;var r=new e;return r.node=this,this._components.push(r),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(r),r},_addComponentAt:!1,removeComponent:function(t){t?(t instanceof cc.Component||(t=this.getComponent(t)),t&&t.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){if(t){if(!(this._objFlags&l)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(){},_onPostActivated:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(){var t=this._parent;!this._persistNode||t instanceof cc.Scene||cc.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&cc.director._nodeActivator.activateNode(this,e)},_instantiate:function(t,e){return t||(t=cc.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},_registerIfAttached:!1,_onPreDestroy:function(){var t,e;this._objFlags|=l;var i=this._parent,r=i&&i._objFlags&l,n=this._children;for(t=0,e=n.length;t<e;++t)n[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t)this._components[t]._destroyImmediate();var s=this.__eventTargets;for(t=0,e=s.length;t<e;++t){var o=s[t];o&&o.targetOff(this)}if(s.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!r&&i){var a=i._children.indexOf(this);i._children.splice(a,1),i.emit&&i.emit("child-removed",this)}return r},onRestore:!1});g.idGenerater=u,g._stacks=[[]],g._stackId=0,g.prototype._onPreDestroyBase=g.prototype._onPreDestroy,g.prototype._onHierarchyChangedBase=g.prototype._onHierarchyChanged,r.propertyDefine(g,["parent","name","children","childrenCount"],{}),cc._BaseNode=e.exports=g},{"../event-manager":141,"../platform/CCObject":202,"../platform/id-generater":213,"../platform/js":217,"../renderer/render-flow":228,"./misc":271}],264:[function(t,e){e.exports={binarySearchEpsilon:function(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var s=t[n];if(s>e+1e-6)r=n-1;else{if(!(s<e-1e-6))return n;i=n+1}}return~i}}},{}],265:[function(t,e){var i=t("../components/CCRenderComponent"),r=t("../platform/CCMacro").BlendFactor,n=t("../../renderer/gfx"),s=cc.Class({properties:{_srcBlendFactor:r.SRC_ALPHA,_dstBlendFactor:r.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc(!0),this._onBlendChanged&&this._onBlendChanged())},animatable:!1,type:r,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc(!0))},animatable:!1,type:r,tooltip:!1,visible:!0}},setMaterial:function(t,e){var n=i.prototype.setMaterial.call(this,t,e);return this._srcBlendFactor===r.SRC_ALPHA&&this._dstBlendFactor===r.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(n),n},_updateMaterial:function(){this._updateBlendFunc()},_updateBlendFunc:function(t){if(t||this._srcBlendFactor!==r.SRC_ALPHA||this._dstBlendFactor!==r.ONE_MINUS_SRC_ALPHA)for(var e=this.getMaterials(),i=0;i<e.length;i++){var n=e[i];this._updateMaterialBlendFunc(n)}},_updateMaterialBlendFunc:function(t){t.setBlend(!0,n.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,n.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor)}});e.exports=cc.BlendFunc=s},{"../../renderer/gfx":319,"../components/CCRenderComponent":117,"../platform/CCMacro":201}],266:[function(t,e){var i=t("./misc").BASE64_VALUES,r="0123456789abcdef".split(""),n=["","","",""],s=n.concat(n,"-",n,"-",n,"-",n,"-",n,n,n),o=s.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;s[0]=t[0],s[1]=t[1];for(var e=2,n=2;e<22;e+=2){var a=i[t.charCodeAt(e)],l=i[t.charCodeAt(e+1)];s[o[n++]]=r[a>>2],s[o[n++]]=r[(3&a)<<2|l>>4],s[o[n++]]=r[15&l]}return s.join("")}},{"./misc":271}],267:[function(t,e){cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(3814),null;if(e);else{var i=cc.director.getScene();if(!i)return null;e=i}for(var r=e,n="/"!==t[0]?0:1,s=t.split("/"),o=n;o<s.length;o++){var a=s[o],l=r._children;r=null;for(var c=0,h=l.length;c<h;++c){var u=l[c];if(u.name===a){r=u;break}}if(!r)return null}return r}},{}],268:[function(t,e){var i,r=(i=t("../assets/material/material-variant"))&&i.__esModule?i:{default:i},n=t("../assets/material/CCMaterial"),s=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial},set:function(t){this._normalMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:n,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial},set:function(t){this._grayMaterial=t,this._updateDisabledState&&this._updateDisabledState()},type:n,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(t,e){var i;t?((i=this._grayMaterial)||(i=n.getBuiltinMaterial("2d-gray-sprite")),i=this._grayMaterial=r.default.create(i,e)):((i=this._normalMaterial)||(i=n.getBuiltinMaterial("2d-sprite",e)),i=this._normalMaterial=r.default.create(i,e)),e.setMaterial(0,i)}});e.exports=s},{"../assets/material/CCMaterial":81,"../assets/material/material-variant":88}],269:[function(t,e){var i=/^(click)(\s)*=|(param)(\s)*=/,r=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,n=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])};n.prototype={constructor:n,parse:function(t){if(this._resultObjectArray=[],!t)return this._resultObjectArray;this._stack=[];for(var e=0,i=t.length;e<i;){var r=t.indexOf(">",e),n=-1;if(r>=0&&(n=t.lastIndexOf("<",r))<e-1&&(n=t.indexOf("<",r+1),r=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var s=t.substring(e,n),o=t.substring(n+1,r);""===o&&(s=t.substring(e,r+1)),this._processResult(s),-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(o),e=r+1}}return this._resultObjectArray},_attributeToObject:function(t){var e,i,n,s,o={},a=(t=t.trim()).match(/^(color|size)(\s)*=/);if(a){if(e=a[0],""===(t=t.substring(e.length).trim()))return o;switch(i=t.indexOf(" "),e[0]){case"c":o.color=i>-1?t.substring(0,i).trim():t;break;case"s":o.size=parseInt(t)}return i>-1&&(s=t.substring(i+1).trim(),n=this._processEventHandler(s),o.event=n),o}if((a=t.match(/^(br(\s)*\/)/))&&a[0].length>0&&(e=a[0].trim()).startsWith("br")&&"/"===e[e.length-1])return o.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),o;if((a=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&a[0].length>0&&(e=a[0].trim()).startsWith("img")&&"/"===e[e.length-1]){var l;a=t.match(r);for(var c=!1;a;){if(e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),u=(i=(l=t.substring(e.length).trim()).indexOf(" "))>-1?l.substr(0,i):l,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=l.substring(i).trim(),u.endsWith("/")&&(u=u.slice(0,-1)),"src"===e){switch(u.charCodeAt(0)){case 34:case 39:c=!0,u=u.slice(1,-1)}o.isImage=!0,o.src=u}else if("height"===e)o.imageHeight=parseInt(u);else if("width"===e)o.imageWidth=parseInt(u);else if("align"===e){switch(u.charCodeAt(0)){case 34:case 39:u=u.slice(1,-1)}o.imageAlign=u.toLocaleLowerCase()}else"offset"===e?o.imageOffset=u:"click"===e&&(o.event=this._processEventHandler(e+"="+u));o.event&&"param"===e&&(o.event.param=u.replace(/^\"|\"$/g,"")),a=t.match(r)}return c&&o.isImage&&this._resultObjectArray.push({text:"",style:o}),{}}if(a=t.match(/^(outline(\s)*[^>]*)/)){var h={color:"#ffffff",width:1};if(t=a[0].substring(7).trim()){var u,d=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(a=t.match(d);a;)e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),u=(i=(l=t.substring(e.length).trim()).indexOf(" "))>-1?l.substr(0,i):l,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=l.substring(i).trim(),"click"===e?o.event=this._processEventHandler(e+"="+u):"color"===e?h.color=u:"width"===e&&(h.width=parseInt(u)),o.event&&"param"===e&&(o.event.param=u.replace(/^\"|\"$/g,"")),a=t.match(d)}o.outline=h}if((a=t.match(/^(on|u|b|i)(\s)*/))&&a[0].length>0){switch(e=a[0],t=t.substring(e.length).trim(),e[0]){case"u":o.underline=!0;break;case"i":o.italic=!0;break;case"b":o.bold=!0}if(""===t)return o;n=this._processEventHandler(t),o.event=n}return o},_processEventHandler:function(t){for(var e=0,r={},n=t.match(i),s=!1;n;){var o=n[0],a="";if(s=!1,'"'===(t=t.substring(o.length).trim()).charAt(0))(e=t.indexOf('"',1))>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else if("'"===t.charAt(0))(e=t.indexOf("'",1))>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else{var l=t.match(/(\S)+/);e=(a=l?l[0]:"").length}s&&(r[o=o.substring(0,o.length-1).trim()]=a),n=(t=t.substring(e).trim()).match(i)}return r},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var r in i)e[r]||(e[r]=i[r]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],r=this._specialSymbolArray[e][1];t=t.replace(i,r)}return t}},e.exports=n},{}],270:[function(t){t("./CCPath"),t("./profiler/CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":261,"./find":267,"./mutable-forward-iterator":272,"./profiler/CCProfiler":275}],271:[function(t,e){for(var i=t("../platform/js"),r={propertyDefine:function(t,e,r){function n(t,e,r,n){var s=Object.getOwnPropertyDescriptor(t,e);if(s)s.get&&(t[r]=s.get),s.set&&n&&(t[n]=s.set);else{var o=t[r];i.getset(t,e,o,t[n])}}for(var s,o=t.prototype,a=0;a<e.length;a++){var l=(s=e[a])[0].toUpperCase()+s.slice(1);n(o,s,"get"+l,"set"+l)}for(s in r){var c=r[s];n(o,s,c[0],c[1])}},NextPOT:function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16)},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},n=new Array(123),s=0;s<123;++s)n[s]=64;for(var o=0;o<64;++o)n["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(o)]=o;r.BASE64_VALUES=n,r.pushToMap=function(t,e,i,r){var n=t[e];n?Array.isArray(n)?r?(n.push(n[0]),n[0]=i):n.push(i):t[e]=r?[i,n]:[n,i]:t[e]=i},r.clampf=function(t,e,i){if(e>i){var r=e;e=i,i=r}return t<e?e:t<i?t:i},r.clamp01=function(t){return t<0?0:t<1?t:1},r.lerp=function(t,e,i){return t+(e-t)*i},r.degreesToRadians=function(t){return t*cc.macro.RAD},r.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.misc=e.exports=r},{"../platform/js":217}],272:[function(t,e){function i(t){this.i=0,this.array=t}var r=i.prototype;r.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=i},{}],273:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(){this.enabled=!1,this.count=0,this.maxSize=1024}var e=t.prototype;return e.get=function(){},e.put=function(){},e.clear=function(){},t}();i.default=r,cc.pool={},r.register=function(t,e){cc.pool[t]=e},e.exports=i.default},{}],274:[function(t,e){cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags,r=t._parent,n=t._id,s=t._name,o=t._active,a=t._eulerAngles.x,l=t._eulerAngles.y,c=t._eulerAngles.z,h=t._localZOrder,u=t._trs,d=u[0],p=u[1],f=u[2];cc.game._isCloning=!0,e.asset._doInstantiate(t),cc.game._isCloning=!1,t._objFlags=i,t._parent=r,t._id=n,t._prefab=e,t._name=s,t._active=o,t._localZOrder=h,(u=t._trs)[0]=d,u[1]=p,u[2]=f,t._eulerAngles.x=a,t._eulerAngles.y=l,t._eulerAngles.z=c}}},{}],275:[function(t,e){var i=t("../../platform/CCMacro"),r=t("./perf-counter"),n=!1,s=null,o=null,a=null;function l(){!function(){if(!o||!o.isValid){(o=new cc.Node("PROFILER-NODE")).x=o.y=10,o.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),o.zIndex=i.MAX_ZINDEX,cc.game.addPersistRootNode(o);var t=new cc.Node("LEFT-PANEL");t.anchorX=t.anchorY=0;var e=t.addComponent(cc.Label);e.fontSize=15,e.lineHeight=15,t.parent=o;var r=new cc.Node("RIGHT-PANEL");r.anchorX=1,r.anchorY=0,r.x=200;var n=r.addComponent(cc.Label);n.horizontalAlign=cc.Label.HorizontalAlign.RIGHT,n.fontSize=15,n.lineHeight=15,r.parent=o,cc.sys.platform!==cc.sys.BAIDU_GAME_SUB&&cc.sys.platform!==cc.sys.WECHAT_GAME_SUB&&(e.cacheMode=cc.Label.CacheMode.CHAR,n.cacheMode=cc.Label.CacheMode.CHAR),a={left:e,right:n}}}();var t=cc.director._lastUpdate;s.frame._counter.start(t),s.logic._counter.start(t)}function c(){var t=performance.now();cc.director.isPaused()?s.frame._counter.start(t):s.logic._counter.end(t),s.render._counter.start(t)}function h(){var t=performance.now();s.render._counter.end(t),s.draws._counter.value=cc.renderer.drawCalls,s.frame._counter.end(t),s.fps._counter.frame(t);var e="",i="";for(var r in s){var n=s[r];n._counter.sample(t),e+=n.desc+"\n",i+=n._counter.human()+"\n"}a&&(a.left.string=e,a.right.string=i)}cc.profiler=e.exports={isShowingStats:function(){return n},hideStats:function(){n&&(o&&(o.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,l),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,c),cc.director.off(cc.Director.EVENT_AFTER_DRAW,h),n=!1)},showStats:function(){n||(function(){if(!s){s={fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw Call"},frame:{desc:"Frame time (ms)",min:0,max:50,average:500},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var t=performance.now();for(var e in s)s[e]._counter=new r(e,s[e],t)}}(),o&&(o.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,l),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,c),cc.director.on(cc.Director.EVENT_AFTER_DRAW,h),n=!0)}}},{"../../platform/CCMacro":201,"./perf-counter":277}],276:[function(t,e){var i=cc.Class({name:"cc.Counter",ctor:function(t,e,i){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=i},properties:{value:{get:function(){return this._value},set:function(t){this._value=t}}},_average:function(t,e){if(this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},sample:function(t){this._average(this._value,t)},human:function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});e.exports=i},{}],277:[function(t,e){var i=t("./counter"),r=cc.Class({name:"cc.PerfCounter",extends:i,ctor:function(t,e,i){this._time=i},start:function(t){this._time=t},end:function(t){this._value=t-this._time,this._average(this._value)},tick:function(){this.end(),this.start()},frame:function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))}});e.exports=r},{"./counter":276}],278:[function(t,e){var i,r=new(((i=t("../platform/js"))&&i.__esModule?i:{default:i}).default.Pool)(2);function n(t){this.count=0,this.limit=t,this.datas={},this.head=null,this.tail=null}r.get=function(){return this._get()||{key:null,value:null,prev:null,next:null}},n.prototype.moveToHead=function(t){t.next=this.head,t.prev=null,null!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.count++,this.datas[t.key]=t},n.prototype.put=function(t,e){var i=r.get();if(i.key=t,i.value=e,this.count>=this.limit){var n=this.tail;delete this.datas[n.key],this.count--,this.tail=n.prev,this.tail.next=null,n.prev=null,n.next=null,r.put(n)}this.moveToHead(i)},n.prototype.remove=function(t){null!==t.prev?t.prev.next=t.next:this.head=t.next,null!==t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},n.prototype.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},n.prototype.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},n.prototype.has=function(t){return!!this.datas[t]},n.prototype.delete=function(t){var e=this.datas[t];this.remove(e)};var s=new n(100),o={BASELINE_RATIO:.26,MIDDLE_RATIO:.37,BASELINE_OFFSET:0,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,highSurrogateRex:/[\uD800-\uDBFF]/,lowSurrogateRex:/[\uDC00-\uDFFF]/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(t){return this.__CHINESE_REG.test(t)||this.__JAPANESE_REG.test(t)||this.__KOREAN_REG.test(t)},isUnicodeSpace:function(t){return(t=t.charCodeAt(0))>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},safeMeasureText:function(t,e,i){var r=(i||t.font)+"🎮"+e,n=s.get(r);if(null!==n)return n;var o=t.measureText(e),a=o&&o.width||0;return s.put(r,a),a},_safeSubstring:function(t,e,i){var r=e,n=i,s=t[e];if(this.lowSurrogateRex.test(s)&&r--,void 0!==i)if(i-1!==e){var o=t[i-1];this.highSurrogateRex.test(o)&&n--}else this.highSurrogateRex.test(s)&&n++;return t.substring(r,n)},fragmentText:function(t,e,i,r){var n=[];if(0===t.length||i<0)return n.push(""),n;for(var s=t;e>i&&s.length>1;){for(var o=s.length*(i/e)|0,a=this._safeSubstring(s,o),l=e-r(a),c=a,h=0,u=0;l>i&&u++<10;)o*=i/l,o|=0,l=e-r(a=this._safeSubstring(s,o));for(u=0;l<=i&&u++<10;){if(a){var d=this.label_wordRex.exec(a);h=d?d[0].length:1,c=a}o+=h,l=e-r(a=this._safeSubstring(s,o))}0==(o-=h)?(o=1,c=this._safeSubstring(s,1)):1===o&&this.highSurrogateRex.test(s[0])&&(o=2,c=this._safeSubstring(s,2));var p,f=this._safeSubstring(s,0,o);this.label_wrapinspection&&this.label_symbolRex.test(c||a)&&(0==(o-=(p=this.label_lastWordRex.exec(f))?p[0].length:0)&&(o=1),c=this._safeSubstring(s,o),f=this._safeSubstring(s,0,o)),this.label_firstEnglish.test(c)&&(p=this.label_lastEnglish.exec(f))&&f!==p[0]&&(o-=p[0].length,c=this._safeSubstring(s,o),f=this._safeSubstring(s,0,o)),(0===n.length||(f=f.trimLeft()).length>0)&&n.push(f),e=r(s=c||a)}return(0===n.length||(s=s.trimLeft()).length>0)&&n.push(s),n}};cc.textUtils=e.exports=o},{"../platform/js":217}],279:[function(t,e){var i=t("../assets/CCTexture2D"),r={loadImage:function(t,e,i){cc.assertID(t,3103);var r=cc.assetManager.assets.get(t);if(r)return r.loaded?(e&&e.call(i,null,r),r):(r.once("load",(function(){e&&e.call(i,null,r)}),i),r);cc.assetManager.loadRemote(t,(function(t,r){e&&e.call(i,t,r)}))},cacheImage:function(t,e){if(t&&e){var r=new i;return r.initWithElement(e),cc.assetManager.assets.add(t,r),r}},postLoadTexture:function(t,e){t.loaded?e&&e():t.nativeUrl?cc.assetManager.postLoadNative(t,e):e&&e()}};e.exports=r},{"../assets/CCTexture2D":77}],280:[function(t,e){var i=t("./node-unit"),r=t("./node-mem-pool");e.exports={NodeMemPool:new r(i)}},{"./node-mem-pool":282,"./node-unit":283}],281:[function(t,e){var i=function(t){this._unitClass=t,this._pool=[],this._findOrder=[]},r=i.prototype;r._initNative=function(){this._nativeMemPool=new renderer.MemPool},r._buildUnit=function(t){return new this._unitClass(t,this)},r._destroyUnit=function(t){this._pool[t]=null;for(var e=0,i=this._findOrder.length;e<i;e++){var r=this._findOrder[e];if(r&&r.unitID==t){this._findOrder.splice(e,1);break}}},r._findUnitID=function(){for(var t=0,e=this._pool;e[t];)t++;return t},r.pop=function(){for(var t=null,e=0,i=this._findOrder,r=this._pool,n=i.length;e<n;e++){var s=i[e];if(s&&s.hasSpace()){t=s;break}}if(!t){var o=this._findUnitID();t=this._buildUnit(o),r[o]=t,i.push(t),e=i.length-1}var a=i[0];return a!==t&&(i[0]=t,i[e]=a),t.pop()},r.push=function(t){var e=this._pool[t.unitID];return e.push(t.index),this._findOrder.length>1&&e.isAllFree()&&this._destroyUnit(t.unitID),e},e.exports=i},{}],282:[function(t,e){var i,r=t("./mem-pool"),n=function(t){r.call(this,t)};(i=function(){}).prototype=r.prototype;var s=n.prototype=new i;s._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool},s._destroyUnit=function(t){r.prototype._destroyUnit.call(this,t)},e.exports=n},{"./mem-pool":281}],283:[function(t,e){var i,r=t("../../value-types/utils"),n=10*r.FLOAT_BYTES,s=16*r.FLOAT_BYTES,o=16*r.FLOAT_BYTES,a=(r.FLOAT_BYTES,t("./unit-base")),l=function(t,e){a.call(this,t,e);var i=this._contentNum;this.trsList=new r.FLOAT_ARRAY_TYPE(10*i),this.localMatList=new r.FLOAT_ARRAY_TYPE(16*i),this.worldMatList=new r.FLOAT_ARRAY_TYPE(16*i);for(var l=0;l<i;l++){var c=this._spacesData[l];c.trs=new r.FLOAT_ARRAY_TYPE(this.trsList.buffer,l*n,10),c.localMat=new r.FLOAT_ARRAY_TYPE(this.localMatList.buffer,l*s,16),c.worldMat=new r.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,l*o,16)}};(i=function(){}).prototype=a.prototype,l.prototype=new i,e.exports=l},{"../../value-types/utils":293,"./unit-base":284}],284:[function(t,e){var i=function(t,e,i){i=i||128,this.unitID=t,this._memPool=e,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=i,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[];for(var r=0;r<i;r++){var n=2*r;this._signData[n+0]=r+1,this._signData[n+1]=0,this._spacesData[r]={index:r,unitID:t}}this._signData[2*(i-1)]=65535},r=i.prototype;r.hasSpace=function(){return 65535!==this._data[0]},r.isAllFree=function(){return 0==this._data[1]},r.pop=function(){var t=this._data[0];if(65535===t)return null;var e=t,i=2*e,r=this._spacesData[e];return this._signData[i+1]=1,this._data[0]=this._signData[i+0],this._data[1]++,r},r.push=function(t){var e=2*t;this._signData[e+1]=0,this._signData[e+0]=this._data[0],this._data[0]=t,this._data[1]--},r.dump=function(){for(var t=0,e=this._data[0],i="";65535!=e;)t++,i+=e+"->",e=this._signData[2*e+0];for(var r=0,n="",s=this._contentNum,o=0;o<s;o++)1==this._signData[2*o+1]&&(r++,n+=o+"->");var a=t+r;console.log("unitID:",this.unitID,"spaceNum:",t,"calc using num:",r,"store using num:",this._data[1],"calc total num:",a,"actually total num:",this._contentNum),console.log("free info:",i),console.log("using info:",n),r!=this._data[1]&&cc.error("using num error","calc using num:",r,"store using num:",this._data[1]),t+r!=this._contentNum&&cc.error("total num error","calc total num:",a,"actually total num:",this._contentNum)},e.exports=i},{}],285:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("./value-type")),n=o(t("../platform/CCClass")),s=o(t("../utils/misc"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var c=function(t){var e,i;function r(e,i,r,n){var s;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=255),(s=t.call(this)||this)._val=0,"object"==typeof e&&(i=e.g,r=e.b,n=e.a,e=e.r),s._val=(n<<24>>>0)+(r<<16)+(i<<8)+(0|e),s}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,l(e,i),r.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},r.clone=function(t){return new r(t.r,t.g,t.b,t.a)},r.set=function(t,e,i,r,n){return void 0===e&&(e=255),void 0===i&&(i=255),void 0===r&&(r=255),void 0===n&&(n=255),t.r=e,t.g=i,t.b=r,t.a=n,t},r.fromHex=function(t,e){var i=e>>24&255,r=e>>16&255,n=e>>8&255,s=255&e;return t.r=i,t.g=r,t.b=n,t.a=s,t},r.fromHEX=function(t,e){return e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0,t.a=parseInt(e.substr(6,2),16)||255,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},r.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t},r.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t},r.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t},r.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t},r.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t},r.lerp=function(t,e,i,r){var n=e.r,s=e.g,o=e.b,a=e.a;return t.r=n+r*(i.r-n),t.g=s+r*(i.g-s),t.b=o+r*(i.b-o),t.a=a+r*(i.a-a),t},r.toArray=function(t,e,i){void 0===i&&(i=0);var n=e instanceof r||e.a>1?1/255:1;return t[i+0]=e.r*n,t[i+1]=e.g*n,t[i+2]=e.b*n,t[i+3]=e.a*n,t},r.fromArray=function(t,e,i){return void 0===i&&(i=0),e.r=255*t[i+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e},r.premultiplyAlpha=function(t,e){var i=e.a/255;return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t._fastSetA(e.a),t};var n,o,c,h=r.prototype;return h.clone=function(){var t=new r;return t._val=this._val,t},h.equals=function(t){return t&&this._val===t._val},h.lerp=function(t,e,i){i=i||new r;var n=this.r,s=this.g,o=this.b,a=this.a;return i.r=n+(t.r-n)*e,i.g=s+(t.g-s)*e,i.b=o+(t.b-o)*e,i.a=a+(t.a-a)*e,i},h.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},h.getR=function(){return 255&this._val},h.setR=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4294967040&this._val|t)>>>0,this},h.getG=function(){return(65280&this._val)>>8},h.setG=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0,this},h.getB=function(){return(16711680&this._val)>>16},h.setB=function(t){return t=~~s.default.clampf(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0,this},h.getA=function(){return(4278190080&this._val)>>>24},h.setA=function(t){return t=~~s.default.clampf(t,0,255),this._val=(16777215&this._val|t<<24)>>>0,this},h.toCSS=function(t){return t&&"rgba"!==t?"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t):"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(2)+")"},h.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||255;return this._val=(n<<24>>>0)+(r<<16)+(i<<8)+e,this},h.toHEX=function(t){var e=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===t?(e[0]=e[0][0],e[1]=e[1][0],e[2]=e[2][0]):"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+this.a.toString(16)),e.join("")},h.toRGBValue=function(){return 16777215&this._val},h.fromHSV=function(t,e,i){var r,n,s;if(0===e)r=n=s=i;else if(0===i)r=n=s=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),a=t-o,l=i*(1-e),c=i*(1-e*a),h=i*(1-e*(1-a));switch(o){case 0:r=i,n=h,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=h;break;case 3:r=l,n=c,s=i;break;case 4:r=h,n=l,s=i;break;case 5:r=i,n=l,s=c}}return r*=255,n*=255,s*=255,this._val=(this.a<<24>>>0)+(s<<16)+(n<<8)+(0|r),this},h.toHSV=function(){var t=this.r/255,e=this.g/255,i=this.b/255,r={h:0,s:0,v:0},n=Math.max(t,e,i),s=Math.min(t,e,i),o=0;return r.v=n,r.s=n?(n-s)/n:0,r.s?(o=n-s,r.h=t===n?(e-i)/o:e===n?2+(i-t)/o:4+(t-e)/o,r.h/=6,r.h<0&&(r.h+=1)):r.h=0,r},h.set=function(t){return t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a),this},h._fastSetA=function(t){this._val=(16777215&this._val|t<<24)>>>0},h.multiply=function(t){var e=(255&this._val)*t.r>>8,i=(65280&this._val)*t.g>>8,r=(16711680&this._val)*t.b>>8,n=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&n|16711680&r|65280&i|255&e,this},n=r,c=[{key:"WHITE",get:function(){return new r(255,255,255,255)}},{key:"BLACK",get:function(){return new r(0,0,0,255)}},{key:"TRANSPARENT",get:function(){return new r(0,0,0,0)}},{key:"GRAY",get:function(){return new r(127.5,127.5,127.5)}},{key:"RED",get:function(){return new r(255,0,0)}},{key:"GREEN",get:function(){return new r(0,255,0)}},{key:"BLUE",get:function(){return new r(0,0,255)}},{key:"YELLOW",get:function(){return new r(255,235,4)}},{key:"ORANGE",get:function(){return new r(255,127,0)}},{key:"CYAN",get:function(){return new r(0,255,255)}},{key:"MAGENTA",get:function(){return new r(255,0,255)}}],(o=[{key:"r",get:function(){return this.getR()},set:function(t){this.setR(t)}},{key:"g",get:function(){return this.getG()},set:function(t){this.setG(t)}},{key:"b",get:function(){return this.getB()},set:function(t){this.setB(t)}},{key:"a",get:function(){return this.getA()},set:function(t){this.setA(t)}}])&&a(n.prototype,o),c&&a(n,c),Object.defineProperty(n,"prototype",{writable:!1}),r}(r.default);i.default=c,c.div=c.divide,c.sub=c.subtract,c.mul=c.multiply,c.WHITE_R=c.WHITE,c.BLACK_R=c.BLACK,c.TRANSPARENT_R=c.TRANSPARENT,c.GRAY_R=c.GRAY,c.RED_R=c.RED,c.GREEN_R=c.GREEN,c.BLUE_R=c.BLUE,c.YELLOW_R=c.YELLOW,c.ORANGE_R=c.ORANGE,c.CYAN_R=c.CYAN,c.MAGENTA_R=c.MAGENTA,n.default.fastDefine("cc.Color",c,{r:0,g:0,b:0,a:255}),cc.Color=c,cc.color=function(t,e,i,r){return"string"==typeof t?(new c).fromHEX(t):"object"==typeof t?new c(t.r,t.g,t.b,t.a):new c(t,e,i,r)},e.exports=i.default},{"../platform/CCClass":196,"../utils/misc":271,"./value-type":294}],286:[function(t,e,i){i.__esModule=!0;var r={Vec2:!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0};i.Vec4=i.Vec3=i.Vec2=i.Trs=i.Size=i.Rect=i.Quat=i.Mat4=i.Mat3=i.Color=void 0;var n=_(t("./vec2"));i.Vec2=n.default;var s=_(t("./vec3"));i.Vec3=s.default;var o=_(t("./vec4"));i.Vec4=o.default;var a=_(t("./mat4"));i.Mat4=a.default;var l=_(t("./mat3"));i.Mat3=l.default;var c=_(t("./rect"));i.Rect=c.default;var h=_(t("./size"));i.Size=h.default;var u=_(t("./color"));i.Color=u.default;var d=_(t("./quat"));i.Quat=d.default;var p=_(t("./trs"));i.Trs=p.default;var f=t("./utils");function _(t){return t&&t.__esModule?t:{default:t}}Object.keys(f).forEach((function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(r,t)||t in i&&i[t]===f[t]||(i[t]=f[t]))})),cc.math=e.exports},{"./color":285,"./mat3":287,"./mat4":288,"./quat":289,"./rect":290,"./size":291,"./trs":292,"./utils":293,"./vec2":295,"./vec3":296,"./vec4":297}],287:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../value-types/utils"),s=(r=t("./vec3"))&&r.__esModule?r:{default:r},o=function(){function t(t,e,i,r,s,o,a,l,c){if(void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=1),this.m=void 0,t instanceof n.FLOAT_ARRAY_TYPE)this.m=t;else{this.m=new n.FLOAT_ARRAY_TYPE(9);var h=this.m;h[0]=t,h[1]=e,h[2]=i,h[3]=r,h[4]=s,h[5]=o,h[6]=a,h[7]=l,h[8]=c}}return t.create=function(e,i,r,n,s,o,a,l,c){return void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=1),new t(e,i,r,n,s,o,a,l,c)},t.clone=function(e){var i=e.m;return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},t.copy=function(t,e){return t.m.set(e.m),t},t.set=function(t,e,i,r,n,s,o,a,l,c){var h=t.m;return h[0]=e,h[1]=i,h[2]=r,h[3]=n,h[4]=s,h[5]=o,h[6]=a,h[7]=l,h[8]=c,t},t.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,t},t.transpose=function(t,e){var i=e.m,r=t.m;if(t===e){var n=i[1],s=i[2],o=i[5];r[1]=i[3],r[2]=i[6],r[3]=n,r[5]=i[7],r[6]=s,r[7]=o}else r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8];return t},t.invert=function(t,e){var i=e.m,r=t.m,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=d*l-c*u,f=-d*a+c*h,_=u*a-l*h,m=n*p+s*f+o*_;return m?(m=1/m,r[0]=p*m,r[1]=(-d*s+o*u)*m,r[2]=(c*s-o*l)*m,r[3]=f*m,r[4]=(d*n-o*h)*m,r[5]=(-c*n+o*a)*m,r[6]=_*m,r[7]=(-u*n+s*h)*m,r[8]=(l*n-s*a)*m,t):t},t.adjoint=function(t,e){var i=e.m,r=t.m,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8];return r[0]=l*d-c*u,r[1]=o*u-s*d,r[2]=s*c-o*l,r[3]=c*h-a*d,r[4]=n*d-o*h,r[5]=o*a-n*c,r[6]=a*u-l*h,r[7]=s*h-n*u,r[8]=n*l-s*a,t},t.determinant=function(t){var e=t.m,i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return i*(h*o-a*c)+r*(-h*s+a*l)+n*(c*s-o*l)},t.multiply=function(t,e,i){var r=e.m,n=i.m,s=t.m,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],u=r[5],d=r[6],p=r[7],f=r[8],_=n[0],m=n[1],g=n[2],y=n[3],v=n[4],b=n[5],x=n[6],T=n[7],C=n[8];return s[0]=_*o+m*c+g*d,s[1]=_*a+m*h+g*p,s[2]=_*l+m*u+g*f,s[3]=y*o+v*c+b*d,s[4]=y*a+v*h+b*p,s[5]=y*l+v*u+b*f,s[6]=x*o+T*c+C*d,s[7]=x*a+T*h+C*p,s[8]=x*l+T*u+C*f,t},t.multiplyMat4=function(t,e,i){var r=e.m,n=i.m,s=t.m,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],u=r[5],d=r[6],p=r[7],f=r[8],_=n[0],m=n[1],g=n[2],y=n[4],v=n[5],b=n[6],x=n[8],T=n[9],C=n[10];return s[0]=_*o+m*c+g*d,s[1]=_*a+m*h+g*p,s[2]=_*l+m*u+g*f,s[3]=y*o+v*c+b*d,s[4]=y*a+v*h+b*p,s[5]=y*l+v*u+b*f,s[6]=x*o+T*c+C*d,s[7]=x*a+T*h+C*p,s[8]=x*l+T*u+C*f,t},t.translate=function(t,e,i){var r=e.m,n=t.m,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],h=r[5],u=r[6],d=r[7],p=r[8],f=i.x,_=i.y;return n[0]=s,n[1]=o,n[2]=a,n[3]=l,n[4]=c,n[5]=h,n[6]=f*s+_*l+u,n[7]=f*o+_*c+d,n[8]=f*a+_*h+p,t},t.rotate=function(t,e,i){var r=e.m,n=t.m,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],h=r[5],u=r[6],d=r[7],p=r[8],f=Math.sin(i),_=Math.cos(i);return n[0]=_*s+f*l,n[1]=_*o+f*c,n[2]=_*a+f*h,n[3]=_*l-f*s,n[4]=_*c-f*o,n[5]=_*h-f*a,n[6]=u,n[7]=d,n[8]=p,t},t.scale=function(t,e,i){var r=i.x,n=i.y,s=e.m,o=t.m;return o[0]=r*s[0],o[1]=r*s[1],o[2]=r*s[2],o[3]=n*s[3],o[4]=n*s[4],o[5]=n*s[5],o[6]=s[6],o[7]=s[7],o[8]=s[8],t},t.fromMat4=function(t,e){var i=e.m,r=t.m;return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[4],r[4]=i[5],r[5]=i[6],r[6]=i[8],r[7]=i[9],r[8]=i[10],t},t.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e.x,i[7]=e.y,i[8]=1,t},t.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e),n=t.m;return n[0]=r,n[1]=i,n[2]=0,n[3]=-i,n[4]=r,n[5]=0,n[6]=0,n[7]=0,n[8]=1,t},t.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=e.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1,t},t.fromQuat=function(t,e){var i=t.m,r=e.x,n=e.y,s=e.z,o=e.w,a=r+r,l=n+n,c=s+s,h=r*a,u=n*a,d=n*l,p=s*a,f=s*l,_=s*c,m=o*a,g=o*l,y=o*c;return i[0]=1-d-_,i[3]=u-y,i[6]=p+g,i[1]=u+y,i[4]=1-h-_,i[7]=f-m,i[2]=p-g,i[5]=f+m,i[8]=1-h-d,t},t.fromViewUp=function(e,i,r){var o,a,l;return(o=new s.default(0,1,0),a=new s.default,l=new s.default,function(e,i,r){return s.default.lengthSqr(i)<n.EPSILON*n.EPSILON?(t.identity(e),e):(r=r||o,s.default.normalize(a,s.default.cross(a,r,i)),s.default.lengthSqr(a)<n.EPSILON*n.EPSILON?(t.identity(e),e):(s.default.cross(l,i,a),t.set(e,a.x,a.y,a.z,l.x,l.y,l.z,i.x,i.y,i.z),e))})(e,i,r)},t.normalFromMat4=function(t,e){var i=e.m,r=t.m,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],f=i[10],_=i[11],m=i[12],g=i[13],y=i[14],v=i[15],b=n*c-s*l,x=n*h-o*l,T=n*u-a*l,C=s*h-o*c,S=s*u-a*c,w=o*u-a*h,A=d*g-p*m,E=d*y-f*m,D=d*v-_*m,L=p*y-f*g,I=p*v-_*g,P=f*v-_*y,M=b*P-x*I+T*L+C*D-S*E+w*A;return M?(M=1/M,r[0]=(c*P-h*I+u*L)*M,r[1]=(h*D-l*P-u*E)*M,r[2]=(l*I-c*D+u*A)*M,r[3]=(o*I-s*P-a*L)*M,r[4]=(n*P-o*D+a*E)*M,r[5]=(s*D-n*I-a*A)*M,r[6]=(g*w-y*S+v*C)*M,r[7]=(y*T-m*w-v*x)*M,r[8]=(m*S-g*T+v*b)*M,t):t},t.frob=function(t){var e=t.m;return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(t,e,i){var r=e.m,n=i.m,s=t.m;return s[0]=r[0]+n[0],s[1]=r[1]+n[1],s[2]=r[2]+n[2],s[3]=r[3]+n[3],s[4]=r[4]+n[4],s[5]=r[5]+n[5],s[6]=r[6]+n[6],s[7]=r[7]+n[7],s[8]=r[8]+n[8],t},t.subtract=function(t,e,i){var r=e.m,n=i.m,s=t.m;return s[0]=r[0]-n[0],s[1]=r[1]-n[1],s[2]=r[2]-n[2],s[3]=r[3]-n[3],s[4]=r[4]-n[4],s[5]=r[5]-n[5],s[6]=r[6]-n[6],s[7]=r[7]-n[7],s[8]=r[8]-n[8],t},t.multiplyScalar=function(t,e,i){var r=e.m,n=t.m;return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=r[7]*i,n[8]=r[8]*i,t},t.multiplyScalarAndAdd=function(t,e,i,r){var n=e.m,s=i.m,o=t.m;return o[0]=n[0]+s[0]*r,o[1]=n[1]+s[1]*r,o[2]=n[2]+s[2]*r,o[3]=n[3]+s[3]*r,o[4]=n[4]+s[4]*r,o[5]=n[5]+s[5]*r,o[6]=n[6]+s[6]*r,o[7]=n[7]+s[7]*r,o[8]=n[8]+s[8]*r,t},t.exactEquals=function(t,e){var i=t.m,r=e.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]},t.equals=function(t,e){var i=t.m,r=e.m,s=i[0],o=i[1],a=i[2],l=i[3],c=i[4],h=i[5],u=i[6],d=i[7],p=i[8],f=r[0],_=r[1],m=r[2],g=r[3],y=r[4],v=r[5],b=r[6],x=r[7],T=r[8];return Math.abs(s-f)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-_)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-m)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(u-b)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-x)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(p-T)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))},t.toArray=function(t,e,i){void 0===i&&(i=0);for(var r=e.m,n=0;n<9;n++)t[i+n]=r[n];return t},t.fromArray=function(t,e,i){void 0===i&&(i=0);for(var r=t.m,n=0;n<9;n++)r[n]=e[i+n];return t},t.prototype.toString=function(){var t=this.m;return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t}();i.default=o,o.sub=o.subtract,o.mul=o.multiply,o.IDENTITY=Object.freeze(new o),cc.Mat3=o,e.exports=i.default},{"../value-types/utils":293,"./vec3":296}],288:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=c(t("./value-type")),n=c(t("../platform/CCClass")),s=c(t("./vec3")),o=c(t("./quat")),a=t("./utils"),l=c(t("./mat3"));function c(t){return t&&t.__esModule?t:{default:t}}function h(t,e){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var u=0,d=0,p=0,f=0,_=0,m=0,g=0,y=0,v=0,b=0,x=0,T=0,C=0,S=0,w=0,A=0,E=function(t){var e,i;i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,h(e,i);var r=n.prototype;function n(e,i,r,n,s,o,l,c,h,u,d,p,f,_,m,g){var y;if(void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=1),void 0===l&&(l=0),void 0===c&&(c=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===d&&(d=1),void 0===p&&(p=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===m&&(m=0),void 0===g&&(g=1),(y=t.call(this)||this).m=void 0,e instanceof a.FLOAT_ARRAY_TYPE)y.m=e;else{y.m=new a.FLOAT_ARRAY_TYPE(16);var v=y.m;v[0]=e,v[1]=i,v[2]=r,v[3]=n,v[4]=s,v[5]=o,v[6]=l,v[7]=c,v[8]=h,v[9]=u,v[10]=d,v[11]=p,v[12]=f,v[13]=_,v[14]=m,v[15]=g}return y}return r.mul=function(t,e){return n.multiply(e||new n,this,t)},r.mulScalar=function(t,e){n.multiplyScalar(e||new n,this,t)},r.sub=function(t,e){n.subtract(e||new n,this,t)},n.clone=function(t){var e=t.m;return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},n.copy=function(t,e){var i=t.m,r=e.m;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],t},n.set=function(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,_,m){var g=t.m;return g[0]=e,g[1]=i,g[2]=r,g[3]=n,g[4]=s,g[5]=o,g[6]=a,g[7]=l,g[8]=c,g[9]=h,g[10]=u,g[11]=d,g[12]=p,g[13]=f,g[14]=_,g[15]=m,t},n.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},n.transpose=function(t,e){var i=t.m,r=e.m;if(t===e){var n=r[1],s=r[2],o=r[3],a=r[6],l=r[7],c=r[11];i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=n,i[6]=r[9],i[7]=r[13],i[8]=s,i[9]=a,i[11]=r[14],i[12]=o,i[13]=l,i[14]=c}else i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15];return t},n.invert=function(t,e){var i=e.m;u=i[0],d=i[1],p=i[2],f=i[3],_=i[4],m=i[5],g=i[6],y=i[7],v=i[8],b=i[9],x=i[10],T=i[11],C=i[12],S=i[13],w=i[14],A=i[15];var r=u*m-d*_,n=u*g-p*_,s=u*y-f*_,o=d*g-p*m,a=d*y-f*m,l=p*y-f*g,c=v*S-b*C,h=v*w-x*C,E=v*A-T*C,D=b*w-x*S,L=b*A-T*S,I=x*A-T*w,P=r*I-n*L+s*D+o*E-a*h+l*c;if(0===P)return null;P=1/P;var M=t.m;return M[0]=(m*I-g*L+y*D)*P,M[1]=(p*L-d*I-f*D)*P,M[2]=(S*l-w*a+A*o)*P,M[3]=(x*a-b*l-T*o)*P,M[4]=(g*E-_*I-y*h)*P,M[5]=(u*I-p*E+f*h)*P,M[6]=(w*s-C*l-A*n)*P,M[7]=(v*l-x*s+T*n)*P,M[8]=(_*L-m*E+y*c)*P,M[9]=(d*E-u*L-f*c)*P,M[10]=(C*a-S*s+A*r)*P,M[11]=(b*s-v*a-T*r)*P,M[12]=(m*h-_*D-g*c)*P,M[13]=(u*D-d*h+p*c)*P,M[14]=(S*n-C*o-w*r)*P,M[15]=(v*o-b*n+x*r)*P,t},n.determinant=function(t){var e=t.m;return u=e[0],d=e[1],p=e[2],f=e[3],_=e[4],m=e[5],g=e[6],y=e[7],v=e[8],b=e[9],x=e[10],T=e[11],C=e[12],S=e[13],w=e[14],A=e[15],(u*m-d*_)*(x*A-T*w)-(u*g-p*_)*(b*A-T*S)+(u*y-f*_)*(b*w-x*S)+(d*g-p*m)*(v*A-T*C)-(d*y-f*m)*(v*w-x*C)+(p*y-f*g)*(v*S-b*C)},n.multiply=function(t,e,i){var r=t.m,n=e.m,s=i.m;u=n[0],d=n[1],p=n[2],f=n[3],_=n[4],m=n[5],g=n[6],y=n[7],v=n[8],b=n[9],x=n[10],T=n[11],C=n[12],S=n[13],w=n[14],A=n[15];var o=s[0],a=s[1],l=s[2],c=s[3];return r[0]=o*u+a*_+l*v+c*C,r[1]=o*d+a*m+l*b+c*S,r[2]=o*p+a*g+l*x+c*w,r[3]=o*f+a*y+l*T+c*A,o=s[4],a=s[5],l=s[6],c=s[7],r[4]=o*u+a*_+l*v+c*C,r[5]=o*d+a*m+l*b+c*S,r[6]=o*p+a*g+l*x+c*w,r[7]=o*f+a*y+l*T+c*A,o=s[8],a=s[9],l=s[10],c=s[11],r[8]=o*u+a*_+l*v+c*C,r[9]=o*d+a*m+l*b+c*S,r[10]=o*p+a*g+l*x+c*w,r[11]=o*f+a*y+l*T+c*A,o=s[12],a=s[13],l=s[14],c=s[15],r[12]=o*u+a*_+l*v+c*C,r[13]=o*d+a*m+l*b+c*S,r[14]=o*p+a*g+l*x+c*w,r[15]=o*f+a*y+l*T+c*A,t},n.transform=function(t,e,i){var r=i.x,n=i.y,s=i.z,o=t.m,a=e.m;return e===t?(o[12]=a[0]*r+a[4]*n+a[8]*s+a[12],o[13]=a[1]*r+a[5]*n+a[9]*s+a[13],o[14]=a[2]*r+a[6]*n+a[10]*s+a[14],o[15]=a[3]*r+a[7]*n+a[11]*s+a[15]):(u=a[0],d=a[1],p=a[2],f=a[3],_=a[4],m=a[5],g=a[6],y=a[7],v=a[8],b=a[9],x=a[10],T=a[11],C=a[12],S=a[13],w=a[14],A=a[15],o[0]=u,o[1]=d,o[2]=p,o[3]=f,o[4]=_,o[5]=m,o[6]=g,o[7]=y,o[8]=v,o[9]=b,o[10]=x,o[11]=T,o[12]=u*r+_*n+v*s+a[12],o[13]=d*r+m*n+b*s+a[13],o[14]=p*r+g*n+x*s+a[14],o[15]=f*r+y*n+T*s+a[15]),t},n.translate=function(t,e,i){var r=t.m,n=e.m;return e===t?(r[12]+=i.x,r[13]+=i.y,r[14]+=i.z):(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]+=i.x,r[13]+=i.y,r[14]+=i.z,r[15]=n[15]),t},n.scale=function(t,e,i){var r=i.x,n=i.y,s=i.z,o=t.m,a=e.m;return o[0]=a[0]*r,o[1]=a[1]*r,o[2]=a[2]*r,o[3]=a[3]*r,o[4]=a[4]*n,o[5]=a[5]*n,o[6]=a[6]*n,o[7]=a[7]*n,o[8]=a[8]*s,o[9]=a[9]*s,o[10]=a[10]*s,o[11]=a[11]*s,o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],t},n.rotate=function(t,e,i,r){var n=r.x,s=r.y,o=r.z,l=Math.sqrt(n*n+s*s+o*o);if(Math.abs(l)<a.EPSILON)return null;n*=l=1/l,s*=l,o*=l;var c=Math.sin(i),h=Math.cos(i),C=1-h,S=e.m;u=S[0],d=S[1],p=S[2],f=S[3],_=S[4],m=S[5],g=S[6],y=S[7],v=S[8],b=S[9],x=S[10],T=S[11];var w=n*n*C+h,A=s*n*C+o*c,E=o*n*C-s*c,D=n*s*C-o*c,L=s*s*C+h,I=o*s*C+n*c,P=n*o*C+s*c,M=s*o*C-n*c,R=o*o*C+h,O=t.m;return O[0]=u*w+_*A+v*E,O[1]=d*w+m*A+b*E,O[2]=p*w+g*A+x*E,O[3]=f*w+y*A+T*E,O[4]=u*D+_*L+v*I,O[5]=d*D+m*L+b*I,O[6]=p*D+g*L+x*I,O[7]=f*D+y*L+T*I,O[8]=u*P+_*M+v*R,O[9]=d*P+m*M+b*R,O[10]=p*P+g*M+x*R,O[11]=f*P+y*M+T*R,e!==t&&(O[12]=S[12],O[13]=S[13],O[14]=S[14],O[15]=S[15]),t},n.rotateX=function(t,e,i){var r=t.m,n=e.m,s=Math.sin(i),o=Math.cos(i),a=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11];return e!==t&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[4]=a*o+u*s,r[5]=l*o+d*s,r[6]=c*o+p*s,r[7]=h*o+f*s,r[8]=u*o-a*s,r[9]=d*o-l*s,r[10]=p*o-c*s,r[11]=f*o-h*s,t},n.rotateY=function(t,e,i){var r=t.m,n=e.m,s=Math.sin(i),o=Math.cos(i),a=n[0],l=n[1],c=n[2],h=n[3],u=n[8],d=n[9],p=n[10],f=n[11];return e!==t&&(r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=a*o-u*s,r[1]=l*o-d*s,r[2]=c*o-p*s,r[3]=h*o-f*s,r[8]=a*s+u*o,r[9]=l*s+d*o,r[10]=c*s+p*o,r[11]=h*s+f*o,t},n.rotateZ=function(t,e,i){var r=e.m,n=t.m,s=Math.sin(i),o=Math.cos(i),a=e.m[0],l=e.m[1],c=e.m[2],h=e.m[3],u=e.m[4],d=e.m[5],p=e.m[6],f=e.m[7];return e!==t&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=a*o+u*s,n[1]=l*o+d*s,n[2]=c*o+p*s,n[3]=h*o+f*s,n[4]=u*o-a*s,n[5]=d*o-l*s,n[6]=p*o-c*s,n[7]=f*o-h*s,t},n.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,t},n.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,t},n.fromRotation=function(t,e,i){var r=i.x,n=i.y,s=i.z,o=Math.sqrt(r*r+n*n+s*s);if(Math.abs(o)<a.EPSILON)return null;r*=o=1/o,n*=o,s*=o;var l=Math.sin(e),c=Math.cos(e),h=1-c,u=t.m;return u[0]=r*r*h+c,u[1]=n*r*h+s*l,u[2]=s*r*h-n*l,u[3]=0,u[4]=r*n*h-s*l,u[5]=n*n*h+c,u[6]=s*n*h+r*l,u[7]=0,u[8]=r*s*h+n*l,u[9]=n*s*h-r*l,u[10]=s*s*h+c,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,t},n.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e),n=t.m;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=i,n[7]=0,n[8]=0,n[9]=-i,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e),n=t.m;return n[0]=r,n[1]=0,n[2]=-i,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=i,n[9]=0,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e),n=t.m;return n[0]=r,n[1]=i,n[2]=0,n[3]=0,n[4]=-i,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,t},n.fromRT=function(t,e,i){var r=e.x,n=e.y,s=e.z,o=e.w,a=r+r,l=n+n,c=s+s,h=r*a,u=r*l,d=r*c,p=n*l,f=n*c,_=s*c,m=o*a,g=o*l,y=o*c,v=t.m;return v[0]=1-(p+_),v[1]=u+y,v[2]=d-g,v[3]=0,v[4]=u-y,v[5]=1-(h+_),v[6]=f+m,v[7]=0,v[8]=d+g,v[9]=f-m,v[10]=1-(h+p),v[11]=0,v[12]=i.x,v[13]=i.y,v[14]=i.z,v[15]=1,t},n.getTranslation=function(t,e){var i=e.m;return t.x=i[12],t.y=i[13],t.z=i[14],t},n.getScaling=function(t,e){var i=e.m,r=L.m,n=r[0]=i[0],s=r[1]=i[1],o=r[2]=i[2],a=r[3]=i[4],c=r[4]=i[5],h=r[5]=i[6],u=r[6]=i[8],d=r[7]=i[9],p=r[8]=i[10];return t.x=Math.sqrt(n*n+s*s+o*o),t.y=Math.sqrt(a*a+c*c+h*h),t.z=Math.sqrt(u*u+d*d+p*p),l.default.determinant(L)<0&&(t.x*=-1),t},n.getRotation=function(t,e){var i=e.m,r=i[0]+i[5]+i[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t.w=.25*n,t.x=(i[6]-i[9])/n,t.y=(i[8]-i[2])/n,t.z=(i[1]-i[4])/n):i[0]>i[5]&&i[0]>i[10]?(n=2*Math.sqrt(1+i[0]-i[5]-i[10]),t.w=(i[6]-i[9])/n,t.x=.25*n,t.y=(i[1]+i[4])/n,t.z=(i[8]+i[2])/n):i[5]>i[10]?(n=2*Math.sqrt(1+i[5]-i[0]-i[10]),t.w=(i[8]-i[2])/n,t.x=(i[1]+i[4])/n,t.y=.25*n,t.z=(i[6]+i[9])/n):(n=2*Math.sqrt(1+i[10]-i[0]-i[5]),t.w=(i[1]-i[4])/n,t.x=(i[8]+i[2])/n,t.y=(i[6]+i[9])/n,t.z=.25*n),t},n.toRTS=function(t,e,i,r){var n=t.m,a=L.m;r.x=s.default.set(D,n[0],n[1],n[2]).mag(),a[0]=n[0]/r.x,a[1]=n[1]/r.x,a[2]=n[2]/r.x,r.y=s.default.set(D,n[4],n[5],n[6]).mag(),a[3]=n[4]/r.y,a[4]=n[5]/r.y,a[5]=n[6]/r.y,r.z=s.default.set(D,n[8],n[9],n[10]).mag(),a[6]=n[8]/r.z,a[7]=n[9]/r.z,a[8]=n[10]/r.z,l.default.determinant(L)<0&&(r.x*=-1,a[0]*=-1,a[1]*=-1,a[2]*=-1),o.default.fromMat3(e,L),s.default.set(i,n[12],n[13],n[14])},n.fromRTS=function(t,e,i,r){var n=e.x,s=e.y,o=e.z,a=e.w,l=n+n,c=s+s,h=o+o,u=n*l,d=n*c,p=n*h,f=s*c,_=s*h,m=o*h,g=a*l,y=a*c,v=a*h,b=r.x,x=r.y,T=r.z,C=t.m;return C[0]=(1-(f+m))*b,C[1]=(d+v)*b,C[2]=(p-y)*b,C[3]=0,C[4]=(d-v)*x,C[5]=(1-(u+m))*x,C[6]=(_+g)*x,C[7]=0,C[8]=(p+y)*T,C[9]=(_-g)*T,C[10]=(1-(u+f))*T,C[11]=0,C[12]=i.x,C[13]=i.y,C[14]=i.z,C[15]=1,t},n.fromRTSOrigin=function(t,e,i,r,n){var s=e.x,o=e.y,a=e.z,l=e.w,c=s+s,h=o+o,u=a+a,d=s*c,p=s*h,f=s*u,_=o*h,m=o*u,g=a*u,y=l*c,v=l*h,b=l*u,x=r.x,T=r.y,C=r.z,S=n.x,w=n.y,A=n.z,E=t.m;return E[0]=(1-(_+g))*x,E[1]=(p+b)*x,E[2]=(f-v)*x,E[3]=0,E[4]=(p-b)*T,E[5]=(1-(d+g))*T,E[6]=(m+y)*T,E[7]=0,E[8]=(f+v)*C,E[9]=(m-y)*C,E[10]=(1-(d+_))*C,E[11]=0,E[12]=i.x+S-(E[0]*S+E[4]*w+E[8]*A),E[13]=i.y+w-(E[1]*S+E[5]*w+E[9]*A),E[14]=i.z+A-(E[2]*S+E[6]*w+E[10]*A),E[15]=1,t},n.fromQuat=function(t,e){var i=e.x,r=e.y,n=e.z,s=e.w,o=i+i,a=r+r,l=n+n,c=i*o,h=r*o,u=r*a,d=n*o,p=n*a,f=n*l,_=s*o,m=s*a,g=s*l,y=t.m;return y[0]=1-u-f,y[1]=h+g,y[2]=d-m,y[3]=0,y[4]=h-g,y[5]=1-c-f,y[6]=p+_,y[7]=0,y[8]=d+m,y[9]=p-_,y[10]=1-c-u,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,t},n.frustum=function(t,e,i,r,n,s,o){var a=1/(i-e),l=1/(n-r),c=1/(s-o),h=t.m;return h[0]=2*s*a,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*s*l,h[6]=0,h[7]=0,h[8]=(i+e)*a,h[9]=(n+r)*l,h[10]=(o+s)*c,h[11]=-1,h[12]=0,h[13]=0,h[14]=o*s*2*c,h[15]=0,t},n.perspective=function(t,e,i,r,n){var s=1/Math.tan(e/2),o=1/(r-n),a=t.m;return a[0]=s/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(n+r)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*n*r*o,a[15]=0,t},n.ortho=function(t,e,i,r,n,s,o){var a=1/(e-i),l=1/(r-n),c=1/(s-o),h=t.m;return h[0]=-2*a,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*l,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*c,h[11]=0,h[12]=(e+i)*a,h[13]=(n+r)*l,h[14]=(o+s)*c,h[15]=1,t},n.lookAt=function(t,e,i,r){var n=e.x,s=e.y,o=e.z,a=r.x,l=r.y,c=r.z,h=n-i.x,u=s-i.y,d=o-i.z,p=1/Math.sqrt(h*h+u*u+d*d),f=l*(d*=p)-c*(u*=p),_=c*(h*=p)-a*d,m=a*u-l*h,g=u*(m*=p=1/Math.sqrt(f*f+_*_+m*m))-d*(_*=p),y=d*(f*=p)-h*m,v=h*_-u*f,b=t.m;return b[0]=f,b[1]=g,b[2]=h,b[3]=0,b[4]=_,b[5]=y,b[6]=u,b[7]=0,b[8]=m,b[9]=v,b[10]=d,b[11]=0,b[12]=-(f*n+_*s+m*o),b[13]=-(g*n+y*s+v*o),b[14]=-(h*n+u*s+d*o),b[15]=1,t},n.inverseTranspose=function(t,e){var i=e.m;u=i[0],d=i[1],p=i[2],f=i[3],_=i[4],m=i[5],g=i[6],y=i[7],v=i[8],b=i[9],x=i[10],T=i[11],C=i[12],S=i[13],w=i[14],A=i[15];var r=u*m-d*_,n=u*g-p*_,s=u*y-f*_,o=d*g-p*m,a=d*y-f*m,l=p*y-f*g,c=v*S-b*C,h=v*w-x*C,E=v*A-T*C,D=b*w-x*S,L=b*A-T*S,I=x*A-T*w,P=r*I-n*L+s*D+o*E-a*h+l*c;return P?(P=1/P,(i=t.m)[0]=(m*I-g*L+y*D)*P,i[1]=(g*E-_*I-y*h)*P,i[2]=(_*L-m*E+y*c)*P,i[3]=0,i[4]=(p*L-d*I-f*D)*P,i[5]=(u*I-p*E+f*h)*P,i[6]=(d*E-u*L-f*c)*P,i[7]=0,i[8]=(S*l-w*a+A*o)*P,i[9]=(w*s-C*l-A*n)*P,i[10]=(C*a-S*s+A*r)*P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,t):null},n.add=function(t,e,i){var r=t.m,n=e.m,s=i.m;return r[0]=n[0]+s[0],r[1]=n[1]+s[1],r[2]=n[2]+s[2],r[3]=n[3]+s[3],r[4]=n[4]+s[4],r[5]=n[5]+s[5],r[6]=n[6]+s[6],r[7]=n[7]+s[7],r[8]=n[8]+s[8],r[9]=n[9]+s[9],r[10]=n[10]+s[10],r[11]=n[11]+s[11],r[12]=n[12]+s[12],r[13]=n[13]+s[13],r[14]=n[14]+s[14],r[15]=n[15]+s[15],t},n.subtract=function(t,e,i){var r=t.m,n=e.m,s=i.m;return r[0]=n[0]-s[0],r[1]=n[1]-s[1],r[2]=n[2]-s[2],r[3]=n[3]-s[3],r[4]=n[4]-s[4],r[5]=n[5]-s[5],r[6]=n[6]-s[6],r[7]=n[7]-s[7],r[8]=n[8]-s[8],r[9]=n[9]-s[9],r[10]=n[10]-s[10],r[11]=n[11]-s[11],r[12]=n[12]-s[12],r[13]=n[13]-s[13],r[14]=n[14]-s[14],r[15]=n[15]-s[15],t},n.multiplyScalar=function(t,e,i){var r=t.m,n=e.m;return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=n[3]*i,r[4]=n[4]*i,r[5]=n[5]*i,r[6]=n[6]*i,r[7]=n[7]*i,r[8]=n[8]*i,r[9]=n[9]*i,r[10]=n[10]*i,r[11]=n[11]*i,r[12]=n[12]*i,r[13]=n[13]*i,r[14]=n[14]*i,r[15]=n[15]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){var n=t.m,s=e.m,o=i.m;return n[0]=s[0]+o[0]*r,n[1]=s[1]+o[1]*r,n[2]=s[2]+o[2]*r,n[3]=s[3]+o[3]*r,n[4]=s[4]+o[4]*r,n[5]=s[5]+o[5]*r,n[6]=s[6]+o[6]*r,n[7]=s[7]+o[7]*r,n[8]=s[8]+o[8]*r,n[9]=s[9]+o[9]*r,n[10]=s[10]+o[10]*r,n[11]=s[11]+o[11]*r,n[12]=s[12]+o[12]*r,n[13]=s[13]+o[13]*r,n[14]=s[14]+o[14]*r,n[15]=s[15]+o[15]*r,t},n.strictEquals=function(t,e){var i=t.m,r=e.m;return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]&&i[4]===r[4]&&i[5]===r[5]&&i[6]===r[6]&&i[7]===r[7]&&i[8]===r[8]&&i[9]===r[9]&&i[10]===r[10]&&i[11]===r[11]&&i[12]===r[12]&&i[13]===r[13]&&i[14]===r[14]&&i[15]===r[15]},n.equals=function(t,e,i){void 0===i&&(i=a.EPSILON);var r=t.m,n=e.m;return Math.abs(r[0]-n[0])<=i*Math.max(1,Math.abs(r[0]),Math.abs(n[0]))&&Math.abs(r[1]-n[1])<=i*Math.max(1,Math.abs(r[1]),Math.abs(n[1]))&&Math.abs(r[2]-n[2])<=i*Math.max(1,Math.abs(r[2]),Math.abs(n[2]))&&Math.abs(r[3]-n[3])<=i*Math.max(1,Math.abs(r[3]),Math.abs(n[3]))&&Math.abs(r[4]-n[4])<=i*Math.max(1,Math.abs(r[4]),Math.abs(n[4]))&&Math.abs(r[5]-n[5])<=i*Math.max(1,Math.abs(r[5]),Math.abs(n[5]))&&Math.abs(r[6]-n[6])<=i*Math.max(1,Math.abs(r[6]),Math.abs(n[6]))&&Math.abs(r[7]-n[7])<=i*Math.max(1,Math.abs(r[7]),Math.abs(n[7]))&&Math.abs(r[8]-n[8])<=i*Math.max(1,Math.abs(r[8]),Math.abs(n[8]))&&Math.abs(r[9]-n[9])<=i*Math.max(1,Math.abs(r[9]),Math.abs(n[9]))&&Math.abs(r[10]-n[10])<=i*Math.max(1,Math.abs(r[10]),Math.abs(n[10]))&&Math.abs(r[11]-n[11])<=i*Math.max(1,Math.abs(r[11]),Math.abs(n[11]))&&Math.abs(r[12]-n[12])<=i*Math.max(1,Math.abs(r[12]),Math.abs(n[12]))&&Math.abs(r[13]-n[13])<=i*Math.max(1,Math.abs(r[13]),Math.abs(n[13]))&&Math.abs(r[14]-n[14])<=i*Math.max(1,Math.abs(r[14]),Math.abs(n[14]))&&Math.abs(r[15]-n[15])<=i*Math.max(1,Math.abs(r[15]),Math.abs(n[15]))},n.adjoint=function(t,e){var i=e.m,r=t.m,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],f=i[10],_=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return r[0]=c*(f*v-_*y)-p*(h*v-u*y)+g*(h*_-u*f),r[1]=-(s*(f*v-_*y)-p*(o*v-a*y)+g*(o*_-a*f)),r[2]=s*(h*v-u*y)-c*(o*v-a*y)+g*(o*u-a*h),r[3]=-(s*(h*_-u*f)-c*(o*_-a*f)+p*(o*u-a*h)),r[4]=-(l*(f*v-_*y)-d*(h*v-u*y)+m*(h*_-u*f)),r[5]=n*(f*v-_*y)-d*(o*v-a*y)+m*(o*_-a*f),r[6]=-(n*(h*v-u*y)-l*(o*v-a*y)+m*(o*u-a*h)),r[7]=n*(h*_-u*f)-l*(o*_-a*f)+d*(o*u-a*h),r[8]=l*(p*v-_*g)-d*(c*v-u*g)+m*(c*_-u*p),r[9]=-(n*(p*v-_*g)-d*(s*v-a*g)+m*(s*_-a*p)),r[10]=n*(c*v-u*g)-l*(s*v-a*g)+m*(s*u-a*c),r[11]=-(n*(c*_-u*p)-l*(s*_-a*p)+d*(s*u-a*c)),r[12]=-(l*(p*y-f*g)-d*(c*y-h*g)+m*(c*f-h*p)),r[13]=n*(p*y-f*g)-d*(s*y-o*g)+m*(s*f-o*p),r[14]=-(n*(c*y-h*g)-l*(s*y-o*g)+m*(s*h-o*c)),r[15]=n*(c*f-h*p)-l*(s*f-o*p)+d*(s*h-o*c),t},n.toArray=function(t,e,i){void 0===i&&(i=0);for(var r=e.m,n=0;n<16;n++)t[i+n]=r[n];return t},n.fromArray=function(t,e,i){void 0===i&&(i=0);for(var r=t.m,n=0;n<16;n++)r[n]=e[i+n];return t},r.clone=function(){var t=this.m;return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},r.set=function(t){var e=this.m,i=t.m;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},r.equals=function(t){return n.strictEquals(this,t)},r.fuzzyEquals=function(t){return n.equals(this,t)},r.toString=function(){var t=this.m;return t?"[\n"+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+",\n"+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+",\n"+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+",\n"+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]"},r.identity=function(){return n.identity(this)},r.transpose=function(t){return t=t||new n,n.transpose(t,this)},r.invert=function(t){return t=t||new n,n.invert(t,this)},r.adjoint=function(t){return t=t||new n,n.adjoint(t,this)},r.determinant=function(){return n.determinant(this)},r.add=function(t,e){return e=e||new n,n.add(e,this,t)},r.subtract=function(t){return n.subtract(this,this,t)},r.multiply=function(t){return n.multiply(this,this,t)},r.multiplyScalar=function(t){return n.multiplyScalar(this,this,t)},r.translate=function(t,e){return e=e||new n,n.translate(e,this,t)},r.scale=function(t,e){return e=e||new n,n.scale(e,this,t)},r.rotate=function(t,e,i){return i=i||new n,n.rotate(i,this,t,e)},r.getTranslation=function(t){return t=t||new s.default,n.getTranslation(t,this)},r.getScale=function(t){return t=t||new s.default,n.getScaling(t,this)},r.getRotation=function(t){return t=t||new o.default,n.getRotation(t,this)},r.fromRTS=function(t,e,i){return n.fromRTS(this,t,e,i)},r.fromQuat=function(t){return n.fromQuat(this,t)},n}(r.default);i.default=E,E.mul=E.multiply,E.sub=E.subtract,E.IDENTITY=Object.freeze(new E);var D=new s.default,L=new l.default;n.default.fastDefine("cc.Mat4",E,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1});for(var I=function(t){Object.defineProperty(E.prototype,"m"+t,{get:function(){return this.m[t]},set:function(e){this.m[t]=e}})},P=0;P<16;P++)I(P);cc.mat4=function(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,_){var m=new E(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,_);return void 0===t&&E.identity(m),m},cc.Mat4=E,e.exports=i.default},{"../platform/CCClass":196,"./mat3":287,"./quat":289,"./utils":293,"./value-type":294,"./vec3":296}],289:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=l(t("./value-type")),n=l(t("../platform/CCClass")),s=l(t("./vec3")),o=l(t("./mat3")),a=t("./utils");function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var h=0,u=0,d=0,p=0,f=function(t){var e,i;i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,c(e,i);var r=n.prototype;function n(e,i,r,n){var s;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),(s=t.call(this)||this).x=void 0,s.y=void 0,s.z=void 0,s.w=void 0,e&&"object"==typeof e?(s.x=e.x,s.y=e.y,s.z=e.z,s.w=e.w):(s.x=e,s.y=i,s.z=r,s.w=n),s}return r.mul=function(t,e){return n.multiply(e||new n,this,t)},n.clone=function(t){return new n(t.x,t.y,t.z,t.w)},n.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},n.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t},n.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},n.rotationTo=function(t,e,i){var r=s.default.dot(e,i);return r<-.999999?(s.default.cross(g,s.default.RIGHT,e),g.mag()<1e-6&&s.default.cross(g,s.default.UP,e),s.default.normalize(g,g),n.fromAxisAngle(t,g,Math.PI),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(s.default.cross(g,e,i),t.x=g.x,t.y=g.y,t.z=g.z,t.w=1+r,n.normalize(t,t))},n.getAxisAngle=function(t,e){var i=2*Math.acos(e.w),r=Math.sin(i/2);return 0!==r?(t.x=e.x/r,t.y=e.y/r,t.z=e.z/r):(t.x=1,t.y=0,t.z=0),i},n.multiply=function(t,e,i){return h=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,u=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,d=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,p=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z,t.x=h,t.y=u,t.z=d,t.w=p,t},n.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},n.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t},n.rotateX=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i);return h=e.x*n+e.w*r,u=e.y*n+e.z*r,d=e.z*n-e.y*r,p=e.w*n-e.x*r,t.x=h,t.y=u,t.z=d,t.w=p,t},n.rotateY=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i);return h=e.x*n-e.z*r,u=e.y*n+e.w*r,d=e.z*n+e.x*r,p=e.w*n-e.y*r,t.x=h,t.y=u,t.z=d,t.w=p,t},n.rotateZ=function(t,e,i){i*=.5;var r=Math.sin(i),n=Math.cos(i);return h=e.x*n+e.y*r,u=e.y*n-e.x*r,d=e.z*n+e.w*r,p=e.w*n-e.z*r,t.x=h,t.y=u,t.z=d,t.w=p,t},n.rotateAround=function(t,e,i,r){return n.invert(_,e),s.default.transformQuat(g,i,_),n.fromAxisAngle(_,g,r),n.multiply(t,e,_),t},n.rotateAroundLocal=function(t,e,i,r){return n.fromAxisAngle(_,i,r),n.multiply(t,e,_),t},n.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},n.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},n.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t},n.slerp=function(t,e,i,r){var n=0,s=0,o=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;if(o<0&&(o=-o,i.x=-i.x,i.y=-i.y,i.z=-i.z,i.w=-i.w),1-o>1e-6){var a=Math.acos(o),l=Math.sin(a);n=Math.sin((1-r)*a)/l,s=Math.sin(r*a)/l}else n=1-r,s=r;return t.x=n*e.x+s*i.x,t.y=n*e.y+s*i.y,t.z=n*e.z+s*i.z,t.w=n*e.w+s*i.w,t},n.sqlerp=function(t,e,i,r,s,o){return n.slerp(_,e,s,o),n.slerp(m,i,r,o),n.slerp(t,_,m,2*o*(1-o)),t},n.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,r=i?1/i:0;return t.x=-e.x*r,t.y=-e.y*r,t.z=-e.z*r,t.w=e.w*r,t},n.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},n.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},n.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},n.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return i>0&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t},n.fromAxes=function(t,e,i,r){return o.default.set(y,e.x,e.y,e.z,i.x,i.y,i.z,r.x,r.y,r.z),n.normalize(t,n.fromMat3(t,y))},n.fromViewUp=function(t,e,i){return o.default.fromViewUp(y,e,i),n.normalize(t,n.fromMat3(t,y))},n.fromAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t.x=r*e.x,t.y=r*e.y,t.z=r*e.z,t.w=Math.cos(i),t},n.fromAngleZ=function(t,e){return e*=v,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},n.fromMat3=function(t,e){var i=e.m,r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=r+a+u;if(d>0){var p=.5/Math.sqrt(d+1);t.w=.25/p,t.x=(l-h)*p,t.y=(c-s)*p,t.z=(n-o)*p}else if(r>a&&r>u){var f=2*Math.sqrt(1+r-a-u);t.w=(l-h)/f,t.x=.25*f,t.y=(o+n)/f,t.z=(c+s)/f}else if(a>u){var _=2*Math.sqrt(1+a-r-u);t.w=(c-s)/_,t.x=(o+n)/_,t.y=.25*_,t.z=(h+l)/_}else{var m=2*Math.sqrt(1+u-r-a);t.w=(n-o)/m,t.x=(c+s)/m,t.y=(h+l)/m,t.z=.25*m}return t},n.fromEuler=function(t,e,i,r){e*=v,i*=v,r*=v;var n=Math.sin(e),s=Math.cos(e),o=Math.sin(i),a=Math.cos(i),l=Math.sin(r),c=Math.cos(r);return t.x=n*a*c+s*o*l,t.y=s*o*c+n*a*l,t.z=s*a*l-n*o*c,t.w=s*a*c-n*o*l,t},n.toAxisX=function(t,e){var i=2*e.y,r=2*e.z;return t.x=1-i*e.y-r*e.z,t.y=i*e.x+r*e.w,t.z=r*e.x+i*e.w,t},n.toAxisY=function(t,e){var i=2*e.x,r=2*e.y,n=2*e.z;return t.x=r*e.x-n*e.w,t.y=1-i*e.x-n*e.z,t.z=n*e.y+i*e.w,t},n.toAxisZ=function(t,e){var i=2*e.x,r=2*e.y,n=2*e.z;return t.x=n*e.x-r*e.w,t.y=n*e.y-i*e.w,t.z=1-i*e.x-r*e.y,t},n.toEuler=function(t,e,i){var r=e.x,n=e.y,s=e.z,o=e.w,l=0,c=0,h=0,u=r*n+s*o;if(u>.499999)l=0,c=(0,a.toDegree)(2*Math.atan2(r,o)),h=90;else if(u<-.499999)l=0,c=-(0,a.toDegree)(2*Math.atan2(r,o)),h=-90;else{var d=r*r,p=n*n,f=s*s;l=(0,a.toDegree)(Math.atan2(2*r*o-2*n*s,1-2*d-2*f)),c=(0,a.toDegree)(Math.atan2(2*n*o-2*r*s,1-2*p-2*f)),h=(0,a.toDegree)(Math.asin(2*u)),i&&(l=-180*Math.sign(l+1e-6)+l,c=-180*Math.sign(c+1e-6)+c,h=180*Math.sign(h+1e-6)-h)}return t.x=l,t.y=c,t.z=h,t},n.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},n.equals=function(t,e,i){return void 0===i&&(i=a.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},n.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},n.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},r.clone=function(){return new n(this.x,this.y,this.z,this.w)},r.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},r.toEuler=function(t){return n.toEuler(t,this)},r.fromEuler=function(t){return n.fromEuler(this,t.x,t.y,t.z)},r.lerp=function(t,e,i){return i=i||new n,n.slerp(i,this,t,e),i},r.multiply=function(t){return n.multiply(this,this,t)},r.rotateAround=function(t,e,i,r){return r=r||new n,n.rotateAround(r,t,e,i)},n}(r.default);i.default=f,f.mul=f.multiply,f.scale=f.multiplyScalar,f.mag=f.len,f.IDENTITY=Object.freeze(new f);var _=new f,m=new f,g=new s.default,y=new o.default,v=.5*Math.PI/180;n.default.fastDefine("cc.Quat",f,{x:0,y:0,z:0,w:1}),cc.quat=function(t,e,i,r){return new f(t,e,i,r)},cc.Quat=f,e.exports=i.default},{"../platform/CCClass":196,"./mat3":287,"./utils":293,"./value-type":294,"./vec3":296}],290:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=a(t("./value-type")),n=a(t("../platform/CCClass")),s=a(t("./vec2")),o=a(t("./size"));function a(t){return t&&t.__esModule?t:{default:t}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var c=function(t){var e,i;function r(e,i,r,n){var s;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),(s=t.call(this)||this).x=void 0,s.y=void 0,s.width=void 0,s.height=void 0,e&&"object"==typeof e&&(i=e.y,r=e.width,n=e.height,e=e.x),s.x=e||0,s.y=i||0,s.width=r||0,s.height=n||0,s}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,l(e,i),r.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y);return new r(i,n,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-n)};var n,a,c=r.prototype;return c.clone=function(){return new r(this.x,this.y,this.width,this.height)},c.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},c.lerp=function(t,e,i){i=i||new r;var n=this.x,s=this.y,o=this.width,a=this.height;return i.x=n+(t.x-n)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},c.set=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},c.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,r=t.x+t.width,n=t.y+t.height;return!(e<t.x||r<this.x||i<t.y||n<this.y)},c.intersection=function(t,e){var i=this.x,r=this.y,n=this.x+this.width,s=this.y+this.height,o=e.x,a=e.y,l=e.x+e.width,c=e.y+e.height;return t.x=Math.max(i,o),t.y=Math.max(r,a),t.width=Math.min(n,l)-t.x,t.height=Math.min(s,c)-t.y,t},c.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},c.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},c.union=function(t,e){var i=this.x,r=this.y,n=this.width,s=this.height,o=e.x,a=e.y,l=e.width,c=e.height;return t.x=Math.min(i,o),t.y=Math.min(r,a),t.width=Math.max(i+n,o+l)-t.x,t.height=Math.max(r+s,a+c)-t.y,t},c.transformMat4=function(t,e){var i=this.x,r=this.y,n=i+this.width,s=r+this.height,o=e.m,a=o[0]*i+o[4]*r+o[12],l=o[1]*i+o[5]*r+o[13],c=o[0]*n+o[4]*r+o[12],h=o[1]*n+o[5]*r+o[13],u=o[0]*i+o[4]*s+o[12],d=o[1]*i+o[5]*s+o[13],p=o[0]*n+o[4]*s+o[12],f=o[1]*n+o[5]*s+o[13],_=Math.min(a,c,u,p),m=Math.max(a,c,u,p),g=Math.min(l,h,d,f),y=Math.max(l,h,d,f);return t.x=_,t.y=g,t.width=m-_,t.height=y-g,t},c.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n=r,(a=[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new s.default(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new s.default(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new o.default(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(n.prototype,a),Object.defineProperty(n,"prototype",{writable:!1}),r}(r.default);i.default=c,n.default.fastDefine("cc.Rect",c,{x:0,y:0,width:0,height:0}),cc.Rect=c,cc.rect=function(t,e,i,r){return new c(t,e,i,r)},e.exports=i.default},{"../platform/CCClass":196,"./size":291,"./value-type":294,"./vec2":295}],291:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("./value-type")),n=s(t("../platform/CCClass"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a=function(t){var e,i;function r(e,i){var r;return void 0===e&&(e=0),void 0===i&&(i=0),(r=t.call(this)||this).width=void 0,r.height=void 0,e&&"object"==typeof e?(r.width=e.width,r.height=e.height):(r.width=e||0,r.height=i||0),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var n,s,a=r.prototype;return a.clone=function(){return new r(this.width,this.height)},a.equals=function(t){return t&&this.width===t.width&&this.height===t.height},a.lerp=function(t,e,i){i=i||new r;var n=this.width,s=this.height;return i.width=n+(t.width-n)*e,i.height=s+(t.height-s)*e,i},a.set=function(t){return this.width=t.width,this.height=t.height,this},a.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n=r,(s=[{key:"ZERO",get:function(){return new r}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(n,s),Object.defineProperty(n,"prototype",{writable:!1}),r}(r.default);i.default=a,a.ZERO_R=a.ZERO,n.default.fastDefine("cc.Size",a,{width:0,height:0}),cc.size=function(t,e){return new a(t,e)},cc.Size=a,e.exports=i.default},{"../platform/CCClass":196,"./value-type":294}],292:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./quat"))&&r.__esModule?r:{default:r},s=new n.default,o=function(){function t(){}return t.toRotation=function(t,e){return t.x=e[3],t.y=e[4],t.z=e[5],t.w=e[6],t},t.fromRotation=function(t,e){return t[3]=e.x,t[4]=e.y,t[5]=e.z,t[6]=e.w,t},t.toEuler=function(e,i){return t.toRotation(s,i),n.default.toEuler(e,s),e},t.fromEuler=function(e,i){return n.default.fromEuler(s,i.x,i.y,i.z),t.fromRotation(e,s),e},t.fromEulerNumber=function(e,i,r,o){return n.default.fromEuler(s,i,r,o),t.fromRotation(e,s),e},t.toScale=function(t,e){return t.x=e[7],t.y=e[8],t.z=e[9],t},t.fromScale=function(t,e){return t[7]=e.x,t[8]=e.y,t[9]=e.z,t},t.toPosition=function(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t},t.fromPosition=function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t},t.fromAngleZ=function(e,i){return n.default.fromAngleZ(s,i),t.fromRotation(e,s),e},t.toMat4=function(t,e){var i=e[3],r=e[4],n=e[5],s=e[6],o=i+i,a=r+r,l=n+n,c=i*o,h=i*a,u=i*l,d=r*a,p=r*l,f=n*l,_=s*o,m=s*a,g=s*l,y=e[7],v=e[8],b=e[9],x=t.m;return x[0]=(1-(d+f))*y,x[1]=(h+g)*y,x[2]=(u-m)*y,x[3]=0,x[4]=(h-g)*v,x[5]=(1-(c+f))*v,x[6]=(p+_)*v,x[7]=0,x[8]=(u+m)*b,x[9]=(p-_)*b,x[10]=(1-(c+d))*b,x[11]=0,x[12]=e[0],x[13]=e[1],x[14]=e[2],x[15]=1,t},t}();i.default=o,cc.Trs=o,e.exports=i.default},{"./quat":289}],293:[function(t,e,i){i.__esModule=!0,i.INT_MIN=i.INT_MAX=i.INT_BITS=i.FLOAT_BYTES=i.FLOAT_ARRAY_TYPE=i.EPSILON=void 0,i.approx=function(t,e,i){return i=i||s,Math.abs(t-e)<=i},i.clamp=function(t,e,i){return t<e?e:t>i?i:t},i.clamp01=function(t){return t<0?0:t>1?1:t},i.equals=function(t,e){return Math.abs(t-e)<=s*Math.max(1,Math.abs(t),Math.abs(e))},i.inverseLerp=function(t,e,i){return(i-t)/(e-t)},i.lerp=function(t,e,i){return t+(e-t)*i},i.nextPow2=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},i.pingPong=function(t,e){return t=u(t,2*e),e-Math.abs(t-e)},i.pseudoRandom=c,i.pseudoRandomRange=h,i.pseudoRandomRangeInt=function(t,e,i){return Math.floor(h(t,e,i))},i.random=void 0,i.randomRange=l,i.randomRangeInt=function(t,e){return Math.floor(l(t,e))},i.repeat=u,i.sign=function(t){return(t>0)-(t<0)},i.toDegree=function(t){return t*n},i.toRadian=function(t){return t*r};var r=Math.PI/180,n=180/Math.PI,s=1e-6;i.EPSILON=s,i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31;var o=Float64Array;i.FLOAT_ARRAY_TYPE=o,i.FLOAT_BYTES=8;var a=Math.random;function l(t,e){return Math.random()*(e-t)+t}function c(t){return(t=(9301*t+49297)%233280)/233280}function h(t,e,i){return c(t)*(i-e)+e}function u(t,e){return t-Math.floor(t/e)*e}i.random=a},{}],294:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../platform/js"))&&r.__esModule?r:{default:r},s=function(){function t(){}var e=t.prototype;return e.clone=function(){return cc.errorID("0100",n.default.getClassName(this)+".clone"),null},e.equals=function(){return cc.errorID("0100",n.default.getClassName(this)+".equals"),!1},e.lerp=function(){return cc.errorID("0100",n.default.getClassName(this)+".lerp"),this.clone()},e.set=function(){cc.errorID("0100",n.default.getClassName(this)+".set")},e.toString=function(){return""+{}},t}();i.default=s,n.default.setClassName("cc.ValueType",s),cc.ValueType=s,e.exports=i.default},{"../platform/js":217}],295:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=a(t("./value-type")),n=a(t("../platform/CCClass")),s=a(t("../utils/misc")),o=t("./utils");function a(t){return t&&t.__esModule?t:{default:t}}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var c=0,h=0,u=function(t){var e,i;i=t,(e=u).prototype=Object.create(i.prototype),e.prototype.constructor=e,l(e,i);var r,n,a=u.prototype;function u(e,i){var r;return void 0===e&&(e=0),void 0===i&&(i=0),(r=t.call(this)||this).mag=u.prototype.len,r.magSqr=u.prototype.lengthSqr,r.subSelf=u.prototype.subtract,r.mulSelf=u.prototype.multiplyScalar,r.divSelf=u.prototype.divide,r.scaleSelf=u.prototype.multiply,r.negSelf=u.prototype.negate,r.x=void 0,r.y=void 0,r.z=0,e&&"object"==typeof e?(r.x=e.x||0,r.y=e.y||0):(r.x=e||0,r.y=i||0),r}return a.sub=function(t,e){return u.subtract(e||new u,this,t)},a.mul=function(t,e){return u.multiplyScalar(e||new u,this,t)},a.div=function(t,e){return u.multiplyScalar(e||new u,this,1/t)},a.scale=function(t,e){return u.multiply(e||new u,this,t)},a.neg=function(t){return u.negate(t||new u,this)},u.clone=function(t){return new u(t.x,t.y)},u.copy=function(t,e){return t.x=e.x,t.y=e.y,t},u.set=function(t,e,i){return t.x=e,t.y=i,t},u.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},u.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},u.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t},u.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t},u.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},u.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},u.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t},u.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t},u.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},u.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},u.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t},u.distance=function(t,e){return c=e.x-t.x,h=e.y-t.y,Math.sqrt(c*c+h*h)},u.squaredDistance=function(t,e){return c=e.x-t.x,h=e.y-t.y,c*c+h*h},u.len=function(t){return c=t.x,h=t.y,Math.sqrt(c*c+h*h)},u.lengthSqr=function(t){return c=t.x,h=t.y,c*c+h*h},u.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},u.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},u.inverseSafe=function(t,e){return c=e.x,h=e.y,Math.abs(c)<o.EPSILON?t.x=0:t.x=1/c,Math.abs(h)<o.EPSILON?t.y=0:t.y=1/h,t},u.normalize=function(t,e){c=e.x,h=e.y;var i=c*c+h*h;return i>0&&(i=1/Math.sqrt(i),t.x=c*i,t.y=h*i),t},u.dot=function(t,e){return t.x*e.x+t.y*e.y},u.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t},u.lerp=function(t,e,i,r){return c=e.x,h=e.y,t.x=c+r*(i.x-c),t.y=h+r*(i.y-h),t},u.random=function(t,e){e=e||1;var i=2*(0,o.random)()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t},u.transformMat3=function(t,e,i){c=e.x,h=e.y;var r=i.m;return t.x=r[0]*c+r[3]*h+r[6],t.y=r[1]*c+r[4]*h+r[7],t},u.transformMat4=function(t,e,i){c=e.x,h=e.y;var r=i.m;return t.x=r[0]*c+r[4]*h+r[12],t.y=r[1]*c+r[5]*h+r[13],t},u.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},u.equals=function(t,e,i){return void 0===i&&(i=o.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))},u.angle=function(t,e){u.normalize(d,t),u.normalize(p,e);var i=u.dot(d,p);return i>1?0:i<-1?Math.PI:Math.acos(i)},u.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t},u.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t},a.clone=function(){return new u(this.x,this.y)},a.set=function(t){return this.x=t.x,this.y=t.y,this},a.equals=function(t){return t&&this.x===t.x&&this.y===t.y},a.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e},a.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.lerp=function(t,e,i){i=i||new u;var r=this.x,n=this.y;return i.x=r+(t.x-r)*e,i.y=n+(t.y-n)*e,i},a.clampf=function(t,e){return this.x=s.default.clampf(this.x,t.x,e.x),this.y=s.default.clampf(this.y,t.y,e.y),this},a.add=function(t,e){return(e=e||new u).x=this.x+t.x,e.y=this.y+t.y,e},a.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},a.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},a.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},a.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},a.divide=function(t){return this.x/=t,this.y/=t,this},a.negate=function(){return this.x=-this.x,this.y=-this.y,this},a.dot=function(t){return this.x*t.x+this.y*t.y},a.cross=function(t){return this.x*t.y-this.y*t.x},a.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.lengthSqr=function(){return this.x*this.x+this.y*this.y},a.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},a.normalize=function(t){return(t=t||new u).x=this.x,t.y=this.y,t.normalizeSelf(),t},a.angle=function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var r=this.dot(t)/Math.sqrt(e*i);return r=s.default.clampf(r,-1,1),Math.acos(r)},a.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},a.rotate=function(t,e){return(e=e||new u).x=this.x,e.y=this.y,e.rotateSelf(t)},a.rotateSelf=function(t){var e=Math.sin(t),i=Math.cos(t),r=this.x;return this.x=i*r-e*this.y,this.y=e*r+i*this.y,this},a.project=function(t){return t.multiplyScalar(this.dot(t)/t.dot(t))},a.transformMat4=function(t,e){return e=e||new u,u.transformMat4(e,this,t),e},a.maxAxis=function(){return Math.max(this.x,this.y)},r=u,(n=[{key:"ONE",get:function(){return new u(1,1)}},{key:"ZERO",get:function(){return new u(0,0)}},{key:"UP",get:function(){return new u(0,1)}},{key:"RIGHT",get:function(){return new u(1,0)}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r,n),Object.defineProperty(r,"prototype",{writable:!1}),u}(r.default);i.default=u,u.sub=u.subtract,u.mul=u.multiply,u.scale=u.multiplyScalar,u.mag=u.len,u.squaredMagnitude=u.lengthSqr,u.div=u.divide,u.ONE_R=u.ONE,u.ZERO_R=u.ZERO,u.UP_R=u.UP,u.RIGHT_R=u.RIGHT;var d=new u,p=new u;n.default.fastDefine("cc.Vec2",u,{x:0,y:0}),cc.v2=function(t,e){return new u(t,e)},cc.Vec2=u,e.exports=i.default},{"../platform/CCClass":196,"../utils/misc":271,"./utils":293,"./value-type":294}],296:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=l(t("./value-type")),n=l(t("../platform/CCClass")),s=l(t("../utils/misc")),o=l(t("./vec2")),a=t("./utils");function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var h=0,u=0,d=0,p=function(t){var e,i;i=t,(e=p).prototype=Object.create(i.prototype),e.prototype.constructor=e,c(e,i);var r,n,l=p.prototype;function p(e,i,r){var n;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),(n=t.call(this)||this).mag=p.prototype.len,n.magSqr=p.prototype.lengthSqr,n.subSelf=p.prototype.subtract,n.mulSelf=p.prototype.multiplyScalar,n.divSelf=p.prototype.divide,n.scaleSelf=p.prototype.multiply,n.negSelf=p.prototype.negate,n.x=void 0,n.y=void 0,n.z=void 0,n.angle=o.default.prototype.angle,n.project=o.default.prototype.project,e&&"object"==typeof e?(n.x=e.x,n.y=e.y,n.z=e.z):(n.x=e,n.y=i,n.z=r),n}return l.sub=function(t,e){return p.subtract(e||new p,this,t)},l.mul=function(t,e){return p.multiplyScalar(e||new p,this,t)},l.div=function(t,e){return p.multiplyScalar(e||new p,this,1/t)},l.scale=function(t,e){return p.multiply(e||new p,this,t)},l.neg=function(t){return p.negate(t||new p,this)},p.zero=function(t){return t.x=0,t.y=0,t.z=0,t},p.clone=function(t){return new p(t.x,t.y,t.z)},p.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},p.set=function(t,e,i,r){return t.x=e,t.y=i,t.z=r,t},p.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},p.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},p.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t},p.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t},p.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},p.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},p.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t},p.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t},p.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},p.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},p.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t},p.distance=function(t,e){return h=e.x-t.x,u=e.y-t.y,d=e.z-t.z,Math.sqrt(h*h+u*u+d*d)},p.squaredDistance=function(t,e){return h=e.x-t.x,u=e.y-t.y,d=e.z-t.z,h*h+u*u+d*d},p.len=function(t){return h=t.x,u=t.y,d=t.z,Math.sqrt(h*h+u*u+d*d)},p.lengthSqr=function(t){return h=t.x,u=t.y,d=t.z,h*h+u*u+d*d},p.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},p.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},p.inverseSafe=function(t,e){return h=e.x,u=e.y,d=e.z,Math.abs(h)<a.EPSILON?t.x=0:t.x=1/h,Math.abs(u)<a.EPSILON?t.y=0:t.y=1/u,Math.abs(d)<a.EPSILON?t.z=0:t.z=1/d,t},p.normalize=function(t,e){h=e.x,u=e.y,d=e.z;var i=h*h+u*u+d*d;return i>0&&(i=1/Math.sqrt(i),t.x=h*i,t.y=u*i,t.z=d*i),t},p.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},p.cross=function(t,e,i){var r=e.x,n=e.y,s=e.z,o=i.x,a=i.y,l=i.z;return t.x=n*l-s*a,t.y=s*o-r*l,t.z=r*a-n*o,t},p.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t},p.random=function(t,e){e=e||1;var i=2*(0,a.random)()*Math.PI,r=2*(0,a.random)()-1,n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t},p.transformMat4=function(t,e,i){h=e.x,u=e.y,d=e.z;var r=i.m,n=r[3]*h+r[7]*u+r[11]*d+r[15];return n=n?1/n:1,t.x=(r[0]*h+r[4]*u+r[8]*d+r[12])*n,t.y=(r[1]*h+r[5]*u+r[9]*d+r[13])*n,t.z=(r[2]*h+r[6]*u+r[10]*d+r[14])*n,t},p.transformMat4Normal=function(t,e,i){h=e.x,u=e.y,d=e.z;var r=i.m,n=r[3]*h+r[7]*u+r[11]*d;return n=n?1/n:1,t.x=(r[0]*h+r[4]*u+r[8]*d)*n,t.y=(r[1]*h+r[5]*u+r[9]*d)*n,t.z=(r[2]*h+r[6]*u+r[10]*d)*n,t},p.transformMat3=function(t,e,i){h=e.x,u=e.y,d=e.z;var r=i.m;return t.x=h*r[0]+u*r[3]+d*r[6],t.y=h*r[1]+u*r[4]+d*r[7],t.z=h*r[2]+u*r[5]+d*r[8],t},p.transformAffine=function(t,e,i){h=e.x,u=e.y,d=e.z;var r=i.m;return t.x=r[0]*h+r[1]*u+r[2]*d+r[3],t.y=r[4]*h+r[5]*u+r[6]*d+r[7],t.x=r[8]*h+r[9]*u+r[10]*d+r[11],t},p.transformQuat=function(t,e,i){var r=i.w*e.x+i.y*e.z-i.z*e.y,n=i.w*e.y+i.z*e.x-i.x*e.z,s=i.w*e.z+i.x*e.y-i.y*e.x,o=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=r*i.w+o*-i.x+n*-i.z-s*-i.y,t.y=n*i.w+o*-i.y+s*-i.x-r*-i.z,t.z=s*i.w+o*-i.z+r*-i.y-n*-i.x,t},p.transformRTS=function(t,e,i,r,n){var s=e.x*n.x,o=e.y*n.y,a=e.z*n.z,l=i.w*s+i.y*a-i.z*o,c=i.w*o+i.z*s-i.x*a,h=i.w*a+i.x*o-i.y*s,u=-i.x*s-i.y*o-i.z*a;return t.x=l*i.w+u*-i.x+c*-i.z-h*-i.y+r.x,t.y=c*i.w+u*-i.y+h*-i.x-l*-i.z+r.y,t.z=h*i.w+u*-i.z+l*-i.y-c*-i.x+r.z,t},p.transformInverseRTS=function(t,e,i,r,n){var s=e.x-r.x,o=e.y-r.y,a=e.z-r.z,l=i.w*s-i.y*a+i.z*o,c=i.w*o-i.z*s+i.x*a,h=i.w*a-i.x*o+i.y*s,u=i.x*s+i.y*o+i.z*a;return t.x=(l*i.w+u*i.x+c*i.z-h*i.y)/n.x,t.y=(c*i.w+u*i.y+h*i.x-l*i.z)/n.y,t.z=(h*i.w+u*i.z+l*i.y-c*i.x)/n.z,t},p.rotateX=function(t,e,i,r){h=e.x-i.x,u=e.y-i.y,d=e.z-i.z;var n=Math.cos(r),s=Math.sin(r),o=h,a=u*n-d*s,l=u*s+d*n;return t.x=o+i.x,t.y=a+i.y,t.z=l+i.z,t},p.rotateY=function(t,e,i,r){h=e.x-i.x,u=e.y-i.y,d=e.z-i.z;var n=Math.cos(r),s=Math.sin(r),o=d*s+h*n,a=u,l=d*n-h*s;return t.x=o+i.x,t.y=a+i.y,t.z=l+i.z,t},p.rotateZ=function(t,e,i,r){h=e.x-i.x,u=e.y-i.y,d=e.z-i.z;var n=Math.cos(r),s=Math.sin(r),o=h*n-u*s,a=h*s+u*n,l=d;return t.x=o+i.x,t.y=a+i.y,t.z=l+i.z,t},p.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},p.equals=function(t,e,i){void 0===i&&(i=a.EPSILON);var r=t.x,n=t.y,s=t.z,o=e.x,l=e.y,c=e.z;return Math.abs(r-o)<=i*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=i*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=i*Math.max(1,Math.abs(s),Math.abs(c))},p.angle=function(t,e){p.normalize(f,t),p.normalize(_,e);var i=p.dot(f,_);return i>1?0:i<-1?Math.PI:Math.acos(i)},p.projectOnPlane=function(t,e,i){return p.subtract(t,e,p.project(t,e,i))},p.project=function(t,e,i){var r=p.lengthSqr(i);return r<1e-6?p.set(t,0,0,0):p.multiplyScalar(t,i,p.dot(e,i)/r)},p.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t},p.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t},l.clone=function(){return new p(this.x,this.y,this.z)},l.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},l.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},l.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e},l.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},l.lerp=function(t,e,i){return i=i||new p,p.lerp(i,this,t,e),i},l.clampf=function(t,e){return this.x=s.default.clampf(this.x,t.x,e.x),this.y=s.default.clampf(this.y,t.y,e.y),this.z=s.default.clampf(this.z,t.z,e.z),this},l.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},l.add=function(t,e){return(e=e||new p).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e},l.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},l.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},l.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},l.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this},l.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},l.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},l.cross=function(t,e){return e=e||new p,p.cross(e,this,t),e},l.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},l.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},l.normalizeSelf=function(){return p.normalize(this,this),this},l.normalize=function(t){return t=t||new p,p.normalize(t,this),t},l.transformMat4=function(t,e){return e=e||new p,p.transformMat4(e,this,t),e},l.maxAxis=function(){return Math.max(this.x,this.y,this.z)},l.signAngle=function(t){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var e=new o.default(this.x,this.y),i=new o.default(t.x,t.y);return e.signAngle(i)},l.rotate=function(t,e){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),o.default.prototype.rotate.call(this,t,e)},l.rotateSelf=function(t){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),o.default.prototype.rotateSelf.call(this,t)},r=p,(n=[{key:"ONE",get:function(){return new p(1,1,1)}},{key:"ZERO",get:function(){return new p}},{key:"UP",get:function(){return new p(0,1,0)}},{key:"RIGHT",get:function(){return new p(1,0,0)}},{key:"FORWARD",get:function(){return new p(0,0,1)}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r,n),Object.defineProperty(r,"prototype",{writable:!1}),p}(r.default);i.default=p,p.sub=p.subtract,p.mul=p.multiply,p.scale=p.multiplyScalar,p.mag=p.len,p.squaredMagnitude=p.lengthSqr,p.div=p.divide,p.ONE_R=p.ONE,p.ZERO_R=p.ZERO,p.UP_R=p.UP,p.RIGHT_R=p.RIGHT,p.FRONT_R=p.FORWARD;var f=new p,_=new p;n.default.fastDefine("cc.Vec3",p,{x:0,y:0,z:0}),cc.v3=function(t,e,i){return new p(t,e,i)},cc.Vec3=p,e.exports=i.default},{"../platform/CCClass":196,"../utils/misc":271,"./utils":293,"./value-type":294,"./vec2":295}],297:[function(t,e,i){i.__esModule=!0,i.default=void 0,i.v4=p;var r=o(t("../platform/CCClass")),n=o(t("./value-type")),s=t("./utils");function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=0,c=0,h=0,u=0,d=function(t){var e,i;i=t,(e=d).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var r,n,o=d.prototype;function d(e,i,r,n){var s;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),(s=t.call(this)||this).mag=d.prototype.len,s.magSqr=d.prototype.lengthSqr,s.subSelf=d.prototype.subtract,s.mulSelf=d.prototype.multiplyScalar,s.divSelf=d.prototype.divide,s.scaleSelf=d.prototype.multiply,s.negSelf=d.prototype.negate,s.x=void 0,s.y=void 0,s.z=void 0,s.w=void 0,e&&"object"==typeof e?(s.x=e.x,s.y=e.y,s.z=e.z,s.w=e.w):(s.x=e,s.y=i,s.z=r,s.w=n),s}return o.sub=function(t,e){return d.subtract(e||new d,this,t)},o.mul=function(t,e){return d.multiplyScalar(e||new d,this,t)},o.div=function(t,e){return d.multiplyScalar(e||new d,this,1/t)},o.scale=function(t,e){return d.multiply(e||new d,this,t)},o.neg=function(t){return d.negate(t||new d,this)},d.clone=function(t){return new d(t.x,t.y,t.z,t.w)},d.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},d.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t},d.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t},d.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t},d.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t},d.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t},d.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},d.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},d.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t},d.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t},d.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},d.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t},d.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t},d.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return Math.sqrt(i*i+r*r+n*n+s*s)},d.squaredDistance=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return i*i+r*r+n*n+s*s},d.len=function(t){return l=t.x,c=t.y,h=t.z,u=t.w,Math.sqrt(l*l+c*c+h*h+u*u)},d.lengthSqr=function(t){return l=t.x,c=t.y,h=t.z,u=t.w,l*l+c*c+h*h+u*u},d.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},d.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},d.inverseSafe=function(t,e){return l=e.x,c=e.y,h=e.z,u=e.w,Math.abs(l)<s.EPSILON?t.x=0:t.x=1/l,Math.abs(c)<s.EPSILON?t.y=0:t.y=1/c,Math.abs(h)<s.EPSILON?t.z=0:t.z=1/h,Math.abs(u)<s.EPSILON?t.w=0:t.w=1/u,t},d.normalize=function(t,e){l=e.x,c=e.y,h=e.z,u=e.w;var i=l*l+c*c+h*h+u*u;return i>0&&(i=1/Math.sqrt(i),t.x=l*i,t.y=c*i,t.z=h*i,t.w=u*i),t},d.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},d.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t},d.random=function(t,e){e=e||1;var i=2*(0,s.random)()*Math.PI,r=2*(0,s.random)()-1,n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t.w=0,t},d.transformMat4=function(t,e,i){l=e.x,c=e.y,h=e.z,u=e.w;var r=i.m;return t.x=r[0]*l+r[4]*c+r[8]*h+r[12]*u,t.y=r[1]*l+r[5]*c+r[9]*h+r[13]*u,t.z=r[2]*l+r[6]*c+r[10]*h+r[14]*u,t.w=r[3]*l+r[7]*c+r[11]*h+r[15]*u,t},d.transformAffine=function(t,e,i){l=e.x,c=e.y,h=e.z,u=e.w;var r=i.m;return t.x=r[0]*l+r[1]*c+r[2]*h+r[3]*u,t.y=r[4]*l+r[5]*c+r[6]*h+r[7]*u,t.x=r[8]*l+r[9]*c+r[10]*h+r[11]*u,t.w=e.w,t},d.transformQuat=function(t,e,i){var r=e.x,n=e.y,s=e.z;l=i.x,c=i.y,h=i.z;var o=(u=i.w)*r+c*s-h*n,a=u*n+h*r-l*s,d=u*s+l*n-c*r,p=-l*r-c*n-h*s;return t.x=o*u+p*-l+a*-h-d*-c,t.y=a*u+p*-c+d*-l-o*-h,t.z=d*u+p*-h+o*-c-a*-l,t.w=e.w,t},d.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},d.equals=function(t,e,i){return void 0===i&&(i=s.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w))},d.toArray=function(t,e,i){return void 0===i&&(i=0),t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t},d.fromArray=function(t,e,i){return void 0===i&&(i=0),t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t},o.clone=function(){return new d(this.x,this.y,this.z,this.w)},o.set=function(t,e,i,r){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0),this},o.equals=function(t,e){return void 0===e&&(e=s.EPSILON),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},o.equals4f=function(t,e,i,r,n){return void 0===n&&(n=s.EPSILON),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=n*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-r)<=n*Math.max(1,Math.abs(this.w),Math.abs(r))},o.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},o.strictEquals4f=function(t,e,i,r){return this.x===t&&this.y===e&&this.z===i&&this.w===r},o.lerp=function(t,e){return l=this.x,c=this.y,h=this.z,u=this.w,this.x=l+e*(t.x-l),this.y=c+e*(t.y-c),this.z=h+e*(t.z-h),this.w=u+e*(t.w-u),this},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},o.clampf=function(t,e){return this.x=(0,s.clamp)(this.x,t.x,e.x),this.y=(0,s.clamp)(this.y,t.y,e.y),this.z=(0,s.clamp)(this.z,t.z,e.z),this.w=(0,s.clamp)(this.w,t.w,e.w),this},o.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},o.add=function(t,e){return(e=e||new d).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e},o.subtract=function(t,e){return(e=e||new d).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e},o.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},o.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},o.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},o.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},o.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},o.cross=function(t,e){e=e||new d;var i=this.x,r=this.y,n=this.z,s=t.x,o=t.y,a=t.z;return e.x=r*a-n*o,e.y=n*s-i*a,e.z=i*o-r*s,e},o.len=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return Math.sqrt(t*t+e*e+i*i+r*r)},o.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return t*t+e*e+i*i+r*r},o.normalizeSelf=function(){return this.normalize(this),this},o.normalize=function(t){t=t||new d,l=this.x,c=this.y,h=this.z,u=this.w;var e=l*l+c*c+h*h+u*u;return e>0&&(e=1/Math.sqrt(e),t.x=l*e,t.y=c*e,t.z=h*e,t.w=u*e),t},o.transformMat4=function(t,e){e=e||new d,l=this.x,c=this.y,h=this.z,u=this.w;var i=t.m;return e.x=i[0]*l+i[4]*c+i[8]*h+i[12]*u,e.y=i[1]*l+i[5]*c+i[9]*h+i[13]*u,e.z=i[2]*l+i[6]*c+i[10]*h+i[14]*u,e.w=i[3]*l+i[7]*c+i[11]*h+i[15]*u,e},o.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w)},r=d,(n=[{key:"ZERO",get:function(){return new d(0,0,0,0)}},{key:"ONE",get:function(){return new d(1,1,1,1)}},{key:"NEG_ONE",get:function(){return new d(-1,-1,-1,-1)}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r,n),Object.defineProperty(r,"prototype",{writable:!1}),d}(n.default);function p(t,e,i,r){return new d(t,e,i,r)}i.default=d,d.sub=d.subtract,d.mul=d.multiply,d.div=d.divide,d.scale=d.multiplyScalar,d.mag=d.len,d.squaredMagnitude=d.lengthSqr,d.ZERO_R=d.ZERO,d.ONE_R=d.ONE,d.NEG_ONE_R=d.NEG_ONE,r.default.fastDefine("cc.Vec4",d,{x:0,y:0,z:0,w:0}),cc.v4=p,cc.Vec4=d},{"../platform/CCClass":196,"./utils":293,"./value-type":294}],298:[function(){cc.js},{}],299:[function(t){t("./core/CCGame"),t("./actions")},{"./actions":7,"./core/CCGame":28}],300:[function(t,e){var i=t("../compression/zlib.min"),r=t("../core/CCDebug"),n=function(t){var e,i,n,s,o,a,l,c,h,u,d,p,f;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(e=this.readUInt32(),c=function(){var t,e;for(e=[],t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},s=this.readUInt16(),n=this.readUInt16()||100,o.delay=1e3*s/n,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(this.pos+=4,e-=4),t=(null!=o?o.data:void 0)||this.imgData,d=0;0<=e?d<e:d>e;0<=e?++d:--d)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),(h=255-this.transparency.indexed.length)>0)for(p=0;0<=h?p<h:p>h;0<=h?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":a=(u=this.read(e)).indexOf(0),l=String.fromCharCode.apply(String,u.slice(0,a)),this.text[l]=String.fromCharCode.apply(String,u.slice(a+1));break;case"IEND":return o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error(r.getError(6017))}};n.prototype={constructor:n,read:function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(t){var e,n,s,o,a,l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S,w;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);for(t=new i.Inflate(t,{index:0,verify:!1}).decompress(),y=(f=this.pixelBitlength/8)*this.width,_=new Uint8Array(y*this.height),l=t.length,g=0,m=0,n=0;m<l;){switch(t[m++]){case 0:for(o=x=0;x<y;o=x+=1)_[n++]=t[m++];break;case 1:for(o=T=0;T<y;o=T+=1)e=t[m++],a=o<f?0:_[n-f],_[n++]=(e+a)%256;break;case 2:for(o=C=0;C<y;o=C+=1)e=t[m++],s=(o-o%f)/f,v=g&&_[(g-1)*y+s*f+o%f],_[n++]=(v+e)%256;break;case 3:for(o=S=0;S<y;o=S+=1)e=t[m++],s=(o-o%f)/f,a=o<f?0:_[n-f],v=g&&_[(g-1)*y+s*f+o%f],_[n++]=(e+Math.floor((a+v)/2))%256;break;case 4:for(o=w=0;w<y;o=w+=1)e=t[m++],s=(o-o%f)/f,a=o<f?0:_[n-f],0===g?v=b=0:(v=_[(g-1)*y+s*f+o%f],b=s&&_[(g-1)*y+(s-1)*f+o%f]),c=a+v-b,h=Math.abs(c-a),d=Math.abs(c-v),p=Math.abs(c-b),u=h<=d&&h<=p?a:d<=p?v:b,_[n++]=(e+u)%256;break;default:throw new Error(r.getError(6018,t[m-1]))}g++}return _},copyToImageData:function(t,e){var i,r,n,s,o,a,l,c,h,u,d;if(r=this.colors,h=null,i=this.hasAlphaChannel,this.palette.length&&(h=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),r=4,i=!0),c=(n=t.data||t).length,o=h||e,s=a=0,1===r)for(;s<c;)l=h?4*e[s/4]:a,u=o[l++],n[s++]=u,n[s++]=u,n[s++]=u,n[s++]=i?o[l++]:255,a=l;else for(;s<c;)l=h?4*e[s/4]:a,n[s++]=o[l++],n[s++]=o[l++],n[s++]=o[l++],n[s++]=i?o[l++]:255,a=l},decodePalette:function(){var t,e,i,r,n,s,o,a,l;for(i=this.palette,s=this.transparency.indexed||[],n=new Uint8Array((s.length||0)+i.length),r=0,t=0,e=o=0,a=i.length;o<a;e=o+=3)n[r++]=i[e],n[r++]=i[e+1],n[r++]=i[e+2],n[r++]=null!=(l=s[t++])?l:255;return n},render:function(t){var e,i;return t.width=this.width,t.height=this.height,i=(e=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),e.putImageData(i,0,0)}},e.exports=n},{"../compression/zlib.min":25,"../core/CCDebug":26}],301:[function(t,e){var i=t("../core/assets/CCAsset"),r=t("../core/assets/CCSpriteFrame"),n=cc.Class({name:"cc.ParticleAsset",extends:i,properties:{spriteFrame:{default:null,type:r}}});cc.ParticleAsset=e.exports=n},{"../core/assets/CCAsset":62,"../core/assets/CCSpriteFrame":74}],302:[function(t,e){var i=t("../core/platform/CCMacro"),r=t("./CCParticleAsset"),n=t("../core/components/CCRenderComponent"),s=t("../compression/ZipUtils"),o=t("./CCPNGReader"),a=t("./CCTIFFReader"),l=t("../core/utils/texture-util"),c=(t("../core/renderer/render-flow"),t("./particle-simulator")),h=(t("../core/assets/material/CCMaterial"),t("../core/utils/blend-func")),u=cc.Enum({GRAVITY:0,RADIUS:1}),d=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),p={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())},animatable:!1,tooltip:!1},_file:{default:null,type:r},file:{get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)},animatable:!1,type:r,tooltip:!1},_spriteFrame:{default:null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame},set:function(t){var e=this._renderSpriteFrame;e!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame(e))},type:cc.SpriteFrame,tooltip:!1},_texture:{default:null,type:cc.Texture2D,editorOnly:!0},texture:{get:function(){return this._getTexture()},set:function(t){t&&cc.warnID(6017)},type:cc.Texture2D,tooltip:!1,readonly:!0,visible:!1,animatable:!1},particleCount:{visible:!1,get:function(){return this._simulator.particles.length},readonly:!0},_stopped:!0,stopped:{get:function(){return this._stopped},animatable:!1,visible:!1},playOnLoad:!0,autoRemoveOnFinish:{default:!1,animatable:!1,tooltip:!1},active:{get:function(){return this._simulator.active},visible:!1},totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,_startColor:null,startColor:{type:cc.Color,get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},_startColorVar:null,startColorVar:{type:cc.Color,get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},_endColor:null,endColor:{type:cc.Color,get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},_endColorVar:null,endColorVar:{type:cc.Color,get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.Vec2.ZERO,posVar:cc.Vec2.ZERO,_positionType:{default:d.FREE,formerlySerializedAs:"positionType"},positionType:{type:d,get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},emitterMode:{default:u.GRAVITY,type:u},gravity:cc.Vec2.ZERO,speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},f=cc.Class({name:"cc.ParticleSystem",extends:n,mixins:[h],editor:!1,ctor:function(){this.initProperties()},initProperties:function(){this._previewTimer=null,this._focused=!1,this._aspectRatio=1,this._simulator=new c(this),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(0,0,0,0),this._endColor=cc.color(255,255,255,0),this._endColorVar=cc.color(0,0,0,0),this._renderSpriteFrame=null},properties:p,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:u,PositionType:d,_PNGReader:o,_TIFFReader:a},onFocusInEditor:!1,onLostFocusInEditor:!1,onRestore:!1,_startPreview:!1,_stopPreview:!1,_convertTextureToSpriteFrame:!1,__preload:function(){this._super(),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame(this.spriteFrame):this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},onDestroy:function(){this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._simulator._uvFilled=0,this._super()},lateUpdate:function(t){this._simulator.finished||this._simulator.step(t)},addParticle:function(){},stopSystem:function(){this._stopped=!0,this._simulator.stop()},resetSystem:function(){this._stopped=!1,this._simulator.reset(),this.markForRender(!0)},isFull:function(){return this.particleCount>=this.totalParticles},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this.spriteFrame=new cc.SpriteFrame(t,e))},_applyFile:function(){var t=this._file;if(t){var e=this;cc.assetManager.postLoadNative(t,(function(i){!i&&t._nativeAsset?e.isValid&&(e._plistFile=t.nativeUrl,e._custom||(e._spriteFrame!==t.spriteFrame&&(e.spriteFrame=t.spriteFrame),e._initWithDictionary(t._nativeAsset)),e._spriteFrame?!e._renderSpriteFrame&&e._spriteFrame&&e._applySpriteFrame(e.spriteFrame):t.spriteFrame?e.spriteFrame=t.spriteFrame:e._custom&&e._initTextureWithDictionary(t._nativeAsset)):cc.errorID(6029)}))}},_initTextureWithDictionary:function(t){var e,r=cc.path.changeBasename(this._plistFile,t.textureFileName||"");if(t.textureFileName)l.loadImage(r,(function(e,i){e?(t.textureFileName=void 0,this._initTextureWithDictionary(t)):(cc.assetManager.assets.add(r,i),this.spriteFrame=new cc.SpriteFrame(i))}),this);else if(t.textureImageData){var n=t.textureImageData;if(!(n&&n.length>0))return!1;var c=cc.assetManager.assets.get(r);if(!c){var h=s.unzipBase64AsArray(n,1);if(!h)return cc.warnID(6030,this._file.name),!1;var u=(e=h).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?i.ImageFormat.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?i.ImageFormat.TIFF:i.ImageFormat.UNKNOWN;if(u!==i.ImageFormat.TIFF&&u!==i.ImageFormat.PNG)return cc.warnID(6031,this._file.name),!1;var d=document.createElement("canvas");u===i.ImageFormat.PNG?new o(h).render(d):a.parseTIFF(h,d),c=l.cacheImage(r,d)}c||cc.warnID(6032,this._file.name),this.spriteFrame=new cc.SpriteFrame(c)}return!0},_initWithDictionary:function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||i.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||i.ONE_MINUS_SRC_ALPHA);var r=this._startColor;r.r=255*parseFloat(t.startColorRed||0),r.g=255*parseFloat(t.startColorGreen||0),r.b=255*parseFloat(t.startColorBlue||0),r.a=255*parseFloat(t.startColorAlpha||0);var n=this._startColorVar;n.r=255*parseFloat(t.startColorVarianceRed||0),n.g=255*parseFloat(t.startColorVarianceGreen||0),n.b=255*parseFloat(t.startColorVarianceBlue||0),n.a=255*parseFloat(t.startColorVarianceAlpha||0);var s=this._endColor;s.r=255*parseFloat(t.finishColorRed||0),s.g=255*parseFloat(t.finishColorGreen||0),s.b=255*parseFloat(t.finishColorBlue||0),s.a=255*parseFloat(t.finishColorAlpha||0);var o=this._endColorVar;if(o.r=255*parseFloat(t.finishColorVarianceRed||0),o.g=255*parseFloat(t.finishColorVarianceGreen||0),o.b=255*parseFloat(t.finishColorVarianceBlue||0),o.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:d.RELATIVE),this.sourcePos.x=0,this.sourcePos.y=0,this.posVar.x=parseFloat(t.sourcePositionVariancex||0),this.posVar.y=parseFloat(t.sourcePositionVariancey||0),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||u.GRAVITY),this.emitterMode===u.GRAVITY){this.gravity.x=parseFloat(t.gravityx||0),this.gravity.y=parseFloat(t.gravityy||0),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var a=t.rotationIsDir||"";null!==a?(a=a.toString().toLowerCase(),this.rotationIsDir="true"===a||"1"===a):this.rotationIsDir=!1}else{if(this.emitterMode!==u.RADIUS)return cc.warnID(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},_validateRender:function(){var t=this._getTexture();t&&t.loaded?this._super():this.disableRender()},_onTextureLoaded:function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this.markForRender(!0)},_syncAspect:function(){var t=this._renderSpriteFrame._rect;this._aspectRatio=t.width/t.height},_applySpriteFrame:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.onTextureLoaded(this._onTextureLoaded,this))},_getTexture:function(){return this._renderSpriteFrame&&this._renderSpriteFrame.getTexture()||this._texture},_updateMaterial:function(){var t=this.getMaterial(0);t&&(t.define("CC_USE_MODEL",this._positionType!==d.FREE),t.setProperty("texture",this._getTexture()),h.prototype._updateMaterial.call(this))},_finishedSimulation:function(){this.resetSystem(),this.stopSystem(),this.disableRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()}});cc.ParticleSystem=e.exports=f},{"../compression/ZipUtils":22,"../core/assets/material/CCMaterial":81,"../core/components/CCRenderComponent":117,"../core/platform/CCMacro":201,"../core/renderer/render-flow":228,"../core/utils/blend-func":265,"../core/utils/texture-util":279,"./CCPNGReader":300,"./CCParticleAsset":301,"./CCTIFFReader":303,"./particle-simulator":305,"fire-url":void 0}],303:[function(t,e){var i=t("../core/CCDebug"),r={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(i.getError(6019));this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError(i.getError(6020));return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(cc.logID(6021,t),"Tag"+t)},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null},getFieldValues:function(t,e,i,r){var n=[],s=this.getFieldTypeLength(e);if(s*i<=4)!1===this.littleEndian?n.push(r>>>8*(4-s)):n.push(r);else for(var o=0;o<i;o++){var a=s*o;s>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(n.push(this.getUint32(r+a)),n.push(this.getUint32(r+a+4))):cc.logID(8e3):n.push(this.getBytes(s,r+a))}return"ASCII"===e&&n.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),n},getBytes:function(t,e){if(t<=0)cc.logID(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);cc.logID(8002)}},getBits:function(t,e,i){i=i||0;var r,n,s=e+Math.floor(i/8),o=i+t,a=32-t;return o<=0?cc.logID(6023):o<=8?(r=24+i,n=this.getUint8(s)):o<=16?(r=16+i,n=this.getUint16(s)):o<=32?(r=i,n=this.getUint32(s)):cc.logID(6022),{bits:n<<r>>>a,byteOffset:s+Math.floor(o/8),bitOffset:o%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],r=t+2,n=0;n<e;r+=12,n++){var s=this.getUint16(r),o=this.getUint16(r+2),a=this.getUint32(r+4),l=this.getUint32(r+8),c=this.getFieldTagName(s),h=this.getFieldTypeName(o),u=this.getFieldValues(c,h,a,l);i[c]={type:h,values:u}}this._fileDirectories.push(i);var d=this.getUint32(r);0!==d&&this.parseFileDirectory(d)},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],s=n.ImageWidth.values[0],o=n.ImageLength.values[0];this.canvas.width=s,this.canvas.height=o;var a=[],l=n.Compression?n.Compression.values[0]:1,c=n.SamplesPerPixel.values[0],h=[],u=0,d=!1;if(n.BitsPerSample.values.forEach((function(t,e){h[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(h[e].hasBytesPerSample=!0,h[e].bytesPerSample=t/8),u+=t}),this),u%8==0){d=!0;var p=u/8}var f=n.StripOffsets.values,_=f.length;if(n.StripByteCounts)var m=n.StripByteCounts.values;else{if(cc.logID(8003),1!==_)throw Error(i.getError(6024));m=[Math.ceil(s*o*u/8)]}for(var g=0;g<_;g++){var y=f[g];a[g]=[];for(var v=m[g],b=0,x=0,T=1,C=!0,S=[],w=0,A=0,E=0;b<v;b+=T)switch(l){case 1:var D=0;for(S=[];D<c;D++){if(!h[D].hasBytesPerSample){var L=this.getBits(h[D].bitsPerSample,y+b,x);throw S.push(L.bits),b=L.byteOffset-y,x=L.bitOffset,RangeError(i.getError(6025))}var I=h[D].bytesPerSample*D;S.push(this.getBytes(h[D].bytesPerSample,y+b+I))}if(a[g].push(S),!d)throw T=0,RangeError(i.getError(6026));T=p;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var P=1,M=1,R=this.getInt8(y+b);R>=0&&R<=127?P=R+1:R>=-127&&R<=-1?M=1-R:C=!0}else{var O=this.getUint8(y+b);for(D=0;D<M;D++){if(!h[A].hasBytesPerSample)throw RangeError(i.getError(6025));E=E<<8*w|O,++w===h[A].bytesPerSample&&(S.push(E),E=w=0,A++),A===c&&(a[g].push(S),S=[],A=0)}0==--P&&(C=!0)}T=1}}if(e.getContext){var B=this.canvas.getContext("2d");B.fillStyle="rgba(255, 255, 255, 0)";var N=n.RowsPerStrip?n.RowsPerStrip.values[0]:o,k=a.length,F=o%N,V=0===F?N:F,j=N,G=0,U=n.PhotometricInterpretation.values[0],Y=[],H=0;if(n.ExtraSamples&&(H=(Y=n.ExtraSamples.values).length),n.ColorMap)var X=n.ColorMap.values,z=Math.pow(2,h[0].bitsPerSample);for(g=0;g<k;g++){g+1===k&&(j=V);for(var W=a[g].length,Z=G*g,J=0,q=0;q<W;J++)for(var K=0;K<s;K++,q++){var Q=a[g][q],$=0,tt=0,et=0,it=1;if(H>0)for(var rt=0;rt<H;rt++)if(1===Y[rt]||2===Y[rt]){it=Q[3+rt]/256;break}switch(U){case 0:if(h[0].hasBytesPerSample)var nt=Math.pow(16,2*h[0].bytesPerSample);Q.forEach((function(t,e,i){i[e]=nt-t}));case 1:$=tt=et=this.clampColorSample(Q[0],h[0].bitsPerSample);break;case 2:$=this.clampColorSample(Q[0],h[0].bitsPerSample),tt=this.clampColorSample(Q[1],h[1].bitsPerSample),et=this.clampColorSample(Q[2],h[2].bitsPerSample);break;case 3:if(void 0===X)throw Error(i.getError(6027));var st=Q[0];$=this.clampColorSample(X[st],16),tt=this.clampColorSample(X[z+st],16),et=this.clampColorSample(X[2*z+st],16);break;default:throw RangeError(i.getError(6028,U))}B.fillStyle="rgba("+$+", "+tt+", "+et+", "+it+")",B.fillRect(K,Z+J,1,1)}G=j}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};e.exports=r},{"../core/CCDebug":26}],304:[function(t){t("./CCParticleAsset"),t("./CCParticleSystem"),t("./particle-simulator"),t("./particle-system-assembler")},{"./CCParticleAsset":301,"./CCParticleSystem":302,"./particle-simulator":305,"./particle-system-assembler":306}],305:[function(t,e){var i=t("../core/platform/js"),r=t("../core/utils/misc"),n=cc.v2(0,0),s=cc.v2(),o=cc.v2(),a=cc.v2(),l=cc.v2(),c=function(){this.pos=cc.v2(0,0),this.startPos=cc.v2(0,0),this.color=cc.color(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.preciseColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=cc.v2(0,0),this.aspectRatio=1,this.dir=cc.v2(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},h=new i.Pool((function(t){t.pos.set(n),t.startPos.set(n),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(n),t.aspectRatio=1,t.dir.set(n),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024);h.get=function(){return this._get()||new c};var u=function(t){this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this._uvFilled=0,this._worldRotation=0};u.prototype.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},u.prototype.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)h.put(t[e]);t.length=0;var i=this.sys._assembler;i&&i._ia&&(i._ia._count=0)},u.prototype.emitParticle=function(t){var e=this.sys,i=r.clampf,n=h.get();this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var s,o,a,l,c=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var u=e._startColor,d=e._startColorVar,p=e._endColor,f=e._endColorVar;n.color.r=s=i(u.r+d.r*(Math.random()-.5)*2,0,255),n.color.g=o=i(u.g+d.g*(Math.random()-.5)*2,0,255),n.color.b=a=i(u.b+d.b*(Math.random()-.5)*2,0,255),n.color.a=l=i(u.a+d.a*(Math.random()-.5)*2,0,255);var _=n.color,m=n.preciseColor;m.r=_.r,m.g=_.g,m.b=_.b,m.a=_.a,n.deltaColor.r=(i(p.r+f.r*(Math.random()-.5)*2,0,255)-s)/c,n.deltaColor.g=(i(p.g+f.g*(Math.random()-.5)*2,0,255)-o)/c,n.deltaColor.b=(i(p.b+f.b*(Math.random()-.5)*2,0,255)-a)/c,n.deltaColor.a=(i(p.a+f.a*(Math.random()-.5)*2,0,255)-l)/c;var g=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(g=Math.max(0,g),n.size=g,e.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)n.deltaSize=0;else{var y=e.endSize+e.endSizeVar*(Math.random()-.5)*2;y=Math.max(0,y),n.deltaSize=(y-g)/c}var v=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,b=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;n.rotation=v,n.deltaRotation=(b-v)/c,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=e._aspectRatio||1;var x=r.degreesToRadians(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY){var T=e.speed+e.speedVar*(Math.random()-.5)*2;n.dir.x=Math.cos(x),n.dir.y=Math.sin(x),n.dir.mulSelf(T),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-r.radiansToDegrees(Math.atan2(n.dir.y,n.dir.x)))}else{var C=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,S=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;n.radius=C,n.deltaRadius=e.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(S-C)/c,n.angle=x,n.degreesPerSecond=r.degreesToRadians(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},u.prototype.updateUVs=function(t){var e=this.sys._assembler;if(e){var i=e.getBuffer();if(i&&this.sys._renderSpriteFrame){for(var r=4*e._vfmt._bytes/4,n=i._vData,s=this.sys._renderSpriteFrame.uv,o=t?0:this._uvFilled,a=this.particles.length,l=o;l<a;l++){var c=l*r;n[c+2]=s[0],n[c+3]=s[1],n[c+7]=s[2],n[c+8]=s[3],n[c+12]=s[4],n[c+13]=s[5],n[c+17]=s[6],n[c+18]=s[7]}this._uvFilled=a}}},u.prototype.updateParticleBuffer=function(t,e,i,n){var s=i._vData,o=i._uintVData,a=e.x,l=e.y,c=t.size,h=c,u=t.aspectRatio;u>1?h=c/u:c=h*u;var d=c/2,p=h/2;if(t.rotation){var f=-d,_=-p,m=d,g=p,y=-r.degreesToRadians(t.rotation),v=Math.cos(y),b=Math.sin(y);s[n]=f*v-_*b+a,s[n+1]=f*b+_*v+l,s[n+5]=m*v-_*b+a,s[n+6]=m*b+_*v+l,s[n+10]=f*v-g*b+a,s[n+11]=f*b+g*v+l,s[n+15]=m*v-g*b+a,s[n+16]=m*b+g*v+l}else s[n]=a-d,s[n+1]=l-p,s[n+5]=a+d,s[n+6]=l-p,s[n+10]=a-d,s[n+11]=l+p,s[n+15]=a+d,s[n+16]=l+p;o[n+4]=t.color._val,o[n+9]=t.color._val,o[n+14]=t.color._val,o[n+19]=t.color._val},u.prototype.step=function(t){t=t>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:t;var e=this.sys,i=e.node,r=this.particles,n=4*this.sys._assembler._vfmt._bytes/4,c=cc.ParticleSystem.PositionType;if(i._updateWorldMatrix(),e.positionType===c.FREE){this._worldRotation=function(t){for(var e=0,i=t;i;)e+=i.angle,i=i.parent;return e}(i);var u=i._worldMatrix.m;s.x=u[12],s.y=u[13]}else e.positionType===c.RELATIVE?(this._worldRotation=i.angle,s.x=i.x,s.y=i.y):this._worldRotation=0;if(this.active&&e.emissionRate){var d=1/e.emissionRate;for(r.length<e.totalParticles&&(this.emitCounter+=t);r.length<e.totalParticles&&this.emitCounter>d;)this.emitParticle(s),this.emitCounter-=d;this.elapsed+=t,-1!==e.duration&&e.duration<this.elapsed&&e.stopSystem()}var p=e._assembler.getBuffer(),f=r.length;p.reset(),p.request(4*f,6*f),f>this._uvFilled&&this.updateUVs();for(var _=0;_<r.length;){o.x=o.y=a.x=a.y=l.x=l.y=0;var m=r[_];if(m.timeToLive-=t,m.timeToLive>0){if(e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY){var g=l,y=o,v=a;(m.pos.x||m.pos.y)&&(y.set(m.pos),y.normalizeSelf()),v.set(y),y.mulSelf(m.radialAccel);var b=v.x;v.x=-v.y,v.y=b,v.mulSelf(m.tangentialAccel),g.set(y),g.addSelf(v),g.addSelf(e.gravity),g.mulSelf(t),m.dir.addSelf(g),g.set(m.dir),g.mulSelf(t),m.pos.addSelf(g)}else m.angle+=m.degreesPerSecond*t,m.radius+=m.deltaRadius*t,m.pos.x=-Math.cos(m.angle)*m.radius,m.pos.y=-Math.sin(m.angle)*m.radius;var x=m.preciseColor,T=m.deltaColor;x.r+=T.r*t,x.g+=T.g*t,x.b+=T.b*t,x.a+=T.a*t;var C=m.color;C.r=x.r,C.g=x.g,C.b=x.b,C.a=x.a,m.size+=m.deltaSize*t,m.size<0&&(m.size=0),m.rotation+=m.deltaRotation*t;var S=o;S.set(m.pos),e.positionType!==c.GROUPED&&S.addSelf(m.startPos);var w=n*_;this.updateParticleBuffer(m,S,p,w),++_}else{var A=r[_];_!==r.length-1&&(r[_]=r[r.length-1]),h.put(A),r.length--}}e._assembler._ia._count=6*r.length,r.length>0?p.uploadData():this.active||this.readyToPlay||(this.finished=!0,e._finishedSimulation())},e.exports=u},{"../core/platform/js":217,"../core/utils/misc":271}],306:[function(t,e){var i=n(t("../core/renderer/assembler")),r=n(t("../renderer/core/input-assembler"));function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o=t("./CCParticleSystem"),a=t("../core/renderer/"),l=t("../core/renderer/webgl/quad-buffer"),c=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,h=function(t){var e,i;function n(e){var i;return(i=t.call(this,e)||this)._buffer=null,i._ia=null,i._vfmt=c,i}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var o=n.prototype;return o.getBuffer=function(){return this._buffer||(this._buffer=new l(a._handle,c),this._ia=new r.default,this._ia._vertexBuffer=this._buffer._vb,this._ia._indexBuffer=this._buffer._ib,this._ia._start=0,this._ia._count=0),this._buffer},o.fillBuffers=function(t,e){if(this._ia){var i=cc.ParticleSystem.PositionType;t.positionType===i.RELATIVE?e.node=t.node.parent:e.node=t.node,e.material=t._materials[0],e._flushIA(this._ia)}},n}(i.default);i.default.register(o,h),e.exports=h},{"../core/renderer/":227,"../core/renderer/assembler":224,"../core/renderer/webgl/quad-buffer":257,"../core/renderer/webgl/vertex-format":260,"../renderer/core/input-assembler":309,"./CCParticleSystem":302}],307:[function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S,w,A,E,D,L,I,P,M,R,O,B,N,k,F,V,j,G,U,Y;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL"})(i||(i={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BUFFER=1]="BUFFER",t[t.TEXTURE=2]="TEXTURE",t[t.TEXTURE_VIEW=3]="TEXTURE_VIEW",t[t.RENDER_PASS=4]="RENDER_PASS",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.SAMPLER=6]="SAMPLER",t[t.SHADER=7]="SHADER",t[t.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=9]="PIPELINE_STATE",t[t.BINDING_LAYOUT=10]="BINDING_LAYOUT",t[t.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",t[t.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR",t[t.COMMAND_BUFFER=13]="COMMAND_BUFFER",t[t.QUEUE=14]="QUEUE",t[t.WINDOW=15]="WINDOW"}(r||(r={})),function(t){t[t.UNREADY=0]="UNREADY",t[t.FAILED=1]="FAILED",t[t.SUCCESS=2]="SUCCESS"}(n||(n={})),function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8"}(s||(s={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.COLOR4=17]="COLOR4",t[t.MAT2=18]="MAT2",t[t.MAT2X3=19]="MAT2X3",t[t.MAT2X4=20]="MAT2X4",t[t.MAT3X2=21]="MAT3X2",t[t.MAT3=22]="MAT3",t[t.MAT3X4=23]="MAT3X4",t[t.MAT4X2=24]="MAT4X2",t[t.MAT4X3=25]="MAT4X3",t[t.MAT4=26]="MAT4",t[t.SAMPLER1D=27]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=29]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=31]="SAMPLER3D",t[t.SAMPLER_CUBE=32]="SAMPLER_CUBE",t[t.COUNT=33]="COUNT"}(o||(o={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.SRGB8_A8=36]="SRGB8_A8",t[t.RGBA8SN=37]="RGBA8SN",t[t.RGBA8UI=38]="RGBA8UI",t[t.RGBA8I=39]="RGBA8I",t[t.RGBA16F=40]="RGBA16F",t[t.RGBA16UI=41]="RGBA16UI",t[t.RGBA16I=42]="RGBA16I",t[t.RGBA32F=43]="RGBA32F",t[t.RGBA32UI=44]="RGBA32UI",t[t.RGBA32I=45]="RGBA32I",t[t.R5G6B5=46]="R5G6B5",t[t.R11G11B10F=47]="R11G11B10F",t[t.RGB5A1=48]="RGB5A1",t[t.RGBA4=49]="RGBA4",t[t.RGB10A2=50]="RGB10A2",t[t.RGB10A2UI=51]="RGB10A2UI",t[t.RGB9E5=52]="RGB9E5",t[t.D16=53]="D16",t[t.D16S8=54]="D16S8",t[t.D24=55]="D24",t[t.D24S8=56]="D24S8",t[t.D32F=57]="D32F",t[t.D32F_S8=58]="D32F_S8",t[t.BC1=59]="BC1",t[t.BC1_ALPHA=60]="BC1_ALPHA",t[t.BC1_SRGB=61]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA",t[t.BC2=63]="BC2",t[t.BC2_SRGB=64]="BC2_SRGB",t[t.BC3=65]="BC3",t[t.BC3_SRGB=66]="BC3_SRGB",t[t.BC4=67]="BC4",t[t.BC4_SNORM=68]="BC4_SNORM",t[t.BC5=69]="BC5",t[t.BC5_SNORM=70]="BC5_SNORM",t[t.BC6H_UF16=71]="BC6H_UF16",t[t.BC6H_SF16=72]="BC6H_SF16",t[t.BC7=73]="BC7",t[t.BC7_SRGB=74]="BC7_SRGB",t[t.ETC_RGB8=75]="ETC_RGB8",t[t.ETC2_RGB8=76]="ETC2_RGB8",t[t.ETC2_SRGB8=77]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=78]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=80]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8",t[t.EAC_R11=82]="EAC_R11",t[t.EAC_R11SN=83]="EAC_R11SN",t[t.EAC_RG11=84]="EAC_RG11",t[t.EAC_RG11SN=85]="EAC_RG11SN",t[t.PVRTC_RGB2=86]="PVRTC_RGB2",t[t.PVRTC_RGBA2=87]="PVRTC_RGBA2",t[t.PVRTC_RGB4=88]="PVRTC_RGB4",t[t.PVRTC_RGBA4=89]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=90]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=91]="PVRTC2_4BPP",t[t.ASTC_RGBA_4x4=92]="ASTC_RGBA_4x4",t[t.ASTC_RGBA_5x4=92]="ASTC_RGBA_5x4",t[t.ASTC_RGBA_5x5=92]="ASTC_RGBA_5x5",t[t.ASTC_RGBA_6x5=92]="ASTC_RGBA_6x5",t[t.ASTC_RGBA_6x6=92]="ASTC_RGBA_6x6",t[t.ASTC_RGBA_8x5=92]="ASTC_RGBA_8x5",t[t.ASTC_RGBA_8x6=92]="ASTC_RGBA_8x6",t[t.ASTC_RGBA_8x8=92]="ASTC_RGBA_8x8",t[t.ASTC_RGBA_10x5=92]="ASTC_RGBA_10x5",t[t.ASTC_RGBA_10x6=92]="ASTC_RGBA_10x6",t[t.ASTC_RGBA_10x8=92]="ASTC_RGBA_10x8",t[t.ASTC_RGBA_10x10=92]="ASTC_RGBA_10x10",t[t.ASTC_RGBA_12x10=92]="ASTC_RGBA_12x10",t[t.ASTC_RGBA_12x12=92]="ASTC_RGBA_12x12",t[t.ASTC_SRGBA_4x4=92]="ASTC_SRGBA_4x4",t[t.ASTC_SRGBA_5x4=92]="ASTC_SRGBA_5x4",t[t.ASTC_SRGBA_5x5=92]="ASTC_SRGBA_5x5",t[t.ASTC_SRGBA_6x5=92]="ASTC_SRGBA_6x5",t[t.ASTC_SRGBA_6x6=92]="ASTC_SRGBA_6x6",t[t.ASTC_SRGBA_8x5=92]="ASTC_SRGBA_8x5",t[t.ASTC_SRGBA_8x6=92]="ASTC_SRGBA_8x6",t[t.ASTC_SRGBA_8x8=92]="ASTC_SRGBA_8x8",t[t.ASTC_SRGBA_10x5=92]="ASTC_SRGBA_10x5",t[t.ASTC_SRGBA_10x6=92]="ASTC_SRGBA_10x6",t[t.ASTC_SRGBA_10x8=92]="ASTC_SRGBA_10x8",t[t.ASTC_SRGBA_10x10=92]="ASTC_SRGBA_10x10",t[t.ASTC_SRGBA_12x10=92]="ASTC_SRGBA_12x10",t[t.ASTC_SRGBA_12x12=92]="ASTC_SRGBA_12x12"}(a||(a={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(l||(l={})),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(c||(c={})),function(t){t[t.NONE=0]="NONE",t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(h||(h={})),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(u||(u={})),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(d||(d={})),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(p||(p={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(f||(f={})),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(_||(_={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(m||(m={})),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(g||(g={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(y||(y={})),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}(v||(v={})),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(b||(b={})),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(x||(x={})),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D"}(T||(T={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",t[t.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(C||(C={})),function(t){t[t.X1=0]="X1",t[t.X2=1]="X2",t[t.X4=2]="X4",t[t.X8=3]="X8",t[t.X16=4]="X16",t[t.X32=5]="X32",t[t.X64=6]="X64"}(S||(S={})),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.CUBEMAP=2]="CUBEMAP",t[t.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(w||(w={})),function(t){t[t.TV1D=0]="TV1D",t[t.TV2D=1]="TV2D",t[t.TV3D=2]="TV3D",t[t.CUBE=3]="CUBE",t[t.TV1D_ARRAY=4]="TV1D_ARRAY",t[t.TV2D_ARRAY=5]="TV2D_ARRAY"}(A||(A={})),function(t){t[t.VERTEX=0]="VERTEX",t[t.HULL=1]="HULL",t[t.DOMAIN=2]="DOMAIN",t[t.GEOMETRY=3]="GEOMETRY",t[t.FRAGMENT=4]="FRAGMENT",t[t.COMPUTE=5]="COMPUTE",t[t.COUNT=6]="COUNT"}(E||(E={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.SAMPLER=2]="SAMPLER",t[t.STORAGE_BUFFER=3]="STORAGE_BUFFER"}(D||(D={})),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(L||(L={})),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(I||(I={})),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(P||(P={})),function(t){t[t.UNDEFINED=0]="UNDEFINED",t[t.GENERAL=1]="GENERAL",t[t.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",t[t.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",t[t.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",t[t.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",t[t.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",t[t.PREINITIALIZED=8]="PREINITIALIZED",t[t.PRESENT_SRC=9]="PRESENT_SRC"}(M||(M={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(R||(R={})),function(t){t[t.VIEWPORT=0]="VIEWPORT",t[t.SCISSOR=1]="SCISSOR",t[t.LINE_WIDTH=2]="LINE_WIDTH",t[t.DEPTH_BIAS=3]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=5]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=6]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=7]="STENCIL_COMPARE_MASK"}(O||(O={})),function(t){t[t.FRONT=0]="FRONT",t[t.BACK=1]="BACK",t[t.ALL=2]="ALL"}(B||(B={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}(N||(N={})),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(k||(k={})),function(t){t[t.DEFAULT=100]="DEFAULT"}(F||(F={})),function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(V||(V={})),function(t){t[t.UBO_GLOBAL=23]="UBO_GLOBAL",t[t.UBO_SHADOW=22]="UBO_SHADOW",t[t.UBO_LOCAL=21]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING=19]="UBO_SKINNING",t[t.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE",t[t.UBO_UI=17]="UBO_UI",t[t.SAMPLER_JOINTS=25]="SAMPLER_JOINTS",t[t.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT",t[t.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT",t[t.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT"}(j||(j={})),function(t){t[t.minFilter=0]="minFilter",t[t.magFilter=1]="magFilter",t[t.mipFilter=2]="mipFilter",t[t.addressU=3]="addressU",t[t.addressV=4]="addressV",t[t.addressW=5]="addressW",t[t.maxAnisotropy=6]="maxAnisotropy",t[t.cmpFunc=7]="cmpFunc",t[t.minLOD=8]="minLOD",t[t.maxLOD=9]="maxLOD",t[t.mipLODBias=10]="mipLODBias",t[t.borderColor=11]="borderColor",t[t.total=15]="total"}(Y||(Y={}));var H={};H[H.bool=o.BOOL]="bool",H[H.int=o.INT]="int",H[H.ivec2=o.INT2]="ivec2invTypeParams",H[H.ivec3=o.INT3]="ivec3",H[H.ivec4=o.INT4]="ivec4",H[H.float=o.FLOAT]="float",H[H.vec2=o.FLOAT2]="vec2",H[H.vec3=o.FLOAT3]="vec3",H[H.vec4=o.FLOAT4]="vec4",H[H.mat2=o.MAT2]="mat2",H[H.mat3=o.MAT3]="mat3",H[H.mat4=o.MAT4]="mat4",H[H.sampler2D=o.SAMPLER2D]="sampler2D",H[H.samplerCube=o.SAMPLER_CUBE]="samplerCube";var X=((G={})[o.BOOL]=4,G[o.INT]=4,G[o.INT2]=8,G[o.INT3]=12,G[o.INT4]=16,G[o.FLOAT]=4,G[o.FLOAT2]=8,G[o.FLOAT3]=12,G[o.FLOAT4]=16,G[o.MAT2]=16,G[o.MAT3]=36,G[o.MAT4]=64,G[o.SAMPLER2D]=4,G[o.SAMPLER_CUBE]=4,G),z=((U={})[o.BOOL]=a.R32I,U[o.INT]=a.R32I,U[o.INT2]=a.RG32I,U[o.INT3]=a.RGB32I,U[o.INT4]=a.RGBA32I,U[o.FLOAT]=a.R32F,U[o.FLOAT2]=a.RG32F,U[o.FLOAT3]=a.RGB32F,U[o.FLOAT4]=a.RGBA32F,U),W={BACK:1029,FRONT:1028,NONE:0,ADD:32774,SUB:32778,REV_SUB:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,SRC_ALPHA_SATURATE:776,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,INCR_WRAP:34055,DECR:7683,DECR_WRAP:34056,INVERT:5386};Object.assign(W,F);var Z={murmurhash2_32_gc:function(t,e){for(var i,r=t.length,n=e^r,s=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++s;switch(r){case 3:n^=(255&t.charCodeAt(s+2))<<16;case 2:n^=(255&t.charCodeAt(s+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(s)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0},SamplerInfoIndex:Y,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:H,sizeMap:X,formatMap:z,passParams:W,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:V,GFXGetTypeSize:function(t){switch(t){case o.BOOL:case o.INT:case o.UINT:case o.FLOAT:return 4;case o.BOOL2:case o.INT2:case o.UINT2:case o.FLOAT2:return 8;case o.BOOL3:case o.INT3:case o.UINT3:case o.FLOAT3:return 12;case o.BOOL4:case o.INT4:case o.UINT4:case o.FLOAT4:case o.MAT2:return 16;case o.MAT2X3:return 24;case o.MAT2X4:return 32;case o.MAT3X2:return 24;case o.MAT3:return 36;case o.MAT3X4:return 48;case o.MAT4X2:case o.MAT4X2:return 32;case o.MAT4:return 64;case o.SAMPLER1D:case o.SAMPLER1D_ARRAY:case o.SAMPLER2D:case o.SAMPLER2D_ARRAY:case o.SAMPLER3D:case o.SAMPLER_CUBE:return 4;default:return 0}},UniformBinding:j};e.exports=Z},{}],308:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("../memop"),n=c(t("../enums")),s=t("../../core/value-types"),o=c(t("./program-lib")),a=c(t("./view")),l=c(t("../gfx"));function c(t){return t&&t.__esModule?t:{default:t}}var h=new s.Mat4,u=new r.RecyclePool((function(){return{stage:null,items:null}}),8),d=new r.RecyclePool((function(){return new Float32Array(2)}),8),p=new r.RecyclePool((function(){return new Float32Array(3)}),8),f=new r.RecyclePool((function(){return new Float32Array(4)}),8),_=new r.RecyclePool((function(){return new Float32Array(9)}),8),m=new r.RecyclePool((function(){return new Float32Array(16)}),8),g=new r.RecyclePool((function(){return new Float32Array(64)}),8),y=new r.RecyclePool((function(){return new Int32Array(2)}),8),v=new r.RecyclePool((function(){return new Int32Array(3)}),8),b=new r.RecyclePool((function(){return new Int32Array(4)}),8),x=new r.RecyclePool((function(){return new Int32Array(64)}),8),T=function(){function t(t,e){var i;this._device=t,this._programLib=new o.default(t),this._opts=e,this._type2defaultValue=((i={})[n.default.PARAM_INT]=0,i[n.default.PARAM_INT2]=new s.Vec2(0,0),i[n.default.PARAM_INT3]=new s.Vec3(0,0,0),i[n.default.PARAM_INT4]=new s.Vec4(0,0,0,0),i[n.default.PARAM_FLOAT]=0,i[n.default.PARAM_FLOAT2]=new s.Vec2(0,0),i[n.default.PARAM_FLOAT3]=new s.Vec3(0,0,0),i[n.default.PARAM_FLOAT4]=new s.Vec4(0,0,0,0),i[n.default.PARAM_COLOR4]=new s.Color(0,0,0,1),i[n.default.PARAM_MAT3]=new s.Mat3,i[n.default.PARAM_MAT4]=new s.Mat4,i[n.default.PARAM_TEXTURE_2D]=e.defaultTexture,i[n.default.PARAM_TEXTURE_CUBE]=e.defaultTextureCube,i),this._stage2fn={},this._usedTextureUnits=0,this._viewPools=new r.RecyclePool((function(){return new a.default}),8),this._drawItemsPools=new r.RecyclePool((function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null}}),100),this._stageItemsPools=new r.RecyclePool((function(){return new r.RecyclePool((function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null}}),100)}),16),this._definesChanged=!1}var e=t.prototype;return e._resetTextuerUnit=function(){this._usedTextureUnits=0},e._allocTextureUnit=function(){var t=this._device,e=this._usedTextureUnits;return e>=t._caps.maxTextureUnits&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+t._caps.maxTextureUnits),this._usedTextureUnits+=1,e},e._registerStage=function(t,e){this._stage2fn[t]=e},e.clear=function(){this._programLib.clear(),this.reset()},e.reset=function(){this._viewPools.reset(),this._stageItemsPools.reset(),this._definesChanged=!1},e._requestView=function(){return this._viewPools.add()},e._render=function(t,e){var i=this._device;i.setFrameBuffer(t._framebuffer),i.setViewport(t._rect.x,t._rect.y,t._rect.w,t._rect.h);var r={};t._clearFlags&n.default.CLEAR_COLOR&&(r.color=s.Vec4.toArray([],t._color)),t._clearFlags&n.default.CLEAR_DEPTH&&(r.depth=t._depth),t._clearFlags&n.default.CLEAR_STENCIL&&(r.stencil=t._stencil),i.clear(r),this._drawItemsPools.reset();for(var o=0;o<e._models.length;++o){var a=e._models.data[o];if(a._cullingMask&t._cullingMask){var l=this._drawItemsPools.add();a.extractDrawItem(l)}}u.reset();for(var c=0;c<t._stages.length;++c){var h=t._stages[c],d=this._stageItemsPools.add();d.reset();for(var p=0;p<this._drawItemsPools.length;++p){var f=this._drawItemsPools.data[p],_=f.effect.stagePasses[h];if(_&&0!==_.length){var m=d.add();m.passes=_,m.model=f.model,m.node=f.node,m.ia=f.ia,m.effect=f.effect,m.defines=f.defines,m.sortKey=-1,m.uniforms=f.uniforms}}var g=u.add();g.stage=h,g.items=d}for(var y=0;y<u.length;++y){var v=u.data[y];(0,this._stage2fn[v.stage])(t,v.items)}},e._setProperty=function(t){var e=this._device,i=t.value;if(void 0===i&&(i=t.val),void 0===i&&(i=this._type2defaultValue[t.type]),void 0!==i)if(t.type===n.default.PARAM_TEXTURE_2D||t.type===n.default.PARAM_TEXTURE_CUBE)if(Array.isArray(i)){if(i.length>t.count)return void console.error("Failed to set property ["+t.name+"] : The length of texture array ["+i.length+"] is bigger than ["+t.count+"].");for(var r=x.add(),s=0;s<i.length;++s)r[s]=this._allocTextureUnit();e.setTextureArray(t.name,i,r)}else e.setTexture(t.name,i,this._allocTextureUnit());else t.directly?e.setUniformDirectly(t.name,i):e.setUniform(t.name,i);else console.warn("Failed to set technique property "+t.name+", value not found.")},e._draw=function(t){var e=this._device,i=this._programLib,r=t.node,n=t.ia,o=t.passes,a=t.effect;d.reset(),p.reset(),f.reset(),_.reset(),m.reset(),g.reset(),y.reset(),v.reset(),b.reset(),x.reset(),r.getWorldMatrix(h),e.setUniform("cc_matWorld",s.Mat4.toArray(m.add(),h)),s.Mat4.invert(h,h),s.Mat4.transpose(h,h),e.setUniform("cc_matWorldIT",s.Mat4.toArray(m.add(),h));for(var c=this._defines,u=0;u<o.length;++u){var T=o[u];this._definesChanged&&(T._programKey=null);var C=n.count;n._vertexBuffer&&e.setVertexBuffer(0,n._vertexBuffer),n._indexBuffer&&e.setIndexBuffer(n._indexBuffer),e.setPrimitiveType(n._primitiveType),Object.setPrototypeOf(c,T._defines);var S=i.getProgram(T,c,a.name);e.setProgram(S);for(var w=S._uniforms,A=T._properties,E=0;E<w.length;E++){var D=A[w[E].name];void 0!==D&&this._setProperty(D)}e.setCullMode(T._cullMode),T._blend&&(e.enableBlend(),e.setBlendFuncSep(T._blendSrc,T._blendDst,T._blendSrcAlpha,T._blendDstAlpha),e.setBlendEqSep(T._blendEq,T._blendAlphaEq),e.setBlendColor32(T._blendColor)),T._depthTest&&(e.enableDepthTest(),e.setDepthFunc(T._depthFunc)),T._depthWrite&&e.enableDepthWrite(),e.setStencilTest(T._stencilTest),T._stencilTest===l.default.STENCIL_ENABLE&&(e.setStencilFuncFront(T._stencilFuncFront,T._stencilRefFront,T._stencilMaskFront),e.setStencilOpFront(T._stencilFailOpFront,T._stencilZFailOpFront,T._stencilZPassOpFront,T._stencilWriteMaskFront),e.setStencilFuncBack(T._stencilFuncBack,T._stencilRefBack,T._stencilMaskBack),e.setStencilOpBack(T._stencilFailOpBack,T._stencilZFailOpBack,T._stencilZPassOpBack,T._stencilWriteMaskBack)),e.draw(n._start,C),this._resetTextuerUnit()}},t}();i.default=T,e.exports=i.default},{"../../core/value-types":286,"../enums":314,"../gfx":319,"../memop":331,"./program-lib":311,"./view":313}],309:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../gfx"))&&r.__esModule?r:{default:r};var s=function(){function t(t,e,i){void 0===i&&(i=n.default.PT_TRIANGLES),this._vertexBuffer=t,this._indexBuffer=e,this._primitiveType=i,this._start=0,this._count=-1}var e,i;return e=t,(i=[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=s,e.exports=i.default},{"../gfx":319}],310:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=o(t("../gfx")),n=o(t("../enums")),s=o(t("../../core/value-types/value-type"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(t,e,i,n,s,o){void 0===s&&(s={}),void 0===o&&(o={}),this._name=t,this._detailName=e,this._programName=i,this._programKey=null,this._stage=n,this._properties=s,this._defines=o,this._propertyNames=Object.keys(s),this._defineNames=Object.keys(o),this._cullMode=r.default.CULL_BACK,this._blend=!1,this._blendEq=r.default.BLEND_FUNC_ADD,this._blendAlphaEq=r.default.BLEND_FUNC_ADD,this._blendSrc=r.default.BLEND_SRC_ALPHA,this._blendDst=r.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendSrcAlpha=r.default.BLEND_SRC_ALPHA,this._blendDstAlpha=r.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendColor=4294967295,this._depthTest=!1,this._depthWrite=!1,this._depthFunc=r.default.DS_FUNC_LESS,this._stencilTest=r.default.STENCIL_INHERIT,this._stencilFuncFront=r.default.DS_FUNC_ALWAYS,this._stencilRefFront=0,this._stencilMaskFront=255,this._stencilFailOpFront=r.default.STENCIL_OP_KEEP,this._stencilZFailOpFront=r.default.STENCIL_OP_KEEP,this._stencilZPassOpFront=r.default.STENCIL_OP_KEEP,this._stencilWriteMaskFront=255,this._stencilFuncBack=r.default.DS_FUNC_ALWAYS,this._stencilRefBack=0,this._stencilMaskBack=255,this._stencilFailOpBack=r.default.STENCIL_OP_KEEP,this._stencilZFailOpBack=r.default.STENCIL_OP_KEEP,this._stencilZPassOpBack=r.default.STENCIL_OP_KEEP,this._stencilWriteMaskBack=255}var e=t.prototype;return e.setCullMode=function(t){void 0===t&&(t=r.default.CULL_BACK),this._cullMode=t},e.setBlend=function(t,e,i,n,s,o,a,l){void 0===t&&(t=!1),void 0===e&&(e=r.default.BLEND_FUNC_ADD),void 0===i&&(i=r.default.BLEND_SRC_ALPHA),void 0===n&&(n=r.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===s&&(s=r.default.BLEND_FUNC_ADD),void 0===o&&(o=r.default.BLEND_SRC_ALPHA),void 0===a&&(a=r.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===l&&(l=4294967295),this._blend=t,this._blendEq=e,this._blendSrc=i,this._blendDst=n,this._blendAlphaEq=s,this._blendSrcAlpha=o,this._blendDstAlpha=a,this._blendColor=l},e.setDepth=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=r.default.DS_FUNC_LESS),this._depthTest=t,this._depthWrite=e,this._depthFunc=i},e.setStencilFront=function(t,e,i,n,s,o,a,l){void 0===t&&(t=r.default.STENCIL_INHERIT),void 0===e&&(e=r.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===s&&(s=r.default.STENCIL_OP_KEEP),void 0===o&&(o=r.default.STENCIL_OP_KEEP),void 0===a&&(a=r.default.STENCIL_OP_KEEP),void 0===l&&(l=255),this._stencilTest=t,this._stencilFuncFront=e,this._stencilRefFront=i,this._stencilMaskFront=n,this._stencilFailOpFront=s,this._stencilZFailOpFront=o,this._stencilZPassOpFront=a,this._stencilWriteMaskFront=l},e.setStencilEnabled=function(t){void 0===t&&(t=r.default.STENCIL_INHERIT),this._stencilTest=t},e.setStencilBack=function(t,e,i,n,s,o,a,l){void 0===t&&(t=r.default.STENCIL_INHERIT),void 0===e&&(e=r.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===n&&(n=255),void 0===s&&(s=r.default.STENCIL_OP_KEEP),void 0===o&&(o=r.default.STENCIL_OP_KEEP),void 0===a&&(a=r.default.STENCIL_OP_KEEP),void 0===l&&(l=255),this._stencilTest=t,this._stencilFuncBack=e,this._stencilRefBack=i,this._stencilMaskBack=n,this._stencilFailOpBack=s,this._stencilZFailOpBack=o,this._stencilZPassOpBack=a,this._stencilWriteMaskBack=l},e.setStage=function(t){this._stage=t},e.setProperties=function(t){this._properties=t},e.getProperty=function(t){if(this._properties[t])return this._properties[t].value},e.setProperty=function(t,e,i){var r=this._properties[t];if(!r)return!1;if(r.directly=i,Array.isArray(e)){var o=r.value;if(o.length!==e.length)return void cc.warnID(9105,this._name,t);for(var a=0;a<e.length;a++)o[a]=e[a]}else e&&!ArrayBuffer.isView(e)?r.type===n.default.PARAM_TEXTURE_2D?r.value=e.getImpl():e instanceof s.default?e.constructor.toArray(r.value,e):("object"==typeof e&&cc.warnID(9106,this._name,t),r.value=e):r.value=e;return!0},e.getDefine=function(t){return this._defines[t]},e.define=function(t,e,i){var r=this._defines[t];return!(!i&&void 0===r||(r!==e&&(this._defines[t]=e,this._programKey=null),0))},e.clone=function(){var e=new t(this._programName);Object.assign(e,this);var i={},r=this._properties;for(var n in r){var s=r[n],o=i[n]={},a=s.value;for(var l in Array.isArray(a)?o.value=a.concat():ArrayBuffer.isView(a)?o.value=new a.__proto__.constructor(a):o.value=a,s)"value"!==l&&(o[l]=s[l])}return e._properties=i,e._defines=Object.assign({},this._defines),e._propertyNames=this._propertyNames,e._defineNames=this._defineNames,e},t}();i.default=a,e.exports=i.default},{"../../core/value-types/value-type":294,"../enums":314,"../gfx":319}],311:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../gfx"))&&r.__esModule?r:{default:r},s=0;function o(t,e,i){for(var r=t,n=0;n<e.length;n++){var s=e[n].name,o=i[s];if(Number.isInteger(o)){var a=new RegExp(s,"g");r=r.replace(a,o)}}return r}function a(t){return t.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,(function(t,e,i,r,n){var s="",o=parseInt(i),a=parseInt(r);(o.isNaN||a.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num.");for(var l=o;l<a;++l)s+=n.replace(new RegExp("{"+e+"}","g"),l);return s}))}function l(t){return t.replace(/\bhighp\b/g,"mediump")}var c=function(){function t(t){this._device=t,this._templates={},this._cache={},this._checkPrecision()}var e=t.prototype;return e.clear=function(){this._templates={},this._cache={}},e.define=function(t){var e=t.name,i=t.defines,r=t.glsl1||t,n=r.vert,o=r.frag;if(!this._templates[e]){for(var a=++s,l=0,c=0;c<i.length;++c){var h=i[c],u=1;if("number"===h.type){var d=h.range||[];h.min=d[0]||0,h.max=d[1]||4,u=Math.ceil(Math.log2(h.max-h.min)),h._map=function(t){return t-this.min<<this._offset}.bind(h)}else h._map=function(t){return t?1<<this._offset:0}.bind(h);h._offset=l,l+=u}var p=t.uniforms||[];if(t.samplers)for(var f=0;f<t.samplers.length;f++)p.push(t.samplers[f]);if(t.blocks)for(var _=0;_<t.blocks.length;_++)for(var m=t.blocks[_].defines,g=t.blocks[_].members,y=0;y<g.length;y++)p.push({defines:m,name:g[y].name,type:g[y].type});this._templates[e]={id:a,name:e,vert:n,frag:o,defines:i,attributes:t.attributes,uniforms:p,extensions:t.extensions}}},e.getTemplate=function(t){return this._templates[t]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){for(var i=this._templates[t],r=0,n=0;n<i.defines.length;++n){var s=i.defines[n],o=e[s.name];void 0!==o&&(r|=s._map(o))}return i.id+":"+r},e.getProgram=function(t,e,i){var r=t._programKey=t._programKey||this.getKey(t._programName,e),s=this._cache[r];if(s)return s;var c=this._templates[t._programName],h=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=t[r].name,s=e[n];"number"!=typeof s&&(s=s?1:0),i.push("#define "+n+" "+s)}return i.join("\n")+"\n"}(c.defines,e),u=o(c.vert,c.defines,e);u=h+a(u),this._highpSupported||(u=l(u));var d=o(c.frag,c.defines,e);d=h+a(d),this._highpSupported||(d=l(d));var p=(s=new n.default.Program(this._device,{vert:u,frag:d})).link();if(p){var f=u.split("\n"),_=d.split("\n"),m=c.defines.length;p.forEach((function(t){var e=t.line-1,r=t.line-m,n=("vs"===t.type?f:_)[e],s=t.info||"Failed to compile "+t.type+" "+t.fileID+" (ln "+r+"): \n "+t.message+": \n  "+n;cc.error(i+" : "+s)}))}return this._cache[r]=s,s},e._checkPrecision=function(){var t=this._device._gl,e=!1;if(t.getShaderPrecisionFormat){var i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),r=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e=i&&i.precision>0&&r&&r.precision>0}e||cc.warnID(9102),this._highpSupported=e},t}();i.default=c,e.exports=i.default},{"../gfx":319}],312:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e){this._name=t,this._passes=e}var e,i;return t.prototype.clone=function(){for(var e=[],i=0;i<this._passes.length;i++)e.push(this._passes[i].clone());return new t(this._name,e)},e=t,(i=[{key:"name",get:function(){return this._name}},{key:"passes",get:function(){return this._passes}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=r,e.exports=i.default},{}],313:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../../core/value-types"),s=(r=t("../enums"))&&r.__esModule?r:{default:r},o=new n.Mat4,a=0,l=function(){function t(){this._id=a++,this._priority=0,this._rect={x:0,y:0,w:1,h:1},this._color=new n.Vec4(.3,.3,.3,1),this._depth=1,this._stencil=0,this._clearFlags=s.default.CLEAR_COLOR|s.default.CLEAR_DEPTH,this._clearModel=null,this._matView=cc.mat4(),this._matViewInv=cc.mat4(),this._matProj=cc.mat4(),this._matViewProj=cc.mat4(),this._matInvViewProj=cc.mat4(),this._stages=[],this._cullingByID=!1,this._framebuffer=null,this._shadowLight=null,this._cullingMask=4294967295}var e=t.prototype;return e.getForward=function(t){var e=this._matView.m;return n.Vec3.set(t,-e[2],-e[6],-e[10])},e.getPosition=function(t){return n.Mat4.invert(o,this._matView),n.Mat4.getTranslation(t,o)},t}();i.default=l,e.exports=i.default},{"../../core/value-types":286,"../enums":314}],314:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("./build/mappings"),n={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:r.typeMap.int,PARAM_INT2:r.typeMap.ivec2,PARAM_INT3:r.typeMap.ivec3,PARAM_INT4:r.typeMap.ivec4,PARAM_FLOAT:r.typeMap.float,PARAM_FLOAT2:r.typeMap.vec2,PARAM_FLOAT3:r.typeMap.vec3,PARAM_FLOAT4:r.typeMap.vec4,PARAM_MAT2:r.typeMap.mat2,PARAM_MAT3:r.typeMap.mat3,PARAM_MAT4:r.typeMap.mat4,PARAM_TEXTURE_2D:r.typeMap.sampler2D,PARAM_TEXTURE_CUBE:r.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};i.default=n,e.exports=i.default},{"./build/mappings":307}],315:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n,s=c(t("./state")),o=t("./enums"),a=c(t("./texture-2d")),l=c(t("./texture-cube"));function c(t){return t&&t.__esModule?t:{default:t}}var h=((r={})[5124]=function(t,e,i){t.uniform1i(e,i)},r[5126]=function(t,e,i){t.uniform1f(e,i)},r[35664]=function(t,e,i){t.uniform2fv(e,i)},r[35665]=function(t,e,i){t.uniform3fv(e,i)},r[35666]=function(t,e,i){t.uniform4fv(e,i)},r[35667]=function(t,e,i){t.uniform2iv(e,i)},r[35668]=function(t,e,i){t.uniform3iv(e,i)},r[35669]=function(t,e,i){t.uniform4iv(e,i)},r[35670]=function(t,e,i){t.uniform1i(e,i)},r[35671]=function(t,e,i){t.uniform2iv(e,i)},r[35672]=function(t,e,i){t.uniform3iv(e,i)},r[35673]=function(t,e,i){t.uniform4iv(e,i)},r[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},r[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},r[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},r[35678]=function(t,e,i){t.uniform1i(e,i)},r[35680]=function(t,e,i){t.uniform1i(e,i)},r),u=((n={})[5124]=function(t,e,i){t.uniform1iv(e,i)},n[5126]=function(t,e,i){t.uniform1fv(e,i)},n[35664]=function(t,e,i){t.uniform2fv(e,i)},n[35665]=function(t,e,i){t.uniform3fv(e,i)},n[35666]=function(t,e,i){t.uniform4fv(e,i)},n[35667]=function(t,e,i){t.uniform2iv(e,i)},n[35668]=function(t,e,i){t.uniform3iv(e,i)},n[35669]=function(t,e,i){t.uniform4iv(e,i)},n[35670]=function(t,e,i){t.uniform1iv(e,i)},n[35671]=function(t,e,i){t.uniform2iv(e,i)},n[35672]=function(t,e,i){t.uniform3iv(e,i)},n[35673]=function(t,e,i){t.uniform4iv(e,i)},n[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i)},n[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i)},n[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i)},n[35678]=function(t,e,i){t.uniform1iv(e,i)},n[35680]=function(t,e,i){t.uniform1iv(e,i)},n);function d(t,e,i){if(e.blend!==i.blend)return i.blend?(t.enable(t.BLEND),i.blendSrc!==o.enums.BLEND_CONSTANT_COLOR&&i.blendSrc!==o.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&i.blendDst!==o.enums.BLEND_CONSTANT_COLOR&&i.blendDst!==o.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),void(i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq)))):void t.disable(t.BLEND);!1!==i.blend&&(e.blendColor!==i.blendColor&&t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),e.blendSep===i.blendSep?i.blendSep?(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst&&e.blendSrcAlpha===i.blendSrcAlpha&&e.blendDstAlpha===i.blendDstAlpha||t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),e.blendEq===i.blendEq&&e.blendAlphaEq===i.blendAlphaEq||t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst||t.blendFunc(i.blendSrc,i.blendDst),e.blendEq!==i.blendEq&&t.blendEquation(i.blendEq)):i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq)))}function p(t,e,i){if(e.depthTest!==i.depthTest)return i.depthTest?(t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc),void t.depthMask(i.depthWrite)):void t.disable(t.DEPTH_TEST);e.depthWrite!==i.depthWrite&&t.depthMask(i.depthWrite),!1!==i.depthTest?e.depthFunc!==i.depthFunc&&t.depthFunc(i.depthFunc):i.depthWrite&&(i.depthTest=!0,i.depthFunc=o.enums.DS_FUNC_ALWAYS,t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc))}function f(t,e,i){if(i.stencilTest!==o.enums.STENCIL_INHERIT)return i.stencilTest!==e.stencilTest?i.stencilTest===o.enums.STENCIL_DISABLE?void t.disable(t.STENCIL_TEST):(t.enable(t.STENCIL_TEST),void(i.stencilSep?(t.stencilFuncSeparate(t.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilMaskSeparate(t.FRONT,i.stencilWriteMaskFront),t.stencilOpSeparate(t.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),t.stencilFuncSeparate(t.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),t.stencilMaskSeparate(t.BACK,i.stencilWriteMaskBack),t.stencilOpSeparate(t.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(t.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilMask(i.stencilWriteMaskFront),t.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)))):void(i.stencilTest!==o.enums.STENCIL_DISABLE&&(e.stencilSep===i.stencilSep?i.stencilSep?(e.stencilFuncFront===i.stencilFuncFront&&e.stencilRefFront===i.stencilRefFront&&e.stencilMaskFront===i.stencilMaskFront||t.stencilFuncSeparate(t.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),e.stencilWriteMaskFront!==i.stencilWriteMaskFront&&t.stencilMaskSeparate(t.FRONT,i.stencilWriteMaskFront),e.stencilFailOpFront===i.stencilFailOpFront&&e.stencilZFailOpFront===i.stencilZFailOpFront&&e.stencilZPassOpFront===i.stencilZPassOpFront||t.stencilOpSeparate(t.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),e.stencilFuncBack===i.stencilFuncBack&&e.stencilRefBack===i.stencilRefBack&&e.stencilMaskBack===i.stencilMaskBack||t.stencilFuncSeparate(t.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),e.stencilWriteMaskBack!==i.stencilWriteMaskBack&&t.stencilMaskSeparate(t.BACK,i.stencilWriteMaskBack),e.stencilFailOpBack===i.stencilFailOpBack&&e.stencilZFailOpBack===i.stencilZFailOpBack&&e.stencilZPassOpBack===i.stencilZPassOpBack||t.stencilOpSeparate(t.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(e.stencilFuncFront===i.stencilFuncFront&&e.stencilRefFront===i.stencilRefFront&&e.stencilMaskFront===i.stencilMaskFront||t.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),e.stencilWriteMaskFront!==i.stencilWriteMaskFront&&t.stencilMask(i.stencilWriteMaskFront),e.stencilFailOpFront===i.stencilFailOpFront&&e.stencilZFailOpFront===i.stencilZFailOpFront&&e.stencilZPassOpFront===i.stencilZPassOpFront||t.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront)):i.stencilSep?(t.stencilFuncSeparate(t.FRONT,i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilMaskSeparate(t.FRONT,i.stencilWriteMaskFront),t.stencilOpSeparate(t.FRONT,i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront),t.stencilFuncSeparate(t.BACK,i.stencilFuncBack,i.stencilRefBack,i.stencilMaskBack),t.stencilMaskSeparate(t.BACK,i.stencilWriteMaskBack),t.stencilOpSeparate(t.BACK,i.stencilFailOpBack,i.stencilZFailOpBack,i.stencilZPassOpBack)):(t.stencilFunc(i.stencilFuncFront,i.stencilRefFront,i.stencilMaskFront),t.stencilMask(i.stencilWriteMaskFront),t.stencilOp(i.stencilFailOpFront,i.stencilZFailOpFront,i.stencilZPassOpFront))))}function _(t,e,i){e.cullMode!==i.cullMode&&(i.cullMode!==o.enums.CULL_NONE?(t.enable(t.CULL_FACE),t.cullFace(i.cullMode)):t.disable(t.CULL_FACE))}function m(t,e,i,r){void 0===r&&(r=0),i instanceof a.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,i._glID,0):i instanceof l.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,i._glID,0):t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,i._glID)}var g=function(){function t(t,e){var i;void 0===(e=e||{}).alpha&&(e.alpha=!1),void 0===e.stencil&&(e.stencil=!0),void 0===e.depth&&(e.depth=!0),void 0===e.antialias&&(e.antialias=!1),void 0===e.preserveDrawingBuffer&&(e.preserveDrawingBuffer=!1);try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)||t.getContext("webkit-3d",e)||t.getContext("moz-webgl",e)}catch(n){return void console.error(n)}i||console.error("This device does not support webgl"),this._gl=i,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),s.default.initDefault(this),this._current=new s.default(this),this._next=new s.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs);for(var r=0;r<this._caps.maxVertexAttribs;++r)this._enabledAttributes[r]=0,this._newAttributes[r]=0}var e,i,r=t.prototype;return r._initExtensions=function(t){for(var e=this._gl,i=0;i<t.length;++i)for(var r=t[i],n=["","WEBKIT_","MOZ_"],s=0;s<n.length;s++)try{var o=e.getExtension(n[s]+r);if(o){this._extensions[r]=o;break}}catch(a){console.error(a)}},r._initCaps=function(){var t=this._gl,e=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4,this._caps.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this._caps.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._caps.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_WEBGL):1,this._caps.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL):1},r._initStates=function(){var t=this._gl;t.disable(t.BLEND),t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),t.blendColor(1,1,1,1),t.colorMask(!0,!0,!0,!0),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.depthMask(!1),t.disable(t.POLYGON_OFFSET_FILL),t.depthRange(0,1),t.disable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,0,255),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearDepth(1),t.clearColor(0,0,0,0),t.clearStencil(0),t.disable(t.SCISSOR_TEST)},r._restoreTexture=function(t){var e=this._gl,i=this._current.textureUnits[t];i&&-1!==i._glID?e.bindTexture(i._target,i._glID):e.bindTexture(e.TEXTURE_2D,null)},r._restoreIndexBuffer=function(){var t=this._gl,e=this._current.indexBuffer;e&&-1!==e._glID?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._glID):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},r.ext=function(t){return this._extensions[t]},r.allowFloatTexture=function(){return null!=this.ext("OES_texture_float")},r.setFrameBuffer=function(t){if(this._framebuffer!==t){this._framebuffer=t;var e=this._gl;if(t){e.bindFramebuffer(e.FRAMEBUFFER,t._glID);for(var i=t._colors.length,r=0;r<i;++r){var n=t._colors[r];m(e,e.COLOR_ATTACHMENT0+r,n)}for(var s=i;s<this._caps.maxColorAttachments;++s)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,null,0);t._depth&&m(e,e.DEPTH_ATTACHMENT,t._depth),t._stencil&&m(e,e.STENCIL_ATTACHMENT,t._stencil),t._depthStencil&&m(e,e.DEPTH_STENCIL_ATTACHMENT,t._depthStencil)}else e.bindFramebuffer(e.FRAMEBUFFER,null)}},r.setViewport=function(t,e,i,r){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===r||(this._gl.viewport(t,e,i,r),this._vx=t,this._vy=e,this._vw=i,this._vh=r)},r.setScissor=function(t,e,i,r){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===r||(this._gl.scissor(t,e,i,r),this._sx=t,this._sy=e,this._sw=i,this._sh=r)},r.clear=function(t){if(void 0!==t.color||void 0!==t.depth||void 0!==t.stencil){var e=this._gl,i=0;void 0!==t.color&&(i|=e.COLOR_BUFFER_BIT,e.clearColor(t.color[0],t.color[1],t.color[2],t.color[3])),void 0!==t.depth&&(i|=e.DEPTH_BUFFER_BIT,e.clearDepth(t.depth),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.ALWAYS)),void 0!==t.stencil&&(i|=e.STENCIL_BUFFER_BIT,e.clearStencil(t.stencil)),e.clear(i),void 0!==t.depth&&(!1===this._current.depthTest?e.disable(e.DEPTH_TEST):(!1===this._current.depthWrite&&e.depthMask(!1),this._current.depthFunc!==o.enums.DS_FUNC_ALWAYS&&e.depthFunc(this._current.depthFunc)))}},r.enableBlend=function(){this._next.blend=!0},r.enableDepthTest=function(){this._next.depthTest=!0},r.enableDepthWrite=function(){this._next.depthWrite=!0},r.setStencilTest=function(t){this._next.stencilTest=t},r.setStencilFunc=function(t,e,i){this._next.stencilSep=!1,this._next.stencilFuncFront=this._next.stencilFuncBack=t,this._next.stencilRefFront=this._next.stencilRefBack=e,this._next.stencilMaskFront=this._next.stencilMaskBack=i},r.setStencilFuncFront=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncFront=t,this._next.stencilRefFront=e,this._next.stencilMaskFront=i},r.setStencilFuncBack=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncBack=t,this._next.stencilRefBack=e,this._next.stencilMaskBack=i},r.setStencilOp=function(t,e,i,r){this._next.stencilFailOpFront=this._next.stencilFailOpBack=t,this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=e,this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=r},r.setStencilOpFront=function(t,e,i,r){this._next.stencilSep=!0,this._next.stencilFailOpFront=t,this._next.stencilZFailOpFront=e,this._next.stencilZPassOpFront=i,this._next.stencilWriteMaskFront=r},r.setStencilOpBack=function(t,e,i,r){this._next.stencilSep=!0,this._next.stencilFailOpBack=t,this._next.stencilZFailOpBack=e,this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskBack=r},r.setDepthFunc=function(t){this._next.depthFunc=t},r.setBlendColor32=function(t){this._next.blendColor=t},r.setBlendColor=function(t,e,i,r){this._next.blendColor=(255*t<<24|255*e<<16|255*i<<8|255*r)>>>0},r.setBlendFunc=function(t,e){this._next.blendSep=!1,this._next.blendSrc=t,this._next.blendDst=e},r.setBlendFuncSep=function(t,e,i,r){this._next.blendSep=!0,this._next.blendSrc=t,this._next.blendDst=e,this._next.blendSrcAlpha=i,this._next.blendDstAlpha=r},r.setBlendEq=function(t){this._next.blendSep=!1,this._next.blendEq=t},r.setBlendEqSep=function(t,e){this._next.blendSep=!0,this._next.blendEq=t,this._next.blendAlphaEq=e},r.setCullMode=function(t){this._next.cullMode=t},r.setVertexBuffer=function(t,e,i){void 0===i&&(i=0),this._next.vertexBuffers[t]=e,this._next.vertexBufferOffsets[t]=i,this._next.maxStream<t&&(this._next.maxStream=t)},r.setIndexBuffer=function(t){this._next.indexBuffer=t},r.setProgram=function(t){this._next.program=t},r.setTexture=function(t,e,i){i>=this._caps.maxTextureUnits?console.warn("Can not set texture "+t+" at stage "+i+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[i]=e,this.setUniform(t,i),this._next.maxTextureSlot<i&&(this._next.maxTextureSlot=i))},r.setTextureArray=function(t,e,i){var r=e.length;if(r>=this._caps.maxTextureUnits)console.warn("Can not set "+r+" textures for "+t+", max texture exceed: "+this._caps.maxTextureUnits);else{for(var n=0;n<r;++n){var s=i[n];this._next.textureUnits[s]=e[n],this._next.maxTextureSlot<s&&(this._next.maxTextureSlot=s)}this.setUniform(t,i)}},r.setUniform=function(t,e){var i=this._uniforms[t],r=!1,n=!1,s=!1,o=!1;do{if(!i)break;if(s=Array.isArray(e)||e instanceof Float32Array,o=e instanceof Int32Array,n=s||o,i.isArray!==n)break;if(i.isArray&&i.value.length!==e.length)break;r=!0}while(0);if(r){var a=i.value,l=!1;if(i.isArray)for(var c=0,h=a.length;c<h;c++)a[c]!==e[c]&&(l=!0,a[c]=e[c]);else a!==e&&(l=!0,i.value=e);l&&(i.dirty=!0)}else{var u=e;s?u=new Float32Array(e):o&&(u=new Int32Array(e)),i={dirty:!0,value:u,isArray:n}}this._uniforms[t]=i},r.setUniformDirectly=function(t,e){var i=this._uniforms[t];i||(this._uniforms[t]=i={}),i.dirty=!0,i.value=e},r.setPrimitiveType=function(t){this._next.primitiveType=t},r.resetDrawCalls=function(){this._stats.drawcalls=0},r.getDrawCalls=function(){return this._stats.drawcalls},r.draw=function(t,e){var i=this._gl,r=this._current,n=this._next;d(i,r,n),p(i,r,n),f(i,r,n),_(i,r,n),function(t,e,i,r){var n=!1;if(-1!==r.maxStream){if(i.maxStream!==r.maxStream)n=!0;else if(i.program!==r.program)n=!0;else for(var s=0;s<r.maxStream+1;++s)if(i.vertexBuffers[s]!==r.vertexBuffers[s]||i.vertexBufferOffsets[s]!==r.vertexBufferOffsets[s]){n=!0;break}if(n){for(var o=0;o<t._caps.maxVertexAttribs;++o)t._newAttributes[o]=0;for(var a=0;a<r.maxStream+1;++a){var l=r.vertexBuffers[a],c=r.vertexBufferOffsets[a];if(l&&-1!==l._glID){e.bindBuffer(e.ARRAY_BUFFER,l._glID);for(var h=0;h<r.program._attributes.length;++h){var u=r.program._attributes[h],d=l._format.element(u.name);d?(0===t._enabledAttributes[u.location]&&(e.enableVertexAttribArray(u.location),t._enabledAttributes[u.location]=1),t._newAttributes[u.location]=1,e.vertexAttribPointer(u.location,d.num,d.type,d.normalize,d.stride,d.offset+c*d.stride)):console.warn("Can not find vertex attribute: "+u.name)}}}for(var p=0;p<t._caps.maxVertexAttribs;++p)t._enabledAttributes[p]!==t._newAttributes[p]&&(e.disableVertexAttribArray(p),t._enabledAttributes[p]=0)}}}(this,i,r,n),r.indexBuffer!==n.indexBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer&&-1!==n.indexBuffer._glID?n.indexBuffer._glID:null);var s=!1;r.program!==n.program&&(n.program._linked?i.useProgram(n.program._glID):console.warn("Failed to use program: has not linked yet."),s=!0),function(t,e,i){for(var r=0;r<i.maxTextureSlot+1;++r)if(e.textureUnits[r]!==i.textureUnits[r]){var n=i.textureUnits[r];n&&-1!==n._glID&&(t.activeTexture(t.TEXTURE0+r),t.bindTexture(n._target,n._glID))}}(i,r,n);for(var o=0;o<n.program._uniforms.length;++o){var a=n.program._uniforms[o],l=this._uniforms[a.name];if(l&&(s||l.dirty)){l.dirty=!1;var c=void 0===a.size?h[a.type]:u[a.type];c?c(i,a.location,l.value):console.warn("Can not find commit function for uniform "+a.name)}}e&&(n.indexBuffer?i.drawElements(this._next.primitiveType,e,n.indexBuffer._format,t*n.indexBuffer._bytesPerIndex):i.drawArrays(this._next.primitiveType,t,e),this._stats.drawcalls++),r.set(n),n.reset()},e=t,(i=[{key:"caps",get:function(){return this._caps}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=g,e.exports=i.default},{"./enums":316,"./state":323,"./texture-2d":324,"./texture-cube":325}],316:[function(t,e,i){i.__esModule=!0,i.attrTypeBytes=function(t){return t===s.ATTR_TYPE_INT8||t===s.ATTR_TYPE_UINT8?1:t===s.ATTR_TYPE_INT16||t===s.ATTR_TYPE_UINT16?2:t===s.ATTR_TYPE_INT32||t===s.ATTR_TYPE_UINT32||t===s.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+t),0)},i.enums=void 0,i.glFilter=function(t,e,i){void 0===i&&(i=-1);var n=r[e][i+1];return void 0===n?(console.warn("Unknown FILTER: "+e),-1===i?t.LINEAR:t.LINEAR_MIPMAP_LINEAR):n},i.glTextureFmt=function(t){var e=n[t];return void 0===e?(console.warn("Unknown TEXTURE_FMT: "+t),n[s.TEXTURE_FMT_RGBA8]):e};var r=[[9728,9984,9986],[9729,9985,9987]],n=[{format:6407,internalFormat:33776,pixelType:null},{format:6408,internalFormat:33777,pixelType:null},{format:6408,internalFormat:33778,pixelType:null},{format:6408,internalFormat:33779,pixelType:null},{format:6407,internalFormat:36196,pixelType:null},{format:6407,internalFormat:35841,pixelType:null},{format:6408,internalFormat:35843,pixelType:null},{format:6407,internalFormat:35840,pixelType:null},{format:6408,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6407,internalFormat:6407,pixelType:36193},{format:6408,internalFormat:6408,pixelType:36193},{format:6407,internalFormat:6407,pixelType:5126},{format:6408,internalFormat:6408,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:6407,internalFormat:37492,pixelType:null},{format:6408,internalFormat:37496,pixelType:null},{format:6408,internalFormat:37808,pixelType:null},{format:6408,internalFormat:37809,pixelType:null},{format:6408,internalFormat:37810,pixelType:null},{format:6408,internalFormat:37811,pixelType:null},{format:6408,internalFormat:37812,pixelType:null},{format:6408,internalFormat:37813,pixelType:null},{format:6408,internalFormat:37814,pixelType:null},{format:6408,internalFormat:37815,pixelType:null},{format:6408,internalFormat:37816,pixelType:null},{format:6408,internalFormat:37817,pixelType:null},{format:6408,internalFormat:37818,pixelType:null},{format:6408,internalFormat:37819,pixelType:null},{format:6408,internalFormat:37820,pixelType:null},{format:6408,internalFormat:37821,pixelType:null},{format:6408,internalFormat:37840,pixelType:null},{format:6408,internalFormat:37841,pixelType:null},{format:6408,internalFormat:37842,pixelType:null},{format:6408,internalFormat:37843,pixelType:null},{format:6408,internalFormat:37844,pixelType:null},{format:6408,internalFormat:37845,pixelType:null},{format:6408,internalFormat:37846,pixelType:null},{format:6408,internalFormat:37847,pixelType:null},{format:6408,internalFormat:37848,pixelType:null},{format:6408,internalFormat:37849,pixelType:null},{format:6408,internalFormat:37850,pixelType:null},{format:6408,internalFormat:37851,pixelType:null},{format:6408,internalFormat:37852,pixelType:null},{format:6408,internalFormat:37853,pixelType:null}],s={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,TEXTURE_FMT_RGBA_ASTC_4X4:30,TEXTURE_FMT_RGBA_ASTC_5X4:31,TEXTURE_FMT_RGBA_ASTC_5X5:32,TEXTURE_FMT_RGBA_ASTC_6X5:33,TEXTURE_FMT_RGBA_ASTC_6X6:34,TEXTURE_FMT_RGBA_ASTC_8X5:35,TEXTURE_FMT_RGBA_ASTC_8X6:36,TEXTURE_FMT_RGBA_ASTC_8X8:37,TEXTURE_FMT_RGBA_ASTC_10X5:38,TEXTURE_FMT_RGBA_ASTC_10X6:39,TEXTURE_FMT_RGBA_ASTC_10X8:40,TEXTURE_FMT_RGBA_ASTC_10X10:41,TEXTURE_FMT_RGBA_ASTC_12X10:42,TEXTURE_FMT_RGBA_ASTC_12X12:43,TEXTURE_FMT_SRGBA_ASTC_4X4:44,TEXTURE_FMT_SRGBA_ASTC_5X4:45,TEXTURE_FMT_SRGBA_ASTC_5X5:46,TEXTURE_FMT_SRGBA_ASTC_6X5:47,TEXTURE_FMT_SRGBA_ASTC_6X6:48,TEXTURE_FMT_SRGBA_ASTC_8X5:49,TEXTURE_FMT_SRGBA_ASTC_8X6:50,TEXTURE_FMT_SRGBA_ASTC_8X8:51,TEXTURE_FMT_SRGBA_ASTC_10X5:52,TEXTURE_FMT_SRGBA_ASTC_10X6:53,TEXTURE_FMT_SRGBA_ASTC_10X8:54,TEXTURE_FMT_SRGBA_ASTC_10X10:55,TEXTURE_FMT_SRGBA_ASTC_12X10:56,TEXTURE_FMT_SRGBA_ASTC_12X12:57,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};i.enums=s},{}],317:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e,i,r){this._device=t,this._width=e,this._height=i,this._colors=r.colors||[],this._depth=r.depth||null,this._stencil=r.stencil||null,this._depthStencil=r.depthStencil||null,this._glID=t._gl.createFramebuffer()}var e=t.prototype;return e.destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed")},e.getHandle=function(){return this._glID},t}();i.default=r,e.exports=i.default},{}],318:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("./enums");var s=((r={})[n.enums.INDEX_FMT_UINT8]=1,r[n.enums.INDEX_FMT_UINT16]=2,r[n.enums.INDEX_FMT_UINT32]=4,r),o=function(){function t(t,e,i,r){this._device=t,this._format=e,this._usage=i,this._bytesPerIndex=s[e],this._bytes=r.byteLength,this._numIndices=this._bytes/this._bytesPerIndex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,r),t._stats.ib+=this._bytes}var e,i,r=t.prototype;return r.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},r.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numIndices=this._bytes/this._bytesPerIndex}var i=this._device._gl,r=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r),this._needExpandDataStore=!1):i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,t,e),this._device._restoreIndexBuffer()}}else console.error("The buffer is destroyed")},r.setUsage=function(t){this._usage=t},e=t,(i=[{key:"count",get:function(){return this._numIndices}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();o.BYTES_PER_INDEX=s;var a=o;i.default=a,e.exports=i.default},{"./enums":316}],319:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("./enums");r={VertexFormat:t("./vertex-format"),IndexBuffer:t("./index-buffer"),VertexBuffer:t("./vertex-buffer"),Program:t("./program"),Texture:t("./texture"),Texture2D:t("./texture-2d"),TextureCube:t("./texture-cube"),RenderBuffer:t("./render-buffer"),FrameBuffer:t("./frame-buffer"),Device:t("./device"),attrTypeBytes:n.attrTypeBytes,glFilter:n.glFilter,glTextureFmt:n.glTextureFmt},Object.assign(r,n.enums);var s=r;i.default=s,cc.gfx=r,e.exports=i.default},{"./device":315,"./enums":316,"./frame-buffer":317,"./index-buffer":318,"./program":321,"./render-buffer":322,"./texture":326,"./texture-2d":324,"./texture-cube":325,"./vertex-buffer":327,"./vertex-format":328}],320:[function(t,e,i){i.__esModule=!0,i.isPow2=function(t){return!(t&t-1||!t)}},{}],321:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=0;function n(t,e,i){i&&i.split("\n").forEach((function(i){if(!(i.length<5)){var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(i);r?t.push({type:e,fileID:0|r[1],line:0|r[2],message:r[3].trim()}):i.length>0&&t.push({type:e,fileID:-1,line:0,message:i})}}))}var s=function(){function t(t,e){this._device=t,this._attributes=[],this._uniforms=[],this._samplers=[],this._errors=[],this._linked=!1,this._vertSource=e.vert,this._fragSource=e.frag,this._glID=null,this._id=r++}var e,i,s=t.prototype;return s.link=function(){if(!this._linked){var t=this._device._gl,e=o(t,t.VERTEX_SHADER,this._vertSource),i=o(t,t.FRAGMENT_SHADER,this._fragSource),r=t.createProgram();t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r);var s=!1,a=this._errors;if(t.getShaderParameter(e,t.COMPILE_STATUS)||(n(a,"vs",t.getShaderInfoLog(e)),s=!0),t.getShaderParameter(i,t.COMPILE_STATUS)||(n(a,"fs",t.getShaderInfoLog(i)),s=!0),t.deleteShader(e),t.deleteShader(i),s)return a;if(!t.getProgramParameter(r,t.LINK_STATUS))return a.push({info:"Failed to link shader program: "+t.getProgramInfoLog(r)}),a;this._glID=r;for(var l=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),c=0;c<l;++c){var h=t.getActiveAttrib(r,c),u=t.getAttribLocation(r,h.name);this._attributes.push({name:h.name,location:u,type:h.type})}for(var d=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),p=0;p<d;++p){var f=t.getActiveUniform(r,p),_=f.name,m=t.getUniformLocation(r,_),g="[0]"===_.substr(_.length-3);g&&(_=_.substr(0,_.length-3));var y={name:_,location:m,type:f.type,size:g?f.size:void 0};this._uniforms.push(y)}this._linked=!0}},s.destroy=function(){this._device._gl.deleteProgram(this._glID),this._linked=!1,this._glID=null,this._attributes=[],this._uniforms=[],this._samplers=[]},e=t,(i=[{key:"id",get:function(){return this._id}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}i.default=s,e.exports=i.default},{}],322:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e,i,r){this._device=t,this._format=e,this._glID=t._gl.createRenderbuffer(),this.update(i,r)}var e=t.prototype;return e.update=function(t,e){this._width=t,this._height=e;var i=this._device._gl;i.bindRenderbuffer(i.RENDERBUFFER,this._glID),i.renderbufferStorage(i.RENDERBUFFER,this._format,t,e),i.bindRenderbuffer(i.RENDERBUFFER,null)},e.destroy=function(){if(null!==this._glID){var t=this._device._gl;t.bindRenderbuffer(t.RENDERBUFFER,null),t.deleteRenderbuffer(this._glID),this._glID=null}else console.error("The render-buffer already destroyed")},t}();i.default=r,e.exports=i.default},{}],323:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("./enums"),n={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:r.enums.BLEND_FUNC_ADD,blendAlphaEq:r.enums.BLEND_FUNC_ADD,blendSrc:r.enums.BLEND_ONE,blendDst:r.enums.BLEND_ZERO,blendSrcAlpha:r.enums.BLEND_ONE,blendDstAlpha:r.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:r.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:r.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:r.enums.STENCIL_OP_KEEP,stencilZFailOpFront:r.enums.STENCIL_OP_KEEP,stencilZPassOpFront:r.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:r.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:r.enums.STENCIL_OP_KEEP,stencilZFailOpBack:r.enums.STENCIL_OP_KEEP,stencilZPassOpBack:r.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:r.enums.CULL_BACK,primitiveType:r.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null},s=function(){function t(t){this.vertexBuffers=new Array(t._caps.maxVertexStreams),this.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),this.textureUnits=new Array(t._caps.maxTextureUnits),this.set(n)}t.initDefault=function(t){n.vertexBuffers=new Array(t._caps.maxVertexStreams),n.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),n.textureUnits=new Array(t._caps.maxTextureUnits)};var e=t.prototype;return e.reset=function(){this.set(n)},e.set=function(t){this.blend=t.blend,this.blendSep=t.blendSep,this.blendColor=t.blendColor,this.blendEq=t.blendEq,this.blendAlphaEq=t.blendAlphaEq,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.depthFunc=t.depthFunc,this.stencilTest=t.stencilTest,this.stencilSep=t.stencilSep,this.stencilFuncFront=t.stencilFuncFront,this.stencilRefFront=t.stencilRefFront,this.stencilMaskFront=t.stencilMaskFront,this.stencilFailOpFront=t.stencilFailOpFront,this.stencilZFailOpFront=t.stencilZFailOpFront,this.stencilZPassOpFront=t.stencilZPassOpFront,this.stencilWriteMaskFront=t.stencilWriteMaskFront,this.stencilFuncBack=t.stencilFuncBack,this.stencilRefBack=t.stencilRefBack,this.stencilMaskBack=t.stencilMaskBack,this.stencilFailOpBack=t.stencilFailOpBack,this.stencilZFailOpBack=t.stencilZFailOpBack,this.stencilZPassOpBack=t.stencilZPassOpBack,this.stencilWriteMaskBack=t.stencilWriteMaskBack,this.cullMode=t.cullMode,this.primitiveType=t.primitiveType,this.maxStream=t.maxStream;for(var e=0;e<t.vertexBuffers.length;++e)this.vertexBuffers[e]=t.vertexBuffers[e];for(var i=0;i<t.vertexBufferOffsets.length;++i)this.vertexBufferOffsets[i]=t.vertexBufferOffsets[i];this.indexBuffer=t.indexBuffer,this.maxTextureSlot=t.maxTextureSlot;for(var r=0;r<t.textureUnits.length;++r)this.textureUnits[r]=t.textureUnits[r];this.program=t.program},t}();i.default=s,e.exports=i.default},{"./enums":316}],324:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./texture"))&&r.__esModule?r:{default:r},s=t("./enums"),o=t("./misc");function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,i;function r(e,i){var r,n=(r=t.call(this,e)||this)._device._gl;return r._target=n.TEXTURE_2D,r._glID=n.createTexture(),i.images=i.images||[null],r.update(i),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var n=r.prototype;return n.update=function(t){var e=this._device._gl,i=this._genMipmap;if(t){void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=s.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=s.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=s.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=s.enums.TEXTURE_FMT_RGBA_ETC2||this._format>=s.enums.TEXTURE_FMT_RGBA_ASTC_4X4&&this._format<=s.enums.TEXTURE_FMT_SRGBA_ASTC_12X12),void 0!==t.genMipmaps&&(this._genMipmap=t.genMipmaps,i=t.genMipmaps);var r=this._device.caps.maxTextureSize||Number.MAX_VALUE,n=Math.max(t.width||0,t.height||0);r<n&&console.warn("The current texture size "+n+" exceeds the maximum size ["+r+"] supported on the device."),void 0!==t.images&&t.images.length>1&&(i=!1,(t.width>t.height?t.width:t.height)>>t.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap."))}(0,o.isPow2)(this._width)&&(0,o.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),void 0!==t.images&&t.images.length>0&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),t.images.length>1&&(this._genMipmap=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D),this._genMipmap=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,s.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,s.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,r=e.flipY,n=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this._compressed?i.compressedTexSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,s):i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,s)):(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,t.format,t.pixelType,s))},n._setImage=function(t,e){var i=this._device._gl,r=e.flipY,n=e.premultiplyAlpha,s=e.image;!s||ArrayBuffer.isView(s)||s instanceof ArrayBuffer?(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this._compressed?i.compressedTexImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,s):i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,s)):(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,t.format,t.pixelType,s))},n._setMipmap=function(t,e,i){for(var r=(0,s.glTextureFmt)(this._format),n={width:this._width,height:this._height,flipY:e,premultiplyAlpha:i,level:0,image:null},o=0;o<t.length;++o)n.level=o,n.width=this._width>>o,n.height=this._height>>o,n.image=t[o],this._setImage(r,n)},n._setTexInfo=function(){var t=this._device._gl,e=(0,o.isPow2)(this._width)&&(0,o.isPow2)(this._height);e||this._wrapS===s.enums.WRAP_CLAMP&&this._wrapT===s.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=s.enums.WRAP_CLAMP,this._wrapT=s.enums.WRAP_CLAMP);var i=this._genMipmap?this._mipFilter:-1;e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,(0,s.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,(0,s.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT);var r=this._device.ext("EXT_texture_filter_anisotropic");r&&t.texParameteri(t.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},r}(n.default);i.default=l,e.exports=i.default},{"./enums":316,"./misc":320,"./texture":326}],325:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./texture"))&&r.__esModule?r:{default:r},s=t("./enums"),o=t("./misc");function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,i;function r(e,i){var r,n=(r=t.call(this,e)||this)._device._gl;return r._target=n.TEXTURE_CUBE_MAP,r._glID=n.createTexture(),r.update(i),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,a(e,i);var n=r.prototype;return n.update=function(t){var e=this._device._gl,i=this._genMipmaps;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=s.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=s.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=s.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=s.enums.TEXTURE_FMT_RGBA_ETC2||this._format>=s.enums.TEXTURE_FMT_RGBA_ASTC_4X4&&this._format<=s.enums.TEXTURE_FMT_SRGBA_ASTC_12X12),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps,i=t.genMipmaps),void 0!==t.images&&t.images.length>1&&(i=!1,t.width!==t.height&&console.warn("texture-cube width and height should be identical."),t.width>>t.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn"))),(0,o.isPow2)(this._width)&&(0,o.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),void 0!==t.images&&t.images.length>0&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),t.images.length>1&&(this._genMipmaps=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_CUBE_MAP),this._genMipmaps=!0),this._setTexInfo(),this._device._restoreTexture(0)},n.updateSubImage=function(t){var e=this._device._gl,i=(0,s.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0)},n.updateImage=function(t){var e=this._device._gl,i=(0,s.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setImage(i,t),this._device._restoreTexture(0)},n._setSubImage=function(t,e){var i=this._device._gl,r=e.flipY,n=e.premultiplyAlpha,s=e.faceIndex,o=e.image;void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,e.x,e.y,t.format,t.pixelType,o)},n._setImage=function(t,e){var i=this._device._gl,r=e.flipY,n=e.premultiplyAlpha,s=e.faceIndex,o=e.image;void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,e.level,t.internalFormat,t.format,t.pixelType,o)},n._setMipmap=function(t,e,i){for(var r=(0,s.glTextureFmt)(this._format),n={width:this._width,height:this._height,faceIndex:0,flipY:e,premultiplyAlpha:i,level:0,image:null},o=0;o<t.length;++o){var a=t[o];n.level=o,n.width=this._width>>o,n.height=this._height>>o;for(var l=0;l<6;++l)n.faceIndex=l,n.image=a[l],this._setImage(r,n)}},n._setTexInfo=function(){var t=this._device._gl,e=(0,o.isPow2)(this._width)&&(0,o.isPow2)(this._height);e||this._wrapS===s.enums.WRAP_CLAMP&&this._wrapT===s.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=s.enums.WRAP_CLAMP,this._wrapT=s.enums.WRAP_CLAMP);var i=this._genMipmaps?this._mipFilter:-1;e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,(0,s.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,(0,s.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._wrapT);var r=this._device.ext("EXT_texture_filter_anisotropic");r&&t.texParameteri(t.TEXTURE_CUBE_MAP,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},r}(n.default);i.default=l,e.exports=i.default},{"./enums":316,"./misc":320,"./texture":326}],326:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("./enums"),n=0,s=function(){function t(t){this._device=t,this._width=4,this._height=4,this._genMipmaps=!1,this._compressed=!1,this._anisotropy=1,this._minFilter=r.enums.FILTER_LINEAR,this._magFilter=r.enums.FILTER_LINEAR,this._mipFilter=r.enums.FILTER_LINEAR,this._wrapS=r.enums.WRAP_REPEAT,this._wrapT=r.enums.WRAP_REPEAT,this._format=r.enums.TEXTURE_FMT_RGBA8,this._target=-1,this._id=n++}return t.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed")},t}();i.default=s,e.exports=i.default},{"./enums":316}],327:[function(t,e,i){i.__esModule=!0,i.default=void 0,t("./enums");var r=function(){function t(t,e,i,r){this._device=t,this._format=e,this._usage=i,this._bytesPerVertex=this._format._bytes,this._bytes=r.byteLength,this._numVertices=this._bytes/this._bytesPerVertex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,r),t._stats.vb+=this._bytes}var e,i,r=t.prototype;return r.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},r.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numVertices=this._bytes/this._bytesPerVertex}var i=this._device._gl,r=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ARRAY_BUFFER,e,r),this._needExpandDataStore=!1):i.bufferSubData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null)}}else console.error("The buffer is destroyed")},r.getFormat=function(t){return this._format.element(t)},r.setUsage=function(t){this._usage=t},e=t,(i=[{key:"count",get:function(){return this._numVertices}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=r,e.exports=i.default},{"./enums":316}],328:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("./enums"),s=(r=t("../murmurhash2_gc"))&&r.__esModule?r:{default:r},o=function(){function t(t){this._attr2el={},this._elements=[],this._bytes=0;for(var e="",i=0,r=t.length;i<r;++i){var o=t[i],a={name:o.name,offset:this._bytes,stride:0,stream:-1,type:o.type,num:o.num,normalize:void 0!==o.normalize&&o.normalize,bytes:o.num*(0,n.attrTypeBytes)(o.type)};this._attr2el[a.name]=a,this._elements.push(a),this._bytes+=a.bytes,e+=a.name+":"+a.num+":"+a.type+":"+a.normalize}for(var l=0,c=this._elements.length;l<c;++l)this._elements[l].stride=this._bytes;this._hash=(0,s.default)(e,666)}var e=t.prototype;return e.element=function(t){return this._attr2el[t]},e.getHash=function(){return this._hash},t}();i.default=o,e.exports=i.default},{"../murmurhash2_gc":337,"./enums":316}],329:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e){this._cursor=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}return t.prototype.request=function(){var t=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,t},t}();i.default=r,e.exports=i.default},{}],330:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./timsort"))&&r.__esModule?r:{default:r};var s=function(){function t(t){this._count=0,this._data=new Array(t)}var e,i,r=t.prototype;return r._resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=void 0},r.reset=function(){for(var t=0;t<this._count;++t)this._data[t]=void 0;this._count=0},r.push=function(t){this._count>=this._data.length&&this._resize(2*this._data.length),this._data[this._count]=t,++this._count},r.pop=function(){--this._count,this._count<0&&(this._count=0);var t=this._data[this._count];return this._data[this._count]=void 0,t},r.fastRemove=function(t){if(!(t>=this._count||t<0)){var e=this._count-1;this._data[t]=this._data[e],this._data[e]=void 0,this._count-=1}},r.indexOf=function(t){return this._data.indexOf(t)},r.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},e=t,(i=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=s,e.exports=i.default},{"./timsort":335}],331:[function(t,e,i){i.__esModule=!0,i.TypedArrayPool=i.RecyclePool=i.Pool=i.LinkedArray=i.FixedArray=i.CircularPool=void 0;var r=c(t("./circular-pool"));i.CircularPool=r.default;var n=c(t("./fixed-array"));i.FixedArray=n.default;var s=c(t("./linked-array"));i.LinkedArray=s.default;var o=c(t("./pool"));i.Pool=o.default;var a=c(t("./recycle-pool"));i.RecyclePool=a.default;var l=c(t("./typed-array-pool"));function c(t){return t&&t.__esModule?t:{default:t}}i.TypedArrayPool=l.default},{"./circular-pool":329,"./fixed-array":330,"./linked-array":332,"./pool":333,"./recycle-pool":334,"./typed-array-pool":336}],332:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./pool"))&&r.__esModule?r:{default:r};var s=function(){function t(t,e){this._fn=t,this._count=0,this._head=null,this._tail=null,this._pool=new n.default(t,e)}var e,i,r=t.prototype;return r.add=function(){var t=this._pool.alloc();return this._tail?(this._tail._next=t,t._prev=this._tail):this._head=t,this._tail=t,this._count+=1,t},r.remove=function(t){t._prev?t._prev._next=t._next:this._head=t._next,t._next?t._next._prev=t._prev:this._tail=t._prev,t._next=null,t._prev=null,this._pool.free(t),this._count-=1},r.forEach=function(t,e){var i=this._head;if(i){e&&(t=t.bind(e));for(var r=0,n=i;i;)n=i._next,t(i,r,this),i=n,++r}},e=t,(i=[{key:"head",get:function(){return this._head}},{key:"tail",get:function(){return this._tail}},{key:"length",get:function(){return this._count}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=s,e.exports=i.default},{"./pool":333}],333:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(t,e){this._fn=t,this._idx=e-1,this._frees=new Array(e);for(var i=0;i<e;++i)this._frees[i]=t()}var e=t.prototype;return e._expand=function(t){var e=this._frees;this._frees=new Array(t);for(var i=t-e.length,r=0;r<i;++r)this._frees[r]=this._fn();for(var n=i,s=0;n<t;++n,++s)this._frees[n]=e[s];this._idx+=i},e.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var t=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,t},e.free=function(t){++this._idx,this._frees[this._idx]=t},e.clear=function(t){for(var e=0;e<=this._idx;e++)t&&t(this._frees[e]);this._frees.length=0,this._idx=-1},t}();i.default=r,e.exports=i.default},{}],334:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("./timsort"))&&r.__esModule?r:{default:r};var s=function(){function t(t,e){this._fn=t,this._count=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}var e,i,r=t.prototype;return r.reset=function(){this._count=0},r.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},r.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},r.remove=function(t){if(!(t>=this._count)){var e=this._count-1,i=this._data[t];this._data[t]=this._data[e],this._data[e]=i,this._count-=1}},r.sort=function(t){return(0,n.default)(this._data,0,this._count,t)},e=t,(i=[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=s,cc.RecyclePool=s,e.exports=i.default},{"./timsort":335}],335:[function(t,e,i){i.__esModule=!0,i.default=function(t,e,i,n){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");void 0===e&&(e=0),void 0===i&&(i=t.length),void 0===n&&(n=o);var s=i-e;if(!(s<2)){var c=0;if(s<r)return void l(t,e,i,e+(c=a(t,e,i,n)),n);var h=new u(t,n),d=function(t){for(var e=0;t>=r;)e|=1&t,t>>=1;return t+e}(s);do{if((c=a(t,e,i,n))<d){var p=s;p>d&&(p=d),l(t,e,e+p,e+c,n),c=p}h.pushRun(e,c),h.mergeRuns(),s-=c,e+=c}while(0!==s);h.forceMergeRuns()}};var r=32,n=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function s(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function o(t,e){if(t===e)return 0;if(~~t===t&&~~e===e){if(0===t||0===e)return t<e?-1:1;if(t<0||e<0){if(e>=0)return-1;if(t>=0)return 1;t=-t,e=-e}var i=s(t),r=s(e),o=0;return i<r?(t*=n[r-i-1],e/=10,o=-1):i>r&&(e*=n[i-r-1],t/=10,o=1),t===e?o:t<e?-1:1}var a=String(t),l=String(e);return a===l?0:a<l?-1:1}function a(t,e,i,r){var n=e+1;if(n===i)return 1;if(r(t[n++],t[e])<0){for(;n<i&&r(t[n],t[n-1])<0;)n++;!function(t,e,i){for(i--;e<i;){var r=t[e];t[e++]=t[i],t[i--]=r}}(t,e,n)}else for(;n<i&&r(t[n],t[n-1])>=0;)n++;return n-e}function l(t,e,i,r,n){for(r===e&&r++;r<i;r++){for(var s=t[r],o=e,a=r;o<a;){var l=o+a>>>1;n(s,t[l])<0?a=l:o=l+1}var c=r-o;switch(c){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;c>0;)t[o+c]=t[o+c-1],c--}t[o]=s}}function c(t,e,i,r,n,s){var o=0,a=0,l=1;if(s(t,e[i+n])>0){for(a=r-n;l<a&&s(t,e[i+n+l])>0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=n,l+=n}else{for(a=n+1;l<a&&s(t,e[i+n-l])<=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=n-l,l=n-c}for(o++;o<l;){var h=o+(l-o>>>1);s(t,e[i+h])>0?o=h+1:l=h}return l}function h(t,e,i,r,n,s){var o=0,a=0,l=1;if(s(t,e[i+n])<0){for(a=n+1;l<a&&s(t,e[i+n-l])<0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=n-l,l=n-c}else{for(a=r-n;l<a&&s(t,e[i+n+l])>=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=n,l+=n}for(o++;o<l;){var h=o+(l-o>>>1);s(t,e[i+h])<0?l=h:o=h+1}return l}var u=function(){function t(t,e){this.array=t,this.compare=e,this.minGallop=7,this.length=t.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}var e=t.prototype;return e.pushRun=function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1},e.mergeRuns=function(){for(;this.stackSize>1;){var t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}},e.forceMergeRuns=function(){for(;this.stackSize>1;){var t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}},e.mergeAt=function(t){var e=this.compare,i=this.array,r=this.runStart[t],n=this.runLength[t],s=this.runStart[t+1],o=this.runLength[t+1];this.runLength[t]=n+o,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;var a=h(i[s],i,r,n,0,e);r+=a,0!=(n-=a)&&0!==(o=c(i[r+n-1],i,s,o,o-1,e))&&(n<=o?this.mergeLow(r,n,s,o):this.mergeHigh(r,n,s,o))},e.mergeLow=function(t,e,i,r){var n=this.compare,s=this.array,o=this.tmp,a=0;for(a=0;a<e;a++)o[a]=s[t+a];var l=0,u=i,d=t;if(s[d++]=s[u++],0!=--r)if(1!==e){for(var p=this.minGallop;;){var f=0,_=0,m=!1;do{if(n(s[u],o[l])<0){if(s[d++]=s[u++],_++,f=0,0==--r){m=!0;break}}else if(s[d++]=o[l++],f++,_=0,1==--e){m=!0;break}}while((f|_)<p);if(m)break;do{if(0!==(f=h(s[u],o,l,e,0,n))){for(a=0;a<f;a++)s[d+a]=o[l+a];if(d+=f,l+=f,(e-=f)<=1){m=!0;break}}if(s[d++]=s[u++],0==--r){m=!0;break}if(0!==(_=c(o[l],s,u,r,0,n))){for(a=0;a<_;a++)s[d+a]=s[u+a];if(d+=_,u+=_,0==(r-=_)){m=!0;break}}if(s[d++]=o[l++],1==--e){m=!0;break}p--}while(f>=7||_>=7);if(m)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===e){for(a=0;a<r;a++)s[d+a]=s[u+a];s[d+r]=o[l]}else{if(0===e)throw new Error("mergeLow preconditions were not respected");for(a=0;a<e;a++)s[d+a]=o[l+a]}}else{for(a=0;a<r;a++)s[d+a]=s[u+a];s[d+r]=o[l]}else for(a=0;a<e;a++)s[d+a]=o[l+a]},e.mergeHigh=function(t,e,i,r){var n=this.compare,s=this.array,o=this.tmp,a=0;for(a=0;a<r;a++)o[a]=s[i+a];var l=t+e-1,u=r-1,d=i+r-1,p=0,f=0;if(s[d--]=s[l--],0!=--e)if(1!==r){for(var _=this.minGallop;;){var m=0,g=0,y=!1;do{if(n(o[u],s[l])<0){if(s[d--]=s[l--],m++,g=0,0==--e){y=!0;break}}else if(s[d--]=o[u--],g++,m=0,1==--r){y=!0;break}}while((m|g)<_);if(y)break;do{if(0!=(m=e-h(o[u],s,t,e,e-1,n))){for(e-=m,f=1+(d-=m),p=1+(l-=m),a=m-1;a>=0;a--)s[f+a]=s[p+a];if(0===e){y=!0;break}}if(s[d--]=o[u--],1==--r){y=!0;break}if(0!=(g=r-c(s[l],o,0,r,r-1,n))){for(r-=g,f=1+(d-=g),p=1+(u-=g),a=0;a<g;a++)s[f+a]=o[p+a];if(r<=1){y=!0;break}}if(s[d--]=s[l--],0==--e){y=!0;break}_--}while(m>=7||g>=7);if(y)break;_<0&&(_=0),_+=2}if(this.minGallop=_,_<1&&(this.minGallop=1),1===r){for(f=1+(d-=e),p=1+(l-=e),a=e-1;a>=0;a--)s[f+a]=s[p+a];s[d]=o[u]}else{if(0===r)throw new Error("mergeHigh preconditions were not respected");for(p=d-(r-1),a=0;a<r;a++)s[p+a]=o[a]}}else{for(f=1+(d-=e),p=1+(l-=e),a=e-1;a>=0;a--)s[f+a]=s[p+a];s[d]=o[u]}else for(p=d-(r-1),a=0;a<r;a++)s[p+a]=o[a]},t}();e.exports=i.default},{}],336:[function(t,e,i){i.__esModule=!0,i.default=void 0;for(var r=Array(8),n=0;n<8;++n)r[n]=[];function s(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1}function o(t){var e=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}(t),i=r[s(e)>>2];return i.length>0?i.pop():new ArrayBuffer(e)}var a={alloc_int8:function(t){var e=new Int8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint8:function(t){var e=new Uint8Array(o(t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int16:function(t){var e=new Int16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint16:function(t){var e=new Uint16Array(o(2*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_int32:function(t){var e=new Int32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_uint32:function(t){var e=new Uint32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float32:function(t){var e=new Float32Array(o(4*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_float64:function(t){var e=new Float64Array(o(8*t),0,t);return e.length!==t?e.subarray(0,t):e},alloc_dataview:function(t){var e=new DataView(o(t),0,t);return e.length!==t?e.subarray(0,t):e},free:function(t){var e;e=t.buffer,r[s(e.byteLength)>>2].push(e)},reset:function(){for(var t=Array(8),e=0;e<8;++e)t[e]=[]}};i.default=a,e.exports=i.default},{}],337:[function(t,e,i){i.__esModule=!0,i.default=function(t,e){for(var i,r=t.length,n=e^r,s=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++s;switch(r){case 3:n^=(255&t.charCodeAt(s+2))<<16;case 2:n^=(255&t.charCodeAt(s+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(s)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0},e.exports=i.default},{}],338:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("../../core/value-types"),n=a(t("../core/base-renderer")),s=a(t("../enums")),o=t("../memop");function a(t){return t&&t.__esModule?t:{default:t}}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var h=new Float32Array(16),u=new Float32Array(16),d=new Float32Array(16),p=new Float32Array(16),f=new Float32Array(4),_=new Float32Array(64),m=[],g=new Float32Array(4),y=new r.Vec4(0,0,0,0),v=new r.Vec3(0,0,0),b=new r.Vec3(0,0,0),x=new o.RecyclePool((function(){return new Float32Array(16)}),8);function T(t,e){return t._priority-e._priority}var C=function(t){var e,i;function n(e,i){var r;return(r=t.call(this,e,i)||this)._time=new Float32Array(4),r._lights=[],r._shadowLights=[],r._numLights=0,r._defines={},r._registerStage("shadowcast",r._shadowStage.bind(l(r))),r._registerStage("opaque",r._opaqueStage.bind(l(r))),r._registerStage("transparent",r._transparentStage.bind(l(r))),r}i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,c(e,i);var o=n.prototype;return o.reset=function(){x.reset(),t.prototype.reset.call(this)},o.render=function(t,e){this.reset(),e&&(this._time[0]+=e,this._time[1]=e,this._time[2]++),this._device.setUniform("cc_time",this._time),this._updateLights(t);for(var i=this._device._gl.canvas,r=0;r<t._cameras.length;++r){var n=this._requestView(),s=i.width,o=i.height;t._cameras.data[r].extractView(n,s,o)}this._viewPools.sort(T);for(var a=0;a<this._viewPools.length;++a){var l=this._viewPools.data[a];this._render(l,t)}},o.renderCamera=function(t,e){this.reset(),this._updateLights(e);var i=this._device._gl.canvas,r=i.width,n=i.height,s=this._requestView();t.extractView(s,r,n),this._viewPools.sort(T);for(var o=0;o<this._viewPools.length;++o){var a=this._viewPools.data[o];this._render(a,e)}},o._updateLights=function(t){this._lights.length=0,this._shadowLights.length=0;for(var e=t._lights,i=0;i<e.length;++i){var r=e.data[i];if(r.update(this._device),r.shadowType!==s.default.SHADOW_NONE){this._shadowLights.length<2&&this._shadowLights.unshift(r);var n=this._requestView();r.extractView(n,["shadowcast"]),this._lights.splice(0,0,r)}else this._lights.push(r)}this._updateLightDefines(),this._numLights=e._count},o._updateLightDefines=function(){for(var t=this._defines,e=0;e<this._lights.length;++e){var i=this._lights[e],r="CC_LIGHT_"+e+"_TYPE",n="CC_SHADOW_"+e+"_TYPE";t[r]!==i._type&&(t[r]=i._type,this._definesChanged=!0),t[n]!==i._shadowType&&(t[n]=i._shadowType,this._definesChanged=!0)}var s=Math.min(4,this._lights.length);t.CC_NUM_LIGHTS!==s&&(t.CC_NUM_LIGHTS=s,this._definesChanged=!0),s=Math.min(4,this._shadowLights.length),t.CC_NUM_SHADOW_LIGHTS!==s&&(t.CC_NUM_SHADOW_LIGHTS=s,this._definesChanged=!0)},o._submitLightsUniforms=function(){var t=this._device;if(this._lights.length>0){for(var e=x.add(),i=x.add(),r=x.add(),n=Math.min(4,this._lights.length),o=0;o<n;++o){var a=this._lights[o],l=4*o;r.set(a._colorUniform,l),i.set(a._directionUniform,l),e.set(a._positionUniform,l),e[l+3]=a._range,a._type===s.default.LIGHT_SPOT?(i[l+3]=a._spotUniform[0],r[l+3]=a._spotUniform[1]):(i[l+3]=0,r[l+3]=0)}t.setUniform("cc_lightDirection",i),t.setUniform("cc_lightColor",r),t.setUniform("cc_lightPositionAndRange",e)}},o._submitShadowStageUniforms=function(t){var e=t._shadowLight,i=g;i[0]=e.shadowMinDepth,i[1]=e.shadowMaxDepth,i[2]=e.shadowDepthScale,i[3]=e.shadowDarkness,this._device.setUniform("cc_shadow_map_lightViewProjMatrix",r.Mat4.toArray(p,t._matViewProj)),this._device.setUniform("cc_shadow_map_info",i),this._device.setUniform("cc_shadow_map_bias",e.shadowBias),this._defines.CC_SHADOW_TYPE=e._shadowType},o._submitOtherStagesUniforms=function(){for(var t=x.add(),e=0;e<this._shadowLights.length;++e){var i=this._shadowLights[e],n=m[e];n||(n=m[e]=new Float32Array(_.buffer,64*e,16)),r.Mat4.toArray(n,i.viewProjMatrix);var s=4*e;t[s]=i.shadowMinDepth,t[s+1]=i.shadowMaxDepth,t[s+2]=i._shadowResolution,t[s+3]=i.shadowDarkness}this._device.setUniform("cc_shadow_lightViewProjMatrix",_),this._device.setUniform("cc_shadow_info",t)},o._sortItems=function(t){t.sort((function(t,e){return t.passes.length!==e.passes.length?t.passes.length-e.passes.length:t.sortKey-e.sortKey}))},o._shadowStage=function(t,e){this._submitShadowStageUniforms(t);for(var i=0;i<e.length;++i){var r=e.data[i];r.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(r)}},o._drawItems=function(t,e){var i=this._shadowLights;if(0===i.length&&0===this._numLights)for(var r=0;r<e.length;++r){var n=e.data[r];this._draw(n)}else for(var s=0;s<e.length;++s){for(var o=e.data[s],a=0;a<i.length;++a)this._device.setTexture("cc_shadow_map_"+a,i[a].shadowMap,this._allocTextureUnit());this._draw(o)}},o._opaqueStage=function(t,e){t.getPosition(y),this._device.setUniform("cc_matView",r.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(u,t._matViewInv)),this._device.setUniform("cc_matProj",r.Mat4.toArray(d,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(p,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(f,y)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),this._drawItems(t,e)},o._transparentStage=function(t,e){t.getPosition(y),t.getForward(v),this._device.setUniform("cc_matView",r.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",r.Mat4.toArray(u,t._matViewInv)),this._device.setUniform("cc_matProj",r.Mat4.toArray(d,t._matProj)),this._device.setUniform("cc_matViewProj",r.Mat4.toArray(p,t._matViewProj)),this._device.setUniform("cc_cameraPos",r.Vec4.toArray(f,y)),this._submitLightsUniforms(),this._submitOtherStagesUniforms();for(var i=0;i<e.length;++i){var n=e.data[i];n.node.getWorldPosition(b),r.Vec3.sub(b,b,y),n.sortKey=-r.Vec3.dot(b,v)}this._sortItems(e),this._drawItems(t,e)},n}(n.default);i.default=C,e.exports=i.default},{"../../core/value-types":286,"../core/base-renderer":308,"../enums":314,"../memop":331}],339:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=t("../../core/value-types"),s=t("../../core/geom-utils"),o=(r=t("../enums"))&&r.__esModule?r:{default:r};var a=new n.Mat4,l=new n.Mat4,c=new n.Mat4,h=new n.Mat4,u=new n.Mat4,d=new n.Mat4,p=new n.Vec3,f=new n.Vec3,_=function(){function t(){this._poolID=-1,this._node=null,this._projection=o.default.PROJ_PERSPECTIVE,this._priority=0,this._color=new n.Vec4(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=o.default.CLEAR_COLOR|o.default.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295}var e,i,r=t.prototype;return r.setCullingMask=function(t){this._cullingMask=t},r.getNode=function(){return this._node},r.setNode=function(t){this._node=t},r.getType=function(){return this._projection},r.setType=function(t){this._projection=t},r.getPriority=function(){return this._priority},r.setPriority=function(t){this._priority=t},r.getOrthoHeight=function(){return this._orthoHeight},r.setOrthoHeight=function(t){this._orthoHeight=t},r.getFov=function(){return this._fov},r.setFov=function(t){this._fov=t},r.getNear=function(){return this._near},r.setNear=function(t){this._near=t},r.getFar=function(){return this._far},r.setFar=function(t){this._far=t},r.getColor=function(t){return n.Vec4.copy(t,this._color)},r.setColor=function(t,e,i,r){n.Vec4.set(this._color,t,e,i,r)},r.getDepth=function(){return this._depth},r.setDepth=function(t){this._depth=t},r.getStencil=function(){return this._stencil},r.setStencil=function(t){this._stencil=t},r.getClearFlags=function(){return this._clearFlags},r.setClearFlags=function(t){this._clearFlags=t},r.getRect=function(t){return t.x=this._rect.x,t.y=this._rect.y,t.w=this._rect.w,t.h=this._rect.h,t},r.setRect=function(t,e,i,r){this._rect.x=t,this._rect.y=e,this._rect.w=i,this._rect.h=r},r.getStages=function(){return this._stages},r.setStages=function(t){this._stages=t},r.getFramebuffer=function(){return this._framebuffer},r.setFrameBuffer=function(t){this._framebuffer=t},r._calcMatrices=function(t,e){this._node.getWorldRT(c),n.Mat4.invert(l,c);var i=t/e;if(this._projection===o.default.PROJ_PERSPECTIVE)n.Mat4.perspective(h,this._fov,i,this._near,this._far);else{var r=this._orthoHeight*i,s=this._orthoHeight;n.Mat4.ortho(h,-r,r,-s,s,this._near,this._far)}n.Mat4.mul(u,h,l),n.Mat4.invert(d,u)},r.extractView=function(t,e,i){this._framebuffer&&(e=this._framebuffer._width,i=this._framebuffer._height),t._priority=this._priority,t._rect.x=this._rect.x*e,t._rect.y=this._rect.y*i,t._rect.w=this._rect.w*e,t._rect.h=this._rect.h*i,this.getColor(t._color),t._depth=this._depth,t._stencil=this._stencil,t._clearFlags=this._clearFlags,t._clearModel=this._clearModel,t._stages=this._stages,t._framebuffer=this._framebuffer,this._calcMatrices(e,i),n.Mat4.copy(t._matView,l),n.Mat4.copy(t._matViewInv,c),n.Mat4.copy(t._matProj,h),n.Mat4.copy(t._matViewProj,u),n.Mat4.copy(t._matInvViewProj,d),t._cullingMask=this._cullingMask},r.screenPointToRay=function(t,e,i,r,a){if(!cc.geomUtils)return a;a=a||new s.Ray,this._calcMatrices(i,r);var l=this._rect.x*i,c=this._rect.y*r,h=this._rect.w*i,u=this._rect.h*r;return n.Vec3.set(f,(t-l)/h*2-1,(e-c)/u*2-1,1),n.Vec3.transformMat4(f,f,d),this._projection===o.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(p):(n.Vec3.set(p,(t-l)/h*2-1,(e-c)/u*2-1,-1),n.Vec3.transformMat4(p,p,d)),s.Ray.fromPoints(a,p,f)},r.screenToWorld=function(t,e,i,r){this._calcMatrices(i,r);var s=this._rect.x*i,a=this._rect.y*r,l=this._rect.w*i,c=this._rect.h*r;return this._projection===o.default.PROJ_PERSPECTIVE?(n.Vec3.set(t,(e.x-s)/l*2-1,(e.y-a)/c*2-1,.9999),n.Vec3.transformMat4(t,t,d),this._node.getWorldPosition(p),n.Vec3.lerp(t,p,t,(0,n.lerp)(this._near/this._far,1,e.z))):(n.Vec3.set(t,(e.x-s)/l*2-1,(e.y-a)/c*2-1,2*e.z-1),n.Vec3.transformMat4(t,t,d)),t},r.worldToScreen=function(t,e,i,r){this._calcMatrices(i,r);var s=this._rect.x*i,o=this._rect.y*r,a=this._rect.w*i,l=this._rect.h*r;return n.Vec3.transformMat4(t,e,u),t.x=s+.5*(t.x+1)*a,t.y=o+.5*(t.y+1)*l,t.z=.5*t.z+.5,t},r.worldMatrixToScreen=function(t,e,i,r){this._calcMatrices(i,r),n.Mat4.mul(t,u,e);var s=i/2,o=r/2;return n.Mat4.identity(a),n.Mat4.transform(a,a,n.Vec3.set(p,s,o,0)),n.Mat4.scale(a,a,n.Vec3.set(p,s,o,1)),n.Mat4.mul(t,a,t),t},e=t,(i=[{key:"cullingMask",get:function(){return this._cullingMask},set:function(t){this._cullingMask=t}}])&&function(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();i.default=_,e.exports=i.default},{"../../core/geom-utils":151,"../../core/value-types":286,"../enums":314}],340:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=function(){function t(){this._type="default",this._poolID=-1,this._node=null,this._inputAssembler=null,this._effect=null,this._viewID=-1,this._cameraID=-1,this._userKey=-1,this._castShadow=!1,this._boundingShape=null}var e=t.prototype;return e.setNode=function(t){this._node=t},e.setInputAssembler=function(t){this._inputAssembler=t},e.setEffect=function(t){this._effect=t},e.setUserKey=function(t){this._userKey=t},e.extractDrawItem=function(t){t.model=this,t.node=this._node,t.ia=this._inputAssembler,t.effect=this._effect},t}();i.default=r,e.exports=i.default},{}],341:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=t("../memop"),n=function(){function t(t){this._lights=new r.FixedArray(16),this._models=new r.FixedArray(16),this._cameras=new r.FixedArray(16),this._debugCamera=null,this._app=t,this._views=[]}var e=t.prototype;return e._add=function(t,e){-1===e._poolID&&(t.push(e),e._poolID=t.length-1)},e._remove=function(t,e){-1!==e._poolID&&(t.data[t.length-1]._poolID=e._poolID,t.fastRemove(e._poolID),e._poolID=-1)},e.reset=function(){for(var t=0;t<this._models.length;++t)this._models.data[t]._viewID=-1},e.setDebugCamera=function(t){this._debugCamera=t},e.getCameraCount=function(){return this._cameras.length},e.getCamera=function(t){return this._cameras.data[t]},e.addCamera=function(t){this._add(this._cameras,t)},e.removeCamera=function(t){this._remove(this._cameras,t)},e.getModelCount=function(){return this._models.length},e.getModel=function(t){return this._models.data[t]},e.addModel=function(t){this._add(this._models,t)},e.removeModel=function(t){this._remove(this._models,t)},e.getLightCount=function(){return this._lights.length},e.getLight=function(t){return this._lights.data[t]},e.addLight=function(t){this._add(this._lights,t)},e.removeLight=function(t){this._remove(this._lights,t)},e.addView=function(t){-1===this._views.indexOf(t)&&this._views.push(t)},e.removeView=function(t){var e=this._views.indexOf(t);-1!==e&&this._views.splice(e,1)},t}();i.default=n,e.exports=i.default},{"../memop":331}],342:[function(t,e,i){i.__esModule=!0,i.getClassName=i.enums2default=i.ctor2enums=void 0,i.getInspectorProps=function(t){var e={type:t.type};Object.assign(e,t.editor||t.inspector),e.defines=t.defines,e.value=y(e.type)(t.value),t.range&&(e.range=t.range);var i=v(e.type);return e.typeName=b[i]||i,e.valueCtor=f[e.type],"cc.Texture2D"==e.typeName&&(e.typeName="cc.Asset",e.assetType="cc.Texture2D"),e},i.getInstanceType=i.getInstanceCtor=void 0;var r,n,s,o,a,l=u(t("./enums")),c=t("../core/value-types"),h=u(t("../core/assets/CCTexture2D"));function u(t){return t&&t.__esModule?t:{default:t}}a=t("./gfx/texture-2d");var d=cc.Object,p=((r={})[Boolean]=function(t){return t||!1},r[Number]=function(t){return t?ArrayBuffer.isView(t)?t[0]:t:0},r[c.Vec2]=function(t){return t?cc.v2(t[0],t[1]):cc.v2()},r[c.Vec3]=function(t){return t?cc.v3(t[0],t[1],t[2]):cc.v3()},r[c.Vec4]=function(t){return t?cc.v4(t[0],t[1],t[2],t[3]):cc.v4()},r[c.Color]=function(t){return t?cc.color(255*t[0],255*t[1],255*t[2],255*(t[3]||1)):cc.color()},r[c.Mat4]=function(t){return t?cc.mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]):cc.mat4()},r[h.default]=function(){return null},r[d]=function(){return null},r),f=((n={})[l.default.PARAM_INT]=Number,n[l.default.PARAM_INT2]=c.Vec2,n[l.default.PARAM_INT3]=c.Vec3,n[l.default.PARAM_INT4]=c.Vec4,n[l.default.PARAM_FLOAT]=Number,n[l.default.PARAM_FLOAT2]=c.Vec2,n[l.default.PARAM_FLOAT3]=c.Vec3,n[l.default.PARAM_FLOAT4]=c.Vec4,n[l.default.PARAM_MAT4]=c.Mat4,n[l.default.PARAM_TEXTURE_2D]=h.default,n.color=c.Color,n.number=Number,n.boolean=Boolean,n.default=d,n),_=((s={})[Number]=l.default.PARAM_FLOAT,s[c.Vec2]=l.default.PARAM_FLOAT2,s[c.Vec3]=l.default.PARAM_FLOAT3,s[c.Vec4]=l.default.PARAM_FLOAT4,s[c.Color]=l.default.PARAM_COLOR3,s[c.Color]=l.default.PARAM_COLOR4,s[c.Mat4]=l.default.PARAM_MAT4,s[h.default]=l.default.PARAM_TEXTURE_2D,s[a]=l.default.PARAM_TEXTURE_2D,s);i.ctor2enums=_;var m=((o={})[l.default.PARAM_INT]=new Uint32Array([0]),o[l.default.PARAM_INT2]=new Uint32Array([0,0]),o[l.default.PARAM_INT3]=new Uint32Array([0,0,0]),o[l.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),o[l.default.PARAM_FLOAT]=new Float32Array([0]),o[l.default.PARAM_FLOAT2]=new Float32Array([0,0]),o[l.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),o[l.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),o[l.default.PARAM_MAT4]=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),o[l.default.PARAM_TEXTURE_2D]=null,o.number=0,o.boolean=!1,o);i.enums2default=m;var g=function(t){return f[t]||f.default};i.getInstanceType=g;var y=function(t){return p[g(t)]};i.getInstanceCtor=y;var v=function(t){return cc.js.getClassName(g(t))};i.getClassName=v;var b={Number:"number",Boolean:"boolean"}},{"../core/assets/CCTexture2D":77,"../core/value-types":286,"./enums":314,"./gfx/texture-2d":324}],343:[function(t){var e=t("../compression/ZipUtils"),i=t("../compression/zlib.min"),r=t("../core/platform/js");function n(t){var e=cc.Label.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function s(t){var e=cc.Label.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function o(t){if(!t)return cc.color(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0;return cc.color(i,r,n,e)}var s=parseInt(t.substr(0,2),16)||0,o=parseInt(t.substr(2,2),16)||0,a=parseInt(t.substr(4,2),16)||0;return cc.color(s,o,a,255)}function a(t,e){for(var i=[],r=t.getElementsByTagName("properties"),n=0;n<r.length;++n)for(var s=r[n].getElementsByTagName("property"),a=0;a<s.length;++a)i.push(s[a]);e=e||{};for(var l=0;l<i.length;l++){var c=i[l],h=c.getAttribute("name"),u=c.getAttribute("type")||"string",d=c.getAttribute("value");"int"===u?d=parseInt(d):"float"===u?d=parseFloat(d):"bool"===u?d="true"===d:"color"===u&&(d=o(d)),e[h]=d}return e}t("../core/platform/CCSAXParser"),cc.TMXLayerInfo=function(){this.properties={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.v2(0,0)},cc.TMXLayerInfo.prototype={constructor:cc.TMXLayerInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXImageLayerInfo=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=cc.v2(0,0),this._opacity=0,this._trans=new cc.Color(255,255,255,255),this.sourceImage=null},cc.TMXObjectGroupInfo=function(){this.properties={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new cc.Color(255,255,255,255),this.offset=cc.v2(0,0),this._draworder="topdown"},cc.TMXObjectGroupInfo.prototype={constructor:cc.TMXObjectGroupInfo,getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}},cc.TMXTilesetInfo=function(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=null,this.imageSize=cc.size(0,0),this.tileOffset=cc.v2(0,0),this._tileSize=cc.size(0,0)},cc.TMXTilesetInfo.prototype={constructor:cc.TMXTilesetInfo,rectForGID:function(t,e){var i=e||cc.rect(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height,t&=cc.TiledMap.TileFlag.FLIPPED_MASK,t-=parseInt(this.firstGid,10);var r=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return i.x=parseInt(t%r*(this._tileSize.width+this.spacing)+this.margin,10),i.y=parseInt(parseInt(t/r,10)*(this._tileSize.height+this.spacing)+this.margin,10),i}},cc.TMXMapInfo=function(t,e,i,r,n){this.properties=[],this.orientation=null,this.parentElement=null,this.parentGID=null,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=cc.TiledMap.RenderOrder.RightDown,this._supportVersion=[1,2,0],this._parser=new cc.SAXParser,this._objectGroups=[],this._allChildren=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties={},this._tileAnimations={},this._tsxMap=null,this._textures=null,this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerTextures=null,this.initWithXML(t,e,i,r,n)},cc.TMXMapInfo.prototype={constructor:cc.TMXMapInfo,getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getStaggerAxis:function(){return this._staggerAxis},setStaggerAxis:function(t){this._staggerAxis=t},getStaggerIndex:function(){return this._staggerIndex},setStaggerIndex:function(t){this._staggerIndex=t},getHexSideLength:function(){return this._hexSideLength},setHexSideLength:function(t){this._hexSideLength=t},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._allChildren.push(t),this._layers.push(t)},getImageLayers:function(){return this._imageLayers},setImageLayers:function(t){this._allChildren.push(t),this._imageLayers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t)},getAllChildren:function(){return this._allChildren},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithXML:function(t,e,i,r,n){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxMap=e,this._textures=i,this._imageLayerTextures=n,this._textureSizes=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties.length=0,this._tileProperties={},this._tileAnimations={},this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TiledMap.NONE,this.parseXMLString(t)},parseXMLString:function(t,e){var i,r=this._parser._parseXML(t).documentElement,n=r.getAttribute("orientation"),s=r.getAttribute("staggeraxis"),o=r.getAttribute("staggerindex"),l=r.getAttribute("hexsidelength"),c=r.getAttribute("renderorder"),h=r.getAttribute("version")||"1.0.0";if("map"===r.nodeName){for(var u=h.split("."),d=this._supportVersion,p=0;p<d.length;p++){var f=parseInt(u[p])||0;if(d[p]<f){cc.logID(7216,h);break}}"orthogonal"===n?this.orientation=cc.TiledMap.Orientation.ORTHO:"isometric"===n?this.orientation=cc.TiledMap.Orientation.ISO:"hexagonal"===n?this.orientation=cc.TiledMap.Orientation.HEX:null!==n&&cc.logID(7217,n),this.renderOrder="right-up"===c?cc.TiledMap.RenderOrder.RightUp:"left-up"===c?cc.TiledMap.RenderOrder.LeftUp:"left-down"===c?cc.TiledMap.RenderOrder.LeftDown:cc.TiledMap.RenderOrder.RightDown,"x"===s?this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===s&&this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===o?this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===o&&this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),l&&this.setHexSideLength(parseFloat(l));var _=cc.size(0,0);_.width=parseFloat(r.getAttribute("width")),_.height=parseFloat(r.getAttribute("height")),this.setMapSize(_),(_=cc.size(0,0)).width=parseFloat(r.getAttribute("tilewidth")),_.height=parseFloat(r.getAttribute("tileheight")),this.setTileSize(_),this.properties=a(r)}var m=r.getElementsByTagName("tileset");for("map"!==r.nodeName&&(m=[]).push(r),i=0;i<m.length;i++){var g=m[i],y=g.getAttribute("source");if(y){var v=parseInt(g.getAttribute("firstgid")),b=this._tsxMap[y];b&&this.parseXMLString(b,v)}else{var x=g.getElementsByTagName("image"),T=x.length>1,C=x[0],S=C.getAttribute("source");S=S.replace(/\\/g,"/");var w=g.getElementsByTagName("tile"),A=w&&w.length||1,E=null,D=g.getAttribute("name")||"",L=parseInt(g.getAttribute("spacing"))||0,I=parseInt(g.getAttribute("margin"))||0,P=parseInt(e);P||(P=parseInt(g.getAttribute("firstgid"))||0);var M=cc.size(0,0);M.width=parseFloat(g.getAttribute("tilewidth")),M.height=parseFloat(g.getAttribute("tileheight"));var R=g.getElementsByTagName("tileoffset")[0],O=cc.v2(0,0);R&&(O.x=parseFloat(R.getAttribute("x")),O.y=parseFloat(R.getAttribute("y")));for(var B=null,N=0;N<A;N++)if(B&&!T||((B=new cc.TMXTilesetInfo).name=D,B.firstGid=P,B.spacing=L,B.margin=I,B._tileSize=M,B.tileOffset=O,B.sourceImage=this._textures[S],B.imageSize=this._textureSizes[S]||B.imageSize,B.sourceImage||cc.errorID(7221,S),this.setTilesets(B)),E=w&&w[N]){this.parentGID=parseInt(P)+parseInt(E.getAttribute("id")||0);var k=E.getElementsByTagName("image");if(k&&k.length>0){var F=(C=k[0]).getAttribute("source");F=F.replace(/\\/g,"/"),B.sourceImage=this._textures[F],B.sourceImage||cc.errorID(7221,F);var V=cc.size(0,0);V.width=parseFloat(C.getAttribute("width")),V.height=parseFloat(C.getAttribute("height")),B._tileSize=V,B.firstGid=this.parentGID}this._tileProperties[this.parentGID]=a(E);var j=E.getElementsByTagName("animation");if(j&&j.length>0){var G=j[0].getElementsByTagName("frame"),U={frames:[],dt:0,frameIdx:0};this._tileAnimations[this.parentGID]=U;for(var Y=U.frames,H=0;H<G.length;H++){var X=G[H],z=parseInt(P)+parseInt(X.getAttribute("tileid")),W=parseFloat(X.getAttribute("duration"));Y.push({tileid:z,duration:W/1e3,grid:null})}}}}}var Z=r.childNodes;for(i=0;i<Z.length;i++){var J=Z[i];if(!this._shouldIgnoreNode(J)){if("imagelayer"===J.nodeName){var q=this._parseImageLayer(J);q&&this.setImageLayers(q)}if("layer"===J.nodeName){var K=this._parseLayer(J);this.setLayers(K)}if("objectgroup"===J.nodeName){var Q=this._parseObjectGroup(J);this.setObjectGroups(Q)}}}return r},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},_parseImageLayer:function(t){var e=t.getElementsByTagName("image");if(!e||0==e.length)return null;var i=new cc.TMXImageLayerInfo;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var n=t.getAttribute("opacity")||1;i.opacity=parseInt(255*parseFloat(n))||255;var s=e[0],a=s.getAttribute("source");return i.sourceImage=this._imageLayerTextures[a],i.width=parseInt(s.getAttribute("width"))||0,i.height=parseInt(s.getAttribute("height"))||0,i.trans=o(s.getAttribute("trans")),i.sourceImage?i:(cc.errorID(7221,a),null)},_parseLayer:function(t){var r=t.getElementsByTagName("data")[0],n=new cc.TMXLayerInfo;n.name=t.getAttribute("name");var s=cc.size(0,0);s.width=parseFloat(t.getAttribute("width")),s.height=parseFloat(t.getAttribute("height")),n._layerSize=s;var o=t.getAttribute("visible");n.visible=!("0"===o);var l=t.getAttribute("opacity")||1;n._opacity=parseInt(255*parseFloat(l)),n.offset=cc.v2(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);for(var c="",h=0;h<r.childNodes.length;h++)c+=r.childNodes[h].nodeValue;c=c.trim();var u,d=r.getAttribute("compression"),p=r.getAttribute("encoding");if(d&&"gzip"!==d&&"zlib"!==d)return cc.logID(7218),null;switch(d){case"gzip":u=e.unzipBase64AsArray(c,4);break;case"zlib":u=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var n=4*r;i[r]=t[n]+256*t[n+1]+65536*t[n+2]+t[n+3]*(1<<24)}return i}(new i.Inflate(e.Base64.decodeAsArray(c,1)).decompress());break;case null:case"":if("base64"===p)u=e.Base64.decodeAsArray(c,4);else if("csv"===p){u=[];for(var f=c.split(","),_=0;_<f.length;_++)u.push(parseInt(f[_]))}else{var m=r.getElementsByTagName("tile");u=[];for(var g=0;g<m.length;g++)u.push(parseInt(m[g].getAttribute("gid")))}break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.logID(7219)}return u&&(n._tiles=new Uint32Array(u)),n.properties=a(t),n},_parseObjectGroup:function(t){var e=new cc.TMXObjectGroupInfo;e.name=t.getAttribute("name")||"",e.offset=cc.v2(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var i=t.getAttribute("opacity")||1;e._opacity=parseInt(255*parseFloat(i));var r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);var l=t.getAttribute("color");l&&e._color.fromHEX(l);var c=t.getAttribute("draworder");c&&(e._draworder=c),e.setProperties(a(t));var h=t.getElementsByTagName("object");if(h){for(var u=0;u<h.length;u++){var d=h[u],p={};p.id=d.getAttribute("id")||u,p.name=d.getAttribute("name")||"",p.width=parseFloat(d.getAttribute("width"))||0,p.height=parseFloat(d.getAttribute("height"))||0,p.x=parseFloat(d.getAttribute("x"))||0,p.y=parseFloat(d.getAttribute("y"))||0,p.rotation=parseFloat(d.getAttribute("rotation"))||0,a(d,p);var f=d.getAttribute("visible");p.visible=!(f&&0===parseInt(f));var _=d.getElementsByTagName("text");if(_&&_.length>0){var m=_[0];p.type=cc.TiledMap.TMXObjectType.TEXT,p.wrap="1"==m.getAttribute("wrap"),p.color=o(m.getAttribute("color")),p.halign=n(m.getAttribute("halign")),p.valign=s(m.getAttribute("valign")),p.pixelsize=parseInt(m.getAttribute("pixelsize"))||16,p.text=m.childNodes[0].nodeValue}var g=d.getAttribute("gid");g&&(p.gid=parseInt(g),p.type=cc.TiledMap.TMXObjectType.IMAGE);var y=d.getElementsByTagName("ellipse");y&&y.length>0&&(p.type=cc.TiledMap.TMXObjectType.ELLIPSE);var v=d.getElementsByTagName("polygon");if(v&&v.length>0){p.type=cc.TiledMap.TMXObjectType.POLYGON;var b=v[0].getAttribute("points");b&&(p.points=this._parsePointsString(b))}var x=d.getElementsByTagName("polyline");if(x&&x.length>0){p.type=cc.TiledMap.TMXObjectType.POLYLINE;var T=x[0].getAttribute("points");T&&(p.polylinePoints=this._parsePointsString(T))}p.type||(p.type=cc.TiledMap.TMXObjectType.RECT),e._objects.push(p)}"index"!==c&&e._objects.sort((function(t,e){return t.y-e.y}))}return e},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var n=i[r].split(",");e.push({x:parseFloat(n[0]),y:parseFloat(n[1])})}return e},setTileAnimations:function(t){this._tileAnimations=t},getTileAnimations:function(){return this._tileAnimations},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties=t},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t}};var l=cc.TMXMapInfo.prototype;r.getset(l,"mapWidth",l._getMapWidth,l._setMapWidth),r.getset(l,"mapHeight",l._getMapHeight,l._setMapHeight),r.getset(l,"tileWidth",l._getTileWidth,l._setTileWidth),r.getset(l,"tileHeight",l._getTileHeight,l._setTileHeight),cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8},{"../compression/ZipUtils":22,"../compression/zlib.min":25,"../core/platform/CCSAXParser":203,"../core/platform/js":217}],344:[function(t,e){var i,r=t("../core/value-types"),n=(i=t("../core/assets/material/material-variant"))&&i.__esModule?i:{default:i},s=t("../core/components/CCRenderComponent"),o=t("../core/assets/material/CCMaterial"),a=t("../core/renderer/render-flow"),l=cc.mat4(),c=cc.v2(),h=cc.v2(),u=cc.v2(),d={row:0,col:0},p=cc.Class({name:"cc.TiledUserNodeData",extends:cc.Component,ctor:function(){this._index=-1,this._row=-1,this._col=-1,this._tiledLayer=null}}),f=cc.Class({name:"cc.TiledLayer",extends:s,editor:{inspector:"packages://inspector/inspectors/comps/tiled-layer.js"},ctor:function(){this._userNodeGrid={},this._userNodeMap={},this._userNodeDirty=!1,this._tiledTiles=[],this._tilesetIndexArr=[],this._tilesetIndexToArrIndex={},this._texIdToMatIndex={},this._viewPort={x:-1,y:-1,width:-1,height:-1},this._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},this._cullingDirty=!0,this._rightTop={row:-1,col:-1},this._layerInfo=null,this._mapInfo=null,this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._tiles=[],this._vertices=[],this._verticesDirty=!0,this._layerName="",this._layerOrientation=null,this._texGrids=null,this._textures=null,this._tilesets=null,this._leftDownToCenterX=0,this._leftDownToCenterY=0,this._hasTiledNodeGrid=!1,this._hasAniGrid=!1,this._animations=null,this._enableCulling=cc.macro.ENABLE_TILEDMAP_CULLING},_hasTiledNode:function(){return this._hasTiledNodeGrid},_hasAnimation:function(){return this._hasAniGrid},enableCulling:function(t){this._enableCulling!=t&&(this._enableCulling=t,this._cullingDirty=!0)},addUserNode:function(t){var e=t.getComponent(p);return e?(cc.warn("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(p),t.parent=this.node,t._renderFlag|=a.FLAG_BREAK_FLOW,this._userNodeMap[t._id]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t,c),this._positionToRowCol(c.x,c.y,d),this._addUserNodeToGrid(e,d),this._updateCullingOffsetByUserNode(t),t.on(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.on(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},removeUserNode:function(t){var e=t.getComponent(p);return e?(t.off(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.off(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t._id],t._removeComponent(e),e.destroy(),t.removeFromParent(!0),t._renderFlag&=~a.FLAG_BREAK_FLOW,!0):(cc.warn("CCTiledLayer:removeUserNode node is not exist"),!1)},destroyUserNode:function(t){this.removeUserNode(t),t.destroy()},_nodeLocalPosToLayerPos:function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},_getNodesByRowCol:function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},_getNodesCountByRow:function(t){var e=this._userNodeGrid[t];return e?e.count:0},_updateAllUserNode:function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node,c),this._positionToRowCol(c.x,c.y,d),this._addUserNodeToGrid(e,d),this._updateCullingOffsetByUserNode(e.node)}},_updateCullingOffsetByUserNode:function(t){this._topOffset<t.height&&(this._topOffset=t.height),this._downOffset<t.height&&(this._downOffset=t.height),this._leftOffset<t.width&&(this._leftOffset=t.width),this._rightOffset<t.width&&(this._rightOffset=t.width)},_userNodeSizeChange:function(){var t=this.node;this._tiledLayer._updateCullingOffsetByUserNode(t)},_userNodePosChange:function(){var t=this.node,e=this._tiledLayer;e._nodeLocalPosToLayerPos(t,c),e._positionToRowCol(c.x,c.y,d),e._limitInLayer(d),d.row===this._row&&d.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,d))},_removeUserNodeFromGrid:function(t){var e=t._row,i=t._col,r=t._index,n=this._userNodeGrid[e],s=n&&n[i];s&&(n.count--,s.count--,s.list[r]=null,s.count<=0&&(s.list.length=0,s.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0},_limitInLayer:function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},_addUserNodeToGrid:function(t,e){var i=e.row,r=e.col,n=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},s=n[r]=n[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=s.list.length,n.count++,s.count++,s.list.push(t),this._userNodeDirty=!0},_isUserNodeDirty:function(){return this._userNodeDirty},_setUserNodeDirty:function(t){this._userNodeDirty=t},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this),this._activateMaterial()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_syncAnchorPoint:function(){var t=this.node;this._leftDownToCenterX=t.width*t.anchorX*t.scaleX,this._leftDownToCenterY=t.height*t.anchorY*t.scaleY,this._cullingDirty=!0},onDestroy:function(){this._super(),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._renderDataList=null},getLayerName:function(){return this._layerName},setLayerName:function(t){this._layerName=t},getProperty:function(t){return this._properties[t]},getPositionAt:function(t,e){var i,r;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case cc.TiledMap.Orientation.ORTHO:r=this._positionForOrthoAt(i,e);break;case cc.TiledMap.Orientation.ISO:r=this._positionForIsoAt(i,e);break;case cc.TiledMap.Orientation.HEX:r=this._positionForHexAt(i,e)}return r},_isInvalidPosition:function(t,e){if(t&&"object"==typeof t){var i=t;e=i.y,t=i.x}return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},_positionForIsoAt:function(t,e){var i=0,r=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this._tiles[n];if(s){var o=(s&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0,a=this._texGrids[o].tileset.tileOffset;i=a.x,r=a.y}return cc.v2(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-r)},_positionForOrthoAt:function(t,e){var i=0,r=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this._tiles[n];if(s){var o=(s&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0,a=this._texGrids[o].tileset.tileOffset;i=a.x,r=a.y}return cc.v2(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-r)},_positionForHexAt:function(t,e){var i,r=this._mapTileSize.width,n=this._mapTileSize.height,s=this._layerSize.height,o=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this._tiles[o];i=this._texGrids[a]?this._texGrids[a].tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1,c=0,h=0,u=0,d=0;switch(this._staggerAxis){case cc.TiledMap.StaggerAxis.STAGGERAXIS_Y:u=0,e%2==1&&(u=r/2*l),c=t*r+u+i.x,h=(s-e-1)*(n-(n-this._hexSideLength)/2)-i.y;break;case cc.TiledMap.StaggerAxis.STAGGERAXIS_X:d=0,t%2==1&&(d=n/2*-l),c=t*(r-(r-this._hexSideLength)/2)+i.x,h=(s-e-1)*n+d-i.y}return cc.v2(c,h)},setTilesGIDAt:function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var n=0,s=e+r,o=i;;o++)for(var a=e;a<s;a++){if(n>=t.length)return;this._updateTileForGID(t[n],a,o),n++}}},setTileGIDAt:function(t,e,i,r){if(void 0===e)throw new Error("cc.TiledLayer.setTileGIDAt(): pos should be non-null");var n;void 0===r&&e instanceof cc.Vec2?(n=e,r=i):(u.x=e,u.y=i,n=u);var s=t&cc.TiledMap.TileFlag.FLIPPED_MASK;if(n.x=Math.floor(n.x),n.y=Math.floor(n.y),this._isInvalidPosition(n))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this._tiles&&this._tilesets&&0!=this._tilesets.length?0!==s&&s<this._tilesets[0].firstGid?cc.logID(7239,t):(r=r||0,this._updateTileForGID((t|r)>>>0,n.x,n.y)):cc.logID(7238)},_updateTileForGID:function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this._tiles.length)&&t!==this._tiles[r]){var n=(t&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0,s=this._texGrids[n],o=s&&s.texId;s?(this._tiles[r]=t,this._updateVertex(e,i),this._buildMaterial(o)):this._tiles[r]=0,this._cullingDirty=!0}},getTiles:function(){return this._tiles},getTileGIDAt:function(t,e){if(void 0===t)throw new Error("cc.TiledLayer.getTileGIDAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),this._isInvalidPosition(i,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this._tiles)return cc.logID(7237),null;var r=Math.floor(i)+Math.floor(e)*this._layerSize.width;return(this._tiles[r]&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0},getTileFlagsAt:function(t,e){if(!t)throw new Error("TiledLayer.getTileFlagsAt: pos should be non-null");if(void 0!==e&&(t=cc.v2(t,e)),this._isInvalidPosition(t))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this._tiles)return cc.logID(7240),null;var i=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;return(this._tiles[i]&cc.TiledMap.TileFlag.FLIPPED_ALL)>>>0},_setCullingDirty:function(t){this._cullingDirty=t},_isCullingDirty:function(){return this._cullingDirty},_updateViewPort:function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var n=1;this._layerOrientation===cc.TiledMap.Orientation.ISO&&(n=2);var s=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=s-this._leftOffset,l=o-this._downOffset,c=s+i+this._rightOffset,h=o+r+this._topOffset,u=this._cullingRect.leftDown,p=this._cullingRect.rightTop;a<0&&(a=0),l<0&&(l=0),this._positionToRowCol(a,l,d),d.row-=n,d.col-=n,d.row=d.row>0?d.row:0,d.col=d.col>0?d.col:0,d.row===u.row&&d.col===u.col||(u.row=d.row,u.col=d.col,this._cullingDirty=!0),c<0||h<0?(d.row=-1,d.col=-1):(this._positionToRowCol(c,h,d),d.row++,d.col++),d.row>this._rightTop.row&&(d.row=this._rightTop.row),d.col>this._rightTop.col&&(d.col=this._rightTop.col),d.row===p.row&&d.col===p.col||(p.row=d.row,p.col=d.col,this._cullingDirty=!0)}},_positionToRowCol:function(t,e,i){var r=cc.TiledMap,n=r.Orientation,s=r.StaggerAxis,o=this._mapTileSize.width,a=this._mapTileSize.height,l=.5*o,c=.5*a,h=0,u=0,d=0,p=0,f=this._staggerAxis;switch(this._layerSize.width,this._layerOrientation){case n.ORTHO:u=Math.floor(t/o),h=Math.floor(e/a);break;case n.ISO:u=Math.floor(t/l),h=Math.floor(e/c);break;case n.HEX:f===s.STAGGERAXIS_Y?(d=(h=Math.floor(e/(a-this._diffY1)))%2==1?l*this._odd_even:0,u=Math.floor((t-d)/o)):(p=(u=Math.floor(t/(o-this._diffX1)))%2==1?c*-this._odd_even:0,h=Math.floor((e-p)/a))}return i.row=h,i.col=u,i},_updateCulling:function(){if(this._enableCulling){this.node._updateWorldMatrix(),r.Mat4.invert(l,this.node._worldMatrix);var t=cc.visibleRect,e=cc.Camera.findCamera(this.node);e&&(c.x=0,c.y=0,h.x=c.x+t.width,h.y=c.y+t.height,e.getScreenToWorldPoint(c,c),e.getScreenToWorldPoint(h,h),r.Vec2.transformMat4(c,c,l),r.Vec2.transformMat4(h,h,l),this._updateViewPort(c.x,c.y,h.x-c.x,h.y-c.y))}},getLayerOrientation:function(){return this._layerOrientation},getProperties:function(){return this._properties},_updateVertex:function(t,e){var i=cc.TiledMap,r=i.TileFlag.FLIPPED_MASK,n=i.StaggerAxis,s=i.Orientation,o=this._vertices,a=this._layerOrientation,l=this._tiles;if(l){var c,h,u,d,p,f,_,m=this._rightTop,g=this._mapTileSize.width,y=this._mapTileSize.height,v=.5*g,b=.5*y,x=this._layerSize.height,T=this._layerSize.width,C=this._texGrids;a===s.HEX&&(d=this._staggerAxis,p=this._diffX1,f=this._diffY1,_=this._odd_even);var S,w,A,E,D=0,L=0,I=0,P=0,M=e*T+t;if(c=C[w=(l[M]&r)>>>0]){switch(this._animations[w]&&(this._hasAniGrid=this._hasAniGrid||!0),a){case s.ORTHO:h=(D=t)*g,u=(L=x-e-1)*y;break;case s.ISO:h=v*(D=x+t-e-1),u=b*(L=x+T-t-e-2);break;case s.HEX:h=t*(g-p)+(d===n.STAGGERAXIS_Y&&e%2==1?v*_:0),u=(x-e-1)*(y-f)+(d===n.STAGGERAXIS_X&&t%2==1?b*-_:0),D=t,L=x-e-1}var R=o[L]=o[L]||{minCol:0,maxCol:0},O=R[D]=R[D]||{};R.minCol>D&&(R.minCol=D),R.maxCol<D&&(R.maxCol=D),m.row<L&&(m.row=L),m.col<D&&(m.col=D),S=c.tileset.tileOffset,h+=this._offset.x+S.x,u+=this._offset.y-S.y,I=(I=-S.y+c.tileset._tileSize.height-y)<0?0:I,A=S.y<0?0:S.y,E=-S.x<0?0:-S.x,P=(P=S.x+c.tileset._tileSize.width-g)<0?0:P,this._rightOffset<E&&(this._rightOffset=E),this._leftOffset<P&&(this._leftOffset=P),this._topOffset<A&&(this._topOffset=A),this._downOffset<I&&(this._downOffset=I),O.left=h,O.bottom=u,O.index=M,this._cullingDirty=!0}}},_updateVertices:function(){if(this._vertices.length=0,this._tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var n=0;n<i;++n)this._updateVertex(n,r);this._verticesDirty=!1}},getTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this._tiledTiles[r];if(!n&&i){var s=new cc.Node;return(n=s.addComponent(cc.TiledTile))._x=t,n._y=e,n._layer=this,n._updateInfo(),s.parent=this.node,n}return n},setTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this._tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this._tiledTiles.some((function(t){return!!t})),i},getTexture:function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},getTextures:function(){return this._textures},setTexture:function(t){this.setTextures([t])},setTextures:function(t){this._textures=t,this._activateMaterial()},getLayerSize:function(){return this._layerSize},getMapTileSize:function(){return this._mapTileSize},getTileSet:function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},getTileSets:function(){return this._tilesets},setTileSet:function(t){this.setTileSets([t])},setTileSets:function(t){this._tilesets=t;for(var e=this._textures=[],i=this._texGrids=[],r=0;r<t.length;r++){var n=t[r];n&&(e[r]=n.sourceImage)}cc.TiledMap.loadAllTextures(e,function(){for(var e=0,r=t.length;e<r;++e){var n=t[e];n&&cc.TiledMap.fillTextureGrids(n,i,e)}this._prepareToRender()}.bind(this))},_traverseAllGrid:function(){var t=this._tiles,e=this._texGrids,i=this._tilesetIndexArr,r=this._tilesetIndexToArrIndex={},n=cc.TiledMap.TileFlag.FLIPPED_MASK;i.length=0;for(var s=0;s<t.length;s++){var o=t[s];if(0!==o){var a=e[o=(o&n)>>>0];if(a){var l=a.texId;void 0===r[l]&&(r[l]=i.length,i.push(l))}else cc.error("CCTiledLayer:_traverseAllGrid grid is null, gid is:",o)}}},_init:function(t,e,i,r,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var s=t._layerSize;this._layerName=t.name,this._tiles=t._tiles,this._properties=t.properties,this._layerSize=s,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this._renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=r,this._texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var o=this._mapTileSize.width,a=this._mapTileSize.height,l=this._layerSize.width,c=this._layerSize.height;if(this._layerOrientation===cc.TiledMap.Orientation.HEX){var h=cc.TiledMap,u=h.StaggerAxis,d=h.StaggerIndex,p=0,f=0;this._odd_even=this._staggerIndex===d.STAGGERINDEX_ODD?1:-1,this._staggerAxis===u.STAGGERAXIS_X?(this._diffX1=(o-this._hexSideLength)/2,this._diffY1=0,f=a*(c+.5),p=(o+this._hexSideLength)*Math.floor(l/2)+o*(l%2)):(this._diffX1=0,this._diffY1=(a-this._hexSideLength)/2,p=o*(l+.5),f=(a+this._hexSideLength)*Math.floor(c/2)+a*(c%2)),this.node.setContentSize(p,f)}else if(this._layerOrientation===cc.TiledMap.Orientation.ISO){var _=l+c;this.node.setContentSize(.5*o*_,.5*a*_)}else this.node.setContentSize(l*o,c*a);this._offset=cc.v2(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},_prepareToRender:function(){this._updateVertices(),this._traverseAllGrid(),this._updateAllUserNode(),this._activateMaterial()},_buildMaterial:function(t){var e=this._texIdToMatIndex;if(void 0!==e[t])return null;var i=this._tilesetIndexArr,r=this._tilesetIndexToArrIndex,s=r[t];void 0===s&&(r[t]=s=i.length,i.push(t));var a=this._textures[t],l=this._materials[s];return l||(l=o.getBuiltinMaterial("2d-sprite")),(l=n.default.create(l,this)).define("CC_USE_MODEL",!0),l.setProperty("texture",a),this._materials[s]=l,e[t]=s,l},_activateMaterial:function(){var t=this._tilesetIndexArr;if(0!==t.length){for(var e=t.length,i=0;i<e;i++)this._buildMaterial(t[i]);this._materials.length=e,this.markForRender(!0)}else this.disableRender()}});cc.TiledLayer=e.exports=f},{"../core/assets/material/CCMaterial":81,"../core/assets/material/material-variant":88,"../core/components/CCRenderComponent":117,"../core/renderer/render-flow":228,"../core/value-types":286}],345:[function(t,e){t("./CCTMXXMLParser"),t("./CCTiledMapAsset"),t("./CCTiledLayer"),t("./CCTiledTile"),t("./CCTiledObjectGroup");var i=cc.Enum({ORTHO:0,HEX:1,ISO:2}),r=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),n=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:4026531840,FLIPPED_MASK:268435455}),s=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1}),o=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1}),a=cc.Enum({RightDown:0,RightUp:1,LeftDown:2,LeftUp:3}),l=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4,TEXT:5}),c=cc.Class({name:"cc.TiledMap",extends:cc.Component,editor:!1,ctor:function(){this._texGrids=[],this._textures=[],this._tilesets=[],this._animations=[],this._imageLayers=[],this._layers=[],this._groups=[],this._images=[],this._properties=[],this._tileProperties=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0)},statics:{Orientation:i,Property:r,TileFlag:n,StaggerAxis:s,StaggerIndex:o,TMXObjectType:l,RenderOrder:a},properties:{_tmxFile:{default:null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile},set:function(t){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile())},type:cc.TiledMapAsset}},getMapSize:function(){return this._mapSize},getTileSize:function(){return this._tileSize},getMapOrientation:function(){return this._mapOrientation},getObjectGroups:function(){return this._groups},getObjectGroup:function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getGroupName()===t)return n}return null},enableCulling:function(t){for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling(t)},getProperties:function(){return this._properties},getLayers:function(){return this._layers},getLayer:function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getLayerName()===t)return n}return null},_changeLayer:function(t,e){for(var i=this._layers,r=0,n=i.length;r<n;r++){var s=i[r];if(s&&s.getLayerName()===t)return void(i[r]=e)}},getProperty:function(t){return this._properties[t.toString()]},getPropertiesForGID:function(t){return this._tileProperties[t]},__preload:function(){this._tmxFile&&this._applyFile()},onEnable:function(){this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},onDisable:function(){this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this)},_applyFile:function(){var t=this._tmxFile;if(t){for(var e=t.textures,i=t.textureNames,r=t.textureSizes,n={},s={},o=0;o<e.length;++o){var a=i[o];n[a]=e[o],s[a]=r[o]}var l={};e=t.imageLayerTextures,i=t.imageLayerTextureNames;for(var c=0;c<e.length;++c)l[i[c]]=e[c];for(var h=t.tsxFileNames,u=t.tsxFiles,d={},p=0;p<h.length;++p)h[p].length>0&&(d[h[p]]=u[p].text);var f=new cc.TMXMapInfo(t.tmxXmlStr,d,n,s,l),_=f.getTilesets();_&&0!==_.length||cc.logID(7241),this._buildWithMapInfo(f)}else this._releaseMapInfo()},_releaseMapInfo:function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(!0),t[e].node.destroy();t.length=0;for(var r=this._groups,n=0,s=r.length;n<s;n++)r[n].node.removeFromParent(!0),r[n].node.destroy();r.length=0;for(var o=this._images,a=0,l=o.length;a<l;a++)o[a].removeFromParent(!0),o[a].destroy();o.length=0},_syncAnchorPoint:function(){var t,e,i=this.node.getAnchorPoint(),r=this.node.width*i.x,n=this.node.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var s=this._groups[t],o=s.node;o.anchorX=.5,o.anchorY=.5,o.x=s._offset.x-r+o.width*o.anchorX,o.y=s._offset.y+n-o.height*o.anchorY}for(t=0,e=this._images.length;t<e;t++){var a=this._images[t];a.anchorX=.5,a.anchorY=.5,a.x=a._offset.x-r+a.width*a.anchorX,a.y=a._offset.y+n-a.height*a.anchorY}},_fillAniGrids:function(t,e){for(var i in e){var r=e[i];if(r)for(var n=r.frames,s=0;s<n.length;s++){var o=n[s];o.grid=t[o.tileid]}}},_buildLayerAndGroup:function(){var t=this._tilesets,e=this._texGrids,i=this._animations;e.length=0;for(var r=0,n=t.length;r<n;++r){var s=t[r];s&&cc.TiledMap.fillTextureGrids(s,e,r)}this._fillAniGrids(e,i);for(var o=this._layers,a=this._groups,l=this._images,c={},h=0,u=o.length;h<u;h++)c[o[h].node._name]=!0;for(var d=0,p=a.length;d<p;d++)c[a[d].node._name]=!0;for(var f=0,_=l.length;f<_;f++)c[l[f]._name]=!0;o=this._layers=[],a=this._groups=[],l=this._images=[];var m=this._mapInfo,g=this.node,y=m.getAllChildren(),v=this._textures,b=0,x=0;if(y&&y.length>0)for(var T=0,C=y.length;T<C;T++){var S=y[T],w=S.name,A=this.node.getChildByName(w);if(c[w]=!1,A||((A=new cc.Node).name=w,g.addChild(A)),A.setSiblingIndex(T),A.active=S.visible,S instanceof cc.TMXLayerInfo){var E=A.getComponent(cc.TiledLayer);E||(E=A.addComponent(cc.TiledLayer)),E._init(S,m,t,v,e),S.ownTiles=!1,o.push(E)}else if(S instanceof cc.TMXObjectGroupInfo){var D=A.getComponent(cc.TiledObjectGroup);D||(D=A.addComponent(cc.TiledObjectGroup)),D._init(S,m,e),a.push(D)}else if(S instanceof cc.TMXImageLayerInfo){var L=S.sourceImage;A.opacity=S.opacity,A.layerInfo=S,A._offset=cc.v2(S.offset.x,-S.offset.y);var I=A.getComponent(cc.Sprite);I||(I=A.addComponent(cc.Sprite));var P=I.spriteFrame||new cc.SpriteFrame;P.setTexture(L),I.spriteFrame=P,A.width=L.width,A.height=L.height,l.push(A)}b=Math.max(b,A.width),x=Math.max(x,A.height)}for(var M=g.children,R=0,O=M.length;R<O;R++){var B=M[R];c[B._name]&&B.destroy()}this.node.width=b,this.node.height=x,this._syncAnchorPoint()},_buildWithMapInfo:function(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var e=this._tilesets;this._textures.length=0;for(var i=[],r=0,n=e.length;r<n;++r){var s=e[r];s&&s.sourceImage&&(this._textures[r]=s.sourceImage,i.push(s.sourceImage))}for(var o=0;o<this._imageLayers.length;o++){var a=this._imageLayers[o];a&&a.sourceImage&&i.push(a.sourceImage)}cc.TiledMap.loadAllTextures(i,function(){this._buildLayerAndGroup()}.bind(this))},update:function(t){var e=this._animations,i=this._texGrids;for(var r in e){var n=e[r],s=n.frames,o=s[n.frameIdx];n.dt+=t,o.duration<n.dt&&(n.dt=0,n.frameIdx++,n.frameIdx>=s.length&&(n.frameIdx=0),o=s[n.frameIdx]),i[r]=o.grid}}});cc.TiledMap=e.exports=c,cc.TiledMap.loadAllTextures=function(t,e){var i=t.length;if(0!==i)for(var r=0,n=function(){++r>=i&&e()},s=0;s<i;s++){var o=t[s];o.loaded?n():o.once("load",(function(){n()}))}else e()},cc.TiledMap.fillTextureGrids=function(t,e,i){var r=t.sourceImage;t.imageSize.width&&t.imageSize.height||(t.imageSize.width=r.width,t.imageSize.height=r.height);var n=t._tileSize.width,s=t._tileSize.height,o=r.width,a=r.height,l=t.spacing,c=t.margin,h=Math.floor((o-2*c+l)/(n+l)),u=Math.floor((a-2*c+l)/(s+l))*h,d=t.firstGid,p=null,f=!!e[d],_=cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX?.5:0;u<=0&&(u=1);for(var m=t.firstGid+u;d<m&&(f&&!e[d]&&(f=!1),f||!e[d]);++d)p={texId:i,tileset:t,x:0,y:0,width:n,height:s,t:0,l:0,r:0,b:0,gid:d},t.rectForGID(d,p),p.x+=_,p.y+=_,p.width-=2*_,p.height-=2*_,p.t=p.y/a,p.l=p.x/o,p.r=(p.x+p.width)/o,p.b=(p.y+p.height)/a,e[d]=p},cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",(function(){return cc.errorID(7203),[]}),!1)},{"./CCTMXXMLParser":343,"./CCTiledLayer":344,"./CCTiledMapAsset":346,"./CCTiledObjectGroup":348,"./CCTiledTile":349}],346:[function(t,e){var i=cc.Class({name:"cc.TiledMapAsset",extends:cc.Asset,properties:{tmxXmlStr:"",textures:{default:[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{default:[],type:[cc.Size]},imageLayerTextures:{default:[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=i,e.exports=i},{}],347:[function(t,e){var i,r=(i=t("../renderer/core/input-assembler"))&&i.__esModule?i:{default:i},n=cc.Class({name:"cc.TiledMapRenderDataList",ctor:function(){this._dataList=[],this._offset=0},_pushRenderData:function(){var t={};t.ia=new r.default,t.nodesRenderList=[],this._dataList.push(t)},popRenderData:function(t){this._offset>=this._dataList.length&&this._pushRenderData();var e=this._dataList[this._offset];e.nodesRenderList.length=0;var i=e.ia;return i._vertexBuffer=t._vb,i._indexBuffer=t._ib,i._start=t.indiceOffset,i._count=0,this._offset++,e},pushNodesList:function(t,e){t.nodesRenderList.push(e)},reset:function(){this._offset=0}});cc.TiledMapRenderDataList=e.exports=n},{"../renderer/core/input-assembler":309}],348:[function(t,e){var i=cc.Class({name:"cc.TiledObjectGroup",extends:cc.Component,getPositionOffset:function(){return this._positionOffset},getProperties:function(){return this._properties},getGroupName:function(){return this._groupName},getProperty:function(t){return this._properties[t.toString()]},getObject:function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},getObjects:function(){return this._objects},_init:function(t,e,i){var r=cc.TiledMap,n=r.TMXObjectType,s=r.Orientation,o=r.StaggerAxis,a=r.TileFlag,l=a.FLIPPED_MASK,c=a.HORIZONTAL,h=a.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=cc.v2(t.offset.x,-t.offset.y),this._opacity=t._opacity;var u=e._mapSize,d=e._tileSize,p=0,f=0;if(e.orientation===s.HEX)e.getStaggerAxis()===o.STAGGERAXIS_X?(f=d.height*(u.height+.5),p=(d.width+e.getHexSideLength())*Math.floor(u.width/2)+d.width*(u.width%2)):(p=d.width*(u.width+.5),f=(d.height+e.getHexSideLength())*Math.floor(u.height/2)+d.height*(u.height%2));else if(e.orientation===s.ISO){var _=u.width+u.height;p=.5*d.width*_,f=.5*d.height*_}else p=u.width*d.width,f=u.height*d.height;this.node.setContentSize(p,f);for(var m=p*this.node.anchorX,g=f*(1-this.node.anchorY),y=t._objects,v={},b=0,x=y.length;b<x;b++){var T=y[b],C=T.type;T.offset=cc.v2(T.x,T.y);var S=T.points||T.polylinePoints;if(S)for(var w=0;w<S.length;w++)S[w].y*=-1;if(s.ISO!==e.orientation)T.y=f-T.y;else{var A=T.x/d.height,E=T.y/d.height;T.x=.5*d.width*(u.height+A-E),T.y=.5*d.height*(u.width+u.height-A-E)}if(C===n.TEXT){var D="text"+T.id;v[D]=!0;var L=this.node.getChildByName(D);L||(L=new cc.Node),L.active=T.visible,L.anchorX=0,L.anchorY=1,L.angle=-T.rotation,L.x=T.x-m,L.y=T.y-g,L.name=D,L.parent=this.node,L.color=T.color,L.opacity=this._opacity,L.setSiblingIndex(b);var I=L.getComponent(cc.Label);I||(I=L.addComponent(cc.Label)),I.overflow=cc.Label.Overflow.SHRINK,I.lineHeight=T.height,I.string=T.text,I.horizontalAlign=T.halign,I.verticalAlign=T.valign,I.fontSize=T.pixelsize,L.width=T.width,L.height=T.height}if(C===n.IMAGE){var P=T.gid,M=i[(P&l)>>>0];if(!M)continue;var R=M.tileset,O="img"+T.id;v[O]=!0;var B=this.node.getChildByName(O),N=T.width||M.width,k=T.height||M.height,F=R.tileOffset.x,V=R.tileOffset.y;B instanceof cc.PrivateNode&&(B.removeFromParent(),B.destroy(),B=null),B||(B=new cc.Node),s.ISO==e.orientation?(B.anchorX=.5+F/N,B.anchorY=V/k):(B.anchorX=F/N,B.anchorY=V/k),B.active=T.visible,B.angle=-T.rotation,B.x=T.x-m,B.y=T.y-g,B.name=O,B.parent=this.node,B.opacity=this._opacity,B.setSiblingIndex(b);var j=B.getComponent(cc.Sprite);j||(j=B.addComponent(cc.Sprite));var G=j.spriteFrame;G||(G=new cc.SpriteFrame),(P&c)>>>0?G.setFlipX(!0):G.setFlipX(!1),(P&h)>>>0?G.setFlipY(!0):G.setFlipY(!1),G.setTexture(M.tileset.sourceImage,cc.rect(M)),j.spriteFrame=G,j.setVertsDirty(),B.width=N,B.height=k}}this._objects=y;for(var U=this.node.children,Y=/^(?:img|text)\d+$/,H=0,X=U.length;H<X;H++){var z=U[H],W=z._name;Y.test(W)&&!v[W]&&z.destroy()}}});cc.TiledObjectGroup=e.exports=i},{}],349:[function(t,e){var i=cc.Class({name:"cc.TiledTile",extends:cc.Component,editor:!1,ctor:function(){this._layer=null},properties:{_x:0,_y:0,x:{get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer._isInvalidPosition(t,this._y)?cc.warn("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.width):(this._resetTile(),this._x=t,this._updateInfo()))},type:cc.Integer},y:{get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer._isInvalidPosition(this._x,t)?cc.warn("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.height):(this._resetTile(),this._y=t,this._updateInfo()))},type:cc.Integer},gid:{get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)},type:cc.Integer}},onEnable:function(){var t=this.node.parent;this._layer=t.getComponent(cc.TiledLayer),this._resetTile(),this._updateInfo()},onDisable:function(){this._resetTile()},_resetTile:function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},_updateInfo:function(){if(this._layer){var t=this._x,e=this._y;this._layer.getTiledTileAt(t,e)?cc.warn("There is already a TiledTile at [%s, %s]",t,e):(this.node.setPosition(this._layer.getPositionAt(t,e)),this._layer.setTiledTileAt(t,e,this))}}});cc.TiledTile=e.exports=i},{}],350:[function(t){t("./CCTiledMap"),t("./CCTiledMapRenderDataList"),t("./tiledmap-buffer"),t("./tmx-layer-assembler")},{"./CCTiledMap":345,"./CCTiledMapRenderDataList":347,"./tiledmap-buffer":351,"./tmx-layer-assembler":352}],351:[function(t,e){var i=cc.Class({name:"cc.TiledMapBuffer",extends:t("../core/renderer/webgl/quad-buffer"),_updateOffset:function(){var t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.indiceStart=this.indiceOffset,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0}});cc.TiledMapBuffer=e.exports=i},{"../core/renderer/webgl/quad-buffer":257}],352:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../core/renderer/assembler"))&&r.__esModule?r:{default:r},s=t("../core/value-types");function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a=t("./CCTiledLayer"),l=t("./CCTiledMap"),c=l.TileFlag,h=c.FLIPPED_MASK,u=t("../core/renderer/"),d=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor,p=parseInt(10922.5),f=l.RenderOrder,_=t("../core/renderer/render-flow"),m=cc.mat4(),g=cc.v3(),y={row:0,col:0},v={x:0,y:0},b={x:0,y:0},x={x:0,y:0},T={x:0,y:0},C=null,S=null,w=0,A=0,E=0,D=0,L=null,I=null,P=null,M=null,R=null,O=null,B=null,N=null;function k(t){t._updateLocalMatrix(),s.Mat4.mul(t._worldMatrix,L,t._matrix),t._renderFlag&=~(_.FLAG_TRANSFORM|_.FLAG_BREAK_FLOW),_.visitRootNode(t),t._renderFlag|=_.FLAG_BREAK_FLOW}function F(){0!==S._count&&(I.material=C.material,I.node=O.node,I._flushIA(C.ia),w>=p?(M.uploadData(),M.switchBuffer(),B=M._vData,N=M._uintVData,C=P.popRenderData(M),S=C.ia,A=0,w=0):(C=P.popRenderData(M),S=C.ia),C.material=R)}function V(t,e){var i=O._getNodesByRowCol(t,e);if(i&&0!=i.count){var r=i.list,n=0,s=0;for(F(),I.worldMatDirty++;n<i.count;){var o=r[s];s++,o&&(k(o.node),n!==s&&(r[n]=o,o._index=n),n++)}r.length=n,I.worldMatDirty--,P.pushNodesList(C,r),I._flush(),I.node=O.node}}function j(t,e){v.x=t.l,v.y=t.t,b.x=t.r,b.y=t.t,x.x=t.l,x.y=t.b,T.x=t.r,T.y=t.b;var i=null;(e&c.DIAGONAL)>>>0&&(i=b,b=x,x=i),(e&c.HORIZONTAL)>>>0&&(i=v,v=b,b=i,i=x,x=T,T=i),(e&c.VERTICAL)>>>0&&(i=v,v=x,x=i,i=b,b=T,T=i)}var G=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var n=r.prototype;return n.updateRenderData=function(t){t._renderDataList||(t._buffer=new cc.TiledMapBuffer(u._handle,d),t._renderDataList=new cc.TiledMapRenderDataList)},n.fillBuffers=function(t,e){if(0!==t._vertices.length){t._updateCulling();var i=t.node;if(E=t._leftDownToCenterX,D=t._leftDownToCenterY,L=i._worldMatrix,I=e,O=t,P=t._renderDataList,M=t._buffer,t._isCullingDirty()||t._isUserNodeDirty()||t._hasAnimation()||t._hasTiledNode()){var r,n;if(M.reset(),t._enableCulling){var s=t._cullingRect;r=s.leftDown,n=s.rightTop}else r=y,n=t._rightTop;var o=(n.row-r.row+1)*(n.col-r.col+1);switch(o>p&&(o=p),M.request(4*o,6*o),t._renderOrder){case f.RightDown:this.traverseGrids(r,n,-1,1);break;case f.LeftDown:this.traverseGrids(r,n,-1,-1);break;case f.RightUp:this.traverseGrids(r,n,1,1);break;case f.LeftUp:this.traverseGrids(r,n,1,-1)}t._setCullingDirty(!1),t._setUserNodeDirty(!1)}else for(var a=null,l=null,c=null,h=0;h<P._offset;h++){if((l=(a=P._dataList[h]).nodesRenderList).length>0){e.worldMatDirty++;for(var u=0;u<l.length;u++)if(c=l[u])for(var d=0;d<c.length;d++){var _=c[d];_&&k(_.node)}e.worldMatDirty--,e._flush()}a.ia._count>0&&(e.material=a.material,e.node=i,e._flushIA(a.ia))}C=null,S=null,L=null,I=null,P=null,M=null,R=null,O=null,B=null,N=null}},n.traverseGrids=function(t,e,i,r){if(P.reset(),!(e.row<0||e.col<0)){C=P.popRenderData(M),S=C.ia,B=M._vData,N=M._uintVData,w=0,A=0,R=null;var n=O.node,s=(n.parent?n.parent._opacity/255:1)*n._opacity;n._color._fastSetA(s);var o,a,l,c,u,d,f,_,m=n._color._val,g=O._tiledTiles,y=O._texGrids,L=O._tiles,k=O._texIdToMatIndex,G=O._materials,U=O._vertices,Y=null,H=0,X=0,z=0,W=0,Z=0,J=null,q=-1,K=0,Q=!0;for(-1==i?(c=e.row,u=t.row):(c=t.row,u=e.row);(u-c)*i>=0;c+=i)for(o=U[c],Q=0==(K=O._getNodesCountByRow(c))&&null!=o,1==r?(a=Q&&t.col<o.minCol?o.minCol:t.col,l=Q&&e.col>o.maxCol?o.maxCol:e.col):(a=Q&&e.col>o.maxCol?o.maxCol:e.col,l=Q&&t.col<o.minCol?o.minCol:t.col);(l-a)*r>=0;a+=r)(d=o&&o[a])?(Y=y[((H=L[d.index])&h)>>>0])&&(q!==Y.texId&&(-1!==q&&F(),_=k[q=Y.texId],R=G[_],C.material=R),R&&(X=d.left-E,z=d.bottom-D,W=X+(f=Y.tileset._tileSize).width,Z=z+f.height,(J=g[d.index])?J.node.active&&(J.node._color._fastSetA(J.node._opacity*s/255),this.fillByTiledNode(J.node,B,N,X,W,Z,z)):(B[A]=X,B[A+1]=Z,N[A+4]=m,B[A+5]=X,B[A+6]=z,N[A+9]=m,B[A+10]=W,B[A+11]=Z,N[A+14]=m,B[A+15]=W,B[A+16]=z,N[A+19]=m),j(Y,H),B[A+2]=v.x,B[A+3]=v.y,B[A+7]=x.x,B[A+8]=x.y,B[A+12]=b.x,B[A+13]=b.y,B[A+17]=T.x,B[A+18]=T.y,A+=20,M.adjust(4,6),S._count+=6,w++,K>0&&V(c,a),w>=p&&F())):K>0&&V(c,a);M.uploadData(),S._count>0&&(I.material=C.material,I.node=O.node,I._flushIA(C.ia))}},n.fillByTiledNode=function(t,e,i,r,n,o,a){t._updateLocalMatrix(),s.Mat4.copy(m,t._matrix),s.Vec3.set(g,-(r+E),-(a+D),0),s.Mat4.transform(m,m,g);var l=m.m,c=l[0],h=l[1],u=l[4],d=l[5],p=l[12],f=l[13],_=t._color._val;e[A]=r*c+o*u+p,e[A+1]=r*h+o*d+f,i[A+4]=_,e[A+5]=r*c+a*u+p,e[A+6]=r*h+a*d+f,i[A+9]=_,e[A+10]=n*c+o*u+p,e[A+11]=n*h+o*d+f,i[A+14]=_,e[A+15]=n*c+a*u+p,e[A+16]=n*h+a*d+f,i[A+19]=_},r}(n.default);i.default=G,n.default.register(a,G),e.exports=i.default},{"../core/renderer/":227,"../core/renderer/assembler":224,"../core/renderer/render-flow":228,"../core/renderer/webgl/vertex-format":260,"../core/value-types":286,"./CCTiledLayer":344,"./CCTiledMap":345}],353:[function(t,e){var i=t("./video-player-impl"),r=i.EventType,n=cc.Enum({REMOTE:0,LOCAL:1}),s=cc.Class({name:"cc.VideoPlayer",extends:cc.Component,editor:!1,properties:{_resourceType:n.REMOTE,resourceType:{tooltip:!1,type:n,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{default:null,type:cc.VideoClip},clip:{tooltip:!1,get:function(){return this._clip},set:function(t){this._clip=t,this._updateVideoSource()},type:cc.VideoClip},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._impl&&this._impl.seekTo(t)},get:function(){return this._impl?this._currentStatus===r.NONE||this._currentStatus===r.STOPPED||this._currentStatus===r.META_LOADED||this._currentStatus===r.READY_TO_PLAY?0:this._currentStatus===r.COMPLETED?this._impl.duration():this._impl.currentTime():-1}},_volume:1,volume:{get:function(){return this._volume},set:function(t){this._volume=t,this.isPlaying()&&!this._mute&&this._syncVolume()},range:[0,1],type:cc.Float,tooltip:!1},_mute:!1,mute:{get:function(){return this._mute},set:function(t){this._mute=t,this._syncVolume()},tooltip:!1},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._impl&&this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)}},_isFullscreen:{default:!1,formerlySerializedAs:"_N$isFullscreen"},isFullscreen:{get:function(){return this._isFullscreen=this._impl&&this._impl.isFullScreenEnabled(),this._isFullscreen},set:function(t){this._isFullscreen=t,this._impl&&this._impl.setFullScreenEnabled(t)},animatable:!1,tooltip:!1},_stayOnBottom:!1,stayOnBottom:{get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom=t,this._impl&&this._impl.setStayOnBottom(t)},animatable:!1,tooltip:!1},videoPlayerEvent:{default:[],type:cc.Component.EventHandler}},statics:{EventType:r,ResourceType:n,Impl:i},ctor:function(){this._impl=new i,this._currentStatus=r.NONE},_syncVolume:function(){var t=this._impl;if(t){var e=this._mute?0:this._volume;t.setVolume(e)}},_updateVideoSource:function(){var t="";this.resourceType===n.REMOTE?t=this.remoteURL:this._clip&&(t=this._clip.nativeUrl),this._impl.setURL(t,this._mute||0===this._volume),this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio)},onLoad:function(){var t=this._impl;t&&(t.createDomElementIfNeeded(this._mute||0===this._volume),t.setStayOnBottom(this._stayOnBottom),this._updateVideoSource(),t.seekTo(this.currentTime),t.setFullScreenEnabled(this._isFullscreen),this.pause(),t.setEventListener(r.PLAYING,this.onPlaying.bind(this)),t.setEventListener(r.PAUSED,this.onPasued.bind(this)),t.setEventListener(r.STOPPED,this.onStopped.bind(this)),t.setEventListener(r.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(r.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(r.CLICKED,this.onClicked.bind(this)),t.setEventListener(r.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onRestore:function(){this._impl||(this._impl=new i)},onEnable:function(){this._impl&&this._impl.enable()},onDisable:function(){this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(){this._impl&&this._impl.updateMatrix(this.node)},onReadyToPlay:function(){this._currentStatus=r.READY_TO_PLAY,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){this._currentStatus=r.META_LOADED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){this._currentStatus=r.CLICKED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){this._currentStatus=r.PLAYING,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PLAYING),this.node.emit("playing",this)},onPasued:function(){this._currentStatus=r.PAUSED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.PAUSED),this.node.emit("paused",this)},onStopped:function(){this._currentStatus=r.STOPPED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){this._currentStatus=r.COMPLETED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,r.COMPLETED),this.node.emit("completed",this)},play:function(){this._impl&&(this._syncVolume(),this._impl.play())},resume:function(){this._impl&&(this._syncVolume(),this._impl.resume())},pause:function(){this._impl&&this._impl.pause()},stop:function(){this._impl&&this._impl.stop()},getDuration:function(){return this._impl?this._impl.duration():-1},isPlaying:function(){return!!this._impl&&this._impl.isPlaying()}});cc.VideoPlayer=e.exports=s},{"./video-player-impl":354}],354:[function(t,e){var i=t("../core/platform/utils"),r=t("../core/platform/CCSys"),n=t("../core/platform/CCMacro"),s=cc.mat4(),o=cc.Class({name:"VideoPlayerImpl",ctor:function(){this._EventList={},this._video=null,this._url="",this._waitingFullscreen=!1,this._fullScreenEnabled=!1,this._stayOnBottom=!1,this._loadedmeta=!1,this._loaded=!1,this._visible=!1,this._playing=!1,this._ignorePause=!1,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_bindEvent:function(){var t=this._video,e=this,i=this.__eventListeners;i.loadedmetadata=function(){e._loadedmeta=!0,e._forceUpdate=!0,e._waitingFullscreen&&(e._waitingFullscreen=!1,e._toggleFullscreen(!0)),e._dispatchEvent(o.EventType.META_LOADED)},i.ended=function(){e._video===t&&(e._playing=!1,e._dispatchEvent(o.EventType.COMPLETED))},i.play=function(){e._video===t&&(e._playing=!0,e._updateVisibility(),e._dispatchEvent(o.EventType.PLAYING))},i.pause=function(){e._video===t&&(e._playing=!1,e._ignorePause||e._dispatchEvent(o.EventType.PAUSED))},i.click=function(){e._dispatchEvent(o.EventType.CLICKED)},t.addEventListener("loadedmetadata",i.loadedmetadata),t.addEventListener("ended",i.ended),t.addEventListener("play",i.play),t.addEventListener("pause",i.pause),t.addEventListener("click",i.click),i.onCanPlay=function(){var t=e._video;!e._loaded&&t&&(4!==t.readyState&&1!==t.readyState||(t.currentTime=0,e._loaded=!0,e._forceUpdate=!0,e._dispatchEvent(o.EventType.READY_TO_PLAY),e._updateVisibility()))},t.addEventListener("canplay",i.onCanPlay),t.addEventListener("canplaythrough",i.onCanPlay),t.addEventListener("suspend",i.onCanPlay)},_updateVisibility:function(){var t=this._video;t&&(this._visible?t.style.visibility="visible":(t.style.visibility="hidden",t.pause(),this._playing=!1))},_updateSize:function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px")},_createDom:function(t){var e=document.createElement("video");e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["z-index"]=this._stayOnBottom?n.MIN_ZINDEX:0,e.className="cocosVideo",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),t&&e.setAttribute("muted",""),this._video=e,cc.game.container.appendChild(e)},createDomElementIfNeeded:function(t){this._video||this._createDom(t)},removeDom:function(){var t=this._video;if(t){i.contains(cc.game.container,t)&&cc.game.container.removeChild(t);var e=this.__eventListeners;t.removeEventListener("loadedmetadata",e.loadedmetadata),t.removeEventListener("ended",e.ended),t.removeEventListener("play",e.play),t.removeEventListener("pause",e.pause),t.removeEventListener("click",e.click),t.removeEventListener("canplay",e.onCanPlay),t.removeEventListener("canplaythrough",e.onCanPlay),t.removeEventListener("suspend",e.onCanPlay),e.loadedmetadata=null,e.ended=null,e.play=null,e.pause=null,e.click=null,e.onCanPlay=null}this._video=null,this._url=""},setURL:function(t,e){var i,r;if(this._url!==t){this.removeDom(),this._url=t,this.createDomElementIfNeeded(e),this._bindEvent();var n=this._video;n.style.visibility="hidden",this._loaded=!1,this._playing=!1,this._loadedmeta=!1,(i=document.createElement("source")).src=t,n.appendChild(i),r=cc.path.extname(t);for(var s=o._polyfill,a=0;a<s.canPlayType.length;a++)r!==s.canPlayType[a]&&((i=document.createElement("source")).src=t.replace(r,s.canPlayType[a]),n.appendChild(i))}},getURL:function(){return this._url},play:function(){var t=this._video;t&&this._visible&&!this._playing&&t.play()},pause:function(){var t=this._video;this._playing&&t&&t.pause()},resume:function(){this.play()},stop:function(){var t=this._video;t&&this._visible&&(this._ignorePause=!0,t.currentTime=0,t.pause(),setTimeout(function(){this._dispatchEvent(o.EventType.STOPPED),this._ignorePause=!1}.bind(this),0))},setVolume:function(t){var e=this._video;e&&(e.volume=t)},seekTo:function(t){var e=this._video;e&&(this._loaded?e.currentTime=t:e.addEventListener(o._polyfill.event,(function i(){e.currentTime=t,e.removeEventListener(o._polyfill.event,i)})))},isPlaying:function(){return this._playing},duration:function(){var t=this._video,e=-1;return t?((e=t.duration)<=0&&cc.logID(7702),e):e},currentTime:function(){var t=this._video;return t?t.currentTime:-1},setKeepAspectRatioEnabled:function(){cc.logID(7700)},isKeepAspectRatioEnabled:function(){return!0},_toggleFullscreen:function(t){var e=this,i=this._video;i&&(t?(r.browserType===r.BROWSER_TYPE_IE&&(i.style.transform=""),cc.screen.requestFullScreen(i,(function(){var t=r.browserType===r.BROWSER_TYPE_IE?document.msFullscreenElement:document.fullscreenElement;e._fullScreenEnabled=t===i}),(function(){e._fullScreenEnabled=!1}))):cc.screen.fullScreen()&&cc.screen.exitFullScreen(i))},setStayOnBottom:function(t){this._stayOnBottom=t,this._video&&(this._video.style["z-index"]=t?n.MIN_ZINDEX:0)},setFullScreenEnabled:function(t){!this._loadedmeta&&t?this._waitingFullscreen=!0:this._toggleFullscreen(t)},isFullScreenEnabled:function(){return this._fullScreenEnabled},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._video.src)},onPlayEvent:function(){this._EventList[o.EventType.PLAYING].call(this,this,this._video.src)},enable:function(){var t=o.elements;-1===t.indexOf(this)&&t.push(this),this.setVisible(!0)},disable:function(){var t=o.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1),this.setVisible(!1)},destroy:function(){this.disable(),this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){if(this._video&&this._visible&&!this._fullScreenEnabled){t.getWorldMatrix(s);var e=cc.Camera._findRendererCamera(t);e&&e.worldMatrixToScreen(s,s,cc.game.canvas.width,cc.game.canvas.height);var i=s.m;if(this._forceUpdate||this._m00!==i[0]||this._m01!==i[1]||this._m04!==i[4]||this._m05!==i[5]||this._m12!==i[12]||this._m13!==i[13]||this._w!==t._contentSize.width||this._h!==t._contentSize.height){this._m00=i[0],this._m01=i[1],this._m04=i[4],this._m05=i[5],this._m12=i[12],this._m13=i[13],this._w=t._contentSize.width,this._h=t._contentSize.height;var n,a,l=cc.view._devicePixelRatio,c=1/l,h=1/l,u=cc.game.container,d=i[0]*c,p=i[1],f=i[4],_=i[5]*h,m=u&&u.style.paddingLeft?parseInt(u.style.paddingLeft):0,g=u&&u.style.paddingBottom?parseInt(u.style.paddingBottom):0;o._polyfill.zoomInvalid?(this._updateSize(this._w*d,this._h*_),d=1,_=1,n=this._w*c,a=this._h*h):(n=this._w*c,a=this._h*h,this._updateSize(this._w,this._h));var y=n*i[0]*t._anchorPoint.x,v=a*i[5]*t._anchorPoint.y,b="matrix("+d+","+-p+","+-f+","+_+","+(i[12]*c-y+m)+","+-(i[13]*h-v+g)+")";this._video.style.transform=b,this._video.style["-webkit-transform"]=b,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px",r.browserType!==r.BROWSER_TYPE_IE&&(this._forceUpdate=!1)}}}});o.EventType={NONE:-1,PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},o.elements=[],o.pauseElements=[],cc.game.on(cc.game.EVENT_HIDE,(function(){for(var t,e=o.elements,i=0;i<e.length;i++)(t=e[i]).isPlaying()&&(t.pause(),o.pauseElements.push(t))})),cc.game.on(cc.game.EVENT_SHOW,(function(){for(var t=o.pauseElements,e=t.pop();e;)e.play(),e=t.pop()})),o._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]};var a=document.createElement("video");a.canPlayType&&(a.canPlayType("video/ogg")&&(o._polyfill.canPlayType.push(".ogg"),o._polyfill.canPlayType.push(".ogv")),a.canPlayType("video/mp4")&&o._polyfill.canPlayType.push(".mp4"),a.canPlayType("video/webm")&&o._polyfill.canPlayType.push(".webm")),r.OS_ANDROID!==r.os||r.browserType!==r.BROWSER_TYPE_SOUGOU&&r.browserType!==r.BROWSER_TYPE_360||(o._polyfill.zoomInvalid=!0);var l=document.createElement("style");l.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(l),e.exports=o},{"../core/platform/CCMacro":201,"../core/platform/CCSys":205,"../core/platform/utils":220}],355:[function(t,e){var i=t("./webview-impl"),r=i.EventType;function n(){}var s=cc.Class({name:"cc.WebView",extends:cc.Component,editor:!1,properties:{_url:"",url:{type:cc.String,tooltip:!1,get:function(){return this._url},set:function(t){this._url=t;var e=this._impl;e&&e.loadURL(t)}},webviewEvents:{default:[],type:cc.Component.EventHandler}},statics:{EventType:r,Impl:i},ctor:function(){this._impl=new s.Impl},onRestore:function(){this._impl||(this._impl=new s.Impl)},onEnable:function(){var t=this._impl;t.createDomElementIfNeeded(this.node.width,this.node.height),t.setEventListener(r.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(r.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(r.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setVisible(!0)},onDisable:function(){var t=this._impl;t.setVisible(!1),t.setEventListener(r.LOADED,n),t.setEventListener(r.LOADING,n),t.setEventListener(r.ERROR,n)},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null)},update:function(){this._impl&&this._impl.updateMatrix(this.node)},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADED),this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.ERROR),this.node.emit("error",this)},setJavascriptInterfaceScheme:function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},setOnJSCallback:function(t){this._impl&&this._impl.setOnJSCallback(t)},evaluateJS:function(t){this._impl&&this._impl.evaluateJS(t)}});cc.WebView=e.exports=s},{"./webview-impl":356}],356:[function(t,e){var i=t("../core/platform/utils"),r=t("../core/platform/CCSys"),n=cc.mat4(),s=cc.Class({name:"WebViewImpl",ctor:function(){this._EventList={},this._visible=!1,this._parent=null,this._div=null,this._iframe=null,this._listener=null,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={}},_updateVisibility:function(){if(this._div){var t=this._div;this._visible?t.style.visibility="visible":t.style.visibility="hidden"}},_updateSize:function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},_initEvent:function(){var t=this._iframe;if(t){var e=this.__eventListeners,i=this;e.load=function(){i._forceUpdate=!0,i._dispatchEvent(s.EventType.LOADED)},e.error=function(){i._dispatchEvent(s.EventType.ERROR)},t.addEventListener("load",e.load),t.addEventListener("error",e.error)}},_initStyle:function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},_setOpacity:function(t){var e=this._iframe;e&&e.style&&(e.style.opacity=t/255)},_createDom:function(t,e){s._polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe"),s._polyfill.enableBG&&(this._div.style.background="#FFF"),this._div.style.height=e+"px",this._div.style.width=t+"px",this._div.style.overflow="scroll",this._iframe.style.border="none",cc.game.container.appendChild(this._div),this._updateVisibility()},_createNativeControl:function(t,e){this._createDom(t,e),this._initStyle(),this._initEvent()},createDomElementIfNeeded:function(t,e){this._div?this._updateSize(t,e):this._createNativeControl(t,e)},removeDom:function(){var t=this._div;t&&(i.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._div=null);var e=this._iframe;if(e){var r=this.__eventListeners;e.removeEventListener("load",r.load),e.removeEventListener("error",r.error),r.load=null,r.error=null,this._iframe=null}},setOnJSCallback:function(){},setJavascriptInterfaceScheme:function(){},loadData:function(){},loadHTMLString:function(){},loadURL:function(t){var e=this._iframe;if(e){e.src=t;var i=this;e.addEventListener("load",(function t(){i._loaded=!0,i._updateVisibility(),e.removeEventListener("load",t)})),this._dispatchEvent(s.EventType.LOADING)}},stopLoading:function(){cc.logID(7800)},reload:function(){var t=this._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.location.reload()}},canGoBack:function(){return cc.logID(7801),!0},canGoForward:function(){return cc.logID(7802),!0},goBack:function(){try{if(s._polyfill.closeHistory)return cc.logID(7803);var t=this._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.back.call(e)}}catch(i){cc.log(i)}},goForward:function(){try{if(s._polyfill.closeHistory)return cc.logID(7804);var t=this._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.forward.call(e)}}catch(i){cc.log(i)}},evaluateJS:function(t){var e=this._iframe;if(e){var i=e.contentWindow;try{i.eval(t),this._dispatchEvent(s.EventType.JS_EVALUATED)}catch(r){console.error(r)}}},setScalesPageToFit:function(){cc.logID(7805)},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._iframe.src)},_createRenderCmd:function(){return new s.RenderCmd(this)},destroy:function(){this.removeDom()},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility())},updateMatrix:function(t){if(this._div&&this._visible){t.getWorldMatrix(n);var e=cc.Camera._findRendererCamera(t);e&&e.worldMatrixToScreen(n,n,cc.game.canvas.width,cc.game.canvas.height);var i=n.m;if(this._forceUpdate||this._m00!==i[0]||this._m01!==i[1]||this._m04!==i[4]||this._m05!==i[5]||this._m12!==i[12]||this._m13!==i[13]||this._w!==t._contentSize.width||this._h!==t._contentSize.height){this._m00=i[0],this._m01=i[1],this._m04=i[4],this._m05=i[5],this._m12=i[12],this._m13=i[13],this._w=t._contentSize.width,this._h=t._contentSize.height;var r=cc.view._devicePixelRatio,s=1/r,o=1/r,a=cc.game.container,l=i[0]*s,c=i[1],h=i[4],u=i[5]*o,d=a&&a.style.paddingLeft?parseInt(a.style.paddingLeft):0,p=a&&a.style.paddingBottom?parseInt(a.style.paddingBottom):0;this._updateSize(this._w,this._h);var f=this._w*s,_=this._h*o,m=f*i[0]*t._anchorPoint.x,g=_*i[5]*t._anchorPoint.y,y="matrix("+l+","+-c+","+-h+","+u+","+(i[12]*s-m+d)+","+-(i[13]*o-g+p)+")";this._div.style.transform=y,this._div.style["-webkit-transform"]=y,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px",this._setOpacity(t.opacity),this._forceUpdate=!1}}}});s.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3};var o=s._polyfill={devicePixelRatio:!1,enableDiv:!1};r.os===r.OS_IOS&&(o.enableDiv=!0),r.isMobile?r.browserType===r.BROWSER_TYPE_FIREFOX&&(o.enableBG=!0):r.browserType===r.BROWSER_TYPE_IE&&(o.closeHistory=!0),e.exports=s},{"../core/platform/CCSys":205,"../core/platform/utils":220}],357:[function(t){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle"),t("./cocos2d/tilemap"),t("./cocos2d/videoplayer/CCVideoPlayer"),t("./cocos2d/webview/CCWebView"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./cocos2d/actions"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")},{"./cocos2d/actions":7,"./cocos2d/animation":16,"./cocos2d/core":163,"./cocos2d/core/components/CCStudioComponent":124,"./cocos2d/deprecated":298,"./cocos2d/particle":304,"./cocos2d/particle/CCParticleAsset":301,"./cocos2d/tilemap":350,"./cocos2d/tilemap/CCTiledMapAsset":346,"./cocos2d/videoplayer/CCVideoPlayer":353,"./cocos2d/webview/CCWebView":355,"./extensions/ccpool/CCNodePool":358,"./extensions/dragonbones":368,"./extensions/spine":373}],358:[function(t,e){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var i=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse.apply(i,arguments),e}},e.exports=cc.NodePool},{}],359:[function(t,e){var i,r,n=[],s=[],o=0,a=0,l=0,c=null,h=null,u=0,d=0,p=0,f=0,_=null,m=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},begin:function(){if(this._invalid){var t=this._armatureInfo,e=t.curAnimationCache;e&&e!=this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),t.curAnimationCache=this,this._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1}},end:function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},_needToUpdate:function(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t)},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._armatureInfo.armature;do{e.advanceTime(1/60),this._frameIdx++,this._updateFrame(e,this._frameIdx),this.totalTime+=1/60}while(this._needToUpdate(t));this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(t,e){l=0,o=0,a=0,c=null,h=null,u=0,d=0,p=0,f=0,_=null,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[e],r=this._tempSegments=i.segments,m=this._tempColors=i.colors,g=this._tempBoneInfos=i.boneInfos;this._traverseArmature(t,1),f>0&&(m[f-1].vfOffset=l),m.length=f,g.length=o;var y=p-1;if(y>=0)if(d>0){var v=r[y];v.indexCount=d,v.vfCount=5*u,v.vertexCount=u,r.length=p}else r.length=p-1;if(0!==r.length){var b=i.vertices,x=i.uintVert;(!b||b.length<l)&&(b=i.vertices=new Float32Array(l),x=i.uintVert=new Uint32Array(b.buffer));for(var T=0,C=0;T<l;)b[T++]=n[C++],b[T++]=n[C++],b[T++]=n[C++],b[T++]=n[C++],x[T++]=n[C++];var S=i.indices;(!S||S.length<a)&&(S=i.indices=new Uint16Array(a));for(var w=0;w<a;w++)S[w]=s[w];i.vertices=b,i.uintVert=x,i.indices=S}},_traverseArmature:function(t,e){var m,g,y,v,b,x,T,C,S,w=this._tempColors,A=this._tempSegments,E=this._tempBoneInfos,D=n,L=s,I=t._slots,P=t._bones;if(this._enableCacheAttachedInfo)for(var M=0,R=P.length;M<R;M++,o++){var O=P[M],B=E[o];B||(B=E[o]={globalTransformMatrix:new dragonBones.Matrix});var N=O.globalTransformMatrix;B.globalTransformMatrix.copyFrom(N)}for(var k=0,F=I.length;k<F;k++)if((y=I[k])._visible&&y._displayData)if(y.updateWorldMatrix(),b=y._color,y.childArmature)this._traverseArmature(y.childArmature,e*b.a/255);else if(T=y.getTexture()){c===T.nativeUrl&&h===y._blendMode||(c=T.nativeUrl,h=y._blendMode,(C=p-1)>=0&&(d>0?((S=A[C]).indexCount=d,S.vertexCount=u,S.vfCount=5*u):p--),A[p]={tex:T,blendMode:y._blendMode,indexCount:0,vertexCount:0,vfCount:0},p++,d=0,u=0),x=(b.a*e<<24>>>0)+(b.b<<16)+(b.g<<8)+b.r,_!==x&&(_=x,f>0&&(w[f-1].vfOffset=l),w[f++]={r:b.r,g:b.g,b:b.b,a:b.a*e,vfOffset:0}),m=y._localVertices,g=y._indices,v=y._worldMatrix.m;for(var V=0,j=m.length;V<j;)i=m[V++],r=m[V++],D[l++]=i*v[0]+r*v[4]+v[12],D[l++]=i*v[1]+r*v[5]+v[13],D[l++]=m[V++],D[l++]=m[V++],D[l++]=x;for(var G=0,U=g.length;G<U;G++)L[a++]=u+g[G];d+=g.length,u+=m.length/4}}}),g=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._armatureCache={}},enablePrivateMode:function(){this._privateMode=!0},dispose:function(){for(var t in this._armatureCache){var e=this._armatureCache[t];if(e){var i=e.armature;i&&i.dispose()}}this._armatureCache=null,this._animationPool=null},_removeArmature:function(t){var e=this._armatureCache[t],i=e.animationsCache;for(var r in i){var n=i[r];n&&(this._animationPool[t+"#"+r]=n,n.clear())}var s=e.armature;s&&s.dispose(),delete this._armatureCache[t]},resetArmature:function(t){for(var e in this._armatureCache)-1!=e.indexOf(t)&&this._removeArmature(e)},getArmatureCache:function(t,e,i){var r,n=this._armatureCache[e];if(n)r=n.armature;else{var s=dragonBones.CCFactory.getInstance().buildArmatureDisplay(t,e,"",i);if(!s||!s._armature)return;if(r=s._armature,!g.canCache(r))return void r.dispose();this._armatureCache[e]={armature:r,animationsCache:{},curAnimationCache:null}}return r},getAnimationCache:function(t,e){var i=this._armatureCache[t];return i?i.animationsCache[e]:null},initAnimationCache:function(t,e){if(!e)return null;var i=this._armatureCache[t],r=i&&i.armature;if(!r)return null;if(!r.animation.hasAnimation(e))return null;var n=i.animationsCache,s=n[e];if(!s){var o=t+"#"+e;(s=this._animationPool[o])?delete this._animationPool[o]:(s=new m)._privateMode=this._privateMode,s.init(i,e),n[e]=s}return s},invalidAnimationCache:function(t){var e=this._armatureCache[t];if(!e||!e.armature)return null;var i=e.animationsCache;for(var r in i)i[r].invalidAllFrame()},updateAnimationCache:function(t,e){if(e){var i=this.initAnimationCache(t,e);if(!i)return;i.updateAllFrame()}else{var r=this._armatureCache[t];if(!r||!r.armature)return null;var n=r.animationsCache;for(var s in n)n[s].updateAllFrame()}}});g.FrameTime=1/60,g.sharedCache=new g,g.canCache=function(t){for(var e=t._slots,i=0,r=e.length;i<r;i++)if(e[i].childArmature)return!1;return!0},e.exports=g},{}],360:[function(t,e){var i=t("../../cocos2d/core/components/CCRenderComponent"),r=t("../../cocos2d/core/event/event-target"),n=t("../../cocos2d/core/graphics/graphics"),s=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,o=t("./ArmatureCache"),a=t("./AttachUtil"),l=cc.Enum({default:-1}),c=cc.Enum({"<None>":0}),h=(cc.Enum({REALTIME:0}),cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2})),u=cc.Class({name:"dragonBones.ArmatureDisplay",extends:i,editor:!1,statics:{AnimationCacheMode:h},properties:{_factory:{default:null,type:dragonBones.CCFactory,serializable:!1},dragonAsset:{default:null,type:dragonBones.DragonBonesAsset,notify:function(){this._refresh()},tooltip:!1},dragonAtlasAsset:{default:null,type:dragonBones.DragonBonesAtlasAsset,notify:function(){this._parseDragonAtlasAsset(),this._refresh()},tooltip:!1},_armatureName:"",armatureName:{get:function(){return this._armatureName},set:function(t){this._armatureName=t;var e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},visible:!1},_animationName:"",animationName:{get:function(){return this._animationName},set:function(t){this._animationName=t},visible:!1},_defaultArmatureIndex:{default:0,notify:function(){var t="";if(this.dragonAsset){var e;if(this.dragonAsset&&(e=this.dragonAsset.getArmatureEnum()),!e)return cc.errorID(7400,this.name);t=e[this._defaultArmatureIndex]}void 0!==t?this.armatureName=t:cc.errorID(7401,this.name)},type:l,visible:!0,editorOnly:!0,animatable:!1,displayName:"Armature",tooltip:!1},_animationIndex:{default:0,notify:function(){var t;if(0!==this._animationIndex){if(this.dragonAsset&&(t=this.dragonAsset.getAnimsEnum(this.armatureName)),t){var e=t[this._animationIndex];void 0!==e?this.playAnimation(e,this.playTimes):cc.errorID(7402,this.name)}}else this.animationName=""},type:c,visible:!0,editorOnly:!0,animatable:!1,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:h.REALTIME,_defaultCacheMode:{default:0,type:h,notify:function(){if(this._defaultCacheMode!==h.REALTIME&&this._armature&&!o.canCache(this._armature))return this._defaultCacheMode=h.REALTIME,void cc.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},timeScale:{default:1,notify:function(){this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)},tooltip:!1},playTimes:{default:-1,tooltip:!1},premultipliedAlpha:{default:!1,tooltip:!1},debugBones:{default:!1,notify:function(){this._updateDebugDraw()},tooltip:!1},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_armatureKey:"",_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_playing:!1,_armatureCache:null},ctor:function(){this._eventTarget=new r,this._materialCache={},this._inited=!1,this.attachUtil=new a,this._factory=dragonBones.CCFactory.getInstance()},onLoad:function(){for(var t=this.node.children,e=0,i=t.length;e<i;e++){var r=t[e];0===(r._name&&r._name.search("CHILD_ARMATURE-"))&&r.destroy()}},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_updateMaterial:function(){var t=this.getMaterial(0);if(t){t.define("CC_USE_MODEL",!this.enableBatch),t.define("USE_TEXTURE",!0);var e=this.premultipliedAlpha?cc.gfx.BLEND_ONE:cc.gfx.BLEND_SRC_ALPHA,i=cc.gfx.BLEND_ONE_MINUS_SRC_ALPHA;t.setBlend(!0,cc.gfx.BLEND_FUNC_ADD,e,e,cc.gfx.BLEND_FUNC_ADD,i,i)}this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~s},markForRender:function(t){this._super(t),t?this.node._renderFlag|=s:this.node._renderFlag&=~s},_validateRender:function(){var t=this.dragonAtlasAsset&&this.dragonAtlasAsset.texture;t&&t.loaded?this._super():this.disableRender()},__preload:function(){this._init()},_init:function(){if(!this._inited){this._inited=!0,this._resetAssembler(),this._activateMaterial(),this._parseDragonAtlasAsset(),this._refresh();for(var t=this.node.children,e=0,i=t.length;e<i;e++){var r=t[e];r&&"DEBUG_DRAW_NODE"===r._name&&r.destroy()}this._updateDebugDraw()}},getArmatureKey:function(){return this._armatureKey},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature))},isAnimationCached:function(){return this._cacheMode!==h.REALTIME},onEnable:function(){this._super(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)},onDisable:function(){this._super(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature)},_emitCacheCompleteEvent:function(){this._eventTarget.emit(dragonBones.EventObject.LOOP_COMPLETE),this._eventTarget.emit(dragonBones.EventObject.COMPLETE)},update:function(t){if(this.isAnimationCached()&&this._frameCache){var e=this._frameCache;if(e.isInited()){var i=e.frames;if(this._playing){var r=o.FrameTime;0==this._accTime&&0==this._playCount&&this._eventTarget.emit(dragonBones.EventObject.START);var n=dragonBones.timeScale;this._accTime+=t*this.timeScale*n;var s=Math.floor(this._accTime/r);if(e.isCompleted||e.updateToFrame(s),e.isCompleted&&s>=i.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playing=!1,this._playCount=0,void this._emitCacheCompleteEvent();this._accTime=0,s=0,this._emitCacheCompleteEvent()}this._curFrame=i[s]}else e.isInvalid()&&(e.updateToFrame(),this._curFrame=i[i.length-1])}}},onDestroy:function(){this._super(),this._inited=!1,this._cacheMode===h.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===h.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null)},_updateDebugDraw:function(){if(this.debugBones){if(!this._debugDraw){var t=new cc.PrivateNode;t.name="DEBUG_DRAW_NODE";var e=t.addComponent(n);e.lineWidth=1,e.strokeColor=cc.color(255,0,0,255),this._debugDraw=e}this._debugDraw.node.parent=this.node}else this._debugDraw&&(this._debugDraw.node.parent=null)},_buildArmature:function(){if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){this._armature&&(this._preCacheMode===h.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===h.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=null),this._cacheMode===h.SHARED_CACHE?this._armatureCache=o.sharedCache:this._cacheMode===h.PRIVATE_CACHE&&(this._armatureCache=new o,this._armatureCache.enablePrivateMode());var t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=h.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===h.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale}if(this._cacheMode!==h.REALTIME&&this.debugBones&&cc.warn("Debug bones is invalid in cached mode"),this._armature){var e=this._armature.armatureData.aabb;this.node.setContentSize(e.width,e.height)}this._updateBatch(),this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this.markForRender(!0)}},_parseDragonAtlasAsset:function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},_refresh:function(){this._buildArmature()},_updateCacheModeEnum:!1,_updateAnimEnum:!1,_updateArmatureEnum:!1,playAnimation:function(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){var i=this._armatureCache.getAnimationCache(this._armatureKey,t);i||(i=this._armatureCache.initAnimationCache(this._armatureKey,t)),i&&(this._accTime=0,this._playCount=0,this._frameCache=i,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes)},updateAnimationCache:function(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)},invalidAnimationCache:function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},getArmatureNames:function(){var t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]},getAnimationNames:function(t){var e=[],i=this._factory.getDragonBonesData(this._armatureKey);if(i){var r=i.getArmature(t);if(r)for(var n in r.animations)r.animations.hasOwnProperty(n)&&e.push(n)}return e},on:function(t,e,i){this.addEventListener(t,e,i)},off:function(t,e,i){this.removeEventListener(t,e,i)},once:function(t,e,i){this._eventTarget.once(t,e,i)},addEventListener:function(t,e,i){this._eventTarget.on(t,e,i)},removeEventListener:function(t,e,i){this._eventTarget.off(t,e,i)},buildArmature:function(t,e){return this._factory.createArmatureNode(this,t,e)},armature:function(){return this._armature}});e.exports=dragonBones.ArmatureDisplay=u},{"../../cocos2d/core/components/CCRenderComponent":117,"../../cocos2d/core/event/event-target":143,"../../cocos2d/core/graphics/graphics":159,"../../cocos2d/core/renderer/render-flow":228,"./ArmatureCache":359,"./AttachUtil":361}],361:[function(t,e){var i,r=(i=t("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{default:i},n=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,s=function(){},o=function(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0},set:function(){}}),t._calculWorldMatrix=s,t._mulMat=s},a=new r.default,l=cc.Class({name:"dragonBones.AttachUtil",ctor:function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t},reset:function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null},_prepareAttachNode:function(){if(this._armature){var t=this._armatureNode.getChildByName("ATTACHED_NODE_TREE");return t&&t.isValid||(t=new cc.Node("ATTACHED_NODE_TREE"),o(t),this._armatureNode.addChild(t)),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t,t}},_buildBoneAttachedNode:function(t,e){var i="ATTACHED_NODE:"+t.name,r=new cc.Node(i);return this._buildBoneRelation(r,t,e),r},_buildBoneRelation:function(t,e,i){o(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(t){var e=this._attachedNodeArray,i=[];if(!this._inited)return i;for(var r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&s.name==="ATTACHED_NODE:"+t&&i.push(s)}return i},_rebuildNodeArray:function(){for(var t=this._boneIndexToNode={},e=this._attachedNodeArray,i=this._attachedNodeArray=[],r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&!s._toRemove&&(i.push(s),t[s._boneIndex]=s)}},_sortNodeArray:function(){this._attachedNodeArray.sort((function(t,e){return t._boneIndex<e._boneIndex?-1:1}))},_getNodeByBoneIndex:function(t){var e=this._boneIndexToNode[t];return e&&e.isValid?e:null},destroyAttachedNodes:function(t){if(this._inited){for(var e=this._attachedNodeArray,i=function t(e){for(var i=e.children,r=0,n=i.length;r<n;r++){var s=i[r];s&&t(s)}e._toRemove=!0},r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&s.name.split("ATTACHED_NODE:")[1]===t&&(i(s),s.removeFromParent(!0),s.destroy(),e[r]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(t){var e=[];if(!this._inited)return e;var i=this._prepareAttachNode();if(!i)return e;var r=0,n=[],s=function(e){if(e){for(var i,o=e.getBones(),a=0,l=o.length;a<l;a++)(i=o[a])._boneIndex=r++,t===i.name&&n.push(i);for(var c,h=e.getSlots(),u=0,d=h.length;u<d;u++)(c=h[u]).childArmature&&s(c.childArmature)}}.bind(this);s(this._armature);for(var o=function(t){if(t){var e=this._getNodeByBoneIndex(t._boneIndex);if(e)return e;e=this._buildBoneAttachedNode(t,t._boneIndex);var r=null;t.armature.parent&&(r=t.armature.parent.parent);var n=o(t.parent||r)||i;return e.parent=n,t.parent?e._rootNode=n._rootNode:e._rootNode=n,e}}.bind(this),a=0,l=n.length;a<l;a++){var c=o(n[a]);c&&e.push(c)}return this._sortNodeArray(),e},destroyAllAttachedNodes:function(){if(this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited){var t=this._armatureNode.getChildByName("ATTACHED_NODE_TREE");t&&(t.removeFromParent(!0),t.destroy(),t=null)}},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var t=this._prepareAttachNode();if(t){var e=0,i=function(r){if(r){var n=t;r.parent&&(n=r.parent.parent._attachedNode);for(var s,o=r.getBones(),a=0,l=o.length;a<l;a++){var c=e++;(s=o[a])._attachedNode=null;var h=null;if(h=s.parent?s.parent._attachedNode:n){var u=h.getChildByName("ATTACHED_NODE:"+s.name);u&&u.isValid?this._buildBoneRelation(u,s,c):(u=this._buildBoneAttachedNode(s,c),h.addChild(u)),u._rootNode=n,s._attachedNode=u}}for(var d,p=r.getSlots(),f=0,_=p.length;f<_;f++)(d=p[f]).childArmature&&i(d.childArmature)}}.bind(this);return i(this._armature),t}}},_hasAttachedNode:function(){return!!this._inited&&!!this._armatureNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){if(this._inited){var t=this._armatureNode.getChildByName("ATTACHED_NODE_TREE");if(t&&t.isValid){this._attachedRootNode=t,this._boneIndexToNode={},this._attachedNodeArray.length=0;var e=this._armature;if(e){o(t),this._armatureDisplay.isAnimationCached()&&this._armatureDisplay._frameCache&&this._armatureDisplay._frameCache.enableCacheAttachedInfo();var i=0,r=function(e){if(e){var n=t;e.parent&&(n=e.parent.parent._attachedNode);for(var s,o=e.getBones(),a=0,l=o.length;a<l;a++){var c=i++;(s=o[a])._attachedNode=null;var h=null;if(h=s.parent?s.parent._attachedNode:n){var u=h.getChildByName("ATTACHED_NODE:"+s.name);u&&u.isValid&&(this._buildBoneRelation(u,s,c),u._rootNode=n,s._attachedNode=u)}}for(var d,p=e.getSlots(),f=0,_=p.length;f<_;f++)(d=p[f]).childArmature&&r(d.childArmature)}}.bind(this);r(e)}}}},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode,e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var i=this._armatureNode._worldMatrix;r.default.copy(t._worldMatrix,i),t._renderFlag&=~n;var s=null,o=this._armatureDisplay.isAnimationCached();if(!o||(s=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos)){for(var l,c,h,u,d=this._armatureNode._mulMat,p=!1,f=0,_=e.length;f<_;f++){var m=e[f];if(m&&m.isValid){var g=o?s[m._boneIndex]:m._bone;g&&!g._isInPool?(l=m._worldMatrix,c=m._rootNode._worldMatrix,h=g.globalTransformMatrix,u=void 0,(u=a.m)[0]=h.a,u[1]=h.b,u[4]=-h.c,u[5]=-h.d,u[12]=h.tx,u[13]=h.ty,d(l,c,a),m._renderFlag&=~n):(m.removeFromParent(!0),m.destroy(),e[f]=null,p=!0)}else e[f]=null,p=!0}p&&this._rebuildNodeArray()}}}});e.exports=dragonBones.AttachUtil=l},{"../../cocos2d/core/renderer/render-flow":228,"../../cocos2d/core/value-types/mat4":288}],362:[function(t){var e=t("../../cocos2d/core/event/event-target");dragonBones.CCArmatureDisplay=cc.Class({name:"dragonBones.CCArmatureDisplay",properties:{node:{get:function(){return this}}},ctor:function(){this._eventTarget=new e},setEventTarget:function(t){this._eventTarget=t},getRootDisplay:function(){var t,e=this._armature._parent;if(!e)return this;for(;e;)t=e,e=e._armature._parent;return t._armature.getDisplay()},convertToRootSpace:function(t){var e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();var i=e._worldMatrix.m,r=cc.v2(0,0);return r.x=t.x*i[0]+t.y*i[4]+i[12],r.y=t.x*i[1]+t.y*i[5]+i[13],r},convertToWorldSpace:function(t){var e=this.convertToRootSpace(t);return this.getRootNode().convertToWorldSpaceAR(e)},getRootNode:function(){var t=this.getRootDisplay();return t&&t._ccNode},dbInit:function(t){this._armature=t},dbClear:function(){this._armature=null},dbUpdate:function(){},advanceTimeBySelf:function(t){this.shouldAdvanced=!!t},hasDBEventListener:function(t){return this._eventTarget.hasEventListener(t)},addDBEventListener:function(t,e,i){this._eventTarget.on(t,e,i)},removeDBEventListener:function(t,e,i){this._eventTarget.off(t,e,i)},dispatchDBEvent:function(t,e){this._eventTarget.emit(t,e)}})},{"../../cocos2d/core/event/event-target":143}],363:[function(){var t=dragonBones.BaseObject,e=dragonBones.BaseFactory,i=dragonBones.CCFactory=cc.Class({name:"dragonBones.CCFactory",extends:e,statics:{_factory:null,getInstance:function(){return i._factory||(i._factory=new i),i._factory}},ctor:function(){var t=new dragonBones.CCArmatureDisplay;this._dragonBones=new dragonBones.DragonBones(t),cc.director._scheduler&&(cc.game.on(cc.game.EVENT_RESTART,this.initUpdate,this),this.initUpdate())},initUpdate:function(){cc.director._scheduler.enableForTarget(this),cc.director._scheduler.scheduleUpdate(this,cc.Scheduler.PRIORITY_SYSTEM,!1)},update:function(t){this._dragonBones.advanceTime(t)},getDragonBonesDataByRawData:function(t){return(t instanceof ArrayBuffer?e._binaryParser:this._dataParser).parseDragonBonesData(t,1)},buildArmatureDisplay:function(t,e,i,r){var n=this.buildArmature(t,e,i,r);return n&&n._display},createArmatureNode:function(t,e,i){var r=(i=i||new cc.Node).getComponent(dragonBones.ArmatureDisplay);return r||(r=i.addComponent(dragonBones.ArmatureDisplay)),i.name=e,r._armatureName=e,r._N$dragonAsset=t.dragonAsset,r._N$dragonAtlasAsset=t.dragonAtlasAsset,r._init(),r},_buildTextureAtlasData:function(e,i){return e?e.renderTexture=i:e=t.borrowObject(dragonBones.CCTextureAtlasData),e},_sortSlots:function(){for(var t=this._slots,e=[],i=0,r=t.length;i<r;i++){for(var n=t[i],s=n._zOrder,o=!1,a=e.length-1;a>=0;a--)if(s>=e[a]._zOrder){e.splice(a+1,0,n),o=!0;break}o||e.unshift(n)}this._slots=e},_buildArmature:function(e){var i=t.borrowObject(dragonBones.Armature);i._skinData=e.skin,i._animation=t.borrowObject(dragonBones.Animation),i._animation._armature=i,i._animation.animations=e.armature.animations,i._isChildArmature=!1;var r=new dragonBones.CCArmatureDisplay;return i.init(e.armature,r,r,this._dragonBones),i},_buildSlot:function(e,i,r){var n=t.borrowObject(dragonBones.CCSlot),s=n;return n.init(i,r,s,s),n},getDragonBonesDataByUUID:function(t){for(var e in this._dragonBonesDataMap)if(-1!=e.indexOf(t))return this._dragonBonesDataMap[e];return null},removeDragonBonesDataByUUID:function(t,e){for(var i in void 0===e&&(e=!0),this._dragonBonesDataMap)-1!==i.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[i]),delete this._dragonBonesDataMap[i])}})},{}],364:[function(t){var e,i=(e=t("../../cocos2d/core/value-types/mat4"))&&e.__esModule?e:{default:e},r=dragonBones.BinaryOffset,n=dragonBones.BoneType;dragonBones.CCSlot=cc.Class({name:"dragonBones.CCSlot",extends:dragonBones.Slot,ctor:function(){this._localVertices=[],this._indices=[],this._matrix=cc.mat4(),this._worldMatrix=cc.mat4(),this._worldMatrixDirty=!0,this._visible=!1,this._color=cc.color()},_onClear:function(){this._super(),this._localVertices.length=0,this._indices.length=0,i.default.identity(this._matrix),i.default.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=cc.color(),this._visible=!1},statics:{toString:function(){return"[class dragonBones.CCSlot]"}},_onUpdateDisplay:function(){},_initDisplay:function(){},_addDisplay:function(){this._visible=!0},_replaceDisplay:function(){},_removeDisplay:function(){this._visible=!1},_disposeDisplay:function(){},_updateVisible:function(){this._visible=this.parent._visible},_updateZOrder:function(){},_updateBlendMode:function(){if(this._childArmature)for(var t=this._childArmature.getSlots(),e=0,i=t.length;e<i;e++){var r=t[e];r._blendMode=this._blendMode,r._updateBlendMode()}},_updateColor:function(){var t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier},getTexture:function(){return this._textureData&&this._textureData.spriteFrame&&this._textureData.spriteFrame.getTexture()},_updateFrame:function(){this._indices.length=0;var t=this._indices,e=this._localVertices,i=0,n=0,s=this._textureData;if(this._display&&!(this._displayIndex<0)&&s&&s.spriteFrame){var o=s.spriteFrame.getTexture(),a=o.width,l=o.height,c=s.region,h=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(h){var u=h.data,d=u.intArray,p=u.floatArray,f=d[h.offset+r.MeshVertexCount],_=d[h.offset+r.MeshTriangleCount],m=d[h.offset+r.MeshFloatOffset];m<0&&(m+=65536);for(var g=m+2*f,y=this._armature._armatureData.scale,v=0,b=2*f;v<b;v+=2)e[n++]=p[m+v]*y,e[n++]=-p[m+v+1]*y,h.rotated?(e[n++]=(c.x+(1-p[g+v])*c.width)/a,e[n++]=(c.y+p[g+v+1]*c.height)/l):(e[n++]=(c.x+p[g+v]*c.width)/a,e[n++]=(c.y+p[g+v+1]*c.height)/l);for(var x=0;x<3*_;++x)t[i++]=d[h.offset+r.MeshVertexIndices+x];e.length=n,t.length=i,h.weight&&this._identityTransform()}else{var T=c.x/a,C=(c.y+c.height)/l,S=(c.x+c.width)/a,w=c.y/l;e[n++]=0,e[n++]=0,e[n++]=T,e[n++]=C,e[n++]=c.width,e[n++]=0,e[n++]=S,e[n++]=C,e[n++]=0,e[n++]=c.height,e[n++]=T,e[n++]=w,e[n++]=c.width,e[n++]=c.height,e[n++]=S,e[n++]=w,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=n,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}},_updateMesh:function(){var t=this._armature._armatureData.scale,e=this._deformVertices.vertices,i=this._deformVertices.bones,s=this._deformVertices.verticesData,o=s.weight,a=e.length>0&&s.inheritDeform,l=this._localVertices;if(o){var c=s.data,h=c.intArray,u=c.floatArray,d=h[s.offset+r.MeshVertexCount],p=h[o.offset+r.WeigthFloatOffset];p<0&&(p+=65536);for(var f=0,_=o.offset+r.WeigthBoneIndices+i.length,m=p,g=0,y=0;f<d;f++,y+=4){for(var v=h[_++],b=0,x=0,T=0;T<v;++T){var C=i[h[_++]];if(null!==C){var S=C.globalTransformMatrix,w=u[m++],A=u[m++]*t,E=u[m++]*t;a&&(A+=e[g++],E+=e[g++]),b+=(S.a*A+S.c*E+S.tx)*w,x+=(S.b*A+S.d*E+S.ty)*w}}l[y]=b,l[y+1]=-x}}else if(a){var D=this._parent._boneData.type!==n.Bone,L=s.data,I=L.intArray,P=L.floatArray,M=I[s.offset+r.MeshVertexCount],R=I[s.offset+r.MeshFloatOffset];R<0&&(R+=65536);for(var O=0,B=M,N=0;O<B;O++,N+=4){var k=P[R+2*O]*t+e[2*O],F=P[R+2*O+1]*t+e[2*O+1];if(D){var V=this._parent._getGlobalTransformMatrix(k,F);l[N]=V.a*k+V.c*F+V.tx,l[N+1]=-V.b*k+V.d*F+V.ty}else l[N]=k,l[N+1]=-F}}o&&this._identityTransform()},_identityTransform:function(){var t=this._matrix.m;t[0]=1,t[1]=0,t[4]=-0,t[5]=-1,t[12]=0,t[13]=0,this._worldMatrixDirty=!0},_updateTransform:function(){var t=this._matrix.m;t[0]=this.globalTransformMatrix.a,t[1]=this.globalTransformMatrix.b,t[4]=-this.globalTransformMatrix.c,t[5]=-this.globalTransformMatrix.d,this._childArmature?(t[12]=this.globalTransformMatrix.tx,t[13]=this.globalTransformMatrix.ty):(t[12]=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t[13]=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0},updateWorldMatrix:function(){if(this._armature){var t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();var e=this.childArmature;if(!e)return;for(var i=e.getSlots(),r=0,n=i.length;r<n;r++){var s=i[r];s&&(s._worldMatrixDirty=!0)}}}},_mulMat:function(t,e,i){var r=e.m,n=i.m,s=t.m,o=r[0],a=r[1],l=r[4],c=r[5],h=r[12],u=r[13],d=n[0],p=n[1],f=n[4],_=n[5],m=n[12],g=n[13];0!==a||0!==l?(s[0]=d*o+p*l,s[1]=d*a+p*c,s[4]=f*o+_*l,s[5]=f*a+_*c,s[12]=o*m+l*g+h,s[13]=a*m+c*g+u):(s[0]=d*o,s[1]=p*c,s[4]=f*o,s[5]=_*c,s[12]=o*m+h,s[13]=c*g+u)},calculWorldMatrix:function(){var t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):i.default.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1}})},{"../../cocos2d/core/value-types/mat4":288}],365:[function(){dragonBones.CCTextureAtlasData=cc.Class({extends:dragonBones.TextureAtlasData,name:"dragonBones.CCTextureAtlasData",properties:{_renderTexture:{default:null,serializable:!1},renderTexture:{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture=t,t)for(var e in this.textures){var i=this.textures[e];if(!i.spriteFrame){var r;r=i.rotated?cc.rect(i.region.x,i.region.y,i.region.height,i.region.width):cc.rect(i.region.x,i.region.y,i.region.width,i.region.height);var n=cc.v2(0,0),s=cc.size(r.width,r.height);i.spriteFrame=new cc.SpriteFrame,i.spriteFrame.setTexture(t,r,!1,n,s)}}else for(var o in this.textures)this.textures[o].spriteFrame=null}}},statics:{toString:function(){return"[class dragonBones.CCTextureAtlasData]"}},_onClear:function(){dragonBones.TextureAtlasData.prototype._onClear.call(this),this.renderTexture=null},createTexture:function(){return dragonBones.BaseObject.borrowObject(dragonBones.CCTextureData)}}),dragonBones.CCTextureData=cc.Class({extends:dragonBones.TextureData,name:"dragonBones.CCTextureData",properties:{spriteFrame:{default:null,serializable:!1}},statics:{toString:function(){return"[class dragonBones.CCTextureData]"}},_onClear:function(){dragonBones.TextureData.prototype._onClear.call(this),this.spriteFrame=null}})},{}],366:[function(t,e){var i=t("./ArmatureCache").sharedCache,r=cc.Class({name:"dragonBones.DragonBonesAsset",extends:cc.Asset,ctor:function(){this.reset()},properties:{_dragonBonesJson:"",dragonBonesJson:{get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}},_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._clear()},init:function(t,e){var i;if(this._factory=t,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson)),i=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,!this._uuid){var r=this._factory.getDragonBonesDataByRawData(i);r?this._uuid=r.name:cc.warn("dragonbones name is empty")}var n=this._uuid+"#"+e;return this._factory.getDragonBonesData(n)||this._factory.parseDragonBonesData(i,n),n},getArmatureEnum:!1,getAnimsEnum:!1,_clear:function(){this._factory&&(i.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},destroy:function(){this._clear(),this._super()}});dragonBones.DragonBonesAsset=e.exports=r},{"./ArmatureCache":359}],367:[function(t,e){var i=t("./ArmatureCache").sharedCache,r=cc.Class({name:"dragonBones.DragonBonesAtlasAsset",extends:cc.Asset,ctor:function(){this._clear()},properties:{_atlasJson:"",atlasJson:{get:function(){return this._atlasJson},set:function(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}},_texture:{default:null,type:cc.Texture2D,formerlySerializedAs:"texture"},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._clear()}},_textureAtlasData:null},statics:{preventDeferredLoadDependents:!0},createNode:!1,init:function(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)},_clear:function(){this._factory&&(i.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0)),this._textureAtlasData=null},destroy:function(){this._clear(),this._super()}});dragonBones.DragonBonesAtlasAsset=e.exports=r},{"./ArmatureCache":359}],368:[function(t){var e="undefined"==typeof window?global:window;e.dragonBones=t("./lib/dragonBones"),cc.sys.platform!==cc.sys.TAOBAO&&cc.sys.platform!==cc.sys.TAOBAO_MINIGAME||(dragonBones=e.dragonBones),void 0!==e.dragonBones&&(dragonBones._timeScale=1,Object.defineProperty(dragonBones,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t,this.CCFactory.getInstance()._dragonBones.clock.timeScale=t},configurable:!0}),dragonBones.DisplayType={Image:0,Armature:1,Mesh:2},dragonBones.ArmatureType={Armature:0,MovieClip:1,Stage:2},dragonBones.ExtensionType={FFD:0,AdjustColor:10,BevelFilter:11,BlurFilter:12,DropShadowFilter:13,GlowFilter:14,GradientBevelFilter:15,GradientGlowFilter:16},dragonBones.EventType={Frame:0,Sound:1},dragonBones.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5},dragonBones.AnimationFadeOutMode={None:0,SameLayer:1,SameGroup:2,SameLayerAndGroup:3,All:4},dragonBones.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},dragonBones.BoneType={Bone:0,Surface:1},t("./CCFactory"),t("./CCSlot"),t("./CCTextureData"),t("./CCArmatureDisplay"),t("./ArmatureCache"),t("./DragonBonesAsset"),t("./DragonBonesAtlasAsset"),t("./ArmatureDisplay"),t("./webgl-assembler"))},{"./ArmatureCache":359,"./ArmatureDisplay":360,"./CCArmatureDisplay":362,"./CCFactory":363,"./CCSlot":364,"./CCTextureData":365,"./DragonBonesAsset":366,"./DragonBonesAtlasAsset":367,"./lib/dragonBones":369,"./webgl-assembler":370}],369:[function(t,e){var i,r,n,s=Object.setPrototypeOf;n||(n={}),function(t){var e=function(){function e(i){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=i,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,r=this._objects;i<r.length;i++)r[i].returnToPool();this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var n=0;n<this._events.length;++n){var s=this._events[n],o=s.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(s.type,s),s.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(s.type,s)),this.bufferObject(s)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}();t.DragonBones=e}(n||(n={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),s=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var i=String(e.constructor),r=i in t._maxCountMap?t._maxCountMap[i]:t._defaultMaxCount,n=t._poolsMap[i]=t._poolsMap[i]||[];n.length<r&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,n.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,i){if((i<0||i!=i)&&(i=0),null!==e)null!==(n=(r=String(e))in t._poolsMap?t._poolsMap[r]:null)&&n.length>i&&(n.length=i),t._maxCountMap[r]=i;else for(var r in t._defaultMaxCount=i,t._poolsMap){var n;(n=t._poolsMap[r]).length>i&&(n.length=i),r in t._maxCountMap&&(t._maxCountMap[r]=i)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var i=String(e);null!==(n=i in t._poolsMap?t._poolsMap[i]:null)&&n.length>0&&(n.length=0)}else for(var r in t._poolsMap){var n;(n=t._poolsMap[r]).length=0}},t.borrowObject=function(e){var i=String(e),r=i in t._poolsMap?t._poolsMap[i]:null;if(null!==r&&r.length>0){var n=r.pop();return n._isInPool=!1,n}var s=new e;return s._onClear(),s},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(n||(n={})),function(t){var e=function(){function t(t,e,i,r,n,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,r=0,n=this.d*t.d,s=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,r+=this.c*t.a,n+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,r+=this.d*t.c,s+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=i,this.c=r,this.d=n,this.tx=s,this.ty=o,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,s=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===r?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,r=this.d=1/r,this.tx=-t*n,this.ty=-r*s),this;var o=t*r-e*i;if(0===o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var a=this.a=r*o;return e=this.b=-e*o,i=this.c=-i*o,r=this.d=t*o,this.tx=-(a*n+i*s),this.ty=-(e*n+r*s),this},t.prototype.transformPoint=function(t,e,i,r){void 0===r&&(r=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,r||(i.x+=this.tx,i.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,r=this.b,n=this.c,s=this.d,o=e?0:this.tx,a=e?0:this.ty,l=t.x,c=t.y,h=l+t.width,u=c+t.height,d=i*l+n*c+o,p=r*l+s*c+a,f=i*h+n*c+o,_=r*h+s*c+a,m=i*h+n*u+o,g=r*h+s*u+a,y=i*l+n*u+o,v=r*l+s*u+a,b=0;d>f&&(b=d,d=f,f=b),m>y&&(b=m,m=y,y=b),t.x=Math.floor(d<m?d:m),t.width=Math.ceil((f>y?f:y)-t.x),p>_&&(b=p,p=_,_=b),g>v&&(b=g,g=v,v=b),t.y=Math.floor(p<g?p:g),t.height=Math.ceil((_>v?_:v)-t.y)},t}();t.Matrix=e}(n||(n={})),function(t){var e=function(){function t(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===s&&(s=1),this.x=t,this.y=e,this.skew=i,this.rotation=r,this.scaleX=n,this.scaleY=s}return t.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(t>0?-Math.PI:Math.PI)},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var i=this.scaleX,r=this.scaleY,n=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var s=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-n&&this.rotation<n?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=s>-n&&s<n?e.d/Math.cos(s):-e.c/Math.sin(s),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),r>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,s-=Math.PI),this.skew=s-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(n||(n={})),function(t){var e=function(){function t(t,e,i,r,n,s,o,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=r,this.alphaOffset=n,this.redOffset=s,this.greenOffset=o,this.blueOffset=a}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(n||(n={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(n||(n={})),function(t){var e=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return s(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=i}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return s(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e.prototype.dispose=function(){console.warn("已废弃"),this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(n||(n={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return s(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var i=0,r=this.actions;i<r.length;i++)r[i].returnToPool();for(var n in this.bones)this.bones[n].returnToPool(),delete this.bones[n];for(var n in this.slots)this.slots[n].returnToPool(),delete this.slots[n];for(var n in this.constraints)this.constraints[n].returnToPool(),delete this.constraints[n];for(var n in this.skins)this.skins[n].returnToPool(),delete this.skins[n];for(var n in this.animations)this.animations[n].returnToPool(),delete this.animations[n];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},i.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,r=0;for(this.sortedBones.length=0;r<t;){var n=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(n)>=0)){var s=!1;for(var o in this.constraints){var a=this.constraints[o];if(a.root===n&&this.sortedBones.indexOf(a.target)<0){s=!0;break}}s||null!==n.parent&&this.sortedBones.indexOf(n.parent)<0||(this.sortedBones.push(n),r++)}}}},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},i.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,r=i.length;return i.length+=10,i[r]=t.a,i[r+1]=t.b,i[r+2]=t.c,i[r+3]=t.d,i[r+4]=t.tx,i[r+5]=t.ty,i[r+6]=e.rotation,i[r+7]=e.skew,i[r+8]=e.scaleX,i[r+9]=e.scaleY,r},i.prototype.getCacheFrame=function(t,e,i){var r=this.parent.cachedFrames;t.a=r[i],t.b=r[i+1],t.c=r[i+2],t.d=r[i+3],t.tx=r[i+4],t.ty=r[i+5],e.rotation=r[i+6],e.skew=r[i+7],e.scaleX=r[i+8],e.scaleY=r[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},i.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},i.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},i.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},i.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},i.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},i.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},i.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},i.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},i.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},i.prototype.getMesh=function(t,e,i){var r=this.getSkin(t);return null===r?null:r.getDisplay(e,i)},i.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},i}(t.BaseObject);t.ArmatureData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return s(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},i}(t.BaseObject);t.BoneData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.SurfaceData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},e}(i);t.SurfaceData=r;var n=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return s(i,e),i.createColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},i.DEFAULT_COLOR=new t.ColorTransform,i}(t.BaseObject);t.SlotData=n}(n||(n={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=r}(n||(n={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return s(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var r=i[e];null!==r&&r.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var r=0,n=i;r<n.length;r++){var s=n[r];if(null!==s&&s.name===e)return s}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(n||(n={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},t}();t.VerticesData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return s(i,e),i.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},i}(t.BaseObject);t.DisplayData=i;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return s(i,e),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},i}(i);t.ImageDisplayData=r;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++)i[e].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(i);t.ArmatureDisplayData=n;var o=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.vertices=new e,i}return s(i,t),i.toString=function(){return"[class dragonBones.MeshDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null},i}(i);t.MeshDisplayData=o;var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return s(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(i);t.BoundingBoxDisplayData=a;var l=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.vertices=new e,i.curveLengths=[],i}return s(i,t),i.toString=function(){return"[class dragonBones.PathDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0},i}(i);t.PathDisplayData=l;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=c}(n||(n={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,i,r,n,s){var o=0;return t<i?o|=1:t>n&&(o|=2),e<r?o|=4:e>s&&(o|=8),o},e.rectangleIntersectsSegment=function(t,i,r,n,s,o,a,l,c,h,u){void 0===c&&(c=null),void 0===h&&(h=null),void 0===u&&(u=null);var d=t>s&&t<a&&i>o&&i<l,p=r>s&&r<a&&n>o&&n<l;if(d&&p)return-1;for(var f=0,_=e._computeOutCode(t,i,s,o,a,l),m=e._computeOutCode(r,n,s,o,a,l);;){if(!(_|m)){f=2;break}if(_&m)break;var g=0,y=0,v=0,b=0!==_?_:m;4&b?(g=t+(r-t)*(o-i)/(n-i),y=o,null!==u&&(v=.5*-Math.PI)):8&b?(g=t+(r-t)*(l-i)/(n-i),y=l,null!==u&&(v=.5*Math.PI)):2&b?(y=i+(n-i)*(a-t)/(r-t),g=a,null!==u&&(v=0)):!!(1&b)&&(y=i+(n-i)*(s-t)/(r-t),g=s,null!==u&&(v=Math.PI)),b===_?(t=g,i=y,_=e._computeOutCode(t,i,s,o,a,l),null!==u&&(u.x=v)):(r=g,n=y,m=e._computeOutCode(r,n,s,o,a,l),null!==u&&(u.y=v))}return f&&(d?(f=2,null!==c&&(c.x=r,c.y=n),null!==h&&(h.x=r,h.y=r),null!==u&&(u.x=u.y+Math.PI)):p?(f=1,null!==c&&(c.x=t,c.y=i),null!==h&&(h.x=t,h.y=i),null!==u&&(u.y=u.x+Math.PI)):(f=3,null!==c&&(c.x=t,c.y=i),null!==h&&(h.x=r,h.y=n))),f},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return!0}return!1},e.prototype.intersectsSegment=function(t,i,r,n,s,o,a){void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null);var l=.5*this.width,c=.5*this.height;return e.rectangleIntersectsSegment(t,i,r,n,-l,-c,l,c,s,o,a)},e}(e);t.RectangleBoundingBoxData=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,i,r,n,s,o,a,l,c,h){void 0===l&&(l=null),void 0===c&&(c=null),void 0===h&&(h=null);var u=o/a,d=u*u,p=i-t,f=(r*=u)-(e*=u),_=Math.sqrt(p*p+f*f),m=p/_,g=f/_,y=(n-t)*m+(s-e)*g,v=o*o,b=v-(t*t+e*e)+y*y,x=0;if(b>=0){var T=Math.sqrt(b),C=y-T,S=y+T,w=C<0?-1:C<=_?0:1,A=S<0?-1:S<=_?0:1,E=w*A;if(E<0)return-1;0===E&&(-1===w?(x=2,i=t+S*m,r=(e+S*g)/u,null!==l&&(l.x=i,l.y=r),null!==c&&(c.x=i,c.y=r),null!==h&&(h.x=Math.atan2(r/v*d,i/v),h.y=h.x+Math.PI)):1===A?(x=1,t+=C*m,e=(e+C*g)/u,null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=t,c.y=e),null!==h&&(h.x=Math.atan2(e/v*d,t/v),h.y=h.x+Math.PI)):(x=3,null!==l&&(l.x=t+C*m,l.y=(e+C*g)/u,null!==h&&(h.x=Math.atan2(l.y/v*d,l.x/v))),null!==c&&(c.x=t+S*m,c.y=(e+S*g)/u,null!==h&&(h.y=Math.atan2(c.y/v*d,c.x/v)))))}return x},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return e*=i/r,Math.sqrt(t*t+e*e)<=i}return!1},e.prototype.intersectsSegment=function(t,i,r,n,s,o,a){return void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),e.ellipseIntersectsSegment(t,i,r,n,0,0,.5*this.width,.5*this.height,s,o,a)},e}(e);t.EllipseBoundingBoxData=r;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,i,r,n,s,o,a){void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),t===i&&(t=i+1e-6),e===r&&(e=r+1e-6);for(var l=n.length,c=t-i,h=e-r,u=t*r-e*i,d=0,p=n[l-2],f=n[l-1],_=0,m=0,g=0,y=0,v=0,b=0,x=0;x<l;x+=2){var T=n[x],C=n[x+1];p===T&&(p=T+1e-4),f===C&&(f=C+1e-4);var S=p-T,w=f-C,A=p*C-f*T,E=c*w-h*S,D=(u*S-c*A)/E;if((D>=p&&D<=T||D>=T&&D<=p)&&(0===c||D>=t&&D<=i||D>=i&&D<=t)){var L=(u*w-h*A)/E;if((L>=f&&L<=C||L>=C&&L<=f)&&(0===h||L>=e&&L<=r||L>=r&&L<=e)){if(null===o){g=D,y=L,v=D,b=L,d++,null!==a&&(a.x=Math.atan2(C-f,T-p)-.5*Math.PI,a.y=a.x);break}var I=D-t;I<0&&(I=-I),0===d?(_=I,m=I,g=D,y=L,v=D,b=L,null!==a&&(a.x=Math.atan2(C-f,T-p)-.5*Math.PI,a.y=a.x)):(I<_&&(_=I,g=D,y=L,null!==a&&(a.x=Math.atan2(C-f,T-p)-.5*Math.PI)),I>m&&(m=I,v=D,b=L,null!==a&&(a.y=Math.atan2(C-f,T-p)-.5*Math.PI))),d++}}p=T,f=C}return 1===d?(null!==s&&(s.x=g,s.y=y),null!==o&&(o.x=g,o.y=y),null!==a&&(a.y=a.x+Math.PI)):d>1&&(d++,null!==s&&(s.x=g,s.y=y),null!==o&&(o.x=v,o.y=b)),d},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var r=0,n=this.vertices.length,s=n-2;r<n;r+=2){var o=this.vertices[s+1],a=this.vertices[r+1];if(a<e&&o>=e||o<e&&a>=e){var l=this.vertices[s],c=this.vertices[r];(e-a)*(l-c)/(o-a)+c<t&&(i=!i)}s=r}return i},e.prototype.intersectsSegment=function(t,r,n,s,o,a,l){void 0===o&&(o=null),void 0===a&&(a=null),void 0===l&&(l=null);var c=0;return 0!==i.rectangleIntersectsSegment(t,r,n,s,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(c=e.polygonIntersectsSegment(t,r,n,s,this.vertices,o,a,l)),c},e}(e);t.PolygonBoundingBoxData=n}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.surfaceTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return s(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++)i[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var r=0,n=this.surfaceTimelines[t];r<n.length;r++)n[r].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var s=0,o=this.slotTimelines[t];s<o.length;s++)o[s].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var a=0,l=this.constraintTimelines[t];a<l.length;a++)l[a].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var c=0,h=this.animationTimelines[t];c<h.length;c++)h[c].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,r=this.cacheFrames.length;i<r;++i)this.cachedFrames[i]=!1;for(var n=0,s=this.parent.sortedBones;n<s.length;n++){var o=s[n];for(i=0,r=(c=new Array(e)).length;i<r;++i)c[i]=-1;this.boneCachedFrameIndices[o.name]=c}for(var a=0,l=this.parent.sortedSlots;a<l.length;a++){var c,h=l[a];for(i=0,r=(c=new Array(e)).length;i<r;++i)c[i]=-1;this.slotCachedFrameIndices[h.name]=c}}},e.prototype.addBoneTimeline=function(t,e){var i=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSurfaceTimeline=function(t,e){var i=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSlotTimeline=function(t,e){var i=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addConstraintTimeline=function(t,e){var i=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=i}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var r=t.getBone(e);if(null!==r&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var n=0,s=t.getBones();n<s.length;n++){var o=s[n];this.boneMask.indexOf(o.name)<0&&r.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var r=this.boneMask.indexOf(e);if(r>=0&&this.boneMask.splice(r,1),i){var n=t.getBone(e);if(null!==n)if(this.boneMask.length>0)for(var s=0,o=t.getBones();s<o.length;s++){var a=o[s],l=this.boneMask.indexOf(a.name);l>=0&&n.contains(a)&&this.boneMask.splice(l,1)}else for(var c=0,h=t.getBones();c<h.length;c++)(a=h[c])!==n&&(n.contains(a)||this.boneMask.push(a.name))}},e}(t.BaseObject);t.AnimationConfig=e}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return s(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return s(i,e),i.createRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=i.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},i}(t.BaseObject);t.TextureData=i}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e.bones=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.DeformVertices]"},e.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){var i;i=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=i,this.bones.length=0;for(var r=0,n=this.vertices.length;r<n;++r)this.vertices[r]=0;if(null!==this.verticesData.weight)for(r=0,n=this.verticesData.weight.bones.length;r<n;++r){var s=e.getBone(this.verticesData.weight.bones[r].name);this.bones.push(s)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},e}(t.BaseObject);t.DeformVertices=e}(n||(n={})),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return s(e,t),e.toString=function(){return"[class dragonBones.Armature]"},e._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},e.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,r=this._slots;i<r.length;i++)r[i].returnToPool();for(var n=0,s=this._constraints;n<s.length;n++)s[n].returnToPool();for(var o=0,a=this._actions;o<a.length;o++)a[o].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},e.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,r=null===t;if(this._zOrderDirty||!r){for(var n=0,s=i.length;n<s;++n){var o=r?n:t[e+n];if(!(o<0||o>=s)){var a=i[o],l=this.getSlot(a.name);null!==l&&l._setZorder(n)}}this._slotsDirty=!0,this._zOrderDirty=!r}},e.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},e.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},e.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},e.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},e.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},e.prototype.init=function(t,e,r,n){null===this._armatureData&&(this._armatureData=t,this._animation=i.BaseObject.borrowObject(i.Animation),this._proxy=e,this._display=r,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},e.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var i=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(e._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==i){var r=0,n=0;for(r=0,n=this._bones.length;r<n;++r)this._bones[r].update(this._cacheFrameIndex);for(r=0,n=this._slots.length;r<n;++r)this._slots[r].update(this._cacheFrameIndex)}if(this._actions.length>0){this._lockUpdate=!0;for(var s=0,o=this._actions;s<o.length;s++){var a=o[s],l=a.actionData;if(null!==l&&0===l.type)if(null!==a.slot)null!==(u=a.slot.childArmature)&&u.animation.fadeIn(l.name);else if(null!==a.bone)for(var c=0,h=this.getSlots();c<h.length;c++){var u,d=h[c];d.parent===a.bone&&null!==(u=d.childArmature)&&u.animation.fadeIn(l.name)}else this._animation.fadeIn(l.name);a.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},e.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(o=this.getBone(t))&&(o.invalidUpdate(),e))for(var i=0,r=this._slots;i<r.length;i++)(c=r[i]).parent===o&&c.invalidUpdate()}else{for(var n=0,s=this._bones;n<s.length;n++){var o;(o=s[n]).invalidUpdate()}if(e)for(var a=0,l=this._slots;a<l.length;a++){var c;(c=l[a]).invalidUpdate()}}},e.prototype.containsPoint=function(t,e){for(var i=0,r=this._slots;i<r.length;i++){var n=r[i];if(n.containsPoint(t,e))return n}return null},e.prototype.intersectsSegment=function(t,e,i,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null);for(var a=t===i,l=0,c=0,h=0,u=0,d=0,p=0,f=0,_=0,m=null,g=null,y=0,v=this._slots;y<v.length;y++){var b=v[y];if(b.intersectsSegment(t,e,i,r,n,s,o)>0){if(null===n&&null===s){m=b;break}var x;null!==n&&((x=a?n.y-e:n.x-t)<0&&(x=-x),(null===m||x<l)&&(l=x,h=n.x,u=n.y,m=b,o&&(f=o.x))),null!==s&&((x=s.x-t)<0&&(x=-x),(null===g||x>c)&&(c=x,d=s.x,p=s.y,g=b,null!==o&&(_=o.y)))}}return null!==m&&null!==n&&(n.x=h,n.y=u,null!==o&&(o.x=f)),null!==g&&null!==s&&(s.x=d,s.y=p,null!==o&&(o.y=_)),m},e.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},e.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.display===t)return r}return null},e.prototype.getBones=function(){return this._bones},e.prototype.getSlots=function(){return this._slots},Object.defineProperty(e.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e].childArmature;null!==r&&(r.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];r.invalidUpdate(),r.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e].childArmature;null!==r&&(r.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.replaceTexture=function(t){this.replacedTexture=t},e.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},e.prototype.addEventListener=function(t,e,i){this._proxy.addDBEventListener(t,e,i)},e.prototype.removeEventListener=function(t,e,i){this._proxy.removeDBEventListener(t,e,i)},e.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},e.prototype.getDisplay=function(){return this._display},e}((i=n||(n={})).BaseObject),i.Armature=r,function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return s(i,e),i.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.TransformObject=e}(n||(n={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i._blendState=new t.BlendState,i}return s(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,r=this.global,n=this.globalTransformMatrix,s=this.origin,o=this.offset,a=this.animationPose,l=this._parent,c=this._armature.flipX,h=this._armature.flipY===t.DragonBones.yDown,u=null!==l,d=0;if(1===this.offsetMode?null!==s?(r.x=s.x+o.x+a.x,r.scaleX=s.scaleX*o.scaleX*a.scaleX,r.scaleY=s.scaleY*o.scaleY*a.scaleY,t.DragonBones.yDown?(r.y=s.y+o.y+a.y,r.skew=s.skew+o.skew+a.skew,r.rotation=s.rotation+o.rotation+a.rotation):(r.y=s.y-o.y+a.y,r.skew=s.skew-o.skew+a.skew,r.rotation=s.rotation-o.rotation+a.rotation)):(r.copyFrom(o),t.DragonBones.yDown||(r.y=-r.y,r.skew=-r.skew,r.rotation=-r.rotation),r.add(a)):0===this.offsetMode?null!==s?r.copyFrom(s).add(a):r.copyFrom(a):(u=!1,r.copyFrom(o),t.DragonBones.yDown||(r.y=-r.y,r.skew=-r.skew,r.rotation=-r.rotation)),u){var p=0===l._boneData.type?l.globalTransformMatrix:l._getGlobalTransformMatrix(r.x,r.y);if(i.inheritScale)i.inheritRotation||(l.updateGlobalTransform(),d=c&&h?r.rotation-(l.global.rotation+Math.PI):c?r.rotation+l.global.rotation+Math.PI:h?r.rotation+l.global.rotation:r.rotation-l.global.rotation,r.rotation=d),r.toMatrix(n),n.concat(p),i.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y),e?r.fromMatrix(n):this._globalDirty=!0;else{if(i.inheritTranslation){var f=r.x,_=r.y;r.x=p.a*f+p.c*_+p.tx,r.y=p.b*f+p.d*_+p.ty}else c&&(r.x=-r.x),h&&(r.y=-r.y);i.inheritRotation?(l.updateGlobalTransform(),d=l.global.scaleX<0?r.rotation+l.global.rotation+Math.PI:r.rotation+l.global.rotation,p.a*p.d-p.b*p.c<0&&(d-=2*r.rotation,(c!==h||i.inheritReflection)&&(r.skew+=Math.PI),t.DragonBones.yDown||(r.skew=-r.skew)),r.rotation=d):(c||h)&&(c&&h?d=r.rotation+Math.PI:(d=c?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=d),r.toMatrix(n)}}else(c||h)&&(c&&(r.x=-r.x),h&&(r.y=-r.y),c&&h?d=r.rotation+Math.PI:(d=c?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=d),r.toMatrix(n)},i.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},i.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++)(o=r[i])._root===this&&o.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var n=0,s=this._armature._constraints;n<s.length;n++){var o;(o=s[n])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var a=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(a),a&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var r=i[e];r.parent===this&&r._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getBones();e<i.length;e++){var r=i[e];r.parent===this&&t.push(r)}return t},i.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getSlots();e<i.length;e++){var r=i[e];r.parent===this&&t.push(r)}return t},Object.defineProperty(i.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];if(i.parent===this)return i}return null},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e}(n||(n={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},e.prototype._getAffineTransform=function(t,e,i,r,n,s,o,a,l,c,h,u,d){var p=o-n,f=a-s,_=l-n,m=c-s;h.rotation=Math.atan2(f,p),h.skew=Math.atan2(m,_)-.5*Math.PI-h.rotation,d&&(h.rotation+=Math.PI),h.scaleX=Math.sqrt(p*p+f*f)/i,h.scaleY=Math.sqrt(_*_+m*m)/r,h.toMatrix(u),h.x=u.tx=n-(u.a*t+u.c*e),h.y=u.ty=s-(u.b*t+u.d*e)},e.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,i=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var r=0,n=t.length;r<n;r+=2){var s=t[r]+i[r],o=t[r+1]+i[r],a=this._parent._getGlobalTransformMatrix(s,o);e[r]=a.a*s+a.c*o+a.tx,e[r+1]=a.b*s+a.d*o+a.ty}else{var l=this._parent.globalTransformMatrix;for(r=0,n=t.length;r<n;r+=2)s=t[r]+i[r],o=t[r+1]+i[r+1],e[r]=l.a*s+l.c*o+l.tx,e[r+1]=l.b*s+l.d*o+l.ty}else for(r=0,n=t.length;r<n;r+=2)e[r]=t[r]+i[r],e[r+1]=t[r+1]+i[r+1]},e.prototype._updateGlobalTransformMatrix=function(){var t=2*this._boneData.segmentX,e=this._vertices.length-2,i=this._vertices[0],r=this._vertices[1],n=this._vertices[t],s=this._vertices[t+1],o=this._vertices[e],a=this._vertices[e+1],l=this._vertices[e-t],c=this._vertices[e-t+1],h=i+.5*(o-i),u=r+.5*(a-r),d=h+.5*(n+.5*(l-n)-h),p=u+.5*(s+.5*(c-s)-u),f=n+.5*(o-n),_=s+.5*(a-s),m=l+.5*(o-l),g=c+.5*(a-c);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,d,p,f,_,m,g,this.global,this.globalTransformMatrix,!1)},e.prototype._getGlobalTransformMatrix=function(t,i){var r=1e3;if(t<-r||r<t||i<-r||r<i)return this.globalTransformMatrix;var n=!1,s=200,o=this._boneData,a=o.segmentX,l=o.segmentY,c=2*o.segmentX,h=this._dX,u=this._dY,d=Math.floor((t+s)/h),p=Math.floor((i+s)/u),f=0,_=d*h-s,m=p*u-s,g=this._matrixCahce,y=e._helpMatrix;if(t<-s){if(i<-s||i>=s)return this.globalTransformMatrix;if(f=7*(2*(a*(l+1)+2*a+l+p)+((n=i>this._kX*(t+s)+m)?1:0)),this._matrixCahce[f]>0)y.copyFromArray(g,f+1);else{var v=p*(c+2),b=this._hullCache[4],x=this._hullCache[5],T=this._hullCache[2]-(l-p)*b,C=this._hullCache[3]-(l-p)*x,S=this._vertices;n?this._getAffineTransform(-s,m+u,800,u,S[v+c+2],S[v+c+3],T+b,C+x,S[v],S[v+1],e._helpTransform,y,!0):this._getAffineTransform(-r,m,800,u,T,C,S[v],S[v+1],T+b,C+x,e._helpTransform,y,!1),g[f]=1,g[f+1]=y.a,g[f+2]=y.b,g[f+3]=y.c,g[f+4]=y.d,g[f+5]=y.tx,g[f+6]=y.ty}}else if(t>=s){if(i<-s||i>=s)return this.globalTransformMatrix;f=7*(2*(a*(l+1)+a+p)+((n=i>this._kX*(t-r)+m)?1:0)),this._matrixCahce[f]>0?y.copyFromArray(g,f+1):(v=(p+1)*(c+2)-2,b=this._hullCache[4],x=this._hullCache[5],T=this._hullCache[0]+p*b,C=this._hullCache[1]+p*x,S=this._vertices,n?this._getAffineTransform(r,m+u,800,u,T+b,C+x,S[v+c+2],S[v+c+3],T,C,e._helpTransform,y,!0):this._getAffineTransform(s,m,800,u,S[v],S[v+1],T,C,S[v+c+2],S[v+c+3],e._helpTransform,y,!1),g[f]=1,g[f+1]=y.a,g[f+2]=y.b,g[f+3]=y.c,g[f+4]=y.d,g[f+5]=y.tx,g[f+6]=y.ty)}else if(i<-s){if(t<-s||t>=s)return this.globalTransformMatrix;f=7*(a*(l+1)+2*d+((n=i>this._kY*(t-_-h)-r)?1:0)),this._matrixCahce[f]>0?y.copyFromArray(g,f+1):(v=2*d,b=this._hullCache[10],x=this._hullCache[11],T=this._hullCache[8]+d*b,C=this._hullCache[9]+d*x,S=this._vertices,n?this._getAffineTransform(_+h,-s,h,800,S[v+2],S[v+3],S[v],S[v+1],T+b,C+x,e._helpTransform,y,!0):this._getAffineTransform(_,-r,h,800,T,C,T+b,C+x,S[v],S[v+1],e._helpTransform,y,!1),g[f]=1,g[f+1]=y.a,g[f+2]=y.b,g[f+3]=y.c,g[f+4]=y.d,g[f+5]=y.tx,g[f+6]=y.ty)}else if(i>=s){if(t<-s||t>=s)return this.globalTransformMatrix;f=7*(2*(a*(l+1)+a+l+p)+((n=i>this._kY*(t-_-h)+s)?1:0)),this._matrixCahce[f]>0?y.copyFromArray(g,f+1):(v=l*(c+2)+2*d,b=this._hullCache[10],x=this._hullCache[11],T=this._hullCache[6]-(a-d)*b,C=this._hullCache[7]-(a-d)*x,S=this._vertices,n?this._getAffineTransform(_+h,r,h,800,T+b,C+x,T,C,S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(_,s,h,800,S[v],S[v+1],S[v+2],S[v+3],T,C,e._helpTransform,y,!1),g[f]=1,g[f+1]=y.a,g[f+2]=y.b,g[f+3]=y.c,g[f+4]=y.d,g[f+5]=y.tx,g[f+6]=y.ty)}else f=7*(2*(a*p+d)+((n=i>this._k*(t-_-h)+m)?1:0)),this._matrixCahce[f]>0?y.copyFromArray(g,f+1):(v=2*d+p*(c+2),S=this._vertices,n?this._getAffineTransform(_+h,m+u,h,u,S[v+c+4],S[v+c+5],S[v+c+2],S[v+c+3],S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(_,m,h,u,S[v],S[v+1],S[v+2],S[v+3],S[v+c+2],S[v+c+3],e._helpTransform,y,!1),g[f]=1,g[f+1]=y.a,g[f+2]=y.b,g[f+3]=y.c,g[f+4]=y.d,g[f+5]=y.tx,g[f+6]=y.ty);return y},e.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var r=e.segmentX,n=e.segmentY,s=e.vertices.length;this._dX=400/r,this._dY=400/n,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=s,this._deformVertices.length=s,this._matrixCahce.length=14*(r*n+2*r+2*n),this._hullCache.length=10;for(var o=0;o<s;++o)this._deformVertices[o]=0}},e.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var i=this._cachedFrameIndices[t];if(i>=0&&this._cachedFrameIndex===i)this._transformDirty=!1;else if(i>=0)this._transformDirty=!0,this._cachedFrameIndex=i;else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++)(a=n[r])._root===this&&a.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var s=0,o=this._armature._constraints;s<o.length;s++){var a;(a=o[s])._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var l=0,c=this._matrixCahce.length;l<c;l+=7)this._matrixCahce[l]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var h=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(h),h&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var u=2*this.global.x,d=2*this.global.y,p=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,p),this._hullCache[0]=p.x,this._hullCache[1]=p.y,this._hullCache[2]=u-p.x,this._hullCache[3]=d-p.y,this.globalTransformMatrix.transformPoint(0,this._dY,p,!0),this._hullCache[4]=p.x,this._hullCache[5]=p.y,this.globalTransformMatrix.transformPoint(200,1e3,p),this._hullCache[6]=p.x,this._hullCache[7]=p.y,this._hullCache[8]=u-p.x,this._hullCache[9]=d-p.y,this.globalTransformMatrix.transformPoint(this._dX,0,p,!0),this._hullCache[10]=p.x,this._hullCache[11]=p.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(n||(n={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._localMatrix=new t.Matrix,i._colorTransform=new t.ColorTransform,i._displayDatas=[],i._displayList=[],i._deformVertices=null,i._rawDisplay=null,i._meshDisplay=null,i}return s(i,e),i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var i=[],r=0,n=this._displayList;r<n.length;r++)null!==(a=n[r])&&a!==this._rawDisplay&&a!==this._meshDisplay&&i.indexOf(a)<0&&i.push(a);for(var s=0,o=i;s<o.length;s++){var a;(a=o[s])instanceof t.Armature?a.dispose():this._disposeDisplay(a,!0)}null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){var i=e.getDisplays(this._slotData.name);if(null!==i)return t<i.length?i[t]:null}return null},i.prototype._updateDisplayData=function(){var e=this._displayData,r=null!==this._deformVertices?this._deformVertices.verticesData:null,n=this._textureData,s=null,o=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(s=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===s&&(s=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?o=this._displayData.vertices:null!==s&&(2===s.type||4===s.type)&&(o=s.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==s&&3===s.type&&(this._boundingBoxData=s.boundingBox),(0===this._displayData.type||2===this._displayData.type)&&(this._textureData=this._displayData.texture)),this._displayData!==e||o!==r||this._textureData!==n){if(null===o&&null!==this._textureData){var a=this._displayData,l=this._textureData.parent.scale*this._armature._armatureData.scale,c=this._textureData.frame;this._pivotX=a.pivot.x,this._pivotY=a.pivot.y;var h=null!==c?c:this._textureData.region,u=h.width,d=h.height;this._textureData.rotated&&null===c&&(u=h.height,d=h.width),this._pivotX*=u*l,this._pivotY*=d*l,null!==c&&(this._pivotX+=c.x*l,this._pivotY+=c.y*l),null!==this._displayData&&null!==s&&this._displayData!==s&&(s.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX-=i._helpPoint.x,this._pivotY-=i._helpPoint.y,this._displayData.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX+=i._helpPoint.x,this._pivotY+=i._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*l-this._pivotY)}else this._pivotX=0,this._pivotY=0;null!==s?this.origin=s.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,o!==r?(null===this._deformVertices&&(this._deformVertices=t.BaseObject.borrowObject(t.DeformVertices)),this._deformVertices.init(o,this._armature)):null!==this._deformVertices&&this._textureData!==n&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0}},i.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var r=null!==this._display?this._display:this._rawDisplay;if(r!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),r!==this._rawDisplay&&r!==this._meshDisplay||this._updateFrame(),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var n=this._armature.cacheFrameRate;0!==n&&(this._childArmature.cacheFrameRate=n)}var s=null;if(null!==this._displayData&&1===this._displayData.type)s=this._displayData.actions;else if(this._displayIndex>=0&&null!==this._rawDisplayDatas){var o=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===o&&(o=this._getDefaultRawDisplayData(this._displayIndex)),null!==o&&1===o.type&&(s=o.actions)}if(null!==s&&s.length>0)for(var a=0,l=s;a<l.length;a++){var c=l[a],h=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(c,h,this._armature),h.slot=this,this._armature._bufferAction(h,!1)}else this._childArmature.animation.play()}},i.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},i.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},i.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},i.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},i.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var i=0,r=e.length;i<r;++i){var n=e[i];null!==n&&n!==this._rawDisplay&&n!==this._meshDisplay&&!(n instanceof t.Armature)&&this._displayList.indexOf(n)<0&&this._initDisplay(n,!0),this._displayList[i]=n}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},i.prototype.init=function(t,e,i,r){if(null===this._slotData){this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=r,this._armature=e;var n=this._armature.getBone(this._slotData.parent.name);null!==n&&(this._parent=n),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},i.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var i=null!==this._deformVertices.verticesData.weight,r=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||i&&this._deformVertices.isBonesUpdate()||r&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),i||r)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var n=t>=0;this._updateGlobalTransformMatrix(n),n&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},i.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},i.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var i=0,r=this._displayDatas.length;i<r;++i)this._displayDatas[i]||(this._displayDatas[i]=null)}this._displayDatas[e]=t},i.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),this._boundingBoxData.containsPoint(i._helpPoint.x,i._helpPoint.y))},i.prototype.intersectsSegment=function(t,e,r,n,s,o,a){if(void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),t=i._helpPoint.x,e=i._helpPoint.y,i._helpMatrix.transformPoint(r,n,i._helpPoint),r=i._helpPoint.x,n=i._helpPoint.y;var l=this._boundingBoxData.intersectsSegment(t,e,r,n,s,o,a);return l>0&&(1===l||2===l?null!==s?(this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==o&&(o.x=s.x,o.y=s.y)):null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o):(null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o)),null!==a&&(this.globalTransformMatrix.transformPoint(Math.cos(a.x),Math.sin(a.x),i._helpPoint,!0),a.x=Math.atan2(i._helpPoint.y,i._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(a.y),Math.sin(a.y),i._helpPoint,!0),a.y=Math.atan2(i._helpPoint.y,i._helpPoint.x))),l},i.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var i=this._displayList.concat(),r=new Array;this._setDisplayList(e)&&this.update(-1);for(var n=0,s=i;n<s.length;n++)null!==(l=s[n])&&l!==this._rawDisplay&&l!==this._meshDisplay&&this._displayList.indexOf(l)<0&&r.indexOf(l)<0&&r.push(l);for(var o=0,a=r;o<a.length;o++){var l;(l=a[o])instanceof t.Armature||this._disposeDisplay(l,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,i=this._displayDatas.length;e<i;++e){var r=this._rawDisplayDatas[e];null===r&&(r=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=r}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var i=this.displayList;e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(t){this.display=t},i}(t.TransformObject);t.Slot=e}(n||(n={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.Constraint=e;var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.toString=function(){return"[class dragonBones.IKConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},i.prototype._computeA=function(){var e=this._target.global,i=this._root.global,r=this._root.globalTransformMatrix,n=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(n+=Math.PI),i.rotation+=t.Transform.normalizeRadian(n-i.rotation)*this._weight,i.toMatrix(r)},i.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,r=this._target.global,n=i.global,s=this._bone.global,o=this._bone.globalTransformMatrix,a=o.a*e,l=o.b*e,c=a*a+l*l,h=Math.sqrt(c),u=s.x-n.x,d=s.y-n.y,p=u*u+d*d,f=Math.sqrt(p),_=s.rotation,m=n.rotation,g=Math.atan2(d,u),y=(u=r.x-n.x)*u+(d=r.y-n.y)*d,v=Math.sqrt(y),b=0;if(h+f<=v||v+h<=f||v+f<=h)b=Math.atan2(r.y-n.y,r.x-n.x),h+f<=v||f<h&&(b+=Math.PI);else{var x=(p-c+y)/(2*y),T=Math.sqrt(p-x*x*y)/v,C=n.x+u*x,S=n.y+d*x,w=-d*T,A=u*T,E=!1,D=i.parent;if(null!==D){var L=D.globalTransformMatrix;E=L.a*L.d-L.b*L.c<0}E!==this._bendPositive?(s.x=C-w,s.y=S-A):(s.x=C+w,s.y=S+A),b=Math.atan2(s.y-n.y,s.x-n.x)}var I=t.Transform.normalizeRadian(b-g);n.rotation=m+I*this._weight,n.toMatrix(i.globalTransformMatrix);var P=g+I*this._weight;s.x=n.x+Math.cos(P)*f,s.y=n.y+Math.sin(P)*f;var M=Math.atan2(r.y-s.y,r.x-s.x);s.scaleX<0&&(M+=Math.PI),s.rotation=n.rotation+_-m+t.Transform.normalizeRadian(M-I-_)*this._weight,s.toMatrix(o)},i.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},i.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},i.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},i}(e);t.IKConstraint=i;var r=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return s(i,e),i.toString=function(){return"[class dragonBones.PathConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},i.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,r=e.armatureData.scale,n=i.intArray,s=i.floatArray,o=t.offset,a=n[o+0],l=n[o+2];this._pathGlobalVertices.length=2*a;var c=t.weight;if(null!==c)for(var h=this._pathSlot._deformVertices.bones,u=c.bones.length,d=c.offset,p=n[d+1],f=d+2+u,_=(S=0,0);S<a;S++){for(var m=0,g=0,y=0,v=n[f++];y<v;y++){var b=h[n[f++]];if(null!==b){b.updateByConstraint(),C=b.globalTransformMatrix;var x=s[p++];A=s[p++]*r,E=s[p++]*r,m+=(C.a*A+C.c*E+C.tx)*x,g+=(C.b*A+C.d*E+C.ty)*x}}this._pathGlobalVertices[_++]=m,this._pathGlobalVertices[_++]=g}else{var T=this._pathSlot.parent;T.updateByConstraint();for(var C=T.globalTransformMatrix,S=0,w=l;S<a;S+=2){var A=s[w++]*r,E=s[w++]*r,D=C.a*A+C.c*E+C.tx,L=C.b*A+C.d*E+C.ty;this._pathGlobalVertices[S]=D,this._pathGlobalVertices[S+1]=L}}},i.prototype._computeVertices=function(t,e,i,r){for(var n=i,s=t;n<e;n+=2)r[n]=this._pathGlobalVertices[s++],r[n+1]=this._pathGlobalVertices[s++]},i.prototype._computeBezierCurve=function(t,e,i,r,n){var s=this._armature.armatureData.parent.intArray[t.vertices.offset+0],o=this._positions,a=this._spaces,l=t.closed,c=Array(),h=2*s,u=h/6,d=-1,p=this.position;o.length=3*e+2;var f=0;if(t.constantSpeed){l?(h+=2,c.length=s,this._computeVertices(2,h-4,0,c),this._computeVertices(0,2,h-4,c),c[h-2]=c[0],c[h-1]=c[1]):(u--,h-=4,c.length=h,this._computeVertices(2,h,0,c));var _=new Array(u);f=0;for(var m,g,y,v,b,x,T,C,S=c[0],w=c[1],A=0,E=0,D=0,L=0,I=0,P=0,M=(U=0,2);U<u;U++,M+=6)A=c[M],E=c[M+1],D=c[M+2],L=c[M+3],b=2*(m=.1875*(S-2*A+D))+(y=.09375*(3*(A-D)-S+(I=c[M+4]))),x=2*(g=.1875*(w-2*E+L))+(v=.09375*(3*(E-L)-w+(P=c[M+5]))),T=.75*(A-S)+m+.16666667*y,C=.75*(E-w)+g+.16666667*v,f+=Math.sqrt(T*T+C*C),T+=b,C+=x,b+=y,x+=v,f+=Math.sqrt(T*T+C*C),T+=b,C+=x,f+=Math.sqrt(T*T+C*C),T+=b+y,C+=x+v,f+=Math.sqrt(T*T+C*C),_[U]=f,S=I,w=P;if(r&&(p*=f),n)for(U=0;U<e;U++)a[U]*=f;for(var R=this._segments,O=0,B=(U=0,Y=0,H=0,0);U<e;U++,Y+=3){var N=p+=a[U];if(l)(N%=f)<0&&(N+=f),H=0;else{if(N<0)continue;if(N>f)continue}for(;;H++){var k=_[H];if(!(N>k)){0===H?N/=k:N=(N-(j=_[H-1]))/(k-j);break}}if(H!==d){d=H;var F=6*H;for(S=c[F],w=c[F+1],A=c[F+2],E=c[F+3],D=c[F+4],L=c[F+5],b=2*(m=.03*(S-2*A+D))+(y=.006*(3*(A-D)-S+(I=c[F+6]))),x=2*(g=.03*(w-2*E+L))+(v=.006*(3*(E-L)-w+(P=c[F+7]))),T=.3*(A-S)+m+.16666667*y,C=.3*(E-w)+g+.16666667*v,O=Math.sqrt(T*T+C*C),R[0]=O,F=1;F<8;F++)T+=b,C+=x,b+=y,x+=v,O+=Math.sqrt(T*T+C*C),R[F]=O;T+=b,C+=x,O+=Math.sqrt(T*T+C*C),R[8]=O,T+=b+y,C+=x+v,O+=Math.sqrt(T*T+C*C),R[9]=O,B=0}for(N*=O;;B++){var V=R[B];if(!(N>V)){var j;0===B?N/=V:N=B+(N-(j=R[B-1]))/(V-j);break}}this.addCurvePosition(.1*N,S,w,A,E,D,L,I,P,o,Y,i)}}else{var G=t.curveLengths;if(f=G[u-=l?1:2],r&&(p*=f),n)for(var U=0;U<e;U++)a[U]*=f;c.length=8,U=0;for(var Y=0,H=0;U<e;U++,Y+=3){if(p+=a[U],l)(p%=f)<0&&(p+=f),H=0;else{if(p<0)continue;if(p>f)continue}for(var X=0;;H++){var z=G[H];if(!(p>z)){if(0===H)X=p/z;else{var W=G[H-1];X=(p-W)/(z-W)}break}}H!==d&&(d=H,l&&H===u?(this._computeVertices(h-4,4,0,c),this._computeVertices(0,4,4,c)):this._computeVertices(6*H+2,8,0,c)),this.addCurvePosition(X,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],o,Y,i)}}},i.prototype.addCurvePosition=function(t,e,i,r,n,s,o,a,l,c,h,u){if(0===t)return c[h]=e,c[h+1]=i,void(c[h+2]=0);if(1===t)return c[h]=a,c[h+1]=l,void(c[h+2]=0);var d=1-t,p=d*d,f=t*t,_=p*d,m=p*t*3,g=d*f*3,y=t*f,v=_*e+m*r+g*s+y*a,b=_*i+m*n+g*o+y*l;c[h]=v,c[h+1]=b,c[h+2]=u?Math.atan2(b-(_*i+m*n+g*o),v-(_*e+m*r+g*s)):0},i.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.vertices.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var r=0,n=i.bones.length;r<n;r++){var s=this._armature.getBone(i.bones[r].name);null!==s&&this._bones.push(s)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},i.prototype.update=function(){var e=this._pathSlot;if(null!==e._deformVertices&&null!==e._deformVertices.verticesData&&e._deformVertices.verticesData.offset===this.pathOffset){var i=this._constraintData,r=e._displayData,n=!1,s=e._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(r.vertices),n=!0):null!==s&&(s.verticesDirty||s.isBonesUpdate())&&(this._updatePathVertices(r.vertices),s.verticesDirty=!1,n=!0),n||this.dirty){var o=i.positionMode,a=i.spacingMode,l=i.rotateMode,c=this._bones,h=0===a,u=2===l,d=0===l,p=c.length,f=d?p:p+1,_=this.spacing,m=this._spaces;if(m.length=f,u||h){m[0]=0;for(var g=0,y=f-1;g<y;g++){(P=c[g]).updateByConstraint();var v=P._boneData.length,b=v*(M=P.globalTransformMatrix).a,x=v*M.b,T=Math.sqrt(b*b+x*x);u&&(this._boneLengths[g]=T),m[g+1]=(v+_)*T/v}}else for(g=0;g<f;g++)m[g]=_;this._computeBezierCurve(r,f,d,1===o,2===a);var C,S=this._positions,w=this.rotateOffset,A=S[0],E=S[1];0===w?C=1===l:(C=!1,null!==(P=e.parent)&&(w*=(M=P.globalTransformMatrix).a*M.d-M.b*M.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD));for(var D=this.rotateMix,L=this.translateMix,I=(g=0,3);g<p;g++,I+=3){var P,M;(P=c[g]).updateByConstraint(),(M=P.globalTransformMatrix).tx+=(A-M.tx)*L,M.ty+=(E-M.ty)*L;var R=(b=S[I])-A,O=(x=S[I+1])-E;if(u){var B=this._boneLengths[g],N=(Math.sqrt(R*R+O*O)/B-1)*D+1;M.a*=N,M.b*=N}if(A=b,E=x,D>0){var k=M.a,F=M.b,V=M.c,j=M.d,G=void 0,U=void 0,Y=void 0;if(G=d?S[I-1]:Math.atan2(O,R),G-=Math.atan2(F,k),C){U=Math.cos(G),Y=Math.sin(G);var H=P._boneData.length;A+=(H*(U*k-Y*F)-R)*D,E+=(H*(Y*k+U*F)-O)*D}else G+=w;G>t.Transform.PI?G-=t.Transform.PI_D:G<-t.Transform.PI&&(G+=t.Transform.PI_D),G*=D,U=Math.cos(G),Y=Math.sin(G),M.a=U*k-Y*F,M.b=Y*k+U*F,M.c=U*V-Y*j,M.d=Y*V+U*j}P.global.fromMatrix(M)}this.dirty=!1}}},i.prototype.invalidUpdate=function(){},i}(e);t.PathConstraint=r}(n||(n={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,r=0,n=this._animatebles.length;i<n;++i){var s=this._animatebles[i];null!==s?(r>0&&(this._animatebles[i-r]=s,this._animatebles[i]=null),s.advanceTime(t)):r++}if(r>0){for(n=this._animatebles.length;i<n;++i){var o=this._animatebles[i];null!==o?this._animatebles[i-r]=o:r++}this._animatebles.length-=r}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}();t.WorldClock=e}(n||(n={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return s(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();for(var i in this._animations)delete this._animations[i];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++)null===(c=i[e])._parent&&c.layer===t.layer&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var r=0,n=this._animationStates;r<n.length;r++)null===(c=n[r])._parent&&c.group===t.group&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var s=0,o=this._animationStates;s<o.length;s++)null===(c=o[s])._parent&&c.layer===t.layer&&c.group===t.group&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var a=0,l=this._animationStates;a<l.length;a++){var c;null===(c=l[a])._parent&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},i.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if((f=this._animationStates[0])._fadeState>0&&f._subFadeState>0)this._armature._dragonBones.bufferObject(f),this._animationStates.length=0,this._lastAnimationState=null;else{var i=f._animationData,r=i.cacheFrameRate;if(this._animationDirty&&r>0){this._animationDirty=!1;for(var n=0,s=this._armature.getBones();n<s.length;n++){var o=s[n];o._cachedFrameIndices=i.getBoneCachedFrameIndices(o.name)}for(var a=0,l=this._armature.getSlots();a<l.length;a++){var c=l[a],h=c.rawDisplayDatas;if(null!==h&&h.length>0){var u=h[0];if(null!==u&&u.parent===this._armature.armatureData.defaultSkin){c._cachedFrameIndices=i.getSlotCachedFrameIndices(c.name);continue}}c._cachedFrameIndices=null}}f.advanceTime(t,r)}else if(e>1){for(var d=0,p=0;d<e;++d){var f;(f=this._animationStates[d])._fadeState>0&&f._subFadeState>0?(p++,this._armature._dragonBones.bufferObject(f),this._animationDirty=!0,this._lastAnimationState===f&&(this._lastAnimationState=null)):(p>0&&(this._animationStates[d-p]=f),f.advanceTime(t,0)),d===e-1&&p>0&&(this._animationStates.length-=p,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(r=this.getState(t))&&r.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var r;(r=i[e]).stop()}},i.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var r=this._animations[i];if(5===e.fadeOutMode)for(var n=0,s=this._animationStates;n<s.length;n++){var o=s[n];if(o._animationData===r)return o}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=r.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/r.scale),r.frameCount>1?(e.position<0?(e.position%=r.duration,e.position=r.duration-e.position):e.position===r.duration?e.position-=1e-6:e.position>r.duration&&(e.position%=r.duration),e.duration>0&&e.position+e.duration>r.duration&&(e.duration=r.duration-e.position),e.playTimes<0&&(e.playTimes=r.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var a=t.BaseObject.borrowObject(t.AnimationState);if(a.init(this._armature,r,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var l=!1,c=0,h=this._animationStates.length;c<h;++c){if(a.layer>this._animationStates[c].layer){l=!0,this._animationStates.splice(c,0,a);break}if(c!==h-1&&a.layer>this._animationStates[c+1].layer){l=!0,this._animationStates.splice(c+1,0,a);break}}l||this._animationStates.push(a)}else this._animationStates.push(a);for(var u=0,d=this._armature.getSlots();u<d.length;u++){var p=d[u].childArmature;null!==p&&p.inheritAnimation&&p.animation.hasAnimation(i)&&null===p.animation.getState(i)&&p.animation.fadeIn(i)}var f=!1;for(var _ in r.animationTimelines){this._lockUpdate||(f=!0,this._lockUpdate=!0);var m=this.fadeIn(_,e.fadeInTime,1,a.layer,null,0);null!==m&&(m.resetToPose=!1,m._parent=a,m.stop())}return f&&(this._lockUpdate=!1),this._lockUpdate||(e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=a),a},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,r,n,s){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===s&&(s=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.duration*e/r.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},i.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var i=this._animationStates[e];if(i.name===t)return i}return null},i.prototype.hasAnimation=function(t){return t in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,r,n,s,o,a,l){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===r&&(r=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=3),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=r,this._animationConfig.layer=n,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==s?s:"";var c=this._animations[t];return c&&i>0&&(this._animationConfig.timeScale=c.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,i=this._animationNames.length;e<i;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e}(n||(n={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new r,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return s(n,e),n.toString=function(){return"[class dragonBones.AnimationState]"},n.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var i=0,r=this._surfaceTimelines;i<r.length;i++)r[i].returnToPool();for(var n=0,s=this._slotTimelines;n<s.length;n++)s[n].returnToPool();for(var o=0,a=this._constraintTimelines;o<a.length;o++)a[o].returnToPool();for(var l=0,c=this._animationTimelines;l<c.length;l++)c[l].returnToPool();for(var h in this._bonePoses)this._bonePoses[h].returnToPool(),delete this._bonePoses[h];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},n.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var r=i[e];if(null!==(l=this._animationData.getConstraintTimelines(r.name))){for(var n=0,s=l;n<s.length;n++)if(30===(d=s[n]).type)(p=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=r,p.init(this._armature,this,d),this._constraintTimelines.push(p)}else this.resetToPose&&((p=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=r,p.init(this._armature,this,null),this._constraintTimelines.push(p),this._poseTimelines.push(p))}for(var o=0,a=this._armature.animation.getStates();o<a.length;o++){var l,c=a[o];if(c._parent===this&&null!==(l=this._animationData.getAnimationTimelines(c.name)))for(var h=0,u=l;h<u.length;h++){var d,p;if(40===(d=u[h]).type)(p=t.BaseObject.borrowObject(t.AnimationTimelineState)).animationState=c,p.init(this._armature,this,d),this._animationTimelines.push(p)}}},n.prototype._updateBoneAndSlotTimelines=function(){for(var e={},r=0,n=this._boneTimelines;r<n.length;r++)(l=(y=n[r]).bone.name)in e||(e[l]=[]),e[l].push(y);for(var s=0,o=this._armature.getBones();s<o.length;s++){var a=o[s],l=a.name;if(this.containsBoneMask(l))if(l in e)delete e[l];else if(0===a._boneData.type){var c=this._animationData.getBoneTimelines(l),h=l in this._bonePoses?this._bonePoses[l]:this._bonePoses[l]=t.BaseObject.borrowObject(i);if(null!==c)for(var u=0,d=c;u<d.length;u++)switch((P=d[u]).type){case 10:(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=a,y.bonePose=h,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 11:(y=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).bone=a,y.bonePose=h,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 12:(y=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).bone=a,y.bonePose=h,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 13:(y=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).bone=a,y.bonePose=h,y.init(this._armature,this,P),this._boneTimelines.push(y)}else this.resetToPose&&((y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=a,y.bonePose=h,y.init(this._armature,this,null),this._boneTimelines.push(y),this._poseTimelines.push(y))}else if(1===a._boneData.type)if(null!==(c=this._animationData.getSurfaceTimelines(l))){for(var p=0,f=c;p<f.length;p++)if(50===(P=f[p]).type)(y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=a,y.init(this._armature,this,P),this._surfaceTimelines.push(y)}else this.resetToPose&&((y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=a,y.init(this._armature,this,null),this._surfaceTimelines.push(y),this._poseTimelines.push(y))}for(var _ in e)for(var m=0,g=e[_];m<g.length;m++){var y=g[m];this._boneTimelines.splice(this._boneTimelines.indexOf(y),1),y.returnToPool()}for(var v={},b=[],x=0,T=this._slotTimelines;x<T.length;x++)(l=(y=T[x]).slot.name)in v||(v[l]=[]),v[l].push(y);for(var C=0,S=this._armature.getSlots();C<S.length;C++){var w=S[C],A=w.parent.name;if(this.containsBoneMask(A))if(l=w.name,c=this._animationData.getSlotTimelines(l),l in v)delete v[l];else{var E=!1,D=!1;if(b.length=0,null!==c)for(var L=0,I=c;L<I.length;L++){var P;switch((P=I[L]).type){case 20:(y=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=w,y.init(this._armature,this,P),this._slotTimelines.push(y),E=!0;break;case 21:(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=w,y.init(this._armature,this,P),this._slotTimelines.push(y),D=!0;break;case 22:(y=t.BaseObject.borrowObject(t.DeformTimelineState)).slot=w,y.init(this._armature,this,P),this._slotTimelines.push(y),b.push(y.vertexOffset)}}if(this.resetToPose&&(E||((y=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=w,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y)),D||((y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=w,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y)),null!==w.rawDisplayDatas))for(var M=0,R=w.rawDisplayDatas;M<R.length;M++){var O=R[M];if(null!==O&&2===O.type){var B=O.vertices.offset;b.indexOf(B)<0&&((y=t.BaseObject.borrowObject(t.DeformTimelineState)).vertexOffset=B,y.slot=w,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y))}}}}for(var _ in v)for(var N=0,k=v[_];N<k.length;N++)y=k[N],this._slotTimelines.splice(this._slotTimelines.indexOf(y),1),y.returnToPool()},n.prototype._advanceFadeTime=function(e){var i,r=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var n=r?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;this._armature.eventDispatcher.hasDBEventListener(n)&&((i=t.BaseObject.borrowObject(t.EventObject)).type=n,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i))}e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=r?0:1):this._fadeTime>0?this._fadeProgress=r?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=r?1:0,this._subFadeState>0&&(r||(this._playheadState|=1,this._fadeState=0),n=r?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(n)&&((i=t.BaseObject.borrowObject(t.EventObject)).type=n,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)))},n.prototype.init=function(e,i,r){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=r.resetToPose,this.additiveBlending=r.additiveBlending,this.displayControl=r.displayControl,this.actionEnabled=r.actionEnabled,this.layer=r.layer,this.playTimes=r.playTimes,this.timeScale=r.timeScale,this.fadeTotalTime=r.fadeInTime,this.autoFadeOutTime=r.autoFadeOutTime,this.weight=r.weight,this.name=r.name.length>0?r.name:r.animation,this.group=r.group,r.pauseFadeIn?this._playheadState=2:this._playheadState=3,r.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==r.position?this.timeScale>=0?this._time=r.position:this._time=r.position-this._duration:this._time=0):(this._position=r.position,this._duration=r.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),r.boneMask.length>0){this._boneMask.length=r.boneMask.length;for(var n=0,s=this._boneMask.length;n<s;++n)this._boneMask[n]=r.boneMask[n]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},n.prototype.advanceTime=function(e,i){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var r=0===this._fadeState&&i>0,n=!0,s=!0,o=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),r){var a=2*i;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*a)/a}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),r){var l=Math.floor(this._actionTimeline.currentTime*i);this._armature._cacheFrameIndex===l?(n=!1,s=!1):(this._armature._cacheFrameIndex=l,this._animationData.cachedFrames[l]?s=!1:this._animationData.cachedFrames[l]=!0)}if(n){if(s)for(var c=0,h=this._boneTimelines.length;c<h;++c)(_=this._boneTimelines[c]).playState<=0&&_.update(o),(c===h-1||_.bone!==this._boneTimelines[c+1].bone)&&0!==(u=_.bone._blendState.update(this._weightResult,this.layer))&&_.blend(u);for(c=0,h=this._surfaceTimelines.length;c<h;++c){var u=(_=this._surfaceTimelines[c]).surface._blendState.update(this._weightResult,this.layer);_.playState<=0&&_.update(o),0!==u&&_.blend(u)}if(this.displayControl)for(c=0,h=this._slotTimelines.length;c<h;++c){var d=(_=this._slotTimelines[c]).slot.displayController;null!==d&&d!==this.name&&d!==this.group||_.playState<=0&&_.update(o)}for(c=0,h=this._constraintTimelines.length;c<h;++c)(_=this._constraintTimelines[c]).playState<=0&&_.update(o);for(c=0,h=this._animationTimelines.length;c<h;++c)u=(_=this._animationTimelines[c]).animationState._blendState.update(this._weightResult,this.layer),_.playState<=0&&_.update(o),0!==u&&_.blend(u)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var p=0,f=this._poseTimelines;p<f.length;p++){var _;(_=f[p])instanceof t.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(_),1):_ instanceof t.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(_),1):_ instanceof t.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(_),1):_ instanceof t.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(_),1),_.returnToPool()}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},n.prototype.play=function(){this._playheadState=3},n.prototype.stop=function(){this._playheadState&=1},n.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,r=this._boneTimelines;i<r.length;i++)(d=r[i]).fadeOut();for(var n=0,s=this._surfaceTimelines;n<s.length;n++)(d=s[n]).fadeOut();for(var o=0,a=this._slotTimelines;o<a.length;o++)(d=a[o]).fadeOut();for(var l=0,c=this._constraintTimelines;l<c.length;l++)(d=c[l]).fadeOut();for(var h=0,u=this._animationTimelines;h<u.length;h++){var d;(d=u[h]).animationState.fadeOut(t,e),d.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},n.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},n.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var r=0,n=this._armature.getBones();r<n.length;r++){var s=n[r];this._boneMask.indexOf(s.name)<0&&i.contains(s)&&this._boneMask.push(s.name)}this._timelineDirty=1}},n.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var r=this._armature.getBone(t);if(null!==r){var n=this._armature.getBones();if(this._boneMask.length>0)for(var s=0,o=n;s<o.length;s++){var a=o[s],l=this._boneMask.indexOf(a.name);l>=0&&r.contains(a)&&this._boneMask.splice(l,1)}else for(var c=0,h=n;c<h.length;c++)(a=h[c])!==r&&(r.contains(a)||this._boneMask.push(a.name))}}this._timelineDirty=1},n.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(n.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return!!(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,r=this._boneTimelines;i<r.length;i++)r[i].playState=-1;for(var n=0,s=this._slotTimelines;n<s.length;n++)s[n].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),n}(t.BaseObject);t.AnimationState=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.current=new t.Transform,i.delta=new t.Transform,i.result=new t.Transform,i}return s(i,e),i.toString=function(){return"[class dragonBones.BonePose]"},i.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},i}(t.BaseObject);t.BonePose=i;var r=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();t.BlendState=r}(n||(n={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var n=this._animationState.playTimes,s=n*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),n>0&&(t>=s||t<=-s)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=n,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==r)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e._getEasingValue=function(t,e,i){var r=e;switch(t){case 3:r=Math.pow(e,2);break;case 4:r=1-Math.pow(1-e,2);break;case 5:r=.5*(1-Math.cos(e*Math.PI))}return(r-e)*i+e},e._getEasingCurveValue=function(t,e,i,r){if(t<=0)return 0;if(t>=1)return 1;var n=i+1,s=Math.floor(t*n),o=0===s?0:e[r+s-1];return 1e-4*(o+((s===n-1?1e4:e[r+s])-o)*(t*n-s))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,i=this.bone.animationPose,r=this.bonePose.result;2===t?(i.x+=r.x*e,i.y+=r.y*e,i.rotation+=r.rotation*e,i.skew+=r.skew*e,i.scaleX+=(r.scaleX-1)*e,i.scaleY+=(r.scaleY-1)*e):1!==e?(i.x=r.x*e,i.y=r.y*e,i.rotation=r.rotation*e,i.skew=r.skew*e,i.scaleX=(r.scaleX-1)*e+1,i.scaleY=(r.scaleY-1)*e+1):(i.x=r.x,i.y=r.y,i.rotation=r.rotation,i.skew=r.skew,i.scaleX=r.scaleX,i.scaleY=r.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(i);t.BoneTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(i);t.SlotTimelineState=n;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(i);t.ConstraintTimelineState=o}(n||(n={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var r=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],n=this._frameArray[r+1],s=this._animationData.parent.actions,o=0;o<n;++o){var a=s[this._frameArray[r+2+o]];if(0===a.type)(l=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[r]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(a,l,this._armature),this._armature._bufferAction(l,!0);else{var l,c=10===a.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;(11===a.type||i.hasDBEventListener(c))&&((l=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[r]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(a,l,this._armature),this._armature._dragonBones.bufferEvent(l))}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(e){var i=this.playState,r=this.currentPlayTimes,n=this.currentTime;if(this._setCurrentTime(e)){var s=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),r=this.currentPlayTimes,s.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var a=this._animationState.timeScale<0,l=null,c=null;if(this.currentPlayTimes!==r&&(s.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,l.armature=this._armature,l.animationState=this._animationState),this.playState>0&&s.hasDBEventListener(t.EventObject.COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,c.armature=this._armature,c.animationState=this._animationState)),this._frameCount>1){var h=this._timelineData,u=Math.floor(this.currentTime*this._frameRate),d=this._frameIndices[h.frameIndicesOffset+u];if(this._frameIndex!==d){var p=this._frameIndex;if(this._frameIndex=d,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[h.offset+5+this._frameIndex],a){if(p<0){var f=Math.floor(n*this._frameRate);p=this._frameIndices[h.frameIndicesOffset+f],this.currentPlayTimes===r&&p===d&&(p=-1)}for(;p>=0;){var _=this._animationData.frameOffset+this._timelineArray[h.offset+5+p],m=this._frameArray[_]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(p),null!==l&&0===p&&(this._armature._dragonBones.bufferEvent(l),l=null),p>0?p--:p=this._frameCount-1,p===d)break}}else for(p<0&&(f=Math.floor(n*this._frameRate),p=this._frameIndices[h.frameIndicesOffset+f],_=this._animationData.frameOffset+this._timelineArray[h.offset+5+p],m=this._frameArray[_]/this._frameRate,this.currentPlayTimes===r&&(n<=m?p>0?p--:p=this._frameCount-1:p===d&&(p=-1)));p>=0&&(p<this._frameCount-1?p++:p=0,_=this._animationData.frameOffset+this._timelineArray[h.offset+5+p],m=this._frameArray[_]/this._frameRate,this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(p),null!==l&&0===p&&(this._armature._dragonBones.bufferEvent(l),l=null),p!==d););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],m=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===r?n<=m&&this._onCrossFrame(this._frameIndex):this._position<=m&&(a||null===l||(this._armature._dragonBones.bufferEvent(l),l=null),this._onCrossFrame(this._frameIndex)));null!==l&&this._armature._dragonBones.bufferEvent(l),null!==c&&this._armature._dragonBones.bufferEvent(c)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=i;var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,i=this._armature._armatureData.scale,r=this._frameFloatArray,n=this.bonePose.current,s=this.bonePose.delta;n.x=r[t++]*i,n.y=r[t++]*i,n.rotation=r[t++],n.skew=r[t++],n.scaleX=r[t++],n.scaleY=r[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),s.x=r[t++]*i-n.x,s.y=r[t++]*i-n.y,s.rotation=r[t++]-n.rotation,s.skew=r[t++]-n.skew,s.scaleX=r[t++]-n.scaleX,s.scaleY=r[t++]-n.scaleY):(s.x=0,s.y=0,s.rotation=0,s.skew=0,s.scaleX=0,s.scaleY=0)}else n=this.bonePose.current,s=this.bonePose.delta,n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=1,n.scaleY=1,s.x=0,s.y=0,s.rotation=0,s.skew=0,s.scaleX=0,s.scaleY=0},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),r.x=t.x+i.x*this._tweenProgress,r.y=t.y+i.y*this._tweenProgress,r.rotation=t.rotation+i.rotation*this._tweenProgress,r.skew=t.skew+i.skew*this._tweenProgress,r.scaleX=t.scaleX+i.scaleX*this._tweenProgress,r.scaleY=t.scaleY+i.scaleY*this._tweenProgress},i.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},i}(t.BoneTimelineState);t.BoneAllTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._armature._armatureData.scale,r=this._frameFloatArray,n=this.bonePose.current,s=this.bonePose.delta;n.x=r[e++]*i,n.y=r[e++]*i,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),s.x=r[e++]*i-n.x,s.y=r[e++]*i-n.y):(s.x=0,s.y=0)}else n=this.bonePose.current,s=this.bonePose.delta,n.x=0,n.y=0,s.x=0,s.y=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),r.x=e.x+i.x*this._tweenProgress,r.y=e.y+i.y*this._tweenProgress},e}(t.BoneTimelineState);t.BoneTranslateTimelineState=n;var o=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var i=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,r=this._frameFloatArray,n=this.bonePose.current,s=this.bonePose.delta;n.rotation=r[i++],n.skew=r[i++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(i=this._animationData.frameFloatOffset+this._frameValueOffset,s.rotation=t.Transform.normalizeRadian(r[i++]-n.rotation)):s.rotation=r[i++]-n.rotation,s.skew=r[i++]-n.skew):(s.rotation=0,s.skew=0)}else n=this.bonePose.current,s=this.bonePose.delta,n.rotation=0,n.skew=0,s.rotation=0,s.skew=0},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),r.rotation=t.rotation+i.rotation*this._tweenProgress,r.skew=t.skew+i.skew*this._tweenProgress},i.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},i}(t.BoneTimelineState);t.BoneRotateTimelineState=o;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameFloatArray,r=this.bonePose.current,n=this.bonePose.delta;r.scaleX=i[e++],r.scaleY=i[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),n.scaleX=i[e++]-r.scaleX,n.scaleY=i[e++]-r.scaleY):(n.scaleX=0,n.scaleY=0)}else r=this.bonePose.current,n=this.bonePose.delta,r.scaleX=1,r.scaleY=1,n.scaleX=0,n.scaleY=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,i=this.bonePose.delta,r=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),r.scaleX=e.scaleX+i.scaleX*this._tweenProgress,r.scaleY=e.scaleY+i.scaleY*this._tweenProgress},e}(t.BoneTimelineState);t.BoneScaleTimelineState=a;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,i=this._armature._armatureData.scale,r=this._frameFloatArray;if(2===this._tweenState){var n=e+this._valueCount;this._frameIndex===this._frameCount-1&&(n=this._animationData.frameFloatOffset+this._frameValueOffset);for(var s=0;s<this._valueCount;++s)this._delta[s]=r[n+s]*i-(this._current[s]=r[e+s]*i)}else for(s=0;s<this._valueCount;++s)this._current[s]=r[e+s]*i}else for(s=0;s<this._valueCount;++s)this._current[s]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[n+1],this._valueCount=this._frameIntArray[n+2],this._valueOffset=this._frameIntArray[n+3],this._frameFloatOffset=this._frameIntArray[n+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var s=0;s<this._valueCount;++s)this._delta[s]=0},e.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,i=this.surface._deformVertices,r=0;r<this._deformCount;++r){var n;n=r<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+r]:r<this._valueOffset+this._valueCount?this._result[r-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+r-this._valueCount],2===t?i[r]+=n*e:i[r]=1!==e?n*e:n}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},e}(t.TweenTimelineState);t.SurfaceTimelineState=l;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayTimelineState=c;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return s(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,i=this._frameIntArray,r=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,n=i[r];n<0&&(n+=65536),this._current[0]=e[n++],this._current[1]=e[n++],this._current[2]=e[n++],this._current[3]=e[n++],this._current[4]=e[n++],this._current[5]=e[n++],this._current[6]=e[n++],this._current[7]=e[n++],2===this._tweenState&&((n=this._frameIndex===this._frameCount-1?i[this._animationData.frameIntOffset+this._frameValueOffset]:i[r+1])<0&&(n+=65536),this._delta[0]=e[n++]-this._current[0],this._delta[1]=e[n++]-this._current[1],this._delta[2]=e[n++]-this._current[2],this._delta[3]=e[n++]-this._current[3],this._delta[4]=e[n++]-this._current[4],this._delta[5]=e[n++]-this._current[5],this._delta[6]=e[n++]-this._current[6],this._delta[7]=e[n++]-this._current[7])}else{var s=this.slot._slotData.color;this._current[0]=100*s.alphaMultiplier,this._current[1]=100*s.redMultiplier,this._current[2]=100*s.greenMultiplier,this._current[3]=100*s.blueMultiplier,this._current[4]=s.alphaOffset,this._current[5]=s.redOffset,this._current[6]=s.greenOffset,this._current[7]=s.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var i=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7]){var r=Math.pow(this._animationState._fadeProgress,4);i.alphaMultiplier+=(this._result[0]-i.alphaMultiplier)*r,i.redMultiplier+=(this._result[1]-i.redMultiplier)*r,i.greenMultiplier+=(this._result[2]-i.greenMultiplier)*r,i.blueMultiplier+=(this._result[3]-i.blueMultiplier)*r,i.alphaOffset+=(this._result[4]-i.alphaOffset)*r,i.redOffset+=(this._result[5]-i.redOffset)*r,i.greenOffset+=(this._result[6]-i.greenOffset)*r,i.blueOffset+=(this._result[7]-i.blueOffset)*r,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,i.alphaMultiplier===this._result[0]&&i.redMultiplier===this._result[1]&&i.greenMultiplier===this._result[2]&&i.blueMultiplier===this._result[3]&&i.alphaOffset===this._result[4]&&i.redOffset===this._result[5]&&i.greenOffset===this._result[6]&&i.blueOffset===this._result[7]||(i.alphaMultiplier=this._result[0],i.redMultiplier=this._result[1],i.greenMultiplier=this._result[2],i.blueMultiplier=this._result[3],i.alphaOffset=this._result[4],i.redOffset=this._result[5],i.greenOffset=this._result[6],i.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=h;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return s(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,i=this._armature._armatureData.scale,r=this._frameFloatArray;if(2===this._tweenState){var n=e+this._valueCount;this._frameIndex===this._frameCount-1&&(n=this._animationData.frameFloatOffset+this._frameValueOffset);for(var s=0;s<this._valueCount;++s)this._delta[s]=r[n+s]*i-(this._current[s]=r[e+s]*i)}else for(s=0;s<this._valueCount;++s)this._current[s]=r[e+s]*i}else for(s=0;s<this._valueCount;++s)this._current[s]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.vertexOffset=this._frameIntArray[n+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[n+1],this._valueCount=this._frameIntArray[n+2],this._valueOffset=this._frameIntArray[n+3],this._frameFloatOffset=this._frameIntArray[n+4]+this._animationData.frameFloatOffset}else{var s=this.slot._deformVertices;this._deformCount=null!==s?s.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0}this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var o=0;o<this._valueCount;++o)this._delta[o]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){var i=this.slot._deformVertices;if(null!==i&&null!==i.verticesData&&i.verticesData.offset===this.vertexOffset&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var r=i.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var n=Math.pow(this._animationState._fadeProgress,2),s=0;s<this._deformCount;++s)s<this._valueOffset?r[s]+=(this._frameFloatArray[this._frameFloatOffset+s]-r[s])*n:s<this._valueOffset+this._valueCount?r[s]+=(this._result[s-this._valueOffset]-r[s])*n:r[s]+=(this._frameFloatArray[this._frameFloatOffset+s-this._valueCount]-r[s])*n;i.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,s=0;s<this._deformCount;++s)s<this._valueOffset?r[s]=this._frameFloatArray[this._frameFloatOffset+s]:s<this._valueOffset+this._valueCount?r[s]=this._result[s-this._valueOffset]:r[s]=this._frameFloatArray[this._frameFloatOffset+s-this._valueCount];i.verticesDirty=!0}}},e}(t.SlotTimelineState);t.DeformTimelineState=u;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._delta=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this.constraint;if(null!==this._timelineData){var i=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,r=this._frameIntArray,n=0!==r[i++];this._current=.01*r[i++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(i=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*r[i+1]-this._current):this._delta=0,e._bendPositive=n}else{var s=e._constraintData;this._current=s.weight,this._delta=0,e._bendPositive=s.bendPositive}e.invalidUpdate()},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var e=this.constraint;e._weight=this._current+this._delta*this._tweenProgress,e.invalidUpdate()},e}(t.ConstraintTimelineState);t.IKConstraintTimelineState=d;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._floats=[0,0,0,0,0,0],e}return s(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.animationState=null},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=1/this.animationState._animationData.parent.frameRate,r=this._frameIntArray;this._floats[0]=r[e++]*i,this._floats[3]=.01*r[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=r[e++]*i-this._floats[0],this._floats[4]=.01*r[e++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},e.prototype.blend=function(t){var e=this.animationState,i=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*i,e.currentTime+=this._floats[2]*i):(e.weight=this._floats[5]*i,e.currentTime=this._floats[2]*i)},e}(t.TweenTimelineState);t.AnimationTimelineState=p}(n||(n={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.actionDataToInstance=function(t,i,r){0===t.type?i.type=e.FRAME_EVENT:i.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,i.name=t.name,i.armature=r,i.actionData=t,i.data=t.data,null!==t.bone&&(i.bone=r.getBone(t.bone.name)),null!==t.slot&&(i.slot=r.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(n||(n={})),function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":default:return 0;case"movieclip":return 1}},e._getBoneType=function(t){switch(t.toLowerCase()){case"bone":default:return 0;case"surface":return 1}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":default:return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":default:return 0;case"ellipse":return 1;case"polygon":return 2}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":default:return 0;case"frame":return 10;case"sound":return 11}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":default:return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13}},e._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":default:return 1;case"fixed":return 0}},e._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":default:return 0;case"percent":return 2;case"fixed":return 1}},e._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":default:return 0;case"chain":return 1;case"chainscale":return 2}},e.parseDragonBonesData=function(e){return console.warn("Deprecated."),e instanceof ArrayBuffer?t.BinaryDataParser.getInstance().parseDragonBonesData(e):t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(i,r){void 0===r&&(r=1),console.warn("已废弃");for(var n={},s=i[e.SUB_TEXTURE],o=0,a=s.length;o<a;o++){var l=s[o],c=l[e.NAME],h=new t.Rectangle,u=null;h.x=l[e.X]/r,h.y=l[e.Y]/r,h.width=l[e.WIDTH]/r,h.height=l[e.HEIGHT]/r,e.FRAME_WIDTH in l&&((u=new t.Rectangle).x=l[e.FRAME_X]/r,u.y=l[e.FRAME_Y]/r,u.width=l[e.FRAME_WIDTH]/r,u.height=l[e.FRAME_HEIGHT]/r),n[c]={region:h,frame:u,rotated:!1}}return n},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION=e.DATA_VERSION_5_5,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.IK="ik",e.PATH_CONSTRAINT="path",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.CANVAS="canvas",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.GLUE_WEIGHTS="glueWeights",e.GLUE_MESHES="glueMeshes",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();t.DataParser=e}(n||(n={})),function(t){var e=function(e){function r(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._surface=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return s(r,e),r._getBoolean=function(t,e,i){if(e in t){var r=t[e],n=typeof r;if("boolean"===n)return r;if("string"!==n)return!!r;switch(r){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},r._getNumber=function(t,e,i){if(e in t){var r=t[e];return null===r||"NaN"===r?i:+r||0}return i},r._getString=function(e,i,r){if(i in e){var n=e[i];if("string"==typeof n){if(t.DragonBones.webAssembly)for(var s=0,o=n.length;s<o;++s)if(n.charCodeAt(s)>255)return encodeURI(n);return n}return String(n)}return r},r.prototype._getCurvePoint=function(t,e,i,r,n,s,o,a,l,c){var h=1-l,u=h*h,d=l*l,p=h*u,f=3*l*u,_=3*h*d,m=l*d;c.x=p*t+f*i+_*n+m*o,c.y=p*e+f*r+_*s+m*a},r.prototype._samplingEasingCurve=function(t,e){for(var i=t.length,r=-2,n=0,s=e.length;n<s;++n){for(var o=(n+1)/(s+1);(r+6<i?t[r+6]:1)<o;)r+=6;for(var a=r>=0&&r+6<i,l=a?t[r]:0,c=a?t[r+1]:0,h=t[r+2],u=t[r+3],d=t[r+4],p=t[r+5],f=a?t[r+6]:1,_=a?t[r+7]:1,m=0,g=1;g-m>1e-4;){var y=.5*(g+m);this._getCurvePoint(l,c,h,u,d,p,f,_,y,this._helpPoint),o-this._helpPoint.x>0?m=y:g=y}e[n]=this._helpPoint.y}},r.prototype._parseActionDataInFrame=function(e,i,r,n){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,r,n),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,r,n),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,r,n),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,r,n),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,r,n)},r.prototype._mergeActionFrame=function(e,r,n,s,o){for(var a=t.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,l=this._parseActionData(e,n,s,o),c=0,h=null,u=0,d=l;u<d.length;u++){var p=d[u];this._armature.addAction(p,!1)}0===this._actionFrames.length&&((h=new i).frameStart=0,this._actionFrames.push(h),h=null);for(var f=0,_=this._actionFrames;f<_.length;f++){var m=_[f];if(m.frameStart===r){h=m;break}if(m.frameStart>r)break;c++}null===h&&((h=new i).frameStart=r,this._actionFrames.splice(c+1,0,h));for(var g=0;g<l.length;++g)h.actions.push(a+g)},r.prototype._parseArmature=function(e,i){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.name=r._getString(e,t.DataParser.NAME,""),n.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),n.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?n.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):n.type=r._getNumber(e,t.DataParser.TYPE,0),0===n.frameRate&&(n.frameRate=24),this._armature=n,t.DataParser.CANVAS in e){var s=e[t.DataParser.CANVAS],o=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in s?o.hasBackground=!0:o.hasBackground=!1,o.color=r._getNumber(s,t.DataParser.COLOR,0),o.x=r._getNumber(s,t.DataParser.X,0)*n.scale,o.y=r._getNumber(s,t.DataParser.Y,0)*n.scale,o.width=r._getNumber(s,t.DataParser.WIDTH,0)*n.scale,o.height=r._getNumber(s,t.DataParser.HEIGHT,0)*n.scale,n.canvas=o}if(t.DataParser.AABB in e){var a=e[t.DataParser.AABB];n.aabb.x=r._getNumber(a,t.DataParser.X,0)*n.scale,n.aabb.y=r._getNumber(a,t.DataParser.Y,0)*n.scale,n.aabb.width=r._getNumber(a,t.DataParser.WIDTH,0)*n.scale,n.aabb.height=r._getNumber(a,t.DataParser.HEIGHT,0)*n.scale}if(t.DataParser.BONE in e)for(var l=0,c=e[t.DataParser.BONE];l<c.length;l++){var h=c[l],u=r._getString(h,t.DataParser.PARENT,""),d=this._parseBone(h);if(u.length>0){var p=n.getBone(u);null!==p?d.parent=p:(u in this._cacheBones||(this._cacheBones[u]=[]),this._cacheBones[u].push(d))}if(d.name in this._cacheBones){for(var f=0,_=this._cacheBones[d.name];f<_.length;f++)_[f].parent=d;delete this._cacheBones[d.name]}n.addBone(d),this._rawBones.push(d)}if(t.DataParser.IK in e)for(var m=0,g=e[t.DataParser.IK];m<g.length;m++){var y=g[m];(D=this._parseIKConstraint(y))&&n.addConstraint(D)}if(n.sortBones(),t.DataParser.SLOT in e)for(var v=0,b=0,x=e[t.DataParser.SLOT];b<x.length;b++){var T=x[b];n.addSlot(this._parseSlot(T,v++))}if(t.DataParser.SKIN in e)for(var C=0,S=e[t.DataParser.SKIN];C<S.length;C++){var w=S[C];n.addSkin(this._parseSkin(w))}if(t.DataParser.PATH_CONSTRAINT in e)for(var A=0,E=e[t.DataParser.PATH_CONSTRAINT];A<E.length;A++){var D,L=E[A];(D=this._parsePathConstraint(L))&&n.addConstraint(D)}for(var I=0,P=this._cacheRawMeshes.length;I<P;++I){var M=this._cacheRawMeshes[I];t.DataParser.GLUE_WEIGHTS in M&&t.DataParser.GLUE_MESHES in M&&this._parseMeshGlue(M,this._cacheMeshes[I])}for(I=0,P=this._cacheRawMeshes.length;I<P;++I){var R=this._cacheRawMeshes[I],O=r._getString(R,t.DataParser.SHARE,"");if(0!==O.length){var B=r._getString(R,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===B.length&&(B=t.DataParser.DEFAULT_NAME);var N=n.getMesh(B,"",O);null!==N&&this._cacheMeshes[I].vertices.shareFrom(N.vertices)}}if(t.DataParser.ANIMATION in e)for(var k=0,F=e[t.DataParser.ANIMATION];k<F.length;k++){var V=F[k],j=this._parseAnimation(V);n.addAnimation(j)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var G=0,U=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);G<U.length;G++){var Y=U[G];n.addAction(Y,!0),0===Y.type&&null!==(j=n.getAnimation(Y.name))&&(n.defaultAnimation=j)}if(t.DataParser.ACTIONS in e)for(var H=0,X=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);H<X.length;H++)Y=X[H],n.addAction(Y,!1);for(var z in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[z];for(var z in this._weightBonePoses)delete this._weightBonePoses[z];for(var z in this._cacheBones)delete this._cacheBones[z];for(var z in this._slotChildActions)delete this._slotChildActions[z];return n},r.prototype._parseBone=function(e){var i=this._armature.scale;if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,0))){var n=t.BaseObject.borrowObject(t.BoneData);return n.inheritTranslation=r._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),n.inheritRotation=r._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),n.inheritScale=r._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),n.inheritReflection=r._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),n.length=r._getNumber(e,t.DataParser.LENGTH,0)*i,n.name=r._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],n.transform,i),n}var s=t.BaseObject.borrowObject(t.SurfaceData);if(s.name=r._getString(e,t.DataParser.NAME,""),s.segmentX=r._getNumber(e,t.DataParser.SEGMENT_X,0),s.segmentY=r._getNumber(e,t.DataParser.SEGMENT_Y,0),s.vertices.length=(s.segmentX+1)*(s.segmentY+1)*2,t.DataParser.VERTICES in e)for(var o=e[t.DataParser.VERTICES],a=0,l=s.vertices.length;a<l;++a)a<o.length?s.vertices[a]=o[a]*i:s.vertices[a]=0;return s},r.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(r._getString(e,t.DataParser.BONE,""));if(null===i)return null;var n=this._armature.getBone(r._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var s=t.BaseObject.borrowObject(t.IKConstraintData);return s.scaleEnabled=r._getBoolean(e,t.DataParser.SCALE,!1),s.bendPositive=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),s.weight=r._getNumber(e,t.DataParser.WEIGHT,1),s.name=r._getString(e,t.DataParser.NAME,""),s.type=0,s.target=n,r._getNumber(e,t.DataParser.CHAIN,0)>0&&null!==i.parent?(s.root=i.parent,s.bone=i):(s.root=i,s.bone=null),s},r.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(r._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var n=this._armature.defaultSkin;if(null===n)return null;var s=n.getDisplay(i.name,r._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===s||!(s instanceof t.PathDisplayData))return null;var o=e[t.DataParser.BONES];if(null===o||0===o.length)return null;var a=t.BaseObject.borrowObject(t.PathConstraintData);a.name=r._getString(e,t.DataParser.NAME,""),a.type=1,a.pathSlot=i,a.pathDisplayData=s,a.target=i.parent,a.positionMode=t.DataParser._getPositionMode(r._getString(e,t.DataParser.POSITION_MODE,"")),a.spacingMode=t.DataParser._getSpacingMode(r._getString(e,t.DataParser.SPACING_MODE,"")),a.rotateMode=t.DataParser._getRotateMode(r._getString(e,t.DataParser.ROTATE_MODE,"")),a.position=r._getNumber(e,t.DataParser.POSITION,0),a.spacing=r._getNumber(e,t.DataParser.SPACING,0),a.rotateOffset=r._getNumber(e,t.DataParser.ROTATE_OFFSET,0),a.rotateMix=r._getNumber(e,t.DataParser.ROTATE_MIX,1),a.translateMix=r._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var l=0,c=o;l<c.length;l++){var h=c[l],u=this._armature.getBone(h);null!==u&&(a.AddBone(u),null===a.root&&(a.root=u))}return a},r.prototype._parseSlot=function(e,i){var n=t.BaseObject.borrowObject(t.SlotData);return n.displayIndex=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),n.zOrder=i,n.name=r._getString(e,t.DataParser.NAME,""),n.parent=this._armature.getBone(r._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?n.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):n.blendMode=r._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(n.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],n.color)):n.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[n.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),n},r.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var n=e[t.DataParser.SLOT];this._skin=i;for(var s=0,o=n;s<o.length;s++){var a=o[s],l=r._getString(a,t.DataParser.NAME,""),c=this._armature.getSlot(l);if(null!==c){if(this._slot=c,t.DataParser.DISPLAY in a)for(var h=0,u=a[t.DataParser.DISPLAY];h<u.length;h++){var d=u[h];d?i.addDisplay(l,this._parseDisplay(d)):i.addDisplay(l,null)}this._slot=null}}this._skin=null}return i},r.prototype._parseDisplay=function(e){var i=r._getString(e,t.DataParser.NAME,""),n=r._getString(e,t.DataParser.PATH,""),s=0,o=null;switch(s=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,s)){case 0:var a=o=t.BaseObject.borrowObject(t.ImageDisplayData);a.name=i,a.path=n.length>0?n:i,this._parsePivot(e,a);break;case 1:var l=o=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(l.name=i,l.path=n.length>0?n:i,l.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var c=0,h=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);c<h.length;c++){var u=h[c];l.addAction(u)}else if(this._slot.name in this._slotChildActions){var d=this._skin.getDisplays(this._slot.name);if(null===d?0===this._slot.displayIndex:this._slot.displayIndex===d.length){for(var p=0,f=this._slotChildActions[this._slot.name];p<f.length;p++)u=f[p],l.addAction(u);delete this._slotChildActions[this._slot.name]}}break;case 2:var _=o=t.BaseObject.borrowObject(t.MeshDisplayData);_.vertices.inheritDeform=r._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),_.name=i,_.path=n.length>0?n:i,_.vertices.data=this._data,t.DataParser.SHARE in e?(this._cacheRawMeshes.push(e),this._cacheMeshes.push(_)):this._parseMesh(e,_),t.DataParser.GLUE_WEIGHTS in e&&t.DataParser.GLUE_MESHES in e&&(this._cacheRawMeshes.push(e),this._cacheMeshes.push(_));break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var g=o=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);g.name=i,g.path=n.length>0?n:i,g.boundingBox=m}break;case 4:var y=e[t.DataParser.LENGTHS],v=o=t.BaseObject.borrowObject(t.PathDisplayData);v.closed=r._getBoolean(e,t.DataParser.CLOSED,!1),v.constantSpeed=r._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),v.name=i,v.path=n.length>0?n:i,v.vertices.data=this._data,v.curveLengths.length=y.length;for(var b=0,x=y.length;b<x;++b)v.curveLengths[b]=y[b];this._parsePath(e,v)}return null!==o&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],o.transform,this._armature.scale),o},r.prototype._parsePath=function(e,i){var n=e[t.DataParser.VERTICES],s=r._getNumber(e,t.DataParser.VERTEX_COUNT,0),o=this._floatArray.length,a=this._intArray.length;if(i.vertices.offset=a,this._intArray.length+=2,this._intArray[a+0]=s,this._intArray[a+2]=o,t.DataParser.WEIGHTS in e){var l=e[t.DataParser.WEIGHTS],c=e[t.DataParser.BONES],h=c.length,u=Math.floor(l.length-s)/2,d=this._intArray.length,p=this._floatArray.length,f=this._armature.sortedBones,_=t.BaseObject.borrowObject(t.WeightData);for(_.count=u,_.offset=d,this._intArray.length+=2+h+s+u,this._intArray[d+0]=h,this._intArray[d+1]=p,D=0;D<h;D++){var m=c[D],g=this._rawBones[m];_.addBone(g),this._intArray[d+2+D]=f.indexOf(g)}this._floatArray.length+=3*u,D=0;for(var y=0,v=0,b=d+2+h,x=p;D<u;D++){var T=l[y++];this._intArray[b++]=T;for(var C=0;C<T;C++){var S=l[y++],w=l[y++],A=n[v++],E=n[v++];this._intArray[b++]=c.indexOf(S),this._floatArray[x++]=w,this._floatArray[x++]=A,this._floatArray[x++]=E}}i.vertices.weight=_}else{this._floatArray.length+=n.length;for(var D=0,L=n.length;D<L;++D)this._floatArray[o+D]=n[D]}},r.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var n=e[t.DataParser.PIVOT];i.pivot.x=r._getNumber(n,t.DataParser.X,0),i.pivot.y=r._getNumber(n,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},r.prototype._parseMesh=function(e,i){var r=e[t.DataParser.VERTICES],n=e[t.DataParser.UVS],s=e[t.DataParser.TRIANGLES],o=Math.floor(r.length/2),a=Math.floor(s.length/3),l=this._floatArray.length,c=l+2*o,h=this._intArray.length,u=this._skin.name+"_"+this._slot.name+"_"+i.name;i.vertices.offset=h,this._intArray.length+=4+3*a,this._intArray[h+0]=o,this._intArray[h+1]=a,this._intArray[h+2]=l;for(var d=0,p=3*a;d<p;++d)this._intArray[h+4+d]=s[d];for(this._floatArray.length+=2*o+2*o,d=0,p=2*o;d<p;++d)this._floatArray[l+d]=r[d],this._floatArray[c+d]=n[d];if(t.DataParser.WEIGHTS in e){var f=e[t.DataParser.WEIGHTS],_=e[t.DataParser.SLOT_POSE],m=e[t.DataParser.BONE_POSE],g=this._armature.sortedBones,y=new Array,v=Math.floor(m.length/7),b=this._floatArray.length,x=Math.floor(f.length-o)/2,T=this._intArray.length,C=t.BaseObject.borrowObject(t.WeightData);for(C.count=x,C.offset=T,y.length=v,this._intArray.length+=2+v+o+x,this._intArray[T+1]=b,d=0;d<v;++d){var S=m[7*d],w=this._rawBones[S];C.addBone(w),y[d]=S,this._intArray[T+2+d]=g.indexOf(w)}this._floatArray.length+=3*x,this._helpMatrixA.copyFromArray(_,0),d=0;for(var A=0,E=T+2+v,D=b;d<o;++d){var L=2*d,I=this._intArray[E++]=f[A++],P=this._floatArray[l+L],M=this._floatArray[l+L+1];this._helpMatrixA.transformPoint(P,M,this._helpPoint),P=this._helpPoint.x,M=this._helpPoint.y;for(var R=0;R<I;++R){S=f[A++];var O=y.indexOf(S);this._helpMatrixB.copyFromArray(m,7*O+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(P,M,this._helpPoint),this._intArray[E++]=O,this._floatArray[D++]=f[A++],this._floatArray[D++]=this._helpPoint.x,this._floatArray[D++]=this._helpPoint.y}}i.vertices.weight=C,this._weightSlotPose[u]=_,this._weightBonePoses[u]=m}},r.prototype._parseMeshGlue=function(){},r.prototype._parseBoundingBox=function(e){var i=null,n=0;switch(n=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):r._getNumber(e,t.DataParser.SUB_TYPE,n)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=r._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0))),i},r.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var r=this._armature.scale,n=e[t.DataParser.VERTICES],s=i.vertices;t.DragonBones.webAssembly?s.resize(n.length,0):s.length=n.length;for(var o=0,a=n.length;o<a;o+=2){var l=n[o]*r,c=n[o+1]*r;t.DragonBones.webAssembly?(s.set(o,l),s.set(o+1,c)):(s[o]=l,s[o+1]=c),0===o?(i.x=l,i.y=c,i.width=l,i.height=c):(l<i.x?i.x=l:l>i.width&&(i.width=l),c<i.y?i.y=c:c>i.height&&(i.height=c))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},r.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.frameCount=Math.max(r._getNumber(e,t.DataParser.DURATION,1),1),i.playTimes=r._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=r._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=r._getNumber(e,t.DataParser.SCALE,1),i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var n=e[t.DataParser.FRAME],s=n.length;if(s>0)for(var o=0,a=0;o<s;++o){var l=n[o];this._parseActionDataInFrame(l,a,null,null),a+=r._getNumber(l,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var c=0,h=e[t.DataParser.BONE];c<h.length;c++){var u=h[c];this._parseBoneTimeline(u)}if(t.DataParser.SURFACE in e)for(var d=0,p=e[t.DataParser.SURFACE];d<p.length;d++){u=p[d];var f=r._getString(u,t.DataParser.NAME,"");this._surface=this._armature.getBone(f),null!==this._surface&&(null!==(D=this._parseTimeline(u,null,t.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,D),this._surface=null)}if(t.DataParser.SLOT in e){for(var _=0,m=e[t.DataParser.SLOT];_<m.length;_++)u=m[_],this._parseSlotTimeline(u);this._actionFrames.sort((function(t,e){return t.frameStart-e.frameStart}))}if(t.DataParser.FFD in e)for(var g=0,y=e[t.DataParser.FFD];g<y.length;g++){u=y[g];var v=r._getString(u,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),b=r._getString(u,t.DataParser.SLOT,""),x=r._getString(u,t.DataParser.NAME,"");0===v.length&&(v=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(b),this._mesh=this._armature.getMesh(v,b,x),null!==this._slot&&null!==this._mesh&&(null!==(D=this._parseTimeline(u,null,t.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,D),this._slot=null,this._mesh=null)}if(t.DataParser.IK in e)for(var T=0,C=e[t.DataParser.IK];T<C.length;T++){u=C[T];var S=r._getString(u,t.DataParser.NAME,""),w=this._armature.getConstraint(S);null!==w&&null!==(D=this._parseTimeline(u,null,t.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(w,D)}if(t.DataParser.ANIMATION in e)for(var A=0,E=e[t.DataParser.ANIMATION];A<E.length;A++){u=E[A];var D,L=r._getString(u,t.DataParser.NAME,"");null!==(D=this._parseTimeline(u,null,t.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(L,D)}return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,i},r.prototype._parseTimeline=function(e,n,s,o,a,l,c,h){if(null!==e&&s.length>0&&s in e&&(n=e[s]),null===n)return null;var u=n.length;if(0===u)return null;var d=this._frameIntArray.length,p=this._frameFloatArray.length,f=t.BaseObject.borrowObject(t.TimelineData),_=this._timelineArray.length;if(this._timelineArray.length+=5+u,null!==e?(this._timelineArray[_+0]=Math.round(100*r._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[_+1]=Math.round(100*r._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[_+0]=100,this._timelineArray[_+1]=0),this._timelineArray[_+2]=u,this._timelineArray[_+3]=c,this._timelineArray[_+4]=a?d-this._animation.frameIntOffset:l?p-this._animation.frameFloatOffset:0,this._timeline=f,f.type=o,f.offset=_,1===u)f.frameIndicesOffset=-1,this._timelineArray[_+5+0]=h.call(this,n[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,g=this._data.frameIndices,y=0;t.DragonBones.webAssembly?(y=g.size(),g.resize(y+m,0)):(y=g.length,g.length+=m),f.frameIndicesOffset=y;for(var v=0,b=0,x=0,T=0;v<m;++v){if(x+T<=v&&b<u){var C=n[b];x=v,T=b===u-1?this._animation.frameCount-x:C instanceof i?this._actionFrames[b+1].frameStart-x:r._getNumber(C,t.DataParser.DURATION,1),this._timelineArray[_+5+b]=h.call(this,C,x,T)-this._animation.frameOffset,b++}t.DragonBones.webAssembly?g.set(y+v,b-1):g[y+v]=b-1}}return this._timeline=null,f},r.prototype._parseBoneTimeline=function(e){var i,n=this._armature.getBone(r._getString(e,t.DataParser.NAME,""));null!==n&&(this._bone=n,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(n,i),t.DataParser.ROTATE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(n,i),t.DataParser.SCALE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(n,i),t.DataParser.FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(n,i),this._bone=null,this._slot=null)},r.prototype._parseSlotTimeline=function(e){var i,n,s=this._armature.getSlot(r._getString(e,t.DataParser.NAME,""));null!==s&&(this._slot=s,null!==(i=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(s,i),null!==(n=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(s,n),this._slot=null)},r.prototype._parseFrame=function(t,e){var i=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[i+0]=e,i},r.prototype._parseTweenFrame=function(e,i,n){var s=this._parseFrame(e,i,n);if(n>0)if(t.DataParser.CURVE in e){var o=n+1;this._helpArray.length=o,this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[s+1]=2,this._frameArray[s+2]=o;for(var a=0;a<o;++a)this._frameArray[s+3+a]=Math.round(1e4*this._helpArray[a])}else{var l=-2;t.DataParser.TWEEN_EASING in e&&(l=r._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===l?(this._frameArray.length+=1,this._frameArray[s+1]=0):0===l?(this._frameArray.length+=1,this._frameArray[s+1]=1):l<0?(this._frameArray.length+=2,this._frameArray[s+1]=3,this._frameArray[s+2]=Math.round(100*-l)):l<=1?(this._frameArray.length+=2,this._frameArray[s+1]=4,this._frameArray[s+2]=Math.round(100*l)):(this._frameArray.length+=2,this._frameArray[s+1]=5,this._frameArray[s+2]=Math.round(100*l-100))}else this._frameArray.length+=1,this._frameArray[s+1]=0;return s},r.prototype._parseActionFrame=function(t,e){var i=this._frameArray.length,r=t.actions.length;this._frameArray.length+=2+r,this._frameArray[i+0]=e,this._frameArray[i+0+1]=r;for(var n=0;n<r;++n)this._frameArray[i+0+2+n]=t.actions[n];return i},r.prototype._parseZOrderFrame=function(e,i,r){var n=this._parseFrame(e,i,r);if(t.DataParser.Z_ORDER in e){var s=e[t.DataParser.Z_ORDER];if(s.length>0){for(var o=this._armature.sortedSlots.length,a=new Array(o-s.length/2),l=new Array(o),c=0;c<a.length;++c)a[c]=0;for(var h=0;h<o;++h)l[h]=-1;for(var u=0,d=0,p=0,f=s.length;p<f;p+=2){for(var _=s[p],m=s[p+1];u!==_;)a[d++]=u++;l[u+m]=u++}for(;u<o;)a[d++]=u++;this._frameArray.length+=1+o,this._frameArray[n+1]=o;for(var g=o;g--;)-1===l[g]?this._frameArray[n+2+g]=a[--d]||0:this._frameArray[n+2+g]=l[g]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},r.prototype._parseBoneAllFrame=function(e,i,n){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var s=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?s=this._prevRotation+t.Transform.normalizeRadian(s-this._prevRotation):((this._prevClockwise>0?s>=this._prevRotation:s<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),s=this._prevRotation+s-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=s;var o=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[a++]=this._helpTransform.x,this._frameFloatArray[a++]=this._helpTransform.y,this._frameFloatArray[a++]=s,this._frameFloatArray[a++]=this._helpTransform.skew,this._frameFloatArray[a++]=this._helpTransform.scaleX,this._frameFloatArray[a++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),o},r.prototype._parseBoneTranslateFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.X,0),this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.Y,0),s},r.prototype._parseBoneRotateFrame=function(e,i,n){var s=r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?s=this._prevRotation+t.Transform.normalizeRadian(s-this._prevRotation):((this._prevClockwise>0?s>=this._prevRotation:s<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),s=this._prevRotation+s-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=s;var o=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=s,this._frameFloatArray[a++]=r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,o},r.prototype._parseBoneScaleFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.X,1),this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.Y,1),s},r.prototype._parseSurfaceFrame=function(e,i,n){var s=this._frameFloatArray.length,o=this._parseTweenFrame(e,i,n),a=e[t.DataParser.VERTICES],l=r._getNumber(e,t.DataParser.OFFSET,0),c=this._surface.vertices.length/2,h=0,u=0;this._frameFloatArray.length+=2*c;for(var d=0;d<2*c;d+=2)h=d<l||d-l>=a.length?0:a[d-l],u=d+1<l||d+1-l>=a.length?0:a[d+1-l],this._frameFloatArray[s+d]=h,this._frameFloatArray[s+d+1]=u;if(0===i){var p=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[p+0]=0,this._frameIntArray[p+1]=this._frameFloatArray.length-s,this._frameIntArray[p+2]=this._frameFloatArray.length-s,this._frameIntArray[p+3]=0,this._frameIntArray[p+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=p-this._animation.frameIntOffset}return o},r.prototype._parseSlotDisplayFrame=function(e,i,n){var s=this._parseFrame(e,i,n);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[s+1]=r._getNumber(e,t.DataParser.VALUE,0):this._frameArray[s+1]=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),s},r.prototype._parseSlotColorFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),s=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var o=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var a in o){this._parseColorTransform(o,this._helpColorTransform),s=this._intArray.length,this._intArray.length+=8,this._intArray[s++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[s++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[s++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[s++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[s++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[s++]=Math.round(this._helpColorTransform.redOffset),this._intArray[s++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[s++]=Math.round(this._helpColorTransform.blueOffset),s-=8;break}}s<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=s=this._intArray.length,this._intArray.length+=8,this._intArray[s++]=100,this._intArray[s++]=100,this._intArray[s++]=100,this._intArray[s++]=100,this._intArray[s++]=0,this._intArray[s++]=0,this._intArray[s++]=0,this._intArray[s++]=0),s=this._defaultColorOffset);var l=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[l]=s,n},r.prototype._parseSlotFFDFrame=function(e,i,n){var s=this._frameFloatArray.length,o=this._parseTweenFrame(e,i,n),a=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,l=r._getNumber(e,t.DataParser.OFFSET,0),c=this._intArray[this._mesh.vertices.offset+0],h=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,u=this._mesh.vertices.weight,d=0,p=0,f=0,_=0;if(null!==u){var m=this._weightSlotPose[h];this._helpMatrixA.copyFromArray(m,0),this._frameFloatArray.length+=2*u.count,f=u.offset+2+u.bones.length}else this._frameFloatArray.length+=2*c;for(var g=0;g<2*c;g+=2)if(null===a?(d=0,p=0):(d=g<l||g-l>=a.length?0:a[g-l],p=g+1<l||g+1-l>=a.length?0:a[g+1-l]),null!==u){var y=this._weightBonePoses[h],v=this._intArray[f++];this._helpMatrixA.transformPoint(d,p,this._helpPoint,!0),d=this._helpPoint.x,p=this._helpPoint.y;for(var b=0;b<v;++b){var x=this._intArray[f++];this._helpMatrixB.copyFromArray(y,7*x+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(d,p,this._helpPoint,!0),this._frameFloatArray[s+_++]=this._helpPoint.x,this._frameFloatArray[s+_++]=this._helpPoint.y}}else this._frameFloatArray[s+g]=d,this._frameFloatArray[s+g+1]=p;if(0===i){var T=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[T+0]=this._mesh.vertices.offset,this._frameIntArray[T+1]=this._frameFloatArray.length-s,this._frameIntArray[T+2]=this._frameFloatArray.length-s,this._frameIntArray[T+3]=0,this._frameIntArray[T+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=T-this._animation.frameIntOffset}return o},r.prototype._parseIKConstraintFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[o++]=Math.round(100*r._getNumber(e,t.DataParser.WEIGHT,1)),s},r.prototype._parseAnimationFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=r._getNumber(e,t.DataParser.VALUE,0),this._frameIntArray[o++]=Math.round(100*r._getNumber(e,t.DataParser.WEIGHT,1)),s},r.prototype._parseActionData=function(e,i,n,s){var o=new Array;if("string"==typeof e)(h=t.BaseObject.borrowObject(t.ActionData)).type=i,h.name=e,h.bone=n,h.slot=s,o.push(h);else if(e instanceof Array)for(var a=0,l=e;a<l.length;a++){var c=l[a],h=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in c?(h.type=0,h.name=r._getString(c,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in c&&"string"==typeof c[t.DataParser.TYPE]?h.type=t.DataParser._getActionType(c[t.DataParser.TYPE]):h.type=r._getNumber(c,t.DataParser.TYPE,i),h.name=r._getString(c,t.DataParser.NAME,"")),t.DataParser.BONE in c){var u=r._getString(c,t.DataParser.BONE,"");h.bone=this._armature.getBone(u)}else h.bone=n;if(t.DataParser.SLOT in c){var d=r._getString(c,t.DataParser.SLOT,"");h.slot=this._armature.getSlot(d)}else h.slot=s;var p=null;if(t.DataParser.INTS in c){null===p&&(p=t.BaseObject.borrowObject(t.UserData));for(var f=0,_=c[t.DataParser.INTS];f<_.length;f++){var m=_[f];p.addInt(m)}}if(t.DataParser.FLOATS in c){null===p&&(p=t.BaseObject.borrowObject(t.UserData));for(var g=0,y=c[t.DataParser.FLOATS];g<y.length;g++)m=y[g],p.addFloat(m)}if(t.DataParser.STRINGS in c){null===p&&(p=t.BaseObject.borrowObject(t.UserData));for(var v=0,b=c[t.DataParser.STRINGS];v<b.length;v++)m=b[v],p.addString(m)}h.data=p,o.push(h)}return o},r.prototype._parseTransform=function(e,i,n){i.x=r._getNumber(e,t.DataParser.X,0)*n,i.y=r._getNumber(e,t.DataParser.Y,0)*n,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=r._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=r._getNumber(e,t.DataParser.SCALE_Y,1)},r.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*r._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*r._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*r._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*r._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=r._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=r._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=r._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=r._getNumber(e,t.DataParser.BLUE_OFFSET,0)},r.prototype._parseArray=function(){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},r.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,i=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,r=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,s=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,a=e+i+r+n+s+o;if(t.DragonBones.webAssembly){for(var l=t.webAssemblyModule.HEAP16.buffer,c=t.webAssemblyModule._malloc(a),h=new Int16Array(l,c,this._intArray.length),u=new Float32Array(l,c+e,this._floatArray.length),d=new Int16Array(l,c+e+i,this._frameIntArray.length),p=new Float32Array(l,c+e+i+r,this._frameFloatArray.length),f=new Int16Array(l,c+e+i+r+n,this._frameArray.length),_=new Uint16Array(l,c+e+i+r+n+s,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)h[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)u[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)d[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)p[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)f[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)_[m]=this._timelineArray[m];t.webAssemblyModule.setDataBinary(this._data,c,e,i,r,n,s,o)}else{var y=new ArrayBuffer(a);for(h=new Int16Array(y,0,this._intArray.length),u=new Float32Array(y,e,this._floatArray.length),d=new Int16Array(y,e+i,this._frameIntArray.length),p=new Float32Array(y,e+i+r,this._frameFloatArray.length),f=new Int16Array(y,e+i+r+n,this._frameArray.length),_=new Uint16Array(y,e+i+r+n+s,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)h[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)u[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)d[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)p[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)f[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)_[m]=this._timelineArray[m];this._data.binary=y,this._data.intArray=h,this._data.floatArray=u,this._data.frameIntArray=d,this._data.frameFloatArray=p,this._data.frameArray=f,this._data.timelineArray=_}this._defaultColorOffset=-1},r.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var n=r._getString(e,t.DataParser.VERSION,""),s=r._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(n)>=0||t.DataParser.DATA_VERSIONS.indexOf(s)>=0){var o=t.BaseObject.borrowObject(t.DragonBonesData);if(o.version=n,o.name=r._getString(e,t.DataParser.NAME,""),o.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),t.DataParser.ARMATURE in e){this._data=o,this._parseArray(e);for(var a=0,l=e[t.DataParser.ARMATURE];a<l.length;a++){var c=l[a];o.addArmature(this._parseArmature(c,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?o.stage=o.getArmature(r._getString(e,t.DataParser.STAGE,"")):o.armatureNames.length>0&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+n+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},r.prototype.parseTextureAtlasData=function(e,i,n){if(void 0===n&&(n=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var s=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(s,i,n),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===n?1/r._getNumber(e,t.DataParser.SCALE,1):n,i.name=r._getString(e,t.DataParser.NAME,""),i.imagePath=r._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var o=e[t.DataParser.SUB_TEXTURE],a=0,l=o.length;a<l;++a){var c=o[a],h=i.createTexture();h.rotated=r._getBoolean(c,t.DataParser.ROTATED,!1),h.name=r._getString(c,t.DataParser.NAME,""),h.region.x=r._getNumber(c,t.DataParser.X,0),h.region.y=r._getNumber(c,t.DataParser.Y,0),h.region.width=r._getNumber(c,t.DataParser.WIDTH,0),h.region.height=r._getNumber(c,t.DataParser.HEIGHT,0);var u=r._getNumber(c,t.DataParser.FRAME_WIDTH,-1),d=r._getNumber(c,t.DataParser.FRAME_HEIGHT,-1);u>0&&d>0&&(h.frame=t.TextureData.createRectangle(),h.frame.x=r._getNumber(c,t.DataParser.FRAME_X,0),h.frame.y=r._getNumber(c,t.DataParser.FRAME_Y,0),h.frame.width=u,h.frame.height=d),i.addTexture(h)}return!0},r.getInstance=function(){return null===r._objectDataParserInstance&&(r._objectDataParserInstance=new r),r._objectDataParserInstance},r._objectDataParserInstance=null,r}(t.DataParser);t.ObjectDataParser=e;var i=function(){this.frameStart=0,this.actions=[]};t.ActionFrame=i}(n||(n={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return s(i,e),i.prototype._inRange=function(t,e,i){return e<=t&&t<=i},i.prototype._decodeUTF8=function(t){for(var e,i=0,r="",n=0,s=0,o=0,a=0;t.length>i;){var l=t[i++];if(-1===l)e=0!==s?65533:-1;else if(0===s)this._inRange(l,0,127)?e=l:(this._inRange(l,194,223)?(s=1,a=128,n=l-192):this._inRange(l,224,239)?(s=2,a=2048,n=l-224):this._inRange(l,240,244)&&(s=3,a=65536,n=l-240),n*=Math.pow(64,s),e=null);else if(this._inRange(l,128,191))if(o+=1,n+=(l-128)*Math.pow(64,s-o),o!==s)e=null;else{var c=n,h=a;n=0,s=0,o=0,a=0,e=this._inRange(c,h,1114111)&&!this._inRange(c,55296,57343)?c:l}else n=0,s=0,o=0,a=0,i--,e=l;null!==e&&-1!==e&&(e<=65535?e>0&&(r+=String.fromCharCode(e)):(e-=65536,r+=String.fromCharCode(55296+(e>>10&1023)),r+=String.fromCharCode(56320+(1023&e))))}return r},i.prototype._getUTF16Key=function(t){for(var e=0,i=t.length;e<i;++e)if(t.charCodeAt(e)>255)return encodeURI(t);return t},i.prototype._parseBinaryTimeline=function(e,i,r){void 0===r&&(r=null);var n=null!==r?r:t.BaseObject.borrowObject(t.TimelineData);n.type=e,n.offset=i,this._timeline=n;var s=this._timelineArrayBuffer[n.offset+2];if(1===s)n.frameIndicesOffset=-1;else{var o=0,a=this._animation.frameCount+1,l=this._data.frameIndices;t.DragonBones.webAssembly?(o=l.size(),l.resize(o+a,0)):(o=l.length,l.length+=a),n.frameIndicesOffset=o;for(var c=0,h=0,u=0,d=0;c<a;++c)u+d<=c&&h<s&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+h]],d=h===s-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+h+1]]-u,h++),t.DragonBones.webAssembly?l.set(o+c,h-1):l[o+c]=h-1}return this._timeline=null,n},i.prototype._parseVertices=function(e,i){i.offset=e[t.DataParser.OFFSET];var r=this._intArrayBuffer[i.offset+3];if(r>=0){var n=t.BaseObject.borrowObject(t.WeightData),s=this._intArrayBuffer[i.offset+0],o=this._intArrayBuffer[r+0];n.offset=r;for(var a=0;a<o;++a){var l=this._intArrayBuffer[r+2+a];n.addBone(this._rawBones[l])}for(var c=r+2+o,h=0,u=(a=0,s);a<u;++a){var d=this._intArrayBuffer[c++];h+=d,c+=d}n.count=h,i.weight=n}},i.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},i.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},i.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,1),1),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var r=e[t.DataParser.OFFSET];if(i.frameIntOffset=r[0],i.frameFloatOffset=r[1],i.frameOffset=r[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var n=e[t.DataParser.BONE];for(var s in n){var o=n[s];t.DragonBones.webAssembly&&(s=this._getUTF16Key(s));var a=this._armature.getBone(s);if(null!==a)for(var l=0,c=o.length;l<c;l+=2){var h=o[l],u=o[l+1],d=this._parseBinaryTimeline(h,u);this._animation.addBoneTimeline(a,d)}}}if(t.DataParser.SURFACE in e)for(var s in n=e[t.DataParser.SURFACE]){o=n[s],t.DragonBones.webAssembly&&(s=this._getUTF16Key(s));var p=this._armature.getBone(s);if(null!==p)for(l=0,c=o.length;l<c;l+=2)h=o[l],u=o[l+1],d=this._parseBinaryTimeline(h,u),this._animation.addSurfaceTimeline(p,d)}if(t.DataParser.SLOT in e)for(var s in n=e[t.DataParser.SLOT]){o=n[s],t.DragonBones.webAssembly&&(s=this._getUTF16Key(s));var f=this._armature.getSlot(s);if(null!==f)for(l=0,c=o.length;l<c;l+=2)h=o[l],u=o[l+1],d=this._parseBinaryTimeline(h,u),this._animation.addSlotTimeline(f,d)}if(t.DataParser.CONSTRAINT in e)for(var s in n=e[t.DataParser.CONSTRAINT]){o=n[s],t.DragonBones.webAssembly&&(s=this._getUTF16Key(s));var _=this._armature.getConstraint(s);if(null!==_)for(l=0,c=o.length;l<c;l+=2)h=o[l],u=o[l+1],d=this._parseBinaryTimeline(h,u),this._animation.addConstraintTimeline(_,d)}if(t.DataParser.ANIMATION in e)for(var s in n=e[t.DataParser.ANIMATION])for(o=n[s],t.DragonBones.webAssembly&&(s=this._getUTF16Key(s)),l=0,c=o.length;l<c;l+=2)h=o[l],u=o[l+1],d=this._parseBinaryTimeline(h,u),this._animation.addAnimationTimeline(s,d);return this._animation=null,i},i.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],r=i[1],n=i[3],s=i[5],o=i[7],a=i[9],l=i[11],c=new Int16Array(this._binary,this._binaryOffset+i[0],r/Int16Array.BYTES_PER_ELEMENT),h=new Float32Array(this._binary,this._binaryOffset+i[2],n/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+i[4],s/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[6],o/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+i[8],a/Int16Array.BYTES_PER_ELEMENT),f=new Uint16Array(this._binary,this._binaryOffset+i[10],l/Uint16Array.BYTES_PER_ELEMENT);if(t.DragonBones.webAssembly){for(var _=r+n+s+o+a+l,m=t.webAssemblyModule._malloc(_),g=new Uint8Array(this._binary,this._binaryOffset,_/Uint8Array.BYTES_PER_ELEMENT),y=new Uint8Array(t.webAssemblyModule.HEAP16.buffer,m,g.length),v=0,b=g.length;v<b;++v)y[v]=g[v];t.webAssemblyModule.setDataBinary(this._data,m,r,n,s,o,a,l),this._intArrayBuffer=c,this._floatArrayBuffer=h,this._frameIntArrayBuffer=u,this._frameFloatArrayBuffer=d,this._frameArrayBuffer=p,this._timelineArrayBuffer=f}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=c,this._data.floatArray=this._floatArrayBuffer=h,this._data.frameIntArray=this._frameIntArrayBuffer=u,this._data.frameFloatArray=this._frameFloatArrayBuffer=d,this._data.frameArray=this._frameArrayBuffer=p,this._data.timelineArray=this._timelineArrayBuffer=f},i.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var r=new Uint8Array(t,0,8);if(r[0]!=="D".charCodeAt(0)||r[1]!=="B".charCodeAt(0)||r[2]!=="D".charCodeAt(0)||r[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var n=new Uint32Array(t,8,1)[0],s=new Uint8Array(t,12,n),o=this._decodeUTF8(s),a=JSON.parse(o);return this._binaryOffset=12+n,this._binary=t,e.prototype.parseDragonBonesData.call(this,a,i)},i.getInstance=function(){return null===i._binaryDataParserInstance&&(i._binaryDataParserInstance=new i),i._binaryDataParserInstance},i._binaryDataParserInstance=null,i}(t.ObjectDataParser);t.BinaryDataParser=e}(n||(n={})),function(t){var e=function(){function e(i){void 0===i&&(i=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==i?i:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,r=this._textureAtlasDataMap[t];i<r.length;i++)if(null!==(l=(a=r[i]).getTexture(e)))return l;if(this.autoSearch)for(var n in this._textureAtlasDataMap)for(var s=0,o=this._textureAtlasDataMap[n];s<o.length;s++){var a,l;if((a=o[s]).autoSearch&&null!==(l=a.getTexture(e)))return l}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,r,n){var s=null,o=null;if(e.length>0&&e in this._dragonBonesDataMap&&(o=(s=this._dragonBonesDataMap[e]).getArmature(i)),null===o&&(0===e.length||this.autoSearch))for(var a in this._dragonBonesDataMap)if(s=this._dragonBonesDataMap[a],(0===e.length||s.autoSearch)&&null!==(o=s.getArmature(i))){e=a;break}if(null!==o){if(t.dataName=e,t.textureAtlasName=n,t.data=s,t.armature=o,t.skin=null,r.length>0&&(t.skin=o.getSkin(r),null===t.skin&&this.autoSearch))for(var a in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[a].getArmature(r);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,i){for(var r=0,n=e.armature.sortedBones;r<n.length;r++){var s=n[r];t.BaseObject.borrowObject(0===s.type?t.Bone:t.Surface).init(s,i)}},e.prototype._buildSlots=function(e,i){var r=e.skin,n=e.armature.defaultSkin;if(null!==r&&null!==n){var s={};for(var o in n.displays){var a=n.getDisplays(o);s[o]=a}if(r!==n)for(var o in r.displays)a=r.getDisplays(o),s[o]=a;for(var l=0,c=e.armature.sortedSlots;l<c.length;l++){var h=c[l],u=h.name in s?s[h.name]:null,d=this._buildSlot(e,h,i);if(d.rawDisplayDatas=u,null!==u){for(var p=new Array,f=0,_=t.DragonBones.webAssembly?u.size():u.length;f<_;++f){var m=t.DragonBones.webAssembly?u.get(f):u[f];null!==m?p.push(this._getSlotDisplay(e,m,null,d)):p.push(null)}d._setDisplayList(p)}d._setDisplayIndex(h.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,i){var r=e.armature.constraints;for(var n in r){var s=r[n];switch(s.type){case 0:var o=t.BaseObject.borrowObject(t.IKConstraint);o.init(s,i),i._addConstraint(o);break;case 1:var a=t.BaseObject.borrowObject(t.PathConstraint);a.init(s,i),i._addConstraint(a);break;default:var l=t.BaseObject.borrowObject(t.IKConstraint);l.init(s,i),i._addConstraint(l)}}},e.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,i,r,n){var s=null!==e?e.dataName:i.parent.parent.parent.name,o=null;switch(i.type){case 0:var a=i;null!==e&&e.textureAtlasName.length>0&&(a.texture=this._getTextureData(e.textureAtlasName,i.path)),null===a.texture&&(a.texture=this._getTextureData(s,i.path)),o=null!==r&&2===r.type&&this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 2:var l=i;null!==e&&e.textureAtlasName.length>0&&(l.texture=this._getTextureData(e.textureAtlasName,l.path)),null===l.texture&&(l.texture=this._getTextureData(s,l.path)),o=this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 1:var c=i,h=this._buildChildArmature(e,n,i);if(null!==h){if(h.inheritAnimation=c.inheritAnimation,!h.inheritAnimation){var u=c.actions.length>0?c.actions:h.armatureData.defaultActions;if(u.length>0)for(var d=0,p=u;d<p.length;d++){var f=p[d],_=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(f,_,n.armature),_.slot=n,n.armature._bufferAction(_,!1)}else h.animation.play()}c.armature=h.armatureData}o=h}return o},e.prototype.parseDragonBonesData=function(t,i,r){void 0===i&&(i=null),void 0===r&&(r=1);for(var n=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,s=n.parseDragonBonesData(t,r);;){var o=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,o,r)){o.returnToPool();break}this.addTextureAtlasData(o,i)}return null!==s&&this.addDragonBonesData(s,i),s},e.prototype.parseTextureAtlasData=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=1);var n=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,n,r),this._buildTextureAtlasData(n,e||null),this.addTextureAtlasData(n,i),n},e.prototype.updateTextureAtlasData=function(t,e){var i=this.getTextureAtlasData(t);if(null!==i)for(var r=0,n=i.length;r<n;++r)r<e.length&&this._buildTextureAtlasData(i[r],e[r])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var r=0,n=i;r<n.length;r++){var s=n[r];this._dragonBones.bufferObject(s)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var r=new i;return this._fillBuildArmaturePackage(r,e,t,"","")?r.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,r=this._textureAtlasDataMap[e];i<r.length;i++){var n=r[i];this._dragonBones.bufferObject(n)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,r,n){void 0===e&&(e=""),void 0===r&&(r=""),void 0===n&&(n="");var s=new i;if(!this._fillBuildArmaturePackage(s,e||"",t,r||"",n||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var o=this._buildArmature(s);return this._buildBones(s,o),this._buildSlots(s,o),this._buildConstraints(s,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},e.prototype.replaceDisplay=function(e,i,r){void 0===r&&(r=-1),r<0&&(r=e.displayIndex),r<0&&(r=0),e.replaceDisplayData(i,r);var n=e.displayList;if(n.length<=r){n.length=r+1;for(var s=0,o=n.length;s<o;++s)n[s]||(n[s]=null)}if(null!==i){var a=e.rawDisplayDatas,l=null;a&&(t.DragonBones.webAssembly?r<a.size()&&(l=a.get(r)):r<a.length&&(l=a[r])),n[r]=this._getSlotDisplay(null,i,l,e)}else n[r]=null;e.displayList=n},e.prototype.replaceSlotDisplay=function(t,e,i,r,n,s){void 0===s&&(s=-1);var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var a=o.defaultSkin.getDisplay(i,r);return!!a&&(this.replaceDisplay(n,a,s),!0)},e.prototype.replaceSlotDisplayList=function(e,i,r,n){var s=this.getArmatureData(i,e||"");if(!s||!s.defaultSkin)return!1;var o=s.defaultSkin.getDisplays(r);if(!o)return!1;for(var a=0,l=0,c=t.DragonBones.webAssembly?o.size():o.length;l<c;++l){var h=t.DragonBones.webAssembly?o.get(l):o[l];this.replaceDisplay(n,h,a++)}return!0},e.prototype.replaceSkin=function(e,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null);for(var s=!1,o=i.parent.defaultSkin,a=0,l=e.getSlots();a<l.length;a++){var c=l[a];if(!(null!==n&&n.indexOf(c.name)>=0)){var h=i.getDisplays(c.name);if(h||(null!==o&&i!==o&&(h=o.getDisplays(c.name)),h)){var u=t.DragonBones.webAssembly?h.size():h.length,d=c.displayList;d.length=u;for(var p=0,f=u;p<f;++p){var _=t.DragonBones.webAssembly?h.get(p):h[p];d[p]=null!==_?this._getSlotDisplay(null,_,null,c):null}s=!0,c.rawDisplayDatas=h,c.displayList=d}else r&&(c.rawDisplayDatas=null,c.displayList=[])}}return s},e.prototype.replaceAnimation=function(e,i,r){void 0===r&&(r=!0);var n=i.defaultSkin;if(null===n)return!1;if(r)e.animation.animations=i.animations;else{var s=e.animation.animations,o={};for(var a in s)o[a]=s[a];for(var a in i.animations)o[a]=i.animations[a];e.animation.animations=o}for(var l=0,c=e.getSlots();l<c.length;l++)for(var h=c[l],u=0,d=0,p=h.displayList;d<p.length;d++){var f=p[d];if(f instanceof t.Armature){var _=n.getDisplays(h.name);if(null!==_&&u<(t.DragonBones.webAssembly?_.size():_.length)){var m=t.DragonBones.webAssembly?_.get(u):_[u];if(null!==m&&1===m.type){var g=this.getArmatureData(m.path,m.parent.parent.parent.name);g&&this.replaceAnimation(f,g,r)}}}u++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e.prototype.changeSkin=function(t,e,i){return void 0===i&&(i=null),this.replaceSkin(t,e,!1,i)},e.prototype.copyAnimationsToArmature=function(t,e,i,r,n){void 0===r&&(r=""),void 0===n&&(n=!0);var s=this.getArmatureData(e,r);return!!s&&this.replaceAnimation(t,s,n)},e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var i=function(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=i}(n||(n={})),e.exports=n},{}],370:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r=s(t("../../cocos2d/core/renderer/assembler")),n=s(t("../../cocos2d/core/value-types/mat4"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var a,l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S,w,A,E,D,L,I,P,M,R,O,B,N,k=t("./ArmatureDisplay"),F=t("../../cocos2d/core/renderer/render-flow"),V=cc.gfx,j=cc.color(255,0,0,255),G=cc.color(0,0,255,255),U=cc.color(0,255,0,255);function Y(t,e){if(!t)return null;var i,r;switch(e){case 1:i=u?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE;break;case 10:i=cc.macro.DST_COLOR,r=cc.macro.ONE_MINUS_SRC_ALPHA;break;case 12:i=cc.macro.ONE,r=cc.macro.ONE_MINUS_SRC_COLOR;break;default:i=u?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE_MINUS_SRC_ALPHA}var n=!g.enableBatch,s=g._materials[0];if(!s)return null;var o=g._materialCache,a=t.getId()+i+r+n,l=o[a];return l||(o.baseMaterial?l=cc.MaterialVariant.create(s):(l=s,o.baseMaterial=s),l.define("CC_USE_MODEL",n),l.setProperty("texture",t),l.setBlend(!0,V.BLEND_FUNC_ADD,i,r,V.BLEND_FUNC_ADD,i,r),o[a]=l),l}function H(t,e){L=t.a*e*h,d=u?L/255:1,A=t.r*a*d,E=t.g*l*d,D=t.b*c*d,w=(L<<24>>>0)+(D<<16)+(E<<8)+A}var X=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i);var s=r.prototype;return s.updateRenderData=function(){},s.realTimeTraverse=function(t,e,i){for(var r,s,o,a,l,c,h,u,d,g,A=t._slots,E=0,D=A.length;E<D;E++)if(h=(u=A[E])._color,u._visible&&u._displayData)if(e?u._mulMat(u._worldMatrix,e,u._matrix):n.default.copy(u._worldMatrix,u._matrix),u.childArmature)this.realTimeTraverse(u.childArmature,u._worldMatrix,i*h.a/255);else if(a=Y(u.getTexture(),u._blendMode)){(p||a.getHash()!==m.material.getHash())&&(p=!1,m._flush(),m.node=_,m.material=a),H(h,i),d=u._worldMatrix.m,l=u._localVertices,x=l.length>>2,c=u._indices,T=c.length,g=f.request(x,T),v=g.indiceOffset,y=g.byteOffset>>2,b=g.vertexOffset,r=f._vData,s=f._iData,o=f._uintVData,P=d[0],M=d[4],R=d[12],O=d[1],B=d[5],N=d[13];for(var L=0,I=l.length;L<I;)C=l[L++],S=l[L++],r[y++]=C*P+S*M+R,r[y++]=C*O+S*B+N,r[y++]=l[L++],r[y++]=l[L++],o[y++]=w;for(var k=0,F=c.length;k<F;k++)s[v++]=b+c[k]}},s.cacheTraverse=function(t,e){if(t){var i=t.segments;if(0!=i.length){var r,n,s,o,a,l=t.vertices,c=t.indices,h=0,u=0,d=0;if(e){var g=e.m;P=g[0],O=g[1],M=g[4],B=g[5],R=g[12],N=g[13]}var A=16&I,E=A&&1===P&&0===O&&0===M&&1===B,D=0,L=t.colors,k=L[D++],F=k.vfOffset;H(k,1);for(var V=0,j=i.length;V<j;V++){var G=i[V];o=Y(G.tex,G.blendMode),(p||o.getHash()!==m.material.getHash())&&(p=!1,m._flush(),m.node=_,m.material=o),x=G.vertexCount,T=G.indexCount,a=f.request(x,T),v=a.indiceOffset,b=a.vertexOffset,y=a.byteOffset>>2,r=f._vData,n=f._iData,s=f._uintVData;for(var U=v,X=v+T;U<X;U++)n[U]=b+c[u++];if(d=G.vfCount,r.set(l.subarray(h,h+d),y),h+=d,E)for(var z=y,W=y+d;z<W;z+=5)r[z]+=R,r[z+1]+=N;else if(A)for(var Z=y,J=y+d;Z<J;Z+=5)C=r[Z],S=r[Z+1],r[Z]=C*P+S*M+R,r[Z+1]=C*O+S*B+N;if(1&I)for(var q=h-d,K=y+4,Q=y+4+d;K<Q;K+=5,q+=5)q>=F&&(H(k=L[D++],1),F=k.vfOffset),s[K]=w}}}},s.fillBuffers=function(t,e){t.node._renderFlag|=F.FLAG_UPDATE_RENDER_DATA;var i=t._armature;if(i){p=!0,u=t.premultipliedAlpha,_=t.node,f=e._meshBuffer,m=e,g=t,I=0;var r=_._color;a=r.r/255,l=r.g/255,c=r.b/255,h=r.a/255,4294967295!==r._val&&(I|=1);var n=void 0;if(g.enableBatch&&(n=_._worldMatrix,p=!1,I|=16),t.isAnimationCached())this.cacheTraverse(t._curFrame,n);else{this.realTimeTraverse(i,n,1);var s=t._debugDraw;if(t.debugBones&&s){s.clear(),s.lineWidth=5,s.strokeColor=j,s.fillColor=G;for(var o=i.getBones(),d=0,y=o.length;d<y;d++){var v=o[d],b=Math.max(v.boneData.length,5),x=v.globalTransformMatrix.tx,T=v.globalTransformMatrix.ty,C=x+v.globalTransformMatrix.a*b,S=T+v.globalTransformMatrix.b*b;s.moveTo(x,T),s.lineTo(C,S),s.stroke(),s.circle(x,T,2*Math.PI),s.fill(),0===d&&(s.fillColor=U)}}}e.worldMatDirty++,t.attachUtil._syncAttachedNode(),_=void 0,f=void 0,m=void 0,g=void 0}},s.postFillBuffers=function(t,e){e.worldMatDirty--},r}(r.default);i.default=X,r.default.register(k,X),e.exports=i.default},{"../../cocos2d/core/renderer/assembler":224,"../../cocos2d/core/renderer/render-flow":228,"../../cocos2d/core/value-types/mat4":288,"./ArmatureDisplay":360}],371:[function(t,e){var i,r=(i=t("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{default:i},n=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,s=function(){},o=function(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0},set:function(){}}),t._calculWorldMatrix=s,t._mulMat=s},a=new r.default,l=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},reset:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},_prepareAttachNode:function(){if(this._skeleton){var t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");return t&&t.isValid||(t=new cc.Node("ATTACHED_NODE_TREE"),o(t),this._skeletonNode.addChild(t)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t,t}},_buildBoneAttachedNode:function(t,e){var i="ATTACHED_NODE:"+t.data.name,r=new cc.Node(i);return this._buildBoneRelation(r,t,e),r},_buildBoneRelation:function(t,e,i){o(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(t){var e=this._attachedNodeArray,i=[];if(!this._inited)return i;for(var r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&s.name==="ATTACHED_NODE:"+t&&i.push(s)}return i},_rebuildNodeArray:function(){for(var t=this._boneIndexToNode={},e=this._attachedNodeArray,i=this._attachedNodeArray=[],r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&!s._toRemove&&(i.push(s),t[s._boneIndex]=s)}},_sortNodeArray:function(){this._attachedNodeArray.sort((function(t,e){return t._boneIndex<e._boneIndex?-1:1}))},_getNodeByBoneIndex:function(t){var e=this._boneIndexToNode[t];return e&&e.isValid?e:null},destroyAttachedNodes:function(t){if(this._inited){for(var e=this._attachedNodeArray,i=function t(e){for(var i=e.children,r=0,n=i.length;r<n;r++){var s=i[r];s&&t(s)}e._toRemove=!0},r=0,n=e.length;r<n;r++){var s=e[r];s&&s.isValid&&s.name.split("ATTACHED_NODE:")[1]===t&&(i(s),s.removeFromParent(!0),s.destroy(),e[r]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(t){var e=[];if(!this._inited)return e;var i=this._prepareAttachNode();if(!i)return e;for(var r=[],n=this._skeleton.bones,s=0,o=n.length;s<o;s++){var a=n[s];a.data.name==t&&r.push(a)}for(var l=function(t){if(t){var e=t.data,r=this._getNodeByBoneIndex(e.index);if(r)return r;r=this._buildBoneAttachedNode(t,e.index);var n=l(t.parent)||i;return r.parent=n,r}}.bind(this),c=0,h=r.length;c<h;c++){var u=l(r[c]);e.push(u)}return this._sortNodeArray(),e},destroyAllAttachedNodes:function(){if(this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited){var t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");t&&(t.removeFromParent(!0),t.destroy(),t=null)}},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var t=this._prepareAttachNode();if(t){for(var e=this._skeleton.bones,i=0,r=e.length;i<r;i++){var n=e[i],s=n.data,o=null;if(n.parent){var a=n.parent.data.index;o=this._boneIndexToNode[a]}else o=t;if(o){var l=o.getChildByName("ATTACHED_NODE:"+s.name);l&&l.isValid?this._buildBoneRelation(l,n,s.index):(l=this._buildBoneAttachedNode(n,s.index),o.addChild(l))}}return t}}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){if(this._inited){var t=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");if(t&&t.isValid){this._attachedRootNode=t,this._boneIndexToNode={},this._attachedNodeArray.length=0,o(t),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();for(var e=this._skeleton.bones,i=0,r=e.length;i<r;i++){var n=e[i],s=n.data,a=null;if(n.parent){var l=n.parent.data.index;a=this._boneIndexToNode[l]}else a=t;if(a){var c=a.getChildByName("ATTACHED_NODE:"+s.name);c&&c.isValid&&this._buildBoneRelation(c,n,s.index)}}}}},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode,e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var i,s=this._skeletonNode._worldMatrix;if(r.default.copy(t._worldMatrix,s),t._renderFlag&=~n,i=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){for(var o=this._skeletonNode._mulMat,l=function(t,e,i){var r=a.m;r[0]=i.a,r[1]=i.c,r[4]=i.b,r[5]=i.d,r[12]=i.worldX,r[13]=i.worldY,o(t,e,a)},c=!1,h=0,u=e.length;h<u;h++){var d=e[h];if(d&&d.isValid){var p=i[d._boneIndex];p?(l(d._worldMatrix,t._worldMatrix,p),d._renderFlag&=~n):(d.removeFromParent(!0),d.destroy(),e[h]=null,c=!0)}else e[h]=null,c=!0}c&&this._rebuildNodeArray()}}}});e.exports=sp.AttachUtil=l},{"../../cocos2d/core/renderer/render-flow":228,"../../cocos2d/core/value-types/mat4":288}],372:[function(t,e){var i=t("./track-entry-listeners"),r=t("../../cocos2d/core/components/CCRenderComponent"),n=t("./lib/spine"),s=t("../../cocos2d/core/graphics/graphics"),o=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,a=t("./skeleton-cache"),l=t("./AttachUtil"),c=cc.Enum({default:-1}),h=cc.Enum({"<None>":0}),u=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton",extends:r,editor:!1,statics:{AnimationCacheMode:u},properties:{paused:{default:!1,visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData()},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){this.defaultAnimation=t,t?this.setAnimation(0,t,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),!e)return cc.errorID("",this.name);var i=e[t];void 0!==i?(this.defaultSkin=i,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name)},type:c,visible:!0,animatable:!1,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}return 0},set:function(t){if(0!==t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),!e)return cc.errorID(7502,this.name);var i=e[t];void 0!==i?this.animation=i:cc.errorID(7503,this.name)}else this.animation=""},type:h,visible:!0,animatable:!1,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:u.REALTIME,_defaultCacheMode:{default:0,type:u,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{default:!0,tooltip:!1},premultipliedAlpha:{default:!0,tooltip:!1},timeScale:{default:1,tooltip:!1},debugSlots:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugBones:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugMesh:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},useTint:{default:!1,tooltip:!1,notify:function(){this._updateUseTint()}},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null,this._skeleton=null,this._rootBone=null,this._listener=null,this._materialCache={},this._debugRenderer=null,this._startSlotIndex=-1,this._endSlotIndex=-1,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this.attachUtil=new l},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine")},_updateMaterial:function(){var t=this.useTint||this.isAnimationCached()&&!0,e=this.getMaterial(0);if(e){e.define("USE_TINT",t),e.define("CC_USE_MODEL",!this.enableBatch);var i=this.premultipliedAlpha?cc.gfx.BLEND_ONE:cc.gfx.BLEND_SRC_ALPHA,r=cc.gfx.BLEND_ONE_MINUS_SRC_ALPHA;e.setBlend(!0,cc.gfx.BLEND_FUNC_ADD,i,i,cc.gfx.BLEND_FUNC_ADD,r,r)}this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~o},markForRender:function(t){this._super(t),t?this.node._renderFlag|=o:this.node._renderFlag&=~o},_updateUseTint:function(){var t=this.getMaterial(0);if(t){var e=this.useTint||this.isAnimationCached()&&!0;t.define("USE_TINT",e)}this._materialCache={}},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_validateRender:function(){var t=this.skeletonData;t&&t.isTexturesLoaded()?this._super():this.disableRender()},setSkeletonData:function(t){if(null!=t.width&&null!=t.height&&this.node.setContentSize(t.width,t.height),this._cacheMode===u.SHARED_CACHE?this._skeletonCache=a.sharedCache:this._cacheMode===u.PRIVATE_CACHE&&(this._skeletonCache=new a,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode");var e=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=e.skeleton,this._clipper=e.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new n.Skeleton(t),this._clipper=new n.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForRender(!0)},setSlotsRange:function(t,e){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},setAnimationStateData:function(t){if(this.isAnimationCached())cc.warn("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new n.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},__preload:function(){this._super();for(var t=this.node.children,e=0,i=t.length;e<i;e++){var r=t[e];r&&"DEBUG_DRAW_NODE"===r._name&&r.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._updateBatch()},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint())},isAnimationCached:function(){return this._cacheMode!==u.REALTIME},update:function(t){if(!this.paused)if(t*=this.timeScale*sp.timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var i=e.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var r=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,r.animationName,r.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},_updateCache:function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,r=a.FrameTime;0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var n=Math.floor(this._accTime/r);if(e.isCompleted||e.updateToFrame(n),e.isCompleted&&n>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,n=0,this._emitCacheCompleteEvent()}this._curFrame=i[n]}},_updateRealtime:function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)))},setVertexEffectDelegate:function(t){this._effectDelegate=t},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},updateAnimationCache:function(t){if(this.isAnimationCached()){var e=this.skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid)},findBone:function(t){return this._skeleton?this._skeleton.findBone(t):null},findSlot:function(t){return this._skeleton?this._skeleton.findSlot(t):null},setSkin:function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},getAttachment:function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},setAttachment:function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},getTextureAtlas:function(t){return t.region},setMix:function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},setAnimation:function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var r=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,e);r||(r=this._skeletonCache.initAnimationCache(this.skeletonData._uuid,e)),r&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=r,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var n=this._skeleton.data.findAnimation(e);if(!n)return cc.logID(7509,e),null;var s=this._state.setAnimationWith(t,n,i);return this._state.apply(this._skeleton),s}return null},addAnimation:function(t,e,i,r){if(r=r||0,this.isAnimationCached())0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:r});else if(this._skeleton){var n=this._skeleton.data.findAnimation(e);return n?this._state.addAnimationWith(t,n,i,r):(cc.logID(7510,e),null)}return null},findAnimation:function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},getCurrent:function(t){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},clearTrack:function(t){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},setStartListener:function(t){this._ensureListener(),this._listener.start=t},setInterruptListener:function(t){this._ensureListener(),this._listener.interrupt=t},setEndListener:function(t){this._ensureListener(),this._listener.end=t},setDisposeListener:function(t){this._ensureListener(),this._listener.dispose=t},setCompleteListener:function(t){this._ensureListener(),this._listener.complete=t},setEventListener:function(t){this._ensureListener(),this._listener.event=t},setTrackStartListener:function(t,e){i.getListeners(t).start=e},setTrackInterruptListener:function(t,e){i.getListeners(t).interrupt=e},setTrackEndListener:function(t,e){i.getListeners(t).end=e},setTrackDisposeListener:function(t,e){i.getListeners(t).dispose=e},setTrackCompleteListener:function(t,e){i.getListeners(t).complete=function(t){var i=Math.floor(t.trackTime/t.animationEnd);e(t,i)}},setTrackEventListener:function(t,e){i.getListeners(t).event=e},getState:function(){return this._state},_resetDefaultAnim:!1,_resetDefaultSkin:!1,_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new i,this._state&&this._state.addListener(this._listener))},_updateSkeletonData:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new n.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(e){cc.warn(e)}this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},_refreshInspector:function(){this._updateAnimEnum(),this._updateSkinEnum(),Editor.Utils.refreshSelectedInspector("node",this.node.uuid)},_updateDebugDraw:function(){if(this.debugBones||this.debugSlots){if(!this._debugRenderer){var t=new cc.PrivateNode;t.name="DEBUG_DRAW_NODE";var e=t.addComponent(s);e.lineWidth=1,e.strokeColor=cc.color(255,0,0,255),this._debugRenderer=e}this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.parent=null)}}),e.exports=sp.Skeleton},{"../../cocos2d/core/components/CCRenderComponent":117,"../../cocos2d/core/graphics/graphics":159,"../../cocos2d/core/renderer/render-flow":228,"./AttachUtil":371,"./lib/spine":374,"./skeleton-cache":375,"./track-entry-listeners":379}],373:[function(t){var e="undefined"==typeof window?global:window;e.spine=t("./lib/spine"),e.sp=e.sp||{},sp._timeScale=1,Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},configurable:!0}),sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=e.spine,t("./skeleton-texture"),t("./skeleton-data"),t("./vertex-effect-delegate"),t("./Skeleton"),t("./spine-assembler")},{"./Skeleton":372,"./lib/spine":374,"./skeleton-data":376,"./skeleton-texture":377,"./spine-assembler":378,"./vertex-effect-delegate":380}],374:[function(t,e){var i,r,n,s=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});(function(t){var e,i,r,n=function(){function t(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=i}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,i,r,n,s,o,a){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(i%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,c=0,h=l.length;c<h;c++)l[c].apply(t,e,i,n,s,o,a)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var r=0,n=t.length/i-2;if(0==n)return i;for(var s=n>>>1;;){if(t[(s+1)*i]<=e?r=s+1:n=s,r==n)return(r+1)*i;s=r+n>>>1}},t.linearSearch=function(t,e,i){for(var r=0,n=t.length-i;r<=n;r+=i)if(t[r]>e)return r;return-1},t}();t.Animation=n,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(i=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(r=t.TimelineType||(t.TimelineType={}));var o=function(){function e(i){if(i<=0)throw new Error("frameCount must be > 0: "+i);this.curves=t.Utils.newFloatArray((i-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var i=t*e.BEZIER_SIZE;if(i==this.curves.length)return e.LINEAR;var r=this.curves[i];return r==e.LINEAR?e.LINEAR:r==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,i,r,n,s){var o=.03*(2*-i+n),a=.03*(2*-r+s),l=.006*(3*(i-n)+1),c=.006*(3*(r-s)+1),h=2*o+l,u=2*a+c,d=.3*i+o+.16666667*l,p=.3*r+a+.16666667*c,f=t*e.BEZIER_SIZE,_=this.curves;_[f++]=e.BEZIER;for(var m=d,g=p,y=f+e.BEZIER_SIZE-1;f<y;f+=2)_[f]=m,_[f+1]=g,d+=h,p+=u,h+=l,u+=c,m+=d,g+=p},e.prototype.getCurvePercent=function(i,r){r=t.MathUtils.clamp(r,0,1);var n=this.curves,s=i*e.BEZIER_SIZE,o=n[s];if(o==e.LINEAR)return r;if(o==e.STEPPED)return 0;for(var a=0,l=++s,c=s+e.BEZIER_SIZE-1;s<c;s+=2)if((a=n[s])>=r){var h=void 0,u=void 0;return s==l?(h=0,u=0):(h=n[s-2],u=n[s-1]),u+(n[s+1]-u)*(r-h)/(a-h)}var d=n[s-1];return d+(1-d)*(r-a)/(1-a)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=o;var a=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e<<1),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.rotate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+o.ROTATION]=i},o.prototype.apply=function(t,i,r,s,a,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<c[0])switch(l){case e.setup:return void(h.rotation=h.data.rotation);case e.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*a}else if(r>=c[c.length-o.ENTRIES]){var d=c[c.length+o.PREV_ROTATION];switch(l){case e.setup:h.rotation=h.data.rotation+d*a;break;case e.first:case e.replace:d+=h.data.rotation-h.rotation,d-=360*(16384-(16384.499999999996-d/360|0));case e.add:h.rotation+=d*a}}else{var p=n.binarySearch(c,r,o.ENTRIES),f=c[p+o.PREV_ROTATION],_=c[p],m=this.getCurvePercent((p>>1)-1,1-(r-_)/(c[p+o.PREV_TIME]-_)),g=c[p+o.ROTATION]-f;switch(g=f+(g-360*(16384-(16384.499999999996-g/360|0)))*m,l){case e.setup:h.rotation=h.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*a;break;case e.first:case e.replace:g+=h.data.rotation-h.rotation;case e.add:h.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*a}}},o.ENTRIES=2,o.PREV_TIME=-2,o.PREV_ROTATION=-1,o.ROTATION=1,o}(o);t.RotateTimeline=a;var l=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.translate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i,r){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.X]=i,this.frames[t+o.Y]=r},o.prototype.apply=function(t,i,r,s,a,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<c[0])switch(l){case e.setup:return h.x=h.data.x,void(h.y=h.data.y);case e.first:h.x+=(h.data.x-h.x)*a,h.y+=(h.data.y-h.y)*a}else{var u=0,d=0;if(r>=c[c.length-o.ENTRIES])u=c[c.length+o.PREV_X],d=c[c.length+o.PREV_Y];else{var p=n.binarySearch(c,r,o.ENTRIES);u=c[p+o.PREV_X],d=c[p+o.PREV_Y];var f=c[p],_=this.getCurvePercent(p/o.ENTRIES-1,1-(r-f)/(c[p+o.PREV_TIME]-f));u+=(c[p+o.X]-u)*_,d+=(c[p+o.Y]-d)*_}switch(l){case e.setup:h.x=h.data.x+u*a,h.y=h.data.y+d*a;break;case e.first:case e.replace:h.x+=(h.data.x+u-h.x)*a,h.y+=(h.data.y+d-h.y)*a;break;case e.add:h.x+=u*a,h.y+=d*a}}},o.ENTRIES=3,o.PREV_TIME=-3,o.PREV_X=-2,o.PREV_Y=-1,o.X=1,o.Y=2,o}(o);t.TranslateTimeline=l;var c=function(o){function a(t){return o.call(this,t)||this}return s(a,o),a.prototype.getPropertyId=function(){return(r.scale<<24)+this.boneIndex},a.prototype.apply=function(r,s,o,l,c,h,u){var d=this.frames,p=r.bones[this.boneIndex];if(p.active)if(o<d[0])switch(h){case e.setup:return p.scaleX=p.data.scaleX,void(p.scaleY=p.data.scaleY);case e.first:p.scaleX+=(p.data.scaleX-p.scaleX)*c,p.scaleY+=(p.data.scaleY-p.scaleY)*c}else{var f=0,_=0;if(o>=d[d.length-a.ENTRIES])f=d[d.length+a.PREV_X]*p.data.scaleX,_=d[d.length+a.PREV_Y]*p.data.scaleY;else{var m=n.binarySearch(d,o,a.ENTRIES);f=d[m+a.PREV_X],_=d[m+a.PREV_Y];var g=d[m],y=this.getCurvePercent(m/a.ENTRIES-1,1-(o-g)/(d[m+a.PREV_TIME]-g));f=(f+(d[m+a.X]-f)*y)*p.data.scaleX,_=(_+(d[m+a.Y]-_)*y)*p.data.scaleY}if(1==c)h==e.add?(p.scaleX+=f-p.data.scaleX,p.scaleY+=_-p.data.scaleY):(p.scaleX=f,p.scaleY=_);else{var v=0,b=0;if(u==i.mixOut)switch(h){case e.setup:v=p.data.scaleX,b=p.data.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*c,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*c;break;case e.first:case e.replace:v=p.scaleX,b=p.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*c,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*c;break;case e.add:v=p.scaleX,b=p.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-p.data.scaleX)*c,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-p.data.scaleY)*c}else switch(h){case e.setup:v=Math.abs(p.data.scaleX)*t.MathUtils.signum(f),b=Math.abs(p.data.scaleY)*t.MathUtils.signum(_),p.scaleX=v+(f-v)*c,p.scaleY=b+(_-b)*c;break;case e.first:case e.replace:v=Math.abs(p.scaleX)*t.MathUtils.signum(f),b=Math.abs(p.scaleY)*t.MathUtils.signum(_),p.scaleX=v+(f-v)*c,p.scaleY=b+(_-b)*c;break;case e.add:v=t.MathUtils.signum(f),b=t.MathUtils.signum(_),p.scaleX=Math.abs(p.scaleX)*v+(f-Math.abs(p.data.scaleX)*v)*c,p.scaleY=Math.abs(p.scaleY)*b+(_-Math.abs(p.data.scaleY)*b)*c}}}},a}(l);t.ScaleTimeline=c;var h=function(t){function i(e){return t.call(this,e)||this}return s(i,t),i.prototype.getPropertyId=function(){return(r.shear<<24)+this.boneIndex},i.prototype.apply=function(t,r,s,o,a,l){var c=this.frames,h=t.bones[this.boneIndex];if(h.active)if(s<c[0])switch(l){case e.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case e.first:h.shearX+=(h.data.shearX-h.shearX)*a,h.shearY+=(h.data.shearY-h.shearY)*a}else{var u=0,d=0;if(s>=c[c.length-i.ENTRIES])u=c[c.length+i.PREV_X],d=c[c.length+i.PREV_Y];else{var p=n.binarySearch(c,s,i.ENTRIES);u=c[p+i.PREV_X],d=c[p+i.PREV_Y];var f=c[p],_=this.getCurvePercent(p/i.ENTRIES-1,1-(s-f)/(c[p+i.PREV_TIME]-f));u+=(c[p+i.X]-u)*_,d+=(c[p+i.Y]-d)*_}switch(l){case e.setup:h.shearX=h.data.shearX+u*a,h.shearY=h.data.shearY+d*a;break;case e.first:case e.replace:h.shearX+=(h.data.shearX+u-h.shearX)*a,h.shearY+=(h.data.shearY+d-h.shearY)*a;break;case e.add:h.shearX+=u*a,h.shearY+=d*a}}},i}(l);t.ShearTimeline=h;var u=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.color<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,r,n,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=r,this.frames[t+o.B]=n,this.frames[t+o.A]=s},o.prototype.apply=function(t,i,r,s,a,l){var c=t.slots[this.slotIndex];if(c.bone.active){var h=this.frames;if(r<h[0])switch(l){case e.setup:return void c.color.setFromColor(c.data.color);case e.first:var u=c.color,d=c.data.color;u.add((d.r-u.r)*a,(d.g-u.g)*a,(d.b-u.b)*a,(d.a-u.a)*a)}else{var p=0,f=0,_=0,m=0;if(r>=h[h.length-o.ENTRIES]){var g=h.length;p=h[g+o.PREV_R],f=h[g+o.PREV_G],_=h[g+o.PREV_B],m=h[g+o.PREV_A]}else{var y=n.binarySearch(h,r,o.ENTRIES);p=h[y+o.PREV_R],f=h[y+o.PREV_G],_=h[y+o.PREV_B],m=h[y+o.PREV_A];var v=h[y],b=this.getCurvePercent(y/o.ENTRIES-1,1-(r-v)/(h[y+o.PREV_TIME]-v));p+=(h[y+o.R]-p)*b,f+=(h[y+o.G]-f)*b,_+=(h[y+o.B]-_)*b,m+=(h[y+o.A]-m)*b}1==a?c.color.set(p,f,_,m):(u=c.color,l==e.setup&&u.setFromColor(c.data.color),u.add((p-u.r)*a,(f-u.g)*a,(_-u.b)*a,(m-u.a)*a))}}},o.ENTRIES=5,o.PREV_TIME=-5,o.PREV_R=-4,o.PREV_G=-3,o.PREV_B=-2,o.PREV_A=-1,o.R=1,o.G=2,o.B=3,o.A=4,o}(o);t.ColorTimeline=u;var d=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.twoColor<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,r,n,s,a,l,c){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=r,this.frames[t+o.B]=n,this.frames[t+o.A]=s,this.frames[t+o.R2]=a,this.frames[t+o.G2]=l,this.frames[t+o.B2]=c},o.prototype.apply=function(t,i,r,s,a,l){var c=t.slots[this.slotIndex];if(c.bone.active){var h=this.frames;if(r<h[0])switch(l){case e.setup:return c.color.setFromColor(c.data.color),void c.darkColor.setFromColor(c.data.darkColor);case e.first:var u=c.color,d=c.darkColor,p=c.data.color,f=c.data.darkColor;u.add((p.r-u.r)*a,(p.g-u.g)*a,(p.b-u.b)*a,(p.a-u.a)*a),d.add((f.r-d.r)*a,(f.g-d.g)*a,(f.b-d.b)*a,0)}else{var _=0,m=0,g=0,y=0,v=0,b=0,x=0;if(r>=h[h.length-o.ENTRIES]){var T=h.length;_=h[T+o.PREV_R],m=h[T+o.PREV_G],g=h[T+o.PREV_B],y=h[T+o.PREV_A],v=h[T+o.PREV_R2],b=h[T+o.PREV_G2],x=h[T+o.PREV_B2]}else{var C=n.binarySearch(h,r,o.ENTRIES);_=h[C+o.PREV_R],m=h[C+o.PREV_G],g=h[C+o.PREV_B],y=h[C+o.PREV_A],v=h[C+o.PREV_R2],b=h[C+o.PREV_G2],x=h[C+o.PREV_B2];var S=h[C],w=this.getCurvePercent(C/o.ENTRIES-1,1-(r-S)/(h[C+o.PREV_TIME]-S));_+=(h[C+o.R]-_)*w,m+=(h[C+o.G]-m)*w,g+=(h[C+o.B]-g)*w,y+=(h[C+o.A]-y)*w,v+=(h[C+o.R2]-v)*w,b+=(h[C+o.G2]-b)*w,x+=(h[C+o.B2]-x)*w}1==a?(c.color.set(_,m,g,y),c.darkColor.set(v,b,x,1)):(u=c.color,d=c.darkColor,l==e.setup&&(u.setFromColor(c.data.color),d.setFromColor(c.data.darkColor)),u.add((_-u.r)*a,(m-u.g)*a,(g-u.b)*a,(y-u.a)*a),d.add((v-d.r)*a,(b-d.g)*a,(x-d.b)*a,0))}}},o.ENTRIES=8,o.PREV_TIME=-8,o.PREV_R=-7,o.PREV_G=-6,o.PREV_B=-5,o.PREV_A=-4,o.PREV_R2=-3,o.PREV_G2=-2,o.PREV_B2=-1,o.R=1,o.G=2,o.B=3,o.A=4,o.R2=5,o.G2=6,o.B2=7,o}(o);t.TwoColorTimeline=d;var p=function(){function s(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return s.prototype.getPropertyId=function(){return(r.attachment<<24)+this.slotIndex},s.prototype.getFrameCount=function(){return this.frames.length},s.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},s.prototype.apply=function(t,r,s,o,a,l,c){var h=t.slots[this.slotIndex];if(h.bone.active)if(c!=i.mixOut||l!=e.setup){var u=this.frames;if(s<u[0]){if(l==e.setup||l==e.first){var d=h.data.attachmentName;h.setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p;p=s>=u[u.length-1]?u.length-1:n.binarySearch(u,s,1)-1;var f=this.attachmentNames[p];t.slots[this.slotIndex].setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var _=h.data.attachmentName;h.setAttachment(null==_?null:t.getAttachment(this.slotIndex,_))}},s}();t.AttachmentTimeline=p;var f=null,_=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e),r.frameVertices=new Array(e),null==f&&(f=t.Utils.newFloatArray(64)),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.deform<<27)+ +this.attachment.id+this.slotIndex},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},o.prototype.apply=function(i,r,s,o,a,l){var c=i.slots[this.slotIndex];if(c.bone.active){var h=c.getAttachment();if(h instanceof t.VertexAttachment&&h.deformAttachment==this.attachment){var u=c.deform;0==u.length&&(l=e.setup);var d=this.frameVertices,p=d[0].length,f=this.frames;if(s<f[0]){var _=h;switch(l){case e.setup:return void(u.length=0);case e.first:if(1==a){u.length=0;break}var m=t.Utils.setArraySize(u,p);if(null==_.bones)for(var g=_.vertices,y=0;y<p;y++)m[y]+=(g[y]-m[y])*a;else for(a=1-a,y=0;y<p;y++)m[y]*=a}}else{var v=t.Utils.setArraySize(u,p);if(s>=f[f.length-1]){var b=d[f.length-1];if(1==a)if(l==e.add)if(null==(_=h).bones){g=_.vertices;for(var x=0;x<p;x++)v[x]+=b[x]-g[x]}else for(var T=0;T<p;T++)v[T]+=b[T];else t.Utils.arrayCopy(b,0,v,0,p);else switch(l){case e.setup:var C=h;if(null==C.bones){g=C.vertices;for(var S=0;S<p;S++){var w=g[S];v[S]=w+(b[S]-w)*a}}else for(var A=0;A<p;A++)v[A]=b[A]*a;break;case e.first:case e.replace:for(var E=0;E<p;E++)v[E]+=(b[E]-v[E])*a;case e.add:if(null==(_=h).bones){g=_.vertices;for(var D=0;D<p;D++)v[D]+=(b[D]-g[D])*a}else for(var L=0;L<p;L++)v[L]+=b[L]*a}}else{var I=n.binarySearch(f,s),P=d[I-1],M=d[I],R=f[I],O=this.getCurvePercent(I-1,1-(s-R)/(f[I-1]-R));if(1==a)if(l==e.add)if(null==(_=h).bones){g=_.vertices;for(var B=0;B<p;B++){var N=P[B];v[B]+=N+(M[B]-N)*O-g[B]}}else for(var k=0;k<p;k++)N=P[k],v[k]+=N+(M[k]-N)*O;else for(var F=0;F<p;F++)N=P[F],v[F]=N+(M[F]-N)*O;else switch(l){case e.setup:var V=h;if(null==V.bones){g=V.vertices;for(var j=0;j<p;j++)N=P[j],w=g[j],v[j]=w+(N+(M[j]-N)*O-w)*a}else for(var G=0;G<p;G++)N=P[G],v[G]=(N+(M[G]-N)*O)*a;break;case e.first:case e.replace:for(var U=0;U<p;U++)N=P[U],v[U]+=(N+(M[U]-N)*O-v[U])*a;break;case e.add:if(null==(_=h).bones){g=_.vertices;for(var Y=0;Y<p;Y++)N=P[Y],v[Y]+=(N+(M[Y]-N)*O-g[Y])*a}else for(var H=0;H<p;H++)N=P[H],v[H]+=(N+(M[H]-N)*O)*a}}}}}},o}(o);t.DeformTimeline=_;var m=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return r.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,i,r,s,o,a){if(null!=r){var l=this.frames,c=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,s,o,a),e=-1;else if(e>=l[c-1])return;if(!(i<l[0])){var h=0;if(e<l[0])h=0;else for(var u=l[h=n.binarySearch(l,e)];h>0&&l[h-1]==u;)h--;for(;h<c&&i>=l[h];h++)r.push(this.events[h])}}},e}();t.EventTimeline=m;var g=function(){function s(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return s.prototype.getPropertyId=function(){return r.drawOrder<<24},s.prototype.getFrameCount=function(){return this.frames.length},s.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},s.prototype.apply=function(r,s,o,a,l,c,h){var u=r.drawOrder,d=r.slots;if(h!=i.mixOut||c!=e.setup){var p=this.frames;if(o<p[0])c!=e.setup&&c!=e.first||t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length);else{var f;f=o>=p[p.length-1]?p.length-1:n.binarySearch(p,o)-1;var _=this.drawOrders[f];if(null==_)t.Utils.arrayCopy(d,0,u,0,d.length);else for(var m=0,g=_.length;m<g;m++)u[m]=d[_[m]]}}else t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length)},s}();t.DrawOrderTimeline=g;var y=function(o){function a(e){var i=o.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return s(a,o),a.prototype.getPropertyId=function(){return(r.ikConstraint<<24)+this.ikConstraintIndex},a.prototype.setFrame=function(t,e,i,r,n,s,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.MIX]=i,this.frames[t+a.SOFTNESS]=r,this.frames[t+a.BEND_DIRECTION]=n,this.frames[t+a.COMPRESS]=s?1:0,this.frames[t+a.STRETCH]=o?1:0},a.prototype.apply=function(t,r,s,o,l,c,h){var u=this.frames,d=t.ikConstraints[this.ikConstraintIndex];if(d.active)if(s<u[0])switch(c){case e.setup:return d.mix=d.data.mix,d.softness=d.data.softness,d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,void(d.stretch=d.data.stretch);case e.first:d.mix+=(d.data.mix-d.mix)*l,d.softness+=(d.data.softness-d.softness)*l,d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch}else if(s>=u[u.length-a.ENTRIES])c==e.setup?(d.mix=d.data.mix+(u[u.length+a.PREV_MIX]-d.data.mix)*l,d.softness=d.data.softness+(u[u.length+a.PREV_SOFTNESS]-d.data.softness)*l,h==i.mixOut?(d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch):(d.bendDirection=u[u.length+a.PREV_BEND_DIRECTION],d.compress=0!=u[u.length+a.PREV_COMPRESS],d.stretch=0!=u[u.length+a.PREV_STRETCH])):(d.mix+=(u[u.length+a.PREV_MIX]-d.mix)*l,d.softness+=(u[u.length+a.PREV_SOFTNESS]-d.softness)*l,h==i.mixIn&&(d.bendDirection=u[u.length+a.PREV_BEND_DIRECTION],d.compress=0!=u[u.length+a.PREV_COMPRESS],d.stretch=0!=u[u.length+a.PREV_STRETCH]));else{var p=n.binarySearch(u,s,a.ENTRIES),f=u[p+a.PREV_MIX],_=u[p+a.PREV_SOFTNESS],m=u[p],g=this.getCurvePercent(p/a.ENTRIES-1,1-(s-m)/(u[p+a.PREV_TIME]-m));c==e.setup?(d.mix=d.data.mix+(f+(u[p+a.MIX]-f)*g-d.data.mix)*l,d.softness=d.data.softness+(_+(u[p+a.SOFTNESS]-_)*g-d.data.softness)*l,h==i.mixOut?(d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch):(d.bendDirection=u[p+a.PREV_BEND_DIRECTION],d.compress=0!=u[p+a.PREV_COMPRESS],d.stretch=0!=u[p+a.PREV_STRETCH])):(d.mix+=(f+(u[p+a.MIX]-f)*g-d.mix)*l,d.softness+=(_+(u[p+a.SOFTNESS]-_)*g-d.softness)*l,h==i.mixIn&&(d.bendDirection=u[p+a.PREV_BEND_DIRECTION],d.compress=0!=u[p+a.PREV_COMPRESS],d.stretch=0!=u[p+a.PREV_STRETCH]))}},a.ENTRIES=6,a.PREV_TIME=-6,a.PREV_MIX=-5,a.PREV_SOFTNESS=-4,a.PREV_BEND_DIRECTION=-3,a.PREV_COMPRESS=-2,a.PREV_STRETCH=-1,a.MIX=1,a.SOFTNESS=2,a.BEND_DIRECTION=3,a.COMPRESS=4,a.STRETCH=5,a}(o);t.IkConstraintTimeline=y;var v=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.transformConstraint<<24)+this.transformConstraintIndex},o.prototype.setFrame=function(t,e,i,r,n,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=r,this.frames[t+o.SCALE]=n,this.frames[t+o.SHEAR]=s},o.prototype.apply=function(t,i,r,s,a,l){var c=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(r<c[0]){var u=h.data;switch(l){case e.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case e.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*a,h.translateMix+=(u.translateMix-h.translateMix)*a,h.scaleMix+=(u.scaleMix-h.scaleMix)*a,h.shearMix+=(u.shearMix-h.shearMix)*a}}else{var d=0,p=0,f=0,_=0;if(r>=c[c.length-o.ENTRIES]){var m=c.length;d=c[m+o.PREV_ROTATE],p=c[m+o.PREV_TRANSLATE],f=c[m+o.PREV_SCALE],_=c[m+o.PREV_SHEAR]}else{var g=n.binarySearch(c,r,o.ENTRIES);d=c[g+o.PREV_ROTATE],p=c[g+o.PREV_TRANSLATE],f=c[g+o.PREV_SCALE],_=c[g+o.PREV_SHEAR];var y=c[g],v=this.getCurvePercent(g/o.ENTRIES-1,1-(r-y)/(c[g+o.PREV_TIME]-y));d+=(c[g+o.ROTATE]-d)*v,p+=(c[g+o.TRANSLATE]-p)*v,f+=(c[g+o.SCALE]-f)*v,_+=(c[g+o.SHEAR]-_)*v}l==e.setup?(u=h.data,h.rotateMix=u.rotateMix+(d-u.rotateMix)*a,h.translateMix=u.translateMix+(p-u.translateMix)*a,h.scaleMix=u.scaleMix+(f-u.scaleMix)*a,h.shearMix=u.shearMix+(_-u.shearMix)*a):(h.rotateMix+=(d-h.rotateMix)*a,h.translateMix+=(p-h.translateMix)*a,h.scaleMix+=(f-h.scaleMix)*a,h.shearMix+=(_-h.shearMix)*a)}},o.ENTRIES=5,o.PREV_TIME=-5,o.PREV_ROTATE=-4,o.PREV_TRANSLATE=-3,o.PREV_SCALE=-2,o.PREV_SHEAR=-1,o.ROTATE=1,o.TRANSLATE=2,o.SCALE=3,o.SHEAR=4,o}(o);t.TransformConstraintTimeline=v;var b=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.pathConstraintPosition<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.VALUE]=i},o.prototype.apply=function(t,i,r,s,a,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<c[0])switch(l){case e.setup:return void(h.position=h.data.position);case e.first:h.position+=(h.data.position-h.position)*a}else{var u=0;if(r>=c[c.length-o.ENTRIES])u=c[c.length+o.PREV_VALUE];else{var d=n.binarySearch(c,r,o.ENTRIES);u=c[d+o.PREV_VALUE];var p=c[d],f=this.getCurvePercent(d/o.ENTRIES-1,1-(r-p)/(c[d+o.PREV_TIME]-p));u+=(c[d+o.VALUE]-u)*f}l==e.setup?h.position=h.data.position+(u-h.data.position)*a:h.position+=(u-h.position)*a}},o.ENTRIES=2,o.PREV_TIME=-2,o.PREV_VALUE=-1,o.VALUE=1,o}(o);t.PathConstraintPositionTimeline=b;var x=function(t){function i(e){return t.call(this,e)||this}return s(i,t),i.prototype.getPropertyId=function(){return(r.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(t,r,s,o,a,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(s<c[0])switch(l){case e.setup:return void(h.spacing=h.data.spacing);case e.first:h.spacing+=(h.data.spacing-h.spacing)*a}else{var u=0;if(s>=c[c.length-i.ENTRIES])u=c[c.length+i.PREV_VALUE];else{var d=n.binarySearch(c,s,i.ENTRIES);u=c[d+i.PREV_VALUE];var p=c[d],f=this.getCurvePercent(d/i.ENTRIES-1,1-(s-p)/(c[d+i.PREV_TIME]-p));u+=(c[d+i.VALUE]-u)*f}l==e.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*a:h.spacing+=(u-h.spacing)*a}},i}(b);t.PathConstraintSpacingTimeline=x;var T=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return s(o,i),o.prototype.getPropertyId=function(){return(r.pathConstraintMix<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i,r){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=r},o.prototype.apply=function(t,i,r,s,a,l){var c=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<c[0])switch(l){case e.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case e.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*a,h.translateMix+=(h.data.translateMix-h.translateMix)*a}else{var u=0,d=0;if(r>=c[c.length-o.ENTRIES])u=c[c.length+o.PREV_ROTATE],d=c[c.length+o.PREV_TRANSLATE];else{var p=n.binarySearch(c,r,o.ENTRIES);u=c[p+o.PREV_ROTATE],d=c[p+o.PREV_TRANSLATE];var f=c[p],_=this.getCurvePercent(p/o.ENTRIES-1,1-(r-f)/(c[p+o.PREV_TIME]-f));u+=(c[p+o.ROTATE]-u)*_,d+=(c[p+o.TRANSLATE]-d)*_}l==e.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*a,h.translateMix=h.data.translateMix+(d-h.data.translateMix)*a):(h.rotateMix+=(u-h.rotateMix)*a,h.translateMix+=(d-h.translateMix)*a)}},o.ENTRIES=3,o.PREV_TIME=-3,o.PREV_ROTATE=-2,o.PREV_TRANSLATE=-1,o.ROTATE=1,o.TRANSLATE=2,o}(o);t.PathConstraintMixTimeline=T})(n||(n={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new i})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,r=e.length;i<r;i++){var n=e[i];if(null!=n){n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;var s=t*n.timeScale;if(n.delay>0){if(n.delay-=s,n.delay>0)continue;s=-n.delay,n.delay=0}var o=n.next;if(null!=o){var a=n.trackLast-o.delay;if(a>=0){for(o.delay=0,o.trackTime+=0==n.timeScale?0:(a/n.timeScale+t)*o.timeScale,n.trackTime+=s,this.setCurrent(i,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[i]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){var l=n.mixingFrom;for(n.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}n.trackTime+=s}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var r=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(i){if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var r=this.events,n=this.tracks,s=!1,o=0,a=n.length;o<a;o++){var l=n[o];if(!(null==l||l.delay>0)){s=!0;var c=0==o?t.MixBlend.first:l.mixBlend,h=l.alpha;null!=l.mixingFrom?h*=this.applyMixingFrom(l,i,c):l.trackTime>=l.trackEnd&&null==l.next&&(h=0);var u=l.animationLast,d=l.getAnimationTime(),p=l.animation.timelines.length,f=l.animation.timelines;if(0==o&&1==h||c==t.MixBlend.add)for(var _=0;_<p;_++)t.Utils.webkit602BugfixHelper(h,c),f[_].apply(i,u,d,r,h,c,t.MixDirection.mixIn);else{var m=l.timelineMode,g=0==l.timelinesRotation.length;g&&t.Utils.setArraySize(l.timelinesRotation,p<<1,null);var y=l.timelinesRotation;for(_=0;_<p;_++){var v=f[_],b=(m[_]&e.NOT_LAST-1)==e.SUBSEQUENT?c:t.MixBlend.setup;v instanceof t.RotateTimeline?this.applyRotateTimeline(v,i,d,h,b,y,_<<1,g):(t.Utils.webkit602BugfixHelper(h,c),v.apply(i,u,d,r,h,b,t.MixDirection.mixIn))}}this.queueEvents(l,d),r.length=0,l.nextAnimationLast=d,l.nextTrackLast=l.trackTime}}return this.queue.drain(),s},e.prototype.applyMixingFrom=function(i,r,n){var s=i.mixingFrom;null!=s.mixingFrom&&this.applyMixingFrom(s,r,n);var o=0;0==i.mixDuration?(o=1,n==t.MixBlend.first&&(n=t.MixBlend.setup)):((o=i.mixTime/i.mixDuration)>1&&(o=1),n!=t.MixBlend.first&&(n=s.mixBlend));var a=o<s.eventThreshold?this.events:null,l=o<s.attachmentThreshold,c=o<s.drawOrderThreshold,h=s.animationLast,u=s.getAnimationTime(),d=s.animation.timelines.length,p=s.animation.timelines,f=s.alpha*i.interruptAlpha,_=f*(1-o);if(n==t.MixBlend.add)for(var m=0;m<d;m++)p[m].apply(r,h,u,a,_,n,t.MixDirection.mixOut);else{var g=s.timelineMode,y=s.timelineHoldMix,v=0==s.timelinesRotation.length;v&&t.Utils.setArraySize(s.timelinesRotation,d<<1,null);var b=s.timelinesRotation;for(s.totalAlpha=0,m=0;m<d;m++){var x=p[m],T=t.MixDirection.mixOut,C=void 0,S=0;switch(g[m]&e.NOT_LAST-1){case e.SUBSEQUENT:if(C=n,!l&&x instanceof t.AttachmentTimeline){if((g[m]&e.NOT_LAST)==e.NOT_LAST)continue;C=t.MixBlend.setup}if(!c&&x instanceof t.DrawOrderTimeline)continue;S=_;break;case e.FIRST:C=t.MixBlend.setup,S=_;break;case e.HOLD:C=t.MixBlend.setup,S=f;break;default:C=t.MixBlend.setup;var w=y[m];S=f*Math.max(0,1-w.mixTime/w.mixDuration)}s.totalAlpha+=S,x instanceof t.RotateTimeline?this.applyRotateTimeline(x,r,u,S,C,b,m<<1,v):(t.Utils.webkit602BugfixHelper(S,n),C==t.MixBlend.setup&&(x instanceof t.AttachmentTimeline?(l||(g[m]&e.NOT_LAST)==e.NOT_LAST)&&(T=t.MixDirection.mixIn):x instanceof t.DrawOrderTimeline&&c&&(T=t.MixDirection.mixIn)),x.apply(r,h,u,a,S,C,T))}}return i.mixDuration>0&&this.queueEvents(s,u),this.events.length=0,s.nextAnimationLast=u,s.nextTrackLast=s.trackTime,o},e.prototype.applyRotateTimeline=function(e,i,r,n,s,o,a,l){if(l&&(o[a]=0),1!=n){var c=e,h=c.frames,u=i.bones[c.boneIndex];if(u.active){var d=0,p=0;if(r<h[0])switch(s){case t.MixBlend.setup:u.rotation=u.data.rotation;default:return;case t.MixBlend.first:d=u.rotation,p=u.data.rotation}else if(d=s==t.MixBlend.setup?u.data.rotation:u.rotation,r>=h[h.length-t.RotateTimeline.ENTRIES])p=u.data.rotation+h[h.length+t.RotateTimeline.PREV_ROTATION];else{var f=t.Animation.binarySearch(h,r,t.RotateTimeline.ENTRIES),_=h[f+t.RotateTimeline.PREV_ROTATION],m=h[f],g=c.getCurvePercent((f>>1)-1,1-(r-m)/(h[f+t.RotateTimeline.PREV_TIME]-m));p=h[f+t.RotateTimeline.ROTATION]-_,p=_+(p-=360*(16384-(16384.499999999996-p/360|0)))*g+u.data.rotation,p-=360*(16384-(16384.499999999996-p/360|0))}var y=0,v=p-d;if(0==(v-=360*(16384-(16384.499999999996-v/360|0))))y=o[a];else{var b=0,x=0;l?(b=0,x=v):(b=o[a],x=o[a+1]);var T=v>0,C=b>=0;t.MathUtils.signum(x)!=t.MathUtils.signum(v)&&Math.abs(x)<=90&&(Math.abs(b)>180&&(b+=360*t.MathUtils.signum(b)),C=T),y=v+b-b%360,C!=T&&(y+=360*t.MathUtils.signum(b)),o[a]=y}o[a+1]=v,d+=y*n,u.rotation=d-360*(16384-(16384.499999999996-d/360|0))}}else e.apply(i,0,r,null,1,s,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var i=t.animationStart,r=t.animationEnd,n=r-i,s=t.trackLast%n,o=this.events,a=0,l=o.length;a<l;a++){var c=o[a];if(c.time<s)break;c.time>r||this.queue.event(t,c)}for((t.loop?0==n||s>t.trackTime%n:e>=r&&t.animationLast<r)&&this.queue.complete(t);a<l;a++)o[a].time<i||this.queue.event(t,o[a])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var i=e;;){var r=i.mixingFrom;if(null==r)break;this.queue.end(r),i.mixingFrom=null,i.mixingTo=null,i=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,i){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(i&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,i)},e.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var r=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));var s=this.trackEntry(t,e,i,n);return this.setCurrent(t,s,r),this.queue.drain(),s},e.prototype.addAnimation=function(t,e,i,r){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,i,r)},e.prototype.addAnimationWith=function(t,e,i,r){if(null==e)throw new Error("animation cannot be null.");var n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;var s=this.trackEntry(t,e,i,n);if(null==n)this.setCurrent(t,s,!0),this.queue.drain();else if(n.next=s,r<=0){var o=n.animationEnd-n.animationStart;0!=o?(n.loop?r+=o*(1+(n.trackTime/o|0)):r+=Math.max(o,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime}return s.delay=r,s},e.prototype.setEmptyAnimation=function(t,i){var r=this.setAnimationWith(t,e.emptyAnimation,!1);return r.mixDuration=i,r.trackEnd=i,r},e.prototype.addEmptyAnimation=function(t,i,r){r<=0&&(r-=i);var n=this.addAnimationWith(t,e.emptyAnimation,!1,r);return n.mixDuration=i,n.trackEnd=i,n},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,r=this.tracks.length;i<r;i++){var n=this.tracks[i];null!=n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,i,r){var n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=i,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,i=this.tracks.length;e<i;e++)if(null!=(r=this.tracks[e])){for(;null!=r.mixingFrom;)r=r.mixingFrom;do{null!=r.mixingFrom&&r.mixBlend==t.MixBlend.add||this.computeHold(r),r=r.mixingTo}while(null!=r)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var r=this.tracks[e];null!=r;)this.computeNotLast(r),r=r.mixingFrom},e.prototype.computeHold=function(i){var r=i.mixingTo,n=i.animation.timelines,s=i.animation.timelines.length,o=t.Utils.setArraySize(i.timelineMode,s);i.timelineHoldMix.length=0;var a=t.Utils.setArraySize(i.timelineHoldMix,s),l=this.propertyIDs;if(null!=r&&r.holdPrevious)for(var c=0;c<s;c++)l.add(n[c].getPropertyId()),o[c]=e.HOLD;else t:for(c=0;c<s;c++){var h=n[c],u=h.getPropertyId();if(l.add(u))if(null==r||h instanceof t.AttachmentTimeline||h instanceof t.DrawOrderTimeline||h instanceof t.EventTimeline||!r.animation.hasTimeline(u))o[c]=e.FIRST;else{for(var d=r.mixingTo;null!=d;d=d.mixingTo)if(!d.animation.hasTimeline(u)){if(i.mixDuration>0){o[c]=e.HOLD_MIX,a[c]=d;continue t}break}o[c]=e.HOLD}else o[c]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(i){for(var r=i.animation.timelines,n=i.animation.timelines.length,s=i.timelineMode,o=this.propertyIDs,a=0;a<n;a++)if(r[a]instanceof t.AttachmentTimeline){var l=r[a];o.add(l.slotIndex)||(s[a]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var i=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=i;var r,n=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(r.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(r.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(r.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(r.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(r.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(r.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],s=t[i+1];switch(n){case r.start:null!=s.listener&&s.listener.start&&s.listener.start(s);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(s);break;case r.interrupt:for(null!=s.listener&&s.listener.interrupt&&s.listener.interrupt(s),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(s);break;case r.end:for(null!=s.listener&&s.listener.end&&s.listener.end(s),o=0;o<e.length;o++)e[o].end&&e[o].end(s);case r.dispose:for(null!=s.listener&&s.listener.dispose&&s.listener.dispose(s),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(s);this.animState.trackEntryPool.free(s);break;case r.complete:for(null!=s.listener&&s.listener.complete&&s.listener.complete(s),o=0;o<e.length;o++)e[o].complete&&e[o].complete(s);break;case r.event:var a=t[2+i++];for(null!=s.listener&&s.listener.event&&s.listener.event(s,a),o=0;o<e.length;o++)e[o].event&&e[o].event(s,a)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=n,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(r=t.EventType||(t.EventType={}));var s=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=s}(n||(n={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,i){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var n=this.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);this.setMixWith(r,n,i)},t.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=i},t.prototype.getMix=function(t,e){var i=t.name+"."+e.name,r=this.animationToMixTime[i];return void 0===r?this.defaultMix:r},t}();t.AnimationStateData=e}(n||(n={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){200==r.status?e(r.responseText):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.downloadBinary=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status?e(new Uint8Array(r.response)):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.prototype.loadBinary=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load binary "+t+": status "+status+", "+i,r&&r(t,"Couldn't load binary "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadText=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load text "+t+": status "+status+", "+i,r&&r(t,"Couldn't load text "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadTexture=function(t,e,i){var r=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var i=r.textureLoader(n);r.assets[t]=i,r.toLoad--,r.loaded++,e&&e(t,n)},n.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},n.src=t},e.prototype.loadTextureData=function(t,e,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++;var s=new Image;s.onload=function(){var e=n.textureLoader(s);n.assets[t]=e,n.toLoad--,n.loaded++,i&&i(t,s)},s.onerror=function(){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,r&&r(t,"Couldn't load image "+t)},s.src=e},e.prototype.loadTextureAtlas=function(i,r,n){var s=this;void 0===r&&(r=null),void 0===n&&(n=null);var o=i.lastIndexOf("/")>=0?i.substring(0,i.lastIndexOf("/")):"";i=this.pathPrefix+i,this.toLoad++,e.downloadText(i,(function(e){var a={count:0},l=new Array;try{new t.TextureAtlas(e,(function(e){l.push(o+"/"+e);var i=document.createElement("img");return i.width=16,i.height=16,new t.FakeTexture(i)}))}catch(f){var c=f;return s.errors[i]="Couldn't load texture atlas "+i+": "+c.message,n&&n(i,"Couldn't load texture atlas "+i+": "+c.message),s.toLoad--,void s.loaded++}for(var h=function(c){var h=!1;s.loadTexture(c,(function(c){if(a.count++,a.count==l.length)if(h)s.errors[i]="Couldn't load texture atlas page "+c+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+c+" of atlas "+i),s.toLoad--,s.loaded++;else try{var u=new t.TextureAtlas(e,(function(t){return s.get(o+"/"+t)}));s.assets[i]=u,r&&r(i,u),s.toLoad--,s.loaded++}catch(f){var d=f;s.errors[i]="Couldn't load texture atlas "+i+": "+d.message,n&&n(i,"Couldn't load texture atlas "+i+": "+d.message),s.toLoad--,s.loaded++}}),(function(t){h=!0,a.count++,a.count==l.length&&(s.errors[i]="Couldn't load texture atlas page "+t+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+t+" of atlas "+i),s.toLoad--,s.loaded++)}))},u=0,d=l;u<d.length;u++)h(d[u])}),(function(t,e){s.errors[i]="Couldn't load texture atlas "+i+": status "+status+", "+e,n&&n(i,"Couldn't load texture atlas "+i+": status "+status+", "+e),s.toLoad--,s.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(n||(n={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var s=new t.RegionAttachment(i);return s.setRegion(n),s},e.prototype.newMeshAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var s=new t.MeshAttachment(i);return s.region=n,s},e.prototype.newBoundingBoxAttachment=function(e,i){return new t.BoundingBoxAttachment(i)},e.prototype.newPathAttachment=function(e,i){return new t.PathAttachment(i)},e.prototype.newPointAttachment=function(e,i){return new t.PointAttachment(i)},e.prototype.newClippingAttachment=function(e,i){return new t.ClippingAttachment(i)},e}();t.AtlasAttachmentLoader=e}(n||(n={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={}))}(n||(n={})),function(t){var e=function(){function e(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,i,r,n,s,o,a){this.ax=e,this.ay=i,this.arotation=r,this.ascaleX=n,this.ascaleY=s,this.ashearX=o,this.ashearY=a,this.appliedValid=!0;var l=this.parent;if(null==l){var c=this.skeleton,h=r+90+a,u=c.scaleX,d=c.scaleY;return this.a=t.MathUtils.cosDeg(r+o)*n*u,this.b=t.MathUtils.cosDeg(h)*s*u,this.c=t.MathUtils.sinDeg(r+o)*n*d,this.d=t.MathUtils.sinDeg(h)*s*d,this.worldX=e*u+c.x,void(this.worldY=i*d+c.y)}var p=l.a,f=l.b,_=l.c,m=l.d;switch(this.worldX=p*e+f*i+l.worldX,this.worldY=_*e+m*i+l.worldY,this.data.transformMode){case t.TransformMode.Normal:h=r+90+a;var g=t.MathUtils.cosDeg(r+o)*n,y=t.MathUtils.cosDeg(h)*s,v=t.MathUtils.sinDeg(r+o)*n,b=t.MathUtils.sinDeg(h)*s;return this.a=p*g+f*v,this.b=p*y+f*b,this.c=_*g+m*v,void(this.d=_*y+m*b);case t.TransformMode.OnlyTranslation:h=r+90+a,this.a=t.MathUtils.cosDeg(r+o)*n,this.b=t.MathUtils.cosDeg(h)*s,this.c=t.MathUtils.sinDeg(r+o)*n,this.d=t.MathUtils.sinDeg(h)*s;break;case t.TransformMode.NoRotationOrReflection:var x=0;(S=p*p+_*_)>1e-4?(f=_*(S=Math.abs(p*m-f*_)/S),m=p*S,x=Math.atan2(_,p)*t.MathUtils.radDeg):(p=0,_=0,x=90-Math.atan2(m,f)*t.MathUtils.radDeg);var T=r+o-x,C=r+a-x+90;g=t.MathUtils.cosDeg(T)*n,y=t.MathUtils.cosDeg(C)*s,v=t.MathUtils.sinDeg(T)*n,b=t.MathUtils.sinDeg(C)*s,this.a=p*g-f*v,this.b=p*y-f*b,this.c=_*g+m*v,this.d=_*y+m*b;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var S,w=t.MathUtils.cosDeg(r),A=t.MathUtils.sinDeg(r),E=(p*w+f*A)/this.skeleton.scaleX,D=(_*w+m*A)/this.skeleton.scaleY;(S=Math.sqrt(E*E+D*D))>1e-5&&(S=1/S),E*=S,D*=S,S=Math.sqrt(E*E+D*D),this.data.transformMode==t.TransformMode.NoScale&&p*m-f*_<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(S=-S);var L=Math.PI/2+Math.atan2(D,E),I=Math.cos(L)*S,P=Math.sin(L)*S;g=t.MathUtils.cosDeg(o)*n,y=t.MathUtils.cosDeg(90+a)*s,v=t.MathUtils.sinDeg(o)*n,b=t.MathUtils.sinDeg(90+a)*s,this.a=E*g+I*v,this.b=E*y+I*b,this.c=D*g+P*v,this.d=D*y+P*b}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var i=e.a,r=e.b,n=e.c,s=e.d,o=1/(i*s-r*n),a=this.worldX-e.worldX,l=this.worldY-e.worldY;this.ax=a*s*o-l*r*o,this.ay=l*i*o-a*n*o;var c=o*s,h=o*i,u=o*r,d=o*n,p=c*this.a-u*this.c,f=c*this.b-u*this.d,_=h*this.c-d*this.a,m=h*this.d-d*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(p*p+_*_),this.ascaleX>1e-4){var g=p*m-f*_;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(p*f+_*m,g)*t.MathUtils.radDeg,this.arotation=Math.atan2(_,p)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,f)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,s=1/(e*n-i*r),o=t.x-this.worldX,a=t.y-this.worldY;return t.x=o*n*s-a*i*s,t.y=a*e*s-o*r*s,t},e.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(this.a*i-this.c*r,this.d*r-this.b*i)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(r*this.c+i*this.d,r*this.a+i*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var i=this.a,r=this.b,n=this.c,s=this.d,o=t.MathUtils.cosDeg(e),a=t.MathUtils.sinDeg(e);this.a=o*i-a*n,this.b=o*r-a*s,this.c=a*i+o*n,this.d=a*r+o*s,this.appliedValid=!1},e}();t.Bone=e}(n||(n={})),function(t){var e;t.BoneData=function(i,r,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,i<0)throw new Error("index must be >= 0.");if(null==r)throw new Error("name cannot be null.");this.index=i,this.name=r,this.parent=n},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(n||(n={})),function(t){t.ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i}}(n||(n={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(n||(n={})),function(t){t.EventData=function(t){this.name=t}}(n||(n={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,i,r,n,s,o,a){e.appliedValid||e.updateAppliedTransform();var l=e.parent,c=1/(l.a*l.d-l.b*l.c),h=i-l.worldX,u=r-l.worldY,d=(h*l.d-u*l.b)*c-e.ax,p=(u*l.a-h*l.c)*c-e.ay,f=Math.atan2(p,d)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);var _=e.ascaleX,m=e.ascaleY;if(n||s){var g=e.data.length*_,y=Math.sqrt(d*d+p*p);if(n&&y<g||s&&y>g&&g>1e-4){var v=(y/g-1)*a+1;_*=v,o&&(m*=v)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+f*a,_,m,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,i,r,n,s,o,a,l){if(0!=l){e.appliedValid||e.updateAppliedTransform(),i.appliedValid||i.updateAppliedTransform();var c=e.ax,h=e.ay,u=e.ascaleX,d=u,p=e.ascaleY,f=i.ascaleX,_=0,m=0,g=0;u<0?(u=-u,_=180,g=-1):(_=0,g=1),p<0&&(p=-p,g=-g),f<0?(f=-f,m=180):m=0;var y=i.ax,v=0,b=0,x=0,T=e.a,C=e.b,S=e.c,w=e.d,A=Math.abs(u-p)<=1e-4;A?(b=T*y+C*(v=i.ay)+e.worldX,x=S*y+w*v+e.worldY):(v=0,b=T*y+e.worldX,x=S*y+e.worldY);var E=e.parent;T=E.a,C=E.b,S=E.c;var D,L,I=1/(T*(w=E.d)-C*S),P=b-E.worldX,M=x-E.worldY,R=(P*w-M*C)*I-c,O=(M*T-P*S)*I-h,B=Math.sqrt(R*R+O*O),N=i.data.length*f;if(B<1e-4)return this.apply1(e,r,n,!1,o,!1,l),void i.updateWorldTransformWith(y,v,0,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY);var k=((P=r-E.worldX)*w-(M=n-E.worldY)*C)*I-c,F=(M*T-P*S)*I-h,V=k*k+F*F;if(0!=a){a*=u*(f+1)/2;var j=Math.sqrt(V),G=j-B-N*u+a;if(G>0){var U=Math.min(1,G/(2*a))-1;V=(k-=(U=(G-a*(1-U*U))/j)*k)*k+(F-=U*F)*F}}t:if(A){var Y=(V-B*B-(N*=u)*N)/(2*B*N);Y<-1?Y=-1:Y>1&&(Y=1,o&&(d*=(Math.sqrt(V)/(B+N)-1)*l+1)),L=Math.acos(Y)*s,T=B+N*Y,C=N*Math.sin(L),D=Math.atan2(F*T-k*C,k*T+F*C)}else{var H=(T=u*N)*T,X=(C=p*N)*C,z=Math.atan2(F,k),W=-2*X*B,Z=X-H;if((w=W*W-4*Z*(S=X*B*B+H*V-H*X))>=0){var J=Math.sqrt(w);W<0&&(J=-J);var q=(J=-(W+J)/2)/Z,K=S/J,Q=Math.abs(q)<Math.abs(K)?q:K;if(Q*Q<=V){M=Math.sqrt(V-Q*Q)*s,D=z-Math.atan2(M,Q),L=Math.atan2(M/p,(Q-B)/u);break t}}var $=t.MathUtils.PI,tt=B-T,et=tt*tt,it=0,rt=0,nt=B+T,st=nt*nt,ot=0;(S=-T*B/(H-X))>=-1&&S<=1&&(S=Math.acos(S),(w=(P=T*Math.cos(S)+B)*P+(M=C*Math.sin(S))*M)<et&&($=S,et=w,tt=P,it=M),w>st&&(rt=S,st=w,nt=P,ot=M)),V<=(et+st)/2?(D=z-Math.atan2(it*s,tt),L=$*s):(D=z-Math.atan2(ot*s,nt),L=rt*s)}var at=Math.atan2(v,y)*g,lt=e.arotation;(D=(D-at)*t.MathUtils.radDeg+_-lt)>180?D-=360:D<-180&&(D+=360),e.updateWorldTransformWith(c,h,lt+D*l,d,e.ascaleY,0,0),lt=i.arotation,(L=((L+at)*t.MathUtils.radDeg-i.ashearX)*g+m-lt)>180?L-=360:L<-180&&(L+=360),i.updateWorldTransformWith(y,v,lt+L*l,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}else i.updateWorldTransform()},e}();t.IkConstraint=e}(n||(n={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return s(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(n||(n={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,r=t.bones.length;i<r;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var i=this.target.getAttachment();if(i instanceof t.PathAttachment){var r=this.rotateMix,n=this.translateMix,s=r>0;if(n>0||s){var o=this.data,a=o.spacingMode==t.SpacingMode.Percent,l=o.rotateMode,c=l==t.RotateMode.Tangent,h=l==t.RotateMode.ChainScale,u=this.bones.length,d=c?u:u+1,p=this.bones,f=t.Utils.setArraySize(this.spaces,d),_=null,m=this.spacing;if(h||!a){h&&(_=t.Utils.setArraySize(this.lengths,u));for(var g=o.spacingMode==t.SpacingMode.Length,y=0,v=d-1;y<v;){var b=(P=p[y]).data.length;if(b<e.epsilon)h&&(_[y]=0),f[++y]=0;else if(a){if(h){var x=b*P.a,T=b*P.c,C=Math.sqrt(x*x+T*T);_[y]=C}f[++y]=m}else{x=b*P.a,T=b*P.c;var S=Math.sqrt(x*x+T*T);h&&(_[y]=S),f[++y]=(g?b+m:m)*S/b}}}else for(y=1;y<d;y++)f[y]=m;var w=this.computeWorldPositions(i,d,c,o.positionMode==t.PositionMode.Percent,a),A=w[0],E=w[1],D=o.offsetRotation,L=!1;0==D?L=l==t.RotateMode.Chain:(L=!1,D*=(I=this.target.bone).a*I.d-I.b*I.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),y=0;for(var I=3;y<u;y++,I+=3){var P;(P=p[y]).worldX+=(A-P.worldX)*n,P.worldY+=(E-P.worldY)*n;var M=(x=w[I])-A,R=(T=w[I+1])-E;if(h){var O=_[y];if(0!=O){var B=(Math.sqrt(M*M+R*R)/O-1)*r+1;P.a*=B,P.c*=B}}if(A=x,E=T,s){var N=P.a,k=P.b,F=P.c,V=P.d,j=0,G=0,U=0;if(j=c?w[I-1]:0==f[y+1]?w[I+2]:Math.atan2(R,M),j-=Math.atan2(F,N),L){G=Math.cos(j),U=Math.sin(j);var Y=P.data.length;A+=(Y*(G*N-U*F)-M)*r,E+=(Y*(U*N+G*F)-R)*r}else j+=D;j>t.MathUtils.PI?j-=t.MathUtils.PI2:j<-t.MathUtils.PI&&(j+=t.MathUtils.PI2),j*=r,G=Math.cos(j),U=Math.sin(j),P.a=G*N-U*F,P.b=G*k-U*V,P.c=U*N+G*F,P.d=U*k+G*V}P.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(i,r,n,s,o){var a=this.target,l=this.position,c=this.spaces,h=t.Utils.setArraySize(this.positions,3*r+2),u=null,d=i.closed,p=i.worldVerticesLength,f=p/6,_=e.NONE;if(!i.constantSpeed){var m=i.lengths,g=m[f-=d?1:2];if(s&&(l*=g),o)for(var y=1;y<r;y++)c[y]*=g;u=t.Utils.setArraySize(this.world,8),y=0;for(var v=0,b=0;y<r;y++,v+=3){var x=l+=X=c[y];if(d)(x%=g)<0&&(x+=g),b=0;else{if(x<0){_!=e.BEFORE&&(_=e.BEFORE,i.computeWorldVertices(a,2,4,u,0,2)),this.addBeforePosition(x,u,0,h,v);continue}if(x>g){_!=e.AFTER&&(_=e.AFTER,i.computeWorldVertices(a,p-6,4,u,0,2)),this.addAfterPosition(x-g,u,0,h,v);continue}}for(;;b++){var T=m[b];if(!(x>T)){0==b?x/=T:x=(x-(J=m[b-1]))/(T-J);break}}b!=_&&(_=b,d&&b==f?(i.computeWorldVertices(a,p-4,4,u,0,2),i.computeWorldVertices(a,0,4,u,4,2)):i.computeWorldVertices(a,6*b+2,8,u,0,2)),this.addCurvePosition(x,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,v,n||y>0&&0==X)}return h}d?(p+=2,u=t.Utils.setArraySize(this.world,p),i.computeWorldVertices(a,2,p-4,u,0,2),i.computeWorldVertices(a,0,2,u,p-4,2),u[p-2]=u[0],u[p-1]=u[1]):(f--,p-=4,u=t.Utils.setArraySize(this.world,p),i.computeWorldVertices(a,2,p,u,0,2));for(var C=t.Utils.setArraySize(this.curves,f),S=0,w=u[0],A=u[1],E=0,D=0,L=0,I=0,P=0,M=0,R=0,O=0,B=0,N=0,k=0,F=0,V=0,j=0,G=(y=0,2);y<f;y++,G+=6)E=u[G],D=u[G+1],L=u[G+2],I=u[G+3],k=2*(R=.1875*(w-2*E+L))+(B=.09375*(3*(E-L)-w+(P=u[G+4]))),F=2*(O=.1875*(A-2*D+I))+(N=.09375*(3*(D-I)-A+(M=u[G+5]))),V=.75*(E-w)+R+.16666667*B,j=.75*(D-A)+O+.16666667*N,S+=Math.sqrt(V*V+j*j),V+=k,j+=F,k+=B,F+=N,S+=Math.sqrt(V*V+j*j),V+=k,j+=F,S+=Math.sqrt(V*V+j*j),V+=k+B,j+=F+N,S+=Math.sqrt(V*V+j*j),C[y]=S,w=P,A=M;if(l*=s?S:S/i.lengths[f-1],o)for(y=1;y<r;y++)c[y]*=S;for(var U=this.segments,Y=0,H=(y=0,v=0,b=0,0);y<r;y++,v+=3){var X;if(x=l+=X=c[y],d)(x%=S)<0&&(x+=S),b=0;else{if(x<0){this.addBeforePosition(x,u,0,h,v);continue}if(x>S){this.addAfterPosition(x-S,u,p-4,h,v);continue}}for(;;b++){var z=C[b];if(!(x>z)){0==b?x/=z:x=(x-(J=C[b-1]))/(z-J);break}}if(b!=_){_=b;var W=6*b;for(w=u[W],A=u[W+1],E=u[W+2],D=u[W+3],L=u[W+4],I=u[W+5],k=2*(R=.03*(w-2*E+L))+(B=.006*(3*(E-L)-w+(P=u[W+6]))),F=2*(O=.03*(A-2*D+I))+(N=.006*(3*(D-I)-A+(M=u[W+7]))),V=.3*(E-w)+R+.16666667*B,j=.3*(D-A)+O+.16666667*N,Y=Math.sqrt(V*V+j*j),U[0]=Y,W=1;W<8;W++)V+=k,j+=F,k+=B,F+=N,Y+=Math.sqrt(V*V+j*j),U[W]=Y;V+=k,j+=F,Y+=Math.sqrt(V*V+j*j),U[8]=Y,V+=k+B,j+=F+N,Y+=Math.sqrt(V*V+j*j),U[9]=Y,H=0}for(x*=Y;;H++){var Z=U[H];if(!(x>Z)){var J;0==H?x/=Z:x=H+(x-(J=U[H-1]))/(Z-J);break}}this.addCurvePosition(.1*x,w,A,E,D,L,I,P,M,h,v,n||y>0&&0==X)}return h},e.prototype.addBeforePosition=function(t,e,i,r,n){var s=e[i],o=e[i+1],a=e[i+2]-s,l=e[i+3]-o,c=Math.atan2(l,a);r[n]=s+t*Math.cos(c),r[n+1]=o+t*Math.sin(c),r[n+2]=c},e.prototype.addAfterPosition=function(t,e,i,r,n){var s=e[i+2],o=e[i+3],a=s-e[i],l=o-e[i+1],c=Math.atan2(l,a);r[n]=s+t*Math.cos(c),r[n+1]=o+t*Math.sin(c),r[n+2]=c},e.prototype.addCurvePosition=function(t,e,i,r,n,s,o,a,l,c,h,u){if(0==t||isNaN(t))return c[h]=e,c[h+1]=i,void(c[h+2]=Math.atan2(n-i,r-e));var d=t*t,p=d*t,f=1-t,_=f*f,m=_*f,g=f*t,y=3*g,v=f*y,b=y*t,x=e*m+r*v+s*b+a*p,T=i*m+n*v+o*b+l*p;c[h]=x,c[h+1]=T,u&&(c[h+2]=t<.001?Math.atan2(n-i,r-e):Math.atan2(T-(i*_+n*g*2+o*d),x-(e*_+r*g*2+s*d)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(n||(n={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i}return s(e,t),e}(t.ConstraintData);t.PathConstraintData=e,function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(t.PositionMode||(t.PositionMode={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(t.SpacingMode||(t.SpacingMode={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(t.RotateMode||(t.RotateMode={}))}(n||(n={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),i=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,i,r){var n=this.clientAssets[t];return null==n&&(n=new e(t),this.clientAssets[t]=n),null!==i&&(n.textureLoader=i),n.toLoad.push(r),this.queuedAssets[r]!==r&&(this.queuedAssets[r]=r,!0)},t.prototype.loadText=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=r.responseText:i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadJson=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=JSON.parse(r.responseText):i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadTexture=function(t,e,i){var r=this;if(i=this.pathPrefix+i,this.queueAsset(t,e,i)){var n=new Image;n.src=i,n.crossOrigin="anonymous",n.onload=function(){r.rawAssets[i]=n},n.onerror=function(){r.errors[i]="Couldn't load image "+i}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var i=this.clientAssets[t];return null==i||i.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e];if(null==t.assets[i]){var r=this.rawAssets[i];if(null==r)continue;r instanceof HTMLImageElement?t.assets[i]=t.textureLoader(r):t.assets[i]=r}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=i}(n||(n={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var i=0;i<e.bones.length;i++){var r=e.bones[i],n=void 0;if(null==r.parent)n=new t.Bone(r,this,null);else{var s=this.bones[r.parent.index];n=new t.Bone(r,this,s),s.children.push(n)}this.bones.push(n)}for(this.slots=new Array,this.drawOrder=new Array,i=0;i<e.slots.length;i++){var o=e.slots[i],a=(n=this.bones[o.boneData.index],new t.Slot(o,n));this.slots.push(a),this.drawOrder.push(a)}for(this.ikConstraints=new Array,i=0;i<e.ikConstraints.length;i++){var l=e.ikConstraints[i];this.ikConstraints.push(new t.IkConstraint(l,this))}for(this.transformConstraints=new Array,i=0;i<e.transformConstraints.length;i++){var c=e.transformConstraints[i];this.transformConstraints.push(new t.TransformConstraint(c,this))}for(this.pathConstraints=new Array,i=0;i<e.pathConstraints.length;i++){var h=e.pathConstraints[i];this.pathConstraints.push(new t.PathConstraint(h,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(n=t[e]).sorted=n.data.skinRequired,n.active=!n.sorted;if(null!=this.skin){var r=this.skin.bones;for(e=0,i=this.skin.bones.length;e<i;e++){var n=this.bones[r[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(null!=n)}}var s=this.ikConstraints,o=this.transformConstraints,a=this.pathConstraints,l=s.length,c=o.length,h=a.length,u=l+c+h;t:for(e=0;e<u;e++){for(var d=0;d<l;d++)if((p=s[d]).data.order==e){this.sortIkConstraint(p);continue t}for(d=0;d<c;d++)if((p=o[d]).data.order==e){this.sortTransformConstraint(p);continue t}for(d=0;d<h;d++){var p;if((p=a[d]).data.order==e){this.sortPathConstraint(p);continue t}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target;this.sortBone(i);var r=e.bones,n=r[0];if(this.sortBone(n),r.length>1){var s=r[r.length-1];this._updateCache.indexOf(s)>-1||this.updateCacheReset.push(s)}this._updateCache.push(e),this.sortReset(n.children),r[r.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target,r=i.data.index,n=i.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(var s=0,o=this.data.skins.length;s<o;s++)this.sortPathConstraintAttachment(this.data.skins[s],r,n);var a=i.getAttachment();a instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(a,n);var l=e.bones,c=l.length;for(s=0;s<c;s++)this.sortBone(l[s]);for(this._updateCache.push(e),s=0;s<c;s++)this.sortReset(l[s].children);for(s=0;s<c;s++)l[s].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var i=e.bones,r=i.length;if(e.data.local)for(var n=0;n<r;n++){var s=i[n];this.sortBone(s.parent),this._updateCache.indexOf(s)>-1||this.updateCacheReset.push(s)}else for(n=0;n<r;n++)this.sortBone(i[n]);this._updateCache.push(e);for(var o=0;o<r;o++)this.sortReset(i[o].children);for(o=0;o<r;o++)i[o].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,i){var r=t.attachments[e];if(r)for(var n in r)this.sortPathConstraintAttachmentWith(r[n],i)},e.prototype.sortPathConstraintAttachmentWith=function(e,i){if(e instanceof t.PathAttachment){var r=e.bones;if(null==r)this.sortBone(i);else for(var n=this.bones,s=0;s<r.length;)for(var o=r[s++],a=s+o;s<a;s++){var l=r[s];this.sortBone(n[l])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}var n=this._updateCache;for(e=0,i=n.length;e<i;e++)n[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,i=r.length;e<i;e++)(a=r[e]).mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch;var n=this.transformConstraints;for(e=0,i=n.length;e<i;e++){var s=(a=n[e]).data;a.rotateMix=s.rotateMix,a.translateMix=s.translateMix,a.scaleMix=s.scaleMix,a.shearMix=s.shearMix}var o=this.pathConstraints;for(e=0,i=o.length;e<i;e++){var a;s=(a=o[e]).data,a.position=s.position,a.spacing=s.spacing,a.rotateMix=s.rotateMix,a.translateMix=s.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var i=0,r=e.length;i<r;i++)e[i].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i],s=n.data.attachmentName;if(null!=s){var o=t.getAttachment(i,s);null!=o&&n.setAttachment(o)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,r=0,n=i.length;r<n;r++){var s=i[r];if(s.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(o)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.getBounds=function(e,i,r){if(void 0===r&&(r=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==i)throw new Error("size cannot be null.");for(var n=this.drawOrder,s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=0,h=n.length;c<h;c++){var u=n[c];if(u.bone.active){var d=0,p=null,f=u.getAttachment();if(f instanceof t.RegionAttachment)d=8,p=t.Utils.setArraySize(r,d,0),f.computeWorldVertices(u.bone,p,0,2);else if(f instanceof t.MeshAttachment){var _=f;d=_.worldVerticesLength,p=t.Utils.setArraySize(r,d,0),_.computeWorldVertices(u,0,d,p,0,2)}if(null!=p)for(var m=0,g=p.length;m<g;m+=2){var y=p[m],v=p[m+1];s=Math.min(s,y),o=Math.min(o,v),a=Math.max(a,y),l=Math.max(l,v)}}}e.set(s,o),i.set(a-s,l-o)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(n||(n={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(r){var n=this.scale,s=new t.SkeletonData;s.name="";var o=new i(r);s.hash=o.readString(),s.version=o.readString(),s.x=o.readFloat(),s.y=o.readFloat(),s.width=o.readFloat(),s.height=o.readFloat();var a=o.readBoolean();a&&(s.fps=o.readFloat(),s.imagesPath=o.readString(),s.audioPath=o.readString());var l=0;l=o.readInt(!0);for(var c=0;c<l;c++)o.strings.push(o.readString());for(l=o.readInt(!0),c=0;c<l;c++){var h=o.readString(),u=0==c?null:s.bones[o.readInt(!0)];(f=new t.BoneData(c,h,u)).rotation=o.readFloat(),f.x=o.readFloat()*n,f.y=o.readFloat()*n,f.scaleX=o.readFloat(),f.scaleY=o.readFloat(),f.shearX=o.readFloat(),f.shearY=o.readFloat(),f.length=o.readFloat()*n,f.transformMode=e.TransformModeValues[o.readInt(!0)],f.skinRequired=o.readBoolean(),a&&t.Color.rgba8888ToColor(f.color,o.readInt32()),s.bones.push(f)}for(l=o.readInt(!0),c=0;c<l;c++){var d=o.readString(),p=s.bones[o.readInt(!0)],f=new t.SlotData(c,d,p);t.Color.rgba8888ToColor(f.color,o.readInt32());var _=o.readInt32();-1!=_&&t.Color.rgb888ToColor(f.darkColor=new t.Color,_),f.attachmentName=o.readStringRef(),f.blendMode=e.BlendModeValues[o.readInt(!0)],s.slots.push(f)}l=o.readInt(!0),c=0;for(var m=void 0;c<l;c++){(f=new t.IkConstraintData(o.readString())).order=o.readInt(!0),f.skinRequired=o.readBoolean(),m=o.readInt(!0);for(var g=0;g<m;g++)f.bones.push(s.bones[o.readInt(!0)]);f.target=s.bones[o.readInt(!0)],f.mix=o.readFloat(),f.softness=o.readFloat()*n,f.bendDirection=o.readByte(),f.compress=o.readBoolean(),f.stretch=o.readBoolean(),f.uniform=o.readBoolean(),s.ikConstraints.push(f)}for(l=o.readInt(!0),c=0,m=void 0;c<l;c++){for((f=new t.TransformConstraintData(o.readString())).order=o.readInt(!0),f.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)f.bones.push(s.bones[o.readInt(!0)]);f.target=s.bones[o.readInt(!0)],f.local=o.readBoolean(),f.relative=o.readBoolean(),f.offsetRotation=o.readFloat(),f.offsetX=o.readFloat()*n,f.offsetY=o.readFloat()*n,f.offsetScaleX=o.readFloat(),f.offsetScaleY=o.readFloat(),f.offsetShearY=o.readFloat(),f.rotateMix=o.readFloat(),f.translateMix=o.readFloat(),f.scaleMix=o.readFloat(),f.shearMix=o.readFloat(),s.transformConstraints.push(f)}for(l=o.readInt(!0),c=0,m=void 0;c<l;c++){for((f=new t.PathConstraintData(o.readString())).order=o.readInt(!0),f.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)f.bones.push(s.bones[o.readInt(!0)]);f.target=s.slots[o.readInt(!0)],f.positionMode=e.PositionModeValues[o.readInt(!0)],f.spacingMode=e.SpacingModeValues[o.readInt(!0)],f.rotateMode=e.RotateModeValues[o.readInt(!0)],f.offsetRotation=o.readFloat(),f.position=o.readFloat(),f.positionMode==t.PositionMode.Fixed&&(f.position*=n),f.spacing=o.readFloat(),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=n),f.rotateMix=o.readFloat(),f.translateMix=o.readFloat(),s.pathConstraints.push(f)}var y=this.readSkin(o,s,!0,a);for(null!=y&&(s.defaultSkin=y,s.skins.push(y)),c=s.skins.length,t.Utils.setArraySize(s.skins,l=c+o.readInt(!0));c<l;c++)s.skins[c]=this.readSkin(o,s,!1,a);for(l=this.linkedMeshes.length,c=0;c<l;c++){var v=this.linkedMeshes[c],b=null==v.skin?s.defaultSkin:s.findSkin(v.skin);if(null==b)throw new Error("Skin not found: "+v.skin);var x=b.getAttachment(v.slotIndex,v.parent);if(null==x)throw new Error("Parent mesh not found: "+v.parent);v.mesh.deformAttachment=v.inheritDeform?x:v.mesh,v.mesh.setParentMesh(x),v.mesh.updateUVs()}for(this.linkedMeshes.length=0,l=o.readInt(!0),c=0;c<l;c++)(f=new t.EventData(o.readStringRef())).intValue=o.readInt(!1),f.floatValue=o.readFloat(),f.stringValue=o.readString(),f.audioPath=o.readString(),null!=f.audioPath&&(f.volume=o.readFloat(),f.balance=o.readFloat()),s.events.push(f);for(l=o.readInt(!0),c=0;c<l;c++)s.animations.push(this.readAnimation(o,o.readString(),s));return s},e.prototype.readSkin=function(e,i,r,n){var s=null,o=0;if(r){if(0==(o=e.readInt(!0)))return null;s=new t.Skin("default")}else{(s=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var a=0,l=s.bones.length;a<l;a++)s.bones[a]=i.bones[e.readInt(!0)];for(a=0,l=e.readInt(!0);a<l;a++)s.constraints.push(i.ikConstraints[e.readInt(!0)]);for(a=0,l=e.readInt(!0);a<l;a++)s.constraints.push(i.transformConstraints[e.readInt(!0)]);for(a=0,l=e.readInt(!0);a<l;a++)s.constraints.push(i.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(a=0;a<o;a++)for(var c=e.readInt(!0),h=0,u=e.readInt(!0);h<u;h++){var d=e.readStringRef(),p=this.readAttachment(e,i,s,c,d,n);null!=p&&s.setAttachment(c,d,p)}return s},e.prototype.readAttachment=function(i,n,s,o,a,l){var c=this.scale,h=i.readStringRef();null==h&&(h=a);var u=i.readByte();switch(e.AttachmentTypeValues[u]){case t.AttachmentType.Region:var d=i.readStringRef(),p=i.readFloat(),f=i.readFloat(),_=i.readFloat(),m=i.readFloat(),g=i.readFloat(),y=i.readFloat(),v=i.readFloat(),b=i.readInt32();null==d&&(d=h);var x=this.attachmentLoader.newRegionAttachment(s,h,d);return null==x?null:(x.path=d,x.x=f*c,x.y=_*c,x.scaleX=m,x.scaleY=g,x.rotation=p,x.width=y*c,x.height=v*c,t.Color.rgba8888ToColor(x.color,b),x.updateOffset(),x);case t.AttachmentType.BoundingBox:var T=i.readInt(!0),C=this.readVertices(i,T),S=(b=l?i.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(s,h));return null==S?null:(S.worldVerticesLength=T<<1,S.vertices=C.vertices,S.bones=C.bones,l&&t.Color.rgba8888ToColor(S.color,b),S);case t.AttachmentType.Mesh:d=i.readStringRef(),b=i.readInt32(),T=i.readInt(!0);var w=this.readFloatArray(i,T<<1,1),A=this.readShortArray(i),E=(C=this.readVertices(i,T),i.readInt(!0)),D=null;return y=0,v=0,l&&(D=this.readShortArray(i),y=i.readFloat(),v=i.readFloat()),null==d&&(d=h),null==(L=this.attachmentLoader.newMeshAttachment(s,h,d))?null:(L.path=d,t.Color.rgba8888ToColor(L.color,b),L.bones=C.bones,L.vertices=C.vertices,L.worldVerticesLength=T<<1,L.triangles=A,L.regionUVs=w,L.updateUVs(),L.hullLength=E<<1,l&&(L.edges=D,L.width=y*c,L.height=v*c),L);case t.AttachmentType.LinkedMesh:d=i.readStringRef(),b=i.readInt32();var L,I=i.readStringRef(),P=i.readStringRef(),M=i.readBoolean();return y=0,v=0,l&&(y=i.readFloat(),v=i.readFloat()),null==d&&(d=h),null==(L=this.attachmentLoader.newMeshAttachment(s,h,d))?null:(L.path=d,t.Color.rgba8888ToColor(L.color,b),l&&(L.width=y*c,L.height=v*c),this.linkedMeshes.push(new r(L,I,o,P,M)),L);case t.AttachmentType.Path:for(var R=i.readBoolean(),O=i.readBoolean(),B=(T=i.readInt(!0),C=this.readVertices(i,T),t.Utils.newArray(T/3,0)),N=0,k=B.length;N<k;N++)B[N]=i.readFloat()*c;return b=l?i.readInt32():0,null==(d=this.attachmentLoader.newPathAttachment(s,h))?null:(d.closed=R,d.constantSpeed=O,d.worldVerticesLength=T<<1,d.vertices=C.vertices,d.bones=C.bones,d.lengths=B,l&&t.Color.rgba8888ToColor(d.color,b),d);case t.AttachmentType.Point:p=i.readFloat(),f=i.readFloat(),_=i.readFloat(),b=l?i.readInt32():0;var F=this.attachmentLoader.newPointAttachment(s,h);return null==F?null:(F.x=f*c,F.y=_*c,F.rotation=p,l&&t.Color.rgba8888ToColor(F.color,b),F);case t.AttachmentType.Clipping:var V=i.readInt(!0),j=(T=i.readInt(!0),C=this.readVertices(i,T),b=l?i.readInt32():0,this.attachmentLoader.newClippingAttachment(s,h));return null==j?null:(j.endSlot=n.slots[V],j.worldVerticesLength=T<<1,j.vertices=C.vertices,j.bones=C.bones,l&&t.Color.rgba8888ToColor(j.color,b),j)}return null},e.prototype.readVertices=function(e,i){var r=i<<1,s=new n,o=this.scale;if(!e.readBoolean())return s.vertices=this.readFloatArray(e,r,o),s;for(var a=new Array,l=new Array,c=0;c<i;c++){var h=e.readInt(!0);l.push(h);for(var u=0;u<h;u++)l.push(e.readInt(!0)),a.push(e.readFloat()*o),a.push(e.readFloat()*o),a.push(e.readFloat())}return s.vertices=t.Utils.toFloatArray(a),s.bones=l,s},e.prototype.readFloatArray=function(t,e,i){var r=new Array(e);if(1==i)for(var n=0;n<e;n++)r[n]=t.readFloat();else for(n=0;n<e;n++)r[n]=t.readFloat()*i;return r},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),r=0;r<e;r++)i[r]=t.readShort();return i},e.prototype.readAnimation=function(i,r,n){for(var s=new Array,o=this.scale,a=0,l=new t.Color,c=new t.Color,h=0,u=i.readInt(!0);h<u;h++)for(var d=i.readInt(!0),p=0,f=i.readInt(!0);p<f;p++){var _=i.readByte(),m=i.readInt(!0);switch(_){case e.SLOT_ATTACHMENT:(b=new t.AttachmentTimeline(m)).slotIndex=d;for(var g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readStringRef());s.push(b),a=Math.max(a,b.frames[m-1]);break;case e.SLOT_COLOR:for((b=new t.ColorTimeline(m)).slotIndex=d,g=0;g<m;g++){var y=i.readFloat();t.Color.rgba8888ToColor(l,i.readInt32()),b.setFrame(g,y,l.r,l.g,l.b,l.a),g<m-1&&this.readCurve(i,g,b)}s.push(b),a=Math.max(a,b.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((b=new t.TwoColorTimeline(m)).slotIndex=d,g=0;g<m;g++)y=i.readFloat(),t.Color.rgba8888ToColor(l,i.readInt32()),t.Color.rgb888ToColor(c,i.readInt32()),b.setFrame(g,y,l.r,l.g,l.b,l.a,c.r,c.g,c.b),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var v=i.readInt(!0);for(p=0,f=i.readInt(!0);p<f;p++)switch(_=i.readByte(),m=i.readInt(!0),_){case e.BONE_ROTATE:for((b=new t.RotateTimeline(m)).boneIndex=v,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat()),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var b=void 0,x=1;for(_==e.BONE_SCALE?b=new t.ScaleTimeline(m):_==e.BONE_SHEAR?b=new t.ShearTimeline(m):(b=new t.TranslateTimeline(m),x=o),b.boneIndex=v,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat()*x,i.readFloat()*x),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var T=i.readInt(!0);for(m=i.readInt(!0),(b=new t.IkConstraintTimeline(m)).ikConstraintIndex=T,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat(),i.readFloat()*o,i.readByte(),i.readBoolean(),i.readBoolean()),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(h=0,u=i.readInt(!0);h<u;h++){for(T=i.readInt(!0),m=i.readInt(!0),(b=new t.TransformConstraintTimeline(m)).transformConstraintIndex=T,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat()),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(h=0,u=i.readInt(!0);h<u;h++){T=i.readInt(!0);var C=n.pathConstraints[T];for(p=0,f=i.readInt(!0);p<f;p++)switch(_=i.readByte(),m=i.readInt(!0),_){case e.PATH_POSITION:case e.PATH_SPACING:for(b=void 0,x=1,_==e.PATH_SPACING?(b=new t.PathConstraintSpacingTimeline(m),C.spacingMode!=t.SpacingMode.Length&&C.spacingMode!=t.SpacingMode.Fixed||(x=o)):(b=new t.PathConstraintPositionTimeline(m),C.positionMode==t.PositionMode.Fixed&&(x=o)),b.pathConstraintIndex=T,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat()*x),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((b=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=T,g=0;g<m;g++)b.setFrame(g,i.readFloat(),i.readFloat(),i.readFloat()),g<m-1&&this.readCurve(i,g,b);s.push(b),a=Math.max(a,b.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(h=0,u=i.readInt(!0);h<u;h++){var S=n.skins[i.readInt(!0)];for(p=0,f=i.readInt(!0);p<f;p++){d=i.readInt(!0);for(var w=0,A=i.readInt(!0);w<A;w++){var E=S.getAttachment(d,i.readStringRef()),D=null!=E.bones,L=E.vertices,I=D?L.length/3*2:L.length;for(m=i.readInt(!0),(b=new t.DeformTimeline(m)).slotIndex=d,b.attachment=E,g=0;g<m;g++){y=i.readFloat();var P=void 0,M=i.readInt(!0);if(0==M)P=D?t.Utils.newFloatArray(I):L;else{P=t.Utils.newFloatArray(I);var R=i.readInt(!0);if(M+=R,1==o)for(var O=R;O<M;O++)P[O]=i.readFloat();else for(O=R;O<M;O++)P[O]=i.readFloat()*o;if(!D){O=0;for(var B=P.length;O<B;O++)P[O]+=L[O]}}b.setFrame(g,y,P),g<m-1&&this.readCurve(i,g,b)}s.push(b),a=Math.max(a,b.frames[m-1])}}}var N=i.readInt(!0);if(N>0){b=new t.DrawOrderTimeline(N);var k=n.slots.length;for(h=0;h<N;h++){y=i.readFloat();var F=i.readInt(!0),V=t.Utils.newArray(k,0);for(p=k-1;p>=0;p--)V[p]=-1;var j=t.Utils.newArray(k-F,0),G=0,U=0;for(p=0;p<F;p++){for(d=i.readInt(!0);G!=d;)j[U++]=G++;V[G+i.readInt(!0)]=G++}for(;G<k;)j[U++]=G++;for(p=k-1;p>=0;p--)-1==V[p]&&(V[p]=j[--U]);b.setFrame(h,y,V)}s.push(b),a=Math.max(a,b.frames[N-1])}var Y=i.readInt(!0);if(Y>0){for(b=new t.EventTimeline(Y),h=0;h<Y;h++){y=i.readFloat();var H=n.events[i.readInt(!0)],X=new t.Event(y,H);X.intValue=i.readInt(!1),X.floatValue=i.readFloat(),X.stringValue=i.readBoolean()?i.readString():H.stringValue,null!=X.data.audioPath&&(X.volume=i.readFloat(),X.balance=i.readFloat()),b.setFrame(h,X)}s.push(b),a=Math.max(a,b.frames[Y-1])}return new t.Animation(r,s,a)},e.prototype.readCurve=function(t,i,r){switch(t.readByte()){case e.CURVE_STEPPED:r.setStepped(i);break;case e.CURVE_BEZIER:this.setCurve(r,i,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,i,r,n,s){t.setCurve(e,i,r,n,s)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var i=function(){function t(t,e,i,r){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===r&&(r=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=r}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return!!(128&e)&&(i|=(127&(e=this.readByte()))<<7,!!(128&e)&&(i|=(127&(e=this.readByte()))<<14,!!(128&e)&&(i|=(127&(e=this.readByte()))<<21,!!(128&e)&&(i|=(127&(e=this.readByte()))<<28)))),t?i:i>>>1^-(1&i)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var r=this.readByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&r)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(r),i++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),r=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n},n=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(n||(n={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,i){if(null==e)throw new Error("skeleton cannot be null.");var r=this.boundingBoxes,n=this.polygons,s=this.polygonPool,o=e.slots,a=o.length;r.length=0,s.freeAll(n),n.length=0;for(var l=0;l<a;l++){var c=o[l];if(c.bone.active){var h=c.getAttachment();if(h instanceof t.BoundingBoxAttachment){var u=h;r.push(u);var d=s.obtain();d.length!=u.worldVerticesLength&&(d=t.Utils.newFloatArray(u.worldVerticesLength)),n.push(d),u.computeWorldVertices(c,0,u.worldVerticesLength,d,0,2)}}}i?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=this.polygons,s=0,o=n.length;s<o;s++)for(var a=n[s],l=a,c=0,h=a.length;c<h;c+=2){var u=l[c],d=l[c+1];t=Math.min(t,u),e=Math.min(e,d),i=Math.max(i,u),r=Math.max(r,d)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=r},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,i,r){var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(t<=n&&i<=n||e<=s&&r<=s||t>=o&&i>=o||e>=a&&r>=a)return!1;var l=(r-e)/(i-t),c=l*(n-t)+e;if(c>s&&c<a)return!0;if((c=l*(o-t)+e)>s&&c<a)return!0;var h=(s-e)/l+t;return h>n&&h<o||(h=(a-e)/l+t)>n&&h<o},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var i=this.polygons,r=0,n=i.length;r<n;r++)if(this.containsPointPolygon(i[r],t,e))return this.boundingBoxes[r];return null},e.prototype.containsPointPolygon=function(t,e,i){for(var r=t,n=t.length,s=n-2,o=!1,a=0;a<n;a+=2){var l=r[a+1],c=r[s+1];if(l<i&&c>=i||c<i&&l>=i){var h=r[a];h+(i-l)/(c-l)*(r[s]-h)<e&&(o=!o)}s=a}return o},e.prototype.intersectsSegment=function(t,e,i,r){for(var n=this.polygons,s=0,o=n.length;s<o;s++)if(this.intersectsSegmentPolygon(n[s],t,e,i,r))return this.boundingBoxes[s];return null},e.prototype.intersectsSegmentPolygon=function(t,e,i,r,n){for(var s=t,o=t.length,a=e-r,l=i-n,c=e*n-i*r,h=s[o-2],u=s[o-1],d=0;d<o;d+=2){var p=s[d],f=s[d+1],_=h*f-u*p,m=h-p,g=u-f,y=a*g-l*m,v=(c*m-a*_)/y;if((v>=h&&v<=p||v>=p&&v<=h)&&(v>=e&&v<=r||v>=r&&v<=e)){var b=(c*g-l*_)/y;if((b>=u&&b<=f||b>=f&&b<=u)&&(b>=i&&b<=n||b>=n&&b<=i))return!0}h=p,u=f}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(n||(n={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(i,r){if(null!=this.clipAttachment)return 0;this.clipAttachment=r;var n=r.worldVerticesLength,s=t.Utils.setArraySize(this.clippingPolygon,n);r.computeWorldVertices(i,0,n,s,0,2);var o=this.clippingPolygon;e.makeClockwise(o);for(var a=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),l=0,c=a.length;l<c;l++){var h=a[l];e.makeClockwise(h),h.push(h[0]),h.push(h[1])}return a.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,i,r,n,s,o,a,l,c,h,u,d){var p=this.clipOutput,f=this.clippedVertices,_=this.clippedTriangles,m=this.clippingPolygons,g=this.clippingPolygons.length,y=l?12:8,v=0;h=h||0,u=u||0,d=d||0,f.length=0,_.length=0;t:for(var b=h,x=h+n;b<x;b+=3){var T=r[b]*c,C=T+u,S=T+d,w=e[C],A=e[C+1],E=s[S],D=s[S+1];S=(T=r[b+1]*c)+d;var L=e[C=T+u],I=e[C+1],P=s[S],M=s[S+1];S=(T=r[b+2]*c)+d;for(var R=e[C=T+u],O=e[C+1],B=s[S],N=s[S+1],k=0;k<g;k++){var F=f.length;if(!this.clip(w,A,L,I,R,O,m[k],p)){(W=t.Utils.setArraySize(f,F+3*y))[F]=w,W[F+1]=A,W[F+2]=o.r,W[F+3]=o.g,W[F+4]=o.b,W[F+5]=o.a,l?(W[F+6]=E,W[F+7]=D,W[F+8]=a.r,W[F+9]=a.g,W[F+10]=a.b,W[F+11]=a.a,W[F+12]=L,W[F+13]=I,W[F+14]=o.r,W[F+15]=o.g,W[F+16]=o.b,W[F+17]=o.a,W[F+18]=P,W[F+19]=M,W[F+20]=a.r,W[F+21]=a.g,W[F+22]=a.b,W[F+23]=a.a,W[F+24]=R,W[F+25]=O,W[F+26]=o.r,W[F+27]=o.g,W[F+28]=o.b,W[F+29]=o.a,W[F+30]=B,W[F+31]=N,W[F+32]=a.r,W[F+33]=a.g,W[F+34]=a.b,W[F+35]=a.a):(W[F+6]=E,W[F+7]=D,W[F+8]=L,W[F+9]=I,W[F+10]=o.r,W[F+11]=o.g,W[F+12]=o.b,W[F+13]=o.a,W[F+14]=P,W[F+15]=M,W[F+16]=R,W[F+17]=O,W[F+18]=o.r,W[F+19]=o.g,W[F+20]=o.b,W[F+21]=o.a,W[F+22]=B,W[F+23]=N),F=_.length,(it=t.Utils.setArraySize(_,F+3))[F]=v,it[F+1]=v+1,it[F+2]=v+2,v+=3;continue t}var V=p.length;if(0!=V){for(var j=I-O,G=R-L,U=w-R,Y=O-A,H=1/(j*U+G*(A-O)),X=V>>1,z=this.clipOutput,W=t.Utils.setArraySize(f,F+X*y),Z=0;Z<V;Z+=2){var J=z[Z],q=z[Z+1];W[F]=J,W[F+1]=q,W[F+2]=o.r,W[F+3]=o.g,W[F+4]=o.b,W[F+5]=o.a;var K=J-R,Q=q-O,$=(j*K+G*Q)*H,tt=(Y*K+U*Q)*H,et=1-$-tt;W[F+6]=E*$+P*tt+B*et,W[F+7]=D*$+M*tt+N*et,l&&(W[F+8]=a.r,W[F+9]=a.g,W[F+10]=a.b,W[F+11]=a.a),F+=y}F=_.length;var it=t.Utils.setArraySize(_,F+3*(X-2));for(X--,Z=1;Z<X;Z++)it[F]=v,it[F+1]=v+Z,it[F+2]=v+Z+1,F+=3;v+=X+1}}}},e.prototype.clip=function(t,e,i,r,n,s,o,a){var l=a,c=!1,h=null;o.length%4>=2?(h=a,a=this.scratch):h=this.scratch,h.length=0,h.push(t),h.push(e),h.push(i),h.push(r),h.push(n),h.push(s),h.push(t),h.push(e),a.length=0;for(var u=o,d=o.length-4,p=0;;p+=2){for(var f=u[p],_=u[p+1],m=u[p+2],g=u[p+3],y=f-m,v=_-g,b=h,x=h.length-2,T=a.length,C=0;C<x;C+=2){var S=b[C],w=b[C+1],A=b[C+2],E=b[C+3],D=y*(E-g)-v*(A-m)>0;if(y*(w-g)-v*(S-m)>0){if(D){a.push(A),a.push(E);continue}var L=(P=E-w)*(m-f)-(M=A-S)*(g-_);if(Math.abs(L)>1e-6){var I=(M*(_-w)-P*(f-S))/L;a.push(f+(m-f)*I),a.push(_+(g-_)*I)}else a.push(f),a.push(_)}else if(D){var P,M;L=(P=E-w)*(m-f)-(M=A-S)*(g-_),Math.abs(L)>1e-6?(I=(M*(_-w)-P*(f-S))/L,a.push(f+(m-f)*I),a.push(_+(g-_)*I)):(a.push(f),a.push(_)),a.push(A),a.push(E)}c=!0}if(T==a.length)return l.length=0,!0;if(a.push(a[0]),a.push(a[1]),p==d)break;var R=a;(a=h).length=0,h=R}if(l!=a){l.length=0,p=0;for(var O=a.length-2;p<O;p++)l[p]=a[p]}else l.length=l.length-2;return c},e.makeClockwise=function(t){for(var e=t,i=t.length,r=e[i-2]*e[1]-e[0]*e[i-1],n=0,s=0,o=0,a=0,l=i-3;a<l;a+=2)n=e[a],s=e[a+1],o=e[a+2],r+=n*e[a+3]-o*s;if(!(r<0)){a=0;var c=i-2;for(l=i>>1;a<l;a+=2){var h=e[a],u=e[a+1],d=c-a;e[a]=e[d],e[a+1]=e[d+1],e[d]=h,e[d+1]=u}}},e}();t.SkeletonClipping=e}(n||(n={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t}();t.SkeletonData=e}(n||(n={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,n=new t.SkeletonData,s="string"==typeof i?JSON.parse(i):i,o=s.skeleton;if(null!=o&&(n.hash=o.hash,n.version=o.spine,n.x=o.x,n.y=o.y,n.width=o.width,n.height=o.height,n.fps=o.fps,n.imagesPath=o.images),s.bones)for(var a=0;a<s.bones.length;a++){var l=s.bones[a],c=null,h=this.getValue(l,"parent",null);if(null!=h&&null==(c=n.findBone(h)))throw new Error("Parent bone not found: "+h);(f=new t.BoneData(n.bones.length,l.name,c)).length=this.getValue(l,"length",0)*r,f.x=this.getValue(l,"x",0)*r,f.y=this.getValue(l,"y",0)*r,f.rotation=this.getValue(l,"rotation",0),f.scaleX=this.getValue(l,"scaleX",1),f.scaleY=this.getValue(l,"scaleY",1),f.shearX=this.getValue(l,"shearX",0),f.shearY=this.getValue(l,"shearY",0),f.transformMode=e.transformModeFromString(this.getValue(l,"transform","normal")),f.skinRequired=this.getValue(l,"skin",!1),n.bones.push(f)}if(s.slots)for(a=0;a<s.slots.length;a++){var u=(L=s.slots[a]).name,d=L.bone,p=n.findBone(d);if(null==p)throw new Error("Slot bone not found: "+d);var f=new t.SlotData(n.slots.length,u,p),_=this.getValue(L,"color",null);null!=_&&f.color.setFromString(_);var m=this.getValue(L,"dark",null);null!=m&&(f.darkColor=new t.Color(1,1,1,1),f.darkColor.setFromString(m)),f.attachmentName=this.getValue(L,"attachment",null),f.blendMode=e.blendModeFromString(this.getValue(L,"blend","normal")),n.slots.push(f)}if(s.ik)for(a=0;a<s.ik.length;a++){var g=s.ik[a];(f=new t.IkConstraintData(g.name)).order=this.getValue(g,"order",0),f.skinRequired=this.getValue(g,"skin",!1);for(var y=0;y<g.bones.length;y++){if(d=g.bones[y],null==(A=n.findBone(d)))throw new Error("IK bone not found: "+d);f.bones.push(A)}var v=g.target;if(f.target=n.findBone(v),null==f.target)throw new Error("IK target bone not found: "+v);f.mix=this.getValue(g,"mix",1),f.softness=this.getValue(g,"softness",0)*r,f.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,f.compress=this.getValue(g,"compress",!1),f.stretch=this.getValue(g,"stretch",!1),f.uniform=this.getValue(g,"uniform",!1),n.ikConstraints.push(f)}if(s.transform)for(a=0;a<s.transform.length;a++){for(g=s.transform[a],(f=new t.TransformConstraintData(g.name)).order=this.getValue(g,"order",0),f.skinRequired=this.getValue(g,"skin",!1),y=0;y<g.bones.length;y++){if(d=g.bones[y],null==(A=n.findBone(d)))throw new Error("Transform constraint bone not found: "+d);f.bones.push(A)}if(v=g.target,f.target=n.findBone(v),null==f.target)throw new Error("Transform constraint target bone not found: "+v);f.local=this.getValue(g,"local",!1),f.relative=this.getValue(g,"relative",!1),f.offsetRotation=this.getValue(g,"rotation",0),f.offsetX=this.getValue(g,"x",0)*r,f.offsetY=this.getValue(g,"y",0)*r,f.offsetScaleX=this.getValue(g,"scaleX",0),f.offsetScaleY=this.getValue(g,"scaleY",0),f.offsetShearY=this.getValue(g,"shearY",0),f.rotateMix=this.getValue(g,"rotateMix",1),f.translateMix=this.getValue(g,"translateMix",1),f.scaleMix=this.getValue(g,"scaleMix",1),f.shearMix=this.getValue(g,"shearMix",1),n.transformConstraints.push(f)}if(s.path)for(a=0;a<s.path.length;a++){for(g=s.path[a],(f=new t.PathConstraintData(g.name)).order=this.getValue(g,"order",0),f.skinRequired=this.getValue(g,"skin",!1),y=0;y<g.bones.length;y++){if(d=g.bones[y],null==(A=n.findBone(d)))throw new Error("Transform constraint bone not found: "+d);f.bones.push(A)}if(v=g.target,f.target=n.findSlot(v),null==f.target)throw new Error("Path target slot not found: "+v);f.positionMode=e.positionModeFromString(this.getValue(g,"positionMode","percent")),f.spacingMode=e.spacingModeFromString(this.getValue(g,"spacingMode","length")),f.rotateMode=e.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),f.offsetRotation=this.getValue(g,"rotation",0),f.position=this.getValue(g,"position",0),f.positionMode==t.PositionMode.Fixed&&(f.position*=r),f.spacing=this.getValue(g,"spacing",0),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=r),f.rotateMix=this.getValue(g,"rotateMix",1),f.translateMix=this.getValue(g,"translateMix",1),n.pathConstraints.push(f)}if(s.skins){var b=s.skins;if(!(b instanceof Array)){var x=[];for(var T in b)x.push({name:T,attachments:b[T]});b=x}for(a=0;a<b.length;a++){var C=b[a],S=new t.Skin(C.name);if(C.bones)for(var w=0;w<C.bones.length;w++){var A;if(null==(A=n.findBone(C.bones[w])))throw new Error("Skin bone not found: "+C.bones[a]);S.bones.push(A)}if(C.ik)for(w=0;w<C.ik.length;w++){if(null==(E=n.findIkConstraint(C.ik[w])))throw new Error("Skin IK constraint not found: "+C.ik[a]);S.constraints.push(E)}if(C.transform)for(w=0;w<C.transform.length;w++){if(null==(E=n.findTransformConstraint(C.transform[w])))throw new Error("Skin transform constraint not found: "+C.transform[a]);S.constraints.push(E)}if(C.path)for(w=0;w<C.path.length;w++){var E;if(null==(E=n.findPathConstraint(C.path[w])))throw new Error("Skin path constraint not found: "+C.path[a]);S.constraints.push(E)}for(var u in C.attachments){var D=n.findSlot(u);if(null==D)throw new Error("Slot not found: "+u);var L=C.attachments[u];for(var I in L){var P=this.readAttachment(L[I],S,D.index,I,n);null!=P&&S.setAttachment(D.index,I,P)}}n.skins.push(S),"default"==S.name&&(n.defaultSkin=S)}}a=0;for(var M=this.linkedMeshes.length;a<M;a++){var R=this.linkedMeshes[a];if(null==(S=null==R.skin?n.defaultSkin:n.findSkin(R.skin)))throw new Error("Skin not found: "+R.skin);var O=S.getAttachment(R.slotIndex,R.parent);if(null==O)throw new Error("Parent mesh not found: "+R.parent);R.mesh.deformAttachment=R.inheritDeform?O:R.mesh,R.mesh.setParentMesh(O),R.mesh.updateUVs()}if(this.linkedMeshes.length=0,s.events)for(var B in s.events){var N=s.events[B];(f=new t.EventData(B)).intValue=this.getValue(N,"int",0),f.floatValue=this.getValue(N,"float",0),f.stringValue=this.getValue(N,"string",""),f.audioPath=this.getValue(N,"audio",null),null!=f.audioPath&&(f.volume=this.getValue(N,"volume",1),f.balance=this.getValue(N,"balance",0)),n.events.push(f)}if(s.animations)for(var k in s.animations){var F=s.animations[k];this.readAnimation(F,k,n)}return n},e.prototype.readAttachment=function(e,r,n,s,o){var a=this.scale;switch(s=this.getValue(e,"name",s),this.getValue(e,"type","region")){case"region":var l=this.getValue(e,"path",s),c=this.attachmentLoader.newRegionAttachment(r,s,l);return null==c?null:(c.path=l,c.x=this.getValue(e,"x",0)*a,c.y=this.getValue(e,"y",0)*a,c.scaleX=this.getValue(e,"scaleX",1),c.scaleY=this.getValue(e,"scaleY",1),c.rotation=this.getValue(e,"rotation",0),c.width=e.width*a,c.height=e.height*a,null!=(v=this.getValue(e,"color",null))&&c.color.setFromString(v),c.updateOffset(),c);case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(r,s);return null==h?null:(this.readVertices(e,h,e.vertexCount<<1),null!=(v=this.getValue(e,"color",null))&&h.color.setFromString(v),h);case"mesh":case"linkedmesh":l=this.getValue(e,"path",s);var u=this.attachmentLoader.newMeshAttachment(r,s,l);if(null==u)return null;u.path=l,null!=(v=this.getValue(e,"color",null))&&u.color.setFromString(v),u.width=this.getValue(e,"width",0)*a,u.height=this.getValue(e,"height",0)*a;var d=this.getValue(e,"parent",null);if(null!=d)return this.linkedMeshes.push(new i(u,this.getValue(e,"skin",null),n,d,this.getValue(e,"deform",!0))),u;var p=e.uvs;return this.readVertices(e,u,p.length),u.triangles=e.triangles,u.regionUVs=p,u.updateUVs(),u.edges=this.getValue(e,"edges",null),u.hullLength=2*this.getValue(e,"hull",0),u;case"path":if(null==(l=this.attachmentLoader.newPathAttachment(r,s)))return null;l.closed=this.getValue(e,"closed",!1),l.constantSpeed=this.getValue(e,"constantSpeed",!0);var f=e.vertexCount;this.readVertices(e,l,f<<1);for(var _=t.Utils.newArray(f/3,0),m=0;m<e.lengths.length;m++)_[m]=e.lengths[m]*a;return l.lengths=_,null!=(v=this.getValue(e,"color",null))&&l.color.setFromString(v),l;case"point":var g=this.attachmentLoader.newPointAttachment(r,s);return null==g?null:(g.x=this.getValue(e,"x",0)*a,g.y=this.getValue(e,"y",0)*a,g.rotation=this.getValue(e,"rotation",0),null!=(v=this.getValue(e,"color",null))&&g.color.setFromString(v),g);case"clipping":var y=this.attachmentLoader.newClippingAttachment(r,s);if(null==y)return null;var v,b=this.getValue(e,"end",null);if(null!=b){var x=o.findSlot(b);if(null==x)throw new Error("Clipping end slot not found: "+b);y.endSlot=x}return f=e.vertexCount,this.readVertices(e,y,f<<1),null!=(v=this.getValue(e,"color",null))&&y.color.setFromString(v),y}return null},e.prototype.readVertices=function(e,i,r){var n=this.scale;i.worldVerticesLength=r;var s=e.vertices;if(r!=s.length){var o=new Array,a=new Array;for(u=0,d=s.length;u<d;){var l=s[u++];a.push(l);for(var c=u+4*l;u<c;u+=4)a.push(s[u]),o.push(s[u+1]*n),o.push(s[u+2]*n),o.push(s[u+3])}i.bones=a,i.vertices=t.Utils.toFloatArray(o)}else{var h=t.Utils.toFloatArray(s);if(1!=n)for(var u=0,d=s.length;u<d;u++)h[u]*=n;i.vertices=h}},e.prototype.readAnimation=function(e,i,r){var n=this.scale,s=new Array,o=0;if(e.slots)for(var a in e.slots){var l=e.slots[a];if(-1==(K=r.findSlotIndex(a)))throw new Error("Slot not found: "+a);for(var c in l){var h=l[c];if("attachment"==c){(b=new t.AttachmentTimeline(h.length)).slotIndex=K;for(var u=0,d=0;d<h.length;d++){var p=h[d];b.setFrame(u++,this.getValue(p,"time",0),p.name)}s.push(b),o=Math.max(o,b.frames[b.getFrameCount()-1])}else if("color"==c){for((b=new t.ColorTimeline(h.length)).slotIndex=K,u=0,d=0;d<h.length;d++){p=h[d];var f=new t.Color;f.setFromString(p.color),b.setFrame(u,this.getValue(p,"time",0),f.r,f.g,f.b,f.a),this.readCurve(p,b,u),u++}s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=c)throw new Error("Invalid timeline type for a slot: "+c+" ("+a+")");for((b=new t.TwoColorTimeline(h.length)).slotIndex=K,u=0,d=0;d<h.length;d++){p=h[d];var _=new t.Color,m=new t.Color;_.setFromString(p.light),m.setFromString(p.dark),b.setFrame(u,this.getValue(p,"time",0),_.r,_.g,_.b,_.a,m.r,m.g,m.b),this.readCurve(p,b,u),u++}s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var g in e.bones){var y=e.bones[g],v=r.findBoneIndex(g);if(-1==v)throw new Error("Bone not found: "+g);for(var c in y)if(h=y[c],"rotate"===c){for((b=new t.RotateTimeline(h.length)).boneIndex=v,u=0,d=0;d<h.length;d++)p=h[d],b.setFrame(u,this.getValue(p,"time",0),this.getValue(p,"angle",0)),this.readCurve(p,b,u),u++;s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==c&&"scale"!==c&&"shear"!==c)throw new Error("Invalid timeline type for a bone: "+c+" ("+g+")");var b=null,x=1,T=0;for("scale"===c?(b=new t.ScaleTimeline(h.length),T=1):"shear"===c?b=new t.ShearTimeline(h.length):(b=new t.TranslateTimeline(h.length),x=n),b.boneIndex=v,u=0,d=0;d<h.length;d++){p=h[d];var C=this.getValue(p,"x",T),S=this.getValue(p,"y",T);b.setFrame(u,this.getValue(p,"time",0),C*x,S*x),this.readCurve(p,b,u),u++}s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var w in e.ik){var A=e.ik[w],E=r.findIkConstraint(w);for((b=new t.IkConstraintTimeline(A.length)).ikConstraintIndex=r.ikConstraints.indexOf(E),u=0,d=0;d<A.length;d++)p=A[d],b.setFrame(u,this.getValue(p,"time",0),this.getValue(p,"mix",1),this.getValue(p,"softness",0)*n,this.getValue(p,"bendPositive",!0)?1:-1,this.getValue(p,"compress",!1),this.getValue(p,"stretch",!1)),this.readCurve(p,b,u),u++;s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var w in e.transform){for(A=e.transform[w],E=r.findTransformConstraint(w),(b=new t.TransformConstraintTimeline(A.length)).transformConstraintIndex=r.transformConstraints.indexOf(E),u=0,d=0;d<A.length;d++)p=A[d],b.setFrame(u,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1),this.getValue(p,"scaleMix",1),this.getValue(p,"shearMix",1)),this.readCurve(p,b,u),u++;s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var D=e.path||e.paths;if(D)for(var w in D){A=D[w];var L=r.findPathConstraintIndex(w);if(-1==L)throw new Error("Path constraint not found: "+w);var I=r.pathConstraints[L];for(var c in A)if(h=A[c],"position"===c||"spacing"===c){for(b=null,x=1,"spacing"===c?(b=new t.PathConstraintSpacingTimeline(h.length),I.spacingMode!=t.SpacingMode.Length&&I.spacingMode!=t.SpacingMode.Fixed||(x=n)):(b=new t.PathConstraintPositionTimeline(h.length),I.positionMode==t.PositionMode.Fixed&&(x=n)),b.pathConstraintIndex=L,u=0,d=0;d<h.length;d++)p=h[d],b.setFrame(u,this.getValue(p,"time",0),this.getValue(p,c,0)*x),this.readCurve(p,b,u),u++;s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===c){for((b=new t.PathConstraintMixTimeline(h.length)).pathConstraintIndex=L,u=0,d=0;d<h.length;d++)p=h[d],b.setFrame(u,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1)),this.readCurve(p,b,u),u++;s.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var P in e.deform){var M=e.deform[P],R=r.findSkin(P);if(null==R)throw new Error("Skin not found: "+P);for(var a in M){if(l=M[a],-1==(K=r.findSlotIndex(a)))throw new Error("Slot not found: "+l.name);for(var c in l){h=l[c];var O=R.getAttachment(K,c);if(null!=O){var B=null!=O.bones,N=O.vertices,k=B?N.length/3*2:N.length;(b=new t.DeformTimeline(h.length)).slotIndex=K,b.attachment=O,u=0;for(var F=0;F<h.length;F++){p=h[F];var V=void 0,j=this.getValue(p,"vertices",null);if(null==j)V=B?t.Utils.newFloatArray(k):N;else{V=t.Utils.newFloatArray(k);var G=this.getValue(p,"offset",0);if(t.Utils.arrayCopy(j,0,V,G,j.length),1!=n)for(var U=(d=G)+j.length;d<U;d++)V[d]*=n;if(!B)for(d=0;d<k;d++)V[d]+=N[d]}b.setFrame(u,this.getValue(p,"time",0),V),this.readCurve(p,b,u),u++}s.push(b),o=Math.max(o,b.frames[b.getFrameCount()-1])}}}}var Y=e.drawOrder;if(null==Y&&(Y=e.draworder),null!=Y){b=new t.DrawOrderTimeline(Y.length);var H=r.slots.length;for(u=0,F=0;F<Y.length;F++){var X=Y[F],z=null,W=this.getValue(X,"offsets",null);if(null!=W){z=t.Utils.newArray(H,-1);var Z=t.Utils.newArray(H-W.length,0),J=0,q=0;for(d=0;d<W.length;d++){var K,Q=W[d];if(-1==(K=r.findSlotIndex(Q.slot)))throw new Error("Slot not found: "+Q.slot);for(;J!=K;)Z[q++]=J++;z[J+Q.offset]=J++}for(;J<H;)Z[q++]=J++;for(d=H-1;d>=0;d--)-1==z[d]&&(z[d]=Z[--q])}b.setFrame(u++,this.getValue(X,"time",0),z)}s.push(b),o=Math.max(o,b.frames[b.getFrameCount()-1])}if(e.events){for(b=new t.EventTimeline(e.events.length),u=0,d=0;d<e.events.length;d++){var $=e.events[d],tt=r.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),b.setFrame(u++,et)}s.push(b),o=Math.max(o,b.frames[b.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new t.Animation(i,s,o))},e.prototype.readCurve=function(t,e,i){var r=t.curve;r&&("stepped"==r?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(r)?e.setCurve(i,r[0],r[1],r[2],r[3]):e.setCurve(i,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var i=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n}}(n||(n={})),function(t){var e=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i};t.SkinEntry=e;var i=function(){function i(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return i.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=i},i.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],r=!1,n=0;n<this.bones.length;n++)if(this.bones[n]==i){r=!0;break}r||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,n=0;n<this.constraints.length;n++)if(this.constraints[n]==s){r=!0;break}r||this.constraints.push(s)}var o=t.getAttachments();for(e=0;e<o.length;e++){var a=o[e];this.setAttachment(a.slotIndex,a.name,a.attachment)}},i.prototype.copySkin=function(e){for(var i=0;i<e.bones.length;i++){for(var r=e.bones[i],n=!1,s=0;s<this.bones.length;s++)if(this.bones[s]==r){n=!0;break}n||this.bones.push(r)}for(i=0;i<e.constraints.length;i++){var o=e.constraints[i];for(n=!1,s=0;s<this.constraints.length;s++)if(this.constraints[s]==o){n=!0;break}n||this.constraints.push(o)}var a=e.getAttachments();for(i=0;i<a.length;i++){var l=a[i];null!=l.attachment&&(l.attachment instanceof t.MeshAttachment?(l.attachment=l.attachment.newLinkedMesh(),this.setAttachment(l.slotIndex,l.name,l.attachment)):(l.attachment=l.attachment.copy(),this.setAttachment(l.slotIndex,l.name,l.attachment)))}},i.prototype.getAttachment=function(t,e){var i=this.attachments[t];return i?i[e]:null},i.prototype.removeAttachment=function(t,e){var i=this.attachments[t];i&&(i[e]=null)},i.prototype.getAttachments=function(){for(var t=new Array,i=0;i<this.attachments.length;i++){var r=this.attachments[i];if(r)for(var n in r){var s=r[n];s&&t.push(new e(i,n,s))}}return t},i.prototype.getAttachmentsForSlot=function(t,i){var r=this.attachments[t];if(r)for(var n in r){var s=r[n];s&&i.push(new e(t,n,s))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(t,e){for(var i=0,r=0;r<t.slots.length;r++){var n=t.slots[r],s=n.getAttachment();if(s&&i<e.attachments.length){var o=e.attachments[i];for(var a in o)if(s==o[a]){var l=this.getAttachment(i,a);null!=l&&n.setAttachment(l);break}}i++}},i}();t.Skin=i}(n||(n={})),function(t){var e=function(){function e(e,i){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("bone cannot be null.");this.data=e,this.bone=i,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(n||(n={})),function(t){t.SlotData=function(e,i,r){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=e,this.name=i,this.boneData=r}}(n||(n={})),function(t){var e,i,r=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=r,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(i=t.TextureWrap||(t.TextureWrap={})),t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(r);t.FakeTexture=n}(n||(n={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,s){if(null==s)throw new Error("textureLoader cannot be null.");for(var o=new i(e),a=new Array(4),l=null;;){var c=o.readLine();if(null==c)break;if(0==(c=c.trim()).length)l=null;else if(l){var h=new n;h.name=c,h.page=l;var u=o.readValue();"true"==u.toLocaleLowerCase()?h.degrees=90:"false"==u.toLocaleLowerCase()?h.degrees=0:h.degrees=parseFloat(u),h.rotate=90==h.degrees,o.readTuple(a);var d=parseInt(a[0]),p=parseInt(a[1]);o.readTuple(a);var f=parseInt(a[0]),_=parseInt(a[1]);h.u=d/l.width,h.v=p/l.height,h.rotate?(h.u2=(d+_)/l.width,h.v2=(p+f)/l.height):(h.u2=(d+f)/l.width,h.v2=(p+_)/l.height),h.x=d,h.y=p,h.width=Math.abs(f),h.height=Math.abs(_),4==o.readTuple(a)&&4==o.readTuple(a)&&o.readTuple(a),h.originalWidth=parseInt(a[0]),h.originalHeight=parseInt(a[1]),o.readTuple(a),h.offsetX=parseInt(a[0]),h.offsetY=parseInt(a[1]),h.index=parseInt(o.readValue()),h.texture=l.texture,this.regions.push(h)}else{(l=new r).name=c,2==o.readTuple(a)&&(l.width=parseInt(a[0]),l.height=parseInt(a[1]),o.readTuple(a)),o.readTuple(a),l.minFilter=t.Texture.filterFromString(a[0]),l.magFilter=t.Texture.filterFromString(a[1]);var m=o.readValue();l.uWrap=t.TextureWrap.ClampToEdge,l.vWrap=t.TextureWrap.ClampToEdge,"x"==m?l.uWrap=t.TextureWrap.Repeat:"y"==m?l.vWrap=t.TextureWrap.Repeat:"xy"==m&&(l.uWrap=l.vWrap=t.TextureWrap.Repeat),l.texture=s(c),l.texture.setFilters(l.minFilter,l.magFilter),l.texture.setWraps(l.uWrap,l.vWrap),l.width=l.texture.getImage().width,l.height=l.texture.getImage().height,this.pages.push(l)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var i=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var r=0,n=i+1;r<3;r++){var s=e.indexOf(",",n);if(-1==s)break;t[r]=e.substr(n,s-n).trim(),n=s+1}return t[r]=e.substring(n).trim(),r+1},t}(),r=function(){};t.TextureAtlasPage=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=n}(n||(n={})),function(t){var e=function(){function e(e,i){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var r=0;r<e.bones.length;r++)this.bones.push(i.findBone(e.bones[r].name));this.target=i.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,o=s.a,a=s.b,l=s.c,c=s.d,h=o*c-a*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,p=this.bones,f=0,_=p.length;f<_;f++){var m=p[f],g=!1;if(0!=e){var y=m.a,v=m.b,b=m.c,x=m.d;(E=Math.atan2(l,o)-Math.atan2(b,y)+u)>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E*=e;var T=Math.cos(E),C=Math.sin(E);m.a=T*y-C*b,m.b=T*v-C*x,m.c=C*y+T*b,m.d=C*v+T*x,g=!0}if(0!=i){var S=this.temp;s.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(S.x-m.worldX)*i,m.worldY+=(S.y-m.worldY)*i,g=!0}if(r>0){var w=Math.sqrt(m.a*m.a+m.c*m.c),A=Math.sqrt(o*o+l*l);w>1e-5&&(w=(w+(A-w+this.data.offsetScaleX)*r)/w),m.a*=w,m.c*=w,w=Math.sqrt(m.b*m.b+m.d*m.d),A=Math.sqrt(a*a+c*c),w>1e-5&&(w=(w+(A-w+this.data.offsetScaleY)*r)/w),m.b*=w,m.d*=w,g=!0}if(n>0){v=m.b,x=m.d;var E,D=Math.atan2(x,v);(E=Math.atan2(c,a)-Math.atan2(l,o)-(D-Math.atan2(m.c,m.a)))>t.MathUtils.PI?E-=t.MathUtils.PI2:E<-t.MathUtils.PI&&(E+=t.MathUtils.PI2),E=D+(E+d)*n,w=Math.sqrt(v*v+x*x),m.b=Math.cos(E)*w,m.d=Math.sin(E)*w,g=!0}g&&(m.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,o=s.a,a=s.b,l=s.c,c=s.d,h=o*c-a*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,p=this.bones,f=0,_=p.length;f<_;f++){var m,g=p[f],y=!1;if(0!=e){var v=g.a,b=g.b,x=g.c,T=g.d;(m=Math.atan2(l,o)+u)>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),m*=e;var C=Math.cos(m),S=Math.sin(m);g.a=C*v-S*x,g.b=C*b-S*T,g.c=S*v+C*x,g.d=S*b+C*T,y=!0}if(0!=i){var w=this.temp;s.localToWorld(w.set(this.data.offsetX,this.data.offsetY)),g.worldX+=w.x*i,g.worldY+=w.y*i,y=!0}if(r>0){var A=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleX)*r+1;g.a*=A,g.c*=A,A=(Math.sqrt(a*a+c*c)-1+this.data.offsetScaleY)*r+1,g.b*=A,g.d*=A,y=!0}n>0&&((m=Math.atan2(c,a)-Math.atan2(l,o))>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),b=g.b,T=g.d,m=Math.atan2(T,b)+(m-t.MathUtils.PI/2+d)*n,A=Math.sqrt(b*b+T*T),g.b=Math.cos(m)*A,g.d=Math.sin(m)*A,y=!0),y&&(g.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var s=this.bones,o=0,a=s.length;o<a;o++){var l=s[o];l.appliedValid||l.updateAppliedTransform();var c=l.arotation;if(0!=t){var h=n.arotation-c+this.data.offsetRotation;c+=(h-=360*(16384-(16384.499999999996-h/360|0)))*t}var u=l.ax,d=l.ay;0!=e&&(u+=(n.ax-u+this.data.offsetX)*e,d+=(n.ay-d+this.data.offsetY)*e);var p=l.ascaleX,f=l.ascaleY;0!=i&&(p>1e-5&&(p=(p+(n.ascaleX-p+this.data.offsetScaleX)*i)/p),f>1e-5&&(f=(f+(n.ascaleY-f+this.data.offsetScaleY)*i)/f));var _=l.ashearY;0!=r&&(h=n.ashearY-_+this.data.offsetShearY,h-=360*(16384-(16384.499999999996-h/360|0)),l.shearY+=h*r),l.updateWorldTransformWith(u,d,c,p,f,l.ashearX,_)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var s=this.bones,o=0,a=s.length;o<a;o++){var l=s[o];l.appliedValid||l.updateAppliedTransform();var c=l.arotation;0!=t&&(c+=(n.arotation+this.data.offsetRotation)*t);var h=l.ax,u=l.ay;0!=e&&(h+=(n.ax+this.data.offsetX)*e,u+=(n.ay+this.data.offsetY)*e);var d=l.ascaleX,p=l.ascaleY;0!=i&&(d>1e-5&&(d*=(n.ascaleX-1+this.data.offsetScaleX)*i+1),p>1e-5&&(p*=(n.ascaleY-1+this.data.offsetScaleY)*i+1));var f=l.ashearY;0!=r&&(f+=(n.ashearY+this.data.offsetShearY)*r),l.updateWorldTransformWith(h,u,c,d,p,l.ashearX,f)}},e}();t.TransformConstraint=e}(n||(n={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return s(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(n||(n={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var i=t,r=t.length>>1,n=this.indicesArray;n.length=0;for(var s=0;s<r;s++)n[s]=s;var o=this.isConcaveArray;o.length=0,s=0;for(var a=r;s<a;++s)o[s]=e.isConcave(s,r,i,n);var l=this.triangles;for(l.length=0;r>3;){for(var c=r-1,h=(s=0,1);;){t:if(!o[s]){for(var u=n[c]<<1,d=n[s]<<1,p=n[h]<<1,f=i[u],_=i[u+1],m=i[d],g=i[d+1],y=i[p],v=i[p+1],b=(h+1)%r;b!=c;b=(b+1)%r)if(o[b]){var x=n[b]<<1,T=i[x],C=i[x+1];if(e.positiveArea(y,v,f,_,T,C)&&e.positiveArea(f,_,m,g,T,C)&&e.positiveArea(m,g,y,v,T,C))break t}break}if(0==h){do{if(!o[s])break;s--}while(s>0);break}c=s,s=h,h=(h+1)%r}l.push(n[(r+s-1)%r]),l.push(n[s]),l.push(n[(s+1)%r]),n.splice(s,1),o.splice(s,1);var S=(--r+s-1)%r,w=s==r?0:s;o[S]=e.isConcave(S,r,i,n),o[w]=e.isConcave(w,r,i,n)}return 3==r&&(l.push(n[2]),l.push(n[0]),l.push(n[1])),l},e.prototype.decompose=function(t,i){var r=t,n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var s=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(s),s.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var a=this.polygonPool.obtain();a.length=0;for(var l=-1,c=0,h=0,u=i.length;h<u;h+=3){var d=i[h]<<1,p=i[h+1]<<1,f=i[h+2]<<1,_=r[d],m=r[d+1],g=r[p],y=r[p+1],v=r[f],b=r[f+1],x=!1;if(l==d){var T=a.length-4,C=e.winding(a[T],a[T+1],a[T+2],a[T+3],v,b),S=e.winding(v,b,a[0],a[1],a[2],a[3]);C==c&&S==c&&(a.push(v),a.push(b),o.push(f),x=!0)}x||(a.length>0?(n.push(a),s.push(o)):(this.polygonPool.free(a),this.polygonIndicesPool.free(o)),(a=this.polygonPool.obtain()).length=0,a.push(_),a.push(m),a.push(g),a.push(y),a.push(v),a.push(b),(o=this.polygonIndicesPool.obtain()).length=0,o.push(d),o.push(p),o.push(f),c=e.winding(_,m,g,y,v,b),l=d)}for(a.length>0&&(n.push(a),s.push(o)),h=0,u=n.length;h<u;h++)if(0!=(o=s[h]).length)for(var w=o[0],A=o[o.length-1],E=(a=n[h])[T=a.length-4],D=a[T+1],L=a[T+2],I=a[T+3],P=a[0],M=a[1],R=a[2],O=a[3],B=e.winding(E,D,L,I,P,M),N=0;N<u;N++)if(N!=h){var k=s[N];if(3==k.length){var F=k[0],V=k[1],j=k[2],G=n[N];v=G[G.length-2],b=G[G.length-1],F==w&&V==A&&(C=e.winding(E,D,L,I,v,b),S=e.winding(v,b,P,M,R,O),C==B&&S==B&&(G.length=0,k.length=0,a.push(v),a.push(b),o.push(j),E=L,D=I,L=v,I=b,N=0))}}for(h=n.length-1;h>=0;h--)0==(a=n[h]).length&&(n.splice(h,1),this.polygonPool.free(a),o=s[h],s.splice(h,1),this.polygonIndicesPool.free(o));return n},e.isConcave=function(t,e,i,r){var n=r[(e+t-1)%e]<<1,s=r[t]<<1,o=r[(t+1)%e]<<1;return!this.positiveArea(i[n],i[n+1],i[s],i[s+1],i[o],i[o+1])},e.positiveArea=function(t,e,i,r,n,s){return t*(s-r)+i*(e-s)+n*(r-e)>=0},e.winding=function(t,e,i,r,n,s){var o=i-t,a=r-e;return n*a-s*o+o*e-t*a>=0?1:-1},e}();t.Triangulator=e}(n||(n={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var i=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.r=t,this.g=e,this.b=i,this.a=r}return t.prototype.set=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,r){return this.r+=t,this.g+=e,this.b+=i,this.a+=r,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=i;var r=function(){function t(){}return t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))},t.randomTriangularWith=function(t,e,i){var r=Math.random(),n=e-t;return r<=(i-t)/n?t+Math.sqrt(r*n*(i-t)):e-Math.sqrt((1-r)*n*(e-i))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=r;var n=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}();t.Interpolation=n;var o=function(t){function e(e){var i=t.call(this)||this;return i.power=2,i.power=e,i}return s(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(n);t.Pow=o;var a=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(o);t.PowOut=a;var l=function(){function t(){}return t.arrayCopy=function(t,e,i,r,n){for(var s=e,o=r;s<e+n;s++,o++)i[o]=t[s]},t.setArraySize=function(t,e,i){void 0===i&&(i=0);var r=t.length;if(r==e)return t;if(t.length=e,r<e)for(var n=r;n<e;n++)t[n]=i;return t},t.ensureArrayCapacity=function(e,i,r){return void 0===r&&(r=0),e.length>=i?e:t.setArraySize(e,i,r)},t.newArray=function(t,e){for(var i=new Array(t),r=0;r<t;r++)i[r]=e;return i},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e,i){for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=l;var c=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t}();t.DebugUtils=c;var h=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=h;var u=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=u;var d=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=d;var p=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=p}(n||(n={})),Math.fround||(Math.fround=(r=new Float32Array(1),function(t){return r[0]=t,r[0]})),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var i=function(e){function i(t){var r=e.call(this,t)||this;return r.id=(65535&i.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return s(i,e),i.prototype.computeWorldVertices=function(t,e,i,r,n,s){i=n+(i>>1)*s;var o=t.bone.skeleton,a=t.deform,l=this.vertices,c=this.bones;if(null!=c){for(var h=0,u=0,d=0;d<e;d+=2)h+=(m=c[h])+1,u+=m;var p=o.bones;if(0==a.length)for(D=n,S=3*u;D<i;D+=s){var f=0,_=0,m=c[h++];for(m+=h;h<m;h++,S+=3){b=p[c[h]],L=l[S],I=l[S+1];var g=l[S+2];f+=(L*b.a+I*b.b+b.worldX)*g,_+=(L*b.c+I*b.d+b.worldY)*g}r[D]=f,r[D+1]=_}else for(var y=a,v=(D=n,S=3*u,u<<1);D<i;D+=s){for(f=0,_=0,m=c[h++],m+=h;h<m;h++,S+=3,v+=2)b=p[c[h]],L=l[S]+y[v],I=l[S+1]+y[v+1],g=l[S+2],f+=(L*b.a+I*b.b+b.worldX)*g,_+=(L*b.c+I*b.d+b.worldY)*g;r[D]=f,r[D+1]=_}}else{a.length>0&&(l=a);for(var b,x=(b=t.bone).worldX,T=b.worldY,C=b.a,S=b.b,w=b.c,A=b.d,E=e,D=n;D<i;E+=2,D+=s){var L=l[E],I=l[E+1];r[D]=L*C+I*S+x,r[D+1]=L*w+I*A+T}}},i.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},i.nextID=0,i}(e);t.VertexAttachment=i}(n||(n={})),function(t){!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(t.AttachmentType||(t.AttachmentType={}))}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r}return s(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.BoundingBoxAttachment=e}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.2275,.2275,.8078,1),r}return s(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.ClippingAttachment=e}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r.tempColor=new t.Color(0,0,0,0),r}return s(i,e),i.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var i=this.uvs,r=this.uvs.length,n=this.region.u,s=this.region.v,o=0,a=0;if(this.region instanceof t.TextureAtlasRegion){var l=this.region,c=l.texture.getImage().width,h=l.texture.getImage().height;switch(l.degrees){case 90:n-=(l.originalHeight-l.offsetY-l.height)/c,s-=(l.originalWidth-l.offsetX-l.width)/h,o=l.originalHeight/c,a=l.originalWidth/h;for(var u=0;u<r;u+=2)i[u]=n+e[u+1]*o,i[u+1]=s+(1-e[u])*a;return;case 180:for(n-=(l.originalWidth-l.offsetX-l.width)/c,s-=l.offsetY/h,o=l.originalWidth/c,a=l.originalHeight/h,u=0;u<r;u+=2)i[u]=n+(1-e[u])*o,i[u+1]=s+(1-e[u+1])*a;return;case 270:for(n-=l.offsetY/c,s-=l.offsetX/h,o=l.originalHeight/c,a=l.originalWidth/h,u=0;u<r;u+=2)i[u]=n+(1-e[u+1])*o,i[u+1]=s+e[u]*a;return}n-=l.offsetX/c,s-=(l.originalHeight-l.offsetY-l.height)/h,o=l.originalWidth/c,a=l.originalHeight/h}else null==this.region?(n=s=0,o=a=1):(o=this.region.u2-n,a=this.region.v2-s);for(u=0;u<r;u+=2)i[u]=n+e[u]*o,i[u+1]=s+e[u+1]*a},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new i(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},i.prototype.newLinkedMesh=function(){var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},i}(t.VertexAttachment);t.MeshAttachment=e}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.closed=!1,r.constantSpeed=!1,r.color=new t.Color(1,1,1,1),r}return s(i,e),i.prototype.copy=function(){var e=new i(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},i}(t.VertexAttachment);t.PathAttachment=e}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.38,.94,0,1),r}return s(i,e),i.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},i.prototype.computeWorldRotation=function(e){var i=t.MathUtils.cosDeg(this.rotation),r=t.MathUtils.sinDeg(this.rotation),n=i*e.a+r*e.b,s=i*e.c+r*e.d;return Math.atan2(s,n)*t.MathUtils.radDeg},i.prototype.copy=function(){var t=new i(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.PointAttachment=e}(n||(n={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.x=0,r.y=0,r.scaleX=1,r.scaleY=1,r.rotation=0,r.width=0,r.height=0,r.color=new t.Color(1,1,1,1),r.offset=t.Utils.newFloatArray(8),r.uvs=t.Utils.newFloatArray(8),r.tempColor=new t.Color(1,1,1,1),r}return s(i,e),i.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,s=r+this.region.width*t,o=n+this.region.height*e,a=this.rotation*Math.PI/180,l=Math.cos(a),c=Math.sin(a),h=r*l+this.x,u=r*c,d=n*l+this.y,p=n*c,f=s*l+this.x,_=s*c,m=o*l+this.y,g=o*c,y=this.offset;y[i.OX1]=h-p,y[i.OY1]=d+u,y[i.OX2]=h-g,y[i.OY2]=m+u,y[i.OX3]=f-g,y[i.OY3]=m+_,y[i.OX4]=f-p,y[i.OY4]=d+_},i.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},i.prototype.computeWorldVertices=function(t,e,r,n){var s=this.offset,o=t.worldX,a=t.worldY,l=t.a,c=t.b,h=t.c,u=t.d,d=0,p=0;d=s[i.OX1],p=s[i.OY1],e[r]=d*l+p*c+o,e[r+1]=d*h+p*u+a,r+=n,d=s[i.OX2],p=s[i.OY2],e[r]=d*l+p*c+o,e[r+1]=d*h+p*u+a,r+=n,d=s[i.OX3],p=s[i.OY3],e[r]=d*l+p*c+o,e[r+1]=d*h+p*u+a,r+=n,d=s[i.OX4],p=s[i.OY4],e[r]=d*l+p*c+o,e[r+1]=d*h+p*u+a},i.prototype.copy=function(){var e=new i(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(t.Attachment);t.RegionAttachment=e}(n||(n={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(n||(n={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var i=this.angle*t.MathUtils.degreesToRadians,r=e.x-this.worldX,n=e.y-this.worldY,s=Math.sqrt(r*r+n*n);if(s<this.radius){var o=this.interpolation.apply(0,i,(this.radius-s)/this.radius),a=Math.cos(o),l=Math.sin(o);e.x=a*r-l*n+this.worldX,e.y=l*r+a*n+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(n||(n={})),e.exports=n},{}],375:[function(t,e){var i,r,n,s,o,a,l=t("./track-entry-listeners"),c=t("./lib/spine"),h=[],u=[],d=0,p=0,f=0,_=null,m=null,g=0,y=0,v=0,b=0,x=null,T=null,C=0,S=0,w=new c.Color(1,1,1,1),A=new c.Color(1,1,1,1),E=[0,1,2,2,3,0],D=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},bind:function(t){var e=function(t){t&&t.animation.name===this._animationName&&(this.isCompleted=!0)}.bind(this);t.complete=e},unbind:function(t){t.complete=null},begin:function(){if(this._invalid){var t=this._skeletonInfo,e=t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var i=t.skeleton,r=t.listener,n=t.state,s=i.data.findAnimation(this._animationName);n.setAnimationWith(0,s,!1),this.bind(r),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},_needToUpdate:function(t){return!this.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t)},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._skeletonInfo,i=e.skeleton,r=e.clipper,n=e.state;do{i.update(1/60),n.update(1/60),n.apply(i),i.updateWorldTransform(),this._frameIdx++,this._updateFrame(i,r,this._frameIdx),this.totalTime+=1/60}while(this._needToUpdate(t));this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(t,e,i){f=0,d=0,p=0,_=null,m=null,g=0,y=0,v=0,b=0,x=null,T=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var r=this.frames[i],n=this._tempSegments=r.segments,s=this._tempColors=r.colors,o=this._tempBoneInfos=r.boneInfos;this._traverseSkeleton(t,e),b>0&&(s[b-1].vfOffset=f),s.length=b,o.length=d;var a=v-1;if(a>=0)if(y>0){var l=n[a];l.indexCount=y,l.vfCount=6*g,l.vertexCount=g,n.length=v}else n.length=v-1;if(0!=n.length){var c=r.vertices,C=r.uintVert;(!c||c.length<f)&&(c=r.vertices=new Float32Array(f),C=r.uintVert=new Uint32Array(c.buffer));for(var S=0,w=0;S<f;)c[S++]=h[w++],c[S++]=h[w++],c[S++]=h[w++],c[S++]=h[w++],C[S++]=h[w++],C[S++]=h[w++];var A=r.indices;(!A||A.length<p)&&(A=r.indices=new Uint16Array(p));for(var E=0;E<p;E++)A[E]=u[E];r.vertices=c,r.uintVert=C,r.indices=A}},fillVertices:function(t,e,l,c,d){if(s=l.a*e.a*t.a*255,i=e.r*t.r*255,r=e.g*t.g*255,n=e.b*t.b*255,w.r=i*l.r,w.g=r*l.g,w.b=n*l.b,w.a=s,null==d.darkColor?A.set(0,0,0,1):(A.r=d.darkColor.r*i,A.g=d.darkColor.g*r,A.b=d.darkColor.b*n),A.a=0,o=(w.a<<24>>>0)+(w.b<<16)+(w.g<<8)+w.r,a=(A.a<<24>>>0)+(A.b<<16)+(A.g<<8)+A.r,x!==o||T!==a){var _=this._tempColors;x=o,T=a,b>0&&(_[b-1].vfOffset=f),_[b++]={fr:w.r,fg:w.g,fb:w.b,fa:w.a,dr:A.r,dg:A.g,db:A.b,da:A.a,vfOffset:0}}if(c.isClipping()){c.clipTriangles(h,C,u,S,h,w,A,!0,6,p,f,f+2);var m=c.clippedVertices,g=c.clippedTriangles;S=g.length,C=m.length/12*6;for(var y=0,v=p,E=g.length;y<E;)u[v++]=g[y++];for(var D=0,L=m.length,I=f;D<L;D+=12,I+=6)h[I]=m[D],h[I+1]=m[D+1],h[I+2]=m[D+6],h[I+3]=m[D+7],h[I+4]=o,h[I+5]=a}else for(var P=f,M=f+C;P<M;P+=6)h[P+4]=o,h[P+5]=a},_traverseSkeleton:function(t,e){var i,r,n,s,o,a,l,b,x,T,w,A,D=this._tempSegments,L=this._tempBoneInfos,I=t.color,P=t.bones;if(this._enableCacheAttachedInfo)for(var M=0,R=P.length;M<R;M++,d++){var O=P[M],B=L[d];B||(B=L[d]={}),B.a=O.a,B.b=O.b,B.c=O.c,B.d=O.d,B.worldX=O.worldX,B.worldY=O.worldY}for(var N=0,k=t.drawOrder.length;N<k;N++)if((A=t.drawOrder[N]).bone.active)if(C=0,S=0,i=A.getAttachment())if(a=i instanceof c.RegionAttachment,l=i instanceof c.MeshAttachment,i instanceof c.ClippingAttachment)e.clipStart(A,i);else if(a||l)if(b=i.region.texture._texture)if(w=A.data.blendMode,_===b.nativeUrl&&m===w||(_=b.nativeUrl,m=w,(x=v-1)>=0&&(y>0?((T=D[x]).indexCount=y,T.vertexCount=g,T.vfCount=6*g):v--),D[v]={tex:b,blendMode:w,indexCount:0,vertexCount:0,vfCount:0},v++,y=0,g=0),a?(o=E,C=24,S=6,i.computeWorldVertices(A.bone,h,f,6)):l&&(o=i.triangles,C=6*(i.worldVerticesLength>>1),S=o.length,i.computeWorldVertices(A,0,i.worldVerticesLength,h,f,6)),0!=C&&0!=S){for(var F=0,V=p,j=o.length;F<j;)u[V++]=o[F++];s=i.uvs;for(var G=f,U=f+C,Y=0;G<U;G+=6,Y+=2)h[G+2]=s[Y],h[G+3]=s[Y+1];if(r=i.color,n=A.color,this.fillVertices(I,r,n,e,A),S>0){for(var H=p,X=p+S;H<X;H++)u[H]+=g;p+=S,f+=C,y+=S,g+=C/6}e.clipEndWithSlot(A)}else e.clipEndWithSlot(A);else e.clipEndWithSlot(A);else e.clipEndWithSlot(A);else e.clipEndWithSlot(A);e.clipEnd()}}),L=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._skeletonCache={}},enablePrivateMode:function(){this._privateMode=!0},clear:function(){this._animationPool={},this._skeletonCache={}},removeSkeleton:function(t){var e=this._skeletonCache[t];if(e){var i=e.animationsCache;for(var r in i){var n=i[r];n&&(this._animationPool[t+"#"+r]=n,n.clear())}delete this._skeletonCache[t]}},getSkeletonCache:function(t,e){var i=this._skeletonCache[t];if(!i){var r=new c.Skeleton(e),n=new c.SkeletonClipping,s=new c.AnimationStateData(r.data),o=new c.AnimationState(s),a=new l;o.addListener(a),this._skeletonCache[t]=i={skeleton:r,clipper:n,state:o,listener:a,animationsCache:{},curAnimationCache:null}}return i},getAnimationCache:function(t,e){var i=this._skeletonCache[t];return i?i.animationsCache[e]:null},invalidAnimationCache:function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var i=e.animationsCache;for(var r in i)i[r].invalidAllFrame()}},initAnimationCache:function(t,e){if(!e)return null;var i=this._skeletonCache[t],r=i&&i.skeleton;if(!r)return null;if(!r.data.findAnimation(e))return null;var n=i.animationsCache,s=n[e];if(!s){var o=t+"#"+e;(s=this._animationPool[o])?delete this._animationPool[o]:(s=new D)._privateMode=this._privateMode,s.init(i,e),n[e]=s}return s},updateAnimationCache:function(t,e){if(e){var i=this.initAnimationCache(t,e);if(!i)return null;i.updateAllFrame()}else{var r=this._skeletonCache[t];if(!r||!r.skeleton)return;var n=r.animationsCache;for(var s in n)n[s].updateAllFrame()}}});L.FrameTime=1/60,L.sharedCache=new L,e.exports=L},{"./lib/spine":374,"./track-entry-listeners":379}],376:[function(t,e){var i=t("./skeleton-cache").sharedCache,r=cc.Class({name:"sp.SkeletonData",extends:cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},textures:{default:[],type:[cc.Texture2D]},textureNames:{default:[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer},set:function(t){this._buffer=t.buffer||t,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null},ensureTexturesLoaded:function(t,e){var i=this.textures,r=i.length;if(0!=r)for(var n=0,s=function(){++n>=r&&(t&&t.call(e,!0),t=null)},o=0;o<r;o++){var a=i[o];a.loaded?s():a.once("load",s)}else t.call(e,!1)},isTexturesLoaded:function(){for(var t=this.textures,e=t.length,i=0;i<e;i++)if(!t[i].loaded)return!1;return!0},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||cc.errorID(7507,this.name),null;var e=this._getAtlas(t);if(!e)return null;var i=new sp.spine.AtlasAttachmentLoader(e),r=null,n=null;return this.skeletonJson?(n=new sp.spine.SkeletonJson(i),r=this.skeletonJson):(n=new sp.spine.SkeletonBinary(i),r=new Uint8Array(this._nativeAsset)),n.scale=this.scale,this._skeletonCache=n.readSkeletonData(r),e.dispose(),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(t){for(var e=this.textureNames,i=0;i<e.length;i++)if(e[i]===t){var r=this.textures[i],n=new sp.SkeletonTexture({width:r.width,height:r.height});return n.setRealTexture(r),n}return cc.errorID(7506,t),null},_getAtlas:function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||cc.errorID(7508,this.name),null)},destroy:function(){i.removeSkeleton(this._uuid),this._super()}});sp.SkeletonData=e.exports=r},{"./skeleton-cache":375}],377:[function(){sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture",extends:sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(t){this._texture=t},getRealTexture:function(){return this._texture},setFilters:function(t,e){this._texture&&this._texture.setFilters(t,e)},setWraps:function(t,e){this._texture&&this._texture.setWrapMode(t,e)},dispose:function(){}})},{}],378:[function(t,e,i){i.__esModule=!0,i.default=void 0;var r,n=(r=t("../../cocos2d/core/renderer/assembler"))&&r.__esModule?r:{default:r};function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var o,a,l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C=t("./Skeleton"),S=t("./lib/spine"),w=t("../../cocos2d/core/renderer/render-flow"),A=t("../../cocos2d/core/renderer/webgl/vertex-format"),E=A.vfmtPosUvColor,D=A.vfmtPosUvTwoColor,L=cc.gfx,I=0,P=[0,1,2,2,3,0],M=cc.color(0,0,255,255),R=cc.color(255,0,0,255),O=cc.color(0,255,0,255),B=cc.color(255,255,0,255),N=null,k=null,F=null,V=null;N=new S.Color(1,1,1,1),k=new S.Color(1,1,1,1),F=new S.Vector2,V=new S.Vector2;var j,G,U,Y,H,X,z,W,Z,J,q,K,Q,$,tt,et,it,rt,nt,st,ot,at,lt,ct,ht,ut,dt,pt,ft,_t=0,mt=0,gt=0,yt=0,vt=0,bt=0,xt=0;function Tt(t,e){var i,r;switch(e){case S.BlendMode.Additive:i=o?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE;break;case S.BlendMode.Multiply:i=cc.macro.DST_COLOR,r=cc.macro.ONE_MINUS_SRC_ALPHA;break;case S.BlendMode.Screen:i=cc.macro.ONE,r=cc.macro.ONE_MINUS_SRC_COLOR;break;case S.BlendMode.Normal:default:i=o?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE_MINUS_SRC_ALPHA}var n=!ct.enableBatch,s=ct._materials[0];if(!s)return null;var a=t.getId()+i+r+h+n,l=ct._materialCache,c=l[a];return c||(l.baseMaterial?c=cc.MaterialVariant.create(s):(c=s,l.baseMaterial=s),c.define("CC_USE_MODEL",n),c.define("USE_TINT",h),c.setProperty("texture",t),c.setBlend(!0,L.BLEND_FUNC_ADD,i,r,L.BLEND_FUNC_ADD,i,r),l[a]=c),c}function Ct(t){st=t.fa*g,$=f*(a=o?st/255:1),tt=_*a,et=m*a,it=t.fr*$,rt=t.fg*tt,nt=t.fb*et,y=(st<<24>>>0)+(nt<<16)+(rt<<8)+it,ot=t.dr*$,at=t.dg*tt,lt=t.db*et,v=((o?255:0)<<24>>>0)+(lt<<16)+(at<<8)+ot}function St(t){return(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r}var wt=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,s(e,i);var n=r.prototype;return n.updateRenderData=function(t){if(!t.isAnimationCached()){var e=t._skeleton;e&&e.updateWorldTransform()}},n.fillVertices=function(t,e,i,r,n){var s,l=ht._vData,c=ht._iData,u=ht._uintVData;if(N.a=i.a*e.a*t.a*g*255,a=o?N.a:255,j=f*e.r*t.r*a,G=_*e.g*t.g*a,U=m*e.b*t.b*a,N.r=j*i.r,N.g=G*i.g,N.b=U*i.b,null==n.darkColor?k.set(0,0,0,1):(k.r=n.darkColor.r*j,k.g=n.darkColor.g*G,k.b=n.darkColor.b*U),k.a=o?255:0,r.isClipping()){var d=l.subarray(gt+2);r.clipTriangles(l.subarray(gt),_t,c.subarray(bt),vt,d,N,k,h,x);var p=new Float32Array(r.clippedVertices),b=r.clippedTriangles;if(vt=b.length,_t=p.length/T*x,s=ht.request(_t/x,vt),bt=s.indiceOffset,yt=s.vertexOffset,gt=s.byteOffset>>2,l=ht._vData,c=ht._iData,u=ht._uintVData,c.set(b,bt),ft)for(var C=0,S=p.length,w=gt;C<S;C+=T,w+=x)F.x=p[C],F.y=p[C+1],N.set(p[C+2],p[C+3],p[C+4],p[C+5]),V.x=p[C+6],V.y=p[C+7],h?k.set(p[C+8],p[C+9],p[C+10],p[C+11]):k.set(0,0,0,0),ft.transform(F,V,N,k),l[w]=F.x,l[w+1]=F.y,l[w+2]=V.x,l[w+3]=V.y,u[w+4]=St(N),h&&(u[w+5]=St(k));else for(var A=0,E=p.length,D=gt;A<E;A+=T,D+=x)l[D]=p[A],l[D+1]=p[A+1],l[D+2]=p[A+6],l[D+3]=p[A+7],y=(p[A+5]<<24>>>0)+(p[A+4]<<16)+(p[A+3]<<8)+p[A+2],u[D+4]=y,h&&(v=(p[A+11]<<24>>>0)+(p[A+10]<<16)+(p[A+9]<<8)+p[A+8],u[D+5]=v)}else if(ft)for(var L=gt,I=gt+_t;L<I;L+=x)F.x=l[L],F.y=l[L+1],V.x=l[L+2],V.y=l[L+3],ft.transform(F,V,N,k),l[L]=F.x,l[L+1]=F.y,l[L+2]=V.x,l[L+3]=V.y,u[L+4]=St(N),h&&(u[L+5]=St(k));else{y=St(N),v=St(k);for(var P=gt,M=gt+_t;P<M;P+=x)u[P+4]=y,h&&(u[P+5]=v)}},n.realTimeTraverse=function(t){var e,i,r,n,s,o,a,f,_,m,g,y,v=ct._skeleton,b=v.color,C=ct._debugRenderer,w=ct._clipper,A=null;l=ct._startSlotIndex,c=ct._endSlotIndex,Y=!1,-1==l&&(Y=!0),u=ct.debugSlots,d=ct.debugBones,p=ct.debugMesh,C&&(d||u||p)&&(C.clear(),C.lineWidth=2),T=h?12:8,_t=0,gt=0,yt=0,vt=0,bt=0;for(var E=0,D=v.drawOrder.length;E<D;E++)if(null!=(g=v.drawOrder[E])&&g.bone.active)if(l>=0&&l==g.data.index&&(Y=!0),Y)if(c>=0&&c==g.data.index&&(Y=!1),_t=0,vt=0,r=g.getAttachment())if(f=r instanceof S.RegionAttachment,_=r instanceof S.MeshAttachment,r instanceof S.ClippingAttachment)w.clipStart(g,r);else if(f||_)if(A=Tt(r.region.texture._texture,g.data.blendMode)){if((H||A.getHash()!==ut.material.getHash())&&(H=!1,ut._flush(),ut.node=dt,ut.material=A),f){if(a=P,_t=4*x,vt=6,m=ht.request(4,6),bt=m.indiceOffset,yt=m.vertexOffset,gt=m.byteOffset>>2,e=ht._vData,i=ht._iData,r.computeWorldVertices(g.bone,e,gt,x),C&&u){C.strokeColor=M,C.moveTo(e[gt],e[gt+1]);for(var L=gt+x,I=gt+_t;L<I;L+=x)C.lineTo(e[L],e[L+1]);C.close(),C.stroke()}}else if(_&&(a=r.triangles,_t=(r.worldVerticesLength>>1)*x,vt=a.length,m=ht.request(_t/x,vt),bt=m.indiceOffset,yt=m.vertexOffset,gt=m.byteOffset>>2,e=ht._vData,i=ht._iData,r.computeWorldVertices(g,0,r.worldVerticesLength,e,gt,x),C&&p)){C.strokeColor=B;for(var N=0,k=a.length;N<k;N+=3){var F=a[N]*x+gt,V=a[N+1]*x+gt,j=a[N+2]*x+gt;C.moveTo(e[F],e[F+1]),C.lineTo(e[V],e[V+1]),C.lineTo(e[j],e[j+1]),C.close(),C.stroke()}}if(0!=_t&&0!=vt){i.set(a,bt),o=r.uvs;for(var G=gt,U=gt+_t,$=0;G<U;G+=x,$+=2)e[G+2]=o[$],e[G+3]=o[$+1];if(n=r.color,s=g.color,this.fillVertices(b,n,s,w,g),e=ht._vData,i=ht._iData,vt>0){for(var tt=bt,et=bt+vt;tt<et;tt++)i[tt]+=yt;if(t){y=t.m,W=y[0],Z=y[4],J=y[12],q=y[1],K=y[5],Q=y[13];for(var it=gt,rt=gt+_t;it<rt;it+=x)X=e[it],z=e[it+1],e[it]=X*W+z*Z+J,e[it+1]=X*q+z*K+Q}ht.adjust(_t/x,vt)}w.clipEndWithSlot(g)}else w.clipEndWithSlot(g)}else w.clipEndWithSlot(g);else w.clipEndWithSlot(g);else w.clipEndWithSlot(g);else w.clipEndWithSlot(g);if(w.clipEnd(),C&&d){var nt;C.strokeColor=R,C.fillColor=M;for(var st=0,ot=v.bones.length;st<ot;st++){var at=(nt=v.bones[st]).data.length*nt.a+nt.worldX,lt=nt.data.length*nt.c+nt.worldY;C.moveTo(nt.worldX,nt.worldY),C.lineTo(at,lt),C.stroke(),C.circle(nt.worldX,nt.worldY,1.5*Math.PI),C.fill(),0===st&&(C.fillColor=O)}}},n.cacheTraverse=function(t){var e=ct._curFrame;if(e){var i=e.segments;if(0!=i.length){var r,n,s,o,a,l,c=e.vertices,h=e.indices,u=0,d=0,p=0;t&&(l=t.m,W=l[0],q=l[1],Z=l[4],K=l[5],J=l[12],Q=l[13]);var f=16&I,_=f&&1===W&&0===q&&0===Z&&1===K,m=0,g=e.colors,b=g[m++],x=b.vfOffset;Ct(b);for(var T=0,C=i.length;T<C;T++){var S=i[T];if(o=Tt(S.tex,S.blendMode)){(H||o.getHash()!==ut.material.getHash())&&(H=!1,ut._flush(),ut.node=dt,ut.material=o),mt=S.vertexCount,vt=S.indexCount,a=ht.request(mt,vt),bt=a.indiceOffset,yt=a.vertexOffset,xt=a.byteOffset>>2,r=ht._vData,n=ht._iData,s=ht._uintVData;for(var w=bt,A=bt+vt;w<A;w++)n[w]=yt+h[d++];if(p=S.vfCount,r.set(c.subarray(u,u+p),xt),u+=p,_)for(var E=xt,D=xt+p;E<D;E+=6)r[E]+=J,r[E+1]+=Q;else if(f)for(var L=xt,P=xt+p;L<P;L+=6)X=r[L],z=r[L+1],r[L]=X*W+z*Z+J,r[L+1]=X*q+z*K+Q;if(ht.adjust(mt,vt),pt)for(var M=u-p,R=xt+4,O=xt+4+p;R<O;R+=6,M+=6)M>=x&&(Ct(b=g[m++]),x=b.vfOffset),s[R]=y,s[R+1]=v}}}}},n.fillBuffers=function(t,e){var i=t.node;if(i._renderFlag|=w.FLAG_UPDATE_RENDER_DATA,t._skeleton){var r=i._color;f=r.r/255,_=r.g/255,m=r.b/255,g=r.a/255,h=t.useTint||t.isAnimationCached(),b=h?D:E,x=h?6:5,dt=t.node,ht=e.getBuffer("spine",b),ut=e,ct=t,H=!0,o=t.premultipliedAlpha,a=1,I=0,pt=!1,ft=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==r._val||o)&&(pt=!0),h&&(I|=1);var n=void 0;ct.enableBatch&&(n=dt._worldMatrix,H=!1,I|=16),t.isAnimationCached()?this.cacheTraverse(n):(ft&&ft.begin(t._skeleton),this.realTimeTraverse(n),ft&&ft.end()),e.worldMatDirty++,t.attachUtil._syncAttachedNode(),dt=void 0,ht=void 0,ut=void 0,ct=void 0,ft=null}},n.postFillBuffers=function(t,e){e.worldMatDirty--},r}(n.default);i.default=wt,n.default.register(C,wt),e.exports=i.default},{"../../cocos2d/core/renderer/assembler":224,"../../cocos2d/core/renderer/render-flow":228,"../../cocos2d/core/renderer/webgl/vertex-format":260,"./Skeleton":372,"./lib/spine":374}],379:[function(t,e){var i=function(){this.start=null,this.end=null,this.complete=null,this.event=null,this.interrupt=null,this.dispose=null};i.getListeners=function(t){return t.listener||(t.listener=new i),t.listener},e.exports=i},{}],380:[function(t,e){var i=t("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},clear:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},initJitter:function(t,e){return this._effectType="jitter",this._vertexEffect=new i.JitterEffect(t,e),this._vertexEffect},initSwirlWithPow:function(t,e){return this._interpolation=new i.Pow(e),this._vertexEffect=new i.SwirlEffect(t,this._interpolation),this._vertexEffect},initSwirlWithPowOut:function(t,e){return this._interpolation=new i.PowOut(e),this._vertexEffect=new i.SwirlEffect(t,this._interpolation),this._vertexEffect},getJitterVertexEffect:function(){return this._vertexEffect},getSwirlVertexEffect:function(){return this._vertexEffect},getVertexEffect:function(){return this._vertexEffect},getEffectType:function(){return this._effectType}}),e.exports=sp.VertexEffectDelegate},{"./lib/spine":374}],381:[function(t,e,i){var r;r=function(t){function e(t,e){return void 0!==t?t:e}var i=1e37,r=1e-5,n=r*r,s=3.14159265359,o=.008,a=2/180*s,l=2*o,c=-1,h=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}return t.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t}(),u=new h(2,3,2);function d(t,e){for(var i=[],r=0;r<t;++r)i.push(e(r));return i}function p(t,e){void 0===e&&(e=0);for(var i=[],r=0;r<t;++r)i.push(e);return i}var f=Math.abs,_=Math.min,m=Math.max;function g(t,e,i){return t<e?e:t>i?i:t}var y=isFinite;function v(t){return t*t}function b(t){return 1/Math.sqrt(t)}var x,T=Math.sqrt,C=Math.pow,S=Math.cos,w=Math.sin,A=Math.acos,E=Math.asin,D=Math.atan2,L=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.Clone=function(){return new t(this.x,this.y)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},t.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},t.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},t.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.Normalize=function(){var t=this.Length();if(t>=r){var e=1/t;this.x*=e,this.y*=e}return t},t.prototype.SelfNormalize=function(){var t=this.Length();if(t>=r){var e=1/t;this.x*=e,this.y*=e}return this},t.prototype.SelfRotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.x;return this.x=e*r-i*this.y,this.y=i*r+e*this.y,this},t.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},t.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},t.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},t.prototype.SelfMinV=function(t){return this.x=_(this.x,t.x),this.y=_(this.y,t.y),this},t.prototype.SelfMaxV=function(t){return this.x=m(this.x,t.x),this.y=m(this.y,t.y),this},t.prototype.SelfAbs=function(){return this.x=f(this.x),this.y=f(this.y),this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},t.MakeArray=function(e){return d(e,(function(){return new t}))},t.AbsV=function(t,e){return e.x=f(t.x),e.y=f(t.y),e},t.MinV=function(t,e,i){return i.x=_(t.x,e.x),i.y=_(t.y,e.y),i},t.MaxV=function(t,e,i){return i.x=m(t.x,e.x),i.y=m(t.y,e.y),i},t.ClampV=function(t,e,i,r){return r.x=g(t.x,e.x,i.x),r.y=g(t.y,e.y,i.y),r},t.RotateV=function(t,e,i){var r=t.x,n=t.y,s=Math.cos(e),o=Math.sin(e);return i.x=s*r-o*n,i.y=o*r+s*n,i},t.DotVV=function(t,e){return t.x*e.x+t.y*e.y},t.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},t.CrossVS=function(t,e,i){var r=t.x;return i.x=e*t.y,i.y=-e*r,i},t.CrossVOne=function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e},t.CrossSV=function(t,e,i){var r=e.x;return i.x=-t*e.y,i.y=t*r,i},t.CrossOneV=function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e},t.AddVV=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},t.SubVV=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},t.MulSV=function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i},t.MulVS=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},t.AddVMulSV=function(t,e,i,r){return r.x=t.x+e*i.x,r.y=t.y+e*i.y,r},t.SubVMulSV=function(t,e,i,r){return r.x=t.x-e*i.x,r.y=t.y-e*i.y,r},t.AddVCrossSV=function(t,e,i,r){var n=i.x;return r.x=t.x-e*i.y,r.y=t.y+e*n,r},t.MidVV=function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i},t.ExtVV=function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i},t.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y},t.DistanceVV=function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},t.DistanceSquaredVV=function(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r},t.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},t.ZERO=new t(0,0),t.UNITX=new t(1,0),t.UNITY=new t(0,1),t.s_t0=new t,t.s_t1=new t,t.s_t2=new t,t.s_t3=new t,t}(),I=new L(0,0),P=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i}return t.prototype.Clone=function(){return new t(this.x,this.y,this.z)},t.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},t.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this},t.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.CrossV3V3=function(t,e,i){var r=t.x,n=t.y,s=t.z,o=e.x,a=e.y,l=e.z;return i.x=n*l-s*a,i.y=s*o-r*l,i.z=r*a-n*o,i},t.ZERO=new t(0,0,0),t.s_t0=new t,t}(),M=function(){function t(){this.ex=new L(1,0),this.ey=new L(0,1)}return t.prototype.Clone=function(){return(new t).Copy(this)},t.FromVV=function(e,i){return(new t).SetVV(e,i)},t.FromSSSS=function(e,i,r,n){return(new t).SetSSSS(e,i,r,n)},t.FromAngle=function(e){return(new t).SetAngle(e)},t.prototype.SetSSSS=function(t,e,i,r){return this.ex.Set(t,i),this.ey.Set(e,r),this},t.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},t.prototype.SetAngle=function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},t.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},t.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},t.prototype.GetInverse=function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;return 0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.y=-s*r,t.ey.y=s*e,t},t.prototype.Solve=function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i},t.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},t.prototype.SelfInv=function(){return this.GetInverse(this),this},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},t.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},t.AbsM=function(t,e){var i=t.ex,r=t.ey;return e.ex.x=f(i.x),e.ex.y=f(i.y),e.ey.x=f(r.x),e.ey.y=f(r.y),e},t.MulMV=function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+n.x*o,i.y=r.y*s+n.y*o,i},t.MulTMV=function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+r.y*o,i.y=n.x*s+n.y*o,i},t.AddMM=function(t,e,i){var r=t.ex,n=t.ey,s=e.ex,o=e.ey;return i.ex.x=r.x+s.x,i.ex.y=r.y+s.y,i.ey.x=n.x+o.x,i.ey.y=n.y+o.y,i},t.MulMM=function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,c=e.ey.x,h=e.ey.y;return i.ex.x=r*a+s*l,i.ex.y=n*a+o*l,i.ey.x=r*c+s*h,i.ey.y=n*c+o*h,i},t.MulTMM=function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,c=e.ey.x,h=e.ey.y;return i.ex.x=r*a+n*l,i.ex.y=s*a+o*l,i.ey.x=r*c+n*h,i.ey.y=s*c+o*h,i},t.IDENTITY=new t,t}(),R=function(){function t(){this.ex=new P(1,0,0),this.ey=new P(0,1,0),this.ez=new P(0,0,1)}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this},t.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},t.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},t.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},t.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},t.prototype.Solve33=function(t,e,i,r){var n=this.ex.x,s=this.ex.y,o=this.ex.z,a=this.ey.x,l=this.ey.y,c=this.ey.z,h=this.ez.x,u=this.ez.y,d=this.ez.z,p=n*(l*d-c*u)+s*(c*h-a*d)+o*(a*u-l*h);return 0!==p&&(p=1/p),r.x=p*(t*(l*d-c*u)+e*(c*h-a*d)+i*(a*u-l*h)),r.y=p*(n*(e*d-i*u)+s*(i*h-t*d)+o*(t*u-e*h)),r.z=p*(n*(l*i-c*e)+s*(c*t-a*i)+o*(a*e-l*t)),r},t.prototype.Solve22=function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i},t.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*r,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.GetSymInverse33=function(t){var e=P.DotV3V3(this.ex,P.CrossV3V3(this.ey,this.ez,P.s_t0));0!==e&&(e=1/e);var i=this.ex.x,r=this.ey.x,n=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(n*o-r*a),t.ex.z=e*(r*o-n*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*r-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-r*r)},t.MulM33V3=function(t,e,i){var r=e.x,n=e.y,s=e.z;return i.x=t.ex.x*r+t.ey.x*n+t.ez.x*s,i.y=t.ex.y*r+t.ey.y*n+t.ez.y*s,i.z=t.ex.z*r+t.ey.z*n+t.ez.z*s,i},t.MulM33XYZ=function(t,e,i,r,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*r,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*r,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*r,n},t.MulM33V2=function(t,e,i){var r=e.x,n=e.y;return i.x=t.ex.x*r+t.ey.x*n,i.y=t.ex.y*r+t.ey.y*n,i},t.MulM33XY=function(t,e,i,r){return r.x=t.ex.x*e+t.ey.x*i,r.y=t.ex.y*e+t.ey.y*i,r},t.IDENTITY=new t,t}(),O=function(){function t(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this},t.prototype.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},t.prototype.SetIdentity=function(){return this.s=0,this.c=1,this},t.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},t.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},t.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},t.MulRR=function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=n*s+r*o,i.c=r*s-n*o,i},t.MulTRR=function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=r*o-n*s,i.c=r*s+n*o,i},t.MulRV=function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s-n*o,i.y=n*s+r*o,i},t.MulTRV=function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i},t.IDENTITY=new t,t}(),B=function(){function t(){this.p=new L,this.q=new O}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},t.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},t.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},t.prototype.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this},t.prototype.SetPosition=function(t){return this.p.Copy(t),this},t.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this},t.prototype.SetRotation=function(t){return this.q.Copy(t),this},t.prototype.SetRotationAngle=function(t){return this.q.SetAngle(t),this},t.prototype.GetPosition=function(){return this.p},t.prototype.GetRotation=function(){return this.q},t.prototype.GetRotationAngle=function(){return this.q.GetAngle()},t.prototype.GetAngle=function(){return this.q.GetAngle()},t.MulXV=function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x,o=e.y;return i.x=r*s-n*o+t.p.x,i.y=n*s+r*o+t.p.y,i},t.MulTXV=function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x-t.p.x,o=e.y-t.p.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i},t.MulXX=function(t,e,i){return O.MulRR(t.q,e.q,i.q),L.AddVV(O.MulRV(t.q,e.p,i.p),t.p,i.p),i},t.MulTXX=function(t,e,i){return O.MulTRR(t.q,e.q,i.q),O.MulTRV(t.q,L.SubVV(e.p,t.p,i.p),i.p),i},t.IDENTITY=new t,t}(),N=function(){function t(){this.localCenter=new L,this.c0=new L,this.c=new L,this.a0=0,this.a=0,this.alpha0=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},t.prototype.GetTransform=function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var r=i*this.a0+e*this.a;return t.q.SetAngle(r),t.p.SelfSub(O.MulRV(t.q,this.localCenter,L.s_t0)),t},t.prototype.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t},t.prototype.Normalize=function(){var t=6.28318530718*Math.floor(this.a0/6.28318530718);this.a0-=t,this.a-=t},t}(),k=function(){function t(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===r&&(r=1),this.r=t,this.g=e,this.b=i,this.a=r}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},t.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},t.prototype.Set=function(t,e,i,r){void 0===r&&(r=this.a),this.SetRGBA(t,e,i,r)},t.prototype.SetByteRGB=function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this},t.prototype.SetByteRGBA=function(t,e,i,r){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=r/255,this},t.prototype.SetRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},t.prototype.SetRGBA=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this},t.prototype.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e},t.prototype.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this},t.prototype.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e},t.prototype.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},t.prototype.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e},t.prototype.Mix=function(e,i){t.MixColors(this,e,i)},t.MixColors=function(t,e,i){var r=i*(e.r-t.r),n=i*(e.g-t.g),s=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=r,t.g+=n,t.b+=s,t.a+=o,e.r-=r,e.g-=n,e.b-=s,e.a-=o},t.prototype.MakeStyleString=function(e){return void 0===e&&(e=this.a),t.MakeStyleString(this.r,this.g,this.b,e)},t.MakeStyleString=function(t,e,i,r){return void 0===r&&(r=1),t*=255,e*=255,i*=255,r<1?"rgba("+t+","+e+","+i+","+r+")":"rgb("+t+","+e+","+i+")"},t.ZERO=new t(0,0,0,0),t.RED=new t(1,0,0),t.GREEN=new t(0,1,0),t.BLUE=new t(0,0,1),t}();(x=t.b2DrawFlags||(t.b2DrawFlags={}))[x.e_none=0]="e_none",x[x.e_shapeBit=1]="e_shapeBit",x[x.e_jointBit=2]="e_jointBit",x[x.e_aabbBit=4]="e_aabbBit",x[x.e_pairBit=8]="e_pairBit",x[x.e_centerOfMassBit=16]="e_centerOfMassBit",x[x.e_particleBit=32]="e_particleBit",x[x.e_controllerBit=64]="e_controllerBit",x[x.e_all=63]="e_all";var F=function(){function t(){this.m_drawFlags=0}return t.prototype.SetFlags=function(t){this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){this.m_drawFlags&=~t},t}(),V=function(){function t(){this.m_start=Date.now()}return t.prototype.Reset=function(){return this.m_start=Date.now(),this},t.prototype.GetMilliseconds=function(){return Date.now()-this.m_start},t}(),j=function(){function t(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}return t.prototype.GetCount=function(){return this.m_count},t.prototype.GetMinCount=function(){return this.m_min_count},t.prototype.GetMaxCount=function(){return this.m_max_count},t.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},t.prototype.ResetMinCount=function(){this.m_min_count=0},t.prototype.ResetMaxCount=function(){this.m_max_count=0},t.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},t.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t}(),G=function(){function t(t){this.m_stack=[],this.m_count=0,this.m_stack=d(t,(function(){return null})),this.m_count=0}return t.prototype.Reset=function(){return this.m_count=0,this},t.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},t.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t},t.prototype.GetCount=function(){return this.m_count},t}(),U=function(){function t(){this.m_buffer=L.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return t.prototype.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this},t.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},t.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},t.prototype.SetVerticesRadius=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t.prototype.GetSupport=function(t){for(var e=0,i=L.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=L.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return e},t.prototype.GetSupportVertex=function(t){for(var e=0,i=L.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=L.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return this.m_vertices[e]},t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertex=function(t){return this.m_vertices[t]},t}(),Y=function(){function t(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return t.prototype.Reset=function(){return this.metric=0,this.count=0,this},t}(),H=function(){function t(){this.proxyA=new U,this.proxyB=new U,this.transformA=new B,this.transformB=new B,this.useRadii=!1}return t.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t}(),X=function(){function t(){this.pointA=new L,this.pointB=new L,this.distance=0,this.iterations=0}return t.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t}();t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;var z=function(){function t(){this.wA=new L,this.wB=new L,this.w=new L,this.a=0,this.indexA=0,this.indexB=0}return t.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this},t}(),W=function(){function t(){this.m_v1=new z,this.m_v2=new z,this.m_v3=new z,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return t.prototype.ReadCache=function(t,e,i,n,s){this.m_count=t.count;for(var o=this.m_vertices,a=0;a<this.m_count;++a){(d=o[a]).indexA=t.indexA[a],d.indexB=t.indexB[a];var l=e.GetVertex(d.indexA),c=n.GetVertex(d.indexB);B.MulXV(i,l,d.wA),B.MulXV(s,c,d.wB),L.SubVV(d.wB,d.wA,d.w),d.a=0}if(this.m_count>1){var h=t.metric,u=this.GetMetric();(u<.5*h||2*h<u||u<r)&&(this.m_count=0)}var d;0===this.m_count&&((d=o[0]).indexA=0,d.indexB=0,l=e.GetVertex(0),c=n.GetVertex(0),B.MulXV(i,l,d.wA),B.MulXV(s,c,d.wB),L.SubVV(d.wB,d.wA,d.w),d.a=1,this.m_count=1)},t.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},t.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return L.NegV(this.m_v1.w,t);case 2:var e=L.SubVV(this.m_v2.w,this.m_v1.w,t);return L.CrossVV(e,L.NegV(this.m_v1.w,L.s_t0))>0?L.CrossOneV(e,t):L.CrossVOne(e,t);default:return t.SetZero()}},t.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:case 3:default:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y)}},t.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},t.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return L.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return L.CrossVV(L.SubVV(this.m_v2.w,this.m_v1.w,L.s_t0),L.SubVV(this.m_v3.w,this.m_v1.w,L.s_t1))}},t.prototype.Solve2=function(){var e=this.m_v1.w,i=this.m_v2.w,r=L.SubVV(i,e,t.s_e12),n=-L.DotVV(e,r);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var s=L.DotVV(i,r);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(s+n);this.m_v1.a=s*o,this.m_v2.a=n*o,this.m_count=2},t.prototype.Solve3=function(){var e=this.m_v1.w,i=this.m_v2.w,r=this.m_v3.w,n=L.SubVV(i,e,t.s_e12),s=L.DotVV(e,n),o=L.DotVV(i,n),a=-s,l=L.SubVV(r,e,t.s_e13),c=L.DotVV(e,l),h=L.DotVV(r,l),u=-c,d=L.SubVV(r,i,t.s_e23),p=L.DotVV(i,d),f=L.DotVV(r,d),_=-p,m=L.CrossVV(n,l),g=m*L.CrossVV(i,r),y=m*L.CrossVV(r,e),v=m*L.CrossVV(e,i);if(a<=0&&u<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&v<=0){var b=1/(o+a);return this.m_v1.a=o*b,this.m_v2.a=a*b,void(this.m_count=2)}if(h>0&&u>0&&y<=0){var x=1/(h+u);return this.m_v1.a=h*x,this.m_v3.a=u*x,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&_<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&_>0&&g<=0){var T=1/(f+_);return this.m_v2.a=f*T,this.m_v3.a=_*T,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var C=1/(g+y+v);this.m_v1.a=g*C,this.m_v2.a=y*C,this.m_v3.a=v*C,this.m_count=3},t.s_e12=new L,t.s_e13=new L,t.s_e23=new L,t}(),Z=new W,J=[0,0,0],q=[0,0,0],K=new L,Q=new L,$=new L,tt=new L,et=new L;function it(e,i,s){++t.b2_gjkCalls;var o=s.proxyA,a=s.proxyB,l=s.transformA,c=s.transformB,h=Z;h.ReadCache(i,o,l,a,c);for(var u=h.m_vertices,d=J,p=q,f=0,_=0;_<20;){f=h.m_count;for(var g=0;g<f;++g)d[g]=u[g].indexA,p[g]=u[g].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)break;var y=h.GetSearchDirection(Q);if(y.LengthSquared()<n)break;var v=u[h.m_count];v.indexA=o.GetSupport(O.MulTRV(l.q,L.NegV(y,L.s_t0),tt)),B.MulXV(l,o.GetVertex(v.indexA),v.wA),v.indexB=a.GetSupport(O.MulTRV(c.q,y,et)),B.MulXV(c,a.GetVertex(v.indexB),v.wB),L.SubVV(v.wB,v.wA,v.w),++_,++t.b2_gjkIters;var b=!1;for(g=0;g<f;++g)if(v.indexA===d[g]&&v.indexB===p[g]){b=!0;break}if(b)break;++h.m_count}if(t.b2_gjkMaxIters=m(t.b2_gjkMaxIters,_),h.GetWitnessPoints(e.pointA,e.pointB),e.distance=L.DistanceVV(e.pointA,e.pointB),e.iterations=_,h.WriteCache(i),s.useRadii){var x=o.m_radius,T=a.m_radius;if(e.distance>x+T&&e.distance>r){e.distance-=x+T;var C=L.SubVV(e.pointB,e.pointA,$);C.Normalize(),e.pointA.SelfMulAdd(x,C),e.pointB.SelfMulSub(T,C)}else{var S=L.MidVV(e.pointA,e.pointB,K);e.pointA.Copy(S),e.pointB.Copy(S),e.distance=0}}}var rt,nt=new L,st=new W,ot=new L,at=new L,lt=new L,ct=new L,ht=new L,ut=new L;(rt=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[rt.e_vertex=0]="e_vertex",rt[rt.e_face=1]="e_face";var dt,pt=function(){function t(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexA",{get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexB",{get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeA",{get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeB",{get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0},enumerable:!0,configurable:!0}),t}(),ft=function(){function t(){this.cf=new pt}return t.prototype.Copy=function(t){return this.key=t.key,this},t.prototype.Clone=function(){return(new t).Copy(this)},Object.defineProperty(t.prototype,"key",{get:function(){return this.cf.key},set:function(t){this.cf.key=t},enumerable:!0,configurable:!0}),t}(),_t=function(){function t(){this.localPoint=new L,this.normalImpulse=0,this.tangentImpulse=0,this.id=new ft}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},t.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},t}();(dt=t.b2ManifoldType||(t.b2ManifoldType={}))[dt.e_unknown=-1]="e_unknown",dt[dt.e_circles=0]="e_circles",dt[dt.e_faceA=1]="e_faceA",dt[dt.e_faceB=2]="e_faceB";var mt,gt=function(){function e(){this.points=_t.MakeArray(2),this.localNormal=new L,this.localPoint=new L,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}return e.prototype.Reset=function(){for(var e=0;e<2;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0},e.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<2;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},e.prototype.Clone=function(){return(new e).Copy(this)},e}(),yt=function(){function e(){this.normal=new L,this.points=L.MakeArray(2),this.separations=p(2)}return e.prototype.Initialize=function(i,r,s,o,a){if(0!==i.pointCount)switch(i.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var l=B.MulXV(r,i.localPoint,e.Initialize_s_pointA),c=B.MulXV(o,i.points[0].localPoint,e.Initialize_s_pointB);L.DistanceSquaredVV(l,c)>n&&L.SubVV(c,l,this.normal).SelfNormalize();var h=L.AddVMulSV(l,s,this.normal,e.Initialize_s_cA),u=L.SubVMulSV(c,a,this.normal,e.Initialize_s_cB);L.MidVV(h,u,this.points[0]),this.separations[0]=L.DotVV(L.SubVV(u,h,L.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:O.MulRV(r.q,i.localNormal,this.normal);for(var d=B.MulXV(r,i.localPoint,e.Initialize_s_planePoint),p=0;p<i.pointCount;++p){var f=B.MulXV(o,i.points[p].localPoint,e.Initialize_s_clipPoint),_=s-L.DotVV(L.SubVV(f,d,L.s_t0),this.normal);h=L.AddVMulSV(f,_,this.normal,e.Initialize_s_cA),u=L.SubVMulSV(f,a,this.normal,e.Initialize_s_cB),L.MidVV(h,u,this.points[p]),this.separations[p]=L.DotVV(L.SubVV(u,h,L.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:for(O.MulRV(o.q,i.localNormal,this.normal),d=B.MulXV(o,i.localPoint,e.Initialize_s_planePoint),p=0;p<i.pointCount;++p)f=B.MulXV(r,i.points[p].localPoint,e.Initialize_s_clipPoint),_=a-L.DotVV(L.SubVV(f,d,L.s_t0),this.normal),u=L.AddVMulSV(f,_,this.normal,e.Initialize_s_cB),h=L.SubVMulSV(f,s,this.normal,e.Initialize_s_cA),L.MidVV(h,u,this.points[p]),this.separations[p]=L.DotVV(L.SubVV(h,u,L.s_t0),this.normal);this.normal.SelfNeg()}},e.Initialize_s_pointA=new L,e.Initialize_s_pointB=new L,e.Initialize_s_cA=new L,e.Initialize_s_cB=new L,e.Initialize_s_planePoint=new L,e.Initialize_s_clipPoint=new L,e}();(mt=t.b2PointState||(t.b2PointState={}))[mt.b2_nullState=0]="b2_nullState",mt[mt.b2_addState=1]="b2_addState",mt[mt.b2_persistState=2]="b2_persistState",mt[mt.b2_removeState=3]="b2_removeState";var vt=function(){function t(){this.v=new L,this.id=new ft}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this},t}(),bt=function(){function t(){this.p1=new L,this.p2=new L,this.maxFraction=1}return t.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},t}(),xt=function(){function t(){this.normal=new L,this.fraction=0}return t.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},t}(),Tt=function(){function t(){this.lowerBound=new L,this.upperBound=new L,this.m_cache_center=new L,this.m_cache_extent=new L}return t.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},t.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return t>=0&&e>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},t.prototype.GetCenter=function(){return L.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},t.prototype.GetExtents=function(){return L.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},t.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},t.prototype.Combine1=function(t){return this.lowerBound.x=_(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=_(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=m(this.upperBound.x,t.upperBound.x),this.upperBound.y=m(this.upperBound.y,t.upperBound.y),this},t.prototype.Combine2=function(t,e){return this.lowerBound.x=_(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=_(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=m(t.upperBound.x,e.upperBound.x),this.upperBound.y=m(t.upperBound.y,e.upperBound.y),this},t.Combine=function(t,e,i){return i.Combine2(t,e),i},t.prototype.Contains=function(t){var e=!0;return(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},t.prototype.RayCast=function(t,e){var n,s,o=-i,a=i,l=e.p1.x,c=e.p1.y,h=e.p2.x-e.p1.x,u=e.p2.y-e.p1.y,d=f(h),p=f(u),m=t.normal;if(d<r){if(l<this.lowerBound.x||this.upperBound.x<l)return!1}else{var g=1/h,y=-1;if((n=(this.lowerBound.x-l)*g)>(s=(this.upperBound.x-l)*g)){var v=n;n=s,s=v,y=1}if(n>o&&(m.x=y,m.y=0,o=n),o>(a=_(a,s)))return!1}if(p<r){if(c<this.lowerBound.y||this.upperBound.y<c)return!1}else if(g=1/u,y=-1,(n=(this.lowerBound.y-c)*g)>(s=(this.upperBound.y-c)*g)&&(v=n,n=s,s=v,y=1),n>o&&(m.x=0,m.y=y,o=n),o>(a=_(a,s)))return!1;return!(o<0||e.maxFraction<o||(t.fraction=o,0))},t.prototype.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)},t.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0||r>0||n>0)},t}();function Ct(t,e){var i=e.lowerBound.x-t.upperBound.x,r=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.x-e.upperBound.x,s=t.lowerBound.y-e.upperBound.y;return!(i>0||r>0||n>0||s>0)}function St(e,i,r,n,s){var o=0,a=i[0],l=i[1],c=L.DotVV(r,a.v)-n,h=L.DotVV(r,l.v)-n;if(c<=0&&e[o++].Copy(a),h<=0&&e[o++].Copy(l),c*h<0){var u=c/(c-h),d=e[o].v;d.x=a.v.x+u*(l.v.x-a.v.x),d.y=a.v.y+u*(l.v.y-a.v.y);var p=e[o].id;p.cf.indexA=s,p.cf.indexB=a.id.cf.indexB,p.cf.typeA=t.b2ContactFeatureType.e_vertex,p.cf.typeB=t.b2ContactFeatureType.e_face,++o}return o}var wt=new H,At=new Y,Et=new X;function Dt(t,e,i,n,s,o){var a=wt.Reset();a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,n),a.transformA.Copy(s),a.transformB.Copy(o),a.useRadii=!0;var l=At.Reset();l.count=0;var c=Et.Reset();return it(c,l,a),c.distance<10*r}function Lt(t){if(null===t)throw new Error;return t}var It=function(){function t(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new Tt,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}return t.prototype.IsLeaf=function(){return null===this.child1},t}(),Pt=function(){function t(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new G(256)}return t.prototype.Query=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(r.aabb.TestOverlap(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(Lt(r.child1)),i.Push(Lt(r.child2))}}},t.prototype.QueryPoint=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(r.aabb.TestContain(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(Lt(r.child1)),i.Push(Lt(r.child2))}}},t.prototype.RayCast=function(e,i){if(null!==this.m_root){var r=e.p1,n=e.p2,s=L.SubVV(n,r,t.s_r);s.Normalize();var o=L.CrossOneV(s,t.s_v),a=L.AbsV(o,t.s_abs_v),l=e.maxFraction,c=t.s_segmentAABB,h=r.x+l*(n.x-r.x),u=r.y+l*(n.y-r.y);c.lowerBound.x=_(r.x,h),c.lowerBound.y=_(r.y,u),c.upperBound.x=m(r.x,h),c.upperBound.y=m(r.y,u);var d=this.m_stack.Reset();for(d.Push(this.m_root);d.GetCount()>0;){var p=d.Pop();if(Ct(p.aabb,c)){var g=p.aabb.GetCenter(),y=p.aabb.GetExtents();if(!(f(L.DotVV(o,L.SubVV(r,g,L.s_t0)))-L.DotVV(a,y)>0))if(p.IsLeaf()){var v=t.s_subInput;v.p1.Copy(e.p1),v.p2.Copy(e.p2),v.maxFraction=l;var b=i(v,p);if(0===b)return;b>0&&(l=b,h=r.x+l*(n.x-r.x),u=r.y+l*(n.y-r.y),c.lowerBound.x=_(r.x,h),c.lowerBound.y=_(r.y,u),c.upperBound.x=m(r.x,h),c.upperBound.y=m(r.y,u))}else d.Push(Lt(p.child1)),d.Push(Lt(p.child2))}}}},t.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,delete e.userData,e}return new It(t.s_node_id++)},t.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t},t.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();return i.aabb.lowerBound.x=t.lowerBound.x-.1,i.aabb.lowerBound.y=t.lowerBound.y-.1,i.aabb.upperBound.x=t.upperBound.x+.1,i.aabb.upperBound.y=t.upperBound.y+.1,i.userData=e,i.height=0,this.InsertLeaf(i),i},t.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},t.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=.1+2*(i.x>0?i.x:-i.x),n=.1+2*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+n,this.InsertLeaf(t),!0},t.prototype.InsertLeaf=function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,r=this.m_root;!r.IsLeaf();){var n=Lt(r.child1),s=Lt(r.child2),o=r.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(r.aabb,i);var l=a.GetPerimeter(),c=2*l,h=2*(l-o),u=void 0,d=t.s_aabb,p=void 0;n.IsLeaf()?(d.Combine2(i,n.aabb),u=d.GetPerimeter()+h):(d.Combine2(i,n.aabb),p=n.aabb.GetPerimeter(),u=d.GetPerimeter()-p+h);var f=void 0;if(s.IsLeaf()?(d.Combine2(i,s.aabb),f=d.GetPerimeter()+h):(d.Combine2(i,s.aabb),p=s.aabb.GetPerimeter(),f=d.GetPerimeter()-p+h),c<u&&c<f)break;r=u<f?n:s}var _=r,g=_.parent,y=this.AllocateNode();y.parent=g,delete y.userData,y.aabb.Combine2(i,_.aabb),y.height=_.height+1,g?(g.child1===_?g.child1=y:g.child2=y,y.child1=_,y.child2=e,_.parent=y,e.parent=y):(y.child1=_,y.child2=e,_.parent=y,e.parent=y,this.m_root=y);for(var v=e.parent;null!==v;)n=Lt((v=this.Balance(v)).child1),s=Lt(v.child2),v.height=1+m(n.height,s.height),v.aabb.Combine2(n.aabb,s.aabb),v=v.parent},t.prototype.RemoveLeaf=function(t){if(t!==this.m_root){var e,i=Lt(t.parent),r=i&&i.parent;if(e=i.child1===t?Lt(i.child2):Lt(i.child1),r){r.child1===i?r.child1=e:r.child2=e,e.parent=r,this.FreeNode(i);for(var n=r;n;){var s=Lt((n=this.Balance(n)).child1),o=Lt(n.child2);n.aabb.Combine2(s.aabb,o.aabb),n.height=1+m(s.height,o.height),n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)}else this.m_root=null},t.prototype.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e=Lt(t.child1),i=Lt(t.child2),r=i.height-e.height;if(r>1){var n=Lt(i.child1),s=Lt(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>s.height?(i.child2=n,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+m(e.height,s.height),i.height=1+m(t.height,n.height)):(i.child2=s,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+m(e.height,n.height),i.height=1+m(t.height,s.height)),i}if(r<-1){var o=Lt(e.child1),a=Lt(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,o.height>a.height?(e.child2=o,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+m(i.height,a.height),e.height=1+m(t.height,o.height)):(e.child2=a,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+m(i.height,o.height),e.height=1+m(t.height,a.height)),e}return t},t.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},t.GetAreaNode=function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return(i+=t.GetAreaNode(e.child1))+t.GetAreaNode(e.child2)},t.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e},t.prototype.ComputeHeightNode=function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+m(e,i)},t.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root)},t.prototype.ValidateStructure=function(t){if(null!==t){this.m_root;var e=t;if(!e.IsLeaf()){var i=Lt(e.child1),r=Lt(e.child2);this.ValidateStructure(i),this.ValidateStructure(r)}}},t.prototype.ValidateMetrics=function(e){if(null!==e){var i=e;if(!i.IsLeaf()){var r=Lt(i.child1),n=Lt(i.child2);t.s_aabb.Combine2(r.aabb,n.aabb),this.ValidateMetrics(r),this.ValidateMetrics(n)}}},t.prototype.Validate=function(){},t.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=Lt(t.child1),r=Lt(t.child2),n=f(r.height-i.height);return m(e,n)},t.prototype.GetMaxBalance=function(){return t.GetMaxBalanceNode(this.m_root,0)},t.prototype.RebuildBottomUp=function(){this.Validate()},t.ShiftOriginNode=function(e,i){if(null!==e&&!(e.height<=1)){var r=e.child1,n=e.child2;t.ShiftOriginNode(r,i),t.ShiftOriginNode(n,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}},t.prototype.ShiftOrigin=function(e){t.ShiftOriginNode(this.m_root,e)},t.s_r=new L,t.s_v=new L,t.s_abs_v=new L,t.s_segmentAABB=new Tt,t.s_subInput=new bt,t.s_combinedAABB=new Tt,t.s_aabb=new Tt,t.s_node_id=0,t}(),Mt=function(t,e){this.proxyA=t,this.proxyB=e},Rt=function(){function t(){this.m_tree=new Pt,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return t.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},t.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},t.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},t.prototype.TouchProxy=function(t){this.BufferMove(t)},t.prototype.GetProxyCount=function(){return this.m_proxyCount},t.prototype.UpdatePairs=function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=r.m_moveBuffer[t];if(null===i)return"continue";var n=i.aabb;r.m_tree.Query(n,(function(t){if(t.m_id===i.m_id)return!0;var r,n;if(t.m_id<i.m_id?(r=t,n=i):(r=i,n=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Mt(r,n);else{var s=e.m_pairBuffer[e.m_pairCount];s.proxyA=r,s.proxyB=n}return++e.m_pairCount,!0}))},r=this,n=0;n<this.m_moveCount;++n)i(n);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(Ot);for(var s=0;s<this.m_pairCount;){var o=this.m_pairBuffer[s],a=o.proxyA.userData,l=o.proxyB.userData;for(a&&l&&t(a,l),++s;s<this.m_pairCount;){var c=this.m_pairBuffer[s];if(c.proxyA.m_id!==o.proxyA.m_id||c.proxyB.m_id!==o.proxyB.m_id)break;++s}}},t.prototype.Query=function(t,e){this.m_tree.Query(t,e)},t.prototype.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e)},t.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},t.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},t.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},t.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},t.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},t.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},t.prototype.UnBufferMove=function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null},t}();function Ot(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;var Bt,Nt=new B,kt=new B,Ft=new L,Vt=new L,jt=new L,Gt=new L,Ut=new L,Yt=function(){this.proxyA=new U,this.proxyB=new U,this.sweepA=new N,this.sweepB=new N,this.tMax=0};(Bt=t.b2TOIOutputState||(t.b2TOIOutputState={}))[Bt.e_unknown=0]="e_unknown",Bt[Bt.e_failed=1]="e_failed",Bt[Bt.e_overlapped=2]="e_overlapped",Bt[Bt.e_touching=3]="e_touching",Bt[Bt.e_separated=4]="e_separated";var Ht,Xt=function(){this.state=t.b2TOIOutputState.e_unknown,this.t=0};(Ht=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Ht.e_unknown=-1]="e_unknown",Ht[Ht.e_points=0]="e_points",Ht[Ht.e_faceA=1]="e_faceA",Ht[Ht.e_faceB=2]="e_faceB";var zt=function(){function e(){this.m_sweepA=new N,this.m_sweepB=new N,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new L,this.m_axis=new L}return e.prototype.Initialize=function(e,i,r,n,s,o){this.m_proxyA=i,this.m_proxyB=n;var a=e.count;this.m_sweepA.Copy(r),this.m_sweepB.Copy(s);var l=Nt,c=kt;if(this.m_sweepA.GetTransform(l,o),this.m_sweepB.GetTransform(c,o),1===a){this.m_type=t.b2SeparationFunctionType.e_points;var h=this.m_proxyA.GetVertex(e.indexA[0]),u=this.m_proxyB.GetVertex(e.indexB[0]),d=B.MulXV(l,h,Ft),p=B.MulXV(c,u,Vt);L.SubVV(p,d,this.m_axis);var f=this.m_axis.Normalize();return this.m_localPoint.SetZero(),f}if(e.indexA[0]===e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var _=this.m_proxyB.GetVertex(e.indexB[0]),m=this.m_proxyB.GetVertex(e.indexB[1]);L.CrossVOne(L.SubVV(m,_,L.s_t0),this.m_axis).SelfNormalize();var g=O.MulRV(c.q,this.m_axis,jt);return L.MidVV(_,m,this.m_localPoint),p=B.MulXV(c,this.m_localPoint,Vt),h=this.m_proxyA.GetVertex(e.indexA[0]),d=B.MulXV(l,h,Ft),(f=L.DotVV(L.SubVV(d,p,L.s_t0),g))<0&&(this.m_axis.SelfNeg(),f=-f),f}this.m_type=t.b2SeparationFunctionType.e_faceA;var y=this.m_proxyA.GetVertex(e.indexA[0]),v=this.m_proxyA.GetVertex(e.indexA[1]);return L.CrossVOne(L.SubVV(v,y,L.s_t0),this.m_axis).SelfNormalize(),g=O.MulRV(l.q,this.m_axis,jt),L.MidVV(y,v,this.m_localPoint),d=B.MulXV(l,this.m_localPoint,Ft),u=this.m_proxyB.GetVertex(e.indexB[0]),p=B.MulXV(c,u,Vt),(f=L.DotVV(L.SubVV(p,d,L.s_t0),g))<0&&(this.m_axis.SelfNeg(),f=-f),f},e.prototype.FindMinSeparation=function(e,i,r){var n=Nt,s=kt;switch(this.m_sweepA.GetTransform(n,r),this.m_sweepB.GetTransform(s,r),this.m_type){case t.b2SeparationFunctionType.e_points:var o=O.MulTRV(n.q,this.m_axis,Gt),a=O.MulTRV(s.q,L.NegV(this.m_axis,L.s_t0),Ut);e[0]=this.m_proxyA.GetSupport(o),i[0]=this.m_proxyB.GetSupport(a);var l=this.m_proxyA.GetVertex(e[0]),c=this.m_proxyB.GetVertex(i[0]),h=B.MulXV(n,l,Ft),u=B.MulXV(s,c,Vt);return L.DotVV(L.SubVV(u,h,L.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var d=O.MulRV(n.q,this.m_axis,jt);return h=B.MulXV(n,this.m_localPoint,Ft),a=O.MulTRV(s.q,L.NegV(d,L.s_t0),Ut),e[0]=-1,i[0]=this.m_proxyB.GetSupport(a),c=this.m_proxyB.GetVertex(i[0]),u=B.MulXV(s,c,Vt),L.DotVV(L.SubVV(u,h,L.s_t0),d);case t.b2SeparationFunctionType.e_faceB:return d=O.MulRV(s.q,this.m_axis,jt),u=B.MulXV(s,this.m_localPoint,Vt),o=O.MulTRV(n.q,L.NegV(d,L.s_t0),Gt),i[0]=-1,e[0]=this.m_proxyA.GetSupport(o),l=this.m_proxyA.GetVertex(e[0]),h=B.MulXV(n,l,Ft),L.DotVV(L.SubVV(h,u,L.s_t0),d);default:return e[0]=-1,i[0]=-1,0}},e.prototype.Evaluate=function(e,i,r){var n=Nt,s=kt;switch(this.m_sweepA.GetTransform(n,r),this.m_sweepB.GetTransform(s,r),this.m_type){case t.b2SeparationFunctionType.e_points:var o=this.m_proxyA.GetVertex(e),a=this.m_proxyB.GetVertex(i),l=B.MulXV(n,o,Ft),c=B.MulXV(s,a,Vt);return L.DotVV(L.SubVV(c,l,L.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var h=O.MulRV(n.q,this.m_axis,jt);return l=B.MulXV(n,this.m_localPoint,Ft),a=this.m_proxyB.GetVertex(i),c=B.MulXV(s,a,Vt),L.DotVV(L.SubVV(c,l,L.s_t0),h);case t.b2SeparationFunctionType.e_faceB:return h=O.MulRV(s.q,this.m_axis,jt),c=B.MulXV(s,this.m_localPoint,Vt),o=this.m_proxyA.GetVertex(e),l=B.MulXV(n,o,Ft),L.DotVV(L.SubVV(l,c,L.s_t0),h);default:return 0}},e}(),Wt=new V,Zt=new Y,Jt=new H,qt=new X,Kt=new zt,Qt=[0],$t=[0],te=new N,ee=new N;function ie(e,i){var r=Wt.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=i.tMax;var n=i.proxyA,s=i.proxyB,a=te.Copy(i.sweepA),l=ee.Copy(i.sweepB);a.Normalize(),l.Normalize();var c=i.tMax,h=n.m_radius+s.m_radius,u=m(o,h-3*o),d=.002,p=0,_=0,g=Zt;g.count=0;var y=Jt;for(y.proxyA.Copy(i.proxyA),y.proxyB.Copy(i.proxyB),y.useRadii=!1;;){var v=Nt,b=kt;a.GetTransform(v,p),l.GetTransform(b,p),y.transformA.Copy(v),y.transformB.Copy(b);var x=qt;if(it(x,g,y),x.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(x.distance<u+d){e.state=t.b2TOIOutputState.e_touching,e.t=p;break}var T=Kt;T.Initialize(g,n,a,s,l,p);for(var C=!1,S=c,w=0;;){var A=Qt,E=$t,D=T.FindMinSeparation(A,E,S);if(D>u+d){e.state=t.b2TOIOutputState.e_separated,e.t=c,C=!0;break}if(D>u-d){p=S;break}var L=T.Evaluate(A[0],E[0],p);if(L<u-d){e.state=t.b2TOIOutputState.e_failed,e.t=p,C=!0;break}if(L<=u+d){e.state=t.b2TOIOutputState.e_touching,e.t=p,C=!0;break}for(var I=0,P=p,M=S;;){var R;R=1&I?P+(u-L)*(M-P)/(D-L):.5*(P+M),++I,++t.b2_toiRootIters;var O=T.Evaluate(A[0],E[0],R);if(f(O-u)<d){S=R;break}if(O>u?(P=R,L=O):(M=R,D=O),50===I)break}if(t.b2_toiMaxRootIters=m(t.b2_toiMaxRootIters,I),8==++w)break}if(++_,++t.b2_toiIters,C)break;if(20===_){e.state=t.b2TOIOutputState.e_failed,e.t=p;break}}t.b2_toiMaxIters=m(t.b2_toiMaxIters,_);var B=r.GetMilliseconds();t.b2_toiMaxTime=m(t.b2_toiMaxTime,B),t.b2_toiTime+=B}var re=new L,ne=new L;function se(e,i,r,n,s){e.pointCount=0;var o=B.MulXV(r,i.m_p,re),a=B.MulXV(s,n.m_p,ne),l=L.DistanceSquaredVV(o,a),c=i.m_radius+n.m_radius;l>c*c||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(i.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0)}var oe=new L,ae=new L,le=new L;function ce(e,n,s,o,a){e.pointCount=0;for(var l=B.MulXV(a,o.m_p,oe),c=B.MulTXV(s,l,ae),h=0,u=-i,d=n.m_radius+o.m_radius,p=n.m_count,f=n.m_vertices,_=n.m_normals,m=0;m<p;++m){var g=L.DotVV(_[m],L.SubVV(c,f[m],L.s_t0));if(g>d)return;g>u&&(u=g,h=m)}var y=h,v=(y+1)%p,b=f[y],x=f[v];if(u<r)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(_[h]),L.MidVV(b,x,e.localPoint),e.points[0].localPoint.Copy(o.m_p),void(e.points[0].id.key=0);var T=L.DotVV(L.SubVV(c,b,L.s_t0),L.SubVV(x,b,L.s_t1)),C=L.DotVV(L.SubVV(c,x,L.s_t0),L.SubVV(b,x,L.s_t1));if(T<=0){if(L.DistanceSquaredVV(c,b)>d*d)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,L.SubVV(c,b,e.localNormal).SelfNormalize(),e.localPoint.Copy(b),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else if(C<=0){if(L.DistanceSquaredVV(c,x)>d*d)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,L.SubVV(c,x,e.localNormal).SelfNormalize(),e.localPoint.Copy(x),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else{var S=L.MidVV(b,x,le);if(L.DotVV(L.SubVV(c,S,L.s_t1),_[y])>d)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(_[y]).SelfNormalize(),e.localPoint.Copy(S),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}}var he=new L,ue=new L,de=new L,pe=new L;function fe(t,e,r,n,s){for(var o=t.m_vertices,a=t.m_normals,l=n.m_count,c=n.m_vertices,h=O.MulRV(e.q,a[r],he),u=O.MulTRV(s.q,h,ue),d=0,p=i,f=0;f<l;++f){var _=L.DotVV(c[f],u);_<p&&(p=_,d=f)}var m=B.MulXV(e,o[r],de),g=B.MulXV(s,c[d],pe);return L.DotVV(L.SubVV(g,m,L.s_t0),h)}var _e=new L,me=new L;function ge(t,e,r,n,s){for(var o=e.m_count,a=e.m_normals,l=L.SubVV(B.MulXV(s,n.m_centroid,L.s_t0),B.MulXV(r,e.m_centroid,L.s_t1),_e),c=O.MulTRV(r.q,l,me),h=0,u=-i,d=0;d<o;++d){var p=L.DotVV(a[d],c);p>u&&(u=p,h=d)}var f=fe(e,r,h,n,s),_=(h+o-1)%o,m=fe(e,r,_,n,s),g=(h+1)%o,y=fe(e,r,g,n,s),v=0,b=0,x=0;if(m>f&&m>y)x=-1,v=_,b=m;else{if(!(y>f))return t[0]=h,f;x=1,v=g,b=y}for(;(f=fe(e,r,h=-1===x?(v+o-1)%o:(v+1)%o,n,s))>b;)v=h,b=f;return t[0]=v,b}var ye=new L;function ve(e,r,n,s,o,a){for(var l=r.m_normals,c=o.m_count,h=o.m_vertices,u=o.m_normals,d=O.MulTRV(a.q,O.MulRV(n.q,l[s],L.s_t0),ye),p=0,f=i,_=0;_<c;++_){var m=L.DotVV(d,u[_]);m<f&&(f=m,p=_)}var g=p,y=(g+1)%c,v=e[0];B.MulXV(a,h[g],v.v);var b=v.id.cf;b.indexA=s,b.indexB=g,b.typeA=t.b2ContactFeatureType.e_face,b.typeB=t.b2ContactFeatureType.e_vertex;var x=e[1];B.MulXV(a,h[y],x.v);var T=x.id.cf;T.indexA=s,T.indexB=y,T.typeA=t.b2ContactFeatureType.e_face,T.typeB=t.b2ContactFeatureType.e_vertex}var be=vt.MakeArray(2),xe=vt.MakeArray(2),Te=vt.MakeArray(2),Ce=[0],Se=[0],we=new L,Ae=new L,Ee=new L,De=new L,Le=new L,Ie=new L,Pe=new L,Me=new L;function Re(e,i,r,n,s){e.pointCount=0;var o=i.m_radius+n.m_radius,a=Ce;a[0]=0;var l=ge(a,i,r,n,s);if(!(l>o)){var c=Se;c[0]=0;var h=ge(c,n,s,i,r);if(!(h>o)){var u,d,p,f,_=0,m=0;h>.98*l+.001?(u=n,d=i,p=s,f=r,_=c[0],e.type=t.b2ManifoldType.e_faceB,m=1):(u=i,d=n,p=r,f=s,_=a[0],e.type=t.b2ManifoldType.e_faceA,m=0);var g=be;ve(g,u,p,_,d,f);var y=u.m_count,v=u.m_vertices,b=_,x=(_+1)%y,T=v[b],C=v[x],S=L.SubVV(C,T,we);S.Normalize();var w=L.CrossVOne(S,Ae),A=L.MidVV(T,C,Ee),E=O.MulRV(p.q,S,Le),D=L.CrossVOne(E,De),I=B.MulXV(p,T,Pe),P=B.MulXV(p,C,Me),M=L.DotVV(D,I),R=-L.DotVV(E,I)+o,N=L.DotVV(E,P)+o,k=xe,F=Te;if(!(St(k,g,L.NegV(E,Ie),R,b)<2||St(F,k,E,N,x)<2)){e.localNormal.Copy(w),e.localPoint.Copy(A);for(var V=0,j=0;j<2;++j){var G=F[j];if(L.DotVV(D,G.v)-M<=o){var U=e.points[V];if(B.MulTXV(f,G.v,U.localPoint),U.id.Copy(G.id),m){var Y=U.id.cf;U.id.cf.indexA=Y.indexB,U.id.cf.indexB=Y.indexA,U.id.cf.typeA=Y.typeB,U.id.cf.typeB=Y.typeA}++V}}e.pointCount=V}}}}var Oe=new L,Be=new L,Ne=new L,ke=new L,Fe=new L,Ve=new L,je=new L,Ge=new ft;function Ue(e,i,r,n,s){e.pointCount=0;var o=B.MulTXV(r,B.MulXV(s,n.m_p,L.s_t0),Oe),a=i.m_vertex1,l=i.m_vertex2,c=L.SubVV(l,a,Be),h=L.DotVV(c,L.SubVV(l,o,L.s_t0)),u=L.DotVV(c,L.SubVV(o,a,L.s_t0)),d=i.m_radius+n.m_radius,p=Ge;if(p.cf.indexB=0,p.cf.typeB=t.b2ContactFeatureType.e_vertex,u<=0){var f=a,_=L.SubVV(o,f,Ne);if(L.DotVV(_,_)>d*d)return;if(i.m_hasVertex0){var m=i.m_vertex0,g=a,y=L.SubVV(g,m,ke);if(L.DotVV(y,L.SubVV(g,o,L.s_t0))>0)return}return p.cf.indexA=0,p.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(f),e.points[0].id.Copy(p),void e.points[0].localPoint.Copy(n.m_p)}if(h<=0){var v=l,b=L.SubVV(o,v,Ne);if(L.DotVV(b,b)>d*d)return;if(i.m_hasVertex3){var x=i.m_vertex3,T=l,C=L.SubVV(x,T,Fe);if(L.DotVV(C,L.SubVV(o,T,L.s_t0))>0)return}return p.cf.indexA=1,p.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(v),e.points[0].id.Copy(p),void e.points[0].localPoint.Copy(n.m_p)}var S=L.DotVV(c,c),w=Ve;w.x=1/S*(h*a.x+u*l.x),w.y=1/S*(h*a.y+u*l.y);var A=L.SubVV(o,w,Ne);if(!(L.DotVV(A,A)>d*d)){var E=je.Set(-c.y,c.x);L.DotVV(E,L.SubVV(o,a,L.s_t0))<0&&E.Set(-E.x,-E.y),E.Normalize(),p.cf.indexA=0,p.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(E),e.localPoint.Copy(a),e.points[0].id.Copy(p),e.points[0].localPoint.Copy(n.m_p)}}var Ye=function(){this.type=0,this.index=0,this.separation=0},He=function(){this.vertices=L.MakeArray(8),this.normals=L.MakeArray(8),this.count=0},Xe=function(){this.i1=0,this.i2=0,this.v1=new L,this.v2=new L,this.normal=new L,this.sideNormal1=new L,this.sideOffset1=0,this.sideNormal2=new L,this.sideOffset2=0},ze=new(function(){function e(){this.m_polygonB=new He,this.m_xf=new B,this.m_centroidB=new L,this.m_v0=new L,this.m_v1=new L,this.m_v2=new L,this.m_v3=new L,this.m_normal0=new L,this.m_normal1=new L,this.m_normal2=new L,this.m_normal=new L,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new L,this.m_upperLimit=new L,this.m_radius=0,this.m_front=!1}return e.prototype.Collide=function(i,r,n,s,o){B.MulTXX(n,o,this.m_xf),B.MulXV(this.m_xf,s.m_centroid,this.m_centroidB),this.m_v0.Copy(r.m_vertex0),this.m_v1.Copy(r.m_vertex1),this.m_v2.Copy(r.m_vertex2),this.m_v3.Copy(r.m_vertex3);var a=r.m_hasVertex0,l=r.m_hasVertex3,c=L.SubVV(this.m_v2,this.m_v1,e.s_edge1);c.Normalize(),this.m_normal1.Set(c.y,-c.x);var h=L.DotVV(this.m_normal1,L.SubVV(this.m_centroidB,this.m_v1,L.s_t0)),u=0,d=0,p=!1,f=!1;if(a){var _=L.SubVV(this.m_v1,this.m_v0,e.s_edge0);_.Normalize(),this.m_normal0.Set(_.y,-_.x),p=L.CrossVV(_,c)>=0,u=L.DotVV(this.m_normal0,L.SubVV(this.m_centroidB,this.m_v0,L.s_t0))}if(l){var m=L.SubVV(this.m_v3,this.m_v2,e.s_edge2);m.Normalize(),this.m_normal2.Set(m.y,-m.x),f=L.CrossVV(c,m)>0,d=L.DotVV(this.m_normal2,L.SubVV(this.m_centroidB,this.m_v2,L.s_t0))}a&&l?p&&f?(this.m_front=u>=0||h>=0||d>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=u>=0||h>=0&&d>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=d>=0||u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=u>=0&&h>=0&&d>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?p?(this.m_front=u>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?f?(this.m_front=h>=0||d>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0&&d>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count;for(var g=0;g<s.m_count;++g)B.MulXV(this.m_xf,s.m_vertices[g],this.m_polygonB.vertices[g]),O.MulRV(this.m_xf.q,s.m_normals[g],this.m_polygonB.normals[g]);this.m_radius=s.m_radius+r.m_radius,i.pointCount=0;var y=this.ComputeEdgeSeparation(e.s_edgeAxis);if(0!==y.type&&!(y.separation>this.m_radius)){var v=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(0!==v.type&&v.separation>this.m_radius)){var b;b=0===v.type?y:v.separation>.98*y.separation+.001?v:y;var x=e.s_ie,T=e.s_rf;if(1===b.type){i.type=t.b2ManifoldType.e_faceA;var C=0,S=L.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(g=1;g<this.m_polygonB.count;++g){var w=L.DotVV(this.m_normal,this.m_polygonB.normals[g]);w<S&&(S=w,C=g)}var A=C,E=(A+1)%this.m_polygonB.count;(D=x[0]).v.Copy(this.m_polygonB.vertices[A]),D.id.cf.indexA=0,D.id.cf.indexB=A,D.id.cf.typeA=t.b2ContactFeatureType.e_face,D.id.cf.typeB=t.b2ContactFeatureType.e_vertex,(I=x[1]).v.Copy(this.m_polygonB.vertices[E]),I.id.cf.indexA=0,I.id.cf.indexB=E,I.id.cf.typeA=t.b2ContactFeatureType.e_face,I.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(T.i1=0,T.i2=1,T.v1.Copy(this.m_v1),T.v2.Copy(this.m_v2),T.normal.Copy(this.m_normal1)):(T.i1=1,T.i2=0,T.v1.Copy(this.m_v2),T.v2.Copy(this.m_v1),T.normal.Copy(this.m_normal1).SelfNeg())}else{var D,I;i.type=t.b2ManifoldType.e_faceB,(D=x[0]).v.Copy(this.m_v1),D.id.cf.indexA=0,D.id.cf.indexB=b.index,D.id.cf.typeA=t.b2ContactFeatureType.e_vertex,D.id.cf.typeB=t.b2ContactFeatureType.e_face,(I=x[1]).v.Copy(this.m_v2),I.id.cf.indexA=0,I.id.cf.indexB=b.index,I.id.cf.typeA=t.b2ContactFeatureType.e_vertex,I.id.cf.typeB=t.b2ContactFeatureType.e_face,T.i1=b.index,T.i2=(T.i1+1)%this.m_polygonB.count,T.v1.Copy(this.m_polygonB.vertices[T.i1]),T.v2.Copy(this.m_polygonB.vertices[T.i2]),T.normal.Copy(this.m_polygonB.normals[T.i1])}T.sideNormal1.Set(T.normal.y,-T.normal.x),T.sideNormal2.Copy(T.sideNormal1).SelfNeg(),T.sideOffset1=L.DotVV(T.sideNormal1,T.v1),T.sideOffset2=L.DotVV(T.sideNormal2,T.v2);var P=e.s_clipPoints1,M=e.s_clipPoints2;if(!(St(P,x,T.sideNormal1,T.sideOffset1,T.i1)<2||St(M,P,T.sideNormal2,T.sideOffset2,T.i2)<2)){1===b.type?(i.localNormal.Copy(T.normal),i.localPoint.Copy(T.v1)):(i.localNormal.Copy(s.m_normals[T.i1]),i.localPoint.Copy(s.m_vertices[T.i1]));var R=0;for(g=0;g<2;++g)if(L.DotVV(T.normal,L.SubVV(M[g].v,T.v1,L.s_t0))<=this.m_radius){var N=i.points[R];1===b.type?(B.MulTXV(this.m_xf,M[g].v,N.localPoint),N.id=M[g].id):(N.localPoint.Copy(M[g].v),N.id.cf.typeA=M[g].id.cf.typeB,N.id.cf.typeB=M[g].id.cf.typeA,N.id.cf.indexA=M[g].id.cf.indexB,N.id.cf.indexB=M[g].id.cf.indexA),++R}i.pointCount=R}}}},e.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=i;for(var r=0;r<this.m_polygonB.count;++r){var n=L.DotVV(this.m_normal,L.SubVV(this.m_polygonB.vertices[r],this.m_v1,L.s_t0));n<e.separation&&(e.separation=n)}return e},e.prototype.ComputePolygonSeparation=function(t){var r=t;r.type=0,r.index=-1,r.separation=-i;for(var n=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),s=0;s<this.m_polygonB.count;++s){var o=L.NegV(this.m_polygonB.normals[s],e.s_n),l=L.DotVV(o,L.SubVV(this.m_polygonB.vertices[s],this.m_v1,L.s_t0)),c=L.DotVV(o,L.SubVV(this.m_polygonB.vertices[s],this.m_v2,L.s_t0)),h=_(l,c);if(h>this.m_radius)return r.type=2,r.index=s,r.separation=h,r;if(L.DotVV(o,n)>=0){if(L.DotVV(L.SubVV(o,this.m_upperLimit,L.s_t0),this.m_normal)<-a)continue}else if(L.DotVV(L.SubVV(o,this.m_lowerLimit,L.s_t0),this.m_normal)<-a)continue;h>r.separation&&(r.type=2,r.index=s,r.separation=h)}return r},e.s_edge1=new L,e.s_edge0=new L,e.s_edge2=new L,e.s_ie=vt.MakeArray(2),e.s_rf=new Xe,e.s_clipPoints1=vt.MakeArray(2),e.s_clipPoints2=vt.MakeArray(2),e.s_edgeAxis=new Ye,e.s_polygonAxis=new Ye,e.s_n=new L,e.s_perp=new L,e}());function We(t,e,i,r,n){ze.Collide(t,e,i,r,n)}var Ze,Je=function(){this.mass=0,this.center=new L(0,0),this.I=0};(Ze=t.b2ShapeType||(t.b2ShapeType={}))[Ze.e_unknown=-1]="e_unknown",Ze[Ze.e_circleShape=0]="e_circleShape",Ze[Ze.e_edgeShape=1]="e_edgeShape",Ze[Ze.e_polygonShape=2]="e_polygonShape",Ze[Ze.e_chainShape=3]="e_chainShape",Ze[Ze.e_shapeTypeCount=4]="e_shapeTypeCount";var qe=function(){function e(e,i){this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=i}return e.prototype.Copy=function(t){return this.m_radius=t.m_radius,this},e.prototype.GetType=function(){return this.m_type},e}(),Ke=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function Qe(t,e){function i(){this.constructor=t}Ke(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var $e,ti=function(e){function i(i){void 0===i&&(i=0);var r=e.call(this,t.b2ShapeType.e_circleShape,i)||this;return r.m_p=new L,r}return Qe(i,e),i.prototype.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this},i.prototype.Clone=function(){return(new i).Copy(this)},i.prototype.Copy=function(t){return e.prototype.Copy.call(this,t),this.m_p.Copy(t.m_p),this},i.prototype.GetChildCount=function(){return 1},i.prototype.TestPoint=function(t,e){var r=B.MulXV(t,this.m_p,i.TestPoint_s_center),n=L.SubVV(e,r,i.TestPoint_s_d);return L.DotVV(n,n)<=v(this.m_radius)},i.prototype.ComputeDistance=function(t,e,r){var n=B.MulXV(t,this.m_p,i.ComputeDistance_s_center);return L.SubVV(e,n,r),r.Normalize()-this.m_radius},i.prototype.RayCast=function(t,e,n){var s=B.MulXV(n,this.m_p,i.RayCast_s_position),o=L.SubVV(e.p1,s,i.RayCast_s_s),a=L.DotVV(o,o)-v(this.m_radius),l=L.SubVV(e.p2,e.p1,i.RayCast_s_r),c=L.DotVV(o,l),h=L.DotVV(l,l),u=c*c-h*a;if(u<0||h<r)return!1;var d=-(c+T(u));return 0<=d&&d<=e.maxFraction*h&&(d/=h,t.fraction=d,L.AddVMulSV(o,d,l,t.normal).SelfNormalize(),!0)},i.prototype.ComputeAABB=function(t,e){var r=B.MulXV(e,this.m_p,i.ComputeAABB_s_p);t.lowerBound.Set(r.x-this.m_radius,r.y-this.m_radius),t.upperBound.Set(r.x+this.m_radius,r.y+this.m_radius)},i.prototype.ComputeMass=function(t,e){var i=v(this.m_radius);t.mass=e*s*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+L.DotVV(this.m_p,this.m_p))},i.prototype.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius},i.prototype.ComputeSubmergedArea=function(t,e,i,n){var o=B.MulXV(i,this.m_p,new L),a=-(L.DotVV(t,o)-e);if(a<-this.m_radius+r)return 0;if(a>this.m_radius)return n.Copy(o),s*this.m_radius*this.m_radius;var l=this.m_radius*this.m_radius,c=a*a,h=l*(E(a/this.m_radius)+s/2)+a*T(l-c),u=-2/3*C(l-c,1.5)/h;return n.x=o.x+t.x*u,n.y=o.y+t.y*u,h},i.prototype.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},i.TestPoint_s_center=new L,i.TestPoint_s_d=new L,i.ComputeDistance_s_center=new L,i.RayCast_s_position=new L,i.RayCast_s_s=new L,i.RayCast_s_r=new L,i.ComputeAABB_s_p=new L,i}(qe),ei=function(e){function n(){var i=e.call(this,t.b2ShapeType.e_polygonShape,l)||this;return i.m_centroid=new L(0,0),i.m_vertices=[],i.m_normals=[],i.m_count=0,i}return Qe(n,e),n.prototype.Clone=function(){return(new n).Copy(this)},n.prototype.Copy=function(t){e.prototype.Copy.call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=L.MakeArray(this.m_count),this.m_normals=L.MakeArray(this.m_count);for(var i=0;i<this.m_count;++i)this.m_vertices[i].Copy(t.m_vertices[i]),this.m_normals[i].Copy(t.m_normals[i]);return this},n.prototype.GetChildCount=function(){return 1},n.prototype.Set=function(t,e,i){if(void 0===e&&(e=t.length),void 0===i&&(i=0),e<3)return this.SetAsBox(1,1);for(var r=_(e,8),s=n.Set_s_ps,a=0,l=0;l<r;++l){for(var c=t[i+l],h=!0,u=0;u<a;++u)if(L.DistanceSquaredVV(c,s[u])<.002*o){h=!1;break}h&&s[a++].Copy(c)}if((r=a)<3)return this.SetAsBox(1,1);var d=0,p=s[0].x;for(l=1;l<r;++l){var f=s[l].x;(f>p||f===p&&s[l].y<s[d].y)&&(d=l,p=f)}for(var m=n.Set_s_hull,g=0,y=d;;){m[g]=y;var v=0;for(u=1;u<r;++u)if(v!==y){var b=L.SubVV(s[v],s[m[g]],n.Set_s_r),x=(c=L.SubVV(s[u],s[m[g]],n.Set_s_v),L.CrossVV(b,c));x<0&&(v=u),0===x&&c.LengthSquared()>b.LengthSquared()&&(v=u)}else v=u;if(++g,y=v,v===d)break}for(this.m_count=g,this.m_vertices=L.MakeArray(this.m_count),this.m_normals=L.MakeArray(this.m_count),l=0;l<g;++l)this.m_vertices[l].Copy(s[m[l]]);for(l=0;l<g;++l){var T=this.m_vertices[l],C=this.m_vertices[(l+1)%g],S=L.SubVV(C,T,L.s_t0);L.CrossVOne(S,this.m_normals[l]).SelfNormalize()}return n.ComputeCentroid(this.m_vertices,g,this.m_centroid),this},n.prototype.SetAsArray=function(t,e){return void 0===e&&(e=t.length),this.Set(t,e)},n.prototype.SetAsBox=function(t,e,i,r){if(void 0===r&&(r=0),this.m_count=4,this.m_vertices=L.MakeArray(this.m_count),this.m_normals=L.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new B;n.SetPosition(i),n.SetRotationAngle(r);for(var s=0;s<this.m_count;++s)B.MulXV(n,this.m_vertices[s],this.m_vertices[s]),O.MulRV(n.q,this.m_normals[s],this.m_normals[s])}return this},n.prototype.TestPoint=function(t,e){for(var i=B.MulTXV(t,e,n.TestPoint_s_pLocal),r=0;r<this.m_count;++r)if(L.DotVV(this.m_normals[r],L.SubVV(i,this.m_vertices[r],L.s_t0))>0)return!1;return!0},n.prototype.ComputeDistance=function(t,e,r){for(var s=B.MulTXV(t,e,n.ComputeDistance_s_pLocal),o=-i,a=n.ComputeDistance_s_normalForMaxDistance.Copy(s),l=0;l<this.m_count;++l){var c=L.DotVV(this.m_normals[l],L.SubVV(s,this.m_vertices[l],L.s_t0));c>o&&(o=c,a.Copy(this.m_normals[l]))}if(o>0){var h=n.ComputeDistance_s_minDistance.Copy(a),u=o*o;for(l=0;l<this.m_count;++l){var d=L.SubVV(s,this.m_vertices[l],n.ComputeDistance_s_distance),p=d.LengthSquared();u>p&&(h.Copy(d),u=p)}return O.MulRV(t.q,h,r),r.Normalize(),Math.sqrt(u)}return O.MulRV(t.q,a,r),o},n.prototype.RayCast=function(t,e,i){for(var r=B.MulTXV(i,e.p1,n.RayCast_s_p1),s=B.MulTXV(i,e.p2,n.RayCast_s_p2),o=L.SubVV(s,r,n.RayCast_s_d),a=0,l=e.maxFraction,c=-1,h=0;h<this.m_count;++h){var u=L.DotVV(this.m_normals[h],L.SubVV(this.m_vertices[h],r,L.s_t0)),d=L.DotVV(this.m_normals[h],o);if(0===d){if(u<0)return!1}else d<0&&u<a*d?(a=u/d,c=h):d>0&&u<l*d&&(l=u/d);if(l<a)return!1}return c>=0&&(t.fraction=a,O.MulRV(i.q,this.m_normals[c],t.normal),!0)},n.prototype.ComputeAABB=function(t,e){for(var i=B.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(i),s=0;s<this.m_count;++s){var o=B.MulXV(e,this.m_vertices[s],n.ComputeAABB_s_v);L.MinV(o,i,i),L.MaxV(o,r,r)}var a=this.m_radius;i.SelfSubXY(a,a),r.SelfAddXY(a,a)},n.prototype.ComputeMass=function(t,e){for(var i=n.ComputeMass_s_center.SetZero(),r=0,s=0,o=n.ComputeMass_s_s.SetZero(),a=0;a<this.m_count;++a)o.SelfAdd(this.m_vertices[a]);for(o.SelfMul(1/this.m_count),a=0;a<this.m_count;++a){var l=L.SubVV(this.m_vertices[a],o,n.ComputeMass_s_e1),c=L.SubVV(this.m_vertices[(a+1)%this.m_count],o,n.ComputeMass_s_e2),h=L.CrossVV(l,c),u=.5*h;r+=u,i.SelfAdd(L.MulSV(u*(1/3),L.AddVV(l,c,L.s_t0),L.s_t1));var d=l.x,p=l.y,f=c.x,_=c.y;s+=1/3*.25*h*(d*d+f*d+f*f+p*p+_*p+_*_)}t.mass=e*r,i.SelfMul(1/r),L.AddVV(i,o,t.center),t.I=e*s,t.I+=t.mass*(L.DotVV(t.center,t.center)-L.DotVV(i,i))},n.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,r=this.m_vertices[e],s=L.SubVV(this.m_vertices[i],r,n.Validate_s_e),o=0;o<this.m_count;++o)if(o!==e&&o!==i){var a=L.SubVV(this.m_vertices[o],r,n.Validate_s_v);if(L.CrossVV(s,a)<0)return!1}return!0},n.prototype.SetupDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},n.prototype.ComputeSubmergedArea=function(t,e,i,s){for(var o=O.MulTRV(i.q,t,n.ComputeSubmergedArea_s_normalL),a=e-L.DotVV(t,i.p),l=n.ComputeSubmergedArea_s_depths,c=0,h=-1,u=-1,d=!1,p=0;p<this.m_count;++p){l[p]=L.DotVV(o,this.m_vertices[p])-a;var f=l[p]<-r;p>0&&(f?d||(h=p-1,c++):d&&(u=p-1,c++)),d=f}switch(c){case 0:if(d){var _=n.ComputeSubmergedArea_s_md;return this.ComputeMass(_,1),B.MulXV(i,_.center,s),_.mass}return 0;case 1:-1===h?h=this.m_count-1:u=this.m_count-1}for(var m,g=(h+1)%this.m_count,y=(u+1)%this.m_count,v=(0-l[h])/(l[g]-l[h]),b=(0-l[u])/(l[y]-l[u]),x=n.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-v)+this.m_vertices[g].x*v,this.m_vertices[h].y*(1-v)+this.m_vertices[g].y*v),T=n.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[u].x*(1-b)+this.m_vertices[y].x*b,this.m_vertices[u].y*(1-b)+this.m_vertices[y].y*b),C=0,S=n.ComputeSubmergedArea_s_center.SetZero(),w=this.m_vertices[g],A=g;A!==y;){m=(A=(A+1)%this.m_count)===y?T:this.m_vertices[A];var E=.5*((w.x-x.x)*(m.y-x.y)-(w.y-x.y)*(m.x-x.x));C+=E,S.x+=E*(x.x+w.x+m.x)/3,S.y+=E*(x.y+w.y+m.y)/3,w=m}return S.SelfMul(1/C),B.MulXV(i,S,s),C},n.prototype.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)},n.ComputeCentroid=function(t,e,i){var r=i;r.SetZero();for(var s=0,o=n.ComputeCentroid_s_pRef.SetZero(),a=0;a<e;++a){var l=o,c=t[a],h=t[(a+1)%e],u=L.SubVV(c,l,n.ComputeCentroid_s_e1),d=L.SubVV(h,l,n.ComputeCentroid_s_e2),p=.5*L.CrossVV(u,d);s+=p,r.x+=p*(1/3)*(l.x+c.x+h.x),r.y+=p*(1/3)*(l.y+c.y+h.y)}return r.SelfMul(1/s),r},n.Set_s_ps=L.MakeArray(8),n.Set_s_hull=p(8),n.Set_s_r=new L,n.Set_s_v=new L,n.TestPoint_s_pLocal=new L,n.ComputeDistance_s_pLocal=new L,n.ComputeDistance_s_normalForMaxDistance=new L,n.ComputeDistance_s_minDistance=new L,n.ComputeDistance_s_distance=new L,n.RayCast_s_p1=new L,n.RayCast_s_p2=new L,n.RayCast_s_d=new L,n.ComputeAABB_s_v=new L,n.ComputeMass_s_center=new L,n.ComputeMass_s_s=new L,n.ComputeMass_s_e1=new L,n.ComputeMass_s_e2=new L,n.Validate_s_e=new L,n.Validate_s_v=new L,n.ComputeSubmergedArea_s_normalL=new L,n.ComputeSubmergedArea_s_depths=p(8),n.ComputeSubmergedArea_s_md=new Je,n.ComputeSubmergedArea_s_intoVec=new L,n.ComputeSubmergedArea_s_outoVec=new L,n.ComputeSubmergedArea_s_center=new L,n.ComputeCentroid_s_pRef=new L,n.ComputeCentroid_s_e1=new L,n.ComputeCentroid_s_e2=new L,n}(qe),ii=function(e){function i(){var i=e.call(this,t.b2ShapeType.e_edgeShape,l)||this;return i.m_vertex1=new L,i.m_vertex2=new L,i.m_vertex0=new L,i.m_vertex3=new L,i.m_hasVertex0=!1,i.m_hasVertex3=!1,i}return Qe(i,e),i.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},i.prototype.Clone=function(){return(new i).Copy(this)},i.prototype.Copy=function(t){return e.prototype.Copy.call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this},i.prototype.GetChildCount=function(){return 1},i.prototype.TestPoint=function(){return!1},i.prototype.ComputeDistance=function(t,e,r){var n=B.MulXV(t,this.m_vertex1,i.ComputeDistance_s_v1),s=B.MulXV(t,this.m_vertex2,i.ComputeDistance_s_v2),o=L.SubVV(e,n,i.ComputeDistance_s_d),a=L.SubVV(s,n,i.ComputeDistance_s_s),l=L.DotVV(o,a);if(l>0){var c=L.DotVV(a,a);l>c?L.SubVV(e,s,o):o.SelfMulSub(l/c,a)}return r.Copy(o),r.Normalize()},i.prototype.RayCast=function(t,e,r){var n=B.MulTXV(r,e.p1,i.RayCast_s_p1),s=B.MulTXV(r,e.p2,i.RayCast_s_p2),o=L.SubVV(s,n,i.RayCast_s_d),a=this.m_vertex1,l=this.m_vertex2,c=L.SubVV(l,a,i.RayCast_s_e),h=t.normal.Set(c.y,-c.x).SelfNormalize(),u=L.DotVV(h,L.SubVV(a,n,L.s_t0)),d=L.DotVV(h,o);if(0===d)return!1;var p=u/d;if(p<0||e.maxFraction<p)return!1;var f=L.AddVMulSV(n,p,o,i.RayCast_s_q),_=L.SubVV(l,a,i.RayCast_s_r),m=L.DotVV(_,_);if(0===m)return!1;var g=L.DotVV(L.SubVV(f,a,L.s_t0),_)/m;return!(g<0||1<g||(t.fraction=p,O.MulRV(r.q,t.normal,t.normal),u>0&&t.normal.SelfNeg(),0))},i.prototype.ComputeAABB=function(t,e){var r=B.MulXV(e,this.m_vertex1,i.ComputeAABB_s_v1),n=B.MulXV(e,this.m_vertex2,i.ComputeAABB_s_v2);L.MinV(r,n,t.lowerBound),L.MaxV(r,n,t.upperBound);var s=this.m_radius;t.lowerBound.SelfSubXY(s,s),t.upperBound.SelfAddXY(s,s)},i.prototype.ComputeMass=function(t){t.mass=0,L.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},i.prototype.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},i.prototype.ComputeSubmergedArea=function(t,e,i,r){return r.SetZero(),0},i.prototype.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},i.ComputeDistance_s_v1=new L,i.ComputeDistance_s_v2=new L,i.ComputeDistance_s_d=new L,i.ComputeDistance_s_s=new L,i.RayCast_s_p1=new L,i.RayCast_s_p2=new L,i.RayCast_s_d=new L,i.RayCast_s_e=new L,i.RayCast_s_q=new L,i.RayCast_s_r=new L,i.ComputeAABB_s_v1=new L,i.ComputeAABB_s_v2=new L,i}(qe),ri=function(e){function i(){var i=e.call(this,t.b2ShapeType.e_chainShape,l)||this;return i.m_vertices=[],i.m_count=0,i.m_prevVertex=new L,i.m_nextVertex=new L,i.m_hasPrevVertex=!1,i.m_hasNextVertex=!1,i}return Qe(i,e),i.prototype.CreateLoop=function(t,e,i){if(void 0===e&&(e=t.length),void 0===i&&(i=0),e<3)return this;this.m_count=e+1,this.m_vertices=L.MakeArray(this.m_count);for(var r=0;r<e;++r)this.m_vertices[r].Copy(t[i+r]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},i.prototype.CreateChain=function(t,e,i){void 0===e&&(e=t.length),void 0===i&&(i=0),this.m_count=e,this.m_vertices=L.MakeArray(e);for(var r=0;r<e;++r)this.m_vertices[r].Copy(t[i+r]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},i.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},i.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},i.prototype.Clone=function(){return(new i).Copy(this)},i.prototype.Copy=function(t){return e.prototype.Copy.call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this},i.prototype.GetChildCount=function(){return this.m_count-1},i.prototype.GetChildEdge=function(e,i){e.m_type=t.b2ShapeType.e_edgeShape,e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[i]),e.m_vertex2.Copy(this.m_vertices[i+1]),i>0?(e.m_vertex0.Copy(this.m_vertices[i-1]),e.m_hasVertex0=!0):(e.m_vertex0.Copy(this.m_prevVertex),e.m_hasVertex0=this.m_hasPrevVertex),i<this.m_count-2?(e.m_vertex3.Copy(this.m_vertices[i+2]),e.m_hasVertex3=!0):(e.m_vertex3.Copy(this.m_nextVertex),e.m_hasVertex3=this.m_hasNextVertex)},i.prototype.TestPoint=function(){return!1},i.prototype.ComputeDistance=function(t,e,r,n){var s=i.ComputeDistance_s_edgeShape;return this.GetChildEdge(s,n),s.ComputeDistance(t,e,r,0)},i.prototype.RayCast=function(t,e,r,n){var s=i.RayCast_s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[n]),s.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),s.RayCast(t,e,r,0)},i.prototype.ComputeAABB=function(t,e,r){var n=this.m_vertices[r],s=this.m_vertices[(r+1)%this.m_count],o=B.MulXV(e,n,i.ComputeAABB_s_v1),a=B.MulXV(e,s,i.ComputeAABB_s_v2);L.MinV(o,a,t.lowerBound),L.MaxV(o,a,t.upperBound)},i.prototype.ComputeMass=function(t){t.mass=0,t.center.SetZero(),t.I=0},i.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius},i.prototype.ComputeSubmergedArea=function(t,e,i,r){return r.SetZero(),0},i.prototype.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},i.ComputeDistance_s_edgeShape=new ii,i.RayCast_s_edgeShape=new ii,i.ComputeAABB_s_v1=new L,i.ComputeAABB_s_v2=new L,i}(qe),ni=function(){function t(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return t.prototype.Clone=function(){return(new t).Copy(this)},t.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this},t.DEFAULT=new t,t}(),si=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new ni},oi=function(t){this.aabb=new Tt,this.childIndex=0,this.fixture=t},ai=function(){function t(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new ni,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}return t.prototype.GetType=function(){return this.m_shape.GetType()},t.prototype.GetShape=function(){return this.m_shape},t.prototype.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},t.prototype.IsSensor=function(){return this.m_isSensor},t.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},t.prototype.GetFilterData=function(){return this.m_filter},t.prototype.Refilter=function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),r=e.GetFixtureB();i!==this&&r!==this||e.FlagForFiltering(),t=t.next}var n=this.m_body.GetWorld();if(null!==n)for(var s=n.m_contactManager.m_broadPhase,o=0;o<this.m_proxyCount;++o)s.TouchProxy(this.m_proxies[o].treeNode)},t.prototype.GetBody=function(){return this.m_body},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetUserData=function(){return this.m_userData},t.prototype.SetUserData=function(t){this.m_userData=t},t.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},t.prototype.ComputeDistance=function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)},t.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},t.prototype.GetMassData=function(t){return void 0===t&&(t=new Je),this.m_shape.ComputeMass(t,this.m_density),t},t.prototype.SetDensity=function(t){this.m_density=t},t.prototype.GetDensity=function(){return this.m_density},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetAABB=function(t){return this.m_proxies[t].aabb},t.prototype.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)},t.prototype.Create=function(t){var i=this;this.m_userData=t.userData,this.m_friction=e(t.friction,.2),this.m_restitution=e(t.restitution,0),this.m_next=null,this.m_filter.Copy(e(t.filter,ni.DEFAULT)),this.m_isSensor=e(t.isSensor,!1),this.m_proxies=d(this.m_shape.GetChildCount(),(function(){return new oi(i)})),this.m_proxyCount=0,this.m_density=e(t.density,0)},t.prototype.Destroy=function(){},t.prototype.CreateProxies=function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var r=this.m_proxies[i]=new oi(this);this.m_shape.ComputeAABB(r.aabb,t,i),r.treeNode=e.CreateProxy(r.aabb,r),r.childIndex=i}},t.prototype.DestroyProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0},t.prototype.TouchProxies=function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount,i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)},t.prototype.Synchronize=function(e,i){if(0!==this.m_proxyCount)for(var r=this.m_body.m_world.m_contactManager.m_broadPhase,n=0;n<this.m_proxyCount;++n){var s=this.m_proxies[n],o=t.Synchronize_s_aabb1,a=t.Synchronize_s_aabb2;this.m_shape.ComputeAABB(o,e,n),this.m_shape.ComputeAABB(a,i,n),s.aabb.Combine2(o,a);var l=L.SubVV(i.p,e.p,t.Synchronize_s_displacement);r.MoveProxy(s.treeNode,s.aabb,l)}},t.Synchronize_s_aabb1=new Tt,t.Synchronize_s_aabb2=new Tt,t.Synchronize_s_displacement=new L,t}();($e=t.b2BodyType||(t.b2BodyType={}))[$e.b2_unknown=-1]="b2_unknown",$e[$e.b2_staticBody=0]="b2_staticBody",$e[$e.b2_kinematicBody=1]="b2_kinematicBody",$e[$e.b2_dynamicBody=2]="b2_dynamicBody";var li,ci,hi=function(){function i(i,r){this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new B,this.m_xf0=new B,this.m_sweep=new N,this.m_linearVelocity=new L,this.m_angularVelocity=0,this.m_force=new L,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=e(i.bullet,!1),this.m_fixedRotationFlag=e(i.fixedRotation,!1),this.m_autoSleepFlag=e(i.allowSleep,!0),this.m_awakeFlag=e(i.awake,!0),this.m_activeFlag=e(i.active,!0),this.m_world=r,this.m_xf.p.Copy(e(i.position,L.ZERO)),this.m_xf.q.SetAngle(e(i.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(e(i.linearVelocity,L.ZERO)),this.m_angularVelocity=e(i.angularVelocity,0),this.m_linearDamping=e(i.linearDamping,0),this.m_angularDamping=e(i.angularDamping,0),this.m_gravityScale=e(i.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=e(i.type,t.b2BodyType.b2_staticBody),i.type===t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=i.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}return i.prototype.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof qe?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)},i.prototype.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error;var e=new ai(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},i.prototype.CreateFixtureShapeDensity=function(t,e){void 0===e&&(e=0);var r=i.CreateFixtureShapeDensity_s_def;return r.shape=t,r.density=e,this.CreateFixtureDef(r)},i.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var s=n.GetFixtureA(),o=n.GetFixtureB();t!==s&&t!==o||this.m_world.m_contactManager.Destroy(n)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()},i.prototype.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e)},i.prototype.SetTransformXY=function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),B.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},i.prototype.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle())},i.prototype.GetTransform=function(){return this.m_xf},i.prototype.GetPosition=function(){return this.m_xf.p},i.prototype.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle())},i.prototype.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle())},i.prototype.GetAngle=function(){return this.m_sweep.a},i.prototype.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t)},i.prototype.GetWorldCenter=function(){return this.m_sweep.c},i.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},i.prototype.SetLinearVelocity=function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(L.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))},i.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},i.prototype.SetAngularVelocity=function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)},i.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},i.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},i.prototype.ApplyForce=function(e,i,r){void 0===r&&(r=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x))},i.prototype.ApplyForceToCenter=function(e,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))},i.prototype.ApplyTorque=function(e,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))},i.prototype.ApplyLinearImpulse=function(e,i,r){void 0===r&&(r=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x)))},i.prototype.ApplyLinearImpulseToCenter=function(e,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))},i.prototype.ApplyAngularImpulse=function(e,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))},i.prototype.GetMass=function(){return this.m_mass},i.prototype.GetInertia=function(){return this.m_I+this.m_mass*L.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*L.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},i.prototype.SetMassData=function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*L.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var r=i.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),B.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),L.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,L.SubVV(this.m_sweep.c,r,L.s_t0),this.m_linearVelocity)}},i.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=i.ResetMassData_s_localCenter.SetZero(),r=this.m_fixtureList;r;r=r.m_next)if(0!==r.m_density){var n=r.GetMassData(i.ResetMassData_s_massData);this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*L.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=i.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),B.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),L.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,L.SubVV(this.m_sweep.c,s,L.s_t0),this.m_linearVelocity)},i.prototype.GetWorldPoint=function(t,e){return B.MulXV(this.m_xf,t,e)},i.prototype.GetWorldVector=function(t,e){return O.MulRV(this.m_xf.q,t,e)},i.prototype.GetLocalPoint=function(t,e){return B.MulTXV(this.m_xf,t,e)},i.prototype.GetLocalVector=function(t,e){return O.MulTRV(this.m_xf.q,t,e)},i.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return L.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,L.SubVV(t,this.m_sweep.c,L.s_t0),e)},i.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},i.prototype.GetLinearDamping=function(){return this.m_linearDamping},i.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},i.prototype.GetAngularDamping=function(){return this.m_angularDamping},i.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},i.prototype.GetGravityScale=function(){return this.m_gravityScale},i.prototype.SetGravityScale=function(t){this.m_gravityScale=t},i.prototype.SetType=function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==e){this.m_type=e,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var r=i;i=i.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}},i.prototype.GetType=function(){return this.m_type},i.prototype.SetBullet=function(t){this.m_bulletFlag=t},i.prototype.IsBullet=function(){return this.m_bulletFlag},i.prototype.SetSleepingAllowed=function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)},i.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag},i.prototype.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},i.prototype.IsAwake=function(){return this.m_awakeFlag},i.prototype.SetActive=function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies();for(var i=this.m_contactList;i;){var r=i;i=i.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}},i.prototype.IsActive=function(){return this.m_activeFlag},i.prototype.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())},i.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag},i.prototype.GetFixtureList=function(){return this.m_fixtureList},i.prototype.GetJointList=function(){return this.m_jointList},i.prototype.GetContactList=function(){return this.m_contactList},i.prototype.GetNext=function(){return this.m_next},i.prototype.GetUserData=function(){return this.m_userData},i.prototype.SetUserData=function(t){this.m_userData=t},i.prototype.GetWorld=function(){return this.m_world},i.prototype.Dump=function(e){var i=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");var r="";switch(this.m_type){case t.b2BodyType.b2_staticBody:r="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:r="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:r="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",r),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(var n=this.m_fixtureList;n;n=n.m_next)e("  {\n"),n.Dump(e,i),e("  }\n");e("}\n")},i.prototype.SynchronizeFixtures=function(){var t=i.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),O.MulRV(t.q,this.m_sweep.localCenter,t.p),L.SubVV(this.m_sweep.c0,t.p,t.p);for(var e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf)},i.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),O.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),L.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},i.prototype.ShouldCollide=function(e){return(this.m_type!==t.b2BodyType.b2_staticBody||e.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)},i.prototype.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0},i.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),O.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),L.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},i.prototype.GetControllerList=function(){return this.m_controllerList},i.prototype.GetControllerCount=function(){return this.m_controllerCount},i.CreateFixtureShapeDensity_s_def=new si,i.SetMassData_s_oldCenter=new L,i.ResetMassData_s_localCenter=new L,i.ResetMassData_s_oldCenter=new L,i.ResetMassData_s_massData=new Je,i.SynchronizeFixtures_s_xf1=new B,i}();(li=t.b2JointType||(t.b2JointType={}))[li.e_unknownJoint=0]="e_unknownJoint",li[li.e_revoluteJoint=1]="e_revoluteJoint",li[li.e_prismaticJoint=2]="e_prismaticJoint",li[li.e_distanceJoint=3]="e_distanceJoint",li[li.e_pulleyJoint=4]="e_pulleyJoint",li[li.e_mouseJoint=5]="e_mouseJoint",li[li.e_gearJoint=6]="e_gearJoint",li[li.e_wheelJoint=7]="e_wheelJoint",li[li.e_weldJoint=8]="e_weldJoint",li[li.e_frictionJoint=9]="e_frictionJoint",li[li.e_ropeJoint=10]="e_ropeJoint",li[li.e_motorJoint=11]="e_motorJoint",li[li.e_areaJoint=12]="e_areaJoint",(ci=t.b2LimitState||(t.b2LimitState={}))[ci.e_inactiveLimit=0]="e_inactiveLimit",ci[ci.e_atLowerLimit=1]="e_atLowerLimit",ci[ci.e_atUpperLimit=2]="e_atUpperLimit",ci[ci.e_equalLimits=3]="e_equalLimits";var ui=function(){function t(){this.linear=new L,this.angularA=0,this.angularB=0}return t.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},t.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this},t}(),di=function(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e},pi=function(e){this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=e},fi=function(){function i(i){this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=i.type,this.m_edgeA=new di(this,i.bodyB),this.m_edgeB=new di(this,i.bodyA),this.m_bodyA=i.bodyA,this.m_bodyB=i.bodyB,this.m_collideConnected=e(i.collideConnected,!1),this.m_userData=i.userData}return i.prototype.GetType=function(){return this.m_type},i.prototype.GetBodyA=function(){return this.m_bodyA},i.prototype.GetBodyB=function(){return this.m_bodyB},i.prototype.GetNext=function(){return this.m_next},i.prototype.GetUserData=function(){return this.m_userData},i.prototype.SetUserData=function(t){this.m_userData=t},i.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},i.prototype.GetCollideConnected=function(){return this.m_collideConnected},i.prototype.Dump=function(t){t("// Dump is not supported for this joint type.\n")},i.prototype.ShiftOrigin=function(){},i}(),_i=function(e){function i(){var i=e.call(this,t.b2JointType.e_distanceJoint)||this;return i.localAnchorA=new L,i.localAnchorB=new L,i.length=1,i.frequencyHz=0,i.dampingRatio=0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.length=L.DistanceVV(i,r),this.frequencyHz=0,this.dampingRatio=0},i}(pi),mi=function(t){function i(i){var r=t.call(this,i)||this;return r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_bias=0,r.m_localAnchorA=new L,r.m_localAnchorB=new L,r.m_gamma=0,r.m_impulse=0,r.m_length=0,r.m_indexA=0,r.m_indexB=0,r.m_u=new L,r.m_rA=new L,r.m_rB=new L,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_qA=new O,r.m_qB=new O,r.m_lalcA=new L,r.m_lalcB=new L,r.m_frequencyHz=e(i.frequencyHz,0),r.m_dampingRatio=e(i.dampingRatio,0),r.m_localAnchorA.Copy(i.localAnchorA),r.m_localAnchorB.Copy(i.localAnchorB),r.m_length=i.length,r}return Qe(i,t),i.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e},i.prototype.GetReactionTorque=function(){return 0},i.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},i.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},i.prototype.SetLength=function(t){this.m_length=t},i.prototype.Length=function(){return this.m_length},i.prototype.SetFrequency=function(t){this.m_frequencyHz=t},i.prototype.GetFrequency=function(){return this.m_frequencyHz},i.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},i.prototype.GetDampingRatio=function(){return this.m_dampingRatio},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(r),p=this.m_qB.SetAngle(c);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),O.MulRV(d,this.m_lalcA,this.m_rA),L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(p,this.m_lalcB,this.m_rB),this.m_u.x=l.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=l.y+this.m_rB.y-e.y-this.m_rA.y;var f=this.m_u.Length();f>o?this.m_u.SelfMul(1/f):this.m_u.SetZero();var _=L.CrossVV(this.m_rA,this.m_u),m=L.CrossVV(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==g?1/g:0,this.m_frequencyHz>0){var y=f-this.m_length,v=2*s*this.m_frequencyHz,b=2*this.m_mass*this.m_dampingRatio*v,x=this.m_mass*v*v,T=t.step.dt;this.m_gamma=T*(b+T*x),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*T*x*this.m_gamma,g+=this.m_gamma,this.m_mass=0!==g?1/g:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var C=L.MulSV(this.m_impulse,this.m_u,i.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,C),a-=this.m_invIA*L.CrossVV(this.m_rA,C),h.SelfMulAdd(this.m_invMassB,C),u+=this.m_invIB*L.CrossVV(this.m_rB,C)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=L.AddVCrossSV(e,r,this.m_rA,i.SolveVelocityConstraints_s_vpA),a=L.AddVCrossSV(n,s,this.m_rB,i.SolveVelocityConstraints_s_vpB),l=L.DotVV(this.m_u,L.SubVV(a,o,L.s_t0)),c=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=c;var h=L.MulSV(c,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),r-=this.m_invIA*L.CrossVV(this.m_rA,h),n.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*L.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s},i.prototype.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,a=this.m_qA.SetAngle(r),l=this.m_qB.SetAngle(s),c=O.MulRV(a,this.m_lalcA,this.m_rA),h=O.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_u;u.x=n.x+h.x-e.x-c.x,u.y=n.y+h.y-e.y-c.y;var d=this.m_u.Normalize()-this.m_length;d=g(d,-.2,.2);var p=-this.m_mass*d,_=L.MulSV(p,u,i.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,_),r-=this.m_invIA*L.CrossVV(c,_),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*L.CrossVV(h,_),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,f(d)<o},i.InitVelocityConstraints_s_P=new L,i.SolveVelocityConstraints_s_vpA=new L,i.SolveVelocityConstraints_s_vpB=new L,i.SolveVelocityConstraints_s_P=new L,i.SolvePositionConstraints_s_P=new L,i}(fi),gi=function(e){function i(){var i=e.call(this,t.b2JointType.e_areaJoint)||this;return i.bodies=[],i.frequencyHz=0,i.dampingRatio=0,i}return Qe(i,e),i.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)},i}(pi),yi=function(t){function i(i){var r=t.call(this,i)||this;r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_impulse=0,r.m_targetArea=0,r.m_bodies=i.bodies,r.m_frequencyHz=e(i.frequencyHz,0),r.m_dampingRatio=e(i.dampingRatio,0),r.m_targetLengths=p(i.bodies.length),r.m_normals=L.MakeArray(i.bodies.length),r.m_joints=[],r.m_deltas=L.MakeArray(i.bodies.length),r.m_delta=new L;var n=new _i;n.frequencyHz=r.m_frequencyHz,n.dampingRatio=r.m_dampingRatio,r.m_targetArea=0;for(var s=0;s<r.m_bodies.length;++s){var o=r.m_bodies[s],a=r.m_bodies[(s+1)%r.m_bodies.length],l=o.GetWorldCenter(),c=a.GetWorldCenter();r.m_targetLengths[s]=L.DistanceVV(l,c),r.m_targetArea+=L.CrossVV(l,c),n.Initialize(o,a,l,c),r.m_joints[s]=o.GetWorld().CreateJoint(n)}return r.m_targetArea*=.5,r}return Qe(i,t),i.prototype.GetAnchorA=function(t){return t},i.prototype.GetAnchorB=function(t){return t},i.prototype.GetReactionForce=function(t,e){return e},i.prototype.GetReactionTorque=function(){return 0},i.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)},i.prototype.GetFrequency=function(){return this.m_frequencyHz},i.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)},i.prototype.GetDampingRatio=function(){return this.m_dampingRatio},i.prototype.Dump=function(t){t("Area joint dumping is not supported.\n")},i.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],r=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,s=t.positions[r.m_islandIndex].c,o=this.m_deltas[e];L.SubVV(s,n,o)}if(t.step.warmStarting)for(this.m_impulse*=t.step.dtRatio,e=0;e<this.m_bodies.length;++e){var a=this.m_bodies[e],l=t.velocities[a.m_islandIndex].v;o=this.m_deltas[e],l.x+=a.m_invMass*o.y*.5*this.m_impulse,l.y+=a.m_invMass*-o.x*.5*this.m_impulse}else this.m_impulse=0},i.prototype.SolveVelocityConstraints=function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],s=t.velocities[n.m_islandIndex].v;e+=(a=this.m_deltas[r]).LengthSquared()/n.GetMass(),i+=L.CrossVV(s,a)}var o=-2*i/e;for(this.m_impulse+=o,r=0;r<this.m_bodies.length;++r){n=this.m_bodies[r],s=t.velocities[n.m_islandIndex].v;var a=this.m_deltas[r];s.x+=n.m_invMass*a.y*.5*o,s.y+=n.m_invMass*-a.x*.5*o}},i.prototype.SolvePositionConstraints=function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var s=this.m_bodies[n],a=this.m_bodies[(n+1)%this.m_bodies.length],l=t.positions[s.m_islandIndex].c,c=t.positions[a.m_islandIndex].c,h=(p=L.SubVV(c,l,this.m_delta)).Length();h<r&&(h=1),this.m_normals[n].x=p.y/h,this.m_normals[n].y=-p.x/h,e+=h,i+=L.CrossVV(l,c)}i*=.5;var u=.5*(this.m_targetArea-i)/e,d=!0;for(n=0;n<this.m_bodies.length;++n){s=this.m_bodies[n],l=t.positions[s.m_islandIndex].c;var p,f=(n+1)%this.m_bodies.length;(p=L.AddVV(this.m_normals[n],this.m_normals[f],this.m_delta)).SelfMul(u);var _=p.LengthSquared();_>v(.2)&&p.SelfMul(.2/T(_)),_>v(o)&&(d=!1),l.x+=p.x,l.y+=p.y}return d},i}(fi),vi=function(e){function i(){var i=e.call(this,t.b2JointType.e_frictionJoint)||this;return i.localAnchorA=new L,i.localAnchorB=new L,i.maxForce=0,i.maxTorque=0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)},i}(pi),bi=function(t){function i(i){var r=t.call(this,i)||this;return r.m_localAnchorA=new L,r.m_localAnchorB=new L,r.m_linearImpulse=new L,r.m_angularImpulse=0,r.m_maxForce=0,r.m_maxTorque=0,r.m_indexA=0,r.m_indexB=0,r.m_rA=new L,r.m_rB=new L,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_linearMass=new M,r.m_angularMass=0,r.m_qA=new O,r.m_qB=new O,r.m_lalcA=new L,r.m_lalcB=new L,r.m_K=new M,r.m_localAnchorA.Copy(i.localAnchorA),r.m_localAnchorB.Copy(i.localAnchorB),r.m_linearImpulse.SetZero(),r.m_maxForce=e(i.maxForce,0),r.m_maxTorque=e(i.maxTorque,0),r.m_linearMass.SetZero(),r}return Qe(i,t),i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=O.MulRV(a,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=O.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,f=this.m_invIB,_=this.m_K;if(_.ex.x=u+d+p*c.y*c.y+f*h.y*h.y,_.ex.y=-p*c.x*c.y-f*h.x*h.y,_.ey.x=_.ex.y,_.ey.y=u+d+p*c.x*c.x+f*h.x*h.x,_.GetInverse(this.m_linearMass),this.m_angularMass=p+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var m=this.m_linearImpulse;i.SelfMulSub(u,m),r-=p*(L.CrossVV(this.m_rA,m)+this.m_angularImpulse),s.SelfMulAdd(d,m),o+=f*(L.CrossVV(this.m_rB,m)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,h=t.step.dt,u=s-r,d=-this.m_angularMass*u,p=this.m_angularImpulse,f=h*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+d,-f,f),r-=l*(d=this.m_angularImpulse-p),s+=c*d;var _=L.SubVV(L.AddVCrossSV(n,s,this.m_rB,L.s_t0),L.AddVCrossSV(e,r,this.m_rA,L.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),m=M.MulMV(this.m_linearMass,_,i.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=i.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(m),f=h*this.m_maxForce,this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),L.SubVV(this.m_linearImpulse,y,m),e.SelfMulSub(o,m),r-=l*L.CrossVV(this.m_rA,m),n.SelfMulAdd(a,m),s+=c*L.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s},i.prototype.SolvePositionConstraints=function(){return!0},i.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e},i.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},i.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},i.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},i.prototype.SetMaxForce=function(t){this.m_maxForce=t},i.prototype.GetMaxForce=function(){return this.m_maxForce},i.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},i.prototype.GetMaxTorque=function(){return this.m_maxTorque},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.SolveVelocityConstraints_s_Cdot_v2=new L,i.SolveVelocityConstraints_s_impulseV=new L,i.SolveVelocityConstraints_s_oldImpulseV=new L,i}(fi),xi=function(e){function i(){var i=e.call(this,t.b2JointType.e_gearJoint)||this;return i.ratio=1,i}return Qe(i,e),i}(pi),Ti=function(i){function r(r){var n,s,o=i.call(this,r)||this;o.m_typeA=t.b2JointType.e_unknownJoint,o.m_typeB=t.b2JointType.e_unknownJoint,o.m_localAnchorA=new L,o.m_localAnchorB=new L,o.m_localAnchorC=new L,o.m_localAnchorD=new L,o.m_localAxisC=new L,o.m_localAxisD=new L,o.m_referenceAngleA=0,o.m_referenceAngleB=0,o.m_constant=0,o.m_ratio=0,o.m_impulse=0,o.m_indexA=0,o.m_indexB=0,o.m_indexC=0,o.m_indexD=0,o.m_lcA=new L,o.m_lcB=new L,o.m_lcC=new L,o.m_lcD=new L,o.m_mA=0,o.m_mB=0,o.m_mC=0,o.m_mD=0,o.m_iA=0,o.m_iB=0,o.m_iC=0,o.m_iD=0,o.m_JvAC=new L,o.m_JvBD=new L,o.m_JwA=0,o.m_JwB=0,o.m_JwC=0,o.m_JwD=0,o.m_mass=0,o.m_qA=new O,o.m_qB=new O,o.m_qC=new O,o.m_qD=new O,o.m_lalcA=new L,o.m_lalcB=new L,o.m_lalcC=new L,o.m_lalcD=new L,o.m_joint1=r.joint1,o.m_joint2=r.joint2,o.m_typeA=o.m_joint1.GetType(),o.m_typeB=o.m_joint2.GetType(),o.m_bodyC=o.m_joint1.GetBodyA(),o.m_bodyA=o.m_joint1.GetBodyB();var a=o.m_bodyA.m_xf,l=o.m_bodyA.m_sweep.a,c=o.m_bodyC.m_xf,h=o.m_bodyC.m_sweep.a;if(o.m_typeA===t.b2JointType.e_revoluteJoint){var u=r.joint1;o.m_localAnchorC.Copy(u.m_localAnchorA),o.m_localAnchorA.Copy(u.m_localAnchorB),o.m_referenceAngleA=u.m_referenceAngle,o.m_localAxisC.SetZero(),n=l-h-o.m_referenceAngleA}else{var d=r.joint1;o.m_localAnchorC.Copy(d.m_localAnchorA),o.m_localAnchorA.Copy(d.m_localAnchorB),o.m_referenceAngleA=d.m_referenceAngle,o.m_localAxisC.Copy(d.m_localXAxisA);var p=o.m_localAnchorC,f=O.MulTRV(c.q,L.AddVV(O.MulRV(a.q,o.m_localAnchorA,L.s_t0),L.SubVV(a.p,c.p,L.s_t1),L.s_t0),L.s_t0);n=L.DotVV(L.SubVV(f,p,L.s_t0),o.m_localAxisC)}o.m_bodyD=o.m_joint2.GetBodyA(),o.m_bodyB=o.m_joint2.GetBodyB();var _=o.m_bodyB.m_xf,m=o.m_bodyB.m_sweep.a,g=o.m_bodyD.m_xf,y=o.m_bodyD.m_sweep.a;if(o.m_typeB===t.b2JointType.e_revoluteJoint)u=r.joint2,o.m_localAnchorD.Copy(u.m_localAnchorA),o.m_localAnchorB.Copy(u.m_localAnchorB),o.m_referenceAngleB=u.m_referenceAngle,o.m_localAxisD.SetZero(),s=m-y-o.m_referenceAngleB;else{d=r.joint2,o.m_localAnchorD.Copy(d.m_localAnchorA),o.m_localAnchorB.Copy(d.m_localAnchorB),o.m_referenceAngleB=d.m_referenceAngle,o.m_localAxisD.Copy(d.m_localXAxisA);var v=o.m_localAnchorD,b=O.MulTRV(g.q,L.AddVV(O.MulRV(_.q,o.m_localAnchorB,L.s_t0),L.SubVV(_.p,g.p,L.s_t1),L.s_t0),L.s_t0);s=L.DotVV(L.SubVV(b,v,L.s_t0),o.m_localAxisD)}return o.m_ratio=e(r.ratio,1),o.m_constant=n+o.m_ratio*s,o.m_impulse=0,o}return Qe(r,i),r.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,c=e.positions[this.m_indexC].a,h=e.velocities[this.m_indexC].v,u=e.velocities[this.m_indexC].w,d=e.positions[this.m_indexD].a,p=e.velocities[this.m_indexD].v,f=e.velocities[this.m_indexD].w,_=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(o),g=this.m_qC.SetAngle(c),y=this.m_qD.SetAngle(d);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=O.MulRV(g,this.m_localAxisC,r.InitVelocityConstraints_s_u);L.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var b=O.MulRV(g,this.m_lalcC,r.InitVelocityConstraints_s_rC);L.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var x=O.MulRV(_,this.m_lalcA,r.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(v),this.m_JwC=L.CrossVV(b,v),this.m_JwA=L.CrossVV(x,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{v=O.MulRV(y,this.m_localAxisD,r.InitVelocityConstraints_s_u),L.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var T=O.MulRV(y,this.m_lalcD,r.InitVelocityConstraints_s_rD);L.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var C=O.MulRV(m,this.m_lalcB,r.InitVelocityConstraints_s_rB);L.MulSV(this.m_ratio,v,this.m_JvBD),this.m_JwD=this.m_ratio*L.CrossVV(T,v),this.m_JwB=this.m_ratio*L.CrossVV(C,v),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,a.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),u-=this.m_iC*this.m_impulse*this.m_JwC,p.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=l,e.velocities[this.m_indexC].w=u,e.velocities[this.m_indexD].w=f},r.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,c=L.DotVV(this.m_JvAC,L.SubVV(e,s,L.s_t0))+L.DotVV(this.m_JvBD,L.SubVV(r,a,L.s_t0));c+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*n-this.m_JwD*l);var h=-this.m_mass*c;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,r.SelfMulAdd(this.m_mB*h,this.m_JvBD),n+=this.m_iB*h*this.m_JwB,s.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,a.SelfMulSub(this.m_mD*h,this.m_JvBD),l-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=l},r.prototype.SolvePositionConstraints=function(e){var i,n,s,o,a,l,c=e.positions[this.m_indexA].c,h=e.positions[this.m_indexA].a,u=e.positions[this.m_indexB].c,d=e.positions[this.m_indexB].a,p=e.positions[this.m_indexC].c,f=e.positions[this.m_indexC].a,_=e.positions[this.m_indexD].c,m=e.positions[this.m_indexD].a,g=this.m_qA.SetAngle(h),y=this.m_qB.SetAngle(d),v=this.m_qC.SetAngle(f),b=this.m_qD.SetAngle(m),x=this.m_JvAC,T=this.m_JvBD,C=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)x.SetZero(),s=1,a=1,C+=this.m_iA+this.m_iC,i=h-f-this.m_referenceAngleA;else{var S=O.MulRV(v,this.m_localAxisC,r.SolvePositionConstraints_s_u),w=O.MulRV(v,this.m_lalcC,r.SolvePositionConstraints_s_rC),A=O.MulRV(g,this.m_lalcA,r.SolvePositionConstraints_s_rA);x.Copy(S),a=L.CrossVV(w,S),s=L.CrossVV(A,S),C+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*s*s;var E=this.m_lalcC,D=O.MulTRV(v,L.AddVV(A,L.SubVV(c,p,L.s_t0),L.s_t0),L.s_t0);i=L.DotVV(L.SubVV(D,E,L.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)T.SetZero(),o=this.m_ratio,l=this.m_ratio,C+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),n=d-m-this.m_referenceAngleB;else{S=O.MulRV(b,this.m_localAxisD,r.SolvePositionConstraints_s_u);var I=O.MulRV(b,this.m_lalcD,r.SolvePositionConstraints_s_rD),P=O.MulRV(y,this.m_lalcB,r.SolvePositionConstraints_s_rB);L.MulSV(this.m_ratio,S,T),l=this.m_ratio*L.CrossVV(I,S),o=this.m_ratio*L.CrossVV(P,S),C+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*l*l+this.m_iB*o*o;var M=this.m_lalcD,R=O.MulTRV(b,L.AddVV(P,L.SubVV(u,_,L.s_t0),L.s_t0),L.s_t0);n=L.DotVV(L.SubVV(R,M,L.s_t0),this.m_localAxisD)}var B=i+this.m_ratio*n-this.m_constant,N=0;return C>0&&(N=-B/C),c.SelfMulAdd(this.m_mA*N,x),h+=this.m_iA*N*s,u.SelfMulAdd(this.m_mB*N,T),d+=this.m_iB*N*o,p.SelfMulSub(this.m_mC*N,x),f-=this.m_iC*N*a,_.SelfMulSub(this.m_mD*N,T),m-=this.m_iD*N*l,e.positions[this.m_indexA].a=h,e.positions[this.m_indexB].a=d,e.positions[this.m_indexC].a=f,e.positions[this.m_indexD].a=m,!0},r.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.prototype.GetReactionForce=function(t,e){return L.MulSV(t*this.m_impulse,this.m_JvAC,e)},r.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},r.prototype.GetJoint1=function(){return this.m_joint1},r.prototype.GetJoint2=function(){return this.m_joint2},r.prototype.GetRatio=function(){return this.m_ratio},r.prototype.SetRatio=function(t){this.m_ratio=t},r.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,r=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",r),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_u=new L,r.InitVelocityConstraints_s_rA=new L,r.InitVelocityConstraints_s_rB=new L,r.InitVelocityConstraints_s_rC=new L,r.InitVelocityConstraints_s_rD=new L,r.SolvePositionConstraints_s_u=new L,r.SolvePositionConstraints_s_rA=new L,r.SolvePositionConstraints_s_rB=new L,r.SolvePositionConstraints_s_rC=new L,r.SolvePositionConstraints_s_rD=new L,r}(fi),Ci=function(e){function i(){var i=e.call(this,t.b2JointType.e_motorJoint)||this;return i.linearOffset=new L(0,0),i.angularOffset=0,i.maxForce=1,i.maxTorque=1,i.correctionFactor=.3,i}return Qe(i,e),i.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-i},i}(pi),Si=function(t){function i(i){var r=t.call(this,i)||this;return r.m_linearOffset=new L,r.m_angularOffset=0,r.m_linearImpulse=new L,r.m_angularImpulse=0,r.m_maxForce=0,r.m_maxTorque=0,r.m_correctionFactor=.3,r.m_indexA=0,r.m_indexB=0,r.m_rA=new L,r.m_rB=new L,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_linearError=new L,r.m_angularError=0,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_linearMass=new M,r.m_angularMass=0,r.m_qA=new O,r.m_qB=new O,r.m_K=new M,r.m_linearOffset.Copy(e(i.linearOffset,L.ZERO)),r.m_linearImpulse.SetZero(),r.m_maxForce=e(i.maxForce,0),r.m_maxTorque=e(i.maxTorque,0),r.m_correctionFactor=e(i.correctionFactor,.3),r}return Qe(i,t),i.prototype.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t},i.prototype.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t},i.prototype.GetReactionForce=function(t,e){return L.MulSV(t,this.m_linearImpulse,e)},i.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},i.prototype.SetLinearOffset=function(t){L.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},i.prototype.GetLinearOffset=function(){return this.m_linearOffset},i.prototype.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},i.prototype.GetAngularOffset=function(){return this.m_angularOffset},i.prototype.SetMaxForce=function(t){this.m_maxForce=t},i.prototype.GetMaxForce=function(){return this.m_maxForce},i.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},i.prototype.GetMaxTorque=function(){return this.m_maxTorque},i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o),u=O.MulRV(c,L.SubVV(this.m_linearOffset,this.m_localCenterA,L.s_t0),this.m_rA),d=O.MulRV(h,L.NegV(this.m_localCenterB,L.s_t0),this.m_rB),p=this.m_invMassA,f=this.m_invMassB,_=this.m_invIA,m=this.m_invIB,g=this.m_K;if(g.ex.x=p+f+_*u.y*u.y+m*d.y*d.y,g.ex.y=-_*u.x*u.y-m*d.x*d.y,g.ey.x=g.ex.y,g.ey.y=p+f+_*u.x*u.x+m*d.x*d.x,g.GetInverse(this.m_linearMass),this.m_angularMass=_+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),L.SubVV(L.AddVV(s,d,L.s_t0),L.AddVV(e,u,L.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var y=this.m_linearImpulse;r.SelfMulSub(p,y),n-=_*(L.CrossVV(u,y)+this.m_angularImpulse),a.SelfMulAdd(f,y),l+=m*(L.CrossVV(d,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,h=t.step.dt,u=t.step.inv_dt,d=s-r+u*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*d,f=this.m_angularImpulse,_=h*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+p,-_,_),r-=l*(p=this.m_angularImpulse-f),s+=c*p;var m=this.m_rA,y=this.m_rB,v=L.AddVV(L.SubVV(L.AddVV(n,L.CrossSV(s,y,L.s_t0),L.s_t0),L.AddVV(e,L.CrossSV(r,m,L.s_t1),L.s_t1),L.s_t2),L.MulSV(u*this.m_correctionFactor,this.m_linearError,L.s_t3),i.SolveVelocityConstraints_s_Cdot_v2),b=M.MulMV(this.m_linearMass,v,i.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),x=i.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(b),_=h*this.m_maxForce,this.m_linearImpulse.LengthSquared()>_*_&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(_)),L.SubVV(this.m_linearImpulse,x,b),e.SelfMulSub(o,b),r-=l*L.CrossVV(m,b),n.SelfMulAdd(a,b),s+=c*L.CrossVV(y,b),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s},i.prototype.SolvePositionConstraints=function(){return!0},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.SolveVelocityConstraints_s_Cdot_v2=new L,i.SolveVelocityConstraints_s_impulse_v2=new L,i.SolveVelocityConstraints_s_oldImpulse_v2=new L,i}(fi),wi=function(e){function i(){var i=e.call(this,t.b2JointType.e_mouseJoint)||this;return i.target=new L,i.maxForce=0,i.frequencyHz=5,i.dampingRatio=.7,i}return Qe(i,e),i}(pi),Ai=function(t){function i(i){var r=t.call(this,i)||this;return r.m_localAnchorB=new L,r.m_targetA=new L,r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_beta=0,r.m_impulse=new L,r.m_maxForce=0,r.m_gamma=0,r.m_indexA=0,r.m_indexB=0,r.m_rB=new L,r.m_localCenterB=new L,r.m_invMassB=0,r.m_invIB=0,r.m_mass=new M,r.m_C=new L,r.m_qB=new O,r.m_lalcB=new L,r.m_K=new M,r.m_targetA.Copy(e(i.target,L.ZERO)),B.MulTXV(r.m_bodyB.GetTransform(),r.m_targetA,r.m_localAnchorB),r.m_maxForce=e(i.maxForce,0),r.m_impulse.SetZero(),r.m_frequencyHz=e(i.frequencyHz,0),r.m_dampingRatio=e(i.dampingRatio,0),r.m_beta=0,r.m_gamma=0,r}return Qe(i,t),i.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},i.prototype.GetTarget=function(){return this.m_targetA},i.prototype.SetMaxForce=function(t){this.m_maxForce=t},i.prototype.GetMaxForce=function(){return this.m_maxForce},i.prototype.SetFrequency=function(t){this.m_frequencyHz=t},i.prototype.GetFrequency=function(){return this.m_frequencyHz},i.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},i.prototype.GetDampingRatio=function(){return this.m_dampingRatio},i.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_qB.SetAngle(i),a=this.m_bodyB.GetMass(),l=2*s*this.m_frequencyHz,c=2*a*this.m_dampingRatio*l,h=a*l*l,u=t.step.dt;this.m_gamma=u*(c+u*h),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*h*this.m_gamma,L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(o,this.m_lalcB,this.m_rB);var d=this.m_K;d.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,d.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,d.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r.x+=this.m_invMassB*this.m_impulse.x,r.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*L.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,n=L.AddVCrossSV(e,r,this.m_rB,i.SolveVelocityConstraints_s_Cdot),s=M.MulMV(this.m_mass,L.AddVV(n,L.AddVV(this.m_C,L.MulSV(this.m_gamma,this.m_impulse,L.s_t0),L.s_t0),L.s_t0).SelfNeg(),i.SolveVelocityConstraints_s_impulse),o=i.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),L.SubVV(this.m_impulse,o,s),e.SelfMulAdd(this.m_invMassB,s),r+=this.m_invIB*L.CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=r},i.prototype.SolvePositionConstraints=function(){return!0},i.prototype.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return L.MulSV(t,this.m_impulse,e)},i.prototype.GetReactionTorque=function(){return 0},i.prototype.Dump=function(t){t("Mouse joint dumping is not supported.\n")},i.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},i.SolveVelocityConstraints_s_Cdot=new L,i.SolveVelocityConstraints_s_impulse=new L,i.SolveVelocityConstraints_s_oldImpulse=new L,i}(fi),Ei=function(e){function i(){var i=e.call(this,t.b2JointType.e_prismaticJoint)||this;return i.localAnchorA=new L,i.localAnchorB=new L,i.localAxisA=new L(1,0),i.referenceAngle=0,i.enableLimit=!1,i.lowerTranslation=0,i.upperTranslation=0,i.enableMotor=!1,i.maxMotorForce=0,i.motorSpeed=0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(pi),Di=function(i){function r(r){var n=i.call(this,r)||this;return n.m_localAnchorA=new L,n.m_localAnchorB=new L,n.m_localXAxisA=new L,n.m_localYAxisA=new L,n.m_referenceAngle=0,n.m_impulse=new P(0,0,0),n.m_motorImpulse=0,n.m_lowerTranslation=0,n.m_upperTranslation=0,n.m_maxMotorForce=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_enableMotor=!1,n.m_limitState=t.b2LimitState.e_inactiveLimit,n.m_indexA=0,n.m_indexB=0,n.m_localCenterA=new L,n.m_localCenterB=new L,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_axis=new L(0,0),n.m_perp=new L(0,0),n.m_s1=0,n.m_s2=0,n.m_a1=0,n.m_a2=0,n.m_K=new R,n.m_K3=new R,n.m_K2=new M,n.m_motorMass=0,n.m_qA=new O,n.m_qB=new O,n.m_lalcA=new L,n.m_lalcB=new L,n.m_rA=new L,n.m_rB=new L,n.m_localAnchorA.Copy(e(r.localAnchorA,L.ZERO)),n.m_localAnchorB.Copy(e(r.localAnchorB,L.ZERO)),n.m_localXAxisA.Copy(e(r.localAxisA,new L(1,0))).SelfNormalize(),L.CrossOneV(n.m_localXAxisA,n.m_localYAxisA),n.m_referenceAngle=e(r.referenceAngle,0),n.m_lowerTranslation=e(r.lowerTranslation,0),n.m_upperTranslation=e(r.upperTranslation,0),n.m_maxMotorForce=e(r.maxMotorForce,0),n.m_motorSpeed=e(r.motorSpeed,0),n.m_enableLimit=e(r.enableLimit,!1),n.m_enableMotor=e(r.enableMotor,!1),n}return Qe(r,i),r.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,a=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,h=e.velocities[this.m_indexB].v,u=e.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(n),p=this.m_qB.SetAngle(c);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=O.MulRV(d,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=O.MulRV(p,this.m_lalcB,this.m_rB),g=L.AddVV(L.SubVV(l,i,L.s_t0),L.SubVV(m,_,L.s_t1),r.InitVelocityConstraints_s_d),y=this.m_invMassA,v=this.m_invMassB,b=this.m_invIA,x=this.m_invIB;if(O.MulRV(d,this.m_localXAxisA,this.m_axis),this.m_a1=L.CrossVV(L.AddVV(g,_,L.s_t0),this.m_axis),this.m_a2=L.CrossVV(m,this.m_axis),this.m_motorMass=y+v+b*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),O.MulRV(d,this.m_localYAxisA,this.m_perp),this.m_s1=L.CrossVV(L.AddVV(g,_,L.s_t0),this.m_perp),this.m_s2=L.CrossVV(m,this.m_perp),this.m_K.ex.x=y+v+b*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=b*this.m_s1+x*this.m_s2,this.m_K.ex.z=b*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=b+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=b*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=y+v+b*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){var T=L.DotVV(this.m_axis,g);f(this.m_upperTranslation-this.m_lowerTranslation)<2*o?this.m_limitState=t.b2LimitState.e_equalLimits:T<=this.m_lowerTranslation?this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):T>=this.m_upperTranslation?this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var C=L.AddVV(L.MulSV(this.m_impulse.x,this.m_perp,L.s_t0),L.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,L.s_t1),r.InitVelocityConstraints_s_P),S=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,w=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.SelfMulSub(y,C),a-=b*S,h.SelfMulAdd(v,C),u+=x*w}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=a,e.velocities[this.m_indexB].w=u},r.prototype.SolveVelocityConstraints=function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits){var u=L.DotVV(this.m_axis,L.SubVV(s,i,L.s_t0))+this.m_a2*o-this.m_a1*n,d=this.m_motorMass*(this.m_motorSpeed-u),p=this.m_motorImpulse,f=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=g(this.m_motorImpulse+d,-f,f),d=this.m_motorImpulse-p;var y=L.MulSV(d,this.m_axis,r.SolveVelocityConstraints_s_P),v=d*this.m_a1,b=d*this.m_a2;i.SelfMulSub(a,y),n-=c*v,s.SelfMulAdd(l,y),o+=h*b}var x=L.DotVV(this.m_perp,L.SubVV(s,i,L.s_t0))+this.m_s2*o-this.m_s1*n,T=o-n;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit){var C=L.DotVV(this.m_axis,L.SubVV(s,i,L.s_t0))+this.m_a2*o-this.m_a1*n,S=r.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),w=this.m_K.Solve33(-x,-T,-C,r.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(w),this.m_limitState===t.b2LimitState.e_atLowerLimit?this.m_impulse.z=m(this.m_impulse.z,0):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=_(this.m_impulse.z,0));var A=-x-(this.m_impulse.z-S.z)*this.m_K.ez.x,E=-T-(this.m_impulse.z-S.z)*this.m_K.ez.y,D=this.m_K.Solve22(A,E,r.SolveVelocityConstraints_s_f2r);D.x+=S.x,D.y+=S.y,this.m_impulse.x=D.x,this.m_impulse.y=D.y,w.x=this.m_impulse.x-S.x,w.y=this.m_impulse.y-S.y,w.z=this.m_impulse.z-S.z,y=L.AddVV(L.MulSV(w.x,this.m_perp,L.s_t0),L.MulSV(w.z,this.m_axis,L.s_t1),r.SolveVelocityConstraints_s_P),v=w.x*this.m_s1+w.y+w.z*this.m_a1,b=w.x*this.m_s2+w.y+w.z*this.m_a2,i.SelfMulSub(a,y),n-=c*v,s.SelfMulAdd(l,y),o+=h*b}else{var I=this.m_K.Solve22(-x,-T,r.SolveVelocityConstraints_s_df2);this.m_impulse.x+=I.x,this.m_impulse.y+=I.y,y=L.MulSV(I.x,this.m_perp,r.SolveVelocityConstraints_s_P),v=I.x*this.m_s1+I.y,b=I.x*this.m_s2+I.y,i.SelfMulSub(a,y),n-=c*v,s.SelfMulAdd(l,y),o+=h*b}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o},r.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,l=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(s),h=this.m_invMassA,u=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,_=O.MulRV(l,this.m_lalcA,this.m_rA),y=O.MulRV(c,this.m_lalcB,this.m_rB),v=L.SubVV(L.AddVV(n,y,L.s_t0),L.AddVV(e,_,L.s_t1),r.SolvePositionConstraints_s_d),b=O.MulRV(l,this.m_localXAxisA,this.m_axis),x=L.CrossVV(L.AddVV(v,_,L.s_t0),b),T=L.CrossVV(y,b),C=O.MulRV(l,this.m_localYAxisA,this.m_perp),S=L.CrossVV(L.AddVV(v,_,L.s_t0),C),w=L.CrossVV(y,C),A=r.SolvePositionConstraints_s_impulse,E=L.DotVV(C,v),D=s-i-this.m_referenceAngle,I=f(E),P=f(D),M=!1,R=0;if(this.m_enableLimit){var B=L.DotVV(b,v);f(this.m_upperTranslation-this.m_lowerTranslation)<2*o?(R=g(B,-.2,.2),I=m(I,f(B)),M=!0):B<=this.m_lowerTranslation?(R=g(B-this.m_lowerTranslation+o,-.2,0),I=m(I,this.m_lowerTranslation-B),M=!0):B>=this.m_upperTranslation&&(R=g(B-this.m_upperTranslation-o,0,.2),I=m(I,B-this.m_upperTranslation),M=!0)}if(M){var N=h+u+d*S*S+p*w*w,k=d*S+p*w,F=d*S*x+p*w*T;0===(U=d+p)&&(U=1);var V=d*x+p*T,j=h+u+d*x*x+p*T*T,G=this.m_K3;G.ex.SetXYZ(N,k,F),G.ey.SetXYZ(k,U,V),G.ez.SetXYZ(F,V,j),A=G.Solve33(-E,-D,-R,A)}else{var U;N=h+u+d*S*S+p*w*w,k=d*S+p*w,0===(U=d+p)&&(U=1);var Y=this.m_K2;Y.ex.Set(N,k),Y.ey.Set(k,U);var H=Y.Solve(-E,-D,r.SolvePositionConstraints_s_impulse1);A.x=H.x,A.y=H.y,A.z=0}var X=L.AddVV(L.MulSV(A.x,C,L.s_t0),L.MulSV(A.z,b,L.s_t1),r.SolvePositionConstraints_s_P),z=A.x*S+A.y+A.z*x,W=A.x*w+A.y+A.z*T;return e.SelfMulSub(h,X),i-=d*z,n.SelfMulAdd(u,X),s+=p*W,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,I<=o&&P<=a},r.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e},r.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},r.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},r.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,r.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,r.GetJointTranslation_s_pB),i=L.SubVV(e,t,r.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,r.GetJointTranslation_s_axis);return L.DotVV(i,n)},r.prototype.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;L.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=O.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=O.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=L.AddVV(t.m_sweep.c,i,L.s_t0),s=L.AddVV(e.m_sweep.c,r,L.s_t1),o=L.SubVV(s,n,L.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity;return L.DotVV(o,L.CrossSV(h,a,L.s_t0))+L.DotVV(a,L.SubVV(L.AddVCrossSV(c,u,r,L.s_t0),L.AddVCrossSV(l,h,i,L.s_t1),L.s_t0))},r.prototype.IsLimitEnabled=function(){return this.m_enableLimit},r.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},r.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},r.prototype.GetUpperLimit=function(){return this.m_upperTranslation},r.prototype.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},r.prototype.IsMotorEnabled=function(){return this.m_enableMotor},r.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},r.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},r.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},r.prototype.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)},r.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},r.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},r.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_d=new L,r.InitVelocityConstraints_s_P=new L,r.SolveVelocityConstraints_s_P=new L,r.SolveVelocityConstraints_s_f2r=new L,r.SolveVelocityConstraints_s_f1=new P,r.SolveVelocityConstraints_s_df3=new P,r.SolveVelocityConstraints_s_df2=new L,r.SolvePositionConstraints_s_d=new L,r.SolvePositionConstraints_s_impulse=new P,r.SolvePositionConstraints_s_impulse1=new L,r.SolvePositionConstraints_s_P=new L,r.GetJointTranslation_s_pA=new L,r.GetJointTranslation_s_pB=new L,r.GetJointTranslation_s_d=new L,r.GetJointTranslation_s_axis=new L,r}(fi),Li=function(e){function i(){var i=e.call(this,t.b2JointType.e_pulleyJoint)||this;return i.groundAnchorA=new L(-1,1),i.groundAnchorB=new L(1,1),i.localAnchorA=new L(-1,0),i.localAnchorB=new L(1,0),i.lengthA=0,i.lengthB=0,i.ratio=1,i.collideConnected=!0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i,r,n,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(r),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=L.DistanceVV(n,i),this.lengthB=L.DistanceVV(s,r),this.ratio=o},i}(pi),Ii=function(t){function i(i){var r=t.call(this,i)||this;return r.m_groundAnchorA=new L,r.m_groundAnchorB=new L,r.m_lengthA=0,r.m_lengthB=0,r.m_localAnchorA=new L,r.m_localAnchorB=new L,r.m_constant=0,r.m_ratio=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_uA=new L,r.m_uB=new L,r.m_rA=new L,r.m_rB=new L,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_qA=new O,r.m_qB=new O,r.m_lalcA=new L,r.m_lalcB=new L,r.m_groundAnchorA.Copy(e(i.groundAnchorA,new L(-1,1))),r.m_groundAnchorB.Copy(e(i.groundAnchorB,new L(1,0))),r.m_localAnchorA.Copy(e(i.localAnchorA,new L(-1,0))),r.m_localAnchorB.Copy(e(i.localAnchorB,new L(1,0))),r.m_lengthA=e(i.lengthA,0),r.m_lengthB=e(i.lengthB,0),r.m_ratio=e(i.ratio,1),r.m_constant=e(i.lengthA,0)+r.m_ratio*e(i.lengthB,0),r.m_impulse=0,r}return Qe(i,t),i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(r),u=this.m_qB.SetAngle(a);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),O.MulRV(h,this.m_lalcA,this.m_rA),L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(u,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var d=this.m_uA.Length(),p=this.m_uB.Length();d>.08?this.m_uA.SelfMul(1/d):this.m_uA.SetZero(),p>.08?this.m_uB.SelfMul(1/p):this.m_uB.SetZero();var f=L.CrossVV(this.m_rA,this.m_uA),_=L.CrossVV(this.m_rB,this.m_uB),m=this.m_invMassA+this.m_invIA*f*f,g=this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=m+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var y=L.MulSV(-this.m_impulse,this.m_uA,i.InitVelocityConstraints_s_PA),v=L.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,i.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,y),s+=this.m_invIA*L.CrossVV(this.m_rA,y),l.SelfMulAdd(this.m_invMassB,v),c+=this.m_invIB*L.CrossVV(this.m_rB,v)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=c},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=L.AddVCrossSV(e,r,this.m_rA,i.SolveVelocityConstraints_s_vpA),a=L.AddVCrossSV(n,s,this.m_rB,i.SolveVelocityConstraints_s_vpB),l=-L.DotVV(this.m_uA,o)-this.m_ratio*L.DotVV(this.m_uB,a),c=-this.m_mass*l;this.m_impulse+=c;var h=L.MulSV(-c,this.m_uA,i.SolveVelocityConstraints_s_PA),u=L.MulSV(-this.m_ratio*c,this.m_uB,i.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),r+=this.m_invIA*L.CrossVV(this.m_rA,h),n.SelfMulAdd(this.m_invMassB,u),s+=this.m_invIB*L.CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s},i.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,a=this.m_qA.SetAngle(r),l=this.m_qB.SetAngle(s);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=O.MulRV(a,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=O.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_uA.Copy(e).SelfAdd(c).SelfSub(this.m_groundAnchorA),d=this.m_uB.Copy(n).SelfAdd(h).SelfSub(this.m_groundAnchorB),p=u.Length(),_=d.Length();p>.08?u.SelfMul(1/p):u.SetZero(),_>.08?d.SelfMul(1/_):d.SetZero();var m=L.CrossVV(c,u),g=L.CrossVV(h,d),y=this.m_invMassA+this.m_invIA*m*m,v=this.m_invMassB+this.m_invIB*g*g,b=y+this.m_ratio*this.m_ratio*v;b>0&&(b=1/b);var x=this.m_constant-p-this.m_ratio*_,T=f(x),C=-b*x,S=L.MulSV(-C,u,i.SolvePositionConstraints_s_PA),w=L.MulSV(-this.m_ratio*C,d,i.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,S),r+=this.m_invIA*L.CrossVV(c,S),n.SelfMulAdd(this.m_invMassB,w),s+=this.m_invIB*L.CrossVV(h,w),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,T<o},i.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e},i.prototype.GetReactionTorque=function(){return 0},i.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},i.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},i.prototype.GetLengthA=function(){return this.m_lengthA},i.prototype.GetLengthB=function(){return this.m_lengthB},i.prototype.GetRatio=function(){return this.m_ratio},i.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return L.DistanceVV(t,e)},i.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return L.DistanceVV(t,e)},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},i.InitVelocityConstraints_s_PA=new L,i.InitVelocityConstraints_s_PB=new L,i.SolveVelocityConstraints_s_vpA=new L,i.SolveVelocityConstraints_s_vpB=new L,i.SolveVelocityConstraints_s_PA=new L,i.SolveVelocityConstraints_s_PB=new L,i.SolvePositionConstraints_s_PA=new L,i.SolvePositionConstraints_s_PB=new L,i.GetCurrentLengthA_s_p=new L,i.GetCurrentLengthB_s_p=new L,i}(fi),Pi=function(e){function i(){var i=e.call(this,t.b2JointType.e_revoluteJoint)||this;return i.localAnchorA=new L(0,0),i.localAnchorB=new L(0,0),i.referenceAngle=0,i.enableLimit=!1,i.lowerAngle=0,i.upperAngle=0,i.enableMotor=!1,i.motorSpeed=0,i.maxMotorTorque=0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(pi),Mi=function(i){function r(r){var n=i.call(this,r)||this;return n.m_localAnchorA=new L,n.m_localAnchorB=new L,n.m_impulse=new P,n.m_motorImpulse=0,n.m_enableMotor=!1,n.m_maxMotorTorque=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_referenceAngle=0,n.m_lowerAngle=0,n.m_upperAngle=0,n.m_indexA=0,n.m_indexB=0,n.m_rA=new L,n.m_rB=new L,n.m_localCenterA=new L,n.m_localCenterB=new L,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=new R,n.m_motorMass=0,n.m_limitState=t.b2LimitState.e_inactiveLimit,n.m_qA=new O,n.m_qB=new O,n.m_lalcA=new L,n.m_lalcB=new L,n.m_K=new M,n.m_localAnchorA.Copy(e(r.localAnchorA,L.ZERO)),n.m_localAnchorB.Copy(e(r.localAnchorB,L.ZERO)),n.m_referenceAngle=e(r.referenceAngle,0),n.m_impulse.SetZero(),n.m_motorImpulse=0,n.m_lowerAngle=e(r.lowerAngle,0),n.m_upperAngle=e(r.upperAngle,0),n.m_maxMotorTorque=e(r.maxMotorTorque,0),n.m_motorSpeed=e(r.motorSpeed,0),n.m_enableLimit=e(r.enableLimit,!1),n.m_enableMotor=e(r.enableMotor,!1),n.m_limitState=t.b2LimitState.e_inactiveLimit,n}return Qe(r,i),r.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(o);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),O.MulRV(h,this.m_lalcA,this.m_rA),L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(u,this.m_lalcB,this.m_rB);var d=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,m=this.m_invIB,g=_+m===0;if(this.m_mass.ex.x=d+p+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*m,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*m,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*m,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=d+p+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*m,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*m,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+m,this.m_motorMass=_+m,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!g||(this.m_motorImpulse=0),this.m_enableLimit&&!g){var y=o-i-this.m_referenceAngle;f(this.m_upperAngle-this.m_lowerAngle)<2*a?this.m_limitState=t.b2LimitState.e_equalLimits:y<=this.m_lowerAngle?(this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):y>=this.m_upperAngle?(this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var v=r.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);n.SelfMulSub(d,v),s-=_*(L.CrossVV(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),l.SelfMulAdd(p,v),c+=m*(L.CrossVV(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c},r.prototype.SolveVelocityConstraints=function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,l=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,u=c+h===0;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits&&!u){var d=o-n-this.m_motorSpeed,p=-this.m_motorMass*d,f=this.m_motorImpulse,_=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+p,-_,_),n-=c*(p=this.m_motorImpulse-f),o+=h*p}if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!u){var m=L.SubVV(L.AddVCrossSV(s,o,this.m_rB,L.s_t0),L.AddVCrossSV(i,n,this.m_rA,L.s_t1),r.SolveVelocityConstraints_s_Cdot1),y=o-n,v=this.m_mass.Solve33(m.x,m.y,y,r.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(v);else if(this.m_limitState===t.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+v.z<0){var b=-m.x+this.m_impulse.z*this.m_mass.ez.x,x=-m.y+this.m_impulse.z*this.m_mass.ez.y,T=this.m_mass.Solve22(b,x,r.SolveVelocityConstraints_s_reduced_v2);v.x=T.x,v.y=T.y,v.z=-this.m_impulse.z,this.m_impulse.x+=T.x,this.m_impulse.y+=T.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);else this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z+v.z>0?(b=-m.x+this.m_impulse.z*this.m_mass.ez.x,x=-m.y+this.m_impulse.z*this.m_mass.ez.y,T=this.m_mass.Solve22(b,x,r.SolveVelocityConstraints_s_reduced_v2),v.x=T.x,v.y=T.y,v.z=-this.m_impulse.z,this.m_impulse.x+=T.x,this.m_impulse.y+=T.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(v));var C=r.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(a,C),n-=c*(L.CrossVV(this.m_rA,C)+v.z),s.SelfMulAdd(l,C),o+=h*(L.CrossVV(this.m_rB,C)+v.z)}else{var S=L.SubVV(L.AddVCrossSV(s,o,this.m_rB,L.s_t0),L.AddVCrossSV(i,n,this.m_rA,L.s_t1),r.SolveVelocityConstraints_s_Cdot_v2),w=this.m_mass.Solve22(-S.x,-S.y,r.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,i.SelfMulSub(a,w),n-=c*L.CrossVV(this.m_rA,w),s.SelfMulAdd(l,w),o+=h*L.CrossVV(this.m_rB,w)}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o},r.prototype.SolvePositionConstraints=function(e){var i,n=e.positions[this.m_indexA].c,s=e.positions[this.m_indexA].a,l=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,h=this.m_qA.SetAngle(s),u=this.m_qB.SetAngle(c),d=0,p=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!p){var _=c-s-this.m_referenceAngle,m=0;if(this.m_limitState===t.b2LimitState.e_equalLimits){var y=g(_-this.m_lowerAngle,-.13962634015955555,.13962634015955555);m=-this.m_motorMass*y,d=f(y)}else this.m_limitState===t.b2LimitState.e_atLowerLimit?(d=-(y=_-this.m_lowerAngle),y=g(y+a,-.13962634015955555,0),m=-this.m_motorMass*y):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(d=y=_-this.m_upperAngle,y=g(y-a,0,.13962634015955555),m=-this.m_motorMass*y);s-=this.m_invIA*m,c+=this.m_invIB*m}h.SetAngle(s),u.SetAngle(c),L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=O.MulRV(h,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var b=O.MulRV(u,this.m_lalcB,this.m_rB),x=L.SubVV(L.AddVV(l,b,L.s_t0),L.AddVV(n,v,L.s_t1),r.SolvePositionConstraints_s_C_v2);i=x.Length();var T=this.m_invMassA,C=this.m_invMassB,S=this.m_invIA,w=this.m_invIB,A=this.m_K;A.ex.x=T+C+S*v.y*v.y+w*b.y*b.y,A.ex.y=-S*v.x*v.y-w*b.x*b.y,A.ey.x=A.ex.y,A.ey.y=T+C+S*v.x*v.x+w*b.x*b.x;var E=A.Solve(x.x,x.y,r.SolvePositionConstraints_s_impulse).SelfNeg();return n.SelfMulSub(T,E),s-=S*L.CrossVV(v,E),l.SelfMulAdd(C,E),c+=w*L.CrossVV(b,E),e.positions[this.m_indexA].a=s,e.positions[this.m_indexB].a=c,i<=o&&d<=a},r.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},r.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},r.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},r.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},r.prototype.IsMotorEnabled=function(){return this.m_enableMotor},r.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},r.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},r.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},r.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},r.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},r.prototype.IsLimitEnabled=function(){return this.m_enableLimit},r.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},r.prototype.GetLowerLimit=function(){return this.m_lowerAngle},r.prototype.GetUpperLimit=function(){return this.m_upperAngle},r.prototype.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},r.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},r.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_P=new L,r.SolveVelocityConstraints_s_P=new L,r.SolveVelocityConstraints_s_Cdot_v2=new L,r.SolveVelocityConstraints_s_Cdot1=new L,r.SolveVelocityConstraints_s_impulse_v3=new P,r.SolveVelocityConstraints_s_reduced_v2=new L,r.SolveVelocityConstraints_s_impulse_v2=new L,r.SolvePositionConstraints_s_C_v2=new L,r.SolvePositionConstraints_s_impulse=new L,r}(fi),Ri=function(e){function i(){var i=e.call(this,t.b2JointType.e_ropeJoint)||this;return i.localAnchorA=new L(-1,0),i.localAnchorB=new L(1,0),i.maxLength=0,i}return Qe(i,e),i}(pi),Oi=function(i){function r(r){var n=i.call(this,r)||this;return n.m_localAnchorA=new L,n.m_localAnchorB=new L,n.m_maxLength=0,n.m_length=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_u=new L,n.m_rA=new L,n.m_rB=new L,n.m_localCenterA=new L,n.m_localCenterB=new L,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_state=t.b2LimitState.e_inactiveLimit,n.m_qA=new O,n.m_qB=new O,n.m_lalcA=new L,n.m_lalcB=new L,n.m_localAnchorA.Copy(e(r.localAnchorA,new L(-1,0))),n.m_localAnchorB.Copy(e(r.localAnchorB,new L(1,0))),n.m_maxLength=e(r.maxLength,0),n}return Qe(r,i),r.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,a=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,h=e.velocities[this.m_indexB].v,u=e.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(n),p=this.m_qB.SetAngle(c);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),O.MulRV(d,this.m_lalcA,this.m_rA),L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(p,this.m_lalcB,this.m_rB),this.m_u.Copy(l).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var f=this.m_length-this.m_maxLength;if(this.m_state=f>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>o))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var _=L.CrossVV(this.m_rA,this.m_u),m=L.CrossVV(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==g?1/g:0,e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var y=L.MulSV(this.m_impulse,this.m_u,r.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,y),a-=this.m_invIA*L.CrossVV(this.m_rA,y),h.SelfMulAdd(this.m_invMassB,y),u+=this.m_invIB*L.CrossVV(this.m_rB,y)}else this.m_impulse=0;e.velocities[this.m_indexA].w=a,e.velocities[this.m_indexB].w=u},r.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=L.AddVCrossSV(e,i,this.m_rA,r.SolveVelocityConstraints_s_vpA),a=L.AddVCrossSV(n,s,this.m_rB,r.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,c=L.DotVV(this.m_u,L.SubVV(a,o,L.s_t0));l<0&&(c+=t.step.inv_dt*l);var h=-this.m_mass*c,u=this.m_impulse;this.m_impulse=_(0,this.m_impulse+h),h=this.m_impulse-u;var d=L.MulSV(h,this.m_u,r.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*L.CrossVV(this.m_rA,d),n.SelfMulAdd(this.m_invMassB,d),s+=this.m_invIB*L.CrossVV(this.m_rB,d),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},r.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(s);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=O.MulRV(a,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=O.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_u.Copy(n).SelfAdd(h).SelfSub(e).SelfSub(c),d=u.Normalize(),p=d-this.m_maxLength;p=g(p,0,.2);var f=-this.m_mass*p,_=L.MulSV(f,u,r.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*L.CrossVV(c,_),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*L.CrossVV(h,_),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,d-this.m_maxLength<o},r.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.prototype.GetReactionForce=function(t,e){return L.MulSV(t*this.m_impulse,this.m_u,e)},r.prototype.GetReactionTorque=function(){return 0},r.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},r.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},r.prototype.SetMaxLength=function(t){this.m_maxLength=t},r.prototype.GetMaxLength=function(){return this.m_maxLength},r.prototype.GetLimitState=function(){return this.m_state},r.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},r.InitVelocityConstraints_s_P=new L,r.SolveVelocityConstraints_s_vpA=new L,r.SolveVelocityConstraints_s_vpB=new L,r.SolveVelocityConstraints_s_P=new L,r.SolvePositionConstraints_s_P=new L,r}(fi),Bi=function(e){function i(){var i=e.call(this,t.b2JointType.e_weldJoint)||this;return i.localAnchorA=new L,i.localAnchorB=new L,i.referenceAngle=0,i.frequencyHz=0,i.dampingRatio=0,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(pi),Ni=function(t){function i(i){var r=t.call(this,i)||this;return r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_bias=0,r.m_localAnchorA=new L,r.m_localAnchorB=new L,r.m_referenceAngle=0,r.m_gamma=0,r.m_impulse=new P(0,0,0),r.m_indexA=0,r.m_indexB=0,r.m_rA=new L,r.m_rB=new L,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=new R,r.m_qA=new O,r.m_qB=new O,r.m_lalcA=new L,r.m_lalcB=new L,r.m_K=new R,r.m_frequencyHz=e(i.frequencyHz,0),r.m_dampingRatio=e(i.dampingRatio,0),r.m_localAnchorA.Copy(e(i.localAnchorA,L.ZERO)),r.m_localAnchorB.Copy(e(i.localAnchorB,L.ZERO)),r.m_referenceAngle=e(i.referenceAngle,0),r.m_impulse.SetZero(),r}return Qe(i,t),i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(e),h=this.m_qB.SetAngle(o);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),O.MulRV(c,this.m_lalcA,this.m_rA),L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),O.MulRV(h,this.m_lalcB,this.m_rB);var u=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,f=this.m_invIB,_=this.m_K;if(_.ex.x=u+d+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*f,_.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*f,_.ez.x=-this.m_rA.y*p-this.m_rB.y*f,_.ex.y=_.ey.x,_.ey.y=u+d+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*f,_.ez.y=this.m_rA.x*p+this.m_rB.x*f,_.ex.z=_.ez.x,_.ey.z=_.ez.y,_.ez.z=p+f,this.m_frequencyHz>0){_.GetInverse22(this.m_mass);var m=p+f,g=m>0?1/m:0,y=o-e-this.m_referenceAngle,v=2*s*this.m_frequencyHz,b=2*g*this.m_dampingRatio*v,x=g*v*v,T=t.step.dt;this.m_gamma=T*(b+T*x),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*T*x*this.m_gamma,m+=this.m_gamma,this.m_mass.ez.z=0!==m?1/m:0}else _.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(u,C),n-=p*(L.CrossVV(this.m_rA,C)+this.m_impulse.z),a.SelfMulAdd(d,C),l+=f*(L.CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l},i.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;if(this.m_frequencyHz>0){var h=s-r,u=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,r-=l*u,s+=c*u;var d=L.SubVV(L.AddVCrossSV(n,s,this.m_rB,L.s_t0),L.AddVCrossSV(e,r,this.m_rA,L.s_t1),i.SolveVelocityConstraints_s_Cdot1),p=R.MulM33XY(this.m_mass,d.x,d.y,i.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var f=p;e.SelfMulSub(o,f),r-=l*L.CrossVV(this.m_rA,f),n.SelfMulAdd(a,f),s+=c*L.CrossVV(this.m_rB,f)}else{d=L.SubVV(L.AddVCrossSV(n,s,this.m_rB,L.s_t0),L.AddVCrossSV(e,r,this.m_rA,L.s_t1),i.SolveVelocityConstraints_s_Cdot1),h=s-r;var _=R.MulM33XYZ(this.m_mass,d.x,d.y,h,i.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(_),f=i.SolveVelocityConstraints_s_P.Set(_.x,_.y),e.SelfMulSub(o,f),r-=l*(L.CrossVV(this.m_rA,f)+_.z),n.SelfMulAdd(a,f),s+=c*(L.CrossVV(this.m_rB,f)+_.z)}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s},i.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,l=this.m_qA.SetAngle(r),c=this.m_qB.SetAngle(s),h=this.m_invMassA,u=this.m_invMassB,d=this.m_invIA,p=this.m_invIB;L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=O.MulRV(l,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m,g,y=O.MulRV(c,this.m_lalcB,this.m_rB),v=this.m_K;if(v.ex.x=h+u+_.y*_.y*d+y.y*y.y*p,v.ey.x=-_.y*_.x*d-y.y*y.x*p,v.ez.x=-_.y*d-y.y*p,v.ex.y=v.ey.x,v.ey.y=h+u+_.x*_.x*d+y.x*y.x*p,v.ez.y=_.x*d+y.x*p,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=d+p,this.m_frequencyHz>0){m=(x=L.SubVV(L.AddVV(n,y,L.s_t0),L.AddVV(e,_,L.s_t1),i.SolvePositionConstraints_s_C1)).Length(),g=0;var b=v.Solve22(x.x,x.y,i.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(h,b),r-=d*L.CrossVV(_,b),n.SelfMulAdd(u,b),s+=p*L.CrossVV(y,b)}else{var x=L.SubVV(L.AddVV(n,y,L.s_t0),L.AddVV(e,_,L.s_t1),i.SolvePositionConstraints_s_C1),T=s-r-this.m_referenceAngle;m=x.Length(),g=f(T);var C=v.Solve33(x.x,x.y,T,i.SolvePositionConstraints_s_impulse).SelfNeg();b=i.SolvePositionConstraints_s_P.Set(C.x,C.y),e.SelfMulSub(h,b),r-=d*(L.CrossVV(this.m_rA,b)+C.z),n.SelfMulAdd(u,b),s+=p*(L.CrossVV(this.m_rB,b)+C.z)}return t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,m<=o&&g<=a},i.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},i.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},i.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},i.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},i.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},i.prototype.SetFrequency=function(t){this.m_frequencyHz=t},i.prototype.GetFrequency=function(){return this.m_frequencyHz},i.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},i.prototype.GetDampingRatio=function(){return this.m_dampingRatio},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.InitVelocityConstraints_s_P=new L,i.SolveVelocityConstraints_s_Cdot1=new L,i.SolveVelocityConstraints_s_impulse1=new L,i.SolveVelocityConstraints_s_impulse=new P,i.SolveVelocityConstraints_s_P=new L,i.SolvePositionConstraints_s_C1=new L,i.SolvePositionConstraints_s_P=new L,i.SolvePositionConstraints_s_impulse=new P,i}(fi),ki=function(e){function i(){var i=e.call(this,t.b2JointType.e_wheelJoint)||this;return i.localAnchorA=new L(0,0),i.localAnchorB=new L(0,0),i.localAxisA=new L(1,0),i.enableMotor=!1,i.maxMotorTorque=0,i.motorSpeed=0,i.frequencyHz=2,i.dampingRatio=.7,i}return Qe(i,e),i.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA)},i}(pi),Fi=function(t){function i(i){var r=t.call(this,i)||this;return r.m_frequencyHz=0,r.m_dampingRatio=0,r.m_localAnchorA=new L,r.m_localAnchorB=new L,r.m_localXAxisA=new L,r.m_localYAxisA=new L,r.m_impulse=0,r.m_motorImpulse=0,r.m_springImpulse=0,r.m_maxMotorTorque=0,r.m_motorSpeed=0,r.m_enableMotor=!1,r.m_indexA=0,r.m_indexB=0,r.m_localCenterA=new L,r.m_localCenterB=new L,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_ax=new L,r.m_ay=new L,r.m_sAx=0,r.m_sBx=0,r.m_sAy=0,r.m_sBy=0,r.m_mass=0,r.m_motorMass=0,r.m_springMass=0,r.m_bias=0,r.m_gamma=0,r.m_qA=new O,r.m_qB=new O,r.m_lalcA=new L,r.m_lalcB=new L,r.m_rA=new L,r.m_rB=new L,r.m_frequencyHz=e(i.frequencyHz,2),r.m_dampingRatio=e(i.dampingRatio,.7),r.m_localAnchorA.Copy(e(i.localAnchorA,L.ZERO)),r.m_localAnchorB.Copy(e(i.localAnchorB,L.ZERO)),r.m_localXAxisA.Copy(e(i.localAxisA,L.UNITX)),L.CrossOneV(r.m_localXAxisA,r.m_localYAxisA),r.m_maxMotorTorque=e(i.maxMotorTorque,0),r.m_motorSpeed=e(i.motorSpeed,0),r.m_enableMotor=e(i.enableMotor,!1),r.m_ax.SetZero(),r.m_ay.SetZero(),r}return Qe(i,t),i.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},i.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},i.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},i.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},i.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},i.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},i.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,a=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,c=t.velocities[this.m_indexA].v,h=t.velocities[this.m_indexA].w,u=t.positions[this.m_indexB].c,d=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v,f=t.velocities[this.m_indexB].w,_=this.m_qA.SetAngle(l),m=this.m_qB.SetAngle(d);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var g=O.MulRV(_,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=O.MulRV(m,this.m_lalcB,this.m_rB),v=L.SubVV(L.AddVV(u,y,L.s_t0),L.AddVV(a,g,L.s_t1),i.InitVelocityConstraints_s_d);if(O.MulRV(_,this.m_localYAxisA,this.m_ay),this.m_sAy=L.CrossVV(L.AddVV(v,g,L.s_t0),this.m_ay),this.m_sBy=L.CrossVV(y,this.m_ay),this.m_mass=e+r+n*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){O.MulRV(_,this.m_localXAxisA,this.m_ax),this.m_sAx=L.CrossVV(L.AddVV(v,g,L.s_t0),this.m_ax),this.m_sBx=L.CrossVV(y,this.m_ax);var b=e+r+n*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(b>0){this.m_springMass=1/b;var x=L.DotVV(v,this.m_ax),T=2*s*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*T,S=this.m_springMass*T*T,w=t.step.dt;this.m_gamma=w*(C+w*S),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=x*w*S*this.m_gamma,this.m_springMass=b+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var A=L.AddVV(L.MulSV(this.m_impulse,this.m_ay,L.s_t0),L.MulSV(this.m_springImpulse,this.m_ax,L.s_t1),i.InitVelocityConstraints_s_P),E=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,D=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.SelfMulSub(this.m_invMassA,A),h-=this.m_invIA*E,p.SelfMulAdd(this.m_invMassB,A),f+=this.m_invIB*D}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=h,t.velocities[this.m_indexB].w=f},i.prototype.SolveVelocityConstraints=function(t){var e=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,h=L.DotVV(this.m_ax,L.SubVV(l,o,L.s_t0))+this.m_sBx*c-this.m_sAx*a,u=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var d=L.MulSV(u,this.m_ax,i.SolveVelocityConstraints_s_P),p=u*this.m_sAx,f=u*this.m_sBx;o.SelfMulSub(e,d),a-=n*p,l.SelfMulAdd(r,d),h=(c+=s*f)-a-this.m_motorSpeed,u=-this.m_motorMass*h;var _=this.m_motorImpulse,m=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+u,-m,m),a-=n*(u=this.m_motorImpulse-_),c+=s*u,h=L.DotVV(this.m_ay,L.SubVV(l,o,L.s_t0))+this.m_sBy*c-this.m_sAy*a,u=-this.m_mass*h,this.m_impulse+=u,d=L.MulSV(u,this.m_ay,i.SolveVelocityConstraints_s_P),p=u*this.m_sAy,f=u*this.m_sBy,o.SelfMulSub(e,d),a-=n*p,l.SelfMulAdd(r,d),c+=s*f,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=c},i.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,a=this.m_qA.SetAngle(r),l=this.m_qB.SetAngle(s);L.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=O.MulRV(a,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h,u=O.MulRV(l,this.m_lalcB,this.m_rB),d=L.AddVV(L.SubVV(n,e,L.s_t0),L.SubVV(u,c,L.s_t1),i.SolvePositionConstraints_s_d),p=O.MulRV(a,this.m_localYAxisA,this.m_ay),_=L.CrossVV(L.AddVV(d,c,L.s_t0),p),m=L.CrossVV(u,p),g=L.DotVV(d,this.m_ay),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;h=0!==y?-g/y:0;var v=L.MulSV(h,p,i.SolvePositionConstraints_s_P),b=h*_,x=h*m;return e.SelfMulSub(this.m_invMassA,v),r-=this.m_invIA*b,n.SelfMulAdd(this.m_invMassB,v),s+=this.m_invIB*x,t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,f(g)<=o},i.prototype.GetDefinition=function(t){return t},i.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},i.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},i.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},i.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},i.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},i.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},i.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},i.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle()},i.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},i.prototype.GetPrismaticJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new L),r=e.GetWorldPoint(this.m_localAnchorB,new L),n=L.SubVV(r,i,new L),s=t.GetWorldVector(this.m_localXAxisA,new L);return L.DotVV(n,s)},i.prototype.GetPrismaticJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;L.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=O.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);L.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=O.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=L.AddVV(t.m_sweep.c,i,L.s_t0),s=L.AddVV(e.m_sweep.c,r,L.s_t1),o=L.SubVV(s,n,L.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new L),l=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity;return L.DotVV(o,L.CrossSV(h,a,L.s_t0))+L.DotVV(a,L.SubVV(L.AddVCrossSV(c,u,r,L.s_t0),L.AddVCrossSV(l,h,i,L.s_t1),L.s_t0))},i.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},i.prototype.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},i.prototype.IsMotorEnabled=function(){return this.m_enableMotor},i.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},i.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},i.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},i.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},i.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.InitVelocityConstraints_s_d=new L,i.InitVelocityConstraints_s_P=new L,i.SolveVelocityConstraints_s_P=new L,i.SolvePositionConstraints_s_d=new L,i.SolvePositionConstraints_s_P=new L,i}(fi);function Vi(t,e){return T(t*e)}function ji(t,e){return t>e?t:e}var Gi,Ui=function(t){this.prev=null,this.next=null,this.contact=t},Yi=function(){function t(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new gt,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new gt,this.m_nodeA=new Ui(this),this.m_nodeB=new Ui(this)}return t.prototype.GetManifold=function(){return this.m_manifold},t.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),r.m_radius,i.GetTransform(),n.m_radius)},t.prototype.IsTouching=function(){return this.m_touchingFlag},t.prototype.SetEnabled=function(t){this.m_enabledFlag=t},t.prototype.IsEnabled=function(){return this.m_enabledFlag},t.prototype.GetNext=function(){return this.m_next},t.prototype.GetFixtureA=function(){return this.m_fixtureA},t.prototype.GetChildIndexA=function(){return this.m_indexA},t.prototype.GetFixtureB=function(){return this.m_fixtureB},t.prototype.GetChildIndexB=function(){return this.m_indexB},t.prototype.FlagForFiltering=function(){this.m_filterFlag=!0},t.prototype.SetFriction=function(t){this.m_friction=t},t.prototype.GetFriction=function(){return this.m_friction},t.prototype.ResetFriction=function(){this.m_friction=Vi(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},t.prototype.SetRestitution=function(t){this.m_restitution=t},t.prototype.GetRestitution=function(){return this.m_restitution},t.prototype.ResetRestitution=function(){this.m_restitution=ji(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.Reset=function(t,e,i,r){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=Vi(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=ji(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},t.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,r=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),o=n||s,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),c=a.GetTransform(),h=l.GetTransform();if(o){var u=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape();i=Dt(u,this.m_indexA,d,this.m_indexB,c,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,c,h),i=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var f=this.m_manifold.points[p];f.normalImpulse=0,f.tangentImpulse=0;for(var _=f.id,m=0;m<this.m_oldManifold.pointCount;++m){var g=this.m_oldManifold.points[m];if(g.id.key===_.key){f.normalImpulse=g.normalImpulse,f.tangentImpulse=g.tangentImpulse;break}}}i!==r&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!r&&i&&t&&t.BeginContact(this),r&&!i&&t&&t.EndContact(this),!o&&i&&t&&t.PreSolve(this,this.m_oldManifold)},t.prototype.ComputeTOI=function(e,i){var r=t.ComputeTOI_s_input;r.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),r.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),r.sweepA.Copy(e),r.sweepB.Copy(i),r.tMax=o;var n=t.ComputeTOI_s_output;return ie(n,r),n.t},t.ComputeTOI_s_input=new Yt,t.ComputeTOI_s_output=new Xt,t}(),Hi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,e,i){se(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},e}(Yi),Xi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,e,i){Re(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},e}(Yi),zi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,e,i){ce(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},e}(Yi),Wi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,e,i){Ue(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},e}(Yi),Zi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,e,i){We(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},e}(Yi),Ji=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,i,r){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),o=n,a=e.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),Ue(t,a,i,s,r)},e.Evaluate_s_edge=new ii,e}(Yi),qi=function(t){function e(){return t.call(this)||this}return Qe(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Reset=function(e,i,r,n){t.prototype.Reset.call(this,e,i,r,n)},e.prototype.Evaluate=function(t,i,r){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),o=n,a=e.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),We(t,a,i,s,r)},e.Evaluate_s_edge=new ii,e}(Yi),Ki=function(){this.createFcn=null,this.destroyFcn=null,this.primary=!1},Qi=function(){function e(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}return e.prototype.AddType=function(t,e,i,r){var n=this,s=d(256,(function(){return t(n.m_allocator)}));function o(e){return s.pop()||t(e)}function a(t){s.push(t)}this.m_registers[i][r].createFcn=o,this.m_registers[i][r].destroyFcn=a,this.m_registers[i][r].primary=!0,i!==r&&(this.m_registers[r][i].createFcn=o,this.m_registers[r][i].destroyFcn=a,this.m_registers[r][i].primary=!1)},e.prototype.InitializeRegisters=function(){this.m_registers=[];for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(var i=0;i<t.b2ShapeType.e_shapeTypeCount;i++)this.m_registers[e][i]=new Ki}this.AddType(Hi.Create,Hi.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(zi.Create,zi.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType(Xi.Create,Xi.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(Wi.Create,Wi.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(Zi.Create,Zi.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(Ji.Create,Ji.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(qi.Create,qi.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)},e.prototype.Create=function(t,e,i,r){var n=t.GetType(),s=i.GetType(),o=this.m_registers[n][s];if(o.createFcn){var a=o.createFcn(this.m_allocator);return o.primary?a.Reset(t,e,i,r):a.Reset(i,r,t,e),a}return null},e.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var r=e.GetType(),n=i.GetType(),s=this.m_registers[r][n];s.destroyFcn&&s.destroyFcn(t,this.m_allocator)},e}(),$i=function(){function t(){}return t.prototype.SayGoodbyeJoint=function(){},t.prototype.SayGoodbyeFixture=function(){},t.prototype.SayGoodbyeParticleGroup=function(){},t.prototype.SayGoodbyeParticle=function(){},t}(),tr=function(){function e(){}return e.prototype.ShouldCollide=function(e,i){var r=e.GetBody(),n=i.GetBody();if(n.GetType()===t.b2BodyType.b2_staticBody&&r.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!n.ShouldCollideConnected(r))return!1;var s=e.GetFilterData(),o=i.GetFilterData();return s.groupIndex===o.groupIndex&&0!==s.groupIndex?s.groupIndex>0:!!(s.maskBits&o.categoryBits)&&!!(s.categoryBits&o.maskBits)},e.prototype.ShouldCollideFixtureParticle=function(){return!0},e.prototype.ShouldCollideParticleParticle=function(){return!0},e.b2_defaultFilter=new e,e}(),er=function(){this.normalImpulses=p(2),this.tangentImpulses=p(2),this.count=0},ir=function(){function t(){}return t.prototype.BeginContact=function(){},t.prototype.EndContact=function(){},t.prototype.BeginContactFixtureParticle=function(){},t.prototype.EndContactFixtureParticle=function(){},t.prototype.BeginContactParticleParticle=function(){},t.prototype.EndContactParticleParticle=function(){},t.prototype.PreSolve=function(){},t.prototype.PostSolve=function(){},t.b2_defaultListener=new t,t}(),rr=function(){function t(){}return t.prototype.ReportFixture=function(){return!0},t.prototype.ReportParticle=function(){return!1},t.prototype.ShouldQueryParticleSystem=function(){return!0},t}(),nr=function(){function t(){}return t.prototype.ReportFixture=function(t,e,i,r){return r},t.prototype.ReportParticle=function(){return 0},t.prototype.ShouldQueryParticleSystem=function(){return!0},t}(),sr=function(){function e(){this.m_broadPhase=new Rt,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=tr.b2_defaultFilter,this.m_contactListener=ir.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new Qi(this.m_allocator)}return e.prototype.AddPair=function(t,e){var i=t.fixture,r=e.fixture,n=t.childIndex,s=e.childIndex,o=i.GetBody(),a=r.GetBody();if(o!==a){for(var l=a.GetContactList();l;){if(l.other===o){var c=l.contact.GetFixtureA(),h=l.contact.GetFixtureB(),u=l.contact.GetChildIndexA(),d=l.contact.GetChildIndexB();if(c===i&&h===r&&u===n&&d===s)return;if(c===r&&h===i&&u===s&&d===n)return}l=l.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,r)){var p=this.m_contactFactory.Create(i,n,r,s);null!==p&&(i=p.GetFixtureA(),r=p.GetFixtureB(),n=p.GetChildIndexA(),s=p.GetChildIndexB(),o=i.m_body,a=r.m_body,p.m_prev=null,p.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=p),this.m_contactList=p,p.m_nodeA.contact=p,p.m_nodeA.other=a,p.m_nodeA.prev=null,p.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=p.m_nodeA),o.m_contactList=p.m_nodeA,p.m_nodeB.contact=p,p.m_nodeB.other=o,p.m_nodeB.prev=null,p.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=p.m_nodeB),a.m_contactList=p.m_nodeB,i.IsSensor()||r.IsSensor()||(o.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}},e.prototype.FindNewContacts=function(){var t=this;this.m_broadPhase.UpdatePairs((function(e,i){t.AddPair(e,i)}))},e.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},e.prototype.Collide=function(){for(var e=this.m_contactList;e;){var i=e.GetFixtureA(),r=e.GetFixtureB(),n=e.GetChildIndexA(),s=e.GetChildIndexB(),o=i.GetBody(),a=r.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,r)){e=(h=e).m_next,this.Destroy(h);continue}e.m_filterFlag=!1}var l=o.IsAwake()&&o.m_type!==t.b2BodyType.b2_staticBody,c=a.IsAwake()&&a.m_type!==t.b2BodyType.b2_staticBody;if(l||c){var h,u=i.m_proxies[n].treeNode,d=r.m_proxies[s].treeNode;Ct(u.aabb,d.aabb)?(e.Update(this.m_contactListener),e=e.m_next):(e=(h=e).m_next,this.Destroy(h))}else e=e.m_next}},e}(),or=function(){function t(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return t.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t}(),ar=function(){function t(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return t.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this},t}(),lr=function(){function t(){this.c=new L,this.a=0}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t}(),cr=function(){function t(){this.v=new L,this.w=0}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t}(),hr=function(){this.step=new ar},ur=function(){function t(){this.rA=new L,this.rB=new L,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t}(),dr=function(){function t(){this.points=ur.MakeArray(2),this.normal=new L,this.tangent=new L,this.normalMass=new M,this.K=new M,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return t.MakeArray=function(e){return d(e,(function(){return new t}))},t}(),pr=function(){function e(){this.localPoints=L.MakeArray(2),this.localNormal=new L,this.localPoint=new L,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new L,this.localCenterB=new L,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return e.MakeArray=function(t){return d(t,(function(){return new e}))},e}(),fr=function(){this.step=new ar,this.count=0,this.allocator=null},_r=function(){function e(){this.normal=new L,this.point=new L,this.separation=0}return e.prototype.Initialize=function(i,r,n,s){var o=e.Initialize_s_pointA,a=e.Initialize_s_pointB,l=e.Initialize_s_planePoint,c=e.Initialize_s_clipPoint;switch(i.type){case t.b2ManifoldType.e_circles:B.MulXV(r,i.localPoint,o),B.MulXV(n,i.localPoints[0],a),L.SubVV(a,o,this.normal).SelfNormalize(),L.MidVV(o,a,this.point),this.separation=L.DotVV(L.SubVV(a,o,L.s_t0),this.normal)-i.radiusA-i.radiusB;break;case t.b2ManifoldType.e_faceA:O.MulRV(r.q,i.localNormal,this.normal),B.MulXV(r,i.localPoint,l),B.MulXV(n,i.localPoints[s],c),this.separation=L.DotVV(L.SubVV(c,l,L.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(c);break;case t.b2ManifoldType.e_faceB:O.MulRV(n.q,i.localNormal,this.normal),B.MulXV(n,i.localPoint,l),B.MulXV(r,i.localPoints[s],c),this.separation=L.DotVV(L.SubVV(c,l,L.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(c),this.normal.SelfNeg()}},e.Initialize_s_pointA=new L,e.Initialize_s_pointB=new L,e.Initialize_s_planePoint=new L,e.Initialize_s_clipPoint=new L,e}(),mr=function(){function t(){this.m_step=new ar,this.m_allocator=null,this.m_positionConstraints=pr.MakeArray(1024),this.m_velocityConstraints=dr.MakeArray(1024),this.m_count=0}return t.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=m(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new pr;if(this.m_velocityConstraints.length<this.m_count)for(e=m(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new dr;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var i=0;i<this.m_count;++i){var r=this.m_contacts[i],n=r.m_fixtureA,s=r.m_fixtureB,o=n.GetShape(),a=s.GetShape(),l=o.m_radius,c=a.m_radius,h=n.GetBody(),u=s.GetBody(),d=r.GetManifold(),p=d.pointCount,f=this.m_velocityConstraints[i];f.friction=r.m_friction,f.restitution=r.m_restitution,f.tangentSpeed=r.m_tangentSpeed,f.indexA=h.m_islandIndex,f.indexB=u.m_islandIndex,f.invMassA=h.m_invMass,f.invMassB=u.m_invMass,f.invIA=h.m_invI,f.invIB=u.m_invI,f.contactIndex=i,f.pointCount=p,f.K.SetZero(),f.normalMass.SetZero();var _=this.m_positionConstraints[i];_.indexA=h.m_islandIndex,_.indexB=u.m_islandIndex,_.invMassA=h.m_invMass,_.invMassB=u.m_invMass,_.localCenterA.Copy(h.m_sweep.localCenter),_.localCenterB.Copy(u.m_sweep.localCenter),_.invIA=h.m_invI,_.invIB=u.m_invI,_.localNormal.Copy(d.localNormal),_.localPoint.Copy(d.localPoint),_.pointCount=p,_.radiusA=l,_.radiusB=c,_.type=d.type;for(var g=0;g<p;++g){var y=d.points[g],v=f.points[g];this.m_step.warmStarting?(v.normalImpulse=this.m_step.dtRatio*y.normalImpulse,v.tangentImpulse=this.m_step.dtRatio*y.tangentImpulse):(v.normalImpulse=0,v.tangentImpulse=0),v.rA.SetZero(),v.rB.SetZero(),v.normalMass=0,v.tangentMass=0,v.velocityBias=0,_.localPoints[g].Copy(y.localPoint)}}return this},t.prototype.InitializeVelocityConstraints=function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,r=t.InitializeVelocityConstraints_s_worldManifold,n=0;n<this.m_count;++n){var s=this.m_velocityConstraints[n],o=this.m_positionConstraints[n],a=o.radiusA,l=o.radiusB,c=this.m_contacts[s.contactIndex].GetManifold(),h=s.indexA,u=s.indexB,d=s.invMassA,p=s.invMassB,f=s.invIA,_=s.invIB,m=o.localCenterA,g=o.localCenterB,y=this.m_positions[h].c,v=this.m_positions[h].a,b=this.m_velocities[h].v,x=this.m_velocities[h].w,T=this.m_positions[u].c,C=this.m_positions[u].a,S=this.m_velocities[u].v,w=this.m_velocities[u].w;e.q.SetAngle(v),i.q.SetAngle(C),L.SubVV(y,O.MulRV(e.q,m,L.s_t0),e.p),L.SubVV(T,O.MulRV(i.q,g,L.s_t0),i.p),r.Initialize(c,e,a,i,l),s.normal.Copy(r.normal),L.CrossVOne(s.normal,s.tangent);for(var A=s.pointCount,E=0;E<A;++E){var D=s.points[E];L.SubVV(r.points[E],y,D.rA),L.SubVV(r.points[E],T,D.rB);var I=L.CrossVV(D.rA,s.normal),P=L.CrossVV(D.rB,s.normal),M=d+p+f*I*I+_*P*P;D.normalMass=M>0?1/M:0;var R=s.tangent,B=L.CrossVV(D.rA,R),N=L.CrossVV(D.rB,R),k=d+p+f*B*B+_*N*N;D.tangentMass=k>0?1/k:0,D.velocityBias=0;var F=L.DotVV(s.normal,L.SubVV(L.AddVCrossSV(S,w,D.rB,L.s_t0),L.AddVCrossSV(b,x,D.rA,L.s_t1),L.s_t0));F<-1&&(D.velocityBias+=-s.restitution*F)}s.pointCount}},t.prototype.WarmStart=function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var r=this.m_velocityConstraints[i],n=r.indexA,s=r.indexB,o=r.invMassA,a=r.invIA,l=r.invMassB,c=r.invIB,h=r.pointCount,u=this.m_velocities[n].v,d=this.m_velocities[n].w,p=this.m_velocities[s].v,f=this.m_velocities[s].w,_=r.normal,m=r.tangent,g=0;g<h;++g){var y=r.points[g];L.AddVV(L.MulSV(y.normalImpulse,_,L.s_t0),L.MulSV(y.tangentImpulse,m,L.s_t1),e),d-=a*L.CrossVV(y.rA,e),u.SelfMulSub(o,e),f+=c*L.CrossVV(y.rB,e),p.SelfMulAdd(l,e)}this.m_velocities[n].w=d,this.m_velocities[s].w=f}},t.prototype.SolveVelocityConstraints=function(){for(var e=t.SolveVelocityConstraints_s_dv,i=(t.SolveVelocityConstraints_s_dv1,t.SolveVelocityConstraints_s_dv2,t.SolveVelocityConstraints_s_P),r=(t.SolveVelocityConstraints_s_a,t.SolveVelocityConstraints_s_b,t.SolveVelocityConstraints_s_x,t.SolveVelocityConstraints_s_d,t.SolveVelocityConstraints_s_P1,t.SolveVelocityConstraints_s_P2,t.SolveVelocityConstraints_s_P1P2,0);r<this.m_count;++r){for(var n=this.m_velocityConstraints[r],s=n.indexA,o=n.indexB,a=n.invMassA,l=n.invIA,c=n.invMassB,h=n.invIB,u=n.pointCount,d=this.m_velocities[s].v,p=this.m_velocities[s].w,f=this.m_velocities[o].v,_=this.m_velocities[o].w,y=n.normal,v=n.tangent,b=n.friction,x=0;x<u;++x){var T=n.points[x];L.SubVV(L.AddVCrossSV(f,_,T.rB,L.s_t0),L.AddVCrossSV(d,p,T.rA,L.s_t1),e);var C=L.DotVV(e,v)-n.tangentSpeed,S=T.tangentMass*-C,w=b*T.normalImpulse;S=(A=g(T.tangentImpulse+S,-w,w))-T.tangentImpulse,T.tangentImpulse=A,L.MulSV(S,v,i),d.SelfMulSub(a,i),p-=l*L.CrossVV(T.rA,i),f.SelfMulAdd(c,i),_+=h*L.CrossVV(T.rB,i)}for(n.pointCount,x=0;x<u;++x){T=n.points[x],L.SubVV(L.AddVCrossSV(f,_,T.rB,L.s_t0),L.AddVCrossSV(d,p,T.rA,L.s_t1),e);var A,E=L.DotVV(e,y);S=-T.normalMass*(E-T.velocityBias),S=(A=m(T.normalImpulse+S,0))-T.normalImpulse,T.normalImpulse=A,L.MulSV(S,y,i),d.SelfMulSub(a,i),p-=l*L.CrossVV(T.rA,i),f.SelfMulAdd(c,i),_+=h*L.CrossVV(T.rB,i)}this.m_velocities[s].w=p,this.m_velocities[o].w=_}},t.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),r=0;r<e.pointCount;++r)i.points[r].normalImpulse=e.points[r].normalImpulse,i.points[r].tangentImpulse=e.points[r].tangentImpulse},t.prototype.SolvePositionConstraints=function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,r=t.SolvePositionConstraints_s_psm,n=t.SolvePositionConstraints_s_rA,s=t.SolvePositionConstraints_s_rB,a=t.SolvePositionConstraints_s_P,l=0,c=0;c<this.m_count;++c){for(var h=this.m_positionConstraints[c],u=h.indexA,d=h.indexB,p=h.localCenterA,f=h.invMassA,m=h.invIA,y=h.localCenterB,v=h.invMassB,b=h.invIB,x=h.pointCount,T=this.m_positions[u].c,C=this.m_positions[u].a,S=this.m_positions[d].c,w=this.m_positions[d].a,A=0;A<x;++A){e.q.SetAngle(C),i.q.SetAngle(w),L.SubVV(T,O.MulRV(e.q,p,L.s_t0),e.p),L.SubVV(S,O.MulRV(i.q,y,L.s_t0),i.p),r.Initialize(h,e,i,A);var E=r.normal,D=r.point,I=r.separation;L.SubVV(D,T,n),L.SubVV(D,S,s),l=_(l,I);var P=g(.2*(I+o),-.2,0),M=L.CrossVV(n,E),R=L.CrossVV(s,E),B=f+v+m*M*M+b*R*R,N=B>0?-P/B:0;L.MulSV(N,E,a),T.SelfMulSub(f,a),C-=m*L.CrossVV(n,a),S.SelfMulAdd(v,a),w+=b*L.CrossVV(s,a)}this.m_positions[u].a=C,this.m_positions[d].a=w}return l>-3*o},t.prototype.SolveTOIPositionConstraints=function(e,i){for(var r=t.SolveTOIPositionConstraints_s_xfA,n=t.SolveTOIPositionConstraints_s_xfB,s=t.SolveTOIPositionConstraints_s_psm,a=t.SolveTOIPositionConstraints_s_rA,l=t.SolveTOIPositionConstraints_s_rB,c=t.SolveTOIPositionConstraints_s_P,h=0,u=0;u<this.m_count;++u){var d=this.m_positionConstraints[u],p=d.indexA,f=d.indexB,m=d.localCenterA,y=d.localCenterB,v=d.pointCount,b=0,x=0;p!==e&&p!==i||(b=d.invMassA,x=d.invIA);var T=0,C=0;f!==e&&f!==i||(T=d.invMassB,C=d.invIB);for(var S=this.m_positions[p].c,w=this.m_positions[p].a,A=this.m_positions[f].c,E=this.m_positions[f].a,D=0;D<v;++D){r.q.SetAngle(w),n.q.SetAngle(E),L.SubVV(S,O.MulRV(r.q,m,L.s_t0),r.p),L.SubVV(A,O.MulRV(n.q,y,L.s_t0),n.p),s.Initialize(d,r,n,D);var I=s.normal,P=s.point,M=s.separation;L.SubVV(P,S,a),L.SubVV(P,A,l),h=_(h,M);var R=g(.75*(M+o),-.2,0),B=L.CrossVV(a,I),N=L.CrossVV(l,I),k=b+T+x*B*B+C*N*N,F=k>0?-R/k:0;L.MulSV(F,I,c),S.SelfMulSub(b,c),w-=x*L.CrossVV(a,c),A.SelfMulAdd(T,c),E+=C*L.CrossVV(l,c)}this.m_positions[p].a=w,this.m_positions[f].a=E}return h>=-.012},t.InitializeVelocityConstraints_s_xfA=new B,t.InitializeVelocityConstraints_s_xfB=new B,t.InitializeVelocityConstraints_s_worldManifold=new yt,t.WarmStart_s_P=new L,t.SolveVelocityConstraints_s_dv=new L,t.SolveVelocityConstraints_s_dv1=new L,t.SolveVelocityConstraints_s_dv2=new L,t.SolveVelocityConstraints_s_P=new L,t.SolveVelocityConstraints_s_a=new L,t.SolveVelocityConstraints_s_b=new L,t.SolveVelocityConstraints_s_x=new L,t.SolveVelocityConstraints_s_d=new L,t.SolveVelocityConstraints_s_P1=new L,t.SolveVelocityConstraints_s_P2=new L,t.SolveVelocityConstraints_s_P1P2=new L,t.SolvePositionConstraints_s_xfA=new B,t.SolvePositionConstraints_s_xfB=new B,t.SolvePositionConstraints_s_psm=new _r,t.SolvePositionConstraints_s_rA=new L,t.SolvePositionConstraints_s_rB=new L,t.SolvePositionConstraints_s_P=new L,t.SolveTOIPositionConstraints_s_xfA=new B,t.SolveTOIPositionConstraints_s_xfB=new B,t.SolveTOIPositionConstraints_s_psm=new _r,t.SolveTOIPositionConstraints_s_rA=new L,t.SolveTOIPositionConstraints_s_rB=new L,t.SolveTOIPositionConstraints_s_P=new L,t}(),gr=function(){function e(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=lr.MakeArray(1024),this.m_velocities=cr.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return e.prototype.Initialize=function(t,e,i,r,n){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=n,this.m_positions.length<t)for(var s=m(2*this.m_positions.length,t);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new lr;if(this.m_velocities.length<t)for(s=m(2*this.m_velocities.length,t);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new cr},e.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},e.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},e.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},e.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},e.prototype.Solve=function(r,n,s,o){for(var a=e.s_timer.Reset(),l=n.dt,c=0;c<this.m_bodyCount;++c){var h=this.m_bodies[c];this.m_positions[c].c.Copy(h.m_sweep.c);var u=h.m_sweep.a,d=this.m_velocities[c].v.Copy(h.m_linearVelocity),p=h.m_angularVelocity;h.m_sweep.c0.Copy(h.m_sweep.c),h.m_sweep.a0=h.m_sweep.a,h.m_type===t.b2BodyType.b2_dynamicBody&&(d.x+=l*(h.m_gravityScale*s.x+h.m_invMass*h.m_force.x),d.y+=l*(h.m_gravityScale*s.y+h.m_invMass*h.m_force.y),p+=l*h.m_invI*h.m_torque,d.SelfMul(1/(1+l*h.m_linearDamping)),p*=1/(1+l*h.m_angularDamping)),this.m_positions[c].a=u,this.m_velocities[c].w=p}a.Reset();var m=e.s_solverData;m.step.Copy(n),m.positions=this.m_positions,m.velocities=this.m_velocities;var g=e.s_contactSolverDef;g.step.Copy(n),g.contacts=this.m_contacts,g.count=this.m_contactCount,g.positions=this.m_positions,g.velocities=this.m_velocities,g.allocator=this.m_allocator;var y=e.s_contactSolver.Initialize(g);for(y.InitializeVelocityConstraints(),n.warmStarting&&y.WarmStart(),c=0;c<this.m_jointCount;++c)this.m_joints[c].InitVelocityConstraints(m);for(r.solveInit=a.GetMilliseconds(),a.Reset(),c=0;c<n.velocityIterations;++c){for(var v=0;v<this.m_jointCount;++v)this.m_joints[v].SolveVelocityConstraints(m);y.SolveVelocityConstraints()}for(y.StoreImpulses(),r.solveVelocity=a.GetMilliseconds(),c=0;c<this.m_bodyCount;++c){var b=this.m_positions[c].c,x=(u=this.m_positions[c].a,d=this.m_velocities[c].v,p=this.m_velocities[c].w,L.MulSV(l,d,e.s_translation));if(L.DotVV(x,x)>4){var T=2/x.Length();d.SelfMul(T)}var C=l*p;C*C>2.4674011002726646&&(p*=T=1.570796326795/f(C)),b.x+=l*d.x,b.y+=l*d.y,u+=l*p,this.m_positions[c].a=u,this.m_velocities[c].w=p}a.Reset();var S=!1;for(c=0;c<n.positionIterations;++c){var w=y.SolvePositionConstraints(),A=!0;for(v=0;v<this.m_jointCount;++v){var E=this.m_joints[v].SolvePositionConstraints(m);A=A&&E}if(w&&A){S=!0;break}}for(c=0;c<this.m_bodyCount;++c){var D=this.m_bodies[c];D.m_sweep.c.Copy(this.m_positions[c].c),D.m_sweep.a=this.m_positions[c].a,D.m_linearVelocity.Copy(this.m_velocities[c].v),D.m_angularVelocity=this.m_velocities[c].w,D.SynchronizeTransform()}if(r.solvePosition=a.GetMilliseconds(),this.Report(y.m_velocityConstraints),o){var I=i;for(c=0;c<this.m_bodyCount;++c)(h=this.m_bodies[c]).GetType()!==t.b2BodyType.b2_staticBody&&(!h.m_autoSleepFlag||h.m_angularVelocity*h.m_angularVelocity>.0012184696791469947||L.DotVV(h.m_linearVelocity,h.m_linearVelocity)>1e-4?(h.m_sleepTime=0,I=0):(h.m_sleepTime+=l,I=_(I,h.m_sleepTime)));if(I>=.5&&S)for(c=0;c<this.m_bodyCount;++c)(h=this.m_bodies[c]).SetAwake(!1)}},e.prototype.SolveTOI=function(t,i,r){for(var n=0;n<this.m_bodyCount;++n){var s=this.m_bodies[n];this.m_positions[n].c.Copy(s.m_sweep.c),this.m_positions[n].a=s.m_sweep.a,this.m_velocities[n].v.Copy(s.m_linearVelocity),this.m_velocities[n].w=s.m_angularVelocity}var o=e.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.allocator=this.m_allocator,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;var a=e.s_contactSolver.Initialize(o);for(n=0;n<t.positionIterations&&!a.SolveTOIPositionConstraints(i,r);++n);for(this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[r].m_sweep.c0.Copy(this.m_positions[r].c),this.m_bodies[r].m_sweep.a0=this.m_positions[r].a,a.InitializeVelocityConstraints(),n=0;n<t.velocityIterations;++n)a.SolveVelocityConstraints();var l=t.dt;for(n=0;n<this.m_bodyCount;++n){var c=this.m_positions[n].c,h=this.m_positions[n].a,u=this.m_velocities[n].v,d=this.m_velocities[n].w,p=L.MulSV(l,u,e.s_translation);if(L.DotVV(p,p)>4){var _=2/p.Length();u.SelfMul(_)}var m=l*d;m*m>2.4674011002726646&&(d*=_=1.570796326795/f(m)),c.SelfMulAdd(l,u),h+=l*d,this.m_positions[n].a=h,this.m_velocities[n].w=d;var g=this.m_bodies[n];g.m_sweep.c.Copy(c),g.m_sweep.a=h,g.m_linearVelocity.Copy(u),g.m_angularVelocity=d,g.SynchronizeTransform()}this.Report(a.m_velocityConstraints)},e.prototype.Report=function(t){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var r=this.m_contacts[i];if(r){var n=t[i],s=e.s_impulse;s.count=n.pointCount;for(var o=0;o<n.pointCount;++o)s.normalImpulses[o]=n.points[o].normalImpulse,s.tangentImpulses[o]=n.points[o].tangentImpulse;this.m_listener.PostSolve(r,s)}}},e.s_timer=new V,e.s_solverData=new hr,e.s_contactSolverDef=new fr,e.s_contactSolver=new mr,e.s_translation=new L,e.s_impulse=new er,e}();(Gi=t.b2ParticleFlag||(t.b2ParticleFlag={}))[Gi.b2_waterParticle=0]="b2_waterParticle",Gi[Gi.b2_zombieParticle=2]="b2_zombieParticle",Gi[Gi.b2_wallParticle=4]="b2_wallParticle",Gi[Gi.b2_springParticle=8]="b2_springParticle",Gi[Gi.b2_elasticParticle=16]="b2_elasticParticle",Gi[Gi.b2_viscousParticle=32]="b2_viscousParticle",Gi[Gi.b2_powderParticle=64]="b2_powderParticle",Gi[Gi.b2_tensileParticle=128]="b2_tensileParticle",Gi[Gi.b2_colorMixingParticle=256]="b2_colorMixingParticle",Gi[Gi.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Gi[Gi.b2_barrierParticle=1024]="b2_barrierParticle",Gi[Gi.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Gi[Gi.b2_reactiveParticle=4096]="b2_reactiveParticle",Gi[Gi.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Gi[Gi.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Gi[Gi.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Gi[Gi.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Gi[Gi.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var yr=function(){this.flags=0,this.position=new L,this.velocity=new L,this.color=new k(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function vr(t,e,i){return g(Math.ceil(Math.sqrt(t/(.01*e))*i),1,8)}var br,xr=function(){function t(){this.m_index=c}return t.prototype.GetIndex=function(){return this.m_index},t.prototype.SetIndex=function(t){this.m_index=t},t}();(br=t.b2ParticleGroupFlag||(t.b2ParticleGroupFlag={}))[br.b2_solidParticleGroup=1]="b2_solidParticleGroup",br[br.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",br[br.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",br[br.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",br[br.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",br[br.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Tr=function(){this.flags=0,this.groupFlags=0,this.position=new L,this.angle=0,this.linearVelocity=new L,this.angularVelocity=0,this.color=new k,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Cr=function(){function e(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new L,this.m_linearVelocity=new L,this.m_angularVelocity=0,this.m_transform=new B,this.m_userData=null,this.m_system=t}return e.prototype.GetNext=function(){return this.m_next},e.prototype.GetParticleSystem=function(){return this.m_system},e.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},e.prototype.GetBufferIndex=function(){return this.m_firstIndex},e.prototype.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex},e.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t},e.prototype.GetGroupFlags=function(){return this.m_groupFlags},e.prototype.SetGroupFlags=function(e){e|=this.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,e)},e.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass},e.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},e.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center},e.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},e.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},e.prototype.GetTransform=function(){return this.m_transform},e.prototype.GetPosition=function(){return this.m_transform.p},e.prototype.GetAngle=function(){return this.m_transform.q.GetAngle()},e.prototype.GetLinearVelocityFromWorldPoint=function(t,i){var r=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),L.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,L.SubVV(t,this.m_center,r),i)},e.prototype.GetUserData=function(){return this.m_userData},e.prototype.SetUserData=function(t){this.m_userData=t},e.prototype.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)},e.prototype.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)},e.prototype.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)},e.prototype.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new L,e=new L;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);if(this.m_mass>0){var n=1/this.m_mass;this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)}for(this.m_inertia=0,this.m_angularVelocity=0,r=this.m_firstIndex;r<this.m_lastIndex;r++)L.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,t),L.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,e),this.m_inertia+=i*L.DotVV(t,t),this.m_angularVelocity+=i*L.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},e.GetLinearVelocityFromWorldPoint_s_t0=new L,e}(),Sr=function(){function t(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=d(t,(function(){return null})),this.m_capacity=t}return t.prototype.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(d(this.m_capacity,(function(){return null}))),this.m_capacity*=2):(this.m_buffer.concat(d(1,(function(){return null}))),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++},t.prototype.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},t.prototype.Empty=function(){return this.m_front===this.m_back},t.prototype.Front=function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t},t}(),wr=function(){function t(e){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=d(e,(function(){return new t.Generator})),this.m_generatorCapacity=e}return t.prototype.AddGenerator=function(t,e,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(t),r.tag=e,r.necessary=i},t.prototype.Generate=function(e,r){for(var n=1/e,s=new L(+i,+i),o=new L(-i,-i),a=0,l=0;l<this.m_generatorCount;l++)(p=this.m_generatorBuffer[l]).necessary&&(L.MinV(s,p.center,s),L.MaxV(o,p.center,o),++a);if(0===a)return this.m_countX=0,void(this.m_countY=0);s.x-=r,s.y-=r,o.x+=r,o.y+=r,this.m_countX=1+Math.floor(n*(o.x-s.x)),this.m_countY=1+Math.floor(n*(o.y-s.y)),this.m_diagram=[];var c=new Sr(4*this.m_countX*this.m_countY);for(l=0;l<this.m_generatorCount;l++){(p=this.m_generatorBuffer[l]).center.SelfSub(s).SelfMul(n);var h=Math.floor(p.center.x),u=Math.floor(p.center.y);h>=0&&u>=0&&h<this.m_countX&&u<this.m_countY&&c.Push(new t.Task(h,u,h+u*this.m_countX,p))}for(;!c.Empty();){h=(f=c.Front()).m_x,u=f.m_y;var d=f.m_i,p=f.m_generator;c.Pop(),this.m_diagram[d]||(this.m_diagram[d]=p,h>0&&c.Push(new t.Task(h-1,u,d-1,p)),u>0&&c.Push(new t.Task(h,u-1,d-this.m_countX,p)),h<this.m_countX-1&&c.Push(new t.Task(h+1,u,d+1,p)),u<this.m_countY-1&&c.Push(new t.Task(h,u+1,d+this.m_countX,p)))}for(u=0;u<this.m_countY;u++)for(h=0;h<this.m_countX-1;h++)d=h+u*this.m_countX,(_=this.m_diagram[d])!==(m=this.m_diagram[d+1])&&(c.Push(new t.Task(h,u,d,m)),c.Push(new t.Task(h+1,u,d+1,_)));for(u=0;u<this.m_countY-1;u++)for(h=0;h<this.m_countX;h++)d=h+u*this.m_countX,(_=this.m_diagram[d])!==(m=this.m_diagram[d+this.m_countX])&&(c.Push(new t.Task(h,u,d,m)),c.Push(new t.Task(h,u+1,d+this.m_countX,_)));for(;!c.Empty();){var f,_,m;if(h=(f=c.Front()).m_x,u=f.m_y,d=f.m_i,l=f.m_generator,c.Pop(),(_=this.m_diagram[d])!==(m=l)){var g=_.center.x-h,y=_.center.y-u,v=m.center.x-h,b=m.center.y-u;g*g+y*y>v*v+b*b&&(this.m_diagram[d]=m,h>0&&c.Push(new t.Task(h-1,u,d-1,m)),u>0&&c.Push(new t.Task(h,u-1,d-this.m_countX,m)),h<this.m_countX-1&&c.Push(new t.Task(h+1,u,d+1,m)),u<this.m_countY-1&&c.Push(new t.Task(h,u+1,d+this.m_countX,m)))}}},t.prototype.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var r=i+e*this.m_countX,n=this.m_diagram[r],s=this.m_diagram[r+1],o=this.m_diagram[r+this.m_countX],a=this.m_diagram[r+1+this.m_countX];s!==o&&(n!==s&&n!==o&&(n.necessary||s.necessary||o.necessary)&&t(n.tag,s.tag,o.tag),a!==s&&a!==o&&(n.necessary||s.necessary||o.necessary)&&t(s.tag,a.tag,o.tag))}},t}();function Ar(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Er(t,e){return t<e}function Dr(t,e,i,r){void 0===i&&(i=t.length-e),void 0===r&&(r=Er);for(var n=e,s=[],o=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];s[o++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;Ar(t,l,i)}}if(0===o)break;n=i,i=s[--o]}return t}function Lr(t,e,i,r){return void 0===i&&(i=t.length-e),void 0===r&&(r=Er),Dr(t,e,i,r)}function Ir(t,e,i){void 0===i&&(i=t.length);for(var r=0,n=0;n<i;++n)e(t[n])||(n!==r?Ar(t,r++,n):++r);return r}function Pr(t,e,i,r,n){void 0===n&&(n=Er);for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(t[a],r)?(e=++a,s-=o+1):s=o}return e}function Mr(t,e,i,r,n){void 0===n&&(n=Er);for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(r,t[a])?s=o:(e=++a,s-=o+1)}return e}function Rr(t,e,i,r){for(var n=i;e!==n;)Ar(t,e++,n++),n===r?n=i:e===i&&(i=n)}!function(t){t.Generator=function(){this.center=new L,this.tag=0,this.necessary=!1},t.Task=function(t,e,i,r){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=r}}(wr||(wr={}));var Or=function(){function t(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}return t.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},t.prototype.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}},t.prototype.Grow=function(){var t=this.capacity?2*this.capacity:256;this.Reserve(t)},t.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},t.prototype.Shorten=function(){},t.prototype.Data=function(){return this.data},t.prototype.GetCount=function(){return this.count},t.prototype.SetCount=function(t){this.count=t},t.prototype.GetCapacity=function(){return this.capacity},t.prototype.RemoveIf=function(t){this.count=Ir(this.data,t,this.count)},t.prototype.Unique=function(t){this.count=function(t,e,i,r){if(e===i)return i;for(var n=e;++e!==i;)r(t[n],t[e])||Ar(t,++n,e);return++n}(this.data,0,this.count,t)},t}(),Br=function(t){function e(e){var i=t.call(this)||this;return i.m_system=e,i}return Qe(e,t),e.prototype.ShouldQueryParticleSystem=function(){return!1},e.prototype.ReportFixture=function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var r=t.GetAABB(i),n=this.m_system.GetInsideBoundsEnumerator(r),s=void 0;(s=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,s);return!0},e.prototype.ReportParticle=function(){return!1},e.prototype.ReportFixtureAndParticle=function(){},e}(rr),Nr=function(){function t(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new L,this.flags=0}return t.prototype.SetIndices=function(t,e){this.indexA=t,this.indexB=e},t.prototype.SetWeight=function(t){this.weight=t},t.prototype.SetNormal=function(t){this.normal.Copy(t)},t.prototype.SetFlags=function(t){this.flags=t},t.prototype.GetIndexA=function(){return this.indexA},t.prototype.GetIndexB=function(){return this.indexB},t.prototype.GetWeight=function(){return this.weight},t.prototype.GetNormal=function(){return this.normal},t.prototype.GetFlags=function(){return this.flags},t.prototype.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y},t.prototype.IsNotEqual=function(t){return!this.IsEqual(t)},t.prototype.ApproximatelyEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&f(this.weight-t.weight)<.01&&L.DistanceSquaredVV(this.normal,t.normal)<1e-4},t}(),kr=function(){this.index=0,this.weight=0,this.normal=new L,this.mass=0},Fr=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},Vr=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new L(0,0),this.pb=new L(0,0),this.pc=new L(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},jr=function(){function t(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return t.prototype.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this},t.prototype.Clone=function(){return(new t).Copy(this)},t}();t.b2ParticleSystem=function(){function r(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new r.UserOverridableBuffer,this.m_flagsBuffer=new r.UserOverridableBuffer,this.m_positionBuffer=new r.UserOverridableBuffer,this.m_velocityBuffer=new r.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new r.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new r.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new r.UserOverridableBuffer,this.m_bodyContactCountBuffer=new r.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new r.UserOverridableBuffer,this.m_stuckParticleBuffer=new Or((function(){return 0})),this.m_proxyBuffer=new Or((function(){return new r.Proxy})),this.m_contactBuffer=new Or((function(){return new Nr})),this.m_bodyContactBuffer=new Or((function(){return new kr})),this.m_pairBuffer=new Or((function(){return new Fr})),this.m_triadBuffer=new Or((function(){return new Vr})),this.m_expirationTimeBuffer=new r.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new r.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new jr,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}return r.computeTag=function(t,e){return(e+r.yOffset>>>0<<r.yShift)+(r.xScale*t+r.xOffset>>>0)>>>0},r.computeRelativeTag=function(t,e,i){return t+(i<<r.yShift)+(e<<r.xShift)>>>0},r.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},r.prototype.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var i=this.m_count?2*this.m_count:256;this.ReallocateInternalAllocatedBuffers(i)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return c;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var r=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[r]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[r]=(this.m_positionBuffer.data[r]||new L).Copy(e(t.position,L.ZERO)),this.m_velocityBuffer.data[r]=(this.m_velocityBuffer.data[r]||new L).Copy(e(t.velocity,L.ZERO)),this.m_weightBuffer[r]=0,this.m_forceBuffer[r]=(this.m_forceBuffer[r]||new L).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=0),this.m_depthBuffer&&(this.m_depthBuffer[r]=0);var n=(new k).Copy(e(t.color,k.ZERO));!this.m_colorBuffer.data&&n.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[r]=(this.m_colorBuffer.data[r]||new k).Copy(n)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[r]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[r]=null);var s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=e(t.lifetime,0),a=o>0;if(this.m_expirationTimeBuffer.data||a){if(this.SetParticleLifetime(r,a?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[r]=r}s.index=r;var l=e(t.group,null);return this.m_groupBuffer[r]=l,l&&(l.m_firstIndex<l.m_lastIndex?(this.RotateBuffer(l.m_firstIndex,l.m_lastIndex,r),l.m_lastIndex=r+1):(l.m_firstIndex=r,l.m_lastIndex=r+1)),this.SetParticleFlags(r,e(t.flags,0)),r},r.prototype.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new xr).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)},r.prototype.DestroyParticle=function(e,i){if(void 0===i&&(i=!1),!this.m_flagsBuffer.data)throw new Error;var r=t.b2ParticleFlag.b2_zombieParticle;i&&(r|=t.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(e,this.m_flagsBuffer.data[e]|r)},r.prototype.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;var r=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[r]>0?r:n,e)},r.prototype.DestroyParticlesInShape=function(t,e,i){void 0===i&&(i=!1);var n=r.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var s=new r.DestroyParticlesInShapeCallback(this,t,e,i),o=n;return t.ComputeAABB(o,e,0),this.m_world.QueryAABB(s,o),s.Destroyed()},r.prototype.CreateParticleGroup=function(t){var i=r.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var n=i;n.SetPositionAngle(e(t.position,L.ZERO),e(t.angle,0));var s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,n),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,e(t.shapeCount,t.shapes.length),t,n),t.positionData)for(var o=e(t.particleCount,t.positionData.length),a=0;a<o;a++){var l=t.positionData[a];this.CreateParticleForGroup(t,n,l)}var c=this.m_count,h=new Cr(this);for(h.m_firstIndex=s,h.m_lastIndex=c,h.m_strength=e(t.strength,1),h.m_userData=t.userData,h.m_transform.Copy(n),h.m_prev=null,h.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=h),this.m_groupList=h,++this.m_groupCount,a=s;a<c;a++)this.m_groupBuffer[a]=h;this.SetGroupFlags(h,e(t.groupFlags,0));var u=new r.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,c,u),t.group&&(this.JoinParticleGroups(t.group,h),h=t.group),h},r.prototype.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new r.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var n=e.m_firstIndex;n<e.m_lastIndex;n++)this.m_groupBuffer[n]=t;var s=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)},r.prototype.SplitParticleGroup=function(t){this.UpdateContacts(!0);var e=d(t.GetParticleCount(),(function(){return new r.ParticleListNode}));r.InitializeParticleLists(t,e),this.MergeParticleListsInContact(t,e);var i=r.FindLongestParticleList(t,e);this.MergeZombieParticleListNodes(t,e,i),this.CreateParticleGroupsFromParticleList(t,e,i),this.UpdatePairsAndTriadsWithParticleList(t,e)},r.prototype.GetParticleGroupList=function(){return this.m_groupList},r.prototype.GetParticleGroupCount=function(){return this.m_groupCount},r.prototype.GetParticleCount=function(){return this.m_count},r.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount},r.prototype.SetMaxParticleCount=function(t){this.m_def.maxCount=t},r.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags},r.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags},r.prototype.SetPaused=function(t){this.m_paused=t},r.prototype.GetPaused=function(){return this.m_paused},r.prototype.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density},r.prototype.GetDensity=function(){return this.m_def.density},r.prototype.SetGravityScale=function(t){this.m_def.gravityScale=t},r.prototype.GetGravityScale=function(){return this.m_def.gravityScale},r.prototype.SetDamping=function(t){this.m_def.dampingStrength=t},r.prototype.GetDamping=function(){return this.m_def.dampingStrength},r.prototype.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t},r.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},r.prototype.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},r.prototype.GetRadius=function(){return this.m_particleDiameter/2},r.prototype.GetPositionBuffer=function(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data},r.prototype.GetVelocityBuffer=function(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data},r.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},r.prototype.GetGroupBuffer=function(){return this.m_groupBuffer},r.prototype.GetWeightBuffer=function(){return this.m_weightBuffer},r.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},r.prototype.GetFlagsBuffer=function(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data},r.prototype.SetParticleFlags=function(e,i){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[e]&~i&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&i&&(i&t.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),i&t.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=i),this.m_flagsBuffer.data[e]=i},r.prototype.GetParticleFlags=function(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]},r.prototype.SetFlagsBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)},r.prototype.SetPositionBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)},r.prototype.SetVelocityBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)},r.prototype.SetColorBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)},r.prototype.SetUserDataBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)},r.prototype.GetContacts=function(){return this.m_contactBuffer.data},r.prototype.GetContactCount=function(){return this.m_contactBuffer.count},r.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},r.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},r.prototype.GetPairs=function(){return this.m_pairBuffer.data},r.prototype.GetPairCount=function(){return this.m_pairBuffer.count},r.prototype.GetTriads=function(){return this.m_triadBuffer.data},r.prototype.GetTriadCount=function(){return this.m_triadBuffer.count},r.prototype.SetStuckThreshold=function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},r.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},r.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},r.prototype.ComputeCollisionEnergy=function(){if(!this.m_velocityBuffer.data)throw new Error;for(var t=r.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,i=0,n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB,l=s.normal,c=L.SubVV(e[a],e[o],t),h=L.DotVV(c,l);h<0&&(i+=h*h)}return.5*this.GetParticleMass()*i},r.prototype.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t},r.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},r.prototype.SetParticleLifetime=function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var r=this.GetParticleCount(),n=0;n<r;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var s=e/this.m_def.lifetimeGranularity,o=s>0?this.GetQuantizedTimeElapsed()+s:s;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)},r.prototype.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])},r.prototype.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t},r.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge},r.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},r.prototype.ExpirationTimeToLifetime=function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity},r.prototype.GetIndexByExpirationTimeBuffer=function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data},r.prototype.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e)},r.prototype.ApplyLinearImpulse=function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;for(var r=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),s=(new L).Copy(i).SelfMul(1/n),o=t;o<e;o++)r[o].SelfAdd(s)},r.IsSignificantForce=function(t){return 0!==t.x||0!==t.y},r.prototype.ParticleApplyForce=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;r.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))},r.prototype.ApplyForce=function(t,e,i){var n=(new L).Copy(i).SelfMul(1/(e-t));if(r.IsSignificantForce(n)){this.PrepareForceBuffer();for(var s=t;s<e;s++)this.m_forceBuffer[s].SelfAdd(n)}},r.prototype.GetNext=function(){return this.m_next},r.prototype.QueryAABB=function(t,e){if(0!==this.m_proxyBuffer.count){var i=this.m_proxyBuffer.count,n=Pr(this.m_proxyBuffer.data,0,i,r.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),r.Proxy.CompareProxyTag),s=Mr(this.m_proxyBuffer.data,n,i,r.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),r.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(var o=this.m_positionBuffer.data,a=n;a<s;++a){var l=this.m_proxyBuffer.data[a].index,c=o[l];if(e.lowerBound.x<c.x&&c.x<e.upperBound.x&&e.lowerBound.y<c.y&&c.y<e.upperBound.y&&!t.ReportParticle(this,l))break}}},r.prototype.QueryShapeAABB=function(t,e,i,n){void 0===n&&(n=0);var s=r.QueryShapeAABB_s_aabb;e.ComputeAABB(s,i,n),this.QueryAABB(t,s)},r.prototype.QueryPointAABB=function(t,e,i){void 0===i&&(i=o);var n=r.QueryPointAABB_s_aabb;n.lowerBound.Set(e.x-i,e.y-i),n.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,n)},r.prototype.RayCast=function(t,e,i){var n=r.RayCast_s_aabb,s=r.RayCast_s_p,o=r.RayCast_s_v,a=r.RayCast_s_n,l=r.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;var c=this.m_positionBuffer.data,h=n;L.MinV(e,i,h.lowerBound),L.MaxV(e,i,h.upperBound);for(var u,d=1,p=L.SubVV(i,e,o),f=L.DotVV(p,p),m=this.GetInsideBoundsEnumerator(h);(u=m.GetNext())>=0;){var g=L.SubVV(e,c[u],s),y=L.DotVV(g,p),v=y*y-f*(L.DotVV(g,g)-this.m_squaredDiameter);if(v>=0){var b=T(v),x=(-y-b)/f;if(x>d)continue;if(x<0&&((x=(-y+b)/f)<0||x>d))continue;var C=L.AddVMulSV(g,x,p,a);C.Normalize();var S=t.ReportParticle(this,u,L.AddVMulSV(e,x,p,l),C,x);if((d=_(d,S))<=0)break}}}},r.prototype.ComputeAABB=function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i,!this.m_positionBuffer.data)throw new Error;for(var r=this.m_positionBuffer.data,n=0;n<e;n++){var s=r[n];L.MinV(t.lowerBound,s,t.lowerBound),L.MaxV(t.upperBound,s,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter},r.prototype.FreeBuffer=function(t){null!==t&&(t.length=0)},r.prototype.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)},r.prototype.ReallocateBuffer3=function(t,e,i){if(i<=e)throw new Error;var r=t?t.slice():[];return r.length=i,r},r.prototype.ReallocateBuffer5=function(t,e,i,r,n){if(r<=i)throw new Error;if(e&&!(r<=e))throw new Error;return n&&!t||e||(t=this.ReallocateBuffer3(t,i,r)),t},r.prototype.ReallocateBuffer4=function(t,e,i,r){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,r)},r.prototype.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(t=[]).length=this.m_internalAllocatedCapacity),t},r.prototype.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)},r.prototype.ReallocateInternalAllocatedBuffers=function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}},r.prototype.CreateParticleForGroup=function(t,i,r){var n=new yr;n.flags=e(t.flags,0),B.MulXV(i,r,n.position),L.AddVV(e(t.linearVelocity,L.ZERO),L.CrossSV(e(t.angularVelocity,0),L.SubVV(n.position,e(t.position,L.ZERO),L.s_t0),L.s_t0),n.velocity),n.color.Copy(e(t.color,k.ZERO)),n.lifetime=e(t.lifetime,0),n.userData=t.userData,this.CreateParticle(n)},r.prototype.CreateParticlesStrokeShapeForGroup=function(i,n,s){var o=r.CreateParticlesStrokeShapeForGroup_s_edge,a=r.CreateParticlesStrokeShapeForGroup_s_d,l=r.CreateParticlesStrokeShapeForGroup_s_p,c=e(n.stride,0);0===c&&(c=this.GetParticleStride());for(var h=0,u=i.GetChildCount(),d=0;d<u;d++){var p=null;i.GetType()===t.b2ShapeType.e_edgeShape?p=i:(p=o,i.GetChildEdge(p,d));for(var f=L.SubVV(p.m_vertex2,p.m_vertex1,a),_=f.Length();h<_;){var m=L.AddVMulSV(p.m_vertex1,h/_,f,l);this.CreateParticleForGroup(n,s,m),h+=c}h-=_}},r.prototype.CreateParticlesFillShapeForGroup=function(t,i,n){var s=r.CreateParticlesFillShapeForGroup_s_aabb,o=r.CreateParticlesFillShapeForGroup_s_p,a=e(i.stride,0);0===a&&(a=this.GetParticleStride());var l=B.IDENTITY,c=s;t.ComputeAABB(c,l,0);for(var h=Math.floor(c.lowerBound.y/a)*a;h<c.upperBound.y;h+=a)for(var u=Math.floor(c.lowerBound.x/a)*a;u<c.upperBound.x;u+=a){var d=o.Set(u,h);t.TestPoint(l,d)&&this.CreateParticleForGroup(i,n,d)}},r.prototype.CreateParticlesWithShapeForGroup=function(e,i,r){switch(e.GetType()){case t.b2ShapeType.e_edgeShape:case t.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(e,i,r);break;case t.b2ShapeType.e_polygonShape:case t.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(e,i,r)}},r.prototype.CreateParticlesWithShapesForGroup=function(t,e,i,n){var s=new r.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(s,i,n)},r.prototype.CloneParticle=function(t,e){var i=new yr;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var r=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&n.SetIndex(r),this.m_handleIndexBuffer.data[r]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[r].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[r]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[r]=this.m_expirationTimeBuffer.data[t]),r},r.prototype.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)},r.prototype.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount},r.ParticleCanBeConnected=function(e,i){return!!(e&(t.b2ParticleFlag.b2_wallParticle|t.b2ParticleFlag.b2_springParticle|t.b2ParticleFlag.b2_elasticParticle))||null!==i&&!!(i.GetGroupFlags()&t.b2ParticleGroupFlag.b2_rigidParticleGroup)},r.prototype.UpdatePairsAndTriads=function(e,i,n){var s=r.UpdatePairsAndTriads_s_dab,o=r.UpdatePairsAndTriads_s_dbc,a=r.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var l=this.m_positionBuffer.data,c=0,h=e;h<i;h++)c|=this.m_flagsBuffer.data[h];if(c&r.k_pairFlags)for(var u=0;u<this.m_contactBuffer.count;u++){var d=this.m_contactBuffer.data[u],p=d.indexA,f=d.indexB,m=this.m_flagsBuffer.data[p],g=this.m_flagsBuffer.data[f],y=this.m_groupBuffer[p],v=this.m_groupBuffer[f];if(p>=e&&p<i&&f>=e&&f<i&&!((m|g)&t.b2ParticleFlag.b2_zombieParticle)&&(m|g)&r.k_pairFlags&&(n.IsNecessary(p)||n.IsNecessary(f))&&r.ParticleCanBeConnected(m,y)&&r.ParticleCanBeConnected(g,v)&&n.ShouldCreatePair(p,f)){var b=this.m_pairBuffer.data[this.m_pairBuffer.Append()];b.indexA=p,b.indexB=f,b.flags=d.flags,b.strength=_(y?y.m_strength:1,v?v.m_strength:1),b.distance=L.DistanceVV(l[p],l[f])}Lr(this.m_pairBuffer.data,0,this.m_pairBuffer.count,r.ComparePairIndices),this.m_pairBuffer.Unique(r.MatchPairIndices)}if(c&r.k_triadFlags){var x=new wr(i-e);for(h=e;h<i;h++){var T=this.m_flagsBuffer.data[h],C=this.m_groupBuffer[h];T&t.b2ParticleFlag.b2_zombieParticle||!r.ParticleCanBeConnected(T,C)||x.AddGenerator(l[h],h,n.IsNecessary(h))}var S=this.GetParticleStride();x.Generate(S/2,2*S);var w=this;x.GetNodes((function(t,e,i){if(!w.m_flagsBuffer.data)throw new Error;var c=w.m_flagsBuffer.data[t],h=w.m_flagsBuffer.data[e],u=w.m_flagsBuffer.data[i];if((c|h|u)&r.k_triadFlags&&n.ShouldCreateTriad(t,e,i)){var d=l[t],p=l[e],f=l[i],m=L.SubVV(d,p,s),g=L.SubVV(p,f,o),y=L.SubVV(f,d,a),v=4*w.m_squaredDiameter;if(L.DotVV(m,m)>v||L.DotVV(g,g)>v||L.DotVV(y,y)>v)return;var b=w.m_groupBuffer[t],x=w.m_groupBuffer[e],T=w.m_groupBuffer[i],C=w.m_triadBuffer.data[w.m_triadBuffer.Append()];C.indexA=t,C.indexB=e,C.indexC=i,C.flags=c|h|u,C.strength=_(_(b?b.m_strength:1,x?x.m_strength:1),T?T.m_strength:1);var S=(d.x+p.x+f.x)/3,A=(d.y+p.y+f.y)/3;C.pa.x=d.x-S,C.pa.y=d.y-A,C.pb.x=p.x-S,C.pb.y=p.y-A,C.pc.x=f.x-S,C.pc.y=f.y-A,C.ka=-L.DotVV(y,m),C.kb=-L.DotVV(m,g),C.kc=-L.DotVV(g,y),C.s=L.CrossVV(d,p)+L.CrossVV(p,f)+L.CrossVV(f,d)}})),Lr(this.m_triadBuffer.data,0,this.m_triadBuffer.count,r.CompareTriadIndices),this.m_triadBuffer.Unique(r.MatchTriadIndices)}},r.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var e=new r.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,e),!this.m_flagsBuffer.data)throw new Error;for(var i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&=~t.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.b2ParticleFlag.b2_reactiveParticle},r.ComparePairIndices=function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB},r.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB},r.CompareTriadIndices=function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var r=t.indexB-e.indexB;return 0!==r?r<0:t.indexC<e.indexC},r.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC},r.InitializeParticleLists=function(t,e){for(var i=t.GetBufferIndex(),r=t.GetParticleCount(),n=0;n<r;n++){var s=e[n];s.list=s,s.next=null,s.count=1,s.index=n+i}},r.prototype.MergeParticleListsInContact=function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB;if(t.ContainsParticle(o)&&t.ContainsParticle(a)){var l=e[o-i].list,c=e[a-i].list;if(l!==c){if(l.count<c.count){var h=l;l=c,c=h}r.MergeParticleLists(l,c)}}}},r.MergeParticleLists=function(t,e){for(var i=e;;){i.list=t;var r=i.next;if(!r){i.next=t.next;break}i=r}t.next=e,t.count+=e.count,e.count=0},r.FindLongestParticleList=function(t,e){for(var i=t.GetParticleCount(),r=e[0],n=0;n<i;n++){var s=e[n];r.count<s.count&&(r=s)}return r},r.prototype.MergeZombieParticleListNodes=function(e,i,n){if(!this.m_flagsBuffer.data)throw new Error;for(var s=e.GetParticleCount(),o=0;o<s;o++){var a=i[o];a!==n&&this.m_flagsBuffer.data[a.index]&t.b2ParticleFlag.b2_zombieParticle&&r.MergeParticleListAndNode(n,a)}},r.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0},r.prototype.CreateParticleGroupsFromParticleList=function(e,i,r){if(!this.m_flagsBuffer.data)throw new Error;var n=e.GetParticleCount(),s=new Tr;s.groupFlags=e.GetGroupFlags(),s.userData=e.GetUserData();for(var o=0;o<n;o++){var a=i[o];if(a.count&&a!==r)for(var l=this.CreateParticleGroup(s),c=a;c;c=c.next){var h=c.index,u=this.CloneParticle(h,l);this.m_flagsBuffer.data[h]|=t.b2ParticleFlag.b2_zombieParticle,c.index=u}}},r.prototype.UpdatePairsAndTriadsWithParticleList=function(t,e){for(var i=t.GetBufferIndex(),r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r],s=n.indexA,o=n.indexB;t.ContainsParticle(s)&&(n.indexA=e[s-i].index),t.ContainsParticle(o)&&(n.indexB=e[o-i].index)}for(r=0;r<this.m_triadBuffer.count;r++){var a=this.m_triadBuffer.data[r],l=(s=a.indexA,o=a.indexB,a.indexC);t.ContainsParticle(s)&&(a.indexA=e[s-i].index),t.ContainsParticle(o)&&(a.indexB=e[o-i].index),t.ContainsParticle(l)&&(a.indexC=e[l-i].index)}},r.prototype.ComputeDepth=function(){for(var e=[],r=0,n=0;n<this.m_contactBuffer.count;n++){var s=(y=this.m_contactBuffer.data[n]).indexA,o=y.indexB,a=this.m_groupBuffer[s],l=this.m_groupBuffer[o];a&&a===l&&a.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(e[r++]=y)}for(var c=[],h=0,u=this.m_groupList;u;u=u.GetNext())if(u.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){c[h++]=u,this.SetGroupFlags(u,u.m_groupFlags&~t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var d=u.m_firstIndex;d<u.m_lastIndex;d++)this.m_accumulationBuffer[d]=0}for(n=0;n<r;n++){s=(y=e[n]).indexA,o=y.indexB;var p=y.weight;this.m_accumulationBuffer[s]+=p,this.m_accumulationBuffer[o]+=p}for(d=0;d<h;d++)for(var f=(u=c[d]).m_firstIndex;f<u.m_lastIndex;f++)p=this.m_accumulationBuffer[f],this.m_depthBuffer[f]=p<.8?0:i;for(var _=T(this.m_count)|0,m=0;m<_;m++){var g=!1;for(n=0;n<r;n++){s=(y=e[n]).indexA,o=y.indexB;var y,v=1-y.weight,b=this.m_depthBuffer[s],x=this.m_depthBuffer[o],C=x+v,S=b+v;b>C&&(this.m_depthBuffer[s]=C,g=!0),x>S&&(this.m_depthBuffer[o]=S,g=!0)}if(!g)break}for(d=0;d<h;d++)for(var w=(u=c[d]).m_firstIndex;w<u.m_lastIndex;w++)this.m_depthBuffer[w]<i?this.m_depthBuffer[w]*=this.m_particleDiameter:this.m_depthBuffer[w]=0},r.prototype.GetInsideBoundsEnumerator=function(t){var e=r.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=r.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),n=this.m_proxyBuffer.count,s=Pr(this.m_proxyBuffer.data,0,n,e,r.Proxy.CompareProxyTag),o=Mr(this.m_proxyBuffer.data,0,n,i,r.Proxy.CompareTagProxy);return new r.InsideBoundsEnumerator(this,e,i,s,o)},r.prototype.UpdateAllParticleFlags=function(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1},r.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},r.prototype.AddContact=function(t,e){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var i=r.AddContact_s_d,n=this.m_positionBuffer.data,s=L.SubVV(n[e],n[t],i),o=L.DotVV(s,s);if(o<this.m_squaredDiameter){var a=b(o);isFinite(a)||(a=198177537e11);var l=this.m_contactBuffer.data[this.m_contactBuffer.Append()];l.indexA=t,l.indexB=e,l.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],l.weight=1-o*a*this.m_inverseDiameter,L.MulSV(a,s,l.normal)}},r.prototype.FindContacts_Reference=function(){var t=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var e=0,i=0;e<t;e++){for(var n=r.computeRelativeTag(this.m_proxyBuffer.data[e].tag,1,0),s=e+1;s<t&&!(n<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[e].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer);for(var o=r.computeRelativeTag(this.m_proxyBuffer.data[e].tag,-1,1);i<t&&!(o<=this.m_proxyBuffer.data[i].tag);i++);var a=r.computeRelativeTag(this.m_proxyBuffer.data[e].tag,1,1);for(s=i;s<t&&!(a<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[e].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}},r.prototype.FindContacts=function(t){this.FindContacts_Reference(t)},r.prototype.UpdateProxies_Reference=function(){if(!this.m_positionBuffer.data)throw new Error;for(var t=this.m_positionBuffer.data,e=this.m_inverseDiameter,i=0;i<this.m_proxyBuffer.count;++i){var n=this.m_proxyBuffer.data[i],s=t[n.index];n.tag=r.computeTag(e*s.x,e*s.y)}},r.prototype.UpdateProxies=function(t){this.UpdateProxies_Reference(t)},r.prototype.SortProxies=function(){Dr(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,r.Proxy.CompareProxyProxy)},r.prototype.FilterContacts=function(){var e=this.GetParticleContactFilter();if(null!==e){var i=this;this.m_contactBuffer.RemoveIf((function(r){return!!(r.flags&t.b2ParticleFlag.b2_particleContactFilterParticle)&&!e.ShouldCollideParticleParticle(i,r.indexA,r.indexB)}))}},r.prototype.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},r.prototype.NotifyContactListenerPostContact=function(){var t=this.GetParticleContactListener();if(null!==t){for(var e=0;e<this.m_contactBuffer.count;++e){var i=this.m_contactBuffer.data[e];t.BeginContactParticleParticle(this,i)}throw new Error}},r.b2ParticleContactIsZombie=function(e){return(e.flags&t.b2ParticleFlag.b2_zombieParticle)===t.b2ParticleFlag.b2_zombieParticle},r.prototype.UpdateContacts=function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var e=new r.b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(r.b2ParticleContactIsZombie)},r.prototype.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},r.prototype.NotifyBodyContactListenerPostContact=function(){var t=this.GetFixtureContactListener();if(null!==t){for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e];t.BeginContactFixtureParticle(this,i)}throw new Error}},r.prototype.UpdateBodyContacts=function(){var t=r.UpdateBodyContacts_s_aabb,e=new r.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(var i=this.GetParticleCount(),n=0;n<i;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var s=t;this.ComputeAABB(s);var o=new r.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(o,s),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)},r.prototype.Solve=function(e){var i=r.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),this.m_allParticleFlags&t.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var n=i.Copy(e);if(n.dt/=e.particleIterations,n.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(n),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(n),this.SolvePressure(n),this.SolveDamping(n),this.m_allParticleFlags&r.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_springParticle&&this.SolveSpring(n),this.LimitVelocity(n),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(n),this.SolveCollision(n),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=0;s<this.m_count;s++)this.m_positionBuffer.data[s].SelfMulAdd(n.dt,this.m_velocityBuffer.data[s])}},r.prototype.SolveCollision=function(t){var e=r.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=e;o.lowerBound.x=+i,o.lowerBound.y=+i,o.upperBound.x=-i,o.upperBound.y=-i;for(var a=0;a<this.m_count;a++){var l=s[a],c=n[a],h=c.x+t.dt*l.x,u=c.y+t.dt*l.y;o.lowerBound.x=_(o.lowerBound.x,_(c.x,h)),o.lowerBound.y=_(o.lowerBound.y,_(c.y,u)),o.upperBound.x=m(o.upperBound.x,m(c.x,h)),o.upperBound.y=m(o.upperBound.y,m(c.y,u))}var d=new r.SolveCollisionCallback(this,t);this.m_world.QueryAABB(d,o)},r.prototype.LimitVelocity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),r=0;r<this.m_count;r++){var n=e[r],s=L.DotVV(n,n);s>i&&n.SelfMul(T(i/s))}},r.prototype.SolveGravity=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=r.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,n=L.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e),s=0;s<this.m_count;s++)i[s].SelfAdd(n)},r.prototype.SolveBarrier=function(e){var i=r.SolveBarrier_s_aabb,n=r.SolveBarrier_s_va,s=r.SolveBarrier_s_vb,o=r.SolveBarrier_s_pba,a=r.SolveBarrier_s_vba,l=r.SolveBarrier_s_vc,c=r.SolveBarrier_s_pca,h=r.SolveBarrier_s_vca,u=r.SolveBarrier_s_qba,d=r.SolveBarrier_s_qca,p=r.SolveBarrier_s_dv,f=r.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var _=this.m_positionBuffer.data,m=this.m_velocityBuffer.data,g=0;g<this.m_count;g++)this.m_flagsBuffer.data[g]&r.k_barrierWallFlags&&m[g].SetZero();for(var y=2.5*e.dt,v=this.GetParticleMass(),b=0;b<this.m_pairBuffer.count;b++){var x=this.m_pairBuffer.data[b];if(x.flags&t.b2ParticleFlag.b2_barrierParticle){var C=x.indexA,S=x.indexB,w=_[C],A=_[S],E=i;L.MinV(w,A,E.lowerBound),L.MaxV(w,A,E.upperBound);for(var D=this.m_groupBuffer[C],I=this.m_groupBuffer[S],P=this.GetLinearVelocity(D,C,w,n),M=this.GetLinearVelocity(I,S,A,s),R=L.SubVV(A,w,o),O=L.SubVV(M,P,a),B=this.GetInsideBoundsEnumerator(E),N=void 0;(N=B.GetNext())>=0;){var k=_[N],F=this.m_groupBuffer[N];if(D!==F&&I!==F){var V=this.GetLinearVelocity(F,N,k,l),j=L.SubVV(k,w,c),G=L.SubVV(V,P,h),U=L.CrossVV(O,G),Y=L.CrossVV(R,G)-L.CrossVV(j,O),H=L.CrossVV(R,j),X=void 0,z=void 0,W=u,Z=d;if(0===U){if(0===Y)continue;if(!((z=-H/Y)>=0&&z<y))continue;if(L.AddVMulSV(R,z,O,W),L.AddVMulSV(j,z,G,Z),!((X=L.DotVV(W,Z)/L.DotVV(W,W))>=0&&X<=1))continue}else{var J=Y*Y-4*H*U;if(J<0)continue;var q=T(J),K=(-Y-q)/(2*U),Q=(-Y+q)/(2*U);if(K>Q){var $=K;K=Q,Q=$}if(z=K,L.AddVMulSV(R,z,O,W),L.AddVMulSV(j,z,G,Z),X=L.DotVV(W,Z)/L.DotVV(W,W),!(z>=0&&z<y&&X>=0&&X<=1)){if(!((z=Q)>=0&&z<y))continue;if(L.AddVMulSV(R,z,O,W),L.AddVMulSV(j,z,G,Z),!((X=L.DotVV(W,Z)/L.DotVV(W,W))>=0&&X<=1))continue}}var tt=p;tt.x=P.x+X*O.x-V.x,tt.y=P.y+X*O.y-V.y;var et=L.MulSV(v,tt,f);if(F&&this.IsRigidGroup(F)){var it=F.GetMass(),rt=F.GetInertia();it>0&&F.m_linearVelocity.SelfMulAdd(1/it,et),rt>0&&(F.m_angularVelocity+=L.CrossVV(L.SubVV(k,F.GetCenter(),L.s_t0),et)/rt)}else m[N].SelfAdd(tt);this.ParticleApplyForce(N,et.SelfMul(-e.inv_dt))}}}}},r.prototype.SolveStaticPressure=function(e){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var i=this.GetCriticalPressure(e),r=this.m_def.staticPressureStrength*i,n=.25*i,s=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(var a=0;a<this.m_count;a++)this.m_accumulationBuffer[a]=0;for(var l=0;l<this.m_contactBuffer.count;l++){var c=this.m_contactBuffer.data[l];if(c.flags&t.b2ParticleFlag.b2_staticPressureParticle){var h=c.indexA,u=c.indexB,d=c.weight;this.m_accumulationBuffer[h]+=d*this.m_staticPressureBuffer[u],this.m_accumulationBuffer[u]+=d*this.m_staticPressureBuffer[h]}}for(a=0;a<this.m_count;a++)if(d=this.m_weightBuffer[a],this.m_flagsBuffer.data[a]&t.b2ParticleFlag.b2_staticPressureParticle){var p=(this.m_accumulationBuffer[a]+r*(d-1))/(d+s);this.m_staticPressureBuffer[a]=g(p,0,n)}else this.m_staticPressureBuffer[a]=0}},r.prototype.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(t=0;t<this.m_bodyContactBuffer.count;t++){var e=(r=this.m_bodyContactBuffer.data[t]).index,i=r.weight;this.m_weightBuffer[e]+=i}for(t=0;t<this.m_contactBuffer.count;t++){e=(r=this.m_contactBuffer.data[t]).indexA;var r,n=r.indexB;i=r.weight,this.m_weightBuffer[e]+=i,this.m_weightBuffer[n]+=i}},r.prototype.SolvePressure=function(e){var i=r.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.GetCriticalPressure(e),a=this.m_def.pressureStrength*o,l=.25*o,c=0;c<this.m_count;c++){var h=this.m_weightBuffer[c],u=a*m(0,h-1);this.m_accumulationBuffer[c]=_(u,l)}if(this.m_allParticleFlags&r.k_noPressureFlags)for(c=0;c<this.m_count;c++)this.m_flagsBuffer.data[c]&r.k_noPressureFlags&&(this.m_accumulationBuffer[c]=0);if(this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle)for(c=0;c<this.m_count;c++)this.m_flagsBuffer.data[c]&t.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[c]+=this.m_staticPressureBuffer[c]);for(var d=e.dt/(this.m_def.density*this.m_particleDiameter),p=this.GetParticleInvMass(),f=0;f<this.m_bodyContactBuffer.count;f++){var g=(C=this.m_bodyContactBuffer.data[f]).index,y=C.body,v=(h=C.weight,C.mass),b=C.normal,x=n[g],T=(u=this.m_accumulationBuffer[g]+a*h,L.MulSV(d*h*v*u,b,i));s[g].SelfMulSub(p,T),y.ApplyLinearImpulse(T,x,!0)}for(f=0;f<this.m_contactBuffer.count;f++){var C;g=(C=this.m_contactBuffer.data[f]).indexA,y=C.indexB,h=C.weight,b=C.normal,u=this.m_accumulationBuffer[g]+this.m_accumulationBuffer[y],T=L.MulSV(d*h*u,b,i),s[g].SelfSub(T),s[y].SelfAdd(T)}},r.prototype.SolveDamping=function(t){var e=r.SolveDamping_s_v,i=r.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass(),c=0;c<this.m_bodyContactBuffer.count;c++){var h=(x=this.m_bodyContactBuffer.data[c]).index,u=x.body,d=x.weight,p=x.mass,f=x.normal,g=n[h],y=L.SubVV(u.GetLinearVelocityFromWorldPoint(g,L.s_t0),s[h],e);if((T=L.DotVV(y,f))<0){var v=m(o*d,_(-a*T,.5)),b=L.MulSV(v*p*T,f,i);s[h].SelfMulAdd(l,b),u.ApplyLinearImpulse(b.SelfNeg(),g,!0)}}for(c=0;c<this.m_contactBuffer.count;c++){var x,T;h=(x=this.m_contactBuffer.data[c]).indexA,u=x.indexB,d=x.weight,f=x.normal,y=L.SubVV(s[u],s[h],e),(T=L.DotVV(y,f))<0&&(v=m(o*d,_(-a*T,.5)),b=L.MulSV(v*T,f,i),s[h].SelfAdd(b),s[u].SelfSub(b))}},r.prototype.SolveRigidDamping=function(){var t=r.SolveRigidDamping_s_t0,e=r.SolveRigidDamping_s_t1,i=r.SolveRigidDamping_s_p,n=r.SolveRigidDamping_s_v,s=[0],o=[0],a=[0],l=[0],c=[0],h=[0];if(!this.m_positionBuffer.data)throw new Error;for(var u=this.m_positionBuffer.data,d=this.m_def.dampingStrength,p=0;p<this.m_bodyContactBuffer.count;p++){var f=(T=this.m_bodyContactBuffer.data[p]).index;if((S=this.m_groupBuffer[f])&&this.IsRigidGroup(S)){var m=T.body,g=T.normal,y=T.weight,v=u[f],b=L.SubVV(m.GetLinearVelocityFromWorldPoint(v,t),S.GetLinearVelocityFromWorldPoint(v,e),n);if((C=L.DotVV(b,g))<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,!0,S,f,v,g),this.InitDampingParameter(l,c,h,m.GetMass(),m.GetInertia()-m.GetMass()*m.GetLocalCenter().LengthSquared(),m.GetWorldCenter(),v,g);var x=d*_(y,1)*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],c[0],h[0],C);this.ApplyDamping(s[0],o[0],a[0],!0,S,f,x,g),m.ApplyLinearImpulse(L.MulSV(-x,g,L.s_t0),v,!0)}}}for(p=0;p<this.m_contactBuffer.count;p++){f=(T=this.m_contactBuffer.data[p]).indexA,m=T.indexB,g=T.normal,y=T.weight;var T,C,S=this.m_groupBuffer[f],w=this.m_groupBuffer[m],A=this.IsRigidGroup(S),E=this.IsRigidGroup(w);S!==w&&(A||E)&&(v=L.MidVV(u[f],u[m],i),b=L.SubVV(this.GetLinearVelocity(w,m,v,t),this.GetLinearVelocity(S,f,v,e),n),(C=L.DotVV(b,g))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,A,S,f,v,g),this.InitDampingParameterWithRigidGroupOrParticle(l,c,h,E,w,m,v,g),x=d*y*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],c[0],h[0],C),this.ApplyDamping(s[0],o[0],a[0],A,S,f,x,g),this.ApplyDamping(l[0],c[0],h[0],E,w,m,-x,g)))}},r.prototype.SolveExtraDamping=function(){var t=r.SolveExtraDamping_s_v,e=r.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var i=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,s=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],l=a.index;if(this.m_flagsBuffer.data[l]&r.k_extraDampingFlags){var c=a.body,h=a.mass,u=a.normal,d=n[l],p=L.SubVV(c.GetLinearVelocityFromWorldPoint(d,L.s_t0),i[l],t),f=L.DotVV(p,u);if(f<0){var _=L.MulSV(.5*h*f,u,e);i[l].SelfMulAdd(s,_),c.ApplyLinearImpulse(_.SelfNeg(),d,!0)}}}},r.prototype.SolveWall=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&t.b2ParticleFlag.b2_wallParticle&&e[i].SetZero()},r.prototype.SolveRigid=function(e){var i=r.SolveRigid_s_position,n=r.SolveRigid_s_rotation,s=r.SolveRigid_s_transform,o=r.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,c=this.m_groupList;c;c=c.GetNext())if(c.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup){c.UpdateStatistics();var h=n;h.SetAngle(e.dt*c.m_angularVelocity);var u=L.AddVV(c.m_center,L.SubVV(L.MulSV(e.dt,c.m_linearVelocity,L.s_t0),O.MulRV(h,c.m_center,L.s_t1),L.s_t0),i),d=s;d.SetPositionRotation(u,h),B.MulXX(d,c.m_transform,c.m_transform);var p=o;p.p.x=e.inv_dt*d.p.x,p.p.y=e.inv_dt*d.p.y,p.q.s=e.inv_dt*d.q.s,p.q.c=e.inv_dt*(d.q.c-1);for(var f=c.m_firstIndex;f<c.m_lastIndex;f++)B.MulXV(p,a[f],l[f])}},r.prototype.SolveElastic=function(e){var i=r.SolveElastic_s_pa,n=r.SolveElastic_s_pb,s=r.SolveElastic_s_pc,o=r.SolveElastic_s_r,a=r.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var l=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,h=e.inv_dt*this.m_def.elasticStrength,u=0;u<this.m_triadBuffer.count;u++){var d=this.m_triadBuffer.data[u];if(d.flags&t.b2ParticleFlag.b2_elasticParticle){var p=d.indexA,f=d.indexB,_=d.indexC,m=d.pa,g=d.pb,y=d.pc,v=i.Copy(l[p]),x=n.Copy(l[f]),T=s.Copy(l[_]),C=c[p],S=c[f],w=c[_];v.SelfMulAdd(e.dt,C),x.SelfMulAdd(e.dt,S),T.SelfMulAdd(e.dt,w);var A=(v.x+x.x+T.x)/3,E=(v.y+x.y+T.y)/3;v.x-=A,v.y-=E,x.x-=A,x.y-=E,T.x-=A,T.y-=E;var D=o;D.s=L.CrossVV(m,v)+L.CrossVV(g,x)+L.CrossVV(y,T),D.c=L.DotVV(m,v)+L.DotVV(g,x)+L.DotVV(y,T);var I=b(D.s*D.s+D.c*D.c);isFinite(I)||(I=198177537e11),D.s*=I,D.c*=I;var P=h*d.strength;O.MulRV(D,m,a),L.SubVV(a,v,a),L.MulSV(P,a,a),C.SelfAdd(a),O.MulRV(D,g,a),L.SubVV(a,x,a),L.MulSV(P,a,a),S.SelfAdd(a),O.MulRV(D,y,a),L.SubVV(a,T,a),L.MulSV(P,a,a),w.SelfAdd(a)}}},r.prototype.SolveSpring=function(e){var i=r.SolveSpring_s_pa,n=r.SolveSpring_s_pb,s=r.SolveSpring_s_d,o=r.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,c=e.inv_dt*this.m_def.springStrength,h=0;h<this.m_pairBuffer.count;h++){var u=this.m_pairBuffer.data[h];if(u.flags&t.b2ParticleFlag.b2_springParticle){var d=u.indexA,p=u.indexB,f=i.Copy(a[d]),_=n.Copy(a[p]),m=l[d],g=l[p];f.SelfMulAdd(e.dt,m),_.SelfMulAdd(e.dt,g);var y=L.SubVV(_,f,s),v=u.distance,b=y.Length(),x=c*u.strength,T=L.MulSV(x*(v-b)/b,y,o);m.SelfSub(T),g.SelfAdd(T)}}},r.prototype.SolveTensile=function(e){var i=r.SolveTensile_s_weightedNormal,n=r.SolveTensile_s_s,s=r.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var o=this.m_velocityBuffer.data,a=0;a<this.m_count;a++)this.m_accumulation2Buffer[a]=new L,this.m_accumulation2Buffer[a].SetZero();for(var l=0;l<this.m_contactBuffer.count;l++)if((v=this.m_contactBuffer.data[l]).flags&t.b2ParticleFlag.b2_tensileParticle){var c=v.indexA,h=v.indexB,u=v.weight,d=v.normal,p=L.MulSV((1-u)*u,d,i);this.m_accumulation2Buffer[c].SelfSub(p),this.m_accumulation2Buffer[h].SelfAdd(p)}var f=this.GetCriticalVelocity(e),m=this.m_def.surfaceTensionPressureStrength*f,g=this.m_def.surfaceTensionNormalStrength*f,y=.5*f;for(l=0;l<this.m_contactBuffer.count;l++){var v;if((v=this.m_contactBuffer.data[l]).flags&t.b2ParticleFlag.b2_tensileParticle){c=v.indexA,h=v.indexB,u=v.weight,d=v.normal;var b=this.m_weightBuffer[c]+this.m_weightBuffer[h],x=L.SubVV(this.m_accumulation2Buffer[h],this.m_accumulation2Buffer[c],n),T=_(m*(b-2)+g*L.DotVV(x,d),y)*u,C=L.MulSV(T,d,s);o[c].SelfSub(C),o[h].SelfAdd(C)}}},r.prototype.SolveViscous=function(){var e=r.SolveViscous_s_v,i=r.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var c=(m=this.m_bodyContactBuffer.data[l]).index;if(this.m_flagsBuffer.data[c]&t.b2ParticleFlag.b2_viscousParticle){var h=m.body,u=m.weight,d=m.mass,p=n[c],f=L.SubVV(h.GetLinearVelocityFromWorldPoint(p,L.s_t0),s[c],e),_=L.MulSV(o*d*u,f,i);s[c].SelfMulAdd(a,_),h.ApplyLinearImpulse(_.SelfNeg(),p,!0)}}for(l=0;l<this.m_contactBuffer.count;l++){var m;(m=this.m_contactBuffer.data[l]).flags&t.b2ParticleFlag.b2_viscousParticle&&(c=m.indexA,h=m.indexB,u=m.weight,f=L.SubVV(s[h],s[c],e),_=L.MulSV(o*u,f,i),s[c].SelfAdd(_),s[h].SelfSub(_))}},r.prototype.SolveRepulsive=function(e){var i=r.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),o=0;o<this.m_contactBuffer.count;o++){var a=this.m_contactBuffer.data[o];if(a.flags&t.b2ParticleFlag.b2_repulsiveParticle){var l=a.indexA,c=a.indexB;if(this.m_groupBuffer[l]!==this.m_groupBuffer[c]){var h=a.weight,u=a.normal,d=L.MulSV(s*h,u,i);n[l].SelfSub(d),n[c].SelfAdd(d)}}}},r.prototype.SolvePowder=function(e){var i=r.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(e),a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var c=(_=this.m_bodyContactBuffer.data[l]).index;if(this.m_flagsBuffer.data[c]&t.b2ParticleFlag.b2_powderParticle&&(m=_.weight)>.25){var h=_.body,u=_.mass,d=n[c],p=_.normal,f=L.MulSV(o*u*(m-.25),p,i);s[c].SelfMulSub(a,f),h.ApplyLinearImpulse(f,d,!0)}}for(l=0;l<this.m_contactBuffer.count;l++){var _,m;(_=this.m_contactBuffer.data[l]).flags&t.b2ParticleFlag.b2_powderParticle&&(m=_.weight)>.25&&(c=_.indexA,h=_.indexB,p=_.normal,f=L.MulSV(o*(m-.25),p,i),s[c].SelfSub(f),s[h].SelfAdd(f))}},r.prototype.SolveSolid=function(t){var e=r.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;var i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=t.inv_dt*this.m_def.ejectionStrength,s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var c=o.weight,h=o.normal,u=this.m_depthBuffer[a]+this.m_depthBuffer[l],d=L.MulSV(n*u*c,h,e);i[a].SelfSub(d),i[l].SelfAdd(d)}}},r.prototype.SolveForce=function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),r=0;r<this.m_count;r++)e[r].SelfMulAdd(i,this.m_forceBuffer[r]);this.m_hasForce=!1},r.prototype.SolveColorMixing=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;var e=.5*this.m_def.colorMixingStrength;if(e)for(var i=0;i<this.m_contactBuffer.count;i++){var r=this.m_contactBuffer.data[i],n=r.indexA,s=r.indexB;if(this.m_flagsBuffer.data[n]&this.m_flagsBuffer.data[s]&t.b2ParticleFlag.b2_colorMixingParticle){var o=this.m_colorBuffer.data[n],a=this.m_colorBuffer.data[s];k.MixColors(o,a,e)}}},r.prototype.SolveZombie=function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=0,i=[],r=0;r<this.m_count;r++)i[r]=c;var n=0;for(r=0;r<this.m_count;r++){var s=this.m_flagsBuffer.data[r];if(s&t.b2ParticleFlag.b2_zombieParticle){var o=this.m_world.m_destructionListener;s&t.b2ParticleFlag.b2_destructionListenerParticle&&o&&o.SayGoodbyeParticle(this,r),this.m_handleIndexBuffer.data&&(a=this.m_handleIndexBuffer.data[r])&&(a.SetIndex(c),this.m_handleIndexBuffer.data[r]=null),i[r]=c}else{var a;i[r]=e,r!==e&&(this.m_handleIndexBuffer.data&&((a=this.m_handleIndexBuffer.data[r])&&a.SetIndex(e),this.m_handleIndexBuffer.data[e]=a),this.m_flagsBuffer.data[e]=this.m_flagsBuffer.data[r],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[r]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[r]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[r]),this.m_positionBuffer.data[e].Copy(this.m_positionBuffer.data[r]),this.m_velocityBuffer.data[e].Copy(this.m_velocityBuffer.data[r]),this.m_groupBuffer[e]=this.m_groupBuffer[r],this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[r]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[r]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[r]),this.m_colorBuffer.data&&this.m_colorBuffer.data[e].Copy(this.m_colorBuffer.data[r]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[e]=this.m_userDataBuffer.data[r]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[r])),e++,n|=s}}for(var l=0;l<this.m_proxyBuffer.count;l++){var h=this.m_proxyBuffer.data[l];h.index=i[h.index]}for(this.m_proxyBuffer.RemoveIf((function(t){return t.index<0})),l=0;l<this.m_contactBuffer.count;l++)(u=this.m_contactBuffer.data[l]).indexA=i[u.indexA],u.indexB=i[u.indexB];for(this.m_contactBuffer.RemoveIf((function(t){return t.indexA<0||t.indexB<0})),l=0;l<this.m_bodyContactBuffer.count;l++){var u;(u=this.m_bodyContactBuffer.data[l]).index=i[u.index]}for(this.m_bodyContactBuffer.RemoveIf((function(t){return t.index<0})),l=0;l<this.m_pairBuffer.count;l++){var d=this.m_pairBuffer.data[l];d.indexA=i[d.indexA],d.indexB=i[d.indexB]}for(this.m_pairBuffer.RemoveIf((function(t){return t.indexA<0||t.indexB<0})),l=0;l<this.m_triadBuffer.count;l++){var p=this.m_triadBuffer.data[l];p.indexA=i[p.indexA],p.indexB=i[p.indexB],p.indexC=i[p.indexC]}if(this.m_triadBuffer.RemoveIf((function(t){return t.indexA<0||t.indexB<0||t.indexC<0})),this.m_indexByExpirationTimeBuffer.data)for(var f=0,g=0;g<this.m_count;g++){var y=i[this.m_indexByExpirationTimeBuffer.data[g]];y!==c&&(this.m_indexByExpirationTimeBuffer.data[f++]=y)}for(var v=this.m_groupList;v;v=v.GetNext()){var b=e,x=0,T=!1;for(r=v.m_firstIndex;r<v.m_lastIndex;r++){var C=i[r];C>=0?(b=_(b,C),x=m(x,C+1)):T=!0}b<x?(v.m_firstIndex=b,v.m_lastIndex=x,T&&v.m_groupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(v,v.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(v.m_firstIndex=0,v.m_lastIndex=0,v.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(v,v.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}for(this.m_count=e,this.m_allParticleFlags=n,this.m_needsUpdateAllParticleFlags=!1,v=this.m_groupList;v;){var S=v.GetNext();v.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(v),v=S}},r.prototype.SolveLifetimes=function(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,r=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Dr(r,0,n,(function(t,e){var r=i[t],n=i[e],s=r<=0;return s===n<=0?r>n:s})),this.m_expirationTimeBufferRequiresSorting=!1);for(var s=n-1;s>=0;--s){var o=r[s],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}},r.prototype.RotateBuffer=function(t,e,i){if(t!==e&&e!==i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(Rr(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&Rr(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&Rr(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&Rr(this.m_consecutiveContactStepsBuffer.data,t,e,i),Rr(this.m_positionBuffer.data,t,e,i),Rr(this.m_velocityBuffer.data,t,e,i),Rr(this.m_groupBuffer,t,e,i),this.m_hasForce&&Rr(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&Rr(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&Rr(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&Rr(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&Rr(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){Rr(this.m_handleIndexBuffer.data,t,e,i);for(var r=t;r<i;++r){var n=this.m_handleIndexBuffer.data[r];n&&n.SetIndex(p(n.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Rr(this.m_expirationTimeBuffer.data,t,e,i);var s=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;var o=this.m_indexByExpirationTimeBuffer.data;for(r=0;r<s;++r)o[r]=p(o[r])}for(var a=0;a<this.m_proxyBuffer.count;a++){var l=this.m_proxyBuffer.data[a];l.index=p(l.index)}for(a=0;a<this.m_contactBuffer.count;a++)(c=this.m_contactBuffer.data[a]).indexA=p(c.indexA),c.indexB=p(c.indexB);for(a=0;a<this.m_bodyContactBuffer.count;a++){var c;(c=this.m_bodyContactBuffer.data[a]).index=p(c.index)}for(a=0;a<this.m_pairBuffer.count;a++){var h=this.m_pairBuffer.data[a];h.indexA=p(h.indexA),h.indexB=p(h.indexB)}for(a=0;a<this.m_triadBuffer.count;a++){var u=this.m_triadBuffer.data[a];u.indexA=p(u.indexA),u.indexB=p(u.indexB),u.indexC=p(u.indexC)}for(var d=this.m_groupList;d;d=d.GetNext())d.m_firstIndex=p(d.m_firstIndex),d.m_lastIndex=p(d.m_lastIndex-1)+1}function p(r){return r<t?r:r<e?r+i-e:r<i?r+t-e:r}},r.prototype.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt},r.prototype.GetCriticalVelocitySquared=function(t){var e=this.GetCriticalVelocity(t);return e*e},r.prototype.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)},r.prototype.GetParticleStride=function(){return.75*this.m_particleDiameter},r.prototype.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t},r.prototype.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t},r.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},r.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},r.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},r.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},r.prototype.SetUserOverridableBuffer=function(t,e,i){t.data=e,t.userSuppliedCapacity=i},r.prototype.SetGroupFlags=function(e,i){var r=e.m_groupFlags;(r^i)&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(i|=t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),r&~i&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&i&&(i&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=i),e.m_groupFlags=i},r.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index},r.prototype.RemoveSpuriousBodyContacts=function(){Dr(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,r.BodyContactCompare);var t=r.RemoveSpuriousBodyContacts_s_n,e=r.RemoveSpuriousBodyContacts_s_pos,i=r.RemoveSpuriousBodyContacts_s_normal,n=this,s=-1,a=0;this.m_bodyContactBuffer.count=Ir(this.m_bodyContactBuffer.data,(function(r){if(r.index!==s&&(a=0,s=r.index),a++>3)return!0;var l=t.Copy(r.normal);if(l.SelfMul(n.m_particleDiameter*(1-r.weight)),!n.m_positionBuffer.data)throw new Error;var c=L.AddVV(n.m_positionBuffer.data[r.index],l,e);if(!r.fixture.TestPoint(c)){for(var h=r.fixture.GetShape().GetChildCount(),u=0;u<h;u++){var d=i;if(r.fixture.ComputeDistance(c,d,u)<o)return!1}return!0}return!1}),this.m_bodyContactBuffer.count)},r.prototype.DetectStuckParticle=function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}},r.prototype.ValidateParticleIndex=function(t){return t>=0&&t<this.GetParticleCount()&&t!==c},r.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},r.prototype.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)},r.prototype.ForceCanBeApplied=function(e){return!(e&t.b2ParticleFlag.b2_wallParticle)},r.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}},r.prototype.IsRigidGroup=function(e){return null!==e&&!!(e.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup)},r.prototype.GetLinearVelocity=function(t,e,i,r){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,r);if(!this.m_velocityBuffer.data)throw new Error;return r.Copy(this.m_velocityBuffer.data[e])},r.prototype.InitDampingParameter=function(t,e,i,r,n,s,o,a){t[0]=r>0?1/r:0,e[0]=n>0?1/n:0,i[0]=L.CrossVV(L.SubVV(o,s,L.s_t0),a)},r.prototype.InitDampingParameterWithRigidGroupOrParticle=function(e,i,r,n,s,o,a,l){if(s&&n)this.InitDampingParameter(e,i,r,s.GetMass(),s.GetInertia(),s.GetCenter(),a,l);else{if(!this.m_flagsBuffer.data)throw new Error;var c=this.m_flagsBuffer.data[o];this.InitDampingParameter(e,i,r,c&t.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,l)}},r.prototype.ComputeDampingImpulse=function(t,e,i,r,n,s,o){var a=t+e*i*i+r+n*s*s;return a>0?o/a:0},r.prototype.ApplyDamping=function(t,e,i,r,n,s,o,a){if(n&&r)n.m_linearVelocity.SelfMulAdd(o*t,a),n.m_angularVelocity+=o*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}},r.xTruncBits=12,r.yTruncBits=12,r.tagBits=32,r.yOffset=1<<r.yTruncBits-1,r.yShift=r.tagBits-r.yTruncBits,r.xShift=r.tagBits-r.yTruncBits-r.xTruncBits,r.xScale=1<<r.xShift,r.xOffset=r.xScale*(1<<r.xTruncBits-1),r.yMask=(1<<r.yTruncBits)-1<<r.yShift,r.xMask=~r.yMask,r.DestroyParticlesInShape_s_aabb=new Tt,r.CreateParticleGroup_s_transform=new B,r.ComputeCollisionEnergy_s_v=new L,r.QueryShapeAABB_s_aabb=new Tt,r.QueryPointAABB_s_aabb=new Tt,r.RayCast_s_aabb=new Tt,r.RayCast_s_p=new L,r.RayCast_s_v=new L,r.RayCast_s_n=new L,r.RayCast_s_point=new L,r.k_pairFlags=t.b2ParticleFlag.b2_springParticle,r.k_triadFlags=t.b2ParticleFlag.b2_elasticParticle,r.k_noPressureFlags=t.b2ParticleFlag.b2_powderParticle|t.b2ParticleFlag.b2_tensileParticle,r.k_extraDampingFlags=t.b2ParticleFlag.b2_staticPressureParticle,r.k_barrierWallFlags=t.b2ParticleFlag.b2_barrierParticle|t.b2ParticleFlag.b2_wallParticle,r.CreateParticlesStrokeShapeForGroup_s_edge=new ii,r.CreateParticlesStrokeShapeForGroup_s_d=new L,r.CreateParticlesStrokeShapeForGroup_s_p=new L,r.CreateParticlesFillShapeForGroup_s_aabb=new Tt,r.CreateParticlesFillShapeForGroup_s_p=new L,r.UpdatePairsAndTriads_s_dab=new L,r.UpdatePairsAndTriads_s_dbc=new L,r.UpdatePairsAndTriads_s_dca=new L,r.AddContact_s_d=new L,r.UpdateBodyContacts_s_aabb=new Tt,r.Solve_s_subStep=new ar,r.SolveCollision_s_aabb=new Tt,r.SolveGravity_s_gravity=new L,r.SolveBarrier_s_aabb=new Tt,r.SolveBarrier_s_va=new L,r.SolveBarrier_s_vb=new L,r.SolveBarrier_s_pba=new L,r.SolveBarrier_s_vba=new L,r.SolveBarrier_s_vc=new L,r.SolveBarrier_s_pca=new L,r.SolveBarrier_s_vca=new L,r.SolveBarrier_s_qba=new L,r.SolveBarrier_s_qca=new L,r.SolveBarrier_s_dv=new L,r.SolveBarrier_s_f=new L,r.SolvePressure_s_f=new L,r.SolveDamping_s_v=new L,r.SolveDamping_s_f=new L,r.SolveRigidDamping_s_t0=new L,r.SolveRigidDamping_s_t1=new L,r.SolveRigidDamping_s_p=new L,r.SolveRigidDamping_s_v=new L,r.SolveExtraDamping_s_v=new L,r.SolveExtraDamping_s_f=new L,r.SolveRigid_s_position=new L,r.SolveRigid_s_rotation=new O,r.SolveRigid_s_transform=new B,r.SolveRigid_s_velocityTransform=new B,r.SolveElastic_s_pa=new L,r.SolveElastic_s_pb=new L,r.SolveElastic_s_pc=new L,r.SolveElastic_s_r=new O,r.SolveElastic_s_t0=new L,r.SolveSpring_s_pa=new L,r.SolveSpring_s_pb=new L,r.SolveSpring_s_d=new L,r.SolveSpring_s_f=new L,r.SolveTensile_s_weightedNormal=new L,r.SolveTensile_s_s=new L,r.SolveTensile_s_f=new L,r.SolveViscous_s_v=new L,r.SolveViscous_s_f=new L,r.SolveRepulsive_s_f=new L,r.SolvePowder_s_f=new L,r.SolveSolid_s_f=new L,r.RemoveSpuriousBodyContacts_s_n=new L,r.RemoveSpuriousBodyContacts_s_pos=new L,r.RemoveSpuriousBodyContacts_s_normal=new L,r}(),function(e){e.UserOverridableBuffer=function(){this.data=null,this.userSuppliedCapacity=0};var r=function(){function t(){this.index=c,this.tag=0}return t.CompareProxyProxy=function(t,e){return t.tag<e.tag},t.CompareTagProxy=function(t,e){return t<e.tag},t.CompareProxyTag=function(t,e){return t.tag<e},t}();e.Proxy=r;var n=function(){function t(t,i,r,n,s){this.m_system=t,this.m_xLower=(i&e.xMask)>>>0,this.m_xUpper=(r&e.xMask)>>>0,this.m_yLower=(i&e.yMask)>>>0,this.m_yUpper=(r&e.yMask)>>>0,this.m_first=n,this.m_last=s}return t.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&e.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return c},t}();e.InsideBoundsEnumerator=n,e.ParticleListNode=function(){this.next=null,this.count=0,this.index=0};var s=function(){function t(){}return t.prototype.Allocate=function(t,e){return e},t.prototype.Clear=function(){},t.prototype.GetCount=function(){return 0},t.prototype.Invalidate=function(){},t.prototype.GetValidBuffer=function(){return[]},t.prototype.GetBuffer=function(){return[]},t.prototype.SetCount=function(){},t}();e.FixedSetAllocator=s,e.FixtureParticle=function(t,e){this.second=c,this.first=t,this.second=e};var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qe(e,t),e.prototype.Initialize=function(){},e.prototype.Find=function(){return c},e}(e.FixedSetAllocator);e.FixtureParticleSet=a,e.ParticlePair=function(t,e){this.first=c,this.second=c,this.first=t,this.second=e};var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qe(e,t),e.prototype.Initialize=function(){},e.prototype.Find=function(){return c},e}(e.FixedSetAllocator);e.b2ParticlePairSet=l;var h=function(){function t(){}return t.prototype.IsNecessary=function(){return!0},t.prototype.ShouldCreatePair=function(){return!0},t.prototype.ShouldCreateTriad=function(){return!0},t}();e.ConnectionFilter=h;var u=function(t){function e(e,i,r,n){var s=t.call(this)||this;return s.m_callDestructionListener=!1,s.m_destroyed=0,s.m_system=e,s.m_shape=i,s.m_xf=r,s.m_callDestructionListener=n,s.m_destroyed=0,s}return Qe(e,t),e.prototype.ReportFixture=function(){return!1},e.prototype.ReportParticle=function(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0},e.prototype.Destroyed=function(){return this.m_destroyed},e}(rr);e.DestroyParticlesInShapeCallback=u;var d=function(t){function e(e){var i=t.call(this)||this;return i.m_threshold=0,i.m_threshold=e,i}return Qe(e,t),e.prototype.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t},e.prototype.ShouldCreateTriad=function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)},e}(e.ConnectionFilter);e.JoinParticleGroupsFilter=d;var p=function(e){function r(i,r){void 0===r&&(r=i.length);var n=e.call(this,t.b2ShapeType.e_unknown,0)||this;return n.m_shapeCount=0,n.m_shapes=i,n.m_shapeCount=r,n}return Qe(r,e),r.prototype.Clone=function(){throw new Error},r.prototype.GetChildCount=function(){return 1},r.prototype.TestPoint=function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1},r.prototype.ComputeDistance=function(){return 0},r.prototype.RayCast=function(){return!1},r.prototype.ComputeAABB=function(t,e){var r=new Tt;t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i;for(var n=0;n<this.m_shapeCount;n++)for(var s=this.m_shapes[n].GetChildCount(),o=0;o<s;o++){var a=r;this.m_shapes[n].ComputeAABB(a,e,o),t.Combine1(a)}},r.prototype.ComputeMass=function(){},r.prototype.SetupDistanceProxy=function(){},r.prototype.ComputeSubmergedArea=function(){return 0},r.prototype.Dump=function(){},r}(qe);e.CompositeShape=p;var f=function(e){function i(t){var i=e.call(this)||this;return i.m_flagsBuffer=t,i}return Qe(i,e),i.prototype.IsNecessary=function(e){if(!this.m_flagsBuffer.data)throw new Error;return!!(this.m_flagsBuffer.data[e]&t.b2ParticleFlag.b2_reactiveParticle)},i}(e.ConnectionFilter);e.ReactiveFilter=f;var _=function(i){function r(t,e){var r=i.call(this,t)||this;return r.m_contactFilter=e,r}return Qe(r,i),r.prototype.ShouldCollideFixtureParticle=function(e,i,r){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[r]&t.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,r)},r.prototype.ReportFixtureAndParticle=function(i,r,n){var s=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,o=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var a=this.m_system.m_positionBuffer.data[n],l=s,c=i.ComputeDistance(a,l,r);if(c<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(i,this.m_system,n)){var h=i.GetBody(),u=h.GetWorldCenter(),d=h.GetMass(),p=h.GetInertia()-d*h.GetLocalCenter().LengthSquared(),f=d>0?1/d:0,_=p>0?1/p:0,m=this.m_system.m_flagsBuffer.data[n]&t.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),g=L.SubVV(a,u,o),y=L.CrossVV(g,l),v=m+f+_*y*y,b=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];b.index=n,b.body=h,b.fixture=i,b.weight=1-c*this.m_system.m_inverseDiameter,b.normal.Copy(l.SelfNeg()),b.mass=v>0?1/v:0,this.m_system.DetectStuckParticle(n)}},r.ReportFixtureAndParticle_s_n=new L,r.ReportFixtureAndParticle_s_rp=new L,r}(Br);e.UpdateBodyContactsCallback=_;var m=function(i){function r(t,e){var r=i.call(this,t)||this;return r.m_step=e,r}return Qe(r,i),r.prototype.ReportFixtureAndParticle=function(i,r,n){var s=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,a=e.SolveCollisionCallback.ReportFixtureAndParticle_s_output,l=e.SolveCollisionCallback.ReportFixtureAndParticle_s_input,c=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p,h=e.SolveCollisionCallback.ReportFixtureAndParticle_s_v,u=e.SolveCollisionCallback.ReportFixtureAndParticle_s_f,d=i.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var p=this.m_system.m_positionBuffer.data[n],f=this.m_system.m_velocityBuffer.data[n],_=a,m=l;if(0===this.m_system.m_iterationIndex){var g=B.MulTXV(d.m_xf0,p,s);i.GetShape().GetType()===t.b2ShapeType.e_circleShape&&(g.SelfSub(d.GetLocalCenter()),O.MulRV(d.m_xf0.q,g,g),O.MulTRV(d.m_xf.q,g,g),g.SelfAdd(d.GetLocalCenter())),B.MulXV(d.m_xf,g,m.p1)}else m.p1.Copy(p);if(L.AddVMulSV(p,this.m_step.dt,f,m.p2),m.maxFraction=1,i.RayCast(_,m,r)){var y=_.normal,v=c;v.x=(1-_.fraction)*m.p1.x+_.fraction*m.p2.x+o*y.x,v.y=(1-_.fraction)*m.p1.y+_.fraction*m.p2.y+o*y.y;var b=h;b.x=this.m_step.inv_dt*(v.x-p.x),b.y=this.m_step.inv_dt*(v.y-p.y),this.m_system.m_velocityBuffer.data[n].Copy(b);var x=u;x.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(f.x-b.x),x.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(f.y-b.y),this.m_system.ParticleApplyForce(n,x)}},r.prototype.ReportParticle=function(){return!1},r.ReportFixtureAndParticle_s_p1=new L,r.ReportFixtureAndParticle_s_output=new xt,r.ReportFixtureAndParticle_s_input=new bt,r.ReportFixtureAndParticle_s_p=new L,r.ReportFixtureAndParticle_s_v=new L,r.ReportFixtureAndParticle_s_f=new L,r}(Br);e.SolveCollisionCallback=m}(t.b2ParticleSystem||(t.b2ParticleSystem={}));var Gr=function(){function e(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new sr,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new L,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new or,this.m_island=new gr,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}return e.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},e.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},e.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},e.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},e.prototype.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error;var e=new hi(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},e.prototype.DestroyBody=function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var r=t.m_controllerList;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Destroy(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount},e._Joint_Create=function(e){switch(e.type){case t.b2JointType.e_distanceJoint:return new mi(e);case t.b2JointType.e_mouseJoint:return new Ai(e);case t.b2JointType.e_prismaticJoint:return new Di(e);case t.b2JointType.e_revoluteJoint:return new Mi(e);case t.b2JointType.e_pulleyJoint:return new Ii(e);case t.b2JointType.e_gearJoint:return new Ti(e);case t.b2JointType.e_wheelJoint:return new Fi(e);case t.b2JointType.e_weldJoint:return new Ni(e);case t.b2JointType.e_frictionJoint:return new bi(e);case t.b2JointType.e_ropeJoint:return new Oi(e);case t.b2JointType.e_motorJoint:return new Si(e);case t.b2JointType.e_areaJoint:return new yi(e)}throw new Error},e._Joint_Destroy=function(){},e.prototype.CreateJoint=function(t){if(this.IsLocked())throw new Error;var i=e._Joint_Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var r=t.bodyA,n=t.bodyB;if(!t.collideConnected)for(var s=n.GetContactList();s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next;return i},e.prototype.DestroyJoint=function(t){if(this.IsLocked())throw new Error;var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var r=t.m_bodyA,n=t.m_bodyB;if(r.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===r.m_jointList&&(r.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,e._Joint_Destroy(t,null),--this.m_jointCount,!i)for(var s=n.GetContactList();s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next},e.prototype.CreateParticleSystem=function(e){if(this.IsLocked())throw new Error;var i=new t.b2ParticleSystem(e,this);return i.m_prev=null,i.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=i),this.m_particleSystemList=i,i},e.prototype.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)},e.prototype.CalculateReasonableParticleIterations=function(t){return null===this.m_particleSystemList?1:vr(this.m_gravity.Length(),function(t){for(var e=i,r=t.GetParticleSystemList();null!==r;r=r.m_next)e=_(e,r.GetRadius());return e}(this),t)},e.prototype.Step=function(t,i,r,n){void 0===n&&(n=this.CalculateReasonableParticleIterations(t));var s=e.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var o=e.Step_s_step;o.dt=t,o.velocityIterations=i,o.positionIterations=r,o.particleIterations=n,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;var a=e.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=a.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var l=e.Step_s_timer.Reset(),c=this.m_particleSystemList;c;c=c.m_next)c.Solve(o);this.Solve(o),this.m_profile.solve=l.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var h=e.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=h.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=s.GetMilliseconds()},e.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},e.prototype.DrawParticleSystem=function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),r=t.GetPositionBuffer();if(t.m_colorBuffer.data){var n=t.GetColorBuffer();this.m_debugDraw.DrawParticles(r,i,n,e)}else this.m_debugDraw.DrawParticles(r,i,null,e)}}},e.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var i=this.m_debugDraw.GetFlags(),r=e.DrawDebugData_s_color.SetRGB(0,0,0);if(i&t.b2DrawFlags.e_shapeBit)for(var n=this.m_bodyList;n;n=n.m_next){var s=n.m_xf;this.m_debugDraw.PushTransform(s);for(var o=n.GetFixtureList();o;o=o.m_next)n.IsActive()?n.GetType()===t.b2BodyType.b2_staticBody?(r.SetRGB(.5,.9,.5),this.DrawShape(o,r)):n.GetType()===t.b2BodyType.b2_kinematicBody?(r.SetRGB(.5,.5,.9),this.DrawShape(o,r)):n.IsAwake()?(r.SetRGB(.9,.7,.7),this.DrawShape(o,r)):(r.SetRGB(.6,.6,.6),this.DrawShape(o,r)):(r.SetRGB(.5,.5,.3),this.DrawShape(o,r));this.m_debugDraw.PopTransform(s)}if(i&t.b2DrawFlags.e_particleBit)for(var a=this.m_particleSystemList;a;a=a.m_next)this.DrawParticleSystem(a);if(i&t.b2DrawFlags.e_jointBit)for(var l=this.m_jointList;l;l=l.m_next)this.DrawJoint(l);if(i&t.b2DrawFlags.e_aabbBit){r.SetRGB(.9,.3,.9);var c=e.DrawDebugData_s_vs;for(n=this.m_bodyList;n;n=n.m_next)if(n.IsActive())for(o=n.GetFixtureList();o;o=o.m_next)for(var h=0;h<o.m_proxyCount;++h){var u=o.m_proxies[h].treeNode.aabb;c[0].Set(u.lowerBound.x,u.lowerBound.y),c[1].Set(u.upperBound.x,u.lowerBound.y),c[2].Set(u.upperBound.x,u.upperBound.y),c[3].Set(u.lowerBound.x,u.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,r)}}if(i&t.b2DrawFlags.e_centerOfMassBit)for(n=this.m_bodyList;n;n=n.m_next)(s=e.DrawDebugData_s_xf).q.Copy(n.m_xf.q),s.p.Copy(n.GetWorldCenter()),this.m_debugDraw.DrawTransform(s);if(i&t.b2DrawFlags.e_controllerBit)for(var d=this.m_controllerList;d;d=d.m_next)d.Draw(this.m_debugDraw)}},e.prototype.QueryAABB=function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof rr)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryAABB(t,e)},e.prototype.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(null,t,(function(t){return e.push(t),!0})),e},e.prototype.QueryPointAABB=function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof rr)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)},e.prototype.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(null,t,(function(t){return e.push(t),!0})),e},e.prototype.QueryFixtureShape=function(t,i,r,n,s){var o=e.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,n,r),this.m_contactManager.m_broadPhase.Query(o,(function(e){var o=e.userData,a=o.fixture;if(Dt(i,r,a.GetShape(),o.childIndex,n,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(s)return s(a)}return!0})),t instanceof rr)for(var a=this.m_particleSystemList;a;a=a.m_next)t.ShouldQueryParticleSystem(a)&&a.QueryAABB(t,o)},e.prototype.QueryAllFixtureShape=function(t,e,i,r){return void 0===r&&(r=[]),this.QueryFixtureShape(null,t,e,i,(function(t){return r.push(t),!0})),r},e.prototype.QueryFixturePoint=function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(r){var n=r.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0})),t)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)},e.prototype.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(null,t,(function(t){return e.push(t),!0})),e},e.prototype.RayCast=function(t,i,r,n){var s=e.RayCast_s_input;if(s.maxFraction=1,s.p1.Copy(i),s.p2.Copy(r),this.m_contactManager.m_broadPhase.RayCast(s,(function(s,o){var a=o.userData,l=a.fixture,c=a.childIndex,h=e.RayCast_s_output;if(l.RayCast(h,s,c)){var u=h.fraction,d=e.RayCast_s_point;if(d.Set((1-u)*i.x+u*r.x,(1-u)*i.y+u*r.y),t)return t.ReportFixture(l,d,h.normal,u);if(n)return n(l,d,h.normal,u)}return s.maxFraction})),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.RayCast(t,i,r)},e.prototype.RayCastOne=function(t,e){var i=null,r=1;return this.RayCast(null,t,e,(function(t,e,n,s){return s<r&&(r=s,i=t),r})),i},e.prototype.RayCastAll=function(t,e,i){return void 0===i&&(i=[]),this.RayCast(null,t,e,(function(t){return i.push(t),1})),i},e.prototype.GetBodyList=function(){return this.m_bodyList},e.prototype.GetJointList=function(){return this.m_jointList},e.prototype.GetParticleSystemList=function(){return this.m_particleSystemList},e.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},e.prototype.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},e.prototype.GetAllowSleeping=function(){return this.m_allowSleep},e.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},e.prototype.GetWarmStarting=function(){return this.m_warmStarting},e.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},e.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},e.prototype.SetSubStepping=function(t){this.m_subStepping=t},e.prototype.GetSubStepping=function(){return this.m_subStepping},e.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},e.prototype.GetBodyCount=function(){return this.m_bodyCount},e.prototype.GetJointCount=function(){return this.m_jointCount},e.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},e.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},e.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},e.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},e.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),!L.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)},e.prototype.GetGravity=function(){return this.m_gravity},e.prototype.IsLocked=function(){return this.m_locked},e.prototype.SetAutoClearForces=function(t){this.m_clearForces=t},e.prototype.GetAutoClearForces=function(){return this.m_clearForces},e.prototype.ShiftOrigin=function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)},e.prototype.GetContactManager=function(){return this.m_contactManager},e.prototype.GetProfile=function(){return this.m_profile},e.prototype.Dump=function(e){if(!this.m_locked){e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");for(var i=0,r=this.m_bodyList;r;r=r.m_next)r.m_islandIndex=i,r.Dump(e),++i;i=0;for(var n=this.m_jointList;n;n=n.m_next)n.m_index=i,++i;for(n=this.m_jointList;n;n=n.m_next)n.m_type!==t.b2JointType.e_gearJoint&&(e("{\n"),n.Dump(e),e("}\n"));for(n=this.m_jointList;n;n=n.m_next)n.m_type===t.b2JointType.e_gearJoint&&(e("{\n"),n.Dump(e),e("}\n"))}},e.prototype.DrawJoint=function(i){if(null!==this.m_debugDraw){var r=i.GetBodyA(),n=i.GetBodyB(),s=r.m_xf,o=n.m_xf,a=s.p,l=o.p,c=i.GetAnchorA(e.DrawJoint_s_p1),h=i.GetAnchorB(e.DrawJoint_s_p2),u=e.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(i.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(c,h,u);break;case t.b2JointType.e_pulleyJoint:var d=i,p=d.GetGroundAnchorA(),f=d.GetGroundAnchorB();this.m_debugDraw.DrawSegment(p,c,u),this.m_debugDraw.DrawSegment(f,h,u),this.m_debugDraw.DrawSegment(p,f,u);break;case t.b2JointType.e_mouseJoint:var _=e.DrawJoint_s_c;_.Set(0,1,0),this.m_debugDraw.DrawPoint(c,4,_),this.m_debugDraw.DrawPoint(h,4,_),_.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(c,h,_);break;default:this.m_debugDraw.DrawSegment(a,c,u),this.m_debugDraw.DrawSegment(c,h,u),this.m_debugDraw.DrawSegment(l,h,u)}}},e.prototype.DrawShape=function(i,r){if(null!==this.m_debugDraw){var n=i.GetShape();switch(n.m_type){case t.b2ShapeType.e_circleShape:var s=n,o=s.m_p,a=s.m_radius,l=L.UNITX;this.m_debugDraw.DrawSolidCircle(o,a,l,r);break;case t.b2ShapeType.e_edgeShape:var c=n,h=c.m_vertex1,u=c.m_vertex2;this.m_debugDraw.DrawSegment(h,u,r);break;case t.b2ShapeType.e_chainShape:var d=n,p=d.m_count,f=d.m_vertices,_=e.DrawShape_s_ghostColor.SetRGBA(.75*r.r,.75*r.g,.75*r.b,r.a);if(h=f[0],this.m_debugDraw.DrawPoint(h,4,r),d.m_hasPrevVertex){var m=d.m_prevVertex;this.m_debugDraw.DrawSegment(m,h,_),this.m_debugDraw.DrawCircle(m,.1,_)}for(var g=1;g<p;++g)u=f[g],this.m_debugDraw.DrawSegment(h,u,r),this.m_debugDraw.DrawPoint(u,4,r),h=u;if(d.m_hasNextVertex){var y=d.m_nextVertex;this.m_debugDraw.DrawSegment(y,h,_),this.m_debugDraw.DrawCircle(y,.1,_)}break;case t.b2ShapeType.e_polygonShape:var v=n,b=v.m_count;f=v.m_vertices,this.m_debugDraw.DrawSolidPolygon(f,b,r)}}},e.prototype.Solve=function(e){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf0.Copy(i.m_xf);for(var r=this.m_controllerList;r;r=r.m_next)r.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var n=this.m_island;for(n.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener),i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var a=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&l.GetType()!==t.b2BodyType.b2_staticBody){n.Clear();var c=0;for(a[c++]=l,l.m_islandFlag=!0;c>0;){if(!(i=a[--c]))throw new Error;if(n.AddBody(i),i.m_awakeFlag=!0,i.GetType()!==t.b2BodyType.b2_staticBody){for(var h=i.m_contactList;h;h=h.next){var u=h.contact;if(!u.m_islandFlag&&u.IsEnabled()&&u.IsTouching()){var d=u.m_fixtureA.m_isSensor,p=u.m_fixtureB.m_isSensor;if(!d&&!p){if(n.AddContact(u),u.m_islandFlag=!0,!(_=h.other))throw new Error;_.m_islandFlag||(a[c++]=_,_.m_islandFlag=!0)}}}for(var f=i.m_jointList;f;f=f.next){var _;f.joint.m_islandFlag||(_=f.other).IsActive()&&(n.AddJoint(f.joint),f.joint.m_islandFlag=!0,_.m_islandFlag||(a[c++]=_,_.m_islandFlag=!0))}}}var m=new or;n.Solve(m,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=m.solveInit,this.m_profile.solveVelocity+=m.solveVelocity,this.m_profile.solvePosition+=m.solvePosition;for(var g=0;g<n.m_bodyCount;++g)(i=n.m_bodies[g]).GetType()===t.b2BodyType.b2_staticBody&&(i.m_islandFlag=!1)}for(g=0;g<a.length&&a[g];++g)a[g]=null;var y=new V;for(i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag&&i.GetType()!==t.b2BodyType.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=y.GetMilliseconds()},e.prototype.SolveTOI=function(i){var r=this.m_island;if(r.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1,n.m_sweep.alpha0=0;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){var o=null,a=1;for(s=this.m_contactManager.m_contactList;s;s=s.m_next)if(s.IsEnabled()&&!(s.m_toiCount>8)){var l=1;if(s.m_toiFlag)l=s.m_toi;else{var c=s.GetFixtureA(),h=s.GetFixtureB();if(c.IsSensor()||h.IsSensor())continue;var u=c.GetBody(),d=h.GetBody(),p=u.m_type,f=d.m_type,m=u.IsAwake()&&p!==t.b2BodyType.b2_staticBody,g=d.IsAwake()&&f!==t.b2BodyType.b2_staticBody;if(!m&&!g)continue;var y=u.IsBullet()||p!==t.b2BodyType.b2_dynamicBody,v=d.IsBullet()||f!==t.b2BodyType.b2_dynamicBody;if(!y&&!v)continue;var b=u.m_sweep.alpha0;u.m_sweep.alpha0<d.m_sweep.alpha0?(b=d.m_sweep.alpha0,u.m_sweep.Advance(b)):d.m_sweep.alpha0<u.m_sweep.alpha0&&(b=u.m_sweep.alpha0,d.m_sweep.Advance(b));var x=s.GetChildIndexA(),T=s.GetChildIndexB(),C=e.SolveTOI_s_toi_input;C.proxyA.SetShape(c.GetShape(),x),C.proxyB.SetShape(h.GetShape(),T),C.sweepA.Copy(u.m_sweep),C.sweepB.Copy(d.m_sweep),C.tMax=1;var S=e.SolveTOI_s_toi_output;ie(S,C);var w=S.t;l=S.state===t.b2TOIOutputState.e_touching?_(b+(1-b)*w,1):1,s.m_toi=l,s.m_toiFlag=!0}l<a&&(o=s,a=l)}if(null===o||.9999<a){this.m_stepComplete=!0;break}var A=o.GetFixtureA(),E=o.GetFixtureB(),D=A.GetBody(),L=E.GetBody(),I=e.SolveTOI_s_backup1.Copy(D.m_sweep),P=e.SolveTOI_s_backup2.Copy(L.m_sweep);if(D.Advance(a),L.Advance(a),o.Update(this.m_contactManager.m_contactListener),o.m_toiFlag=!1,++o.m_toiCount,o.IsEnabled()&&o.IsTouching()){D.SetAwake(!0),L.SetAwake(!0),r.Clear(),r.AddBody(D),r.AddBody(L),r.AddContact(o),D.m_islandFlag=!0,L.m_islandFlag=!0,o.m_islandFlag=!0;for(var M=0;M<2;++M)if((j=0===M?D:L).m_type===t.b2BodyType.b2_dynamicBody)for(var R=j.m_contactList;R&&r.m_bodyCount!==r.m_bodyCapacity&&r.m_contactCount!==r.m_contactCapacity;R=R.next){var O=R.contact;if(!O.m_islandFlag){var B=R.other;if(B.m_type!==t.b2BodyType.b2_dynamicBody||j.IsBullet()||B.IsBullet()){var N=O.m_fixtureA.m_isSensor,k=O.m_fixtureB.m_isSensor;if(!N&&!k){var F=e.SolveTOI_s_backup.Copy(B.m_sweep);B.m_islandFlag||B.Advance(a),O.Update(this.m_contactManager.m_contactListener),O.IsEnabled()&&O.IsTouching()?(O.m_islandFlag=!0,r.AddContact(O),B.m_islandFlag||(B.m_islandFlag=!0,B.m_type!==t.b2BodyType.b2_staticBody&&B.SetAwake(!0),r.AddBody(B))):(B.m_sweep.Copy(F),B.SynchronizeTransform())}}}}var V=e.SolveTOI_s_subStep;for(V.dt=(1-a)*i.dt,V.inv_dt=1/V.dt,V.dtRatio=1,V.positionIterations=20,V.velocityIterations=i.velocityIterations,V.particleIterations=i.particleIterations,V.warmStarting=!1,r.SolveTOI(V,D.m_islandIndex,L.m_islandIndex),M=0;M<r.m_bodyCount;++M){var j;if((j=r.m_bodies[M]).m_islandFlag=!1,j.m_type===t.b2BodyType.b2_dynamicBody)for(j.SynchronizeFixtures(),R=j.m_contactList;R;R=R.next)R.contact.m_toiFlag=!1,R.contact.m_islandFlag=!1}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else o.SetEnabled(!1),D.m_sweep.Copy(I),L.m_sweep.Copy(P),D.SynchronizeTransform(),L.SynchronizeTransform()}},e.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},e.prototype.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t},e.Step_s_step=new ar,e.Step_s_stepTimer=new V,e.Step_s_timer=new V,e.DrawDebugData_s_color=new k(0,0,0),e.DrawDebugData_s_vs=L.MakeArray(4),e.DrawDebugData_s_xf=new B,e.QueryFixtureShape_s_aabb=new Tt,e.RayCast_s_input=new bt,e.RayCast_s_output=new xt,e.RayCast_s_point=new L,e.DrawJoint_s_p1=new L,e.DrawJoint_s_p2=new L,e.DrawJoint_s_color=new k(.5,.8,.8),e.DrawJoint_s_c=new k,e.DrawShape_s_ghostColor=new k,e.SolveTOI_s_subStep=new ar,e.SolveTOI_s_backup=new N,e.SolveTOI_s_backup1=new N,e.SolveTOI_s_backup2=new N,e.SolveTOI_s_toi_input=new Yt,e.SolveTOI_s_toi_output=new Xt,e}(),Ur=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e},Yr=function(){function t(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return t.prototype.GetNext=function(){return this.m_next},t.prototype.GetPrev=function(){return this.m_prev},t.prototype.GetBodyList=function(){return this.m_bodyList},t.prototype.AddBody=function(t){var e=new Ur(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount},t.prototype.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount},t.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},t}(),Hr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normal=new L(0,1),e.offset=0,e.density=0,e.velocity=new L(0,0),e.linearDrag=0,e.angularDrag=0,e.useDensity=!1,e.useWorldGravity=!0,e.gravity=new L(0,0),e}return Qe(e,t),e.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()){for(var i=new L,n=new L,s=0,o=0,a=e.GetFixtureList();a;a=a.m_next){var l,c=new L,h=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),c);s+=h,i.x+=h*c.x,i.y+=h*c.y,o+=h*(l=this.useDensity?a.GetDensity():1),n.x+=h*c.x*l,n.y+=h*c.y*l}if(i.x/=s,i.y/=s,n.x/=o,n.y/=o,!(s<r)){var u=this.gravity.Clone().SelfNeg();u.SelfMul(this.density*s),e.ApplyForce(u,n);var d=e.GetLinearVelocityFromWorldPoint(i,new L);d.SelfSub(this.velocity),d.SelfMul(-this.linearDrag*s),e.ApplyForce(d,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag)}}}}},e.prototype.Draw=function(t){var e=100,i=new L,r=new L;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,r.x=this.normal.x*this.offset-this.normal.y*e,r.y=this.normal.y*this.offset+this.normal.x*e;var n=new k(0,0,.8);t.DrawSegment(i,r,n)},e}(Yr),Xr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.A=new L(0,0),e}return Qe(e,t),e.prototype.Step=function(t){for(var i=L.MulSV(t.dt,this.A,e.Step_s_dtA),r=this.m_bodyList;r;r=r.nextBody){var n=r.body;n.IsAwake()&&n.SetLinearVelocity(L.AddVV(n.GetLinearVelocity(),i,L.s_t0))}},e.prototype.Draw=function(){},e.Step_s_dtA=new L,e}(Yr),zr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.F=new L(0,0),e}return Qe(e,t),e.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},e.prototype.Draw=function(){},e}(Yr),Wr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.G=1,e.invSqr=!0,e}return Qe(e,t),e.prototype.Step=function(){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var i=(l=t.body).GetWorldCenter(),n=l.GetMass(),s=this.m_bodyList;s&&s!==t;s=s.nextBody){var o=(c=s.body).GetWorldCenter(),a=c.GetMass();(d=(h=o.x-i.x)*h+(u=o.y-i.y)*u)<r||((p=e.Step_s_f.Set(h,u)).SelfMul(this.G/d/T(d)*n*a),l.IsAwake()&&l.ApplyForce(p,i),c.IsAwake()&&c.ApplyForce(p.SelfMul(-1),o))}else for(t=this.m_bodyList;t;t=t.nextBody){var l;for(i=(l=t.body).GetWorldCenter(),n=l.GetMass(),s=this.m_bodyList;s&&s!==t;s=s.nextBody){var c,h,u,d,p;o=(c=s.body).GetWorldCenter(),a=c.GetMass(),(d=(h=o.x-i.x)*h+(u=o.y-i.y)*u)<r||((p=e.Step_s_f.Set(h,u)).SelfMul(this.G/d*n*a),l.IsAwake()&&l.ApplyForce(p,i),c.IsAwake()&&c.ApplyForce(p.SelfMul(-1),o))}}},e.prototype.Draw=function(){},e.Step_s_f=new L,e}(Yr),Zr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.T=new M,e.maxTimestep=0,e}return Qe(e,t),e.prototype.Step=function(t){var i=t.dt;if(!(i<=r)){i>this.maxTimestep&&this.maxTimestep>0&&(i=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var o=s.GetWorldVector(M.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity(),L.s_t0),L.s_t1),e.Step_s_damping);s.SetLinearVelocity(L.AddVV(s.GetLinearVelocity(),L.MulSV(i,o,L.s_t0),L.s_t1))}}}},e.prototype.Draw=function(){},e.prototype.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/m(t,e):0},e.Step_s_damping=new L,e}(Yr),Jr=function(){function t(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new L,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return t.prototype.GetVertexCount=function(){return this.m_count},t.prototype.GetVertices=function(){return this.m_ps},t.prototype.Initialize=function(t){this.m_count=t.count,this.m_ps=L.MakeArray(this.m_count),this.m_p0s=L.MakeArray(this.m_count),this.m_vs=L.MakeArray(this.m_count),this.m_ims=p(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var r=this.m_count-1,n=this.m_count-2;for(this.m_Ls=p(r),this.m_as=p(n),e=0;e<r;++e){var s=this.m_ps[e],o=this.m_ps[e+1];this.m_Ls[e]=L.DistanceVV(s,o)}for(e=0;e<n;++e){s=this.m_ps[e],o=this.m_ps[e+1];var a=this.m_ps[e+2],l=L.SubVV(o,s,L.s_t0),c=L.SubVV(a,o,L.s_t1),h=L.CrossVV(l,c),u=L.DotVV(l,c);this.m_as[e]=D(h,u)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},t.prototype.Step=function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),this.m_ims[r]>0&&this.m_vs[r].SelfMulAdd(t,this.m_gravity),this.m_vs[r].SelfMul(i),this.m_ps[r].SelfMulAdd(t,this.m_vs[r]);for(r=0;r<e;++r)this.SolveC2(),this.SolveC3(),this.SolveC2();var n=1/t;for(r=0;r<this.m_count;++r)L.MulSV(n,L.SubVV(this.m_ps[r],this.m_p0s[r],L.s_t0),this.m_vs[r])}},t.prototype.SolveC2=function(){for(var e=this.m_count-1,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],s=L.SubVV(n,r,t.s_d),o=s.Normalize(),a=this.m_ims[i],l=this.m_ims[i+1];if(a+l!==0){var c=a/(a+l),h=l/(a+l);r.SelfMulSub(this.m_k2*c*(this.m_Ls[i]-o),s),n.SelfMulAdd(this.m_k2*h*(this.m_Ls[i]-o),s)}}},t.prototype.SetAngle=function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},t.prototype.SolveC3=function(){for(var e=this.m_count-2,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],o=this.m_ps[i+2],a=this.m_ims[i],l=this.m_ims[i+1],c=this.m_ims[i+2],h=L.SubVV(n,r,t.s_d1),u=L.SubVV(o,n,t.s_d2),d=h.LengthSquared(),p=u.LengthSquared();if(d*p!=0){var f=L.CrossVV(h,u),_=L.DotVV(h,u),m=D(f,_),g=L.MulSV(-1/d,h.SelfSkew(),t.s_Jd1),y=L.MulSV(1/p,u.SelfSkew(),t.s_Jd2),v=L.NegV(g,t.s_J1),b=L.SubVV(g,y,t.s_J2),x=y,T=a*L.DotVV(v,v)+l*L.DotVV(b,b)+c*L.DotVV(x,x);if(0!==T){T=1/T;for(var C=m-this.m_as[i];C>s;)C=(m-=2*s)-this.m_as[i];for(;C<-s;)C=(m+=2*s)-this.m_as[i];var S=-this.m_k3*T*C;r.SelfMulAdd(a*S,v),n.SelfMulAdd(l*S,b),o.SelfMulAdd(c*S,x)}}}},t.prototype.Draw=function(t){for(var e=new k(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},t.s_d=new L,t.s_d1=new L,t.s_d2=new L,t.s_Jd1=new L,t.s_Jd2=new L,t.s_J1=new L,t.s_J2=new L,t}();t.b2Assert=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t)throw new(Error.bind.apply(Error,[void 0].concat(e)))},t.b2Maybe=e,t.b2_maxFloat=i,t.b2_epsilon=r,t.b2_epsilon_sq=n,t.b2_pi=s,t.b2_maxManifoldPoints=2,t.b2_maxPolygonVertices=8,t.b2_aabbExtension=.1,t.b2_aabbMultiplier=2,t.b2_linearSlop=o,t.b2_angularSlop=a,t.b2_polygonRadius=l,t.b2_maxSubSteps=8,t.b2_maxTOIContacts=32,t.b2_velocityThreshold=1,t.b2_maxLinearCorrection=.2,t.b2_maxAngularCorrection=.13962634015955555,t.b2_maxTranslation=2,t.b2_maxTranslationSquared=4,t.b2_maxRotation=1.570796326795,t.b2_maxRotationSquared=2.4674011002726646,t.b2_baumgarte=.2,t.b2_toiBaumgarte=.75,t.b2_invalidParticleIndex=c,t.b2_maxParticleIndex=2147483647,t.b2_particleStride=.75,t.b2_minParticleWeight=1,t.b2_maxParticlePressure=.25,t.b2_maxParticleForce=.5,t.b2_maxTriadDistance=2,t.b2_maxTriadDistanceSquared=4,t.b2_minParticleSystemBufferCapacity=256,t.b2_barrierCollisionTime=2.5,t.b2_timeToSleep=.5,t.b2_linearSleepTolerance=.01,t.b2_angularSleepTolerance=.03490658503988889,t.b2Alloc=function(){return null},t.b2Free=function(){},t.b2Log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},t.b2Version=h,t.b2_version=u,t.b2_branch="master",t.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",t.b2ParseInt=function(t){return parseInt(t,10)},t.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},t.b2MakeArray=d,t.b2MakeNullArray=function(t){for(var e=[],i=0;i<t;++i)e.push(null);return e},t.b2MakeNumberArray=p,t.b2_pi_over_180=.017453292519944444,t.b2_180_over_pi=57.29577951307855,t.b2_two_pi=6.28318530718,t.b2Abs=f,t.b2Min=_,t.b2Max=m,t.b2Clamp=g,t.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},t.b2IsValid=y,t.b2Sq=v,t.b2InvSqrt=b,t.b2Sqrt=T,t.b2Pow=C,t.b2DegToRad=function(t){return.017453292519944444*t},t.b2RadToDeg=function(t){return 57.29577951307855*t},t.b2Cos=S,t.b2Sin=w,t.b2Acos=A,t.b2Asin=E,t.b2Atan2=D,t.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,1+((t|=t>>8&16777215)|t>>16&65535)},t.b2IsPowerOfTwo=function(t){return t>0&&!(t&t-1)},t.b2Random=function(){return 2*Math.random()-1},t.b2RandomRange=function(t,e){return(e-t)*Math.random()+t},t.b2Vec2=L,t.b2Vec2_zero=I,t.b2Vec3=P,t.b2Mat22=M,t.b2Mat33=R,t.b2Rot=O,t.b2Transform=B,t.b2Sweep=N,t.b2Color=k,t.b2Draw=F,t.b2Timer=V,t.b2Counter=j,t.b2GrowableStack=G,t.b2BlockAllocator=function(){},t.b2StackAllocator=function(){},t.b2ContactFeature=pt,t.b2ContactID=ft,t.b2ManifoldPoint=_t,t.b2Manifold=gt,t.b2WorldManifold=yt,t.b2GetPointStates=function(e,i,r,n){var s;for(s=0;s<r.pointCount;++s){var o=r.points[s].id.key;e[s]=t.b2PointState.b2_removeState;for(var a=0,l=n.pointCount;a<l;++a)if(n.points[a].id.key===o){e[s]=t.b2PointState.b2_persistState;break}}for(;s<2;++s)e[s]=t.b2PointState.b2_nullState;for(s=0;s<n.pointCount;++s)for(o=n.points[s].id.key,i[s]=t.b2PointState.b2_addState,a=0,l=r.pointCount;a<l;++a)if(r.points[a].id.key===o){i[s]=t.b2PointState.b2_persistState;break}for(;s<2;++s)i[s]=t.b2PointState.b2_nullState},t.b2ClipVertex=vt,t.b2RayCastInput=bt,t.b2RayCastOutput=xt,t.b2AABB=Tt,t.b2TestOverlapAABB=Ct,t.b2ClipSegmentToLine=St,t.b2TestOverlapShape=Dt,t.b2DistanceProxy=U,t.b2SimplexCache=Y,t.b2DistanceInput=H,t.b2DistanceOutput=X,t.b2ShapeCastInput=function(){this.proxyA=new U,this.proxyB=new U,this.transformA=new B,this.transformB=new B,this.translationB=new L},t.b2ShapeCastOutput=function(){this.point=new L,this.normal=new L,this.lambda=0,this.iterations=0},t.b2_gjk_reset=function(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0},t.b2SimplexVertex=z,t.b2Simplex=W,t.b2Distance=it,t.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,r=e.proxyB,n=m(i.m_radius,l)+m(r.m_radius,l),s=e.transformA,o=e.transformB,a=e.translationB,c=nt.Set(0,0),h=0,u=st;u.m_count=0;for(var d=u.m_vertices,p=i.GetSupport(O.MulTRV(s.q,L.NegV(a,L.s_t1),L.s_t0)),_=B.MulXV(s,i.GetVertex(p),ot),g=r.GetSupport(O.MulTRV(o.q,a,L.s_t0)),y=B.MulXV(o,r.GetVertex(g),at),v=L.SubVV(_,y,lt),b=m(l,n-l),x=0;x<20&&f(v.Length()-b)>.004;){t.iterations+=1,p=i.GetSupport(O.MulTRV(s.q,L.NegV(v,L.s_t1),L.s_t0)),_=B.MulXV(s,i.GetVertex(p),ot),g=r.GetSupport(O.MulTRV(o.q,v,L.s_t0)),y=B.MulXV(o,r.GetVertex(g),at);var T=L.SubVV(_,y,ct);v.Normalize();var C=L.DotVV(v,T),S=L.DotVV(v,a);if(C-b>h*S){if(S<=0)return!1;if((h=(C-b)/S)>1)return!1;c.Copy(v).SelfNeg(),u.m_count=0}var w=d[u.m_count];switch(w.indexA=g,w.wA.Copy(y).SelfMulAdd(h,a),w.indexB=p,w.wB.Copy(_),w.w.Copy(w.wB).SelfSub(w.wA),w.a=1,u.m_count+=1,u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3()}if(3===u.m_count)return!1;u.GetClosestPoint(v),++x}var A=ht,E=ut;return u.GetWitnessPoints(A,E),v.LengthSquared()>0&&(c.Copy(v).SelfNeg(),c.Normalize()),t.normal.Copy(c),t.lambda=h,t.iterations=x,!0},t.b2Pair=Mt,t.b2BroadPhase=Rt,t.b2PairLessThan=Ot,t.b2TreeNode=It,t.b2DynamicTree=Pt,t.b2_toi_reset=function(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0},t.b2TOIInput=Yt,t.b2TOIOutput=Xt,t.b2SeparationFunction=zt,t.b2TimeOfImpact=ie,t.b2CollideCircles=se,t.b2CollidePolygonAndCircle=ce,t.b2CollidePolygons=Re,t.b2CollideEdgeAndCircle=Ue,t.b2CollideEdgeAndPolygon=We,t.b2MassData=Je,t.b2Shape=qe,t.b2CircleShape=ti,t.b2PolygonShape=ei,t.b2EdgeShape=ii,t.b2ChainShape=ri,t.b2Filter=ni,t.b2FixtureDef=si,t.b2FixtureProxy=oi,t.b2Fixture=ai,t.b2BodyDef=function(){this.type=t.b2BodyType.b2_staticBody,this.position=new L(0,0),this.angle=0,this.linearVelocity=new L(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1},t.b2Body=hi,t.b2World=Gr,t.b2DestructionListener=$i,t.b2ContactFilter=tr,t.b2ContactImpulse=er,t.b2ContactListener=ir,t.b2QueryCallback=rr,t.b2RayCastCallback=nr,t.b2Island=gr,t.b2Profile=or,t.b2TimeStep=ar,t.b2Position=lr,t.b2Velocity=cr,t.b2SolverData=hr,t.b2ContactManager=sr,t.b2MixFriction=Vi,t.b2MixRestitution=ji,t.b2ContactEdge=Ui,t.b2Contact=Yi,t.b2ContactRegister=Ki,t.b2ContactFactory=Qi,t.g_blockSolve=!1,t.b2VelocityConstraintPoint=ur,t.b2ContactVelocityConstraint=dr,t.b2ContactPositionConstraint=pr,t.b2ContactSolverDef=fr,t.b2PositionSolverManifold=_r,t.b2ContactSolver=mr,t.b2CircleContact=Hi,t.b2PolygonContact=Xi,t.b2PolygonAndCircleContact=zi,t.b2EdgeAndCircleContact=Wi,t.b2EdgeAndPolygonContact=Zi,t.b2ChainAndCircleContact=Ji,t.b2ChainAndPolygonContact=qi,t.b2Jacobian=ui,t.b2JointEdge=di,t.b2JointDef=pi,t.b2Joint=fi,t.b2AreaJointDef=gi,t.b2AreaJoint=yi,t.b2DistanceJointDef=_i,t.b2DistanceJoint=mi,t.b2FrictionJointDef=vi,t.b2FrictionJoint=bi,t.b2GearJointDef=xi,t.b2GearJoint=Ti,t.b2MotorJointDef=Ci,t.b2MotorJoint=Si,t.b2MouseJointDef=wi,t.b2MouseJoint=Ai,t.b2PrismaticJointDef=Ei,t.b2PrismaticJoint=Di,t.b2_minPulleyLength=2,t.b2PulleyJointDef=Li,t.b2PulleyJoint=Ii,t.b2RevoluteJointDef=Pi,t.b2RevoluteJoint=Mi,t.b2RopeJointDef=Ri,t.b2RopeJoint=Oi,t.b2WeldJointDef=Bi,t.b2WeldJoint=Ni,t.b2WheelJointDef=ki,t.b2WheelJoint=Fi,t.b2ControllerEdge=Ur,t.b2Controller=Yr,t.b2BuoyancyController=Hr,t.b2ConstantAccelController=Xr,t.b2ConstantForceController=zr,t.b2GravityController=Wr,t.b2TensorDampingController=Zr,t.b2ParticleDef=yr,t.b2CalculateParticleIterations=vr,t.b2ParticleHandle=xr,t.b2ParticleGroupDef=Tr,t.b2ParticleGroup=Cr,t.b2GrowableBuffer=Or,t.b2FixtureParticleQueryCallback=Br,t.b2ParticleContact=Nr,t.b2ParticleBodyContact=kr,t.b2ParticlePair=Fr,t.b2ParticleTriad=Vr,t.b2ParticleSystemDef=jr,t.b2RopeDef=function(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new L(0,0),this.damping=.1,this.k2=.9,this.k3=.1},t.b2Rope=Jr,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof i&&void 0!==e?r(i):"function"==typeof define&&define.amd?define(["exports"],r):r((void 0).box2d={})},{}],382:[function(t,e){var i="undefined"==typeof window?global:window;i.cc=i.cc||{},cc.internal=cc.internal||{},t("./predefine"),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/object"),t("./polyfill/array-buffer"),t("./polyfill/number"),t("./polyfill/typescript"),t("./cocos2d/core/predefine"),t("./cocos2d"),t("./extends"),e.exports=i.cc},{"./cocos2d":299,"./cocos2d/core/predefine":221,"./extends":357,"./package":void 0,"./polyfill/array":384,"./polyfill/array-buffer":383,"./polyfill/misc":385,"./polyfill/number":386,"./polyfill/object":387,"./polyfill/string":388,"./polyfill/typescript":void 0,"./predefine":389}],383:[function(){if(!ArrayBuffer.isView){var t=Object.getPrototypeOf(Int8Array);ArrayBuffer.isView="function"==typeof t?function(e){return e instanceof t}:function(t){if("object"!=typeof t)return!1;var e=t.constructor;return e===Float64Array||e===Float32Array||e===Uint8Array||e===Uint32Array||e===Int8Array}}},{}],384:[function(){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.find||(Array.prototype.find=function(t){for(var e=this.length,i=0;i<e;i++){var r=this[i];if(t.call(this,r,i,this))return r}}),Array.prototype.includes||(Array.prototype.includes=function(t){return-1!==this.indexOf(t)})},{}],385:[function(){if(Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),!console.time){var t=window.performance||Date,e=Object.create(null);console.time=function(i){e[i]=t.now()},console.timeEnd=function(i){var r=e[i],n=t.now()-r;console.log(i+": "+n+"ms")}}},{}],386:[function(){Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt},{}],387:[function(){Object.assign||(Object.assign=function(t,e){return cc.js.mixin(t,e)}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(t){var e={},i=Object.getOwnPropertyNames(t);Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t)));for(var r=0;r<i.length;++r){var n=i[r];e[n]=Object.getOwnPropertyDescriptor(t,n)}return e})},{}],388:[function(){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return-1!==i&&i===e}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")})},{}],389:[function(){var t="undefined"==typeof window?global:window;function e(e,i){void 0===t[e]&&Object.defineProperty(t,e,{get:function(){var t;return"CC_WECHATGAMESUB"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===e&&(t="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,e,t),i}})}function i(e){return"object"==typeof t[e]}(function(e){void 0===t[e]&&(t[e]=!1)})("CC_BUILD"),t.CC_BUILD=!0,t.CC_DEV=!1,t.CC_DEBUG=!1,t.CC_JSB=!1,t.CC_NATIVERENDERER=!1,t.CC_SUPPORT_JIT=!0,t.CC_PHYSICS_BUILTIN=!1,t.CC_PHYSICS_CANNON=!1,t.CC_EDITOR=!1,t.CC_PREVIEW=!1,t.CC_TEST=!1,t.CC_RUNTIME=!1,t.CC_JSB=!1;var r=!(!i("wx")||!wx.getSharedCanvas),n=!(!i("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas),s=i("bk");e("CC_WECHATGAMESUB",r),e("CC_WECHATGAME",n),e("CC_QQPLAY",s),t.CocosEngine=cc.ENGINE_VERSION="2.4.13"},{}]},{},[382]);var CodeNodeLg=cc.Class({name:"CodeNodeLg",extends:cc.Component,properties:{curve:null,onAssstLoadCb:null,bezierScale:1,assestLoaded:!0,t:{get(){return this._t},set(t){if(t>1&&(t=1),t<0&&(t=0),this._t=t,null!=this.curve){var e=this.curve.get(t);if(this.x=e.x*this.bezierScale,this.y=e.y*this.bezierScale,1==this.lookUp){var i=this.curve.derivative(t),r=Math.atan2(i.y,i.x)*(180/Math.PI);this.angle=r}}}},_t:0,nodeName:{get(){return this.node.name},set(t){this.node.name=t}},src:{get(){return 4==this.modal?this.string:this.customeName},set(t){this.node.name=t}},_modal:"",modal:{get(){return this._modal},set(t){this._modal!=t&&(this._modal=t,null!=this.sprite?(this.node.removeComponent(cc.Sprite),this.sprite=null):null!=this.spineCom?(this.node.removeComponent(sp.Skeleton),this.spineCom=null):null!=this.label&&(this.node.removeComponent(cc.Label),this.label=null),t==ObjectTypeEnum.spine?this.spineCom=this.node.addComponent(sp.Skeleton):t==ObjectTypeEnum.text?this.label=this.node.addComponent(cc.Label):t==ObjectTypeEnum.sprite&&(this.sprite=this.node.addComponent(cc.Sprite)))}},customeName:{get(){return this._customeName},set(t){if(this._customeName!=t){let e=t;-1!=e.indexOf("/")&&(e=e.split("/"),e=e[e.length-1]),-1!=e.indexOf(".")&&(e=e.split(".")[0]),this.node.name=e,this.modal==ObjectTypeEnum.sprite?null!=this.sprite&&(this.assestLoaded=!1,cc.assetManager.loadRemote(rootHost+"/"+t,((t,e)=>{1==cc.isValid(this.node)&&null!=e&&null!=this.sprite&&(this.sprite.spriteFrame=new cc.SpriteFrame(e)),this.assestLoaded=!0,null!=this.onAssstLoadCb&&this.onAssstLoadCb()}))):this.modal==ObjectTypeEnum.spine?null!=this.spineCom&&(this.assestLoaded=!1,loadNetSpine(t,(t=>{null!=t&&cc.isValid(this.node)&&null!=this.spineCom&&(this.spineCom.skeletonData=t,this.checkAddComponent("SpinePlusComponent")),this.assestLoaded=!0,null!=this.onAssstLoadCb&&this.onAssstLoadCb()}))):(this.modal,ObjectTypeEnum.text,null!=this.onAssstLoadCb&&this.onAssstLoadCb()),this._customeName=t}""==t&&null!=this.onAssstLoadCb&&this.onAssstLoadCb()}},premulAlpha:{get(){return null!=this.spineCom?1==this.spineCom.premultipliedAlpha?1:0:null!=this.sprite&&this.sprite.srcBlendFactor==cc.macro.BlendFactor.ONE?1:0},set(t){return null!=this.spineCom?this.spineCom.premultipliedAlpha=0!=t:null!=this.sprite?this.sprite.srcBlendFactor=1==t?cc.macro.BlendFactor.ONE:cc.macro.BlendFactor.SRC_ALPHA:void 0}},x:{get(){return this.node.x+this.offsetx},set(t){this.node.x=t-this.offsetx,this.dispatchListener("x",this.node.x)}},y:{get(){return this.node.y+this.offsety},set(t){this.node.y=t-this.offsety,this.dynamiczIndex&&(this.zIndex=6e3-2*Math.round(this.node.y+1500)),this.dispatchListener("y",this.node.y)}},realX:{get(){return this.node.x},set(t){this.node.x=t,this.dispatchListener("x",this.node.x)}},realY:{get(){return this.node.y},set(t){this.node.y=t,this.dynamiczIndex&&(this.zIndex=6e3-2*Math.round(this.node.y+1500)),this.dispatchListener("y",this.node.y)}},scaleX:{get(){return this.node.scaleX},set(t){this.node.scaleX=t,this.dispatchListener("scaleX",t)}},scaleY:{get(){return this.node.scaleY},set(t){this.node.scaleY=t,this.dispatchListener("scaleY",t)}},width:{get(){return this.node.width},set(t){this.node.width=t,this.dispatchListener("width",t),this.updatePreview()}},height:{get(){return this.node.height},set(t){this.node.height=t,this.dispatchListener("height",t),this.updatePreview()}},opacity:{get(){return this.node.opacity},set(t){this.node.opacity=t,this.dispatchListener("opacity",t)}},angle:{get(){return this.node.angle},set(t){this.node.angle=t,this.dispatchListener("angle",t)}},angleToPos:{get(){return this._angleToPos},set(t){this._angleToPos=t,this.realX=this.center[0]+Math.sin(this._angleToPos*(Math.PI/180))*this.radius,this.realY=this.center[1]+Math.cos(this._angleToPos*(Math.PI/180))*this.radius}},radius:{get(){return this._radius},set(t){this._radius=t,this.realX=this.center[0]+Math.sin(this._angleToPos*(Math.PI/180))*this.radius,this.realY=this.center[1]+Math.cos(this._angleToPos*(Math.PI/180))*this.radius}},center:{get(){return this._center},set(t){this._center=t,this.realX=this.center[0]+Math.sin(this._angleToPos*(Math.PI/180))*this.radius,this.realY=this.center[1]+Math.cos(this._angleToPos*(Math.PI/180))*this.radius}},zIndex:{get(){return this.node.zIndex},set(t){this.node.zIndex=t,this.dispatchListener("zIndex",t)}},active:{get(){return 1==this.node.active?1:0},set(t){this.node.active=0!=t,this.dispatchListener("active",t)}},parent:{get(){return this.node.parent},set(t){this.node.parent=t}},group:{get(){return this.node.group},set(t){}},zoomRatio:{get(){return null!=this.camera?this.camera.zoomRatio:0},set(t){null!=this.camera?this.camera.zoomRatio=t:(this.scaleX=1/t,this.scaleY=1/t,this.updatePreview())}},fontSize:{get(){return null==this.label?0:this.label.fontSize},set(t){null!=this.label&&(this.label.fontSize=t,this.label.lineHeight=t+10)}},overflow:{get(){return null==this.label?-1:this.label.overflow},set(t){null!=this.label&&(this.label.overflow=t)}},string:{get(){return null==this.label?"":this.label.string},set(t){null!=this.label&&(this.label.string=t,this.dispatchListener("string",t))}},anchorX:{get(){return this.node.anchorX},set(t){this.node.anchorX=t,this.updatePreview()}},anchorY:{get(){return this.node.anchorY},set(t){this.node.anchorY=t,this.updatePreview()}},color:{get(){return this.node.color.toHEX("#rrggbb")},set(t){this._color!=t&&(this._color=t),this.node.color=cc.Color.WHITE.fromHEX(t)}},ccColor:{get(){return this.node.color},set(t){}},r:{get(){return this.node.color.r},set(t){this.node.color=this.node.color.setR(t)}},g:{get(){return this.node.color.r},set(t){this.node.color=this.node.color.setG(t)}},b:{get(){return this.node.color.b},set(t){this.node.color=this.node.color.setB(t)}},outLineColor:{get(){return this._outLineColor},set(t){this._outLineColor!=t&&(this._outLineColor=t),null!=this.outLineComp&&(this.outLineComp.color=cc.Color.WHITE.fromHEX(t))}},outLineWidth:{get(){return this._outLineWidth},set(t){let e=this._outLineWidth;this._outLineWidth!=t&&(this._outLineWidth=t),this._outLineWidth<0&&(this._outLineWidth=0),this._outLineWidth>0?this.modal==ObjectTypeEnum.text?(null==this.outLineComp&&(this.outLineComp=this.addComponent(cc.LabelOutline),this.outLineComp.color=cc.Color.WHITE.fromHEX(this.outLineColor)),this.outLineComp.width=t):null==this.spineCom&&null==this.sprite||0==e&&this.setOutLine(!0):null!=this.outLineComp?this.outLineComp.width=0:null==this.spineCom&&null==this.sprite||e>0&&this.setOutLine(!1)}},_colliderValue:null,colliderValue:{get(){return this._colliderValue},set(t){if(0!=Object.keys(t).length&&null!=t.pointArr&&0!=t.pointArr.length&&null==this._colliderValue){let o=this.checkAddComponent("SpinePlusComponent");this._colliderValue=t,o.customCollider=!0;let a=t.scale||1;for(var e=[],i=0;i<t.pointArr.length;i++){var r=this.addComponent(cc.PolygonCollider);e.push(r);for(var n=t.pointArr[i],s=0;s<n.length;s++){r.points[s]||r.points.push(cc.v2()),r.points[s].x=(n[s].x-this.anchorX)*t.baseWidth/a+t.offsetX,r.points[s].y=(n[s].y-this.anchorY)*t.baseHeight/a*-1+t.offsetY}}o.polygonColliderArr=e}}},_outLineWidth:0,_outLineColor:"ffffff",_color:"ffffff",offsetx:0,offsety:0,_radius:0,_angleToPos:0,_center:[0,0],_customeName:"",useCenterMode:!1,inMapMap:0,girdX:0,girdY:0,widthGird:1,heightGird:1,girdTypeArr:[],dynamiczIndex:!1},setOutLine(t){1==t?cc.resources.load("sharder/RenderOutLine",cc.Material,((t,e)=>{null!=e&&(null!=this.spineCom?this.spineCom.setMaterial(0,e):null!=this.sprite&&this.sprite.setMaterial(0,e))})):null!=this.spineCom?this.spineCom.setMaterial(0,cc.Material.getBuiltinMaterial("2d-spine")):null!=this.sprite&&this.sprite.setMaterial(0,cc.Material.getBuiltinMaterial("2d-sprite"))},onLoad(){this.init()},init(){0!=cc.isValid(this.node)&&(this.robotListenerCount={},this.camera=this.node.getComponent(cc.Camera),this.sprite=this.node.getComponent(cc.Sprite),this.spineCom=this.node.getComponent(sp.Skeleton),this.label=this.node.getComponent(cc.Label),this.outLineComp=this.node.getComponent(cc.LabelOutline),this.ctx=this.node.getComponent(cc.Graphics))},addComponent(t){if("string"!=typeof t||null!=cc.js.getClassByName(t))return this.node.addComponent(t);console.warn("组件"+t+"不存在")},clearChildren(){if(cc.isValid(this.node))for(var t=0;t<this.node.children.length;t++)this.node.children[t].destroy()},checkAddComponent(t){if("string"==typeof t&&null==cc.js.getClassByName(t))return void console.warn("组件"+t+"不存在");let e=this.node.getComponent(t);return null==e&&(e=this.addComponent(t)),this.scheduleOnce((()=>{if("SpinePlusComponent"==t&&null!=this.graph){var i=this.graph.vars.rootccNode;null==i&&(i=cc.director.getScene().getChildByName("Canvas"));var r=i.getChildByName("Camera");null!=r?(e.camera=r.getComponent(cc.Camera),null==e.camera&&(r=i.getChildByName("Main Camera"),e.camera=r.getComponent(cc.Camera))):(r=i.getChildByName("Main Camera"),e.camera=r.getComponent(cc.Camera))}}),0),e},removeComponent(t){cc.isValid(this.node)&&this.node.removeComponent(t)},updatePreview(){if(null==this.ctx)return;if(1==this.disableUpdatePreview)return;this.ctx.clear();let t=cc.director.getScene().getChildByName("Canvas").getChildByName("Main Camera"),e=1;null!=t&&(e=t.getComponent(cc.Camera).zoomRatio),this.ctx.lineWidth=1/this.scaleX*4*(1/cc.view.getScaleX())*(1/e),console.log("绘制了preview "+this.nodeName,this.scaleX),this.ctx.strokeColor=cc.Color.BLUE.fromHEX("#3F42EA"),this.ctx.rect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),this.ctx.stroke()},getComponent(t){return this.node.getComponent(t)},getChildByName(t){return this.node.getChildByName(t)},on(t,e,i){cc.isValid(this.node)&&(null!=i?this.node.on(t,e,i):this.node.on(t,e,this))},targetOff(t){cc.isValid(this.node)&&(null!=t?this.node.targetOff(t):(this.node.targetOff(this),this.node.off(cc.Node.EventType.TOUCH_START),this.node.off(cc.Node.EventType.TOUCH_MOVE),this.node.off(cc.Node.EventType.TOUCH_END),this.node.off(cc.Node.EventType.TOUCH_CANCEL)))},destroyNode(){cc.isValid(this.node)&&this.node.destroy(),this.robotListener={}},onDestroy(){this.spineCom&&null!=this.spineCom.skeletonData&&(this.spineCom.skeletonData=null),this.sprite&&null!=this.sprite.spriteFrame&&(this.sprite.spriteFrame=null),this.graph=null,cc.Tween.stopAllByTarget(this.codeNode)},addRobotListener(t,e,i){null==this.robotListener&&(this.robotListener={}),null==this.robotListener[t]&&(this.robotListener[t]={}),this.robotListener[t][e]=i},removeRobotListener(t,e){null==this.robotListener&&(this.robotListener={}),null!=this.robotListener[t]&&delete this.robotListener[t][e]},dispatchListener(t,e){if(null!=this.robotListener&&null!=this.robotListener[t])for(var i in this.robotListener[t])this.robotListener[t][i](e)},onCollisionEnter(t,e){var i=t.node.getComponent("CodeNodeLg");this.dispatchListener("contact",i)},onCollisionExit(t,e){var i=t.node.getComponent("CodeNodeLg");this.dispatchListener("uncontact",i)},getWorldPos(){return this.node.parent.convertToWorldSpaceAR(this.node.position)},setSkin(t){if(0!=cc.isValid(this.node)&&(null==this.spineCom&&(this.spineCom=this.node.getComponent(sp.Skeleton)),null!=this.spineCom))try{this.spineCom.setSkin(t)}catch(e){}},playAnimation(t,e,i,r,n){0!=cc.isValid(this.node)&&(null==this.spineCom&&(this.spineCom=this.node.getComponent(sp.Skeleton)),null!=this.spineCom&&(""==t&&console.warn("输入了无效的aniName"),this.spineCom.paused=!1,null!=r&&this.spineCom.setEventListener(r),null!=n&&this.spineCom.setCompleteListener((e=>{e.animation.name==t&&null!=n&&n()})),1==i?(this.spineCom.loop=!1,this.spineCom.addAnimation(0,t,e)):this.spineCom.setAnimation(0,t,e)))},pauseAnimation(t){0!=cc.isValid(this.node)&&(null==this.spineCom&&(this.spineCom=this.node.getComponent(sp.Skeleton)),null!=this.spineCom&&(null==t&&(t=!0),this.spineCom.paused=t))},setAnimationProb(t,e){0!=cc.isValid(this.node)&&(null==this.spineCom&&(this.spineCom=this.node.getComponent(sp.Skeleton)),null!=this.spineCom&&(this.spineCom[t]=e))}}),ScaleObj$1=cc.Class({extends:cc.Component,properties:{scaleMin:.5,scaleMax:2,dynimicCenter:0},onLoad(){this.addTouchEvent()},addTouchEvent:function(){this.node.targetOff(this),this.touchIds={},this.node.on(cc.Node.EventType.TOUCH_START,this.touchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.moveFun,this),this.node.on(cc.Node.EventType.TOUCH_END,this.cancelFun,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.cancelFun,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.mouseWheel,this),console.log("我开启了缩放监听")},mouseWheel:function(t){1==this.dynimicCenter&&(this.startScale=this.node.scale,this.startPos=this.node.convertToNodeSpaceAR(cc.v2(.5*this.node.width,.5*this.node.height)));var e=t.getScrollY()/2e3;this.node.scale+=e,this.node.scale>this.scaleMax&&(this.node.scale=this.scaleMax),this.node.scale<this.scaleMin&&(this.node.scale=this.scaleMin),1==this.dynimicCenter&&(this.node.x+=this.startPos.x*this.startScale-this.node.scale*this.startPos.x,this.node.y+=this.startPos.y*this.startScale-this.node.scale*this.startPos.y),null!=this.outputHandle&&this.outputHandle("onScale",this.node.scale)},inputHandle:function(t){0==t.data?(this.touchIds={},this.node.targetOff(this)):this.addTouchEvent()},touchStart:function(t){var e=t.getID();Object.keys(this.touchIds).length>=2||(this.touchIds[e]={start:t.getLocation(),move:t.getLocation()},2==Object.keys(this.touchIds).length&&(this.scaleNow=this.node.scale))},moveFun:function(t){var e=t.getID(),i=Object.keys(this.touchIds);if(i.length<2)return this.touchIds[e].start=t.getLocation(),void(this.touchIds[e].move=t.getLocation());1==this.dynimicCenter&&(this.startScale=this.node.scale,this.startPos=this.node.convertToNodeSpaceAR(cc.v2(.5*this.node.width,.5*this.node.height))),this.touchIds[e].move=t.getLocation();var r=i[0],n=i[1],s=this.touchIds[r].start.sub(this.touchIds[n].start).mag(),o=this.touchIds[r].move.sub(this.touchIds[n].move).mag()/s;this.node.scale=this.scaleNow*o,this.node.scale>this.scaleMax&&(this.node.scale=this.scaleMax),this.node.scale<this.scaleMin&&(this.node.scale=this.scaleMin),1==this.dynimicCenter&&null!=this.startPos&&(this.node.x+=this.startPos.x*this.startScale-this.node.scale*this.startPos.x,this.node.y+=this.startPos.y*this.startScale-this.node.scale*this.startPos.y),null!=this.outputHandle&&this.outputHandle("onScale",this.node.scale)},cancelFun:function(t){var e=t.getID();delete this.touchIds[e];var i=this;i.startTouch=!1,0!=i.canMove&&null!=i.touchEndHandle&&i.touchEndHandle()},onDestroy(){cc.isValid(this.node)&&this.node.targetOff(this)},robotRelease(){this.touchIds={},cc.isValid(this.node)&&this.node.targetOff(this)}});let MotionText$1=class extends cc.Component{constructor(){super(...arguments),this.autoRun=!1,this.pause=!1,this.curTime=0,this.isActive=!1,this.position="0,0.6,1",this.positionTime="0,1.4,2",this.hideBaseLabel=!1,this.hideBeforRun=!1,this.hideAfterRun=!1,this.positionTimeArr=[],this.positionArr=[],this.dotIndex=1,this.delay=0,this.maskColor="88BF3D",this.stopIsPlayEnd=!1,this.dir=0,this.oriOpacity=255,this.hasInit=!1}onLoad(){null==this.node.getComponent("CodeNode")&&null==this.node.getComponent("CodeNodeLg")&&(this.init(),this.addEventListener())}init(){if(1!=this.hasInit){this.oriOpacity=this.node.opacity,this.node.anchorX=0;var t=new cc.Node,e=t.addComponent(cc.Label),i=this.node.getComponent(cc.Label);e.font=i.font,e.fontSize=i.fontSize,e.string=i.string,e.lineHeight=i.lineHeight,e.overflow=i.overflow,e.enableBold=i.enableBold,e.enableItalic=i.enableItalic,e.enableUnderline=i.enableUnderline,e.horizontalAlign=i.horizontalAlign,e.verticalAlign=i.verticalAlign,1==this.hideBaseLabel&&this.scheduleOnce((()=>{i.enabled=!1}),0);var r=this.node.getComponent(cc.LabelOutline);if(null!=r){var n=t.addComponent(cc.LabelOutline);n.width=r.width,n.color=r.color}var s=new cc.Node;0==this.dir?(s.anchorX=0,s.anchorY=.5):(s.anchorX=.5,s.anchorY=1),s.addComponent(cc.Mask),s.parent=this.node,t.parent=s,s.width=this.node.width,s.height=this.node.height,this.scheduleOnce((()=>{t.width=this.node.width,t.height=this.node.height,0==this.dir?(s.width=0,s.height=this.node.height,s.x=-1*this.node.width*this.node.anchorX,s.y=this.node.height*(.5-this.node.anchorY)):(s.y=this.node.height*(1-this.node.anchorY),s.x=0,s.width=this.node.width,s.height=0)}),0),t.anchorX=s.anchorX,t.anchorY=s.anchorY,t.y=0,t.x=0,this.positionTimeArr=this.positionTime.split(","),this.positionArr=this.position.split(","),0==this.dir?this.node.children[0].width=Number(this.positionArr[0]):this.node.children[0].height=Number(this.positionArr[0]),1==this.hideBeforRun&&(this.node.opacity=1),t.color=cc.Color.WHITE.fromHEX(this.maskColor),1==this.autoRun&&this.inputHandle({data:1}),this.hasInit=!0}}inputHandle(t){if("hide"!=t.targetSolt){if(0==t.data)return this.isActive=!1,void this.stopRun();this.isActive=!0,this.curTime=0,this.dotIndex=1,0==this.dir?this.node.children[0].width=Number(this.positionArr[0]):this.node.children[0].height=Number(this.positionArr[0]),cc.Tween.stopAllByTarget(this.node),1==this.hideBeforRun&&(this.node.opacity=1,cc.tween(this.node).to(.4,{opacity:this.oriOpacity}).start()),this.scheduleOnce((()=>{this.startRun()}),0)}else this.hide()}stopRun(){0!=this.hasInit&&(cc.Tween.stopAllByTarget(this.node.children[0]),0==this.dir?this.node.children[0].width=Number(this.positionArr[0]):this.node.children[0].height=Number(this.positionArr[0]),1==this.stopIsPlayEnd&&(null==this.node.oriColor&&(this.node.oriColor=this.node.color.toHEX("#rrggbb")),this.node.color=cc.Color.WHITE.fromHEX(this.maskColor)),1==this.hideBeforRun&&(cc.Tween.stopAllByTarget(this.node),this.node.opacity=1))}hide(){cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.4,{opacity:0}).start()}startRun(){null!=this.node.oriColor&&(this.node.color=cc.Color.WHITE.fromHEX(this.node.oriColor));var t=this.positionArr[this.dotIndex],e={};e=0==this.dir?{width:t*this.node.width}:{height:t*this.node.height};var i=this.positionTimeArr[this.dotIndex]-this.positionTimeArr[this.dotIndex-1];console.log("motionText startRun",this.dotIndex,this.node.width,this.delay,this.positionArr.join(","),e),i<0&&(i=.1,console.warn("时间点错误，后面的时间点小于前面的，自动设置为0.1",i)),cc.Tween.stopAllByTarget(this.node.children[0]),cc.tween(this.node.children[0]).delay(this.delay).to(i,e).call((()=>{null!=this.positionArr[this.dotIndex+1]?(this.dotIndex+=1,this.startRun()):(null!=this.outputHandle&&this.outputHandle("onend",1),1==this.hideAfterRun&&cc.tween(this.node).to(.4,{opacity:0}).start())})).start()}addEventListener(){cc.game.targetOff(this),cc.game.on("replayPage",(()=>{0==this.dir?this.node.children[0].width=Number(this.positionArr[0]):this.node.children[0].height=Number(this.positionArr[0]),1==this.hideBeforRun?this.node.opacity=1:this.node.opacity=this.oriOpacity,1==this.autoRun&&this.inputHandle({data:1})}),this),cc.game.on("pause",(()=>{this.robotPause()}),this),cc.game.on("resume",(()=>{this.robotResume()}),this)}robotStart(){null!=this.node?(null==this.node.children[0]?this.init():(this.stopRun(),1==this.autoRun&&this.inputHandle({data:1})),this.addEventListener()):console.warn("当前没有node",this)}robotRelease(){this.pause=!1,cc.game.targetOff(this),cc.isValid(this.node)&&(cc.Tween.stopAllByTarget(this.node.children[0]),cc.Tween.stopAllByTarget(this.node))}robotPause(){this.pause=!0,cc.director.getActionManager().pauseTarget(this.node.children[0])}robotResume(){this.pause=!1,cc.director.getActionManager().resumeTarget(this.node.children[0])}onDestroy(){cc.game.targetOff(this)}};class AutoTips extends cc.Component{constructor(){super(...arguments),this.quesionYuyin="",this.waitTime=10,this.yuyinTime=0,this.curWaitTime=0,this.isActive=!1,this.pause=!1,this.curPlayAudioId=-1,this.inputHandle=t=>{if("resetTime"==t.targetSolt)1==t.data&&(console.log("重置提示"),this.curWaitTime=this.waitTime,cc.audioEngine.stop(this.curPlayAudioId));else{if(0==t.data)return console.log("关闭提示"),this.curWaitTime=-1,this.isActive=!1,void(-1!=this.curPlayAudioId&&null!=this.curPlayAudioId&&cc.audioEngine.stop(this.curPlayAudioId));console.log("开启提示"),this.waitTime<1&&(this.waitTime=1),this.isActive=!0,this.curWaitTime=this.waitTime}}}onLoad(){}start(){}addEventListener(){cc.game.targetOff(this),cc.game.on("clickCaidan",this.robotPause,this)}async playTips(){this.codeProgress.playSounds([this.quesionYuyin],(()=>{}),2),this.curWaitTime=this.waitTime}robotStart(){this.curWaitTime=-1,this.isActive=!1,this.pause=!1}robotRelease(){this.curWaitTime=-1,this.isActive=!1,this.pause=!1,cc.game.targetOff(this)}robotPause(){this.pause=!0}robotResume(){this.pause=!1}update(t){1!=this.pause&&0!=this.isActive&&this.curWaitTime>0&&(this.curWaitTime-=t,this.curWaitTime<0&&this.playTips())}onDestroy(){cc.game.targetOff(this)}}let AngleCompoment$1=class extends cc.Component{constructor(){super(...arguments),this.pointA={X:0,Y:0},this.pointB={X:0,Y:0},this.pointC={X:0,Y:0},this.typeMouse=!1,this.allA=0,this.inputHandle=t=>{console.log("进入了开启监听"),"number1"==t.targetSolt?0==t.data?(console.log("关闭了监听"),this.node.targetOff(this)):this.kaiqijiantin():"reset"==t.targetSolt&&(console.log("进入了重置"),this.allA=0)},this.outputHandle=(t,e)=>{}}onLoad(){}start(){}kaiqijiantin(){this.node.on(cc.Node.EventType.TOUCH_START,(t=>{var e=this.node.convertToNodeSpaceAR(t.getLocation());this.pointB.X=e.x,this.pointB.Y=e.y,this.typeMouse=!0}),this),this.node.on(cc.Node.EventType.TOUCH_MOVE,(t=>{if(this.typeMouse){var e=this.node.convertToNodeSpaceAR(t.getLocation());this.pointC.X=e.x,this.pointC.Y=e.y;var i={},r={};i.X=this.pointB.X-this.pointA.X,i.Y=this.pointB.Y-this.pointA.Y,r.X=this.pointC.X-this.pointA.X,r.Y=this.pointC.Y-this.pointA.Y;var n=i.X*r.Y-i.Y*r.X,s=Math.sqrt(Math.pow(this.pointA.X-this.pointB.X,2)+Math.pow(this.pointA.Y-this.pointB.Y,2)),o=Math.sqrt(Math.pow(this.pointA.X-this.pointC.X,2)+Math.pow(this.pointA.Y-this.pointC.Y,2)),a=Math.sqrt(Math.pow(this.pointB.X-this.pointC.X,2)+Math.pow(this.pointB.Y-this.pointC.Y,2)),l=(Math.pow(s,2)+Math.pow(o,2)-Math.pow(a,2))/(2*s*o),c=Math.round(180*Math.acos(l)/Math.PI);n<0?this.allA-=c:this.allA+=c,this.pointB.X=this.pointC.X,this.pointB.Y=this.pointC.Y,this.outputHandle("number1",this.allA)}}),this),this.node.on(cc.Node.EventType.TOUCH_END,(t=>{this.typeMouse=!1}),this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,(t=>{this.typeMouse=!1}),this)}};class SpinePlusComponent extends cc.Component{constructor(){super(...arguments),this.customCollider=!1,this.actions="",this.camera=null,this.clickEvent=[],this.completeEvent=[],this.polygonColliderArr=[],this.isDynamic=!1}get spine(){return this._spine}set spine(t){this._spine=t}onLoad(){this._spine=this.node.getComponent(sp.Skeleton),null!=this._spine?this._colliderSlot=this._spine.findSlot("Collider"):this.customCollider=!0}update(){if(this._polygonCollider&&this._colliderSlot&&this.isDynamic){this._polygonCollider.offset.x=this._colliderSlot.bone.worldX,this._polygonCollider.offset.y=this._colliderSlot.bone.worldY,this._polygonCollider.points=[];for(let t=0;t<this._colliderSlot.deform.length/2;t++){this._polygonCollider.points[t]||this._polygonCollider.points.push(cc.v2()),this._polygonCollider.points[t].x=this._colliderSlot.deform[2*t],this._polygonCollider.points[t].y=this._colliderSlot.deform[2*t+1]}}}refreshCollider(){this._colliderSlot=this._spine.findSlot("Collider"),this._colliderSlot.getAttachment()}start(){if(1==this.customCollider)return this.polygonColliderArr=this.node.getComponents(cc.PolygonCollider),this.polygonColliderArr.length>0&&(this.node._hitTest=this.hitTest.bind(this)),void this.addTouchEvent();if(this._attachment=this._spine.getAttachment("Collider","Collider"),this._attachment){this._polygonCollider=this.node.addComponent(cc.PolygonCollider);for(let t=0;t<this._attachment.vertices.length/2;t++){this._polygonCollider.points[t]||this._polygonCollider.points.push(cc.v2()),this._polygonCollider.points[t].x=this._attachment.vertices[2*t],this._polygonCollider.points[t].y=this._attachment.vertices[2*t+1]}this.node._hitTest=this.hitTest.bind(this),this.addTouchEvent(),this.actions.length>0&&(this.actionList=this.actions.split(","))}}get actionList(){return this._actionList}set actionList(t){this._actionList=t}addTouchEvent(){this.node.hasEventListener(cc.Node.EventType.TOUCH_END)||this.node.on(cc.Node.EventType.TOUCH_END,this.spineClick.bind(this),this)}removeTouchEvent(){this.actionList=[],this.clickEvent=[],this.node.off(cc.Node.EventType.TOUCH_END,this.spineClick.bind(this),this)}playSpineAnimation(){if(!this._actionList)return;this.node.pauseSystemEvents(!0);let t=this._actionList.concat(),e=this._endActName=t.shift(),i=t.pop();this._spine.setAnimation(0,e,!1);for(let r=0;r<t.length;r++){const e=this._endActName=t[r];this._spine.addAnimation(0,e,!1)}this._spine.addAnimation(0,i,!0),this._spine.setCompleteListener(((t,e)=>{t.animation.name==this._endActName&&(this.node.resumeSystemEvents(!0),this._spine.setCompleteListener(null),cc.Component.EventHandler.emitEvents(this.completeEvent,this._spine))}))}spineClick(){this.playSpineAnimation(),cc.Component.EventHandler.emitEvents(this.clickEvent,this._spine)}hitTest(t){let e;if(this.camera){let i=this.camera.getScreenToWorldPoint(t);e=this.node.convertToNodeSpaceAR(i)}else e=this.node.convertToNodeSpaceAR(t);if(null!=this.polygonColliderArr&&this.polygonColliderArr.length>0){for(var i=!1,r=0;r<this.polygonColliderArr.length&&1!=(i=cc.Intersection.pointInPolygon(cc.v2(e),this.polygonColliderArr[r].points));r++);return i}if(this._polygonCollider){return cc.Intersection.pointInPolygon(cc.v2(e),this._polygonCollider.points)}}}cc.js.setClassName("SpinePlusComponent",SpinePlusComponent),cc.js.setClassName("ScaleObj",ScaleObj$1),cc.js.setClassName("MotionText",MotionText$1),cc.js.setClassName("AutoTips",AutoTips),cc.js.setClassName("AngleCompoment",AngleCompoment$1),cc.js.setClassName("CodeNodeLg",CodeNodeLg);var hasInit=!1,hasLoadScene=!1,selectedNode=null,treeData=[],rootHost="https://xxxx",isPreviewMode=!0,isInApp=!1,isInImport=!1,isSinglePreview=!1,designViewWidth=2560,designViewHeight=1500;function changeRunInmportState(t){isInImport=t}function setRootHost(t){rootHost=t}var ObjectTypeEnum={empty:"空物体",sprite:"图片",graph:"绘制",spine:"spine",text:"文本"},objectTypes=[ObjectTypeEnum.empty,ObjectTypeEnum.sprite,ObjectTypeEnum.graph,ObjectTypeEnum.spine,ObjectTypeEnum.text],robotNodeEnum={value:"input/value",valueString:"input/valueString",boolean:"input/boolean",gameStart:"input/gameStart",customButton:"input/button/customButton",controll:"input/button/controll",touchStart:"input/screen/touchStart",touchMove:"input/screen/touchMove",touchEnd:"input/screen/touchEnd",leftOrRightAct:"input/leftOrRightAct",customData:"input/getData/customData",systemData:"input/getData/systemData",screenSize:"input/screenSize",showTextTip:"output/tips/showTextTip",showConfirm:"output/tips/showConfirm",showHandTip:"output/tips/showHandTip",blockTouch:"output/blockTouch",consoleInfo:"output/tips/consoleInfo",restartGame:"output/game/restartGame",changeGame:"output/game/changeGame",endGame:"output/game/endGame",sound:"output/sound",vibrate:"output/vibrate",stopTime:"output/time/stopTime",timeScale:"output/time/timeScale",createObject:"objects/createObject",animate:"objects/animates/animate",tween:"objects/animates/tween",bezierCurve:"objects/animates/bezierCurve",camera:"objects/camera",MotionText:"output/customComponent/MotionText",CaiDanComponent:"output/customComponent/CaiDanComponent",CaiDanComponent2:"output/customComponent/CaiDanComponent2",ChatComponent:"output/customComponent/ChatComponent",VoiceCheck:"output/customComponent/VoiceCheck",AngleCompoment:"output/customComponent/AngleCompoment",ScaleObj:"output/customComponent/ScaleObj",ProgressCompoment:"output/customComponent/ProgressCompoment","cc.Mask":"output/customComponent/ccMask",angleConvertVector:"middle/angleCalculate/angleConvertVector",angleDifference:"middle/angleCalculate/angleDifference",vectorToAngel:"middle/angleCalculate/vectorToAngel",add:"middle/calculate/add",chu:"middle/calculate/chu",del:"middle/calculate/del",length:"middle/calculate/length",x:"middle/calculate/x",checkTag:"middle/change/checkTag",dataObject:"middle/change/dataObject",getArrayValue:"middle/change/getArrayValue",getKeyValue:"middle/change/getKeyValue",randomNum:"middle/change/randomNum",timeDown:"middle/change/timeDown",timeDownCycle:"middle/change/timeDownCycle",upCount:"middle/change/upCount",bigger:"middle/compare/bigger",equire:"middle/compare/equire",inRange:"middle/compare/inRange",litter:"middle/compare/litter",abs:"middle/covert/abs",revertNegative:"middle/covert/revertNegative",squareRoot:"middle/covert/squareRoot",toint:"middle/covert/toint",input:"middle/graph/input",output:"middle/graph/output",subgraph:"middle/graph/subgraph",allRight:"middle/logic/allRight",allToggle:"middle/logic/allToggle",notRight:"middle/logic/notRight",orRight:"middle/logic/orRight",orToggle:"middle/logic/orToggle",acceptData:"middle/tool/acceptData",lighting:"middle/tool/lighting",lightingOut:"middle/tool/lightingOut",outputLine:"middle/tool/outputLine",sendData:"middle/tool/sendData",textCode:"middle/tool/textCode",contact:"objects/objectSensor/contact",position:"objects/objectSensor/position",speed:"objects/objectSensor/publicListen",connection:"objects/group/connection"},typeColorEnum={input:"green",middle:"cyan",output:"pink",objects:"orange"};async function realBoot(){return new Promise(((t,e)=>{var i=window._CCSettings,r=null,n=cc.AssetManager.BuiltinBundleName.RESOURCES,s=cc.AssetManager.BuiltinBundleName.INTERNAL,o=cc.AssetManager.BuiltinBundleName.MAIN;var a=function(){cc.view.enableRetina(!0),cc.sys.isBrowser&&function(){var t=document.getElementById("splash");if(null!=t){var e=t.querySelector(".progress-bar span");r=function(t,i){var r=100*t/i;e&&(e.style.width=r.toFixed(2)+"%")},t.style.display="block",e.style.width="0%",cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,(function(){t.style.display="none"}))}}(),cc.sys.isBrowser&&cc.sys.os===cc.sys.OS_ANDROID&&(cc.assetManager.downloader.maxConcurrency=2,cc.assetManager.downloader.maxRequestsPerFrame=2);var n=i.launchScene,s=cc.assetManager.bundles.find((function(t){return t.getSceneInfo(n)}));s.loadScene(n,null,r,(function(i,r){i?e(i):(cc.director.runSceneImmediate(r),cc.sys.isBrowser&&console.log("Success to load scene: "+n),cc.Canvas.instance.designResolution=cc.size(designViewWidth,designViewHeight),hasLoadScene=!0,cc.director.getCollisionManager().enabled=!0,clearScene(),t(!0))}))};if(null==document.getElementById("GameCanvas"))return console.warn("没有找到GameCanvas"),void e("没有找到渲染画布GameCanvas");var l={id:"GameCanvas",debugMode:i.debug?cc.debug.DebugMode.INFO:cc.debug.DebugMode.ERROR,showFPS:i.debug,frameRate:60,groupList:i.groupList,collisionMatrix:i.collisionMatrix};cc.assetManager.init({bundleVers:i.bundleVers,remoteBundles:i.remoteBundles,server:i.server});var c=[s];i.hasResourcesBundle&&c.push(n);var h=0;function u(t){if(t)return console.error(t.message,t.stack);++h===c.length+1&&cc.assetManager.loadBundle(o,(function(t){t?e(t):cc.game.run(l,a)}))}console.log("需要加载的settings.jsList",i.jsList),cc.assetManager.loadScript(i.jsList.map((function(t){return"src/"+t})),u),console.log("需要加载的bundleRoot",c);for(var d=0;d<c.length;d++)cc.assetManager.loadBundle(c[d],u)}))}function initConsoleUtil(){cc.tree||(cc.tree=function(t){let e=t||0,i=function(t){let r=`color: ${null===t.parent||t.activeInHierarchy?"green":"grey"}; font-size: 14px;font-weight:bold`,n="color: black; background: lightgrey;margin-left: 5px;border-radius:3px;padding: 0 3px;font-size: 10px;font-weight:bold",s="color: orange; background: black;margin-left: 5px;border-radius:3px;padding:0 3px;fonrt-size: 10px;font-weight:bold;",o=`%c${t.name}`,a="%c"+(t.x.toFixed(0)+","+t.y.toFixed(0)+","+t.width.toFixed(0)+","+t.height.toFixed(0)+","+t.scale.toFixed(1)),l="%c"+e++;if(t.childrenCount>0){console.groupCollapsed(o+a+l,r,n,s);for(let e=0;e<t.childrenCount;e++)i(t.children[e]);console.groupEnd()}else console.log(o+a+l,r,n,s)};if(t){let r=cc.cat(t);e=r.tempIndex,i(r)}else{let t=cc.director.getScene();i(t)}return"属性依次为x,y,width,height,scale.使用cc.cat(id)查看详细属性."},cc.cat=function(t){let e,i=0,r=function(n){if(!e){if(cc.js.isNumber(t)){if(t===i++)return void(e=n)}else{if(t.toLowerCase()===n.name.toLowerCase())return void(e=n);i++}if(n.childrenCount>0)for(let t=0;t<n.childrenCount;t++)r(n.children[t])}},n=cc.director.getScene();return r(n),e.tempIndex=cc.js.isNumber(t)?t:i,e},cc.list=function(t){let e=[],i=function(r){if(r.name.toLowerCase().indexOf(t.toLowerCase())>-1&&e.push(r),r.childrenCount>0)for(let t=0;t<r.childrenCount;t++)i(r.children[t])},r=cc.director.getScene();return i(r),1===e.length?e[0]:e},cc.where=function(t){let e=t.name?t:cc.cat(t);if(!e)return null;let i=e.getBoundingBoxToWorld(),r=new cc.Node,n=r.addComponent(cc.Graphics);return cc.director.getScene().addChild(r),r.position=i.center,r.group=e.group,r.zIndex=cc.macro.MAX_ZINDEX,0===i.width||0===i.height?(n.circle(0,0,100),n.fillColor=cc.Color.GREEN,n.fill()):(r.width=i.width,r.height=i.height,n.rect(-r.width/2,-r.height/2,r.width,r.height),n.fillColor=(new cc.Color).fromHEX("#E91E6390"),n.fill()),setTimeout((()=>{cc.isValid(r)&&r.destroy()}),2e3),e},cc.cache=function(){let t=cc.assetManager.assets._map,e=[],i=0;for(let r in t){let n=t[r];if("js"!==n.type&&"json"!==n.type){let s="_",o="",a=n.__classname__,l=-1;if("png"===n.type||"jpg"===n.type){let e=t[r.replace("."+n.type,".json")];e&&e._owner&&e._owner._name&&(s=e._owner._name,o=e.content.url)}else if(n.name?s=n.name:n._owner&&(s=n._owner&&n._owner.name||"_"),"cc.Texture2D"===a){o=n.nativeUrl;let t=n.width*n.height*((".jpg"===n._native?3:4)/1024/1024);i+=t,l=Math.round(1e3*t)/1e3}else"cc.SpriteFrame"===a&&(o=n._texture.nativeUrl);e.push({queueId:n.queueId,type:a,name:s,preview:o,id:n._uuid,size:l})}}return[e,`缓存 [文件总数:${e.length}][纹理缓存:${i.toFixed(2)+"M"}]`]},cc.loopAllNode=function(t,e){var i=function(e){if(cc.isValid(e)){t(e);for(var r=0;r<e.children.length;r++)i(e.children[r])}};if(null==e){if(e=cc.director.getScene(),1==cc.isValid(e))for(var r=0;r<e.children.length;r++)i(e.children[r])}else i(e)})}async function waitCocosInit(){return new Promise(((t,e)=>{var i=0,r=()=>{i+=1,1==hasLoadScene?t(!0):i>100?e("等待cocos加载场景超时"):setTimeout(r,100)};r()}))}async function init(){return 1==hasInit?(console.log("CocosMgr已经初始化了"),!0):(hasInit=!0,"undefined"!=typeof VConsole&&(window.vConsole=new VConsole),console.log("window._CCSettings.debug",window._CCSettings),console.log("window.vConsole",window.vConsole),null==window.cc?(console.warn("cocos引擎没有被加载"),!1):(console.log("cocos加载成功ENGINE_VERSION",window.cc.ENGINE_VERSION),await realBoot(),initConsoleUtil(),void(hasInit=!0)))}function updateCanvasSize(t,e){if(0!=hasLoadScene){if(null==t||null==e){let i=document.getElementById("GameCanvas");t=i.clientWidth,e=i.clientHeight,console.log("自动获取了canvas尺寸并更新",t,e)}cc.view.setCanvasSize(t,e)}}function showOrHideFPS(){var t=!cc.debug.isDisplayStats();return cc.debug.setDisplayStats(t),t}function showOrHideColiderBox(){var t=cc.director.getCollisionManager();if(null!=t)return t.enabledDebugDraw=!t.enabledDebugDraw,null!=t._debugDrawer&&(t._debugDrawer.lineWidth=1/cc.view.getScaleX()*3),t.enabledDebugDraw;console.warn("getCollisionManager == null")}function clearScene(){if(0==hasLoadScene)return;const t=cc.director.getScene();for(var e=0;e<t.children.length;e++){var i=t.children[e];if("Canvas"!=i.name)i.destroy();else for(var r=0;r<i.children.length;r++){var n=i.children[r];"Main Camera"!=n.name&&n.destroy()}}}function getNodeById(t){let e;const i=function(r){if(r._id!==t){if(r.childrenCount)for(let t=0;t<r.childrenCount;t++)e||i(r.children[t])}else e=r},r=cc.director.getScene();return i(r),e}function getChildren(t){return t.children.map((t=>{let e=t.children&&t.children.length>0?getChildren(t):[];return{id:t._id,name:t.name,active:t.activeInHierarchy,children:e}}))}function getHasChildrenNodeId(){if(0==hasLoadScene)return[];var t=[];return cc.loopAllNode((e=>{e.children.length>0&&t.push(e._id)}),cc.director.getScene()),t}function refreshTree(){treeData=getChildren(cc.director.getScene())}function changePreviewMode(){isPreviewMode=!isPreviewMode}function drawNodeRect(t){null!=t?(selectedNode=t,cc.where(t)):cc.where(selectedNode)}function getFileType(t){return"png"==t||"jpg"==t||"jpeg"==t?"图片":"mp3"==t||"wav"==t?"音频":"json"==t?"json":"atlas"==t?"图集":"spine"==t?"spine":"空物体"}function getExName(t,e){var i="";return-1!=t.indexOf(".")&&(i=(t=t.split("."))[t.length-1]),1==e?"."+i:i}function getName(t){return-1!=t.indexOf("/")&&(t=(t=t.split("/"))[t.length-1]),t}function getBaseName(t){return(t=getName(t)).split(".")[0]}function setValueByKey(t,e,i){null!=e[i]&&(t[i]=e[i])}function syncConfigToCodeNode(t,e){setValueByKey(t,e,"modal"),setValueByKey(t,e,"customeName"),setValueByKey(t,e,"anchorX"),setValueByKey(t,e,"anchorY"),setValueByKey(t,e,"x"),setValueByKey(t,e,"y"),t.useCenterMode&&null!=e.x&&null!=e.y&&(t.center=[e.x,e.y]),setValueByKey(t,e,"angle"),setValueByKey(t,e,"color"),setValueByKey(t,e,"zIndex"),setValueByKey(t,e,"dynamiczIndex"),setValueByKey(t,e,"group"),setValueByKey(t,e,"overflow"),setValueByKey(t,e,"height"),setValueByKey(t,e,"width"),setValueByKey(t,e,"opacity"),setValueByKey(t,e,"fontSize"),setValueByKey(t,e,"outLineColor"),setValueByKey(t,e,"outLineWidth"),setValueByKey(t,e,"premulAlpha"),setValueByKey(t,e,"scaleX"),setValueByKey(t,e,"scaleY"),setValueByKey(t,e,"string"),setValueByKey(t,e,"zoomRatio"),setValueByKey(t,e,"colliderValue")}function xorConfig(t,e){for(var i in e)t[i]!=e[i]&&null!=e[i]||delete e[i]}function xorConfigZeroValue(t){for(var e in t)0!=t[e]&&null!=t[e]||delete t[e]}function blockTouch$1(t){if(0==hasLoadScene)return void console.warn("调用createObj时场景还未加载成功");let e=cc.director.getScene();var i=e.getChildByName("blockNode");null==i&&((i=new cc.Node).name="blockNode",i.parent=e,i.width=cc.winSize.width,i.height=cc.winSize.height,i.addComponent(cc.BlockInputEvents),i.x=.5*cc.winSize.width,i.y=.5*cc.winSize.height),i.active=t}function createObj(t,e){if(0==hasLoadScene)return void console.warn("调用createObj时场景还未加载成功");let i=null;if(i=null!=t.parent?t.parent:cc.director.getScene().getChildByName("Canvas"),null!=i&&0!=cc.isValid(i)){var r=new cc.Node;r.parent=i;var n=r.addComponent(CodeNodeLg);return n.onAssstLoadCb=e,syncConfigToCodeNode(n,t),n}}async function showConfirm$1(t,e){e(confirm(t))}async function showAlert(t){null!=window.antAleart&&window.antAleart(t)}function loadNetSpine(t,e){let i=rootHost+"/"+t+".png",r=rootHost+"/"+t+".json",n=rootHost+"/"+t+".atlas",s=i.split("/"),o=s[s.length-1];cc.assetManager.loadAny([{url:n,ext:".atlas"},{url:r,ext:".json"}],((t,r)=>{cc.assetManager.loadRemote(i,((t,i)=>{let n=new sp.SkeletonData;n.skeletonJson=r[1],n.atlasText=r[0],n.textures=[i],n.textureNames=[o],e&&e(n)}))}))}function vibrate$1(t){console.log("震动长短",t)}function changeGraph(t,e){null!=window.onChangeGraph&&window.onChangeGraph(t,e,!0)}class valueRobot extends LGraphNode{title="value";desc="定义一个数";name="数值";constructor(){super(),this.addOutput("输出","number"),this.addProperty("value",1),this.widget=this.addWidget("number","值",1,"value"),this.widgets_up=!0}onExecute(){this.setOutputData(0,parseFloat(this.properties.value))}getTitle(){return this.flags.collapsed?this.properties.value:this.title}setValue(t){this.setProperty("value",t)}onDrawBackground(t){this.outputs[0].label=this.properties.value.toFixed(3)}}valueRobot.title="数值",LiteGraph.registerNodeType("input/value",valueRobot);class valueStringRobot extends LGraphNode{title="文字";desc="定义文字值";constructor(){super(),this.addOutput("输出","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0}onExecute(){this.setOutputData(0,this.properties.value)}getTitle(){return this.flags.collapsed?this.properties.value:this.title}setValue(t){this.setProperty("value",t)}}valueStringRobot.title="文字",LiteGraph.registerNodeType("input/valueString",valueStringRobot);class BooleanRobot extends LGraphNode{title="布尔值";desc="定义一个数";constructor(){super(),this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value")}onExecute(){this.setOutputData(0,parseFloat(this.properties.value))}getTitle(){return this.flags.collapsed?this.properties.value:this.title}setValue(t){this.setProperty("value",t)}onDrawBackground(t){this.outputs[0].label=this.properties.value?"真":"假"}}BooleanRobot.title="布尔值",LiteGraph.registerNodeType("input/boolean",BooleanRobot);class gameStartRobot extends LGraphNode{title="开始时";desc="但游戏开始时执行一次";constructor(){super(),this.addOutput("游戏开始",LiteGraph.EVENT),this.addProperty("modal","开始时","enum"),this.addWidget("combo","输出时机",this.properties.modal,{property:"modal",values:["开始前","开始时","开始后"]}),this.widgets_up=!0,this.size=[180,30]}onStartBeforeLoad(){"开始前"==this.properties.modal&&this.triggerSlot(0,1)}onStart(){"开始时"==this.properties.modal&&this.triggerSlot(0,1)}onStartAfter(){"开始后"==this.properties.modal&&this.triggerSlot(0,1)}getTitle(){return this.flags.collapsed?this.properties.modal:this.title}setValue(t){this.setProperty("value",t)}}gameStartRobot.title="开始时",LiteGraph.registerNodeType("input/gameStart",gameStartRobot);class customButtonRobot extends LGraphNode{title="按钮";desc="一个可以点击的按钮";font="Arial";constructor(){super(),this.addOutput("",LiteGraph.EVENT),this.addOutput("","boolean"),this.addProperty("font_size",30),this.addProperty("text","按钮"),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}onMouseDown(t,e){if(e[0]>1&&e[1]>1&&e[0]<this.size[0]-2&&e[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),this.clicked=!1,this.setOutputData(1,this.clicked),!0}onExecute(){this.setOutputData(1,this.clicked)}onDrawForeground(t){if(!this.flags.collapsed){var e=10;if(t.fillStyle="black",t.fillRect(11,11,this.size[0]-20,this.size[1]-20),t.fillStyle="#AAF",t.fillRect(9,9,this.size[0]-20,this.size[1]-20),t.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",t.fillRect(e,e,this.size[0]-20,this.size[1]-20),this.properties.text||0===this.properties.text){var i=this.properties.font_size||30;t.textAlign="center",t.fillStyle=this.clicked?"black":"white",t.font=i+"px Arial",t.fillText(this.properties.text,.5*this.size[0],.5*this.size[1]+.3*i),t.textAlign="left"}}}}customButtonRobot.title="按钮",LiteGraph.registerNodeType("input/button/customButton",customButtonRobot);class controllRobot extends LGraphNode{title="摇杆";desc="操作杆的x和y的范围：[-1, 1]，当拖动操控杆时\n仅改变时：操控杆移发生位移变化时输出当前操作杆范围\n持续：一直输出操控杆当前值*这一帧的时长";font="Arial";constructor(){super(),this.addOutput("左右","number"),this.addOutput("上下","number"),this.addOutput("按下时",LiteGraph.EVENT),this.addProperty("controllType",0),this.addProperty("modal",0),this.addProperty("outputScale",250),this.size=[164,164],this.clicked=!1}freshHandlePos(t){var e=Math.min(this.size[0],this.size[1]);let i=.5*e,r=t[0]-i,n=t[1]-i,s=Math.min(Math.sqrt(r*r+n*n),i),o=Math.atan2(n,r),a=s*Math.cos(o),l=s*Math.sin(o);if(t[0]>0&&t[1]>0&&t[0]<e&&t[1]<e)return this.setOutputData(0,a/i),this.setOutputData(1,l/i),!0}onMouseDown(t,e){this.clicked=!0,this.freshHandlePos(e),this.triggerSlot(2)}onMouseMove(t,e){1==this.clicked&&this.freshHandlePos(e)}onMouseUp(t){this.clicked=!1,this.setOutputData(0,0),this.setOutputData(1,0)}onExecute(){this.setOutputData(1,this.clicked)}onDrawBackground(t){if(!this.flags.collapsed){var e=this.getOutputData(0),i=this.getOutputData(1);null!=e&&null!=e.toFixed&&(this.outputs[0].label="左右："+e.toFixed(3)),null!=i&&null!=i.toFixed&&(this.outputs[1].label="上下："+i.toFixed(3))}}onDrawForeground(t){if(!this.flags.collapsed){var e,i=Math.min(this.size[0],this.size[1]),r={width:i,height:i},n=.25*i,s=.25*i;this.size[0],(e=t.createRadialGradient(r.width/2,r.height/2,0,r.width/2,r.height/2,r.width/2)).addColorStop(0,"#666"),e.addColorStop(1,"#222"),t.beginPath(),t.arc(r.width/2,r.height/2,r.width/2,0,2*Math.PI),t.fillStyle=e,t.fill(),t.strokeStyle="rgba(255,255,255,0.2)",t.lineWidth=2,t.beginPath(),t.moveTo(r.width/2,0),t.lineTo(r.width/2,r.height),t.moveTo(0,r.height/2),t.lineTo(r.width,r.height/2),t.stroke();for(let e=1;e<=3;e++)t.beginPath(),t.arc(r.width/2,r.height/2,e*r.width/6,0,2*Math.PI),t.stroke();(e=t.createRadialGradient(n/2,s/2,0,n/2,s/2,n/2)).addColorStop(0,"#fff"),e.addColorStop(1,"#aaa");var o=this.getOutputData(0)||0,a=this.getOutputData(1)||0,l=.5*r.width+(0+o)*r.width*.5,c=.5*r.height+(0+a)*r.height*.5;t.beginPath(),t.arc(l,c,n/2,0,2*Math.PI),t.fillStyle=e,t.fill(),t.beginPath(),t.arc(l,c,n/3,0,2*Math.PI),t.fillStyle="rgba(255,255,255,0.3)",t.fill()}}}controllRobot.title="摇杆",LiteGraph.registerNodeType("input/button/controll",controllRobot);class touchStart extends LGraphNode{title="触摸开始";desc="检测物体触摸开始";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("监听",LiteGraph.ACTION),this.addInput("取消监听",LiteGraph.ACTION),this.addOutput("开始X","number"),this.addOutput("开始Y","number"),this.addOutput("点击",LiteGraph.EVENT),this.addProperty("controllObj",!1,"boolean"),this.addWidget("toggle","控制物体位置",this.properties.controllObj,"controllObj"),this.useCanvas=!1,this.lastBindCodeNode=null}onStop(){if(this.touchIds={},1==this.useCanvas){this.useCanvas=!1;let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this)}else null!=this.lastBindCodeNode&&(this.lastBindCodeNode.targetOff(this),this.lastBindCodeNode=null)}realRun(t,e){if(0!=e)if(null!=this.lastBindCodeNode&&this.lastBindCodeNode.node.targetOff(this),null!=t)this.useCanvas=!1,this.lastBindCodeNode=t,t.checkAddComponent("SpinePlusComponent"),t.targetOff(this),t.on(cc.Node.EventType.TOUCH_START,(e=>{if(1!=this.graph.config.pause){var i=t.node.parent.convertToNodeSpaceAR(e.getLocation());1==this.properties.controllObj&&(t.x=i.x,t.y=i.y),this.setOutputData(0,i.x),this.setOutputData(1,i.y),this.triggerSlot(2,1)}}),this);else{this.useCanvas=!0;let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this),t.on(cc.Node.EventType.TOUCH_START,(e=>{if(1!=this.graph.config.pause){var i=t.convertToNodeSpaceAR(e.getLocation());this.setOutputData(0,i.x),this.setOutputData(1,i.y),this.triggerSlot(2,1)}}),this)}else if(1==this.useCanvas){let t=this.graph.config.rootccNode;if(null==t)return void(t=cc.director.getScene().getChildByName("Canvas"));t.targetOff(this)}else null!=this.lastBindCodeNode&&this.lastBindCodeNode.targetOff(this)}onAction(t,e){if("监听"==t){var i=this.getInputData(0);this.realRun(i)}else if("取消监听"==t){i=this.getInputData(0);this.realRun(i,!1)}}setValue(t){this.setProperty("value",t)}}touchStart.title="触摸开始",LiteGraph.registerNodeType("input/screen/touchStart",touchStart);class touchMove extends LGraphNode{title="触摸移动";desc="检测物体触摸开始";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("监听",LiteGraph.ACTION),this.addInput("取消监听",LiteGraph.ACTION),this.addOutput("X轴移动","number"),this.addOutput("Y轴移动","number"),this.addOutput("移动",LiteGraph.EVENT),this.addProperty("controllObj",!1,"boolean"),this.addWidget("toggle","控制物体位置",this.properties.controllObj,"controllObj"),this.addProperty("needCheckIn",!1,"boolean"),this.addWidget("toggle","碰撞框检测",this.properties.needCheckIn,"needCheckIn"),this.addProperty("mutplayTouch",!1,"boolean"),this.addWidget("toggle","忽略多点触摸",this.properties.mutplayTouch,"mutplayTouch"),this.useCanvas=!1,this.lastBindCodeNode=null,this.touchIds={}}onStop(){if(this.touchIds={},1==this.useCanvas){this.useCanvas=!1;let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this)}else console.log("停止运行了 lastBindCodeNode",this.lastBindCodeNode),null!=this.lastBindCodeNode&&(this.lastBindCodeNode.targetOff(this),this.lastBindCodeNode=null)}realRun(t,e){if(0!=e)if(null!=this.lastBindCodeNode&&this.lastBindCodeNode.targetOff(this),null!=t){this.useCanvas=!1,this.lastBindCodeNode=t,null!=t.node||console.log("realRun lastBindCodeNode 节点已经被销毁"),t.checkAddComponent("SpinePlusComponent");var i=null,r=5,n=null;t.targetOff(this),t.on(cc.Node.EventType.TOUCH_START,(t=>{i=null,n=t.getID();var e=t.getID();this.touchIds[e]=1}),this),t.on(cc.Node.EventType.TOUCH_MOVE,(e=>{if(!(Object.keys(this.touchIds).length>1&&1==this.properties.mutplayTouch)&&n==e.getID()&&1!=this.graph.config.pause)if(null!=this.instance&&r<5)r+=1;else if(r=0,null!=i){var s=t.parent.convertToNodeSpaceAR(e.getLocation()),o=!0;if(1==this.properties.needCheckIn.default){var a=t.getComponent(cc.PolygonCollider);if(null!=a){var l=t.node.convertToNodeSpaceAR(e.getLocation());o=cc.Intersection.pointInPolygon(l,a.points)}}var c=s.sub(i);1==o&&(this.setOutputData(0,c.x),this.setOutputData(1,c.y),this.triggerSlot(2,1),1==this.properties.controllObj&&(t.x+=c.x,t.y+=c.y)),i=s}else i=t.parent.convertToNodeSpaceAR(e.getLocation())}),this),t.on(cc.Node.EventType.TOUCH_END,(t=>{var e=t.getID();delete this.touchIds[e]}),this),t.on(cc.Node.EventType.TOUCH_CANCEL,(t=>{var e=t.getID();delete this.touchIds[e]}),this)}else{this.useCanvas=!0;let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this);i=null,r=5;t.on(cc.Node.EventType.TOUCH_START,(t=>{i=null;var e=t.getID();this.touchIds[e]=1}),this),t.on(cc.Node.EventType.TOUCH_MOVE,(e=>{if(!(Object.keys(this.touchIds).length>1&&1==this.properties.mutplayTouch)&&1!=this.graph.config.pause)if(r<5)r+=1;else if(r=0,null!=i){var n=t.parent.convertToNodeSpaceAR(e.getLocation()),s=n.sub(i);this.setOutputData(0,s.x),this.setOutputData(1,s.y),i=n}else i=t.parent.convertToNodeSpaceAR(e.getLocation())}),this),t.on(cc.Node.EventType.TOUCH_END,(t=>{var e=t.getID();delete this.touchIds[e]}),this),t.on(cc.Node.EventType.TOUCH_CANCEL,(t=>{var e=t.getID();delete this.touchIds[e]}),this)}else if(1==this.useCanvas){let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this),this.useCanvas=!1}else null!=this.lastBindCodeNode&&this.lastBindCodeNode.targetOff(this)}onAction(t,e){if("监听"==t){var i=this.getInputData(0);console.log("我开始监听移动",i),this.realRun(i)}else if("取消监听"==t){i=this.getInputData(0);this.realRun(i,!1)}}setValue(t){this.setProperty("value",t)}}touchMove.title="触摸移动",LiteGraph.registerNodeType("input/screen/touchMove",touchMove);class touchEnd extends LGraphNode{title="触摸结束";desc="检测物体触摸开始";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("监听",LiteGraph.ACTION),this.addInput("取消监听",LiteGraph.ACTION),this.addOutput("结束X","number"),this.addOutput("结束Y","number"),this.addOutput("结束",LiteGraph.EVENT),this.addOutput("点击结束",LiteGraph.EVENT),this.addOutput("移动结束",LiteGraph.EVENT),this.addProperty("controllObj",!1,"boolean"),this.addWidget("toggle","控制物体位置",this.properties.controllObj,"controllObj"),this.addProperty("listernTouchCancel",!1,"boolean"),this.addWidget("toggle","响应触摸取消",this.properties.listernTouchCancel,"listernTouchCancel"),this.touchIds={}}onStart(){}onStop(){if(this.touchIds={},1==this.useCanvas){let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this)}else null!=this.lastBindCodeNode&&(this.lastBindCodeNode.targetOff(this),this.lastBindCodeNode=null)}realRun(t,e){if(0!=e)if(null!=this.lastBindCodeNode&&this.lastBindCodeNode.node.targetOff(this),null!=t){this.useCanvas=!1,this.lastBindCodeNode=t,t.checkAddComponent("SpinePlusComponent"),t.targetOff(this);var i=null;t.on(cc.Node.EventType.TOUCH_START,(e=>{i=t.node.parent.convertToNodeSpaceAR(e.getLocation())}),this);var r=e=>{if(1!=this.graph.config.pause){var r=t.node.parent.convertToNodeSpaceAR(e.getLocation());this.setOutputData(0,r.x),this.setOutputData(1,r.y),1==this.properties.controllObj&&(t.x=r.x,t.y=r.y),i&&r.sub(i).mag()<10?(this.trigger("结束"),this.trigger("点击结束")):(this.trigger("结束"),this.trigger("移动结束"))}};t.on(cc.Node.EventType.TOUCH_END,(t=>{r(t)}),this),t.on(cc.Node.EventType.TOUCH_CANCEL,(t=>{1==this.properties.listernTouchCancel&&r(t)}),this)}else{this.useCanvas=!0;let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this);i=null;t.on(cc.Node.EventType.TOUCH_START,(e=>{i=t.convertToNodeSpaceAR(e.getLocation())}),this);r=e=>{if(1!=this.graph.config.pause){var r=t.convertToNodeSpaceAR(e.getLocation());this.setOutputData(0,r.x),this.setOutputData(1,r.y),r.sub(i).mag()<10?(this.trigger("结束"),this.trigger("点击结束")):(this.trigger("结束"),this.trigger("移动结束"))}};t.on(cc.Node.EventType.TOUCH_END,(t=>{r(t)}),this),t.on(cc.Node.EventType.TOUCH_CANCEL,(t=>{1==this.properties.listernTouchCancel&&r(t)}),this)}else if(1==this.useCanvas){let t=this.graph.config.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),t.targetOff(this)}else null!=this.lastBindCodeNode&&this.lastBindCodeNode.targetOff(this)}onAction(t,e){if("监听"==t){var i=this.getInputData(0);this.realRun(i)}else if("取消监听"==t){i=this.getInputData(0);this.realRun(i,!1)}}setValue(t){this.setProperty("value",t)}}touchEnd.title="触摸结束",LiteGraph.registerNodeType("input/screen/touchEnd",touchEnd);class leftOrRightAct extends LGraphNode{title="重力感应";desc="检测设备的陀螺仪";constructor(){super(),this.addOutput("x轴","number"),this.addOutput("y轴","number"),this.addOutput("z轴","number")}onChangeEvent(t){this.x=t.acc.x,this.y=t.acc.y,this.z=t.acc.z,this.setOutputData(0,this.x),this.setOutputData(1,this.y),this.setOutputData(2,this.z)}onStart(){cc.systemEvent.setAccelerometerEnabled(!0),this.curState=0,this.x=0,this.y=0,this.z=0,this.setOutputData(0,this.x),this.setOutputData(1,this.y),this.setOutputData(2,this.z),cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION,this.onChangeEvent,this)}onStop(){cc.systemEvent.off(cc.SystemEvent.EventType.DEVICEMOTION,this.onChangeEvent,this)}}leftOrRightAct.title="重力感应",LiteGraph.registerNodeType("input/leftOrRightAct",leftOrRightAct);class AddRobot extends LGraphNode{title="加";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A + B","number")}onExecute(){var t=this.getInputData(0);void 0===t&&(t=0);var e=this.getInputData(1);void 0===e&&(e=0),this.setOutputData(0,t+e)}}AddRobot.title="加",LiteGraph.registerNodeType("middle/calculate/add",AddRobot);class delRobot extends LGraphNode{title="减";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A - B","number")}onExecute(){var t=this.getInputData(0);void 0===t&&(t=0);var e=this.getInputData(1);void 0===e&&(e=0),this.setOutputData(0,t-e)}}delRobot.title="减",LiteGraph.registerNodeType("middle/calculate/del",delRobot);class xRobot extends LGraphNode{title="乘";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A x B","number")}onExecute(){var t=this.getInputData(0);void 0===t&&(t=0);var e=this.getInputData(1);void 0===e&&(e=0),this.setOutputData(0,t*e)}}xRobot.title="乘",LiteGraph.registerNodeType("middle/calculate/x",xRobot);class chuRobot extends LGraphNode{title="除";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A ÷ B","number")}onExecute(){var t=this.getInputData(0);void 0===t&&(t=0);var e=this.getInputData(1);void 0===e&&(e=0),this.setOutputData(0,t/e)}}chuRobot.title="除",LiteGraph.registerNodeType("middle/calculate/chu",chuRobot);class lengthRobot extends LGraphNode{title="向量长度";constructor(){super(),this.addInput("x","number"),this.addInput("y","number"),this.addOutput("长度","number")}onExecute(){var t=this.getInputData(0);void 0===t&&(t=0);var e=this.getInputData(1);void 0===e&&(e=0);var i=Math.sqrt(t*t+e*e);this.setOutputData(0,i)}}lengthRobot.title="长度",LiteGraph.registerNodeType("middle/calculate/length",lengthRobot);class tointRobot extends LGraphNode{title="取整数";constructor(){super(),this.addInput("向下取整","number"),this.addInput("向上取整","number"),this.addInput("四舍五入","number"),this.addOutput("输出","number")}onExecute(){var t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);void 0!==t?this.setOutputData(0,Math.floor(t)):void 0!==e?this.setOutputData(0,Math.ceil(e)):void 0!==i&&this.setOutputData(0,Math.round(i))}}tointRobot.title="取整数",LiteGraph.registerNodeType("middle/covert/toint",tointRobot);class squareRootRobot extends LGraphNode{title="平方根";constructor(){super(),this.addInput("输入","number"),this.addOutput("开平方","number")}onExecute(){var t=this.getInputData(0);void 0!==t&&this.setOutputData(0,Math.sqrt(t))}}squareRootRobot.title="平方根",LiteGraph.registerNodeType("middle/covert/squareRoot",squareRootRobot);class absRobot extends LGraphNode{title="绝对值";constructor(){super(),this.addInput("输入","number"),this.addOutput("绝对值","number")}onExecute(){var t=this.getInputData(0);void 0!==t&&this.setOutputData(0,Math.abs(t))}}absRobot.title="绝对值",LiteGraph.registerNodeType("middle/covert/abs",absRobot);class revertNegativeRobot extends LGraphNode{title="正负反转";constructor(){super(),this.addInput("输入","number"),this.addOutput("输出","number")}onExecute(){var t=this.getInputData(0);void 0!==t&&this.setOutputData(0,-1*t)}}revertNegativeRobot.title="正负反转",LiteGraph.registerNodeType("middle/covert/revertNegative",revertNegativeRobot);class angleDifferenceRobot extends LGraphNode{title="角度差";constructor(){super(),this.addInput("角度A","number"),this.addInput("角度B","number"),this.addOutput("输出","number"),this.addProperty("inputType","角度","enum",{values:["角度","向量"]}),this.addWidget("combo","输入的类型",this.properties.inputType,{property:"inputType",values:["角度","向量"]})}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);if(void 0!==t&&void 0!==e){var i=0;if(0==this.properties.inputType||"角度"==this.properties.inputType){var r=Math.max(t,e)-Math.min(t,e);i=Math.min(360-r,r)}else{var n=t.x,s=t.y,o=e.x,a=e.y;let r=(Math.pow(n,2)+Math.pow(s,2)+Math.pow(o,2)+Math.pow(a,2)-(Math.pow(o-n,2)+Math.pow(a-s,2)))/(2*Math.sqrt(Math.pow(n,2)+Math.pow(s,2))*Math.sqrt(Math.pow(o,2)+Math.pow(a,2)));i=Math.acos(r)*(180/Math.PI)}this.setOutputData(0,i)}}}angleDifferenceRobot.title="角度差",LiteGraph.registerNodeType("middle/angleCalculate/angleDifference",angleDifferenceRobot);class vectorToAngelRobot extends LGraphNode{title="将位置转换为角度";constructor(){super(),this.addInput("x坐标","number"),this.addInput("y坐标","number"),this.addOutput("角度","number")}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);if(void 0!==t&&void 0!==e){var i=Math.atan2(this.number2,this.number1)*(180/Math.PI);this.setOutputData(0,i)}}}vectorToAngelRobot.title="将位置转换为角度",LiteGraph.registerNodeType("middle/angleCalculate/vectorToAngel",vectorToAngelRobot);class angleConvertVectorRobot extends LGraphNode{title="将角度转换为位置";constructor(){super(),this.addInput("角度","number"),this.addInput("斜边长","number"),this.addOutput("x长","number"),this.addOutput("y长","number")}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);if(void 0!==t&&void 0!==e){var i=180/Math.PI*t,r=Math.cos(i)*e,n=Math.sin(i)*e;this.setOutputData(0,r),this.setOutputData(1,n)}}}angleConvertVectorRobot.title="将角度转换为位置",LiteGraph.registerNodeType("middle/angleCalculate/angleConvertVector",angleConvertVectorRobot);class equireRobot extends LGraphNode{title="等于";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A == B?","number")}onExecute(){var t=0;this.getInputData(0)==this.getInputData(1)&&(t=1),this.setOutputData(0,t)}}equireRobot.title="等于",LiteGraph.registerNodeType("middle/compare/equire",equireRobot);class litterRobot extends LGraphNode{title="小于";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A < B?","number")}onExecute(){var t=0;this.getInputData(0)<this.getInputData(1)&&(t=1),this.setOutputData(0,t)}}litterRobot.title="小于",LiteGraph.registerNodeType("middle/compare/litter",litterRobot);class biggerRobot extends LGraphNode{title="大于";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A > B?","number")}onExecute(){var t=0;this.getInputData(0)>this.getInputData(1)&&(t=1),this.setOutputData(0,t)}}biggerRobot.title="大于",LiteGraph.registerNodeType("middle/compare/bigger",biggerRobot);class inRangeRobot extends LGraphNode{title="范围内";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addInput("C","number"),this.addOutput("结果","number"),this.addProperty("A",0,"number"),this.addProperty("C",10,"number"),this.addProperty("firstCompire","<","enum",{values:["<","<="]}),this.addProperty("secCompire","<","enum",{values:["<","<="]}),this.addWidget("number","最小值A",0,"A",{precision:0}),this.addWidget("number","最大值C",10,"C",{precision:0}),this.addWidget("combo","A和B比较",this.properties.firstCompire,{property:"firstCompire",values:inRangeRobot.compireType}),this.addWidget("combo","B和C比较",this.properties.secCompire,{property:"secCompire",values:inRangeRobot.compireType})}getTitle(){return"A"+this.properties.firstCompire+"B"+this.properties.secCompire+"C"}onExecute(){var t=this.getInputOrProperty("A"),e=this.getInputData(1),i=this.getInputOrProperty("C"),r=0,n=this.properties.firstCompire,s=this.properties.secCompire;"<"==n&&(r=t<e),"<="==n&&(r=t<=e),"<"==s&&(r=e<i),"<="==s&&(r=e<=i),1==r&&(r=1),this.setOutputData(0,r)}}inRangeRobot.title="范围内",inRangeRobot.compireType=["<","<="],LiteGraph.registerNodeType("middle/compare/inRange",inRangeRobot);class allRightRobot extends LGraphNode{title="全部正确";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addOutput("结果","number")}onExecute(){var t=this.getInputData(0),e=this.getInputData(1),i=0;0!=t&&void 0!==t||(i=0),0!=e&&void 0!==e||(i=0),this.setOutputData(0,i)}}allRightRobot.title="全部正确",LiteGraph.registerNodeType("middle/logic/allRight",allRightRobot);class orRightRobot extends LGraphNode{title="任意一个正确";constructor(){super(),this.addInput("A","number"),this.addInput("B","number"),this.addInput("C","number"),this.addOutput("结果","number")}onExecute(){var t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2),r=0;void 0!==t&&0!=t&&(r=1),void 0!==e&&0!=e&&(r=1),void 0!==i&&0!=i&&(r=1),this.setOutputData(0,r)}}orRightRobot.title="任意一个正确",LiteGraph.registerNodeType("middle/logic/orRight",orRightRobot);class allToggle extends LGraphNode{title="全部触发";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("触发_0",LiteGraph.ACTION),this.addInput("触发_1",LiteGraph.ACTION),this.addOutput("触发",LiteGraph.EVENT),this.addProperty("resetWhenToggle",!1,"boolean"),this.addWidget("toggle","触发后重置",this.properties.resetWhenToggle,"resetWhenToggle"),this.toggleFlag={}}onStop(){this.toggleFlag={}}onGetInputs(){return[["触发_"+this.inputs.length,LiteGraph.ACTION]]}onAction(t,e,i){this.toggleFlag[t]=1,Object.keys(this.toggleFlag).length==this.inputs.length&&(this.triggerSlot(0),1==this.properties.resetWhenToggle&&(this.toggleFlag={}))}}allToggle.title="全部触发",LiteGraph.registerNodeType("middle/logic/allToggle",allToggle);class orToggle extends LGraphNode{title="任意触发";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("触发_0",LiteGraph.ACTION),this.addInput("触发_1",LiteGraph.ACTION),this.addOutput("触发",LiteGraph.EVENT)}getFreeSoltIndex(){let t=this.findSlotByType(!0,LiteGraph.ACTION,!1,!0,!0);return-1==t&&(this.addInput("触发_"+this.inputs.length,LiteGraph.ACTION),t=this.inputs.length-1),t}checkHasConnectMyInput(t){let e=!1;for(var i=0;i<this.inputs.length;i++){let r=this.getInputNode(i);if(null!=r&&r.id==t.id){e=!0;break}}return e}findConnectSoltIndex(t){let e=-1;for(var i=0;i<this.inputs.length;i++){let r=this.getInputNode(i);if(null!=r&&r.id==t){e=i;break}}return e}onGetInputs(){return[["触发_"+this.inputs.length,LiteGraph.ACTION]]}onAction(t,e,i){this.triggerSlot(0)}}orToggle.title="任意触发",LiteGraph.registerNodeType("middle/logic/orToggle",orToggle);class notRightRobot extends LGraphNode{title="反转结果";constructor(){super(),this.addInput("A","number"),this.addOutput("结果","number")}onExecute(){var t=this.getInputData(0)?0:1;this.setOutputData(0,t)}}notRightRobot.title="反转结果",LiteGraph.registerNodeType("middle/logic/notRight",notRightRobot);class randomNumRobot extends LGraphNode{title="随机整数";des="如果没有输入值，返回一个大于0的随机整数";constructor(){super(),this.addInput("随机范围","number"),this.addOutput("结果","number"),this.addProperty("modal","每次随机","enum",{values:["仅一次","每次随机"]}),this.addWidget("combo","",this.properties.modal,{property:"modal",values:["仅一次","每次随机"]})}onExecute(){var t=this.getInputData(0);if(void 0===t&&(t=1e7),"每次随机"==this.properties.modal){var e=Math.floor(Math.random()*t);this.setOutputData(0,e)}else null==this.random&&(this.random=Math.floor(Math.random()*t),this.setOutputData(0,this.random))}}randomNumRobot.title="随机整数",LiteGraph.registerNodeType("middle/change/randomNum",randomNumRobot);class timeDownRobot extends LGraphNode{title="延迟触发";desc="等待时间如果为0的话表示等待1帧。输入的值不为0时即执行倒计时，输入值为0时停止倒计时，输出的值为当前输出帧和上一帧的时间差";constructor(){super(),this.addProperty("time_in_s",1),this.widget=this.addWidget("number","秒",1,"time_in_s",{precision:2,min:0,step:.1}),this.addInput("开始",LiteGraph.ACTION),this.addOutput("结束时",LiteGraph.EVENT),this._pending=[]}onAction(t,e,i){var r=this.properties.time_in_s;r<=0?this.triggerSlot(0):this._pending.push([r,e])}onExecute(){var t=this.graph.elapsed_time;this.isInputConnected(1)&&(this.properties.time_in_s=this.getInputData(1));for(var e=0;e<this._pending.length;++e){var i=this._pending[e];i[0]-=t,i[0]>0||(this._pending.splice(e,1),--e,this.triggerSlot(0))}}onGetInputs(){return[["time_in_s","number"]]}onStop(){this._pending=[]}}timeDownRobot.title="延迟触发",LiteGraph.registerNodeType("middle/change/timeDown",timeDownRobot);class timerRobot extends LGraphNode{title="间隔触发";desc="等待时间如果为0的话表示等待1帧。输入的值不为0时即执行倒计时，输入值为0时停止倒计时，输出的值为当前输出帧和上一帧的时间差";constructor(){super(),this.addProperty("interval",1e3),this.addProperty("event","tick"),this.widget=this.addWidget("number","毫秒",1e3,"interval",{precision:0}),this.addOutput("触发",LiteGraph.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}getTitle(){return this.graph.state==LGraph.STATUS_RUNNING?"每隔"+this.last_interval.toString()+"ms":timerRobot.title}onStart(){this.time=0}onAction(t,e,i){var r=this.properties.interval;r<=0?this.trigger(null,e,i):this._pending.push([r,e])}onExecute(){var t=1e3*this.graph.elapsed_time,e=0==this.time;this.time+=t,this.last_interval=Math.max(1,0|this.getInputOrProperty("interval")),e||!(this.time<this.last_interval||isNaN(this.last_interval))?(this.triggered=!0,this.time=this.time%this.last_interval,this.triggerSlot(0,this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)):this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1)}onDrawBackground(){this.boxcolor=this.triggered?timerRobot.on_color:timerRobot.off_color,this.triggered=!1}onGetInputs(){return[["interval","number"]]}}timerRobot.on_color="#AAA",timerRobot.off_color="#222",timerRobot.title="间隔触发",LiteGraph.registerNodeType("middle/change/timeDownCycle",timerRobot);class upCountRobot extends LGraphNode{title="计数";desc="等待时间如果为0的话表示等待1帧。输入的值不为0时即执行倒计时，输入值为0时停止倒计时，输出的值为当前输出帧和上一帧的时间差";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("开始值","number"),this.addInput("增加",LiteGraph.ACTION),this.addInput("减少",LiteGraph.ACTION),this.addInput("重置",LiteGraph.ACTION),this.addOutput("数值","number"),this.addOutput("变化",LiteGraph.EVENT),this.addProperty("开始值",0,"number"),this.addWidget("number","开始值",0,"开始值",{precision:0}),this.addProperty("modal","无限制","enum",{values:["无限制","范围限制","循环","来回"]}),this.addWidget("combo","模式",this.properties.modal,{property:"modal",values:["无限制","范围限制","循环","来回"]}),this.addProperty("min",1,"number"),this.addWidget("number","最小值",1,"min",{precision:0}),this.addProperty("max",10,"number"),this.addWidget("number","最大值",10,"max",{precision:0}),this.addProperty("upStepmodal","不乘以时间","enum",{values:["乘以时间","不乘以时间"]}),this.addWidget("combo","步进模式",this.properties.upStepmodal,{property:"upStepmodal",values:["乘以时间","不乘以时间"]}),this.addProperty("stepValue",1,"number"),this.addWidget("number","步进数值",1,"stepValue",{precision:0}),this.updateWidght()}onStart(){this.repetDir=1,this.value=0|this.getInputOrProperty("开始值")}updateWidght(){"无限制"!=this.properties.modal?this.widgets.map((t=>{"最大值"!=t.name&&"最小值"!=t.name||(t.disabled=!1)})):this.widgets.map((t=>{"最大值"!=t.name&&"最小值"!=t.name||(t.disabled=!0)}))}onWidgetChanged(t,e,i,r){"模式"==t&&this.updateWidght()}onAction(t,e,i){var r=this.getInputOrProperty("开始值")||0;null==this.value&&(this.value=r),"增加"==t?this.upCount(1):"减少"==t?this.upCount(-1):"重置"==t&&(this.value=r,this.setOutputData(0,this.value))}upCount(t){var e=this.properties.stepValue,i=this.properties.min,r=this.properties.max,n="不乘以时间"==this.properties.upStepmodal?1:1e3*this.graph.elapsed_time,s=this.properties.modal;this.value+=this.repetDir*n*e*t,"范围限制"==s?this.value>r&&(this.value=r):"循环"==s?this.value>r&&(this.value=i):"来回"==s&&(this.number>=r?this.repetDir=-1:this.number<=i&&(this.repetDir=1)),this.setOutputData(0,this.value),this.triggerSlot(1)}onExecute(){this.upCount(1)}}upCountRobot.title="计数",LiteGraph.registerNodeType("middle/change/upCount",upCountRobot);class checkTagRobot extends LGraphNode{title="标记状态";des="用于标记一个执行中的状态";constructor(){super(),this.addInput("值","number"),this.addInput("修改",LiteGraph.ACTION),this.addOutput("输出","number"),this.addProperty("customeName","","string"),this.addWidget("text","状态名称","","customeName"),this.addProperty("customeValue","","string"),this.addWidget("text","初始值","","customeValue"),this.addProperty("container",checkTagRobot.GRAPH,"enum",{values:checkTagRobot.containerEnum}),this.addWidget("combo","状态权限",this.properties.container,{property:"container",values:checkTagRobot.containerEnum}),this.addProperty("modal","自定义","enum",{values:checkTagRobot.modalEnum}),this.addWidget("combo","",this.properties.modal,{property:"modal",values:checkTagRobot.modalEnum}),this.addProperty("initWithValue",!1,"boolean"),this.addWidget("toggle","初始化时将自定义状态值赋值",this.properties.initWithValue,"initWithValue"),this.updateWidght()}updateWidght(){"自定义"==this.properties.modal?this.widgets.map((t=>{"状态名称"==t.name&&(t.disabled=!1)})):this.widgets.map((t=>{"状态名称"==t.name&&(t.disabled=!0)}))}onWidgetChanged(t,e,i,r){console.log("onWidgetChanged",t,e,i),""==t&&this.updateWidght()}getContainer(){switch(this.properties.container){case checkTagRobot.GRAPH:return this.graph?this.graph.vars:{};case checkTagRobot.GLOBALSCOPE:return window;case checkTagRobot.LITEGRAPH:default:return LiteGraph.Globals}}getVarName(){return"自定义"!=this.properties.modal?this.properties.modal:this.properties.customeName}getTitle(){return this.getVarName()}onStart(){var t=this.getContainer(),e=this.getVarName();""!=this.properties.customeValue&&(this.value=this.properties.customeValue,t[e]=this.value,this.setOutputData(0,this.value))}onAction(t,e,i){if("修改"==t){var r=this.getContainer(),n=this.getVarName();this.isInputConnected(0)?this.value=this.getInputData(0):this.value=this.properties.customeValue,r[n]=this.value,this.setOutputData(0,this.value)}}onExecute(){var t=this.getContainer(),e=this.getVarName();this.setOutputData(0,t[e])}}checkTagRobot.modalEnum=["自定义","动画是否播放中","是否不可交互","游戏是否开始","游戏是否结束","引导是否显示","当前执行逻辑","逻辑A是否触发","逻辑B是否触发","逻辑C是否触发","逻辑D是否触发"],checkTagRobot.LITEGRAPH="所有分镜",checkTagRobot.GRAPH="仅当前分镜",checkTagRobot.GLOBALSCOPE="Window",checkTagRobot.containerEnum=[checkTagRobot.GRAPH,checkTagRobot.LITEGRAPH,checkTagRobot.GLOBALSCOPE],checkTagRobot.title="标记状态",LiteGraph.registerNodeType("middle/change/checkTag",checkTagRobot);class dataObjectRobot extends LGraphNode{title="数据结构";desc="输出对象的key和values，如果挂载的是对象，循环对象中每个key，如果是数组，循环数组每个i，每每次循环都会触发toggle事件";constructor(){super(),this.addInput("挂载","object"),this.addOutput("key",0),this.addOutput("value",0),this.addOutput("触发",LiteGraph.EVENT)}onGetOutputs(){return console.log("我调用了onGetOutputs"),[["number","string"],["被引用","lgraphNode"]]}onStart(){}onExecute(){var t=this.getInputData(0);if(void 0!==t)if(t instanceof Array)for(var e=0;e<t.length;e++)this.setOutputData(0,e),this.setOutputData(1,t[e]),this.triggerSlot(2);else if(t instanceof Object)for(var i in t)this.setOutputData(0,i),this.setOutputData(1,t[i]),this.triggerSlot(2)}}dataObjectRobot.title="数据结构",LiteGraph.registerNodeType("middle/change/dataObject",dataObjectRobot);class getKeyValueRobot extends LGraphNode{title="对象取值";desc="和数据结构不同的是，这里取出特定的某个值";constructor(){super(),this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.addWidget("text","输入key","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}getTitle(){return this.flags.collapsed?"获取."+this.properties.value:this.title}onGetOutputs(){return console.log("我调用了onGetOutputs"),[["number","string"],["被引用","lgraphNode"]]}onExecute(){var t=this.getInputData(0);null!=t&&this.setOutputData(0,t[this.properties.value])}}getKeyValueRobot.title="对象取值",LiteGraph.registerNodeType("middle/change/getKeyValue",getKeyValueRobot);class getArrayValueRobot extends LGraphNode{title="数组取值";desc="和数据结构不同的是，这里取出特定的某个值";constructor(){super(),this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0),this.addWidget("number","index",0,"index",{precision:0})}getTitle(){return this.flags.collapsed?"获取."+this.properties.index:this.title}onGetOutputs(){return console.log("我调用了onGetOutputs"),[["number","string"],["被引用","lgraphNode"]]}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);null==e&&(e=this.properties.index),null!=t&&null!=e&&this.setOutputData(0,t[Math.floor(Number(e))])}}getArrayValueRobot.title="数组取值",LiteGraph.registerNodeType("middle/change/getArrayValue",getArrayValueRobot);class sendData extends LGraphNode{title="无线传送发射";desc="用于无线连接节点";constructor(){super(),this.addInput("附带值",0),this.addInput("发送",LiteGraph.ACTION),this.addProperty("customeName","A","string"),this.addWidget("string","发送事件",this.properties.customeName,"customeName")}getTitle(){return this.flags.collapsed?"发送事件."+this.properties.customeName:this.title}onAction(t,e){let i=this.getInputData(0);this.graph.sendEventToAllNodes(this.properties.customeName,i)}}sendData.title="无线传送发射",LiteGraph.registerNodeType("middle/tool/sendData",sendData);class acceptData extends LGraphNode{title="无线传送接收";desc="用于无线连接节点";constructor(){super(),this.size=[140,30],this.addOutput("接收值",0),this.addOutput("接收",LiteGraph.EVENT),this.addProperty("customeName","A","string"),this.addWidget("string","接收事件",this.properties.customeName,"customeName")}onStart(){this[this.properties.customeName]=this.onEvent}getTitle(){return this.flags.collapsed?"接收事件."+this.properties.customeName:this.title}onEvent(t){console.log("我接收到了事件",t),this.setOutputData(0,t),this.triggerSlot(1,t)}}acceptData.title="无线传送接收",LiteGraph.registerNodeType("middle/tool/acceptData",acceptData);class outputLine extends LGraphNode{title="输出逻辑线";desc="根据输入值，触发不同的输出";constructor(){super(),this.addInput("输入值","number"),this.addInput("触发",LiteGraph.ACTION),this.addOutput("output_0",LiteGraph.EVENT),this.addOutput("output_1",LiteGraph.EVENT)}onGetOutputs(){return[["output_"+this.outputs.length,LiteGraph.EVENT],["被引用","lgraphNode"]]}onAction(t,e){let i=Number(this.getInputData(0));console.log("当前outputLine输入的值",i),null!=this.outputs[i]&&this.triggerSlot(i)}}outputLine.title="输出逻辑线",LiteGraph.registerNodeType("middle/tool/outputLine",outputLine);class lightingOut extends LGraphNode{title="动态取值";desc="动态输出需要的值";constructor(){super(),this.addInput("引用节点","lgraphNode")}onGetOutputs(){let t=this.getInputNode(0);if(null==t)return[];{let r={};for(var e=0;e<this.outputs.length;e++){r[this.outputs[e].name]=1}let n=[];for(var i in t.properties)null==r[i]&&n.push([i,0]);return n}}onExecute(){let t=this.getInputNode(0);for(var e=0;e<this.outputs.length;e++){let i=this.outputs[e];this.setOutputData(e,t.properties[i.name])}}}lightingOut.title="动态取值",LiteGraph.registerNodeType("middle/tool/lightingOut",lightingOut);class lighting extends LGraphNode{title="动态赋值";desc="动态设置引用节点的值";constructor(){super(),this.addInput("引用节点","lgraphNode"),this.addInput("触发赋值",LiteGraph.ACTION)}onGetInputs(){let t=this.getInputNode(0);if(null==t)return[];{let r={};for(var e=0;e<this.inputs.length;e++){r[this.inputs[e].name]=1}let n=[];for(var i in t.properties)null==r[i]&&n.push([i,0]);return n}}onAction(t,e){let i=this.getInputNode(0);if(null!=i&&!(this.inputs.length<2))for(var r=2;r<this.inputs.length;r++){let t=this.inputs[r],e=this.getInputData(r);null!=i.properties[t.name]&&null!=e&&i.setProperty(t.name,e)}}}lighting.title="动态赋值",LiteGraph.registerNodeType("middle/tool/lighting",lighting);class textCode extends LGraphNode{title="js文本";desc="直接运行代码片段";constructor(){super(),this.mode=LiteGraph.ON_TRIGGER,this.addInput("输入参数",0),this.addOutput("输出结果",0),this.addProperty("codeString","","string"),this.addWidget("text","执行代码片段",this.properties.codeString,"codeString",{multiline:!0})}onExecute(){this.getInputData(0);var valueB=0;let codeString=this.properties.codeString;try{eval(codeString)}catch(error){console.warn("文本代码执行失败",error)}this.setOutputData(0,valueB)}}textCode.title="js文本",LiteGraph.registerNodeType("middle/tool/textCode",textCode);const Constants={APP_ID:"145d2560",API_KEY:"4c75d2411acf143f4145ba8b72a03bdc",API_SECRET:"MTM3ZWQ2Y2Y4ZmEyMTEwYWVmMDg3NmRk"},config={hostUrl:"wss://cbm01.cn-huabei-1.xf-yun.com/v1/private/mcd9m97e6",host:"cbm01.cn-huabei-1.xf-yun.com",apiSecret:"MTM3ZWQ2Y2Y4ZmEyMTEwYWVmMDg3NmRk",apiKey:"4c75d2411acf143f4145ba8b72a03bdc"};function base64ToBlob(t,e){e=e||"";const i=t,r=i.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=i.charCodeAt(s);return new Blob([n],{type:e})}function getAuthUrl(){var t=config.hostUrl,e=config.host,i=config.apiKey,r=config.apiSecret,n=(new Date).toGMTString(),s=`host: ${e}\ndate: ${n}\nGET /v1/private/mcd9m97e6 HTTP/1.1`,o=cryptoJsExports.HmacSHA256(s,r),a=cryptoJsExports.enc.Base64.stringify(o);return t=`${t}?authorization=${btoa(`api_key="${i}", algorithm="hmac-sha256", headers="host date request-line", signature="${a}"`)}&date=${n}&host=${e}`}class VoiceGen{static async genSound(t){return new Promise(((e,i)=>{try{const i=getAuthUrl(),r=new WebSocket(i),n={header:{app_id:Constants.APP_ID,status:2},parameter:{oral:{spark_assist:1,oral_level:"mid"},tts:{vcn:t.vcn,speed:t.speed,volume:t.volume,pitch:t.pitch,bgs:t.bgs,reg:0,rdn:0,rhy:0,audio:{encoding:"lame",sample_rate:24e3,channels:1,bit_depth:16,frame_size:0}}},payload:{text:{encoding:"utf8",compress:"raw",format:"json",status:2,seq:0,text:window.btoa(unescape(encodeURIComponent(t.text)))}}};console.log(n);let s="";r.onopen=t=>{r.send(JSON.stringify(n))},r.onclose=t=>{},r.onmessage=t=>{let i=JSON.parse(t.data);if(null!=i.payload&&null!=i.payload.audio.audio&&(s+=window.atob(i.payload.audio.audio),2==i.payload.audio.status)){let t=base64ToBlob(s,"audio/mp3");e(t),r.close()}},r.onerror=t=>{console.error(t),e(null)}}catch(r){console.error(r),e(null)}}))}}class showTextTip extends LGraphNode{title="文字提示";desc="弹出文字提示信息";color="#510";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addProperty("msg",""),this.addInput("",LiteGraph.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}onExecute(){}setValue(t){this.setProperty("value",t)}onAction(t,e){showAlert(this.properties.msg)}}showTextTip.title="文字提示",LiteGraph.registerNodeType("output/tips/showTextTip",showTextTip);class showConfirm extends LGraphNode{title="确认框";desc="弹出文字提示确认框，用户可点击确认或取消";color="#510";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addProperty("msg",""),this.addInput("",LiteGraph.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.addOutput("确认",LiteGraph.EVENT),this.addOutput("取消",LiteGraph.EVENT)}onAction(t,e){showConfirm$1(this.properties.msg,(t=>{1==t?this.trigger("确认"):this.trigger("取消")}))}}showConfirm.title="确认框",LiteGraph.registerNodeType("output/tips/showConfirm",showConfirm);class showHandTip extends LGraphNode{title="触摸提示";desc="播放一个触摸提示的动画";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("显示",LiteGraph.ACTION),this.addInput("关闭",LiteGraph.ACTION),this.addOutput("结束",LiteGraph.EVENT),this.properties.modal=showHandTip.modalEnum[0],this.addWidget("combo","类型",this.properties.modal,{property:"modal",values:showHandTip.modalEnum}),this.properties.scale=1,this.addWidget("number","大小",this.properties.scale,"scale",{precision:1}),this.properties.x=0,this.addWidget("number","拖拽终点-x",this.properties.x,"x",{precision:0}),this.properties.y=0,this.addWidget("number","拖拽终点-y",this.properties.y,"y",{precision:0}),this.properties.length=100,this.addWidget("number","长度或半径",this.properties.length,"length",{precision:0}),this.properties.speed=400,this.addWidget("number","速度",this.properties.length,"speed",{precision:0}),this.updateWidght(),this.addWidget("button","预览效果","",(()=>{this.showTips()})),this.addWidget("button","创建触摸动画","",(()=>{this.createLinkNode()}))}createLinkNode(){if(null==this.getInputNode(0)){let t=LiteGraph.createNode("objects/createObject");t.pos=[this.pos[0]-this.width-3,this.pos[1]],t.setProperty("x",0),t.setProperty("y",0),t.setProperty("modal",ObjectTypeEnum.spine),t.setProperty("customeName","P0_Common_Finger"),t.properties.nodeConfig.x=0,t.properties.nodeConfig.y=0,this.graph.add(t),t.connect(0,this,0)}}updateWidght(){var t=this.properties.modal;this.widgets.map((e=>{"拖拽终点-x"==e.name||"拖拽终点-y"==e.name?e.disabled="拖拽"!=t:"长度或半径"==e.name?e.disabled="拖拽"==t||"单次点击"==t||"快速点击"==t||"长按"==t:"速度"==e.name&&(e.disabled="单次点击"==t||"快速点击"==t||"长按"==t)}))}onWidgetChanged(t){"类型"==t&&this.updateWidght()}onSelected(){this.showTips()}upDateOriPos(){var t=this.getInputLink(0);if(null==t)return;var e=this.graph.getNodeById(t.origin_id);if(null==e)return;let i=this.getInputData(0);null!=e.properties.x&&null!=i&&(i.x=e.properties.x,i.y=e.properties.y)}onDeselected(){this.hideTips();let t=this.getInputData(0);null!=this.oriX&&null!=t&&(t.x=this.oriX,t.y=this.oriY)}onPause(){1==this.inShowTips&&this.hideTips()}onResume(){1==this.inShowTips&&this.showTips()}onStop(){}showTips(){let t=this.getInputData(0);if(null!=t){t.useCenterMode=!1,cc.Tween.stopAllByTarget(this),cc.Tween.stopAllByTag(this.getIdWithGraph()),this.upDateOriPos(),t.center=[t.x,t.y],t.active=!0,t.scale=this.properties.scale;var e=showHandTip.modalEnum.indexOf(this.properties.modal),i=t.spineCom;if(null!=i)if(0==e)i.setAnimation(0,"act1",!0),i.setCompleteListener((t=>{this.outputHandle()}));else if(1==e)i.setAnimation(0,"act2",!0),i.setCompleteListener((t=>{this.outputHandle()}));else if(2==e){i.setAnimation(0,"act3_1",!1),i.addAnimation(0,"act3_2",!0);var r=this.properties.x,n=this.properties.y,s=t.x-r,o=t.y-n;if(0==this.properties.speed)return;if(0==(l=Math.sqrt(o*o+s*s)/this.properties.speed))return;cc.tween(t).tag(this.getIdWithGraph()).delay(.3).to(l,{x:r,y:n}).call((()=>{i.loop=!1,i.addAnimation(0,"act3_3",!1),cc.tween(this).delay(1).call((()=>{this.outputHandle(),this.showTips()})).start()})).start()}else if(3==e){var a=this.properties.length;if(0==this.properties.speed)return;var l=a/this.properties.speed;if(i.setAnimation(0,"act3_2",!0),0==l)return;cc.tween(t).tag(this.getIdWithGraph()).to(l,{y:t.y-a}).to(2*l,{y:t.y+a}).to(l,{y:t.y}).call((()=>{this.outputHandle(),this.showTips()})).start()}else if(4==e){a=this.properties.length;if(0==this.properties.speed)return;l=Math.abs(a/this.properties.speed);if(i.setAnimation(0,"act3_2",!0),0==l)return;cc.tween(t).tag(this.getIdWithGraph()).to(l,{x:t.x-a}).to(2*l,{x:t.x+a}).to(l,{x:t.x}).call((()=>{this.outputHandle(),this.showTips()})).start()}else if(5==e){if(t.radius=this.properties.length,t.useCenterMode=!0,0==this.properties.speed)return;if(0==(l=Math.abs(2*Math.PI/(.01*this.properties.speed))))return;i.setAnimation(0,"act3_2",!0);var c=this.properties.speed>0?360:-360;cc.tween(t).tag(this.getIdWithGraph()).by(l,{angleToPos:c}).call((()=>{this.outputHandle(),this.showTips()})).start()}else 6==e&&(i.setAnimation(0,"act3_1",!1),i.addAnimation(0,"act3_2",!0),cc.tween(this).delay(2).call((()=>{i.loop=!1,i.addAnimation(0,"act3_3",!1),cc.tween(this).delay(.8).call((()=>{this.outputHandle(),this.showTips()})).start()})).start());else console.warn("showTip 目标没有spine")}else console.warn("showTips 当前没有关联codeNode")}outputHandle(){this.triggerSlot(0)}hideTips(){cc.Tween.stopAllByTarget(this);let t=this.getInputData(0);null!=t?null!=t&&(t.useCenterMode=!1,cc.Tween.stopAllByTag(this.getIdWithGraph()),null!=t.spineCom&&t.spineCom.clearTrack(0),t.active=!1):console.warn("showTips 当前没有关联codeNode")}onStart(){this.onAction("关闭")}onAction(t,e){"显示"==t?(this.inShowTips=!0,this.showTips()):"关闭"==t&&(this.inShowTips=!1,this.hideTips())}}showHandTip.title="触摸提示",showHandTip.modalEnum=["单次点击","快速点击","拖拽","上下滑动","左右滑动","转圈","长按"],LiteGraph.registerNodeType("output/tips/showHandTip",showHandTip);class blockTouch extends LGraphNode{title="屏蔽触摸";desc="屏蔽触摸事件，简化流程";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("开启",LiteGraph.ACTION),this.addInput("关闭",LiteGraph.ACTION)}onStop(){blockTouch$1(!1)}onAction(t,e){"开启"==t?blockTouch$1(!0):"关闭"==t&&blockTouch$1(!1)}}blockTouch.title="屏蔽触摸",LiteGraph.registerNodeType("output/blockTouch",blockTouch);class consoleInfo extends LGraphNode{title="输出控制台";desc="打印内容到控制台";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("msg",0),this.addInput("log",LiteGraph.ACTION),this.addInput("warn",LiteGraph.ACTION),this.addInput("error",LiteGraph.ACTION),this.addProperty("msg",""),this.addWidget("string","msg",this.properties.msg,"msg"),this.widgets_up=!0}onExecute(){var t=this.getInputOrProperty("msg");console.log("consoleInfo:",t)}setValue(t){this.setProperty("value",t)}onGetInputs(){return[["log",LiteGraph.ACTION],["warn",LiteGraph.ACTION],["error",LiteGraph.ACTION]]}onAction(t,e){var i=this.getInputOrProperty("msg");"log"==t?console.log("consoleInfo",i):"warn"==t?console.warn("consoleInfo",i):"error"==t&&console.error("consoleInfo",i)}onDrawBackground(t){null!=this.getInputData(0)?this.inputs[0].label="msg:"+this.getInputData(0):this.inputs[0].label="msg"}}consoleInfo.title="输出控制台",LiteGraph.registerNodeType("output/tips/consoleInfo",consoleInfo);class restartGame extends LGraphNode{title="重新开始";desc="重新开始游戏流程";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("重启",LiteGraph.ACTION)}onAction(t,e){"重启"==t&&(this.graph.stop(),this.graph.start())}}restartGame.title="重新开始",LiteGraph.registerNodeType("output/game/restartGame",restartGame);class changeGame extends LGraphNode{title="切换页面";desc="切换到新的页面";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addProperty("pageIndex",0,"number"),this.addWidget("number","页码",this.properties.pageIndex,"pageIndex",{precision:0,min:1}),this.addProperty("gamePath","","string"),this.addWidget("string","页面名称",this.properties.gamePath,"gamePath"),this.addInput("切换",LiteGraph.ACTION)}onAction(t,e){"切换"==t&&(this.graph.stop(),changeGraph(this.properties.gamePath,this.properties.pageIndex-1))}}changeGame.title="切换页面",LiteGraph.registerNodeType("output/game/changeGame",changeGame);class endGame extends LGraphNode{title="页面结束";desc="这一页阅读结束了";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("结束",LiteGraph.ACTION)}onAction(t,e){}}endGame.title="页面结束",LiteGraph.registerNodeType("output/game/endGame",endGame);class sendEventToBook extends LGraphNode{title="通知绘本操作";desc="操作绘本相关事件";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("触发",LiteGraph.ACTION),this.addInput("param",0),this.addProperty("modal","隐藏底部字幕","string"),this.addWidget("combo","事件",this.properties.modal,{property:"modal",values:sendEventToBook.modalEnum}),this.addProperty("param","","string"),this.addWidget("string","附加信息",this.properties.param,"param"),this.widgets_up=!0,this.setSize(this.computeSize())}onAction(t,e){}}sendEventToBook.title="通知绘本操作",sendEventToBook.modalEnum=["隐藏底部字幕"],sendEventToBook.modalEnumDit={"隐藏底部字幕":"OnHideReadText"},LiteGraph.registerNodeType("output/game/sendEventToBook",sendEventToBook);class sound extends LGraphNode{title="播放音频";desc="播放一段音频";constructor(){super(),this.mode=LiteGraph.ALWAYS,this.addInput("播放",LiteGraph.ACTION),this.addInput("停止",LiteGraph.ACTION),this.addInput("字幕","array"),this.addOutput("结束",LiteGraph.EVENT),this.addOutput("是否结束","boolean"),this.addProperty("modal","自定义","string"),this.addWidget("combo","选择音频",this.properties.modal,{property:"modal",values:sound.modalEnum}),this.addProperty("customeName","","string"),this.addWidget("string","资源",this.properties.customeName,"customeName"),this.addProperty("yinggui","无","enum"),this.addWidget("combo","选择音轨",this.properties.yinggui,{property:"yinggui",values:["无","A","B","C","D","E","F","G"]}),this.addProperty("loop",!1,"boolean"),this.addWidget("toggle","是否循环",this.properties.loop,"loop"),this.addProperty("volume",.5,"number"),this.addWidget("slider","音量",this.properties.volume,"volume",{min:0,max:1,precision:2,step2:.01}),this.addProperty("autoRun",!1,"boolean"),this.addWidget("toggle","是否自动播放",this.properties.autoRun,"autoRun"),this.addProperty("delayTime",0,"number"),this.addWidget("number","延迟几秒播放",this.properties.delayTime,"delayTime"),this.addProperty("duration",0,"number"),this.addWidget("number","音频时长",this.properties.duration,"duration").disabled=!0,this.addWidget("button","","",(t=>{console.log("btnWidget",t.clickeName),""!=t.clickeName&&this.onAction(t.clickeName)}),{buttons:["播放","停止"]}),this.addProperty("motionTextData",[],"array"),this.addWidget("button","编辑字幕","",(()=>{null!=window.onGraphMenuClick&&window.onGraphMenuClick("editSoundText",{customeName:this.properties.customeName,motionTextData:this.properties.motionTextData,id:this.getIdWithGraph(),onValueChange:t=>{if(console.log("返回的data",t),null==this.getInputNode(2)){let i=LiteGraph.createNode("objects/createObject");i.pos=[this.pos[0]-30,this.pos[1]],i.setProperty("zIndex",996),i.setProperty("x",0),i.setProperty("y",0),this.graph.add(i);let r=LiteGraph.createNode("objects/textGroup");r.pos=[this.pos[0]-10,this.pos[1]],this.graph.add(r);for(var e=0;e<t.length;e++)r.addLine(),r.setProperty("text"+(e+1),t[e].text);i.connect(0,r,0),r.connect(0,this,2),r.freshTexts(t),null!=window.onGraphMenuClick&&(this.graph.setDirtyCanvas(!0,!0),window.onGraphMenuClick("layoutNodesJustX"))}else{let i=this.getInputNode(2);for(;0!=i.properties.linesNum;)i.removeLine();for(e=0;e<t.length;e++)i.addLine(),i.setProperty("text"+(e+1),t[e].text);i.freshTexts(t)}}})}))}onPropertyChanged(t,e){if("customeName"==t){var i=e;this.clip=null,cc.assetManager.loadRemote(rootHost+"/"+i,((t,e)=>{null==t?(this.clip=e,this.setProperty("duration",e.duration)):console.warn("加载音频失败",t)}))}else"modal"==t&&"自定义"!=e&&this.setProperty("customeName",sound.modalDit[e])}onStart(){if(null!=this.properties.motionTextData&&this.properties.motionTextData.length>0){let t=this.getInputNode(2);null!=t&&t.freshTexts(this.properties.motionTextData)}this.properties.autoRun&&this.onAction("播放")}onPause(){null!=this.audioID&&cc.audioEngine.pause(this.audioID)}onResume(){null!=this.audioID&&cc.audioEngine.resume(this.audioID)}getTitle(){return this.flags.collapsed?"播放音频."+this.properties.customeName.split(".")[0]:this.title}onConfigure(){this.updateWidght()}updateWidght(){var t=this.properties.modal;this.widgets.map((e=>{"资源"==e.name&&(e.disabled="自定义"!=t)}))}onWidgetChanged(t){"选择音频"==t&&this.updateWidght()}onStop(){this.onAction("停止")}realPlayAudio(){let t=this.properties.yinggui,e=this.graph.config.audioArray,i=this.properties.volume;1==this.graph.config.mute&&(i=0);var r=this.properties.customeName;if(console.log("准备播放音频",r),null==this.clip)cc.assetManager.loadRemote(rootHost+"/"+r,((r,n)=>{if(null==r){if("无"==t||e[t]==this.getIdWithGraph()){n.addRef(),this.clip=n;var s=cc.audioEngine.play(n,this.properties.loop,i);null!=this.audioID&&cc.audioEngine.stop(this.audioID),this.audioID=s,cc.audioEngine.setFinishCallback(this.audioID,(()=>{this.triggerSlot(0),this.setOutputData(1,!0),null!=this.playEndCb&&this.playEndCb()}))}}else console.warn("加载音频失败",r)}));else{if("无"!=t&&e[t]!=this.getIdWithGraph())return;var n=cc.audioEngine.play(this.clip,this.properties.loop,i);null!=this.audioID&&cc.audioEngine.stop(this.audioID),this.audioID=n,cc.audioEngine.setFinishCallback(this.audioID,(()=>{this.triggerSlot(0),this.setOutputData(1,!0),null!=this.playEndCb&&this.playEndCb()}))}}onAction(t,e){let i=this.properties.yinggui,r=this.graph.config.audioArray;if(null==r&&(this.graph.config.audioArray={},r=this.graph.config.audioArray),"播放"==t){this.onAction("停止");let t=this.getInputNode(2);if(null!=t&&(1==t.properties.showInPageBottom||t.onAction("播放")),"无"!=i){var n=r[i];null!=n&&null!=(n=this.graph.getNodeById(n))&&n.onAction("停止"),r[i]=this.getIdWithGraph(),console.log("设置音轨播放的id",i,this.getIdWithGraph())}this.setOutputData(1,!1),this.properties.delayTime>0?(this.curWaitTime=this.properties.delayTime,this.mode=LiteGraph.ALWAYS):this.realPlayAudio()}else if("停止"==t){let t=this.getInputNode(2);null!=t&&(1==t.properties.showInPageBottom||t.onAction("停止")),r[i]==this.getIdWithGraph()&&(r[i]=null),null!=this.audioID&&cc.audioEngine.stop(this.audioID),null!=this.clip&&(this.clip.decRef(),this.clip=null),this.audioID=null,this.curWaitTime=null}}onExecute(){if(null!=this.curWaitTime){var t=this.graph.elapsed_time;this.curWaitTime-=t,this.curWaitTime<=0&&(this.curWaitTime=null,this.realPlayAudio())}}}sound.title="播放音频",sound.modalEnum=["自定义","胜利","开始","正确","错误"],sound.modalDit={"胜利":"WIN.d434ffea.mp3","错误":"错误.4893a3c2.mp3","开始":"readygo.a873eb49.mp3","正确":"dinlin.1ac6169b.mp3"},LiteGraph.registerNodeType("output/sound",sound);class textToSound extends LGraphNode{title="文本转音频";desc="接入文本生成音频接口实现文本生成配音";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addProperty("text","今天天气真不错"),this.addWidget("text","文本",this.properties.text,"text"),this.addProperty("soundName","xunfei"),this.addWidget("text","命名",this.properties.soundName,"soundName"),this.addProperty("peopleSound",textToSound.peopleSounds[1],"enum"),this.widget=this.addWidget("combo","音色",this.properties.peopleSound,{property:"peopleSound",values:textToSound.peopleSounds}),this.addProperty("speed",50,"number"),this.addWidget("slider","语速",this.properties.speed,"speed",{precision:0,min:0,max:100}),this.addProperty("volume",50,"number"),this.addWidget("slider","音量",this.properties.volume,"volume",{precision:0,min:0,max:100}),this.addProperty("pitch",50,"number"),this.addWidget("slider","语调",this.properties.pitch,"pitch",{precision:0,min:0,max:100}),this.addProperty("bgs",!1,"boolean"),this.addWidget("toggle","背景音",this.properties.bgs,"bgs"),this.btnWidget=this.addWidget("button","生成音频","",(async()=>{let t=textToSound.peopleSoundDit[this.properties.peopleSound];this.btnWidget.disabled=!0;let e=await VoiceGen.genSound({text:this.properties.text,vcn:t,speed:this.properties.speed,volume:this.properties.volume,pitch:this.properties.pitch,bgs:1==this.properties.bgs?1:0});this.btnWidget.disabled=!1,null!=window.uploadGroupFile&&window.uploadGroupFile([{files:[e],type:"mp3",name:this.properties.soundName,x:this.pos[0]+this.width+3,y:this.pos[1]}])})),this.setSize(this.computeSize())}onAction(t,e){}}textToSound.title="文本转音频",textToSound.peopleSounds=["聆飞逸","聆小璇","聆小玥","聆玉昭","聆玉言","动漫少女"],textToSound.peopleSoundDit={"聆飞逸":"x5_lingfeiyi_flow","聆小璇":"x5_lingxiaoxuan_flow","聆小玥":"x5_lingxiaoyue_flow","聆玉昭":"x5_lingyuzhao_flow","聆玉言":"x5_lingyuyan_flow","动漫少女":"x6_dongmanshaonv_pro"},LiteGraph.registerNodeType("output/textToSound",textToSound);class vibrate extends LGraphNode{title="震动";desc="调用设备振动";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("震动",LiteGraph.ACTION),this.addProperty("modal",0,"number"),this.addWidget("slider","振动强度",this.properties.modal,"modal",{min:0,max:1,precision:0})}onAction(t,e){"震动"==t&&(this.properties.modal<.5?vibrate$1(!1):vibrate$1(!0))}}vibrate.title="震动",LiteGraph.registerNodeType("output/vibrate",vibrate);class stopTime extends LGraphNode{title="停止时间";desc="暂停游戏时间";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("停止",LiteGraph.ACTION),this.addInput("恢复",LiteGraph.ACTION)}onAction(t,e){"停止"==t?this.graph.pause():"恢复"==t&&this.graph.resume()}}stopTime.title="停止时间",LiteGraph.registerNodeType("output/time/stopTime",stopTime);class timeScale extends LGraphNode{title="时间缩放";desc="加速或减慢时间效果";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("scale","number"),this.addProperty("scale",1,"number"),this.addWidget("number","缩放倍数",this.properties.scale,"scale",{precision:1,min:0}),this.addInput("修改",LiteGraph.ACTION),this.widgets_up=!0}onAction(t,e){if("修改"==t){let t=this.properties.scale||1;t<0&&(t=1),this.graph.config.timeScale=t,this.graph.sendEventToAllNodes("onChangeTimeScale")}}}timeScale.title="时间缩放",LiteGraph.registerNodeType("output/time/timeScale",timeScale);class autoRunRecordTouch extends LGraphNode{title="自动点击";desc="自动执行点击事件";constructor(){super(),this.size=[80,20],this.addProperty("active",!1,"boolean"),this.addWidget("toggle","是否激活",this.properties.active,"active"),this.addProperty("recordTouch",[],"array"),this.widgets_up=!0}onStart(){this.curRunStepIndex=-1}onExecute(){if(0==this.properties.active)return;if(null==this.properties.recordTouch)return;let t=this.graph.getTime();if(null!=this.properties.recordTouch[this.curRunStepIndex+1]&&t>this.properties.recordTouch[this.curRunStepIndex+1].time){this.curRunStepIndex+=1;let t=this.properties.recordTouch[this.curRunStepIndex],e=this.graph.getNodeById(t.nodeId);null!=e&&null!=e[t.funcName]&&e[t.funcName]()}}}autoRunRecordTouch.title="自动点击",LiteGraph.registerNodeType("output/autoRunRecordTouch",autoRunRecordTouch);const SpineRuntime={cache:{},async get(t,e){const i=SpineRuntime.cache;null==e&&(e="webgl");var r=t+"_"+e;if(null==i[r]){const s=`../assets/spine-runtimes/${t}/spine-${e}.js`;var{spine:n}=await module.import(s);i[r]=n,i[r].version=t}return i[r]}};class SpineToImg{assets={dir:null,json:null,skel:null,atlas:null,png:null};viewScale=1;skin="";animation="";timeScale=1;loop=!0;autoSetAni=!1;premultipliedAlpha=!1;drawBones=!1;drawBoundingBoxes=!1;drawMeshTriangles=!1;drawPaths=!1;version="unknown";canvasColor="#be4c4c";clearColor=[.3,.3,.3];assetManager=null;skeletonData=null;animationState=null;dragOffset=[0,0];renderWidth=130;canvas=null;gl=null;spine=null;_eventDit=null;mode="webgl";canRender=!1;constructor(t){null!=t&&(this.mode=t)}events(){if(!this.skeletonData||!this.skeletonData.animations)return{};if(null!=this._eventDit)return this._eventDit;let t={};for(var e=0;e<this.skeletonData.animations.length;e++){let i=this.skeletonData.animations[e];if(null!=i.timelines)for(let e=0;e<i.timelines.length;e++){let r=i.timelines[e],n=i.name;if(null!=r.events)for(let e=0;e<r.events.length;e++){let i={time:r.events[e].time,name:r.events[e].data.name};null==t[n]&&(t[n]=[]),t[n].push(i)}}}return this._eventDit=t,t}skins(){if(!this.skeletonData||!this.skeletonData.skins)return[];let t=this.skeletonData.skins.map((t=>t.name));if(t.length>1){let e=t.indexOf("default");t.splice(e,1)}return t}animations(){return this.skeletonData&&this.skeletonData.animations?this.skeletonData.animations.map((t=>t.name)):[]}debug(){return this.drawBones||this.drawBoundingBoxes||this.drawMeshTriangles||this.drawPaths}duration(){return this.animationState?this.animationState.getCurrent(0).animation.duration:0}assetsInfo(){if(!this.assetManager)return"no assetManager";let t="",e="",i="";for(const n in this.assetManager.assets){var r=n.split(".");switch(r="."+r[r.length-1]){case".json":case".skel":t=n;break;case".png":e=n;break;case".atlas":i=n}}return`💀 [Skeleton]\n· ${t}\n\n🖼 [Texture]\n· ${e}\n\n🗺 [Atlas]\n· ${i}`}offset(){return`(${this.dragOffset[0]}, ${-this.dragOffset[1]})`}reset(){this.assets=null,this.viewScale=1,this.skin="",this.animation="",this.timeScale=1,this.loop=!0,this.premultipliedAlpha=!1,this.drawBones=!1,this.drawBoundingBoxes=!1,this.drawMeshTriangles=!1,this.drawPaths=!1,this.version="unknown",this.canvasColor="#7a5050",this.skeleton=null,this.bounds=null,this.skeletonData=null,this.animationState=null,this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.shader=null,this.batcher=null,this.mvp=null,this.skeletonRenderer=null,this.assetManager=null,this.debugRenderer=null,this.debugShader=null,this.shapeRenderer=null,this.lastFrameTime=null,this.dragOffset=[0,0],this.image=null,this.canRender=!1,this.oriImg=null,this._eventDit=null}async getRuntime(){let t=this.getAssetSpineVersion(this.assets.json||this.assets.skel);t||(console.warn("Unable to identify Spine version of asset!"),t="3.8"),console.log("Skeleton spine version",t),t=t.split(".").slice(0,2).map((t=>parseInt(t))).join(".");let e=await SpineRuntime.get(t,this.mode);if(!e){let e=`noSpineRuntime | version: ${t}`;return console.warn(e),!1}return this.spine=e,this.version=e.version,!0}getAssetSpineVersion(t){return"3.7"}initRuntime(){null==this.canvas&&(this.canvas=document.getElementById("spinetoimg"),null==this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.id="spinetoimg",this.canvas.style.position="fixed",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.opacity=0,this.canvas.style.zIndex=-1999,this.canvas.width=130,this.canvas.height=130,document.body.append(this.canvas)));let t=this.canvas;if(!this.gl){const e={alpha:!1};if(this.gl=t.getContext("webgl",e),!this.gl)return void console.warn("没有webgl");const i=this.clearColor;this.gl.clearColor(i[0],i[1],i[2],1)}null==this.spine&&console.warn("没有spine");var e=this.spine;this.shader=e.webgl.Shader.newTwoColoredTextured(this.gl),this.batcher=new e.webgl.PolygonBatcher(this.gl),this.mvp=new e.webgl.Matrix4,this.mvp.ortho2d(0,0,t.width-1,t.height-1),this.skeletonRenderer=new e.webgl.SkeletonRenderer(this.gl),this.debugRenderer=new e.webgl.SkeletonDebugRenderer(this.gl),this.debugShader=e.webgl.Shader.newColored(this.gl),this.shapeRenderer=new e.webgl.ShapeRenderer(this.gl),this.assetManager=new e.webgl.AssetManager(this.gl)}loadAssets(){const t=this.assetManager;if(!t)return;const e=this.assets;if(e.dir&&(t.pathPrefix=e.dir),e.json)t.loadText(e.json);else{if(!e.skel)return void console.warn("noSkeletonData");t.loadBinary(e.skel)}t.loadTextureAtlas?t.loadTextureAtlas(e.atlas):(t.loadText(e.atlas),t.loadTexture(e.png)),requestAnimationFrame(this.loading.bind(this))}isLoadingComplete(){return null!=this.assetManager&&this.assetManager.isLoadingComplete()}isLoadIngError(){return null!=this.assetManager&&this.assetManager.hasErrors()}loading(){if(null!=this.assetManager)if(this.assetManager.isLoadingComplete()){if(!this.loadSkeleton())return void this.reset();var t=this.skins();if(null!=t[0]&&this.setSkin(t[0]),1==this.autoSetAni){var e=this.animations();null!=e[0]&&this.playAnimation(e[0])}this.lastFrameTime=Date.now()/1e3,this.render(),this.genPreviewImg()}else requestAnimationFrame(this.loading.bind(this))}loadSkeleton(){const t=this.assetManager,e=this.assets;let i=t.get(e.atlas),r=this.spine;if(null==r)return void console.log("spine == null");"3.5"===r.version&&(i=new r.TextureAtlas(i));const n=new r.AtlasAttachmentLoader(i);try{if(e.json){const i=new r.SkeletonJson(n);this.skeletonData=i.readSkeletonData(t.get(e.json))}else if(e.skel){const i=new r.SkeletonBinary(n);this.skeletonData=i.readSkeletonData(t.get(e.skel))}}catch(o){return console.error(o),!1}this.skeleton=new r.Skeleton(this.skeletonData),this.bounds=this.calculateBounds();const s=new r.AnimationStateData(this.skeleton.data);return this.animationState=new r.AnimationState(s),!0}setSkin(t){if(this.skeleton){this.skin=t;try{this.skeleton.setSkinByName(t)}catch(e){}this.skeleton.setSlotsToSetupPose()}}playAnimation(t){this.skeleton&&(this.animation=t,this.skeleton.setToSetupPose(),this.animationState.setAnimation(0,t,this.loop))}setTimeScale(t){this.skeleton&&(this.animationState.timeScale=t)}calculateBounds(){this.skeleton.setToSetupPose(),this.skeleton.updateWorldTransform();const t=new spine.Vector2,e=new spine.Vector2;return this.skeleton.getBounds(t,e,[]),e.x>0==0&&(e.x=this.skeletonData.width,e.y=this.skeletonData.height,t.x=-.5*this.skeletonData.width,t.y=-.5*this.skeletonData.height),{offset:t,size:e}}render(){if(!this.skeleton)return;const t=Date.now()/1e3,e=t-this.lastFrameTime;if(this.lastFrameTime=t,this.resizeView(),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.animationState.update(e),this.animationState.apply(this.skeleton),this.skeleton.updateWorldTransform(),this.shader.bind(),this.shader.setUniformi(this.spine.webgl.Shader.SAMPLER,0),this.shader.setUniform4x4f(this.spine.webgl.Shader.MVP_MATRIX,this.mvp.values),this.batcher.begin(this.shader),this.skeletonRenderer.premultipliedAlpha=this.premultipliedAlpha,this.skeletonRenderer.draw(this.batcher,this.skeleton),this.batcher.end(),this.shader.unbind(),this.debug()){let t=this.debugShader,e=this.debugRenderer;t.bind(),t.setUniform4x4f(this.spine.webgl.Shader.MVP_MATRIX,this.mvp.values),e.premultipliedAlpha=this.premultipliedAlpha,e.drawBones=this.drawBones,e.drawBoundingBoxes=this.drawBoundingBoxes,e.drawRegionAttachments=this.drawBoundingBoxes,e.drawMeshHull=this.drawMeshTriangles,e.drawMeshTriangles=this.drawMeshTriangles,e.drawPaths=this.drawPaths,e.drawSkeletonXY=this.drawBones,this.shapeRenderer.begin(t),e.draw(this.shapeRenderer,this.skeleton),this.shapeRenderer.end(),t.unbind()}}genPreviewImg(){if(null!=this.canvas){this.renderWidth=130,this.canvas.height=130,this.render();var t=this.canvas.toDataURL("image/png"),e=new Image;e.src=t,this.image=e,this.canRender=!0}}getImgUrlOri(t,e){if(1==this.canRender){if(null!=this.oriImg)return this.oriImg;this.renderWidth=null==t?null:t,null!=e&&(this.canvas.height=e),this.render();var i=this.canvas.toDataURL("image/png");return this.oriImg=i,i}}resizeView(){let t=this.canvas;if(null==t)return;let e=this.bounds;var i=e.size.x/e.size.y;null!=this.renderWidth?t.width=this.renderWidth*i:(t.width=e.size.x,t.height=e.size.y);const r=t.width,n=t.height,s=e.offset.x+e.size.x/2||0,o=e.offset.y+e.size.y/2||0,a=e.size.x/r,l=e.size.y/n;let c=Math.max(a,l);c<1&&(c=1),c/=this.viewScale;const h=r*c,u=n*c,d=s-h/2-this.dragOffset[0]*c,p=o-u/2+this.dragOffset[1]*c;this.mvp.ortho2d(d,p,h,u),this.gl.viewport(0,0,r,n)}async setAssets(t){if(this.assets&&this.reset(),!t)return;this.assets=t;let e=await this.getRuntime();this.processAssetPaths(),e&&(this.initRuntime(),this.loadAssets())}processAssetPaths(){const t=this.assets,{dir:e,json:i,skel:r,png:n,atlas:s}=t;console.log("当前版本",this.version),"3.7"==this.version?(this.assets.json="/"+i,this.assets.atlas="/"+s):"3.8"==this.version&&(this.assets.dir+="/")}onLayoutResize(){const t=layout.style,e=this.$refs.properties.style;layout.clientWidth>=800||layout.clientHeight<330?layout.clientWidth>=350?(t.flexDirection="row",e.width="265px",e.marginTop="0",e.marginLeft="5px",e.display="flex"):e.display="none":(t.flexDirection="column",e.width="100%",e.marginTop="5px",e.marginLeft="0",e.display="flex")}}class BaseYWNode extends LGraphNode{title="自定义LGraphNode基础类";desc="其余LGraphNode继承于此";constructor(){super()}onAdded(){this.sendAddEvent()}onRemoved(){this.sendRemoveEvent()}onSelected(){this.sendOtherEvent("onSelected")}onDeselected(){this.sendOtherEvent("onDeselected")}onConnectInput(t,e,i,r,n){this.sendConnectEvent(t,r,n)}disconnectInput(t,e){this.sendDisConnectEvent(t,e),super.disconnectInput(t,e)}onPropertyChanged(t,e,i){this.sendPropertyChangeEvent(t,e,i)}sendPropertyChangeEvent(t,e,i){if(null!=this.graph&&null!=window.channel){let i=JSON.parse(JSON.stringify({id:this.id,property:t,value:e}));window.channel.postMessage({type:"nodeEvent",func:"onPropertyChanged",datas:i})}}sendBtnWidgetClickEvent(t){if(null!=this.graph&&null!=window.channel){let e=JSON.parse(JSON.stringify({id:this.id,buttonName:t}));window.channel.postMessage({type:"nodeEvent",func:"onBtnWidgetClick",datas:e})}}sendRemoveEvent(){if(null!=this.graph&&null!=window.channel){let t=JSON.parse(JSON.stringify({id:this.id}));window.channel.postMessage({type:"nodeEvent",func:"onRemove",datas:t})}}sendConnectEvent(t,e,i){if(null!=this.graph&&null!=window.channel){let r=JSON.parse(JSON.stringify({id:this.id,inputIndex:t,linkedNodeId:e.id,outputIndex:i}));window.channel.postMessage({type:"nodeEvent",func:"onConnect",datas:r})}}sendDisConnectEvent(t,e){if(null!=this.graph&&null!=window.channel){let i=JSON.parse(JSON.stringify({id:this.id,slot:t,keepReroutes:e}));window.channel.postMessage({type:"nodeEvent",func:"onDisConnect",datas:i})}}sendAddEvent(){if(null!=this.graph&&null!=window.channel){let t=JSON.parse(JSON.stringify({id:this.id,type:this.type,params:this.properties}));window.channel.postMessage({type:"nodeEvent",func:"onAdd",datas:t})}}sendOtherEvent(t,e){if(null!=this.graph&&null!=window.channel){let i=JSON.parse(JSON.stringify({id:this.id,funcName:t,params:e}));window.channel.postMessage({type:"nodeEvent",func:"justRunFunc",datas:i})}}onStart(){this._hasShowTips=!1}oneClickCreateTouchTip(){let t=LiteGraph.createNode("objects/createObject");t.setProperty("modal","spine"),t.setProperty("customeName","c7007391/Common_Click"),t.setProperty("x",0),t.setProperty("y",0),t.setProperty("zIndex",99),t.setProperty("premulAlpha",!1),t.onWidgetChanged("物体类型"),t.pos=[this.pos[0],this.pos[1]+this.height+130],this.graph.add(t);let e=t.onGetOutputs(),i=e.findIndex((t=>"lgraphNode"==t[1]));-1!=i&&t.addOutput(e[i][0],e[i][1]),t.connect(t.outputs.length-1,this,2);let r=LiteGraph.createNode("objects/animates/animate");r.pos=[t.pos[0]+t.width+3,t.pos[1]],r.setProperty("loop",!0),r.setProperty("autoRun",!0),this.graph.add(r),t.connect(0,r,0),setTimeout((()=>{r.getEnums()}),1e3)}showClickTip(){if(1==this._hasShowTips)return;if(1==this.properties.tipsJustOnce&&(this._hasShowTips=!0),1==this.properties.canClickOutLine){let t=this.getInputData(0);null!=t&&(t.outLineWidth=5)}let t=this.findInputSlot("触摸提示");if(console.log("showClickTip",t),-1==t)return;let e=this.getInputNode(t);null!=e&&null!=e.codeNode&&e.codeNode.playAnimation("1Open",!0)}hideClickTip(){if(1==this.properties.canClickOutLine){let t=this.getInputData(0);null!=t&&(t.outLineWidth=0)}let t=this.findInputSlot("触摸提示");if(-1==t)return;let e=this.getInputNode(t);null!=e&&null!=e.codeNode&&e.codeNode.playAnimation("2Close",!1)}playLinkSound(){let t=this.findInputSlot("关联音频");if(-1==t)return;let e=this.getInputNode(t);null!=e&&null!=e.onAction&&e.onAction("播放")}hasLinkSound(){let t=this.findInputSlot("关联音频");return-1!=t&&null!=this.getInputLink(t)}hasLinkIsCanClick(){let t=this.findInputSlot("isCanClick");return-1!=t&&null!=this.getInputLink(t)}removeProperty(t){null==this.properties_info&&(this.properties_info=[]);let e=this.properties_info.findIndex((e=>e.name==t));this.properties_info.splice(e,1),null==this.properties&&(this.properties={}),delete this.properties[t]}}const soundFxs=["无","popOut.mp3"];class createObject extends BaseYWNode{title="物体";desc="在界面中创建一个物体";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("创建",LiteGraph.ACTION),this.addOutput("物体","codeNode"),this.addProperty("group",!1,"boolean"),this.addWidget("toggle","是否作为UI",this.properties.group,"group"),this.addProperty("modal","空物体","enum"),this.addWidget("combo","物体类型",this.properties.modal,{property:"modal",values:objectTypes}),this.addProperty("customeName","","string"),this.addWidget("string","资源",this.properties.customeName,"customeName"),this.addProperty("showTime",0,"number"),this.addWidget("combo","加载时机",this.properties.showTime,{property:"showTime",values:{0:"初始化时",1:"输入时"}}),this.addProperty("premulAlpha",!1,"boolean"),this.addWidget("toggle","是否预乘",this.properties.premulAlpha,"premulAlpha"),this.addProperty("zIndex",1,"number"),this.addWidget("number","层级",this.properties.zIndex,"zIndex",{precision:0}),this.addProperty("dynamiczIndex",!1,"boolean"),this.addWidget("toggle","以y轴动态计算层级",this.properties.dynamiczIndex,"dynamiczIndex"),this.addProperty("x",-1280,"number"),this.addWidget("number","坐标-x",this.properties.x,"x",{precision:2}),this.addProperty("y",-750,"number"),this.addWidget("number","坐标-y",this.properties.y,"y",{precision:2}),this.addProperty("scaleX",1,"number"),this.addWidget("number","缩放-x",this.properties.scaleX,"scaleX",{precision:2}),this.addProperty("scaleY",1,"number"),this.addWidget("number","缩放-y",this.properties.scaleY,"scaleY",{precision:2}),this.addProperty("opacity",255,"number"),this.addWidget("slider","透明度",this.properties.opacity,"opacity",{min:0,max:255,precision:0}),this.addProperty("angle",0,"number"),this.addWidget("number","角度",this.properties.angle,"angle",{min:-360,max:360,precision:0}),this.addProperty("anchorX",.5,"number"),this.addWidget("number","锚点x",this.properties.anchorX,"anchorX",{min:-1,max:1,precision:1,step2:.1}),this.addProperty("anchorY",.5,"number"),this.addWidget("number","锚点y",this.properties.anchorY,"anchorY",{min:-1,max:1,precision:1,step2:.1}),this.addProperty("width",50,"number"),this.widthWidget=this.addWidget("number","宽度",this.properties.width,"width",{precision:0,min:0,max:9999}),this.addProperty("height",50,"number"),this.heightWidget=this.addWidget("number","高度",this.properties.height,"height",{precision:0,min:0,max:9999}),this.addWidget("button","重置为资源尺寸","",(()=>{console.log("点击了重置按钮"),this.resetSizeConfig()})),this.addProperty("color","#ffffff","string"),this.addWidget("string","物体颜色",this.properties.color,"color"),this._hasToggleAssestLoad=!1,this.addProperty("nodeConfig",{x:this.properties.x,y:this.properties.y,width:this.properties.width,height:this.properties.height,anchorX:this.properties.anchorX,anchorY:this.properties.anchorY,scaleX:this.properties.scaleX,scaleY:this.properties.scaleY,color:this.properties.color,angle:this.properties.angle},"object"),this.nodeConfigWidget=this.addWidget("ccnode","节点操控",this.properties.nodeConfig,"nodeConfig",{viewWidth:designViewWidth,viewHeight:designViewHeight}),this.addProperty("string","","string"),this.addWidget("string","文本",this.properties.string,"string"),this.addProperty("outLineWidth",0,"number"),this.addWidget("slider","描边宽度",this.properties.outLineWidth,"outLineWidth",{precision:0,min:0,max:100}),this.addProperty("outLineColor","#ffffff","string"),this.addWidget("string","描边颜色",this.properties.outLineColor,"outLineColor"),this.addProperty("colliderValue",{},"object")}getExtraMenuOptions(t){return[{content:"编辑碰撞框",callback:()=>{null!=window.onGraphMenuClick&&(1==Array.isArray(this.properties.colliderValue)&&(this.properties.colliderValue={}),window.onGraphMenuClick("editColider",{img:this.getPreviewImg(),scale:this.properties.colliderValue.scale||1,pointArr:this.properties.colliderValue.pointArr||[],onValueChange:(t,e)=>{console.log("pointArr",t,e),this.properties.colliderValue.pointArr=t,this.properties.colliderValue.baseWidth=this.properties.width,this.properties.colliderValue.baseHeight=this.properties.height,this.properties.colliderValue.scale=e;let i=0,r=0;null!=this._renderSpine&&this._renderSpine.canRender&&(i=this._renderSpine.bounds.offset.x+.5*this.properties.width,r=this._renderSpine.bounds.offset.y+.5*this.properties.height),this.properties.colliderValue.offsetX=i,this.properties.colliderValue.offsetY=r,null!=this.codeNode&&(this.codeNode.destroyNode(),this.codeNode=null,this.setOutputData(0,null),this.createObj())}}))}}]}onAdded(){console.log("节点添加到蓝图中了",this.properties.customeName,this.properties.modal),this.updateWidght(),this.updateRenderAssest(),this.setSize(this.computeSize()),this.sendAddEvent()}onRemoved(){null!=this.codeNode&&(this.codeNode.destroyNode(),this.codeNode=null,this.setOutputData(0,null)),this._image=null,this._renderSpine=null,this.sendRemoveEvent(),null!=this.checkAssestTimeOut&&(clearInterval(this.checkAssestTimeOut),this.checkAssestTimeOut=null)}onConfigure(){1!=isInImport&&(this.updateWidght(),this.updateRenderAssest(),this.graph&&1==isSinglePreview||this.graph&&null!=this.graph.list_of_graphcanvas&&this.graph.list_of_graphcanvas.length>0&&this.createObj((()=>{"spine"==this.properties.modal&&setTimeout((()=>{try{let t=this.getOutputNodes(0);if(null!=t&&(t=t.filter((t=>"objects/animates/animate"==t.type&&1==t.properties.autoRun)),null!=t[0])){let e=t[0];e.onSelected();let i=e.properties.skin;this.codeNode.setSkin(i),this.codeNode.playAnimation(e.properties.playAniName,e.properties.loop)}}catch(t){}}),1e3)})))}onStartBeforeLoad(){console.log("createObject onStart",this.properties.showTime),0==this.properties.showTime&&(this.graph.config.assestTotal+=1,this.createObj((()=>{this.graph.config.assestLoaded+=1,null!=this.graph.checkAssestLoadComplete&&this.graph.checkAssestLoadComplete()})))}createObj(t){if(null!=this.codeNode){if(1==cc.isValid(this.codeNode.node)){var e={...this.properties};return syncConfigToCodeNode(this.codeNode,e),null!=t&&t(),void this.setOutputData(0,this.codeNode)}this.codeNode=null,this.setOutputData(0,null)}e={...this.properties};var i=this.graph.vars.rootccNode;return null!=i&&(e.parent=i),this.codeNode=createObj(e,t),this.codeNode.graph=this.graph,console.log("我创建了的codeNode",this.codeNode.node._id),this.setOutputData(0,this.codeNode),this.codeNode}updateOutputData(t){console.log("我收到了更新物体的事件",t),this.setOutputData(t,this.codeNode)}onAction(t,e){"创建"==t&&this.createObj()}getTitle(){var t=this.properties.modal;if("文本"==t){t+=":"+(this.properties.string.length<9?this.properties.string:this.properties.string.substring(0,8)+"..")}return this.inputs,t}updateWidght(){var t=this.properties.modal;this.widgets.map((e=>{"文本"!=e.name&&"描边颜色"!=e.name||(e.hidden="文本"!=t),"锚点x"!=e.name&&"锚点y"!=e.name&&"宽度"!=e.name&&"高度"!=e.name||(e.disabled="spine"==t)}))}onPause(){null!=this.codeNode&&(null!=this.codeNode.spineCom&&(this.codeNode.spineCom.paused=!0),cc.director.getActionManager().pauseTarget(this.codeNode))}onChangeTimeScale(){null!=this.codeNode&&null!=this.codeNode.spineCom&&null!=this.graph.config.timeScale&&(this.codeNode.spineCom.timeScale=this.graph.config.timeScale)}onResume(){null!=this.codeNode&&(null!=this.codeNode.spineCom&&(this.codeNode.spineCom.paused=!1),cc.director.getActionManager().resumeTarget(this.codeNode))}onStop(){if(this.codeNode.targetOff(),null!=this.codeNode&&0==isInApp){var t={...this.properties.nodeConfig};syncConfigToCodeNode(this.codeNode,t)}}onPropertyChanged(t,e,i){if("nodeConfig"!=t&&"object"==typeof this.nodeConfigWidget.value&&null!=this.nodeConfigWidget.value[t]&&(this.nodeConfigWidget.value[t]=e,this.properties.nodeConfig[t]=e),null!=this.codeNode){if(0==cc.isValid(this.codeNode.node))return void(this.codeNode=null);var r={};"nodeConfig"==t?r={...e}:r[t]=this.properties[t],syncConfigToCodeNode(this.codeNode,r),"string"==t&&this.resetSizeConfig()}this.sendPropertyChangeEvent(t,e,i)}onWidgetChanged(t,e,i,r){"物体类型"==t?(this.updateWidght(),this.updateRenderAssest()):"资源"==t&&this.updateRenderAssest(),this.sendOtherEvent("onWidgetChanged",[t])}updateRenderAssest(){if(1!=isInImport){var t=this.properties.modal,e=this.properties.customeName;if(console.log("updateRenderAssest",t,e),"spine"!=t&&(this._renderSpine=null),"图片"!=t&&null!=this._image&&(this._image.src=null,this._image=null),"图片"==t){null==this._image&&(this._image=new Image);var i=rootHost+"/"+e;this._image.src!=i&&(this._image.src=i,this._hasToggleAssestLoad=!1,null!=this.checkAssestTimeOut&&(clearInterval(this.checkAssestTimeOut),this.checkAssestTimeOut=null),this.checkAssestTimeOut=setInterval((()=>{this.checkAssestLoaded()}),500))}else if("spine"==t){null==this._renderSpine&&(this._renderSpine=new SpineToImg);var r=e+".json";null!=this._renderSpine.assets&&this._renderSpine.assets.json==r||(this._hasToggleAssestLoad=!1,null!=this.checkAssestTimeOut&&(clearInterval(this.checkAssestTimeOut),this.checkAssestTimeOut=null),this.checkAssestTimeOut=setInterval((()=>{this.checkAssestLoaded()}),500),this._renderSpine.setAssets({dir:rootHost,json:e+".json",atlas:e+".atlas"}))}else"文本"==t?(this.createObj(),this.resetSizeConfig()):"空物体"==t&&this.createObj()}}updateSpinePreview(t){null!=this._renderSpine&&(this._renderSpine.setSkin(t),this._renderSpine.genPreviewImg())}resetSizeConfig(){var t=this.properties.width,e=this.properties.height;null!=this._image?this._image.naturalWidth>0&&this._image.naturalHeight>0&&(t=this._image.width,e=this._image.height):null!=this._renderSpine?this._renderSpine.canRender&&(t=this._renderSpine.bounds.size.x,e=this._renderSpine.bounds.size.y):"文本"==this.properties.modal&&(console.log("当前是否有text节点",this.codeNode),null!=this.codeNode&&(t=this.codeNode.width,e=this.codeNode.height)),console.log("width",t,e),this.widthWidget.setValue(t,{e:null,node:this,canvas:null}),this.heightWidget.setValue(e,{e:null,node:this,canvas:null});var i=this.properties.nodeConfig;i.width=t,i.height=e,"文本"!=this.properties.modal&&this.createObj()}getPreviewImg(){if(null!=this._image){if(0==this._image.complete)return;if(!(this._image.naturalWidth>0&&this._image.naturalHeight>0))return;return this._image.src}if(null!=this._renderSpine&&this._renderSpine.canRender)return this._renderSpine.getImgUrlOri()}checkAssestLoaded(t){var e=this.properties.modal;if("图片"==e){if(null!=this._image){if(0==this._image.complete)return;if(!(this._image.naturalWidth>0&&this._image.naturalHeight>0))return void(null!=t&&this.drawErrorTips(t));if(0==this._hasToggleAssestLoad&&(this.resetSizeConfig(),this._hasToggleAssestLoad=!0,null!=this.checkAssestTimeOut&&(clearInterval(this.checkAssestTimeOut),this.checkAssestTimeOut=null)),null!=t){var i=this.drawAssestBox(t,this._image.width,this._image.height);t.drawImage(this._image,i.x,i.y,i.width,i.height)}}}else if("spine"==e&&null!=this._renderSpine)if(this._renderSpine.canRender){if(null!=t&&null!=this._renderSpine.image&&this._renderSpine.image.naturalWidth>0&&this._renderSpine.image.naturalHeight>0){let e=this.getOutputNodes(0);if(null!=e&&(e=e.filter((t=>"objects/animates/animate"==t.type&&1==t.properties.autoRun)),null!=e[0])){let t=e[0].properties.skin;this.updateSpinePreview(t)}i=this.drawAssestBox(t,this._renderSpine.image.width,this._renderSpine.image.height);t.drawImage(this._renderSpine.image,i.x,i.y,i.width,i.height)}0==this._hasToggleAssestLoad&&(this.resetSizeConfig(),this._hasToggleAssestLoad=!0,null!=this.checkAssestTimeOut&&(clearInterval(this.checkAssestTimeOut),this.checkAssestTimeOut=null))}else null!=t&&this.drawErrorTips(t)}onDrawForeground(t,e,i){this.checkAssestLoaded(t)}}createObject.title="物体",createObject.showTypes=["初始化时","输入时"],LiteGraph.registerNodeType("objects/createObject",createObject);class textGroup extends BaseYWNode{title="字幕组";desc="用于快速创建一个绘本中浮动的字幕";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addOutput("列表","array"),this.addProperty("showInPageBottom",!1,"boolean"),this.addWidget("toggle","用作底部字幕",this.properties.showInPageBottom,"showInPageBottom"),this.addProperty("vertical",!1,"boolean"),this.addWidget("toggle","竖向文本",this.properties.vertical,"vertical"),this.addProperty("layout","居左/下","enum"),this.addWidget("combo","排列",this.properties.layout,{property:"layout",values:textGroup.layoutEnum}),this.addProperty("firstLineOffset",0,"number"),this.addWidget("number","首行缩进",this.properties.firstLineOffset,"firstLineOffset",{precision:0}),this.addProperty("lineSpace",0,"number"),this.addWidget("number","行距",this.properties.lineSpace,"lineSpace",{precision:0}),this.addProperty("fontSize",45,"number"),this.addWidget("number","字号",this.properties.fontSize,"fontSize",{precision:0}),this.addProperty("color","#000000","string"),this.addWidget("string","颜色",this.properties.color,"color"),this.addProperty("outLineWidth",4,"number"),this.addWidget("slider","描边宽度",this.properties.outLineWidth,"outLineWidth",{precision:0,min:0,max:100}),this.addProperty("outLineColor","#ffffff","string"),this.addWidget("string","描边颜色",this.properties.outLineColor,"outLineColor"),this.addProperty("hideBeforRun",!1,"boolean"),this.addWidget("toggle","运行前隐藏",this.properties.hideBeforRun,"hideBeforRun"),this.addProperty("hideAfterRun",!1,"boolean"),this.addWidget("toggle","运行结束隐藏",this.properties.hideAfterRun,"hideAfterRun"),this.addProperty("hideBaseLabel",!1,"boolean"),this.addWidget("toggle","隐藏底层文字",this.properties.hideBaseLabel,"hideBaseLabel"),this.addProperty("needColorAni",!1,"boolean"),this.addWidget("toggle","是否颜色过渡",this.properties.needColorAni,"needColorAni"),this.addProperty("maskColor","#88BF3D","string"),this.addWidget("string","过渡颜色",this.properties.maskColor,"maskColor"),this.addProperty("linesNum",0,"number"),this.addWidget("button","添加一行","",(()=>{this.addLine()})),this.addWidget("button","删除一行","",(()=>{this.removeLine()}))}updateWidght(){var t=this.properties.showInPageBottom;this.widgets.map((e=>{"用作底部字幕"!=e.name&&(e.hidden=t)})),this.setSize(this.computeSize())}onConfigure(){console.log("当前的配置信息",this.properties);for(var t=0;t<this.properties.linesNum;t++){let e="text"+(t+1);this.addWidget("string","文本",this.properties[e],e)}this.freshTexts()}addLine(){this.properties.linesNum+=1;let t="text"+this.properties.linesNum;this.addProperty(t,"","string"),this.addWidget("string","文本","",t),this.freshTexts()}removeLine(){if(0==this.properties.linesNum)return;let t="text"+this.properties.linesNum;this.properties.linesNum-=1,this.removeProperty(t),this.widgets.pop(),this.setSize(this.computeSize()),this.freshTexts()}onPropertyChanged(t,e,i){var r;if(null!=(r=this.getInputData(0,!0))&&null!=r.node)if("showInPageBottom"!=t)if("layout"==t)for(var n=0;n<r.node.children.length;n++){let t=r.node.children[n].getComponent("CodeNodeLg");1==this.properties.vertical?(t.y=0==n?this.properties.firstLineOffset:0,t.anchorY=textGroup.anchorXDit[e],t.anchorX=.5):(t.x=0==n?this.properties.firstLineOffset:0,t.anchorY=.5,t.anchorX=textGroup.anchorXDit[e])}else if("vertical"==t){let t=r.checkAddComponent(cc.Layout);0==e?(t.type=cc.Layout.Type.VERTICAL,t.resizeMode=cc.Layout.ResizeMode.CONTAINER,t.spacingY=this.properties.lineSpace,t.verticalDirection=cc.Layout.VerticalDirection.TOP_TO_BOTTOM):(t.type=cc.Layout.Type.HORIZONTAL,t.resizeMode=cc.Layout.ResizeMode.CONTAINER,t.spacingX=this.properties.lineSpace,t.horizontalDirection=cc.Layout.HorizontalDirection.RIGHT_TO_LEFT);for(n=0;n<r.node.children.length;n++){let t=r.node.children[n].getComponent("CodeNodeLg");t.overflow=e?cc.Label.Overflow.RESIZE_HEIGHT:cc.Label.Overflow.NONE,1==e?t.y=0==n?this.properties.firstLineOffset:0:t.x=0==n?this.properties.firstLineOffset:0,0==e?(t.anchorX=textGroup.anchorXDit[this.properties.layout],t.anchorY=.5):(t.anchorX=.5,t.anchorY=textGroup.anchorXDit[this.properties.layout],t.width=this.properties.fontSize+10)}}else if("lineSpace"==t){let t=r.checkAddComponent(cc.Layout);this.properties.vertical?t.spacingX=this.properties.lineSpace:t.spacingY=this.properties.lineSpace}else if("firstLineOffset"==t){let t=r.node.children[0];null!=t&&(this.properties.vertical?t.getComponent("CodeNodeLg").y=this.properties.firstLineOffset:t.getComponent("CodeNodeLg").x=this.properties.firstLineOffset)}else if("outLineColor"==t)for(n=0;n<r.node.children.length;n++){r.node.children[n].getComponent("CodeNodeLg").outLineColor=this.properties.outLineColor}else if("outLineWidth"==t)for(n=0;n<r.node.children.length;n++){r.node.children[n].getComponent("CodeNodeLg").outLineWidth=this.properties.outLineWidth}else if("fontSize"==t)for(n=0;n<r.node.children.length;n++){let t=r.node.children[n];t.getComponent("CodeNodeLg").fontSize=this.properties.fontSize,this.properties.vertical&&(t.getComponent("CodeNodeLg").width=this.properties.fontSize+10)}else if("color"==t)for(n=0;n<r.node.children.length;n++){r.node.children[n].getComponent("CodeNodeLg").color=this.properties.color}else{let i=r.getChildByName(t);null!=i&&(i.getComponent("CodeNodeLg").string=e)}else this.updateWidght(),0==e?this.freshTexts():null!=(r=this.getInputData(0,!0))&&r.clearChildren()}freshTexts(t){var e=this.getInputData(0,!0);if(1==this.properties.showInPageBottom)return void(null!=e&&e.clearChildren());if(null==e){console.log("当前没有物体");{let t=this.getRealLinkNode();if(null==t)return void console.log("当前没有关联节点");if(null==(e=t.codeNode))return void console.log("当前关联节点没有codeNode")}}let i=e.checkAddComponent(cc.Layout);0==this.properties.vertical?(i.type=cc.Layout.Type.VERTICAL,i.resizeMode=cc.Layout.ResizeMode.CONTAINER,i.spacingY=this.properties.lineSpace,i.verticalDirection=cc.Layout.VerticalDirection.TOP_TO_BOTTOM):(i.type=cc.Layout.Type.HORIZONTAL,i.resizeMode=cc.Layout.ResizeMode.CONTAINER,i.spacingX=this.properties.lineSpace,i.horizontalDirection=cc.Layout.HorizontalDirection.RIGHT_TO_LEFT),e.clearChildren(),this.motionTextArr=[];for(var r=1;r<=this.properties.linesNum;r++){let i=createObj({parent:e.node,modal:ObjectTypeEnum.text,customeName:"text"+r,string:this.properties["text"+r],outLineWidth:this.properties.outLineWidth,outLineColor:this.properties.outLineColor,fontSize:this.properties.fontSize,color:this.properties.color,overflow:this.properties.vertical?cc.Label.Overflow.RESIZE_HEIGHT:cc.Label.Overflow.NONE,width:this.properties.fontSize+10});if(null!=i&&null!=t){console.log("生成字幕",this.properties["text"+r],i.node._id,t);let e=i.checkAddComponent("MotionText");e.hideBeforRun=this.properties.hideBeforRun,e.hideAfterRun=this.properties.hideAfterRun,e.hideBaseLabel=this.properties.hideBaseLabel,e.dir=this.properties.vertical?1:0,e.maskColor=this.properties.maskColor,this.motionTextArr.push(e);let n=r-1;null!=t[n]&&(e.position=t[n].position.map((t=>1!=this.properties.needColorAni?0:.01*t)).join(","),e.positionTime=t[n].times.join(","),console.log("设置了motionText hideAfterRun",e.position,e.positionTime)),e.init()}this.onPropertyChanged("layout",this.properties.layout)}}onAction(t){if(null!=this.getInputData(0,!0)){if(console.log("textGroup onAction",t),"播放"==t){var e=0,i=()=>{let t=this.motionTextArr;if(null==t[e])return;let r=t[e];console.log("textGroup 当前执行的motionText",e,t[e].node._id,r),null!=r&&(r.dir=this.properties.vertical?1:0,r.inputHandle({data:1}),r.outputHandle=()=>{null!=t[e+=1]&&1==t[e].node.active&&i()})};i()}else if("停止"==t){let t=this.motionTextArr;for(var r=0;r<t.length;r++){let e=t[r];null!=e&&e.inputHandle({data:0})}}}else console.log("当前没有物体")}}textGroup.layoutEnum=["居左/下","居中","居右/上"],textGroup.anchorXDit={"居左/下":0,"居中":.5,"居右/上":1},textGroup.title="字幕组",LiteGraph.registerNodeType("objects/textGroup",textGroup);class animate extends BaseYWNode{title="骨骼动画";desc="用于控制动画播放";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("播放",LiteGraph.ACTION),this.addOutput("结束",LiteGraph.EVENT),this.addOutput("点击",LiteGraph.EVENT),this._skins=[],this._animations=[],this.addProperty("modal","全设置","enum"),this.addWidget("combo","更新模式",this.properties.modal,{property:"modal",values:animate.modalEnum}),this.addProperty("skin","","enum"),this.addWidget("combo","选择皮肤",this.properties.skin,{property:"skin",values:this._skins}),this.addProperty("playAniName","","enum"),this.addWidget("combo","选择动画",this.properties.playAniName,{property:"playAniName",values:this._animations}),this.addProperty("loop",!1,"boolean"),this.addWidget("toggle","是否循环",this.properties.loop,"loop"),this.addProperty("timeScale",1,"number"),this.addWidget("slider","播放速率",this.properties.timeScale,"timeScale",{precision:1,min:0,max:10}),this.addProperty("autoRun",!1,"boolean"),this.addWidget("toggle","是否自动播放",this.properties.autoRun,"autoRun"),this.addProperty("clickWait",!1,"boolean"),this.addWidget("toggle","点击等待动画结束",this.properties.clickWait,"clickWait"),this.addProperty("softChange",!1,"boolean"),this.addWidget("toggle","柔和过度",this.properties.softChange,"softChange"),this.addProperty("cancelEvent",!1,"boolean"),this.addWidget("toggle","取消其他触摸事件",this.properties.cancelEvent,"cancelEvent"),this.addProperty("aniEndCanClick",!1,"boolean"),this.addWidget("toggle","动画结束后响应点击",this.properties.aniEndCanClick,"aniEndCanClick"),this.addProperty("toggleCount",1,"number"),this.addWidget("number","结束触发次数",this.properties.toggleCount,"toggleCount",{precision:0,min:0}),this.addProperty("aniClickReplay",!1,"boolean"),this.addWidget("toggle","点击重播动画",this.properties.aniClickReplay,"aniClickReplay"),this.addProperty("aniClickTimeSpace",0,"number"),this.addWidget("number","点击时间间隔",this.properties.aniClickTimeSpace,"aniClickTimeSpace"),this.addProperty("canClickOutLine",!1,"boolean"),this.addWidget("toggle","可点击时显示描边",this.properties.canClickOutLine,"canClickOutLine"),this.addProperty("isCanClick",!0,"boolean");let t=this.addWidget("toggle","是否可点击",this.properties.isCanClick,"isCanClick"),e=this.addInput("触摸提示","lgraphNode");this.addProperty("linkClickTip","","string");let i=this.addWidget("linknode","添加触摸提示",this.properties.linkClickTip,(()=>{this.oneClickCreateTouchTip()}));this.addProperty("tipsJustOnce",!0,"boolean"),this.addWidget("toggle","触摸提示只出现一次",this.properties.tipsJustOnce,"tipsJustOnce"),e.widget=i,this.createCaidanBtn=this.addWidget("button","创建点击彩蛋交互","",(()=>{this.createClickToNextAni()})),this.createCaidanBtn.disabled=!0,this.addWidget("button","预览动画","",(()=>{this.previewAni(),this.sendBtnWidgetClickEvent("预览动画")})),this.addProperty("listenAniEvent",!0,"boolean");let r=this.addInput("关联音频","lgraphNode"),n=this.addWidget("toggle","关联动画音频",this.properties.listenAniEvent,"listenAniEvent");r.widget=n,this.addInput("isCanClick","boolean").widget=t,this.addProperty("soundFx","无","enum"),this.addWidget("combo","音效",this.properties.soundFx,{property:"soundFx",values:soundFxs})}onConnectInput(t,e,i,r,n){"codeNode"==e&&null!=r._renderSpine&&(this._skins.splice(0,this._skins.length,...r._renderSpine.skins()),this._animations.splice(0,this._animations.length,...r._renderSpine.animations())),this.sendConnectEvent(t,r,n)}onSelected(){this.getEnums(),this.onAction("播放"),this.sendOtherEvent("onSelected")}onDeselected(){this.onAction("停止"),this.sendOtherEvent("onDeselected")}onStart(){super.onStart(),console.log("animate onStart",this.properties.autoRun),1==this.properties.autoRun&&this.onAction("播放")}onStop(){this.onAction("停止")}getEnums(t){var e=this.getRealLinkNode();if(null!=e&&null!=e._renderSpine){let r=e._renderSpine.events();if(this._skins.splice(0,this._skins.length,...e._renderSpine.skins()),this._animations.splice(0,this._animations.length,...e._renderSpine.animations()),1==this._skins.length)this.setProperty("skin",this._skins[0]);else if(Number(this.properties.skin)>=0){let t=this._skins[Number(this.properties.skin)];null!=t&&this.setProperty("skin",t)}if(1==this._animations.length)this.setProperty("playAniName",this._animations[0]),1==t&&(this.setProperty("loop",!0),this.setProperty("autoRun",!0),this.collapse()),this.createCaidanBtn.disabled=!0;else{if(Number(this.properties.playAniName)>=0){let t=this._animations[Number(this.properties.playAniName)];null!=t?this.setProperty("playAniName",t):console.log("我还是没有找到自己的动画",e.properties.customeName,this.properties.playAniName,this._animations)}this.createCaidanBtn.disabled=!1}console.log("skeletonData eventssss",r[this.properties.playAniName]);for(let t=0;t<this.widgets.length;t++)0==this.widgets[t].name.indexOf("音频")&&(this.widgets.splice(t,1),t--);if(null!=r[this.properties.playAniName]){let t=r[this.properties.playAniName];for(var i=0;i<t.length;i++)this.addWidget("button","音频："+t[i].name,"")}}}createClickToNextAni(){let t=LiteGraph.createNode("objects/animates/animate");t.pos=[this.pos[0]+this.width+3,this.pos[1]],this.graph.add(t),this.connect(1,t,1),t.connect(0,this,1),t.setProperty("skin",this.properties.skin),this.setProperty("playAniName","std"),this.setProperty("loop",!0),this.setProperty("autoRun",!0);var e=this._animations.indexOf(this.properties.playAniName);e+=1,null==this._animations[e]&&(e=0);var i=this._animations[e];t.setProperty("playAniName",i);var r=this.getRealLinkNode();null!=r&&r.connect(0,t,0)}previewAni(){if(null!=this.graph){var t=this.getRealLinkNode();null!=t&&""!=this.properties.playAniName&&null!=t.codeNode&&t.codeNode.playAnimation(this.properties.playAniName,this.properties.loop)}}onPropertyChanged(t,e,i){if(null!=this.graph){var r=this.getRealLinkNode();null!=r&&("skin"==t?(null!=r.updateSpinePreview&&r.updateSpinePreview(e),null!=r.codeNode&&(console.log("修改了皮肤",e),r.codeNode.setSkin(e))):"playAniName"==t?null!=r.codeNode&&r.codeNode.playAnimation(e,this.properties.loop):"loop"==t?null!=r.codeNode&&r.codeNode.playAnimation(this.properties.playAniName,e):"timeScale"==t&&null!=r.codeNode&&r.codeNode.setAnimationProb("timeScale",e),this.sendPropertyChangeEvent(t,e,i))}}onWidgetChanged(t,e,i,r){}getTitle(){return this.title+" "+this.properties.skin+"-"+this.properties.playAniName}setValue(t){this.setProperty("value",t)}onAction(t,e){if("播放"==t)if(this.mode=LiteGraph.ALWAYS,null!=(n=this.getInputData(0,!0))){this.playLinkSound(),"无"!=this.properties.soundFx&&""!=this.properties.soundFx&&cc.assetManager.loadRemote(rootHost+"/"+this.properties.soundFx,((t,e)=>{null==t&&cc.audioEngine.play(e,!1,1)}));var i=this.properties.modal,r=this.properties.loop;let t=this.properties.softChange,e=this.properties.aniEndCanClick;this.properties.clickWait,this.waitCanClick=!1,this.hideClickTip(),"全设置"!=i&&"仅设置皮肤"!=i||n.setSkin(this.properties.skin),this._toggleCount=0,"全设置"!=i&&"仅设置动画"!=i||(1==this.properties.cancelEvent&&n.targetOff(),this.clickWaitOutPut=!1,this.aniEnd=!1,n.setAnimationProb("timeScale",this.properties.timeScale),n.playAnimation(this.properties.playAniName,r,t,((t,e)=>{if(console.log("我收到spine音频事件",e.data.name,e.intValue,this.properties.listenAniEvent,this.isInputConnected(3),this.graph.status),0==this.properties.listenAniEvent)return;if(1==this.isInputConnected(3))return;if(2!=this.graph.status)return;let i=this.graph.findNodesByType("output/sound"),r="";e.data&&(r=e.data.name);let s=i.find((t=>t.properties.customeName.split(".")[0]==r));null!=s?s.onAction("播放"):showAlert(n.node.name+":"+t.animation.name+"动画没有相应音频节点:"+r)}),(()=>{this._toggleCount+=1,this._toggleCount<=this.properties.toggleCount&&this.triggerSlot(0),1!=this.aniEnd&&(this.isOutputConnected(1)||this.properties.aniClickReplay)&&1==e&&(1==this.getInputOrProperty("isCanClick")?this.showClickTip():1==this.hasLinkIsCanClick()&&(this.waitCanClick=!0)),this.aniEnd=!0,1==this.clickWaitOutPut&&this.triggerSlot(1,n)})),(this.isOutputConnected(1)||this.properties.aniClickReplay)&&(n.checkAddComponent("SpinePlusComponent"),0==e&&(console.log(this.getRealLinkNode().properties.customeName,"当前是否需要等待显示点击",this.getInputOrProperty("isCanClick"),this.hasLinkIsCanClick()),1==this.getInputOrProperty("isCanClick")?this.showClickTip():1==this.hasLinkIsCanClick()&&(this.waitCanClick=!0)),n.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this))))}else console.warn("当前没有关联codeNode");else if(t="停止"){this.mode=LiteGraph.ON_EVENT;var n=this.getInputData(0,!0);this.waitCanClick=!1,null!=n&&n.pauseAnimation()}}onClick(){null!=window.onGraphNodeClick&&window.onGraphNodeClick({nodeId:this.getIdWithGraph(),time:this.graph.getTime(),funcName:"onClick"});var t=this.getInputData(0,!0);if(null==t)return void console.warn("点击的时候codeNode为空了");if(1==this.graph.config.pause)return;if(0==this.properties.aniEndCanClick);else if(1!=this.aniEnd)return void console.log("点击了但动画没有播放结束");1==this.getInputOrProperty("isCanClick")&&(null==this.curWaitTime?(this.properties.aniClickTimeSpace>0&&(this.curWaitTime=this.properties.aniClickTimeSpace),t.targetOff(),1==this.properties.clickWait?this.clickWaitOutPut=!0:(this.triggerSlot(1,t),this.hideClickTip()),1==this.properties.aniClickReplay&&this.onAction("播放")):console.log("当前需等待点击间隔",this.curWaitTime))}onExecute(){if(null!=this.curWaitTime){var t=this.graph.elapsed_time;this.curWaitTime-=t,this.curWaitTime<=0&&(this.curWaitTime=null)}if(1==this.waitCanClick){1==this.getInputOrProperty("isCanClick")&&(this.showClickTip(),this.waitCanClick=!1)}}}animate.title="骨骼动画",animate.modalEnum=["全设置","仅设置皮肤","仅设置动画"],LiteGraph.registerNodeType("objects/animates/animate",animate);class tween extends BaseYWNode{title="数值动画";desc="用于控制节点属性变化";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("播放",LiteGraph.ACTION),this.addOutput("结束",LiteGraph.EVENT),this.addOutput("点击",LiteGraph.EVENT),this.addProperty("duration",1,"number"),this.addWidget("number","动画时长",this.properties.duration,"duration",{precision:1,min:0,max:60}),this.addProperty("delay",0,"number"),this.addWidget("number","延迟播放时间",this.properties.delay,"delay",{precision:1,min:0,max:60}),this.addProperty("easing","无","enum"),this.addWidget("combo","缓动效果",this.properties.easing,{property:"easing",values:tween.easingEnum}),this.addProperty("tweenMode","变化目标值","enum"),this.addWidget("combo","动画模式",this.properties.tweenMode,{property:"tweenMode",values:tween.tweenModeEnum}),this.addProperty("dontTween",!1,"boolean"),this.addWidget("toggle","无动画直接修改值",this.properties.dontTween,"dontTween"),this.addProperty("cancelEvent",!1,"boolean"),this.addWidget("toggle","取消其他触摸事件",this.properties.cancelEvent,"cancelEvent"),this.addProperty("cancelOtherTween",!1,"boolean"),this.addWidget("toggle","打断其它数值动画",this.properties.cancelOtherTween,"cancelOtherTween"),this.addProperty("autoRun",!1,"boolean"),this.addWidget("toggle","是否自动播放",this.properties.autoRun,"autoRun"),this.addProperty("x",0,"number"),this.addWidget("number","坐标-x",this.properties.x,"x",{precision:1}),this.addProperty("y",0,"number"),this.addWidget("number","坐标-y",this.properties.y,"y",{precision:1}),this.addProperty("scaleX",1,"number"),this.scaleXWidget=this.addWidget("number","缩放-x",this.properties.scaleX,"scaleX",{precision:1}),this.addProperty("scaleY",1,"number"),this.scaleYWidget=this.addWidget("number","缩放-y",this.properties.scaleY,"scaleY",{precision:1}),this.addProperty("opacity",255,"number"),this.addWidget("number","透明度",this.properties.opacity,"opacity",{precision:0,min:-255,max:255}),this.addProperty("angle",0,"number"),this.addWidget("number","角度",this.properties.angle,"angle",{min:-360,max:360,precision:0}),this.addProperty("anchorX",.5,"number"),this.addWidget("number","锚点x",this.properties.anchorX,"anchorX",{min:-1,max:1,precision:1,step2:.1}),this.addProperty("anchorY",.5,"number"),this.addWidget("number","锚点y",this.properties.anchorY,"anchorY",{min:-1,max:1,precision:1,step2:.1}),this.addProperty("width",50,"number"),this.widthWidget=this.addWidget("number","宽度",this.properties.width,"width",{precision:0,min:0,max:9999}),this.addProperty("height",50,"number"),this.heightWidget=this.addWidget("number","高度",this.properties.height,"height",{precision:0,min:0,max:9999}),this.addProperty("color","#ffffff","string"),this.addWidget("string","物体颜色",this.properties.color,"color"),this.addProperty("zoomRatio",1,"number"),this.addWidget("number","镜头缩放",this.properties.zoomRatio,"zoomRatio",{precision:1,min:1,max:10,step2:.01}),this.addProperty("nodeConfig",{x:this.properties.x,y:this.properties.y,width:this.properties.width,height:this.properties.height,anchorX:this.properties.anchorX,anchorY:this.properties.anchorY,scaleX:this.properties.scaleX,scaleY:this.properties.scaleY,color:this.properties.color,angle:this.properties.angle},"object"),this.nodeConfigWidget=this.addWidget("ccnode","节点操控",this.properties.nodeConfig,"nodeConfig",{viewWidth:designViewWidth,viewHeight:designViewHeight}),this.addWidget("button","同步目标物体属性","",(()=>{this.syncTargetValue(),this.sendBtnWidgetClickEvent("同步目标物体属性")})),this.addWidget("button","重置变化多少值","",(()=>{this.setProperty("x",0),this.setProperty("y",0),this.setProperty("width",0),this.setProperty("height",0),this.setProperty("anchorX",0),this.setProperty("anchorY",0),this.setProperty("scaleX",0),this.setProperty("scaleY",0),this.setProperty("opacity",0),this.setProperty("color","#000000"),this.setProperty("angle",0),this.setProperty("zoomRatio",0)})),this.addWidget("button","预览动画","",(()=>{null!=this.previewTween&&(this.syncTargetValue(this.previewTween),this.realRun(this.previewTween,"播放"))}))}onConnectInput(t,e,i,r,n){console.log("onConnectInput",t,e,i,r,n),"codeNode"==e&&"objects/camera"==r.type&&null!=r.codeNode&&setTimeout((()=>{this.syncTargetValue()}),100),this.sendConnectEvent(t,r,n)}onSelected(){if(null==this.previewTween){let e=this.getRealLinkNode();if(null==e)return;if(null!=e.codeNode&&cc.isValid(e.codeNode.node)){var t=cc.instantiate(e.codeNode.node);t.isClone=!0,t.zIndex=9999,this.previewTween=t.getComponent("CodeNodeLg"),null!=this.previewTween?(this.previewTween.init(),this.previewTween.parent=e.codeNode.parent,this.previewTween.nodeName+="_preview",syncConfigToCodeNode(this.previewTween,this.properties.nodeConfig),this.previewTween.updatePreview()):console.warn("获取到了无效节点",t)}}this.sendOtherEvent("onSelected")}onDeselected(){null!=this.previewTween&&(this.previewTween.destroyNode(),this.previewTween=null)}onStart(){console.log("animate onStart",this.properties.autoRun),1==this.properties.autoRun&&this.onAction("播放"),super.onStart()}onStop(){this.onAction("停止")}syncTargetValue(t){let e=this.getRealLinkNode();if(null!=e&&e.widgets)for(var i=0;i<e.widgets.length;i++){var r=e.widgets[i];if("ccnode"!=r.type){var n=this.widgets.findIndex((t=>t.name==r.name));-1!=n&&(null!=t?t[this.widgets[n].options.property]=r.value:this.widgets[n].setValue(r.value,{e:null,node:this,canvas:null}))}else for(var s in r.value){let e=this.widgets.findIndex((t=>t.options.property==s));-1!=e&&(null!=t?t[this.widgets[e].options.property]=r.value[s]:this.widgets[e].setValue(r.value[s],{e:null,node:this,canvas:null}))}}}onPropertyChanged(t,e,i){if("nodeConfig"!=t&&"object"==typeof this.nodeConfigWidget.value&&(null!=this.nodeConfigWidget.value[t]&&(this.nodeConfigWidget.value[t]=e,this.properties.nodeConfig[t]=e),"zoomRatio"==t&&0!=e&&(null!=this.nodeConfigWidget.value.scaleX&&(this.nodeConfigWidget.value.scaleX=1/e,this.properties.nodeConfig.scaleX=1/e,this.nodeConfigWidget.value.scaleY=1/e,this.properties.nodeConfig.scaleY=1/e),this.scaleXWidget.value=1/e,this.scaleYWidget.value=1/e,this.properties.scaleX=1/e,this.properties.scaleY=1/e)),null!=this.previewTween){var r={};"nodeConfig"==t?r={...e}:r[t]=this.properties[t],syncConfigToCodeNode(this.previewTween,r)}this.sendPropertyChangeEvent(t,e,i)}onWidgetChanged(t,e,i,r){}setValue(t){this.setProperty("value",t)}realRun(t){let e=this.properties.delay,i=this.properties.duration,r=this.properties.easing,n=this.properties.dontTween,s=this.properties.cancelOtherTween,o=this.properties.cancelEvent,a=this.properties.tweenMode,l={...this.properties.nodeConfig};var c=cc.Color.WHITE.fromHEX(l.color);if(l.r=c.getR(),l.g=c.getG(),l.b=c.getB(),l.opacity=this.properties.opacity,delete l.color,"无"!=r){var h=tween.easingEnum.indexOf(r);r=-1!=h?{easing:tween.easingConfig[h]}:{}}else r={};this.aniEnd=!1,this.inRun=!0,1==s&&(cc.Tween.stopAllByTarget(t),cc.Tween.stopAllByTarget(t.node)),1==o&&t.targetOff(),1==n?(this.aniEnd=!0,this.inRun=!1,syncConfigToCodeNode(t,l)):(console.log("开始播放动画",i,JSON.parse(JSON.stringify(l)),r),this.tweenTag="tween_"+this.getIdWithGraph(),console.log("当前graphid tweenTag",this.graph.id,this.tweenTag),cc.Tween.stopAllByTag(this.tweenTag),null!=t.camera&&(l.zoomRatio=this.properties.zoomRatio),"变化目标值"==a?(console.log("目标值"),xorConfig(t,l),console.log("剔除掉之后的值",l),this.tween=cc.tween(t).tag(this.tweenTag).delay(e).to(i,l,r).call((()=>{this.triggerSlot(0,t),this.aniEnd=!0,this.inRun=!1})).start()):"变化多少值"==a&&(xorConfigZeroValue(l),console.log("剔除掉0值之后的值",l),this.tween=cc.tween(t).tag(this.tweenTag).delay(e).by(i,l,r).call((()=>{this.triggerSlot(0,t),this.aniEnd=!0,this.inRun=!1})).start())),this.isOutputConnected(1)&&(t.checkAddComponent("SpinePlusComponent"),t.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this)))}onAction(t,e){if("播放"==t){var i=this.getInputData(0,!0);null!=i?this.realRun(i):console.warn("当前没有关联codeNode")}else"停止"==t&&(this.tweenTag="tween_"+this.getIdWithGraph(),cc.Tween.stopAllByTag(this.tweenTag))}onClick(){null!=window.onGraphNodeClick&&window.onGraphNodeClick({nodeId:this.getIdWithGraph(),time:this.graph.getTime(),funcName:"onClick"});var t=this.getInputData(0,!0);null!=t?1!=this.graph.config.pause&&1==this.aniEnd&&(t.targetOff(),this.triggerSlot(1,t)):console.warn("点击时codeNode == null")}}tween.title="数值动画",tween.easingEnum=["无","淡入","淡出","淡入淡出","回弹","弹跳"],tween.easingConfig=["none","quadIn","quadOut","quadInOut","backOut","bounceOut"],tween.tweenModeEnum=["变化目标值","变化多少值"],LiteGraph.registerNodeType("objects/animates/tween",tween);class bezierCurve extends BaseYWNode{title="路径动画";desc="用于控制节点进行曲线移动";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addInput("长度","number"),this.addInput("播放",LiteGraph.ACTION),this.addInput("重置位置",LiteGraph.ACTION),this.addOutput("结束",LiteGraph.EVENT),this.addProperty("points",[0,0,200,200,400,0],"array"),this.curveWidget=this.addWidget("curve","曲线控制点",this.properties.points,"points",{viewWidth:designViewWidth,viewHeight:designViewHeight}),this.selectCtrl=this.addWidget("number","选择控制点",-1,(t=>{this.properties.selectPoint=t,this.curveWidget.selectPoint=t}),{precision:0,min:-1,max:this.properties.points.length/2-1}),this.addWidget("button","","",(t=>{"删除控制点"==t.clickeName?(this.curveWidget.remonveCtrlPoint(this),this.selectCtrl.options.max=this.properties.points.length/2-1):"添加控制点"==t.clickeName&&(this.curveWidget.addCtrlPoint(this),this.selectCtrl.options.max=this.properties.points.length/2-1)}),{buttons:["删除控制点","添加控制点"]}),this.addProperty("startT",0,"number"),this.addWidget("slider","起始位置",this.properties.startT,"startT",{precision:2,min:0,max:1,step2:.01}),this.addProperty("endT",1,"number"),this.addWidget("slider","终点位置",this.properties.endT,"endT",{precision:2,min:0,max:1,step2:.01}),this.addProperty("aniType","随步长","enum"),this.addWidget("combo","动画模式",this.properties.aniType,{property:"aniType",values:bezierCurve.tweenModeEnum}),this.addProperty("duration",1,"number"),this.durationWidget=this.addWidget("slider","动画时长",this.properties.duration,"duration",{precision:1,min:0,max:60,step2:.1}),this.addProperty("oneStep",.01,"number"),this.oneStepWidget=this.addWidget("slider","动画步长",this.properties.oneStep,"oneStep",{precision:2,min:0,max:1,step2:.01}),this.addProperty("lookUp",!1,"boolean"),this.addWidget("toggle","角度跟随路径",this.properties.lookUp,"lookUp"),this.addProperty("startResetT",!1,"boolean"),this.addWidget("toggle","开始运行时重置",this.properties.startResetT,"startResetT"),this.addProperty("autoRun",!1,"boolean"),this.addWidget("toggle","是否自动播放",this.properties.autoRun,"autoRun"),this.addWidget("button","预览动画","",(()=>{null!=this.previewTween&&this.realRun(this.previewTween,"播放")}))}onConnectInput(t,e,i,r,n){console.log("onConnectInput",t,e,i,r,n),this.sendConnectEvent(t,r,n)}onAdded(){this.updateWidght(),this.sendAddEvent()}onConfigure(){this.updateWidght()}onSelected(){if(null==this.previewTween){var t=this.getRealLinkNode();if(null==t)return;if(null!=t.codeNode&&cc.isValid(t.codeNode.node)){var e=cc.instantiate(t.codeNode.node);e.isClone=!0,e.zIndex=9999,this.previewTween=e.getComponent("CodeNodeLg"),this.previewTween.init(),this.previewTween.parent=t.codeNode.parent,this.previewTween.curve=new Bezier(this.properties.points),this.length=this.previewTween.curve.length(),this.previewTween.t=this.properties.startT}}this.sendOtherEvent("onSelected")}onDeselected(){null!=this.previewTween&&(this.previewTween.destroyNode(),this.previewTween=null)}onStart(){console.log("animate onStart",this.properties.autoRun),this.length=2*new Bezier(this.properties.points).length(),this.t=0,1==this.properties.autoRun&&this.onAction("播放"),super.onStart()}onStop(){this.onAction("停止")}updateWidght(){let t=this.properties.aniType;this.durationWidget.disabled=!1,this.oneStepWidget.disabled=!1,"随长度"==t?(this.durationWidget.disabled=!0,this.oneStepWidget.disabled=!0):"随时间"==t?this.oneStepWidget.disabled=!0:"随步长"==t&&(this.durationWidget.disabled=!0)}onWidgetChanged(t,e,i,r){r.options.property,"动画模式"==t&&this.updateWidght(),"曲线控制点"==t&&(this.properties.points=e,this.selectCtrl.value=this.curveWidget.selectPoint,null!=this.previewTween?(this.previewTween.curve=new Bezier(this.properties.points),this.length=this.previewTween.curve.length(),this.previewTween.t=this.properties.startT):console.log("当前没有previewTween")),"起始位置"!=t&&"终点位置"!=t||null!=this.previewTween&&(this.previewTween.t=this.properties.startT)}setValue(t){this.setProperty("value",t)}realRun(t,e){if("播放"==e){let e=this.properties.duration,n=this.properties.lookUp,s=this.properties.aniType,o=this.properties.startResetT,a=this.properties.endT;if(t.lookUp=n,null==t.curve){var i=new Bezier(this.properties.points);this.length=i.length(),t.curve=i}if("随长度"==s){var r=this.getInputData(1)||0;let e=r/this.length;console.log("输入的value / lenght",r,this.length,e),t.t+=e}else if("随步长"==s){let e=this.properties.oneStep;t.t+=.01*e}else"随时间"==s&&(1==o&&(t.t=this.properties.startT),cc.Tween.stopAllByTag(this.tweenTag),this.tweenTag="curve_"+t.node._id,cc.tween(t).tag(this.tweenTag).to(e,{t:a}).call((()=>{this.triggerSlot(0,t)})).start());this.t=t.t,1==t.t&&this.triggerSlot(0,t)}else if("重置位置"==e){this.end=!1;i=new Bezier(this.properties.points);this.length=i.length(),t.curve=i,t.t=.01*this.properties.startT}else"停止"==e&&cc.Tween.stopAllByTag(this.tweenTag)}onAction(t,e){let i=this.getInputData(0,!0);null!=i?this.realRun(i,t):console.warn("当前没有关联codeNode")}}bezierCurve.title="路径动画",bezierCurve.tweenModeEnum=["随步长","随时间","随长度"],LiteGraph.registerNodeType("objects/animates/bezierCurve",bezierCurve);class camera extends BaseYWNode{title="镜头";desc="在绘本中使用镜头位移效果";color="#3F42EA";constructor(){super(),this.priority=-999,this.widgets_up=!0,this.addOutput("物体","codeNode"),this.addProperty("x",0,"number"),this.addWidget("number","坐标-x",this.properties.x,"x",{precision:1}),this.addProperty("y",0,"number"),this.addWidget("number","坐标-y",this.properties.y,"y",{precision:1}),this.addProperty("zoomRatio",1,"number"),this.addWidget("number","镜头缩放",this.properties.zoomRatio,"zoomRatio",{precision:1,min:1,max:10,step2:.01}),this.addProperty("nodeConfig",{x:0,y:0,width:designViewWidth,height:designViewHeight,anchorX:.5,anchorY:.5,scaleX:1,scaleY:1,color:"#3F42EA",angle:0},"object"),this.nodeConfigWidget=this.addWidget("ccnode","节点操控",this.properties.nodeConfig,"nodeConfig",{viewWidth:designViewWidth,viewHeight:designViewHeight,justDrawBorder:!0,borderColor:"#3F42EA"}),this.addWidget("button","重置到默认状态","",(()=>{this.setProperty("x",0),this.setProperty("y",0),this.setProperty("zoomRatio",1)}))}createObj(t){if(null!=this.codeNode&&(this.codeNode.destroyNode(),this.codeNode=null,this.setOutputData(0,null),null!=this.cameraUi&&cc.isValid(this.cameraUi)&&(this.cameraUi.destroy(),this.cameraUi=null)),null!=this.codeNode){if(1==cc.isValid(this.codeNode.node))return(e={...this.properties.nodeConfig}).zoomRatio=this.properties.zoomRatio,syncConfigToCodeNode(this.codeNode,e),null!=t&&t(),void this.setOutputData(0,this.codeNode);this.codeNode=null,this.setOutputData(0,null)}var e={...this.properties.nodeConfig},i=this.graph.vars.rootccNode;if(null!=i&&(e.parent=i),this.codeNode=createObj(e,t),this.codeNode.nodeName="Camera",1==isPreviewMode){var r=this.codeNode.checkAddComponent(cc.Graphics);this.codeNode.ctx=r,this.codeNode.zIndex=99999,this.codeNode.updatePreview()}else{let t=this.codeNode.checkAddComponent(cc.Camera);t.cullingMask=-31,t.clearFlags=6,this.codeNode.camera=t,this.codeNode.zoomRatio=this.properties.zoomRatio}return this.setOutputData(0,this.codeNode),this.codeNode}onAdded(){null==this.codeNode&&0==isInApp&&this.createObj(),this.sendAddEvent()}onSelected(){null==this.codeNode&&0==isInApp&&this.createObj(),this.sendOtherEvent("onSelected")}updateOutputData(t){null==this.codeNode&&0==isInApp&&this.createObj(),this.setOutputData(t,this.codeNode)}onStartBeforeLoad(){}onStart(){this.createObj()}onPause(){null!=this.codeNode&&cc.director.getActionManager().pauseTarget(this.codeNode)}onResume(){null!=this.codeNode&&cc.director.getActionManager().resumeTarget(this.codeNode)}onStop(){if(null!=this.codeNode&&0==isInApp){var t={...this.properties.nodeConfig};t.zoomRatio=this.properties.zoomRatio,syncConfigToCodeNode(this.codeNode,t)}}onRemoved(){null!=this.codeNode&&(this.codeNode.destroyNode(),this.codeNode=null,this.setOutputData(0,null)),null!=this.cameraUi&&cc.isValid(this.cameraUi)&&(this.cameraUi.destroy(),this.cameraUi=null),this.sendRemoveEvent()}onPropertyChanged(t,e,i){if("nodeConfig"!=t&&"object"==typeof this.nodeConfigWidget.value&&(null!=this.nodeConfigWidget.value[t]&&(this.nodeConfigWidget.value[t]=e,this.properties.nodeConfig[t]=e),"zoomRatio"==t&&null!=this.nodeConfigWidget.value.scaleX&&(this.nodeConfigWidget.value.scaleX=1/e,this.properties.nodeConfig.scaleX=1/e,this.nodeConfigWidget.value.scaleY=1/e,this.properties.nodeConfig.scaleY=1/e)),null!=this.codeNode){var r={};"nodeConfig"==t?r={...e}:r[t]=this.properties[t],syncConfigToCodeNode(this.codeNode,r)}this.sendPropertyChangeEvent(t,e,i)}}camera.title="镜头",LiteGraph.registerNodeType("objects/camera",camera);class connection extends BaseYWNode{title="连接零件";desc="将一个物体设置为另一个物体的子物体";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("关联父物体","codeNode"),this.addInput("关联子物体","codeNode")}onGetInputs(){return[["关联子物体","codeNode"]]}onStart(){this.onAction(),super.onStart()}onSelected(){this.onAction(),this.sendOtherEvent("onSelected")}disconnectInput(t,e){if(t>=1){let e=this.getInputData(t,!0);if(null!=e){let t=this.graph.vars.rootccNode;null==t&&(t=cc.director.getScene().getChildByName("Canvas")),null!=t&&(e.parent=t)}}super.disconnectInput(t,e)}onAction(){var t=this.getInputData(0,!0);if(null==t)return;let e=t.node;if(null!=e)for(var i=1;i<this.inputs.length;i++){let t=this.getInputData(i,!0);null!=t&&(t.parent=e)}}}connection.title="连接零件",LiteGraph.registerNodeType("objects/group/connection",connection);class groupMove extends BaseYWNode{title="整体移动";desc="用于在开发时整体移动所有物体";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addProperty("x",0,"number"),this.addWidget("number","坐标-x",this.properties.x,"x",{precision:2}),this.addProperty("y",0,"number"),this.addWidget("number","坐标-y",this.properties.y,"y",{precision:2})}onPropertyChanged(t,e,i){console.log("当前变量切换",t,e,i,e-i);let r=this.graph.findNodesByType("objects/createObject"),n=e-i;r.forEach((e=>{e.setProperty(t,e.properties[t]+n)})),this.sendPropertyChangeEvent(t,e,i)}}groupMove.title="整体移动",LiteGraph.registerNodeType("objects/groupMove",groupMove);class dynimicWidget extends BaseYWNode{title="动态位置";desc="自动根据当前屏幕尺寸设置物体位置";constructor(){super(),this.mode=LiteGraph.ON_EVENT}onPropertyChanged(t,e,i){}}dynimicWidget.title="动态位置",dynimicWidget.posEnum=["屏幕右下","屏幕右上","屏幕左下","屏幕左上"],LiteGraph.registerNodeType("objects/dynimicWidget",dynimicWidget);class groupScale extends BaseYWNode{title="分镜预览缩放";desc="用于在开发时分镜预览缩放，以便看清超出屏幕范围的物体";color="#FFC082";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addProperty("x",0,"number"),this.addWidget("number","位移x",this.properties.x,"x",{precision:2}),this.addProperty("y",0,"number"),this.addWidget("number","位移y",this.properties.y,"y",{precision:2}),this.addProperty("zoomRatio",1,"number"),this.addWidget("slider","缩放",this.properties.zoomRatio,"zoomRatio",{precision:2,min:.25,max:1}),this.addProperty("nodeConfig",{x:0,y:0,width:designViewWidth,height:designViewHeight,anchorX:.5,anchorY:.5,scaleX:1,scaleY:1,color:"#FFC082",angle:0},"object"),this.nodeConfigWidget=this.addWidget("ccnode","节点操控",this.properties.nodeConfig,"nodeConfig",{viewWidth:designViewWidth,viewHeight:designViewHeight,justDrawBorder:!1,borderColor:"#FFC082"}),this.addWidget("button","重置到默认状态","",(()=>{console.log("点击了重置属性"),this.setProperty("x",0),this.setProperty("y",0),this.setProperty("zoomRatio",1)}))}onPropertyChanged(t,e,i){{let i=cc.director.getScene().getChildByName("Canvas").getChildByName("Main Camera");"x"==t?i.x=-1*e/this.properties.zoomRatio:"y"==t?i.y=-1*e/this.properties.zoomRatio:"zoomRatio"==t&&(i.getComponent(cc.Camera).zoomRatio=e),"nodeConfig"!=t&&"object"==typeof this.nodeConfigWidget.value&&(null!=this.nodeConfigWidget.value[t]&&(this.nodeConfigWidget.value[t]=e,this.properties.nodeConfig[t]=e),"zoomRatio"==t&&null!=this.nodeConfigWidget.value.scaleX&&(this.nodeConfigWidget.value.scaleX=e,this.properties.nodeConfig.scaleX=e,this.nodeConfigWidget.value.scaleY=e,this.properties.nodeConfig.scaleY=e))}this.sendPropertyChangeEvent(t,e,i)}onStop(){}onAttachCanvas(){}onConfigure(){{let t=cc.director.getScene().getChildByName("Canvas").getChildByName("Main Camera");t.x=-1*this.properties.x/this.properties.zoomRatio,t.y=-1*this.properties.y/this.properties.zoomRatio,t.getComponent(cc.Camera).zoomRatio=this.properties.zoomRatio}}onRemoved(){this.onAction("重置"),this.sendRemoveEvent()}onAction(t){if("重置"==t){let t=cc.director.getScene().getChildByName("Canvas").getChildByName("Main Camera");t.x=0,t.y=0,t.getComponent(cc.Camera).zoomRatio=1}}}groupScale.title="分镜预览缩放",LiteGraph.registerNodeType("objects/groupScale",groupScale);class systemData extends LGraphNode{title="系统数据";desc="获取系统数据";constructor(){super(),this.addOutput("值","number,string,boolean,object,array"),this.addProperty("modal","时间戳-秒","enum"),this.addWidget("combo","类型",this.properties.modal,{property:"modal",values:systemData.valueTypes}),this.addProperty("fileName",""),this.addWidget("string","表名称",this.properties.fileName,"fileName"),this.widgets_up=!0,this.size=[180,40]}getTitle(){return this.flags.collapsed?"配置表"==this.properties.modal?this.properties.modal+":"+this.properties.fileName:this.properties.modal:this.title}onAdded(){this.updateWidght()}onConfigure(){this.updateWidght()}updateWidght(){var t=this.properties.modal;this.widgets.map((e=>{"表名称"==e.name&&(e.disabled="配置表"!=t)}))}onWidgetChanged(t,e,i,r){"类型"==t&&this.updateWidght()}onStart(){this.onExecute()}getLinkData(){let t=null;var e=systemData.valueTypes.indexOf(this.properties.modal);if(0==e)t=Math.floor((new Date).getTime()/1e3);else if(1==e){var i=(n=new Date).getMonth()+1;i<10&&(i="0"+i);var r=n.getDate();r<10&&(r="0"+r),t=n.getFullYear()+"/"+i+"/"+r}else if(2==e){(s=(n=new Date).getHours())<10&&(s="0"+s),(o=n.getMinutes())<10&&(o="0"+o),(a=n.getSeconds())<10&&(a="0"+a),t=s+":"+o+":"+a}else if(3==e){var n,s=(n=new Date).getHours(),o=n.getMinutes(),a=n.getSeconds();s<10&&(s="0"+s),o<10&&(o="0"+o),t=s+":"+o}else 4==e?t=cc.sys.os:5==e?t=1:6==e||(7==e?t={}:8==e?t=[]:9==e?t=cc.winSize.width:10==e?t=cc.winSize.height:11==e?(t=.5*cc.winSize.width,t=[-t,t]):12==e&&(t=.5*cc.winSize.height,t=[-t,t]));return t}onExecute(){let t=this.getLinkData();this.setOutputData(0,t)}}systemData.title="系统数据",systemData.valueTypes=["时间戳-秒","年:月:日","时:分:秒","时:分","系统","版本","配置表","Object","Array","空间宽度","空间高度","空间X轴范围","空间Y轴范围"],LiteGraph.registerNodeType("input/getData/systemData",systemData);class customData extends LGraphNode{title="自定义数据";desc="获取自定义数据";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addOutput("值","number,string,boolean,object,array"),this.addProperty("saveKey","","string"),this.addWidget("string","数据key",this.properties.saveKey,"saveKey"),this.addProperty("ifEmpty","","enum"),this.addWidget("combo","默认类型",this.properties.ifEmpty,{property:"ifEmpty",values:customData.valueTypes}),this.addProperty("defaultValue","","string"),this.addWidget("text","默认值",this.properties.defaultValue,"defaultValue"),this.widgets_up=!0,this.size=[180,30]}getTitle(){return this.flags.collapsed?this.title+":"+this.properties.saveKey:this.title}onAdded(){}onConfigure(){}updateWidght(){this.properties.modal,this.widgets.map((t=>{}))}onStart(){this.onExecute()}onExecute(){let t=cc.sys.localStorage.getItem("codeJsonData");t=null==t||""==t?{}:JSON.parse(t);let e=t[this.properties.saveKey];if(null==e){let t=this.properties.ifEmpty;if("数值"==t)e=Number(this.properties.defaultValue),isNaN(e)&&(e=0);else if("文字"==t)e=this.properties.defaultValue;else try{e=JSON.parse(this.properties.defaultValue)}catch(i){e="字典"==t?{}:[]}}this.setOutputData(0,e)}}customData.title="自定义数据",customData.valueTypes=["数值","文字","字典","数组"],LiteGraph.registerNodeType("input/getData/customData",customData);class screenSize extends LGraphNode{title="屏幕适配";desc="获取屏幕适配数据";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addOutput("4:3",LiteGraph.EVENT),this.addOutput("16:9",LiteGraph.EVENT),this.addOutput("18:9",LiteGraph.EVENT)}onAdded(){}onConfigure(){}updateWidght(){this.properties.modal,this.widgets.map((t=>{}))}onStart(){this.onExecute()}onExecute(){let t=Math.max(cc.winSize.width,cc.winSize.height)/Math.min(cc.winSize.width,cc.winSize.height);t<1.6?this.triggerSlot(0):t<1.9?this.triggerSlot(1):this.triggerSlot(2)}}screenSize.title="屏幕适配",LiteGraph.registerNodeType("input/screenSize",screenSize);class setData extends LGraphNode{title="保存自定义数据";desc="保存自定义数据";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("值","number,string,boolean,object,array"),this.addInput("保存",LiteGraph.ACTION),this.addProperty("saveKey","","string"),this.addWidget("string","数据key",this.properties.saveKey,"saveKey")}getTitle(){return this.flags.collapsed?this.title+":"+this.properties.saveKey:this.title}onAdded(){}onConfigure(){}updateWidght(){this.properties.modal,this.widgets.map((t=>{}))}onAction(t){let e=this.getInputData(0);if(null==e)return;let i=cc.sys.localStorage.getItem("codeJsonData");i=null==i||""==i?{}:JSON.parse(i),i[this.properties.saveKey]=e,cc.sys.localStorage.setItem("codeJsonData",JSON.stringify(i))}}setData.title="保存自定义数据",LiteGraph.registerNodeType("output/setData",setData);class Subgraph extends LGraphNode{title="分支蓝图";desc="Graph inside a node";color="#334";constructor(){super(),this.addProperty("enabled",!0,"boolean"),this.enabled=!0,this.subgraph=new LiteGraph.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}onGetInputs(){return[["enabled","boolean"],["触发",LiteGraph.ACTION]]}onGetOutputs(){return[["结束",LiteGraph.EVENT],["被引用","lgraphNode"]]}onDblClick(t,e,i){var r=this;setTimeout((function(){i.openSubgraph(r.subgraph)}),10)}onDrawTitle(t,e){let i=this;if(!i.flags.collapsed&&i.subgraph&&!i.skip_subgraph_button){var r=LiteGraph.NODE_TITLE_HEIGHT,n=i.size[0]-r,s=LiteGraph.isInsideRectangle(e[0]-i.pos[0],e[1]-i.pos[1],n+2,2-r,r-4,r-4);t.fillStyle=s?"#888":"#555",this.renderingShape==LiteGraph.BOX_SHAPE?t.fillRect(n+2,2-r,r-4,r-4):(t.beginPath(),t.roundRect(n+2,2-r,r-4,r-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(n+.2*r,.6*-r),t.lineTo(n+.8*r,.6*-r),t.lineTo(n+.5*r,.3*-r),t.fill()}}onAction(t,e){this.subgraph.onAction(t,e)}onExecute(){if(this.enabled=this.getInputOrProperty("enabled"),this.enabled){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],i=this.getInputData(t);this.subgraph.setInputData(e.name,i)}if(this.subgraph.runStep(),this.outputs)for(t=0;t<this.outputs.length;t++){var r=this.outputs[t];i=this.subgraph.getOutputData(r.name);this.setOutputData(t,i)}}}sendEventToAllNodes(t,e,i){console.log("sendEventToAllNodes",t,e,i),this.enabled&&this.subgraph.sendEventToAllNodes(t,e,i)}onDrawBackground(t,e,i,r){if(this.flags.collapsed)return;var n=this.size[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,s=LiteGraph.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+n,this.size[0],LiteGraph.NODE_TITLE_HEIGHT);let o=LiteGraph.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+n,this.size[0]/2,LiteGraph.NODE_TITLE_HEIGHT);t.fillStyle=s?"#555":"#222",t.beginPath(),this._shape==LiteGraph.BOX_SHAPE?o?t.rect(0,n,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT):t.rect(this.size[0]/2,n,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT):o?t.roundRect(0,n,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT,[0,0,8,8]):t.roundRect(this.size[0]/2,n,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT,[0,0,8,8]),s?t.fill():t.fillRect(0,n,this.size[0]+1,LiteGraph.NODE_TITLE_HEIGHT),t.textAlign="center",t.font="24px Arial",t.fillStyle=s?"#DDD":"#999",t.fillText("+",.25*this.size[0],n+24),t.fillText("+",.75*this.size[0],n+24)}onMouseDown(t,e,i){if(!this.flags.collapsed&&e[0]>this.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&e[1]<0){var r=this;setTimeout((function(){i.openSubgraph(r.subgraph)}),10)}var n=this.size[1]-LiteGraph.NODE_TITLE_HEIGHT+.5;console.log(0),e[1]>n&&(e[0]<this.size[0]/2?(console.log(1),i.showSubgraphPropertiesDialog(this)):(console.log(2),i.showSubgraphPropertiesDialogRight(this)))}computeSize(){var t=this.inputs?this.inputs.length:0,e=this.outputs?this.outputs.length:0;return[200,Math.max(t,e)*LiteGraph.NODE_SLOT_HEIGHT+LiteGraph.NODE_TITLE_HEIGHT]}onSubgraphTrigger(t,e){console.log("onSubgraphTrigger",t,e);var i=this.findOutputSlot(t);-1!=i&&this.triggerSlot(i)}onSubgraphNewInput(t,e){-1==this.findInputSlot(t)&&this.addInput(t,e)}onSubgraphRenamedInput(t,e){var i=this.findInputSlot(t);-1!=i&&(this.getInputInfo(i).name=e)}onSubgraphTypeChangeInput(t,e){var i=this.findInputSlot(t);-1!=i&&(this.getInputInfo(i).type=e)}onSubgraphRemovedInput(t){var e=this.findInputSlot(t);-1!=e&&this.removeInput(e)}onSubgraphNewOutput(t,e){-1==this.findOutputSlot(t)&&this.addOutput(t,e)}onSubgraphRenamedOutput(t,e){var i=this.findOutputSlot(t);-1!=i&&(this.getOutputInfo(i).name=e)}onSubgraphTypeChangeOutput(t,e){var i=this.findOutputSlot(t);-1!=i&&(this.getOutputInfo(i).type=e)}onSubgraphRemovedOutput(t){var e=this.findOutputSlot(t);-1!=e&&this.removeOutput(e)}getExtraMenuOptions(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]}onResize=function(t){t[1]+=20};serialize=function(){var t=LiteGraph.LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t};reassignSubgraphUUIDs(t){const e={nodeIDs:{},linkIDs:{}};for(const i of t.nodes){const t=i.id,r=LiteGraph.uuidv4();if(i.id=r,e.nodeIDs[t]||e.nodeIDs[r])throw new Error(`New/old node UUID wasn't unique in changed map! ${t} ${r}`);e.nodeIDs[t]=r,e.nodeIDs[r]=t}for(const i of t.links){const t=i[0],r=LiteGraph.uuidv4();if(i[0]=r,e.linkIDs[t]||e.linkIDs[r])throw new Error(`New/old link UUID wasn't unique in changed map! ${t} ${r}`);e.linkIDs[t]=r,e.linkIDs[r]=t;const n=i[1],s=i[3];if(!e.nodeIDs[n])throw new Error(`Old node UUID not found in mapping! ${n}`);if(i[1]=e.nodeIDs[n],!e.nodeIDs[s])throw new Error(`Old node UUID not found in mapping! ${s}`);i[3]=e.nodeIDs[s]}for(const i of t.nodes){if(i.inputs)for(const t of i.inputs)t.link&&(t.link=e.linkIDs[t.link]);if(i.outputs)for(const t of i.outputs)t.links&&(t.links=t.links.map((t=>e.linkIDs[t])))}for(const i of t.nodes)if("middle/graph/subgraph"===i.type){const t=reassignGraphUUIDs(i.subgraph);e.nodeIDs.assign(t.nodeIDs),e.linkIDs.assign(t.linkIDs)}}clone(){var t=LiteGraph.createNode(this.type),e=this.serialize();if(LiteGraph.use_uuids){const t=LiteGraph.cloneObject(e.subgraph);this.reassignSubgraphUUIDs(t),e.subgraph=t}return delete e.id,delete e.inputs,delete e.outputs,t.configure(e),t}buildFromNodes(t){for(var e={},i=0,r=0;r<t.length;++r){e[(n=t[r]).id]=n,i=Math.min(n.pos[0],i),Math.max(n.pos[0],i)}for(r=0;r<t.length;++r){var n;if((n=t[r]).inputs)for(var s=0;s<n.inputs.length;++s){var o=n.inputs[s];if(o&&o.link)(c=n.graph.links[o.link])&&(e[c.origin_id]||this.subgraph.addInput(o.name,c.type))}if(n.outputs)for(s=0;s<n.outputs.length;++s){var a=n.outputs[s];if(a&&a.links&&a.links.length)for(var l=0;l<a.links.length;++l){var c;if((c=n.graph.links[a.links[l]])&&!e[c.target_id]){0;break}}}}}}Subgraph.title="分支蓝图",Subgraph.input_node_type="middle/graph/input",Subgraph.output_node_type="middle/graph/output",LiteGraph.Subgraph=Subgraph,LiteGraph.registerNodeType("middle/graph/subgraph",Subgraph);class GraphInput extends LGraphNode{title="输入";desc="用于对子蓝图输入参数";constructor(){super(),this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var t=this;this.name_widget=this.addWidget("text","Name",this.properties.name,(function(e){e&&t.setProperty("name",e)})),this.type_widget=this.addWidget("text","Type",this.properties.type,(function(e){t.setProperty("type",e)})),this.value_widget=this.addWidget("number","Value",this.properties.value,(function(e){t.setProperty("value",e)})),this.widgets_up=!0,this.size=[180,90]}onConfigure(){this.updateType()}updateType(){var t=this.properties.type;this.type_widget.value=t,this.outputs[0].type!=t&&(LiteGraph.isValidConnection(this.outputs[0].type,t)||this.disconnectOutput(0),this.outputs[0].type=t),"number"==t?(this.value_widget.type="number",this.value_widget.value=0):"boolean"==t?(this.value_widget.type="toggle",this.value_widget.value=!0):"string"==t?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,t)}onPropertyChanged(t,e){if("name"==t){if(""==e||e==this.name_in_graph||"enabled"==e)return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,e):this.graph.addInput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else"type"==t&&this.updateType()}getTitle(){return this.flags.collapsed?this.properties.name:this.title}onAction(t,e){console.log("graph input 收到了action",t,e),this.properties.type==LiteGraph.EVENT&&this.triggerSlot(0,e)}onExecute(){var t=this.properties.name,e=this.graph.inputs[t];e?this.setOutputData(0,void 0!==e.value?e.value:this.properties.value):this.setOutputData(0,this.properties.value)}onRemoved(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)}}GraphInput.title="输入",LiteGraph.GraphInput=GraphInput,LiteGraph.registerNodeType("middle/graph/input",GraphInput);class GraphOutput extends LGraphNode{title="输出";desc="用于对子蓝图输出参数";constructor(){super(),this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}onPropertyChanged(t,e){if("name"==t){if(""==e||e==this.name_in_graph||"enabled"==e)return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,e):this.graph.addOutput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else"type"==t&&this.updateType()}updateType(){var t=this.properties.type;this.type_widget&&(this.type_widget.value=t),this.inputs[0].type!=t&&("action"!=t&&"event"!=t||(t=LiteGraph.EVENT),LiteGraph.isValidConnection(this.inputs[0].type,t)||this.disconnectInput(0),this.inputs[0].type=t),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,t)}onExecute(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)}onAction(t,e){this.properties.type==LiteGraph.ACTION&&this.graph.trigger(this.properties.name,e)}onRemoved(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)}getTitle(){return this.flags.collapsed?this.properties.name:this.title}}GraphOutput.title="输出",LiteGraph.GraphOutput=GraphOutput,LiteGraph.registerNodeType("middle/graph/output",GraphOutput);class BaseScriptRobot extends LGraphNode{title="自定义脚本基础类";desc="直接挂载游戏中的脚本的指令继承于此";constructor(){super()}getCom(){let t=this.properties.configKey;if(-1!=t.indexOf("cc."))return new(cc[t.split(".")[1]]);let e=cc.js.getClassByName(t);return null==e?(console.warn("找不到脚本组件"+t+"请在App中测试真实运行效果"),null):new e}onStart(){var t=this.getInputNode(0);if(null!=t&&null!=t.codeNode)this.hasRunRobotStart=!0,this.component&&null!=this.component.robotStart&&this.component.robotStart(this);else{let t=null;if(1==this.properties.isSingleClass)t=this.getCom();else{let e=this.graph.vars.rootccNode;if(null==e){let t=cc.director.getScene().getChildByName("Canvas");e=t.getChildByName("_componentsNode"),null==e&&(e=new cc.Node,e.name="_componentsNode",e.parent=t)}t=this.getCom(),e.addComponent(t)}if(null==t)return;for(var e in this.properties){var i=null;i="robot"==this.getPropertyInfo(e).type?this.graph.getNodeById(this.properties[e]):this.properties[e],t[e]!=i&&(t[e]=i)}this.component=t,this.component.outputHandle=this.outputHandle,this.component.codeProgress=this.graph,this.component&&null!=this.component.robotStart&&this.component.robotStart(this)}"codeNode"==this.getInputDataType(0)&&null!=this.getInputData(0)&&this.onBindCodeNode(this.getInputData(0))}onBindCodeNode(t){if(null!=cc.js.getClassByName(this.properties.configKey)){var e=t.getComponent(this.properties.configKey);if(null==e&&(e=t.addComponent(this.properties.configKey)),"cc.Mask"==this.properties.configKey)if(0!=this.properties.radius){var i=t.getComponent("RoundRectMask");null==i&&(i=t.addComponent("RoundRectMask")),i._radius=this.properties.radius}else t.removeComponent("RoundRectMask");var r=t=>{var i=null;let r=this.getPropertyInfo(t);"robot"==r.type?i=this.graph.getNodeById(this.properties[t]):"spriteFrame"==r.type?this.codeProgress.codeRobotConfig.loadResHandle(this.properties[t],cc.SpriteFrame,(r=>{i=r,e[t]!=i&&null!=i&&(e[t]=i)})):i=this.properties[t],e[t]!=i&&null!=i&&(e[t]=i)};for(var n in this.properties)r(n);this.component=e,this.component.outputHandle=this.outputHandle.bind(this),this.component.codeProgress=this.graph,1==this.hasRunRobotStart&&null!=this.component.robotStart&&this.component.robotStart(this)}else console.warn("找不到脚本组件"+this.properties.configKey+"请在App中测试真实运行效果")}inputHandle(t){null==this.component?showAlert(this.properties.configKey+"还未初始化就输入了"):null!=this.component.inputHandle&&this.component.inputHandle(t)}outputHandle(t,e){let i=this.findOutputSlot(t);if(-1!=i){this.getOutputInfo(i).type==LiteGraph.EVENT?this.triggerSlot(i,e):this.setOutputData(i,e)}}onPause(){this.component&&null!=this.component.robotPause&&this.component.robotPause()}onResume(){this.component&&null!=this.component.robotResume&&this.component.robotResume()}inRunFreshConfig(t){null!=this.component&&(this.component[t]=this.properties.otherConfig[t],null!=this.component.inRunFreshConfig&&this.component.inRunFreshConfig(t))}onStop(){this.hasRunRobotStart=!1,this.component&&null!=this.component.robotRelease&&this.component.robotRelease()}}class MotionText extends BaseScriptRobot{title="字幕";desc="在绘本中添加字幕";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("物体","codeNode"),this.addInput("启用",LiteGraph.ACTION),this.addInput("隐藏",LiteGraph.ACTION),this.addOutput("onend",LiteGraph.EVENT),this.addProperty("autoRun",!1,"boolean"),this.addWidget("toggle","自动播放",this.properties.autoRun,"autoRun"),this.addProperty("dir",!1,"boolean"),this.addWidget("toggle","文本竖向排列",this.properties.dir,"dir"),this.addProperty("hideBeforRun",!0,"boolean"),this.addWidget("toggle","运行前隐藏",this.properties.hideBeforRun,"hideBeforRun"),this.addProperty("hideAfterRun",!1,"boolean"),this.addWidget("toggle","运行结束隐藏",this.properties.hideAfterRun,"hideAfterRun"),this.addProperty("hideBaseLabel",!1,"boolean"),this.addWidget("toggle","隐藏底层文字",this.properties.hideBaseLabel,"hideBaseLabel"),this.addProperty("position","0,1","string"),this.addWidget("string","分段位置",this.properties.position,"position"),this.addProperty("positionTime","0,2","string"),this.addWidget("string","分段时间",this.properties.positionTime,"positionTime"),this.addProperty("maskColor","#88BF3D","string"),this.addWidget("string","过渡颜色",this.properties.maskColor,"maskColor"),this.addProperty("configKey","MotionText","string")}onConnectInput(t,e,i,r,n){console.log("MotionText onConnectInput",t,e),0==t&&"codeNode"==e&&r.setProperty("anchorX",0)}onAction(t,e){null!=this.component&&(null!=this.component.inputHandle?"启用"==t?this.component.inputHandle({targetSolt:"show"}):"隐藏"==t&&this.component.inputHandle({targetSolt:"hide"}):console.warn("inputHandle == null"))}}MotionText.title="字幕",LiteGraph.registerNodeType("output/customComponent/MotionText",MotionText);class CaiDanComponent extends BaseScriptRobot{title="桃桃彩蛋";desc="在绘本中添加桃桃彩蛋";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,20],this.addInput("物体","codeNode"),this.addOutput("onclick",LiteGraph.EVENT),this.addProperty("caidanYuyin","","string"),this.addWidget("string","彩蛋语音",this.properties.caidanYuyin,"caidanYuyin"),this.addProperty("startSound","","string"),this.addWidget("string","出现语音",this.properties.startSound,"startSound"),this.addProperty("caidanId",0,"number"),this.addWidget("slider","彩蛋Id",this.properties.caidanId,"caidanId",{min:0,max:10,precision:0}),this.addProperty("caidanPosX",0,"number"),this.addWidget("number","桃桃动画位置X",this.properties.caidanPosX,"caidanPosX",{precision:1}),this.addProperty("caidanPosY",0,"number"),this.addWidget("number","桃桃动画位置Y",this.properties.caidanPosY,"caidanPosY",{precision:1}),this.addProperty("playSound",!0,"boolean"),this.addWidget("toggle","播放声音",this.properties.playSound,"playSound"),this.addProperty("configKey","CaiDanComponent","string")}}CaiDanComponent.title="桃桃彩蛋",LiteGraph.registerNodeType("output/customComponent/CaiDanComponent",CaiDanComponent);class CaiDanComponent2 extends BaseScriptRobot{title="收藏品彩蛋";desc="在绘本中添加收藏品彩蛋";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("物体","codeNode"),this.addProperty("caidanId",0,"number"),this.addWidget("slider","彩蛋Id",this.properties.caidanId,"caidanId",{min:0,max:10,precision:0}),this.addProperty("configKey","CaiDanComponent2","string")}}CaiDanComponent2.title="收藏品彩蛋",LiteGraph.registerNodeType("output/customComponent/CaiDanComponent2",CaiDanComponent2);class ChatComponent extends BaseScriptRobot{title="对话提示气泡";desc="在绘本中添加对话提示气泡";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("物体","codeNode"),this.addInput("输入",LiteGraph.ACTION),this.addInput("更新",LiteGraph.ACTION),this.addOutput("点击",LiteGraph.EVENT),this.addProperty("key","","string"),this.addWidget("string","点击标记",this.properties.key,"key"),this.addProperty("configKey","ChatComponent","string"),this.addProperty("dirType","左下","enum"),this.addWidget("combo","气泡箭头方向",this.properties.dirType,{property:"dirType",values:["左下","右下","右上","左上"]})}}ChatComponent.title="对话提示气泡",LiteGraph.registerNodeType("output/customComponent/ChatComponent",ChatComponent);class VoiceCheck extends BaseScriptRobot{title="声音检测";desc="在绘本中添加声音检测";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("开始",LiteGraph.ACTION),this.addInput("停止",LiteGraph.ACTION),this.addOutput("输出",LiteGraph.EVENT),this.addProperty("testStr","","string"),this.addWidget("string","检测的字符",this.properties.testStr,"testStr"),this.addProperty("testStrGroup","","string"),this.addWidget("string","检测的词组（用,分割）",this.properties.testStrGroup,"testStrGroup"),this.addProperty("checkType","左下","enum"),this.addWidget("combo","检测模式",this.properties.checkType,{property:"checkType",values:["跟读","关键字模式"]}),this.addProperty("configKey","VoiceCheck","string"),this.addProperty("isSingleClass",!0,"boolean")}}VoiceCheck.title="声音检测",LiteGraph.registerNodeType("output/customComponent/VoiceCheck",VoiceCheck);class AngleCompoment extends BaseScriptRobot{title="角度定位";desc="在绘本中添加物让其根据输入的角度定位";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("物体","codeNode"),this.addInput("开启监听",LiteGraph.ACTION),this.addInput("重置",LiteGraph.ACTION),this.addOutput("number1","number"),this.addProperty("configKey","AngleCompoment","string")}}AngleCompoment.title="角度定位",LiteGraph.registerNodeType("output/customComponent/AngleCompoment",AngleCompoment);class ScaleObj extends BaseScriptRobot{title="双指缩放";desc="在绘本中添加双指缩放手势";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("物体","codeNode"),this.addInput("启用",LiteGraph.ACTION),this.addInput("关闭",LiteGraph.ACTION),this.addOutput("onScale",LiteGraph.EVENT),this.addProperty("configKey","AngleCompoment","string"),this.addProperty("scaleMin",.5,"number"),this.addWidget("number","最小缩放",this.properties.scaleMin,"scaleMin",{precision:1}),this.addProperty("scaleMax",2,"number"),this.addWidget("number","最大缩放",this.properties.scaleMax,"scaleMax",{precision:1}),this.addProperty("dynimicCenter",!1,"boolean"),this.addWidget("toggle","是否以当前中心缩放",this.properties.dynimicCenter,"dynimicCenter")}}ScaleObj.title="双指缩放",LiteGraph.registerNodeType("output/customComponent/ScaleObj",ScaleObj);class ProgressCompoment extends BaseScriptRobot{title="进度条";desc="发送绘本页面进度事件，关联图片类型的物体使用";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addInput("物体","codeNode"),this.addInput("进度","number"),this.addInput("更新",LiteGraph.ACTION),this.addProperty("configKey","ProgressCompoment","string")}}ProgressCompoment.title="进度条",LiteGraph.registerNodeType("output/customComponent/ProgressCompoment",ProgressCompoment);class ccMask extends BaseScriptRobot{title="蒙版";desc="给节点添加蒙版效果";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("物体","codeNode"),this.addProperty("configKey","cc.Mask","string"),this.addProperty("type",0,"number"),this.addWidget("combo","遮罩类型",this.properties.type,{property:"type",values:{0:"矩形",1:"圆形",2:"图片"}}),this.addProperty("inverted",!1,"boolean"),this.addWidget("toggle","反向遮罩",this.properties.inverted,"inverted"),this.addProperty("alphaThreshold",.5,"number"),this.addWidget("number","透明度阀值",this.properties.alphaThreshold,"alphaThreshold",{precision:2,min:0,max:1}),this.addProperty("segements",50,"number"),this.addWidget("number","椭圆遮罩曲线数",this.properties.segements,"segements",{precision:2,min:1,max:100}),this.addProperty("radius",0,"number"),this.addWidget("number","矩形圆角曲线数",this.properties.radius,"radius",{precision:1,min:0,max:100}),this.addProperty("spriteFrame","","string"),this.addWidget("string","图片路径",this.properties.spriteFrame,"spriteFrame")}updateWidght(){var t=this.properties.type;this.widgets.map((e=>{"矩形圆角曲线数"==e.name?e.disabled=0!=t:"椭圆遮罩曲线数"==e.name&&(e.disabled=1!=t)}))}onWidgetChanged(t){console.log("当前这招类型",this.properties.type),"遮罩类型"==t&&this.updateWidght()}}ccMask.title="蒙版",LiteGraph.registerNodeType("output/customComponent/ccMask",ccMask);class contact extends LGraphNode{title="接触感应器";desc="检测物体相互接触";constructor(){super(),this.size=[250,50],this.addInput("检测目标物体","codeNode"),this.addInput("其它可接触物体","codeNode"),this.getOutputNodes(),this.addOutput("接触数量","number"),this.addOutput("最后接触物体","codeNode"),this.addOutput("接触时",LiteGraph.EVENT),this.addOutput("离开时",LiteGraph.EVENT),this.curContactNum=0,this.bindTrackCodeNode=[]}onGetInputs(){return console.log("我调用了onGetOutputs"),[["其它可接触物体","codeNode"]]}onStart(){this.bindTrackCodeNode=[];let t=[];for(var e=1;e<this.inputs.length;e++)t.push(this.getInputData(e)),null!=this.getInputData(e)&&this.bindTrackCodeNode.push(this.getInputData(e));console.log("当前链接的solts",t),this.onBindCodeNode(this.getInputData(0))}onBindCodeNode(t){console.log("开始监听接触对象",t),null!=this.codeNode&&(this.codeNode.removeRobotListener("contact",this.getIdWithGraph()),this.codeNode.removeRobotListener("uncontact",this.getIdWithGraph())),this.curContactNum=0,this.setOutputData(0,this.curContactNum),this.codeNode=t,null!=t&&(this.codeNode.addRobotListener("contact",this.getIdWithGraph(),(t=>{-1!=this.bindTrackCodeNode.indexOf(t)&&(this.curContactNum+=1,this.setOutputData(0,this.curContactNum),this.setOutputData(1,t),this.triggerSlot(2))})),this.codeNode.addRobotListener("uncontact",this.getIdWithGraph(),(t=>{-1!=this.bindTrackCodeNode.indexOf(t)&&(this.curContactNum-=1,this.setOutputData(0,this.curContactNum),this.setOutputData(1,t),this.curContactNum<=0&&(this.curContactNum=0,this.triggerSlot(3)))})))}onStop(){console.log("移除监听事件",this.codeNode,this.getIdWithGraph()),null!=this.codeNode&&(this.codeNode.removeRobotListener("contact",this.getIdWithGraph()),this.codeNode.removeRobotListener("uncontact",this.getIdWithGraph()))}}contact.title="接触感应器",LiteGraph.registerNodeType("objects/objectSensor/contact",contact);class position extends LGraphNode{title="位置感应器";desc="检测物体位置变化";constructor(){super(),this.size=[250,50],this.mode=LiteGraph.ON_EVENT,this.addInput("目标物体","codeNode"),this.addInput("修改x","number"),this.addInput("修改y","number"),this.addInput("触发",LiteGraph.ACTION),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("变化",LiteGraph.EVENT),this.addProperty("xRange","[-999999, 999999]","text"),this.xRangeWidget=this.addWidget("text","x范围",this.properties.xRange,"xRange"),this.addProperty("yRange","[-999999, 999999]","text"),this.yRangeWidget=this.addWidget("text","y范围",this.properties.yRange,"yRange"),this.addProperty("modal","直接修改","enum",{values:["直接修改","增量修改"]}),this.addWidget("combo","修改方式",this.properties.modal,{property:"modal",values:["直接修改","增量修改"]}),this.addProperty("rangeWithSize",!1,"boolean"),this.addWidget("toggle","范围包含节点尺寸",this.properties.rangeWithSize,"resetWhenToggle")}onPropertyChanged(t,e){if("xRange"==t||"yRange"==t)try{this["_"+t]=JSON.parse(e),this.boxcolor="#AEA"}catch(i){this.boxcolor="red"}}onStart(){this._xRange=JSON.parse(this.properties.xRange),this._yRange=JSON.parse(this.properties.yRange),this.onBindCodeNode(this.getInputData(0))}onBindCodeNode(t){null!=this.codeNode&&(this.codeNode.removeRobotListener("x",this.getIdWithGraph()),this.codeNode.removeRobotListener("y",this.getIdWithGraph())),this.codeNode=t,null!=t&&(this.codeNode.addRobotListener("x",this.getIdWithGraph(),(t=>{this.setOutputData(0,t),this.triggerSlot(2)})),this.codeNode.addRobotListener("y",this.getIdWithGraph(),(t=>{this.setOutputData(1,t),this.triggerSlot(2)})))}onStop(){this.codeNode=null}onAction(){if(null==this.codeNode)return;let t=this.getInputData(1),e=this.getInputData(2),i=this._xRange,r=this._yRange;if(null!=t){if(1==this.properties.rangeWithSize){var n=this.codeNode.anchorX*this.codeNode.width*Math.abs(this.codeNode.scaleX);i=[i[0]+n,i[1]-n],i[1]<i[0]&&(i[1]=i[1]+i[0],i[0]=i[1]-i[0],i[1]=i[1]-i[0])}"增量修改"==this.properties.modal?(this.codeNode.realX+t>=i[1]?t=i[1]-this.codeNode.realX:this.codeNode.realX+t<=i[0]&&(t=i[0]-this.codeNode.realX),this.codeNode.realX=this.codeNode.realX+t):(t>i[1]&&(t=i[1]),t<i[0]&&(t=i[0]),this.codeNode.realX=t)}if(null!=e){if(1==this.properties.rangeWithSize){var s=this.codeNode.anchorY*this.codeNode.height*Math.abs(this.codeNode.scaleY);r=[r[0]+s,r[1]-s],r[1]<r[0]&&(r[1]=r[1]+r[0],r[0]=r[1]-r[0],r[1]=r[1]-r[0])}"增量修改"==this.properties.modal?(this.codeNode.realY+e>=r[1]?e=r[1]-this.codeNode.realY:this.codeNode.realY+e<=r[0]&&(e=r[0]-this.codeNode.realY),this.codeNode.realY=this.codeNode.realY+e):(e>r[1]&&(e=r[1]),e<r[0]&&(e=r[0]),this.codeNode.realY=e)}}}position.title="位置感应器",LiteGraph.registerNodeType("objects/objectSensor/position",position);class publicListen extends LGraphNode{title="属性感应器";desc="检测物体各种属性变化";constructor(){super(),this.mode=LiteGraph.ON_EVENT,this.addInput("目标物体","codeNode"),this.addInput("修改值","number"),this.addInput("触发",LiteGraph.ACTION),this.addOutput("数值","number"),this.addOutput("变化",LiteGraph.EVENT),this.addProperty("range","[-999999, 999999]","text"),this.rangeWidget=this.addWidget("text","范围",this.properties.range,"range"),this.addProperty("customKey","透明度","enum",{values:publicListen.selectEnums}),this.addWidget("combo","监听信息",this.properties.customKey,{property:"customKey",values:publicListen.selectEnums}),this.addProperty("modal","直接修改","enum",{values:["直接修改","增量修改"]}),this.addWidget("combo","修改方式",this.properties.modal,{property:"modal",values:["直接修改","增量修改"]})}onPropertyChanged(t,e){if("range"==t)try{this["_"+t]=JSON.parse(e),this.boxcolor="#AEA"}catch(i){this.boxcolor="red"}}onStart(){this._range=JSON.parse(this.properties.range),this.onBindCodeNode(this.getInputData(0))}onBindCodeNode(t){let e=publicListen.selectEnums.indexOf(this.properties.customKey);if(-1==e)return void console.warn("没有对应的可监听事件",this.properties.customKey);let i=publicListen.chooseKey[e];null!=this.codeNode&&this.codeNode.removeRobotListener(i,this.getIdWithGraph()),this.codeNode=t,null!=t&&this.codeNode.addRobotListener(i,this.getIdWithGraph(),(t=>{this.setOutputData(0,t),this.triggerSlot(1)}))}onStop(){this.codeNode=null}onAction(){if(null==this.codeNode)return;let t=this.getInputData(1),e=publicListen.selectEnums.indexOf(this.properties.customKey);if(-1==e)return void console.warn("没有对应的可监听事件",this.properties.customKey);let i=publicListen.chooseKey[e];if(null!=i){var r=this._range;"增量修改"==this.properties.modal?(this.codeNode[i]+t>=r[1]&&(t=r[1]-this.codeNode[i]),this.codeNode[i]+t<=r[0]&&(t=r[0]-this.codeNode[i]),this.codeNode[i]=this.codeNode[i]+t):(t>r[1]&&(t=r[1]),t<r[0]&&(t=r[0]),this.codeNode[i]=t)}else this.codeNode[i]=t}}publicListen.title="属性感应器",publicListen.selectEnums=["透明度","层级","缩放X","缩放Y","长度","高度","显隐","角度"],publicListen.chooseKey=["opacity","zIndex","scaleX","scaleY","width","height","active","angle"],LiteGraph.registerNodeType("objects/objectSensor/publicListen",publicListen);class dragNumGame extends BaseYWNode{title="value";desc="这是一个拖拽数数游戏的模型";name="拖拽数数游戏控制器";constructor(){super(),this.addInput("物体","codeNode"),this.addOutput("播放问题",LiteGraph.EVENT),this.addOutput("当前正确数量","number"),this.addOutput("输出正确反馈",LiteGraph.EVENT),this.addOutput("输出错误反馈",LiteGraph.EVENT),this.addOutput("输出结束反馈",LiteGraph.EVENT),this.addProperty("rightCount",5),this.widget=this.addWidget("number","正确选项数量",5,"rightCount",{precision:0,step2:1})}onStart(){this.trigger("播放问题"),this.curRightCount=0}onAction(t){"right"==t?(this.curRightCount+=1,this.setOutputData(1,this.curRightCount),this.trigger("输出正确反馈"),this.curRightCount==this.properties.rightCount&&this.trigger("输出结束反馈")):"error"==t&&this.trigger("输出错误反馈")}}dragNumGame.title="拖拽数数游戏控制器",dragNumGame.nodeType="output/tatagame/dragGame/dragGameControl",LiteGraph.registerNodeType(dragNumGame.nodeType,dragNumGame);class dragNumObj extends BaseYWNode{title="value";desc="这是一个拖拽数数游戏的选项，关联到选项上";name="拖拽数数游戏选项";constructor(){super(),this.addInput("物体","codeNode"),this.addProperty("isRight",!0),this.widget=this.addWidget("toggle","是否为正确选项",!0,"isRight"),this.widgets_up=!0}onExecute(){}onStart(){super.onStart();let t=this.getInputData(0);if(this.touchIds={},null!=t){null==this.startPos&&(this.startPos=cc.v2(t.x,t.y),this.startZIndex=t.zIndex);var e=null,i=5,r=null;t.targetOff(this),t.on(cc.Node.EventType.TOUCH_START,(i=>{if(1!=this.inAni){e=null,r=i.getID();var n=i.getID();this.touchIds[n]=1,t.zIndex=1999}}),this),t.on(cc.Node.EventType.TOUCH_MOVE,(n=>{if(!(Object.keys(this.touchIds).length>1)&&r==n.getID()&&1!=this.graph.config.pause&&1!=this.inAni)if(null!=this.instance&&i<5)i+=1;else if(i=0,null!=e){var s=t.parent.convertToNodeSpaceAR(n.getLocation()),o=s.sub(e);t.x+=o.x,t.y+=o.y,e=s}else e=t.parent.convertToNodeSpaceAR(n.getLocation())}),this),t.on(cc.Node.EventType.TOUCH_END,(e=>{if(1!=this.inAni){var i=e.getID();delete this.touchIds[i],this.checkIsInTarget(t,e)}}),this),t.on(cc.Node.EventType.TOUCH_CANCEL,(e=>{if(1!=this.inAni){var i=e.getID();delete this.touchIds[i],this.checkIsInTarget(t,e)}}),this)}}checkIsInTarget(t,e){let i=!1,r=this.graph.findNodesByType(dragNumGame.nodeType)[0];if(null==r)return;let n=r.getInputData(0,!0);if(null!=n){var s=n.getComponent(cc.PolygonCollider);if(null!=s){var o=n.node.convertToNodeSpaceAR(e.getLocation());i=cc.Intersection.pointInPolygon(o,s.points),console.log("判断是否处于碰撞框内",i)}else console.warn("目标对象没有添加碰撞框"),null!=window.antAleart&&window.antAleart("目标对象没有添加碰撞框")}0==i?(this.inAni=!0,cc.tween(t).to(.5,{x:this.startPos.x,y:this.startPos.y}).call((()=>{t.zIndex=this.startZIndex,this.inAni=!1})).start()):1==this.properties.isRight?(r.onAction("right"),t.targetOff(this),cc.tween(t).to(.5,{opacity:0}).start()):(r.onAction("error"),this.inAni=!0,cc.tween(t).to(.5,{x:this.startPos.x,y:this.startPos.y}).call((()=>{t.zIndex=this.startZIndex,this.inAni=!1})).start())}}dragNumObj.title="拖拽数数游戏选项",dragNumObj.nodeType="output/tatagame/dragGame/dragNumObj",LiteGraph.registerNodeType(dragNumObj.nodeType,dragNumObj),console.log("定义了nodetypes");var sparkMd5={exports:{}},hasRequiredSparkMd5;function requireSparkMd5(){return hasRequiredSparkMd5||(hasRequiredSparkMd5=1,function(t){t.exports=function(t){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(t,e){var i=t[0],r=t[1],n=t[2],s=t[3];r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&n|~r&s)+e[0]-680876936|0)<<7|i>>>25)+r|0)&r|~i&n)+e[1]-389564586|0)<<12|s>>>20)+i|0)&i|~s&r)+e[2]+606105819|0)<<17|n>>>15)+s|0)&s|~n&i)+e[3]-1044525330|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&n|~r&s)+e[4]-176418897|0)<<7|i>>>25)+r|0)&r|~i&n)+e[5]+1200080426|0)<<12|s>>>20)+i|0)&i|~s&r)+e[6]-1473231341|0)<<17|n>>>15)+s|0)&s|~n&i)+e[7]-45705983|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&n|~r&s)+e[8]+1770035416|0)<<7|i>>>25)+r|0)&r|~i&n)+e[9]-1958414417|0)<<12|s>>>20)+i|0)&i|~s&r)+e[10]-42063|0)<<17|n>>>15)+s|0)&s|~n&i)+e[11]-1990404162|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&n|~r&s)+e[12]+1804603682|0)<<7|i>>>25)+r|0)&r|~i&n)+e[13]-40341101|0)<<12|s>>>20)+i|0)&i|~s&r)+e[14]-1502002290|0)<<17|n>>>15)+s|0)&s|~n&i)+e[15]+1236535329|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&s|n&~s)+e[1]-165796510|0)<<5|i>>>27)+r|0)&n|r&~n)+e[6]-1069501632|0)<<9|s>>>23)+i|0)&r|i&~r)+e[11]+643717713|0)<<14|n>>>18)+s|0)&i|s&~i)+e[0]-373897302|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&s|n&~s)+e[5]-701558691|0)<<5|i>>>27)+r|0)&n|r&~n)+e[10]+38016083|0)<<9|s>>>23)+i|0)&r|i&~r)+e[15]-660478335|0)<<14|n>>>18)+s|0)&i|s&~i)+e[4]-405537848|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&s|n&~s)+e[9]+568446438|0)<<5|i>>>27)+r|0)&n|r&~n)+e[14]-1019803690|0)<<9|s>>>23)+i|0)&r|i&~r)+e[3]-187363961|0)<<14|n>>>18)+s|0)&i|s&~i)+e[8]+1163531501|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r&s|n&~s)+e[13]-1444681467|0)<<5|i>>>27)+r|0)&n|r&~n)+e[2]-51403784|0)<<9|s>>>23)+i|0)&r|i&~r)+e[7]+1735328473|0)<<14|n>>>18)+s|0)&i|s&~i)+e[12]-1926607734|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r^n^s)+e[5]-378558|0)<<4|i>>>28)+r|0)^r^n)+e[8]-2022574463|0)<<11|s>>>21)+i|0)^i^r)+e[11]+1839030562|0)<<16|n>>>16)+s|0)^s^i)+e[14]-35309556|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r^n^s)+e[1]-1530992060|0)<<4|i>>>28)+r|0)^r^n)+e[4]+1272893353|0)<<11|s>>>21)+i|0)^i^r)+e[7]-155497632|0)<<16|n>>>16)+s|0)^s^i)+e[10]-1094730640|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r^n^s)+e[13]+681279174|0)<<4|i>>>28)+r|0)^r^n)+e[0]-358537222|0)<<11|s>>>21)+i|0)^i^r)+e[3]-722521979|0)<<16|n>>>16)+s|0)^s^i)+e[6]+76029189|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((i=((i+=(r^n^s)+e[9]-640364487|0)<<4|i>>>28)+r|0)^r^n)+e[12]-421815835|0)<<11|s>>>21)+i|0)^i^r)+e[15]+530742520|0)<<16|n>>>16)+s|0)^s^i)+e[2]-995338651|0)<<23|r>>>9)+n|0,r=((r+=((s=((s+=(r^((i=((i+=(n^(r|~s))+e[0]-198630844|0)<<6|i>>>26)+r|0)|~n))+e[7]+1126891415|0)<<10|s>>>22)+i|0)^((n=((n+=(i^(s|~r))+e[14]-1416354905|0)<<15|n>>>17)+s|0)|~i))+e[5]-57434055|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((i=((i+=(n^(r|~s))+e[12]+1700485571|0)<<6|i>>>26)+r|0)|~n))+e[3]-1894986606|0)<<10|s>>>22)+i|0)^((n=((n+=(i^(s|~r))+e[10]-1051523|0)<<15|n>>>17)+s|0)|~i))+e[1]-2054922799|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((i=((i+=(n^(r|~s))+e[8]+1873313359|0)<<6|i>>>26)+r|0)|~n))+e[15]-30611744|0)<<10|s>>>22)+i|0)^((n=((n+=(i^(s|~r))+e[6]-1560198380|0)<<15|n>>>17)+s|0)|~i))+e[13]+1309151649|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((i=((i+=(n^(r|~s))+e[4]-145523070|0)<<6|i>>>26)+r|0)|~n))+e[11]-1120210379|0)<<10|s>>>22)+i|0)^((n=((n+=(i^(s|~r))+e[2]+718787259|0)<<15|n>>>17)+s|0)|~i))+e[9]-343485551|0)<<21|r>>>11)+n|0,t[0]=i+t[0]|0,t[1]=r+t[1]|0,t[2]=n+t[2]|0,t[3]=s+t[3]|0}function r(t){var e,i=[];for(e=0;e<64;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}function n(t){var e,i=[];for(e=0;e<64;e+=4)i[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return i}function s(t){var e,n,s,o,a,l,c=t.length,h=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)i(h,r(t.substring(e-64,e)));for(n=(t=t.substring(e-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(i(h,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,i(h,s),h}function o(t){var e,r,s,o,a,l,c=t.length,h=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)i(h,n(t.subarray(e-64,e)));for(r=(t=e-64<c?t.subarray(e-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<r;e+=1)s[e>>2]|=t[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(i(h,s),e=0;e<16;e+=1)s[e]=0;return o=(o=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,i(h,s),h}function a(t){var i,r="";for(i=0;i<4;i+=1)r+=e[t>>8*i+4&15]+e[t>>8*i&15];return r}function l(t){var e;for(e=0;e<t.length;e+=1)t[e]=a(t[e]);return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function h(t,e){var i,r=t.length,n=new ArrayBuffer(r),s=new Uint8Array(n);for(i=0;i<r;i+=1)s[i]=t.charCodeAt(i);return e?s:n}function u(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function d(t,e,i){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t)),r.set(new Uint8Array(e),t.byteLength),r}function p(t){var e,i=[],r=t.length;for(e=0;e<r-1;e+=2)i.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,i)}function f(){this.reset()}return l(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(i,r){var n,s,o,a,l=this.byteLength,c=e(i,l),h=l;return r!==t&&(h=e(r,l)),c>h?new ArrayBuffer(0):(n=h-c,s=new ArrayBuffer(n),o=new Uint8Array(s),a=new Uint8Array(this,c,n),o.set(a),s)}}(),f.prototype.append=function(t){return this.appendBinary(c(t)),this},f.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,n=this._buff.length;for(e=64;e<=n;e+=64)i(this._hash,r(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},f.prototype.end=function(t){var e,i,r=this._buff,n=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n;e+=1)s[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(s,n),i=l(this._hash),t&&(i=p(i)),this.reset(),i},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},f.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(t,e){var r,n,s,o=e;if(t[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,t),o=0;o<16;o+=1)t[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),s=parseInt(r[1],16)||0,t[14]=n,t[15]=s,i(this._hash,t)},f.hash=function(t,e){return f.hashBinary(c(t),e)},f.hashBinary=function(t,e){var i=l(s(t));return e?p(i):i},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(t){var e,r=d(this._buff.buffer,t),s=r.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)i(this._hash,n(r.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(r.buffer.slice(e-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(t){var e,i,r=this._buff,n=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<n;e+=1)s[e>>2]|=r[e]<<(e%4<<3);return this._finish(s,n),i=l(this._hash),t&&(i=p(i)),this.reset(),i},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var t=f.prototype.getState.call(this);return t.buff=u(t.buff),t},f.ArrayBuffer.prototype.setState=function(t){return t.buff=h(t.buff,!0),f.prototype.setState.call(this,t)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(t,e){var i=l(o(new Uint8Array(t)));return e?p(i):i},f}()}(sparkMd5)),sparkMd5.exports}var sparkMd5Exports=requireSparkMd5();const SparkMD5=getDefaultExportFromCjs(sparkMd5Exports);var aliyunOssSdk$1={exports:{}},hasRequiredAliyunOssSdk;function requireAliyunOssSdk(){return hasRequiredAliyunOssSdk||(hasRequiredAliyunOssSdk=1,function(t){!function(i){t.exports=function(){function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof commonjsRequire&&commonjsRequire;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[o]={exports:{}};e[o][0].call(h.exports,(function(t){return n(e[o][1][t]||t)}),h,h.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof commonjsRequire&&commonjsRequire,o=0;o<r.length;o++)n(r[o]);return n}return t}()({1:[function(t,e,i){var r=t("./browser/client");r.Buffer=t("buffer").Buffer,r.urllib=t("../shims/xhr"),r.version=t("./browser/version").version,e.exports=r},{"../shims/xhr":546,"./browser/client":3,"./browser/version":6,buffer:103}],2:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator"));t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.slice.js");var o=t("assert"),a=t("../common/utils/checkBucketName").checkBucketName,l=i;function c(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function h(t){return t?c(t)?t:[t]:[]}l.useBucket=function(t){return a(t),this.options.bucket=t,this},l.setBucket=function(t){return a(t),this.options.bucket=t,this},l.getBucket=function(){return this.options.bucket},l.deleteBucket=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._bucketRequestParams("DELETE",e,"",i),t.next=3,this.request(r);case 3:if(200!==(s=t.sent).status&&204!==s.status){t.next=6;break}return t.abrupt("return",{res:s.res});case 6:return t.next=8,this.requestError(s);case 8:throw t.sent;case 9:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.putBucketACL=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(s=this._bucketRequestParams("PUT",e,"acl",r)).headers={"x-oss-acl":i},s.successStatuses=[200],t.next=5,this.request(s);case 5:return o=t.sent,t.abrupt("return",{bucket:o.headers.location&&o.headers.location.substring(1)||null,res:o.res});case 7:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),l.getBucketACL=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("GET",e,"acl",i)).successStatuses=[200],r.xmlResponse=!0,t.next=5,this.request(r);case 5:return s=t.sent,t.abrupt("return",{acl:s.data.AccessControlList.Grant,owner:{id:s.data.Owner.ID,displayName:s.data.Owner.DisplayName},res:s.res});case 7:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.putBucketLogging=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=this._bucketRequestParams("PUT",e,"logging",r),o='<?xml version="1.0" encoding="UTF-8"?>\n<BucketLoggingStatus>\n<LoggingEnabled>\n<TargetBucket>'.concat(e,"</TargetBucket>\n"),i&&(o+="<TargetPrefix>".concat(i,"</TargetPrefix>\n")),o+="</LoggingEnabled>\n</BucketLoggingStatus>",s.content=o,s.mime="xml",s.successStatuses=[200],t.next=9,this.request(s);case 9:return a=t.sent,t.abrupt("return",{res:a.res});case 11:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),l.getBucketLogging=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("GET",e,"logging",i)).successStatuses=[200],r.xmlResponse=!0,t.next=5,this.request(r);case 5:return s=t.sent,o=s.data.LoggingEnabled,t.abrupt("return",{enable:!!o,prefix:o&&o.TargetPrefix||null,res:s.res});case 8:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.deleteBucketLogging=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("DELETE",e,"logging",i)).successStatuses=[204,200],t.next=4,this.request(r);case 4:return s=t.sent,t.abrupt("return",{res:s.res});case 6:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.putBucketCORS=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,a,l,c,u,d,p,f,_,m;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o((i=i||[]).length,"rules is required"),i.forEach((function(t){o(t.allowedOrigin,"allowedOrigin is required"),o(t.allowedMethod,"allowedMethod is required")})),s=this._bucketRequestParams("PUT",e,"cors",r),a='<?xml version="1.0" encoding="UTF-8"?>\n<CORSConfiguration>',l=function(t){a+="<AllowedOrigin>".concat(t,"</AllowedOrigin>")},c=function(t){a+="<AllowedMethod>".concat(t,"</AllowedMethod>")},u=function(t){a+="<AllowedHeader>".concat(t,"</AllowedHeader>")},d=function(t){a+="<ExposeHeader>".concat(t,"</ExposeHeader>")},p=0,f=i.length;p<f;p++)_=i[p],a+="<CORSRule>",h(_.allowedOrigin).forEach(l),h(_.allowedMethod).forEach(c),h(_.allowedHeader).forEach(u),h(_.exposeHeader).forEach(d),_.maxAgeSeconds&&(a+="<MaxAgeSeconds>".concat(_.maxAgeSeconds,"</MaxAgeSeconds>")),a+="</CORSRule>";return a+="</CORSConfiguration>",s.content=a,s.mime="xml",s.successStatuses=[200],t.next=16,this.request(s);case 16:return m=t.sent,t.abrupt("return",{res:m.res});case 18:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),l.getBucketCORS=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("GET",e,"cors",i)).successStatuses=[200],r.xmlResponse=!0,t.next=5,this.request(r);case 5:return s=t.sent,o=[],s.data&&s.data.CORSRule&&(c(a=s.data.CORSRule)||(a=[a]),a.forEach((function(t){var e={};Object.keys(t).forEach((function(i){e[i.slice(0,1).toLowerCase()+i.slice(1,i.length)]=t[i]})),o.push(e)}))),t.abrupt("return",{rules:o,res:s.res});case 9:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.deleteBucketCORS=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("DELETE",e,"cors",i)).successStatuses=[204],t.next=4,this.request(r);case 4:return s=t.sent,t.abrupt("return",{res:s.res});case 6:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.putBucketReferer=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s){var o,a,l,c;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this._bucketRequestParams("PUT",e,"referer",s),a='<?xml version="1.0" encoding="UTF-8"?>\n<RefererConfiguration>\n',a+="  <AllowEmptyReferer>".concat(i?"true":"false","</AllowEmptyReferer>\n"),r&&r.length>0){for(a+="  <RefererList>\n",l=0;l<r.length;l++)a+="    <Referer>".concat(r[l],"</Referer>\n");a+="  </RefererList>\n"}else a+="  <RefererList />\n";return a+="</RefererConfiguration>",o.content=a,o.mime="xml",o.successStatuses=[200],t.next=10,this.request(o);case 10:return c=t.sent,t.abrupt("return",{res:c.res});case 12:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n){return t.apply(this,arguments)}return e}(),l.getBucketReferer=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._bucketRequestParams("GET",e,"referer",i)).successStatuses=[200],r.xmlResponse=!0,t.next=5,this.request(r);case 5:return s=t.sent,(o=s.data.RefererList.Referer||null)&&(c(o)||(o=[o])),t.abrupt("return",{allowEmpty:"true"===s.data.AllowEmptyReferer,referers:o,res:s.res});case 9:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l.deleteBucketReferer=function(){var t=(0,s.default)(n.default.mark((function t(e,i){return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.putBucketReferer(e,!0,null,i);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l._bucketRequestParams=function(t,e,i,r){return{method:t,bucket:e,subres:i,additionalHeaders:r&&r.additionalHeaders,timeout:r&&r.timeout,ctx:r&&r.ctx}}},{"../common/utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,assert:95,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/web.dom-collections.for-each.js":380}],3:[function(t,e,i){(function(i,r){(function(){var n=t("@babel/runtime/helpers/interopRequireDefault"),s=n(t("@babel/runtime/regenerator")),o=n(t("@babel/runtime/helpers/asyncToGenerator"));t("core-js/modules/es.function.name.js"),t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.symbol.js"),t("core-js/modules/es.symbol.description.js"),t("core-js/modules/es.array.slice.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.regexp.to-string.js");var a=t("debug")("ali-oss"),l=t("xml2js"),c=t("agentkeepalive"),h=t("merge-descriptors"),u=t("platform"),d=t("utility"),p=t("urllib"),f=t("./version"),_=t("bowser"),m=t("../common/signUtils"),g=t("../common/client/initOptions"),y=t("../common/utils/createRequest").createRequest,v=t("../common/utils/encoder").encoder,b=t("../common/client/getReqUrl").getReqUrl,x=t("../common/utils/setSTSToken").setSTSToken,T=t("../common/utils/retry").retry,C=t("../common/utils/isFunction").isFunction,S=t("../common/utils/getStandardRegion").getStandardRegion,w=new c;function A(){var t=u.name,e=u.version;t&&t.toLowerCase&&"ie"===t.toLowerCase()&&e.split(".")[0]<10&&console.warn("ali-oss does not support the current browser")}function E(){return location&&"https:"===location.protocol}function D(t,e){if(A(),!(this instanceof D))return new D(t,e);t&&t.inited?this.options=t:this.options=D.initOptions(t),this.options.cancelFlag=!1,this.options.urllib?this.urllib=this.options.urllib:(this.urllib=p,this.agent=this.options.agent||w),this.ctx=e,this.userAgent=this._getUserAgent(),this.stsTokenFreshTime=new Date,this.options.amendTimeSkewed=0}e.exports=D,D.initOptions=function(t){t.stsToken||console.warn("Please use STS Token for safety, see more details at https://help.aliyun.com/document_detail/32077.html");var e=Object.assign({secure:E(),useFetch:!1},t);return g(e)};var L=D.prototype;function I(t){return P.apply(this,arguments)}function P(){return(P=(0,o.default)(s.default.mark((function t(e){var i,r,n,o,a,l;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.options.stsToken||!C(this.options.refreshSTSToken)){t.next=3;break}return t.next=3,x.call(this);case 3:return i=y.call(this,e),this.options.useFetch||(i.params.mode="disable-fetch"),o=!!e.stream,t.prev=6,t.next=9,this.urllib.request(i.url,i.params);case 9:r=t.sent,this.debug("response %s %s, got %s, headers: %j",e.method,i.url,r.status,r.headers,"info"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),n=t.t0;case 16:if(!r||!e.successStatuses||-1!==e.successStatuses.indexOf(r.status)){t.next=28;break}return t.next=19,this.requestError(r);case 19:if("RequestTimeTooSkewed"!==(a=t.sent).code||o){t.next=25;break}return this.options.amendTimeSkewed=+new Date(a.serverTime)-new Date,t.next=24,this.request(e);case 24:return t.abrupt("return",t.sent);case 25:a.params=e,t.next=32;break;case 28:if(!n){t.next=32;break}return t.next=31,this.requestError(n);case 31:a=t.sent;case 32:if(!a){t.next=34;break}throw a;case 34:if(!e.xmlResponse){t.next=39;break}return t.next=37,this.parseXML(r.data);case 37:l=t.sent,r.data=l;case 39:return t.abrupt("return",r);case 40:case"end":return t.stop()}}),t,this,[[6,13]])})))).apply(this,arguments)}L.debug=a,h(L,t("./object")),h(L,t("./bucket")),h(L,t("../common/bucket/getBucketWebsite")),h(L,t("../common/bucket/putBucketWebsite")),h(L,t("../common/bucket/deleteBucketWebsite")),h(L,t("../common/bucket/getBucketLifecycle")),h(L,t("../common/bucket/putBucketLifecycle")),h(L,t("../common/bucket/deleteBucketLifecycle")),h(L,t("../common/bucket/putBucketVersioning")),h(L,t("../common/bucket/getBucketVersioning")),h(L,t("../common/bucket/getBucketInventory")),h(L,t("../common/bucket/deleteBucketInventory")),h(L,t("../common/bucket/listBucketInventory")),h(L,t("../common/bucket/putBucketInventory")),h(L,t("../common/bucket/abortBucketWorm")),h(L,t("../common/bucket/completeBucketWorm")),h(L,t("../common/bucket/extendBucketWorm")),h(L,t("../common/bucket/getBucketWorm")),h(L,t("../common/bucket/initiateBucketWorm")),h(L,t("./managed-upload")),h(L,t("../common/multipart-copy")),h(L,t("../common/multipart")),h(L,t("../common/parallel")),L.signature=function(t){return this.debug("authorization stringToSign: %s",t,"info"),m.computeSignature(this.options.accessKeySecret,t,this.options.headerEncoding)},L._getReqUrl=b,L.authorization=function(t,e,i,r){var n=m.buildCanonicalString(t.toUpperCase(),e,{headers:r,parameters:i});return m.authorization(this.options.accessKeyId,this.options.accessKeySecret,n,this.options.headerEncoding)},L.authorizationV4=function(t,e,i,r,n){return m.authorizationV4(this.options.accessKeyId,this.options.accessKeySecret,S(this.options.region),t,e,i,r,n,this.options.headerEncoding)},L.request=function(){var t=(0,o.default)(s.default.mark((function t(e){var i=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.options.retryMax){t.next=6;break}return t.next=3,T(I.bind(this),this.options.retryMax,{errorHandler:function(t){return!!function(t){if(e.stream)return!1;var r=[-1,-2].includes(t.status),n=i.options.requestErrorRetryHandle||function(){return!0};return r&&n(t)}(t)}})(e);case 3:return t.abrupt("return",t.sent);case 6:return t.abrupt("return",I.call(this,e));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),L._getResource=function(t){var e="/";return t.bucket&&(e+="".concat(t.bucket,"/")),t.object&&(e+=v(t.object,this.options.headerEncoding)),e},L._escape=function(t){return d.encodeURIComponent(t).replace(/%2F/g,"/")},L._getUserAgent=function(){var t=r&&r.browser?"js":"nodejs",e="aliyun-sdk-".concat(t,"/").concat(f.version),i=u.description;return!i&&r&&(i="Node.js ".concat(r.version.slice(1)," on ").concat(r.platform," ").concat(r.arch)),this._checkUserAgent("".concat(e," ").concat(i))},L._checkUserAgent=function(t){return t.replace(/\u03b1/,"alpha").replace(/\u03b2/,"beta")},L.checkBrowserAndVersion=function(t,e){return _.name===t&&_.version.split(".")[0]===e},L.parseXML=function(t){return new Promise((function(e,r){i.isBuffer(t)&&(t=t.toString()),l.parseString(t,{explicitRoot:!1,explicitArray:!1},(function(t,i){t?r(t):e(i)}))}))},L.requestError=function(){var t=(0,o.default)(s.default.mark((function t(e){var i,r,n,a,l,c=this;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null,r=function(){var t=(0,o.default)(s.default.mark((function t(r){var n,o;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.parseXML(r);case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0={};case 6:n=t.t0,t.next=16;break;case 9:return t.prev=9,t.t1=t.catch(0),c.debug(r,"error"),t.t1.message+="\nraw xml: ".concat(r),t.t1.status=e.status,t.t1.requestId=e.headers&&e.headers["x-oss-request-id"],t.abrupt("return",t.t1);case 16:return o=n.Message||"unknow request error, status: ".concat(e.status),n.Condition&&(o+=" (condition: ".concat(n.Condition,")")),(i=new Error(o)).name=n.Code?"".concat(n.Code,"Error"):"UnknownError",i.status=e.status,i.code=n.Code,i.ecCode=n.EC,i.requestId=n.RequestId,i.hostId=n.HostId,i.serverTime=n.ServerTime,t.abrupt("return",i);case 27:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}(),e.data&&e.data.length){t.next=38;break}if(-1!==e.status&&-2!==e.status){t.next=10;break}(i=new Error(e.message)).name=e.name,i.status=e.status,i.code=e.name,t.next=36;break;case 10:if(404!==e.status){t.next=17;break}(i=new Error("Object not exists")).name="NoSuchKeyError",i.status=404,i.code="NoSuchKey",t.next=34;break;case 17:if(412!==e.status){t.next=24;break}(i=new Error("Pre condition failed")).name="PreconditionFailedError",i.status=412,i.code="PreconditionFailed",t.next=34;break;case 24:if((i=new Error("Unknow error, status: ".concat(e.status))).name="UnknownError",i.status=e.status,i.res=e,!(n=e.headers&&e.headers["x-oss-err"])){t.next=34;break}return a=atob(n),t.next=33,r(a);case 33:i=t.sent;case 34:i.requestId=e.headers&&e.headers["x-oss-request-id"],i.host="";case 36:t.next=43;break;case 38:return l=String(e.data),this.debug("request response error data: %s",l,"error"),t.next=42,r(l);case 42:i=t.sent;case 43:return this.debug("generate error %j",i,"error"),t.abrupt("return",i);case 45:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}).call(this)}).call(this,{isBuffer:t("../../node_modules/is-buffer/index.js")},t("_process"))},{"../../node_modules/is-buffer/index.js":409,"../common/bucket/abortBucketWorm":7,"../common/bucket/completeBucketWorm":8,"../common/bucket/deleteBucketInventory":9,"../common/bucket/deleteBucketLifecycle":10,"../common/bucket/deleteBucketWebsite":11,"../common/bucket/extendBucketWorm":12,"../common/bucket/getBucketInventory":13,"../common/bucket/getBucketLifecycle":14,"../common/bucket/getBucketVersioning":15,"../common/bucket/getBucketWebsite":16,"../common/bucket/getBucketWorm":17,"../common/bucket/initiateBucketWorm":18,"../common/bucket/listBucketInventory":19,"../common/bucket/putBucketInventory":20,"../common/bucket/putBucketLifecycle":21,"../common/bucket/putBucketVersioning":22,"../common/bucket/putBucketWebsite":23,"../common/client/getReqUrl":25,"../common/client/initOptions":26,"../common/multipart":30,"../common/multipart-copy":29,"../common/parallel":51,"../common/signUtils":52,"../common/utils/createRequest":58,"../common/utils/encoder":62,"../common/utils/getStandardRegion":65,"../common/utils/isFunction":72,"../common/utils/retry":80,"../common/utils/setSTSToken":82,"./bucket":2,"./managed-upload":4,"./object":5,"./version":6,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,_process:538,agentkeepalive:94,bowser:101,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.replace.js":345,"core-js/modules/es.symbol.description.js":351,"core-js/modules/es.symbol.js":354,debug:536,"merge-descriptors":428,platform:440,urllib:546,utility:545,xml2js:496}],4:[function(t,e,i){(function(e){(function(){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.function.name.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.array.from.js"),t("core-js/modules/es.string.iterator.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.array.filter.js"),t("core-js/modules/es.array.find.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/es.array.slice.js"),t("core-js/modules/es.array.iterator.js"),t("core-js/modules/es.array-buffer.slice.js"),t("core-js/modules/es.typed-array.uint8-array.js"),t("core-js/modules/es.typed-array.copy-within.js"),t("core-js/modules/es.typed-array.every.js"),t("core-js/modules/es.typed-array.fill.js"),t("core-js/modules/es.typed-array.filter.js"),t("core-js/modules/es.typed-array.find.js"),t("core-js/modules/es.typed-array.find-index.js"),t("core-js/modules/es.typed-array.for-each.js"),t("core-js/modules/es.typed-array.includes.js"),t("core-js/modules/es.typed-array.index-of.js"),t("core-js/modules/es.typed-array.iterator.js"),t("core-js/modules/es.typed-array.join.js"),t("core-js/modules/es.typed-array.last-index-of.js"),t("core-js/modules/es.typed-array.map.js"),t("core-js/modules/es.typed-array.reduce.js"),t("core-js/modules/es.typed-array.reduce-right.js"),t("core-js/modules/es.typed-array.reverse.js"),t("core-js/modules/es.typed-array.set.js"),t("core-js/modules/es.typed-array.slice.js"),t("core-js/modules/es.typed-array.some.js"),t("core-js/modules/es.typed-array.sort.js"),t("core-js/modules/es.typed-array.subarray.js"),t("core-js/modules/es.typed-array.to-locale-string.js"),t("core-js/modules/es.typed-array.to-string.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("util"),a=t("path"),l=t("mime"),c=t("copy-to"),h=t("../common/utils/isBlob").isBlob,u=t("../common/utils/isFile").isFile,d=t("../common/utils/isBuffer").isBuffer,p=i;p.multipartUpload=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o,c,p,f,_,m,g,y=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=y.length>2&&void 0!==y[2]?y[2]:{},this.resetCancelFlag(),r.disabledMD5=void 0===r.disabledMD5||!!r.disabledMD5,!r.checkpoint||!r.checkpoint.uploadId){t.next=8;break}return i&&u(i)&&(r.checkpoint.file=i),t.next=7,this._resumeMultipart(r.checkpoint,r);case 7:case 41:return t.abrupt("return",t.sent);case 8:return s=102400,r.mime||(u(i)?r.mime=l.getType(a.extname(i.name)):h(i)?r.mime=i.type:d(i)?r.mime="":r.mime=l.getType(a.extname(i))),r.headers=r.headers||{},this._convertMetaToHeaders(r.meta,r.headers),t.next=14,this._getFileSize(i);case 14:if(!((o=t.sent)<s)){t.next=26;break}return r.contentLength=o,t.next=19,this.put(e,i,r);case 19:if(c=t.sent,!r||!r.progress){t.next=23;break}return t.next=23,r.progress(1);case 23:return p={res:c.res,bucket:this.options.bucket,name:e,etag:c.res.headers.etag},(r.headers&&r.headers["x-oss-callback"]||r.callback)&&(p.data=c.data),t.abrupt("return",p);case 26:if(!r.partSize||parseInt(r.partSize,10)===r.partSize){t.next=28;break}throw new Error("partSize must be int number");case 28:if(!(r.partSize&&r.partSize<s)){t.next=30;break}throw new Error("partSize must not be smaller than ".concat(s));case 30:return t.next=32,this.initMultipartUpload(e,r);case 32:if(f=t.sent,_=f.uploadId,m=this._getPartSize(o,r.partSize),g={file:i,name:e,fileSize:o,partSize:m,uploadId:_,doneParts:[]},!r||!r.progress){t.next=39;break}return t.next=39,r.progress(0,g,f.res);case 39:return t.next=41,this._resumeMultipart(g,r);case 42:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),p._resumeMultipart=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,o,a,l,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this,!this.isCancel()){t.next=3;break}throw this._makeCancelEvent();case 3:return o=e.file,a=e.fileSize,l=e.partSize,h=e.uploadId,u=e.doneParts,d=e.name,p=[],u.length>0&&c(u).to(p),f=this._divideParts(a,l),_=f.length,m=!1,g=function(t,r){return new Promise(function(){var a=(0,s.default)(n.default.mark((function s(a,l){var p,g,y,v,b;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,t.isCancel()){n.next=29;break}return p=f[r-1],n.next=5,t._createBuffer(o,p.start,p.end);case 5:return g=n.sent,y={content:g,size:p.end-p.start},n.prev=7,n.next=10,t._uploadPart(d,h,r,y,i);case 10:v=n.sent,n.next=18;break;case 13:if(n.prev=13,n.t0=n.catch(7),404!==n.t0.status){n.next=17;break}throw t._makeAbortEvent();case 17:throw n.t0;case 18:if(t.isCancel()||m){n.next=26;break}if(e.doneParts.push({number:r,etag:v.res.headers.etag}),!i.progress){n.next=23;break}return n.next=23,i.progress(u.length/(_+1),e,v.res);case 23:a({number:r,etag:v.res.headers.etag}),n.next=27;break;case 26:a();case 27:n.next=30;break;case 29:a();case 30:n.next=41;break;case 32:n.prev=32,n.t1=n.catch(0),(b=new Error).name=n.t1.name,b.message=n.t1.message,b.stack=n.t1.stack,b.partNum=r,c(n.t1).to(b),l(b);case 41:case"end":return n.stop()}}),s,null,[[0,32],[7,13]])})));return function(t,e){return a.apply(this,arguments)}}())},y=Array.from(new Array(_),(function(t,e){return e+1})),v=p.map((function(t){return t.number})),b=y.filter((function(t){return v.indexOf(t)<0})),x=5,T=i.parallel||x,t.next=17,this._parallel(b,T,(function(t){return new Promise((function(e,i){g(r,t).then((function(t){t&&p.push(t),e()})).catch((function(t){i(t)}))}))}));case 17:if(C=t.sent,m=!0,!(S=C.find((function(t){return"abort"===t.name})))){t.next=22;break}throw S;case 22:if(!this.isCancel()){t.next=25;break}throw g=null,this._makeCancelEvent();case 25:if(!(C&&C.length>0)){t.next=28;break}throw C[0].message="Failed to upload some parts with error: ".concat(C[0].toString()," part_num: ").concat(C[0].partNum),C[0];case 28:return t.next=30,this.completeMultipartUpload(d,h,p,i);case 30:return t.abrupt("return",t.sent);case 31:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),p._getFileSize=function(){var t=(0,s.default)(n.default.mark((function t(e){return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!d(e)){t.next=4;break}return t.abrupt("return",e.length);case 4:if(!h(e)&&!u(e)){t.next=6;break}return t.abrupt("return",e.size);case 6:throw new Error("_getFileSize requires Buffer/File/Blob.");case 7:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}();var f=t("stream").Readable;function _(t,e){if(!(this instanceof _))return new _(t,e);f.call(this,e),this.file=t,this.reader=new FileReader,this.start=0,this.finish=!1,this.fileBuffer=null}function m(t){return t.arrayBuffer?t.arrayBuffer():new Promise((function(e,i){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){i(t)},r.readAsArrayBuffer(t)}))}o.inherits(_,f),_.prototype.readFileAndPush=function(t){if(this.fileBuffer)for(var e=!0;e&&this.fileBuffer&&this.start<this.fileBuffer.length;){var i=this.start,r=i+t;r=r>this.fileBuffer.length?this.fileBuffer.length:r,this.start=r,e=this.push(this.fileBuffer.slice(i,r))}},_.prototype._read=function(t){if(this.file&&this.start>=this.file.size||this.fileBuffer&&this.start>=this.fileBuffer.length||this.finish||0===this.start&&!this.file)return this.finish||(this.fileBuffer=null,this.finish=!0),void this.push(null);t=t||16384;var i=this;this.reader.onload=function(r){i.fileBuffer=e.from(new Uint8Array(r.target.result)),i.file=null,i.readFileAndPush(t)},0===this.start?this.reader.readAsArrayBuffer(this.file):this.readFileAndPush(t)},p._createBuffer=function(){var t=(0,s.default)(n.default.mark((function t(i,r,s){var o,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!h(i)&&!u(i)){t.next=8;break}return o=i.slice(r,s),t.next=4,m(o);case 4:return a=t.sent,t.abrupt("return",e.from(a));case 8:if(!d(i)){t.next=12;break}return t.abrupt("return",i.subarray(r,s));case 12:throw new Error("_createBuffer requires File/Blob/Buffer.");case 13:case"end":return t.stop()}}),t)})));function i(e,i,r){return t.apply(this,arguments)}return i}(),p._getPartSize=function(t,e){var i=1e4;e||(e=1048576);var r=Math.ceil(t/i);return e<r&&(e=r,console.warn("partSize has been set to ".concat(e,", because the partSize you provided causes partNumber to be greater than 10,000"))),e},p._divideParts=function(t,e){for(var i=Math.ceil(t/e),r=[],n=0;n<i;n++){var s=e*n,o=Math.min(s+e,t);r.push({start:s,end:o})}return r}}).call(this)}).call(this,t("buffer").Buffer)},{"../common/utils/isBlob":68,"../common/utils/isBuffer":69,"../common/utils/isFile":71,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,buffer:103,"copy-to":107,"core-js/modules/es.array-buffer.slice.js":309,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.filter.js":312,"core-js/modules/es.array.find.js":313,"core-js/modules/es.array.from.js":314,"core-js/modules/es.array.iterator.js":316,"core-js/modules/es.array.map.js":318,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.iterator.js":343,"core-js/modules/es.typed-array.copy-within.js":356,"core-js/modules/es.typed-array.every.js":357,"core-js/modules/es.typed-array.fill.js":358,"core-js/modules/es.typed-array.filter.js":359,"core-js/modules/es.typed-array.find-index.js":360,"core-js/modules/es.typed-array.find.js":361,"core-js/modules/es.typed-array.for-each.js":362,"core-js/modules/es.typed-array.includes.js":363,"core-js/modules/es.typed-array.index-of.js":364,"core-js/modules/es.typed-array.iterator.js":365,"core-js/modules/es.typed-array.join.js":366,"core-js/modules/es.typed-array.last-index-of.js":367,"core-js/modules/es.typed-array.map.js":368,"core-js/modules/es.typed-array.reduce-right.js":369,"core-js/modules/es.typed-array.reduce.js":370,"core-js/modules/es.typed-array.reverse.js":371,"core-js/modules/es.typed-array.set.js":372,"core-js/modules/es.typed-array.slice.js":373,"core-js/modules/es.typed-array.some.js":374,"core-js/modules/es.typed-array.sort.js":375,"core-js/modules/es.typed-array.subarray.js":376,"core-js/modules/es.typed-array.to-locale-string.js":377,"core-js/modules/es.typed-array.to-string.js":378,"core-js/modules/es.typed-array.uint8-array.js":379,mime:430,path:439,stream:468,util:489}],5:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault");t("core-js/modules/es.function.name.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.number.constructor.js"),t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.promise.js");var n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("fs"),a=t("copy-to"),l=t("path"),c=t("mime"),h=t("../common/callback"),u=t("merge-descriptors"),d=t("../common/utils/isBlob").isBlob,p=t("../common/utils/isFile").isFile,f=t("../common/utils/isBuffer").isBuffer,_=t("../common/utils/obj2xml").obj2xml,m=t("../common/utils/parseRestoreInfo").parseRestoreInfo,g=i;g.append=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===(r=r||{}).position&&(r.position="0"),r.subres={append:"",position:r.position},r.method="POST",t.next=6,this.put(e,i,r);case 6:return(s=t.sent).nextAppendPosition=s.res.headers["x-oss-next-append-position"],t.abrupt("return",s);case 9:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),g.put=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o,a,u,_;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=r||{}).disabledMD5=void 0===r.disabledMD5||!!r.disabledMD5,r.headers=r.headers||{},e=this._objectName(e),!f(i)){t.next=8;break}s=i,t.next=19;break;case 8:if(!d(i)&&!p(i)){t.next=18;break}return r.mime||(p(i)?r.mime=c.getType(l.extname(i.name)):r.mime=i.type),t.next=12,this._createBuffer(i,0,i.size);case 12:return s=t.sent,t.next=15,this._getFileSize(i);case 15:r.contentLength=t.sent,t.next=19;break;case 18:throw new TypeError("Must provide Buffer/Blob/File for put.");case 19:return this._convertMetaToHeaders(r.meta,r.headers),o=r.method||"PUT",a=this._objectRequestParams(o,e,r),h.encodeCallback(a,r),a.mime=r.mime,a.disabledMD5=r.disabledMD5,a.content=s,a.successStatuses=[200],t.next=29,this.request(a);case 29:return u=t.sent,_={name:e,url:this._objectUrl(e),res:u.res},a.headers&&a.headers["x-oss-callback"]&&(_.data=JSON.parse(u.data.toString())),t.abrupt("return",_);case 33:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),g.putStream=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o,a,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=r||{}).headers=r.headers||{},e=this._objectName(e),r.contentLength?r.headers["Content-Length"]=r.contentLength:r.headers["Transfer-Encoding"]="chunked",this._convertMetaToHeaders(r.meta,r.headers),s=r.method||"PUT",o=this._objectRequestParams(s,e,r),h.encodeCallback(o,r),o.mime=r.mime,o.stream=i,o.successStatuses=[200],t.next=13,this.request(o);case 13:return a=t.sent,l={name:e,url:this._objectUrl(e),res:a.res},o.headers&&o.headers["x-oss-callback"]&&(l.data=JSON.parse(a.data.toString())),t.abrupt("return",l);case 17:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),u(g,t("../common/object/copyObject")),u(g,t("../common/object/getObjectTagging")),u(g,t("../common/object/putObjectTagging")),u(g,t("../common/object/deleteObjectTagging")),u(g,t("../common/image")),u(g,t("../common/object/getBucketVersions")),u(g,t("../common/object/getACL")),u(g,t("../common/object/putACL")),u(g,t("../common/object/head")),u(g,t("../common/object/delete")),u(g,t("../common/object/get")),u(g,t("../common/object/putSymlink")),u(g,t("../common/object/getSymlink")),u(g,t("../common/object/deleteMulti")),u(g,t("../common/object/getObjectMeta")),u(g,t("../common/object/getObjectUrl")),u(g,t("../common/object/generateObjectUrl")),u(g,t("../common/object/signatureUrl")),u(g,t("../common/object/asyncSignatureUrl")),u(g,t("../common/object/signatureUrlV4")),u(g,t("../common/object/signPostObjectPolicyV4")),g.putMeta=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.copy(e,e,{meta:i||{},timeout:r&&r.timeout,ctx:r&&r.ctx});case 2:return s=t.sent,t.abrupt("return",s);case 4:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),g.list=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o,a,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=this._objectRequestParams("GET","",i)).query=e,r.xmlResponse=!0,r.successStatuses=[200],t.next=6,this.request(r);case 6:return s=t.sent,o=s.data.Contents||[],a=this,o&&(Array.isArray(o)||(o=[o]),o=o.map((function(t){return{name:t.Key,url:a._objectUrl(t.Key),lastModified:t.LastModified,etag:t.ETag,type:t.Type,size:Number(t.Size),storageClass:t.StorageClass,owner:{id:t.Owner.ID,displayName:t.Owner.DisplayName},restoreInfo:m(t.RestoreInfo)}}))),(l=s.data.CommonPrefixes||null)&&(Array.isArray(l)||(l=[l]),l=l.map((function(t){return t.Prefix}))),t.abrupt("return",{res:s.res,objects:o,prefixes:l,nextMarker:s.data.NextMarker||null,isTruncated:"true"===s.data.IsTruncated});case 13:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),g.listV2=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o,a,l,c,h=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=h.length>1&&void 0!==h[1]?h[1]:{},(r=e["continuation-token"]||e.continuationToken)&&(i.subres=Object.assign({"continuation-token":r},i.subres)),(s=this._objectRequestParams("GET","",i)).query=Object.assign({"list-type":2},e),delete s.query["continuation-token"],delete s.query.continuationToken,s.xmlResponse=!0,s.successStatuses=[200],t.next=11,this.request(s);case 11:return o=t.sent,a=o.data.Contents||[],l=this,a&&(Array.isArray(a)||(a=[a]),a=a.map((function(t){var e=null;return t.Owner&&(e={id:t.Owner.ID,displayName:t.Owner.DisplayName}),{name:t.Key,url:l._objectUrl(t.Key),lastModified:t.LastModified,etag:t.ETag,type:t.Type,size:Number(t.Size),storageClass:t.StorageClass,owner:e,restoreInfo:m(t.RestoreInfo)}}))),(c=o.data.CommonPrefixes||null)&&(Array.isArray(c)||(c=[c]),c=c.map((function(t){return t.Prefix}))),t.abrupt("return",{res:o.res,objects:a,prefixes:c,isTruncated:"true"===o.data.IsTruncated,keyCount:+o.data.KeyCount,continuationToken:o.data.ContinuationToken||null,nextContinuationToken:o.data.NextContinuationToken||null});case 18:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),g.restore=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o,a=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=(i=a.length>1&&void 0!==a[1]?a[1]:{type:"Archive"})||{}).subres=Object.assign({restore:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),r=this._objectRequestParams("POST",e,i),s={RestoreRequest:{Days:i.Days?i.Days:2}},"ColdArchive"!==i.type&&"DeepColdArchive"!==i.type||(s.RestoreRequest.JobParameters={Tier:i.JobParameters?i.JobParameters:"Standard"}),r.content=_(s,{headers:!0}),r.mime="xml",r.successStatuses=[202],t.next=12,this.request(r);case 12:return o=t.sent,t.abrupt("return",{res:o.res});case 14:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),g._objectUrl=function(t){return this._getReqUrl({bucket:this.options.bucket,object:t})},g._objectRequestParams=function(t,e,i){if(!this.options.bucket&&!this.options.cname)throw new Error("Please create a bucket first");i=i||{};var r={object:e=this._objectName(e),bucket:this.options.bucket,method:t,subres:i&&i.subres,additionalHeaders:i&&i.additionalHeaders,timeout:i&&i.timeout,ctx:i&&i.ctx};return i.headers&&(r.headers={},a(i.headers).to(r.headers)),r},g._objectName=function(t){return t.replace(/^\/+/,"")},g._convertMetaToHeaders=function(t,e){t&&Object.keys(t).forEach((function(i){e["x-oss-meta-".concat(i)]=t[i]}))},g._deleteFileSafe=function(t){var e=this;return new Promise((function(i){o.exists(t,(function(r){r?o.unlink(t,(function(r){r&&e.debug("unlink %j error: %s",t,r,"error"),i()})):i()}))}))}},{"../common/callback":24,"../common/image":27,"../common/object/asyncSignatureUrl":31,"../common/object/copyObject":32,"../common/object/delete":33,"../common/object/deleteMulti":34,"../common/object/deleteObjectTagging":35,"../common/object/generateObjectUrl":36,"../common/object/get":37,"../common/object/getACL":38,"../common/object/getBucketVersions":39,"../common/object/getObjectMeta":40,"../common/object/getObjectTagging":41,"../common/object/getObjectUrl":42,"../common/object/getSymlink":43,"../common/object/head":44,"../common/object/putACL":45,"../common/object/putObjectTagging":46,"../common/object/putSymlink":47,"../common/object/signPostObjectPolicyV4":48,"../common/object/signatureUrl":49,"../common/object/signatureUrlV4":50,"../common/utils/isBlob":68,"../common/utils/isBuffer":69,"../common/utils/isFile":71,"../common/utils/obj2xml":76,"../common/utils/parseRestoreInfo":78,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"copy-to":107,"core-js/modules/es.array.map.js":318,"core-js/modules/es.function.name.js":322,"core-js/modules/es.number.constructor.js":324,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380,fs:102,"merge-descriptors":428,mime:430,path:439}],6:[function(t,e,i){i.version="6.23.0"},{}],7:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.abortBucketWorm=void 0;var o=t("../utils/checkBucketName");function a(t,e){return l.apply(this,arguments)}function l(){return(l=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.checkBucketName(e),r=this._bucketRequestParams("DELETE",e,"worm",i),t.next=4,this.request(r);case 4:return s=t.sent,t.abrupt("return",{res:s.res,status:s.status});case 6:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}i.abortBucketWorm=a},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],8:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.completeBucketWorm=void 0;var o=t("../utils/checkBucketName");function a(t,e,i){return l.apply(this,arguments)}function l(){return(l=(0,s.default)(n.default.mark((function t(e,i,r){var s,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.checkBucketName(e),s=this._bucketRequestParams("POST",e,{wormId:i},r),t.next=4,this.request(s);case 4:return a=t.sent,t.abrupt("return",{res:a.res,status:a.status});case 6:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}i.completeBucketWorm=a},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],9:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.deleteBucketInventory=void 0;var o=t("../utils/checkBucketName");function a(t,e){return l.apply(this,arguments)}function l(){return l=(0,s.default)(n.default.mark((function t(e,i){var r,s,a,l,c=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:{},s=Object.assign({inventory:"",inventoryId:i},r.subres),o.checkBucketName(e),(a=this._bucketRequestParams("DELETE",e,s,r)).successStatuses=[204],t.next=7,this.request(a);case 7:return l=t.sent,t.abrupt("return",{status:l.status,res:l.res});case 9:case"end":return t.stop()}}),t,this)}))),l.apply(this,arguments)}i.deleteBucketInventory=a},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],10:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName;i.deleteBucketLifecycle=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),(r=this._bucketRequestParams("DELETE",e,"lifecycle",i)).successStatuses=[204],t.next=5,this.request(r);case 5:return s=t.sent,t.abrupt("return",{res:s.res});case 7:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],11:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName;i.deleteBucketWebsite=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),(r=this._bucketRequestParams("DELETE",e,"website",i)).successStatuses=[204],t.next=5,this.request(r);case 5:return s=t.sent,t.abrupt("return",{res:s.res});case 7:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],12:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.extendBucketWorm=void 0;var o=t("../utils/checkBucketName"),a=t("../utils/obj2xml");function l(t,e,i,r){return c.apply(this,arguments)}function c(){return c=(0,s.default)(n.default.mark((function t(e,i,r,s){var l,c,h;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.checkBucketName(e),l=this._bucketRequestParams("POST",e,{wormExtend:"",wormId:i},s),c={ExtendWormConfiguration:{RetentionPeriodInDays:r}},l.mime="xml",l.content=a.obj2xml(c,{headers:!0}),l.successStatuses=[200],t.next=8,this.request(l);case 8:return h=t.sent,t.abrupt("return",{res:h.res,status:h.status});case 10:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}i.extendBucketWorm=l},{"../utils/checkBucketName":53,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],13:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.getBucketInventory=void 0;var o=t("../utils/checkBucketName"),a=t("../utils/formatInventoryConfig");function l(t,e){return c.apply(this,arguments)}function c(){return c=(0,s.default)(n.default.mark((function t(e,i){var r,s,l,c,h=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=h.length>2&&void 0!==h[2]?h[2]:{},s=Object.assign({inventory:"",inventoryId:i},r.subres),o.checkBucketName(e),(l=this._bucketRequestParams("GET",e,s,r)).successStatuses=[200],l.xmlResponse=!0,t.next=8,this.request(l);case 8:return c=t.sent,t.abrupt("return",{status:c.status,res:c.res,inventory:a.formatInventoryConfig(c.data)});case 10:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}i.getBucketInventory=l},{"../utils/checkBucketName":53,"../utils/formatInventoryConfig":63,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],14:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.map.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("../utils/isArray").isArray,l=t("../utils/formatObjKey").formatObjKey;i.getBucketLifecycle=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,c;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),(r=this._bucketRequestParams("GET",e,"lifecycle",i)).successStatuses=[200],r.xmlResponse=!0,t.next=6,this.request(r);case 6:return s=t.sent,(c=s.data.Rule||null)&&(a(c)||(c=[c]),c=c.map((function(t){return t.ID&&(t.id=t.ID,delete t.ID),t.Tag&&!a(t.Tag)&&(t.Tag=[t.Tag]),l(t,"firstLowerCase")}))),t.abrupt("return",{rules:c,res:s.res});case 10:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"../utils/formatObjKey":64,"../utils/isArray":67,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.map.js":318}],15:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName;i.getBucketVersioning=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),(r=this._bucketRequestParams("GET",e,"versioning",i)).xmlResponse=!0,r.successStatuses=[200],t.next=6,this.request(r);case 6:return s=t.sent,a=s.data.Status,t.abrupt("return",{status:s.status,versionStatus:a,res:s.res});case 9:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],16:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("../utils/isObject").isObject;i.getBucketWebsite=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(e),(r=this._bucketRequestParams("GET",e,"website",i)).successStatuses=[200],r.xmlResponse=!0,t.next=6,this.request(r);case 6:return s=t.sent,l=[],s.data.RoutingRules&&s.data.RoutingRules.RoutingRule&&(l=a(s.data.RoutingRules.RoutingRule)?[s.data.RoutingRules.RoutingRule]:s.data.RoutingRules.RoutingRule),t.abrupt("return",{index:s.data.IndexDocument&&s.data.IndexDocument.Suffix||"",supportSubDir:s.data.IndexDocument&&s.data.IndexDocument.SupportSubDir||"false",type:s.data.IndexDocument&&s.data.IndexDocument.Type,routingRules:l,error:s.data.ErrorDocument&&s.data.ErrorDocument.Key||null,res:s.res});case 10:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"../utils/isObject":74,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],17:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.getBucketWorm=void 0;var o=t("../utils/checkBucketName"),a=t("../utils/dataFix");function l(t,e){return c.apply(this,arguments)}function c(){return(c=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.checkBucketName(e),(r=this._bucketRequestParams("GET",e,"worm",i)).successStatuses=[200],r.xmlResponse=!0,t.next=6,this.request(r);case 6:return s=t.sent,a.dataFix(s.data,{lowerFirst:!0,rename:{RetentionPeriodInDays:"days"}}),t.abrupt("return",Object.assign(Object.assign({},s.data),{res:s.res,status:s.status}));case 9:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}i.getBucketWorm=l},{"../utils/checkBucketName":53,"../utils/dataFix":59,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],18:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.initiateBucketWorm=void 0;var o=t("../utils/obj2xml"),a=t("../utils/checkBucketName");function l(t,e,i){return c.apply(this,arguments)}function c(){return c=(0,s.default)(n.default.mark((function t(e,i,r){var s,l,c;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.checkBucketName(e),s=this._bucketRequestParams("POST",e,"worm",r),l={InitiateWormConfiguration:{RetentionPeriodInDays:i}},s.mime="xml",s.content=o.obj2xml(l,{headers:!0}),s.successStatuses=[200],t.next=8,this.request(s);case 8:return c=t.sent,t.abrupt("return",{res:c.res,wormId:c.res.headers["x-oss-worm-id"],status:c.status});case 10:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}i.initiateBucketWorm=l},{"../utils/checkBucketName":53,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],19:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.listBucketInventory=void 0;var o=t("../utils/checkBucketName"),a=t("../utils/formatInventoryConfig");function l(t){return c.apply(this,arguments)}function c(){return c=(0,s.default)(n.default.mark((function t(e){var i,r,s,l,c,h,u,d,p=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=p.length>1&&void 0!==p[1]?p[1]:{},r=i.continuationToken,s=Object.assign({inventory:""},r&&{"continuation-token":r},i.subres),o.checkBucketName(e),(l=this._bucketRequestParams("GET",e,s,i)).successStatuses=[200],l.xmlResponse=!0,t.next=9,this.request(l);case 9:return c=t.sent,h=c.data,u=c.res,d=c.status,t.abrupt("return",{isTruncated:"true"===h.IsTruncated,nextContinuationToken:h.NextContinuationToken,inventoryList:a.formatInventoryConfig(h.InventoryConfiguration,!0),status:d,res:u});case 12:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}i.listBucketInventory=l},{"../utils/checkBucketName":53,"../utils/formatInventoryConfig":63,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],20:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.array.concat.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.putBucketInventory=void 0;var o=t("../utils/checkBucketName"),a=t("../utils/obj2xml");function l(t,e){return c.apply(this,arguments)}function c(){return c=(0,s.default)(n.default.mark((function t(e,i){var r,s,l,c,h,u,d,p,f,_,m,g=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=g.length>2&&void 0!==g[2]?g[2]:{},s=Object.assign({inventory:"",inventoryId:i.id},r.subres),o.checkBucketName(e),l=i.OSSBucketDestination,c=i.optionalFields,h=i.includedObjectVersions,u="acs:oss:::",d="acs:ram::".concat(l.accountId,":role/"),p={InventoryConfiguration:{Id:i.id,IsEnabled:i.isEnabled,Filter:{Prefix:i.prefix||""},Destination:{OSSBucketDestination:{Format:l.format,AccountId:l.accountId,RoleArn:"".concat(d).concat(l.rolename),Bucket:"".concat(u).concat(l.bucket),Prefix:l.prefix||"",Encryption:l.encryption||""}},Schedule:{Frequency:i.frequency},IncludedObjectVersions:h,OptionalFields:{Field:(null==c?void 0:c.field)||[]}}},f=a.obj2xml(p,{headers:!0,firstUpperCase:!0}),(_=this._bucketRequestParams("PUT",e,s,r)).successStatuses=[200],_.mime="xml",_.content=f,t.next=14,this.request(_);case 14:return m=t.sent,t.abrupt("return",{status:m.status,res:m.res});case 16:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}i.putBucketInventory=l},{"../utils/checkBucketName":53,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.object.assign.js":325}],21:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.array.includes.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("../utils/isArray").isArray,l=t("../utils/deepCopy").deepCopy,c=t("../utils/isObject").isObject,h=t("../utils/obj2xml").obj2xml,u=t("../utils/checkObjectTag").checkObjectTag,d=t("../utils/getStrBytesCount").getStrBytesCount;function p(t){t.days&&(t.expiration={days:t.days}),t.date&&(t.expiration={createdBeforeDate:t.date})}function f(t,e){var i=t.days,r=t.createdBeforeDate;if(!i&&!r)throw new Error("".concat(e," must includes days or createdBeforeDate"));if(i&&(a(i)||!/^[1-9][0-9]*$/.test(i)))throw new Error("days must be a positive integer");if(r&&!/\d{4}-\d{2}-\d{2}T00:00:00.000Z/.test(r))throw new Error("createdBeforeDate must be date and conform to iso8601 format")}function _(t,e){var i=t.noncurrentDays;if(!i)throw new Error("".concat(e," must includes noncurrentDays"));if(i&&(a(i)||!/^[1-9][0-9]*$/.test(i)))throw new Error("noncurrentDays must be a positive integer")}function m(t){if(!a(t)&&!c(t))throw new Error("tag must be Object or Array");t=c(t)?[t]:t;var e={};l(t).forEach((function(t){e[t.key]=t.value})),u(e)}function g(t){if(!["IA","Archive","ColdArchive","DeepColdArchive"].includes(t))throw new Error("StorageClass must be IA or Archive or ColdArchive or DeepColdArchive")}function y(t){if(t.id&&d(t.id)>255)throw new Error("ID is composed of 255 bytes at most");if(void 0===t.prefix)throw new Error("Rule must includes prefix");if(!["Enabled","Disabled"].includes(t.status))throw new Error("Status must be Enabled or Disabled");if(!(t.expiration||t.noncurrentVersionExpiration||t.abortMultipartUpload||t.transition||t.noncurrentVersionTransition))throw new Error("Rule must includes expiration or noncurrentVersionExpiration or abortMultipartUpload or transition or noncurrentVersionTransition");if(t.transition&&(g(t.transition.storageClass),f(t.transition,"Transition")),t.expiration)if(t.expiration.expiredObjectDeleteMarker){if(t.expiration.days||t.expiration.createdBeforeDate)throw new Error("expiredObjectDeleteMarker cannot be used with days or createdBeforeDate")}else f(t.expiration,"Expiration");if(t.abortMultipartUpload&&f(t.abortMultipartUpload,"AbortMultipartUpload"),t.noncurrentVersionTransition&&(g(t.noncurrentVersionTransition.storageClass),_(t.noncurrentVersionTransition,"NoncurrentVersionTransition")),t.noncurrentVersionExpiration&&_(t.noncurrentVersionExpiration,"NoncurrentVersionExpiration"),t.tag){if(t.abortMultipartUpload)throw new Error("Tag cannot be used with abortMultipartUpload");m(t.tag)}}i.putBucketLifecycle=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,l,c,u,d;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o(e),a(i)){t.next=3;break}throw new Error("rules must be Array");case 3:return s=this._bucketRequestParams("PUT",e,"lifecycle",r),c={LifecycleConfiguration:{Rule:l=[]}},i.forEach((function(t){p(t),y(t),t.id&&(t.ID=t.id,delete t.id),l.push(t)})),u=h(c,{headers:!0,firstUpperCase:!0}),s.content=u,s.mime="xml",s.successStatuses=[200],t.next=13,this.request(s);case 13:return d=t.sent,t.abrupt("return",{res:d.res});case 15:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"../utils/checkObjectTag":56,"../utils/deepCopy":60,"../utils/getStrBytesCount":66,"../utils/isArray":67,"../utils/isObject":74,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/web.dom-collections.for-each.js":380}],22:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.includes.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("../utils/obj2xml").obj2xml;i.putBucketVersioning=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,l,c,h=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=h.length>2&&void 0!==h[2]?h[2]:{},o(e),["Enabled","Suspended"].includes(i)){t.next=4;break}throw new Error("status must be Enabled or Suspended");case 4:return s=this._bucketRequestParams("PUT",e,"versioning",r),l={VersioningConfiguration:{Status:i}},s.mime="xml",s.content=a(l,{headers:!0}),t.next=10,this.request(s);case 10:return c=t.sent,t.abrupt("return",{res:c.res,status:c.status});case 12:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.includes.js":315}],23:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator")),s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("../utils/obj2xml").obj2xml,l=t("../utils/isArray").isArray;i.putBucketWebsite=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,c,h,u,d,p=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=p.length>1&&void 0!==p[1]?p[1]:{},r=p.length>2?p[2]:void 0,o(e),s=this._bucketRequestParams("PUT",e,"website",r),c={Suffix:i.index||"index.html"},u={WebsiteConfiguration:h={IndexDocument:c}},i.supportSubDir&&(c.SupportSubDir=i.supportSubDir),i.type&&(c.Type=i.type),i.error&&(h.ErrorDocument={Key:i.error}),void 0===i.routingRules){t.next=14;break}if(l(i.routingRules)){t.next=13;break}throw new Error("RoutingRules must be Array");case 13:h.RoutingRules={RoutingRule:i.routingRules};case 14:return u=a(u),s.content=u,s.mime="xml",s.successStatuses=[200],t.next=20,this.request(s);case 20:return d=t.sent,t.abrupt("return",{res:d.res});case 22:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"../utils/isArray":67,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93}],24:[function(t,e,i){(function(e){(function(){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),i.encodeCallback=function(t,i){if(t.headers=t.headers||{},!Object.prototype.hasOwnProperty.call(t.headers,"x-oss-callback")&&i.callback){var r={callbackUrl:encodeURI(i.callback.url),callbackBody:i.callback.body};i.callback.host&&(r.callbackHost=i.callback.host),i.callback.contentType&&(r.callbackBodyType=i.callback.contentType),i.callback.callbackSNI&&(r.callbackSNI=i.callback.callbackSNI);var n=e.from(JSON.stringify(r)).toString("base64");if(t.headers["x-oss-callback"]=n,i.callback.customValue){var s={};Object.keys(i.callback.customValue).forEach((function(t){s["x:".concat(t)]=i.callback.customValue[t].toString()})),t.headers["x-oss-callback-var"]=e.from(JSON.stringify(s)).toString("base64")}}}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:103,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/web.dom-collections.for-each.js":380}],25:[function(t,e,i){t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js");var r=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.getReqUrl=void 0;var n=r(t("copy-to")),s=r(t("url")),o=r(t("merge-descriptors")),a=r(t("is-type-of")),l=t("../utils/isIP"),c=t("../utils/checkConfigValid");function h(t){var e={},i=this.options.cname;c.checkConfigValid(this.options.endpoint,"endpoint"),n.default(this.options.endpoint,!1).to(e),!t.bucket||i||l.isIP(e.hostname)||this.options.sldEnable||(e.host="".concat(t.bucket,".").concat(e.host));var r="/";t.bucket&&this.options.sldEnable&&(r+="".concat(t.bucket,"/")),t.object&&(r+=this._escape(t.object).replace(/\+/g,"%2B")),e.pathname=r;var h={};if(t.query&&o.default(h,t.query),t.subres){var u={};a.default.string(t.subres)?u[t.subres]="":a.default.array(t.subres)?t.subres.forEach((function(t){u[t]=""})):u=t.subres,o.default(h,u)}return e.query=h,s.default.format(e)}i.getReqUrl=h},{"../utils/checkConfigValid":54,"../utils/isIP":73,"copy-to":107,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380,"is-type-of":537,"merge-descriptors":428,url:543}],26:[function(t,e,i){t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.string.trim.js");var r=t("humanize-ms"),n=t("url"),s=t("../utils/checkBucketName").checkBucketName,o=t("../utils/setRegion").setRegion,a=t("../utils/checkConfigValid").checkConfigValid;function l(t,e){a(t,"endpoint");var i=n.parse(t);if(i.protocol||(i=n.parse("http".concat(e?"s":"","://").concat(t))),"http:"!==i.protocol&&"https:"!==i.protocol)throw new Error("Endpoint protocol must be http or https.");return i}e.exports=function(t){if(!t||!t.accessKeyId||!t.accessKeySecret)throw new Error("require accessKeyId, accessKeySecret");!t.stsToken||t.refreshSTSToken||t.refreshSTSTokenInterval||console.warn("It's recommended to set 'refreshSTSToken' and 'refreshSTSTokenInterval' to refresh stsToken、accessKeyId、accessKeySecret automatically when sts token has expired"),t.bucket&&s(t.bucket);var e=Object.assign({region:"oss-cn-hangzhou",internal:!1,secure:!1,timeout:6e4,bucket:null,endpoint:null,cname:!1,isRequestPay:!1,sldEnable:!1,headerEncoding:"utf-8",refreshSTSToken:null,refreshSTSTokenInterval:3e5,retryMax:0,authorizationV4:!1},t);if(e.accessKeyId=e.accessKeyId.trim(),e.accessKeySecret=e.accessKeySecret.trim(),e.timeout&&(e.timeout=r(e.timeout)),e.endpoint)e.endpoint=l(e.endpoint,e.secure);else{if(!e.region)throw new Error("require options.endpoint or options.region");e.endpoint=o(e.region,e.internal,e.secure)}return e.inited=!0,e}},{"../utils/checkBucketName":53,"../utils/checkConfigValid":54,"../utils/setRegion":81,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.string.trim.js":349,"humanize-ms":399,url:543}],27:[function(t,e,i){t("merge-descriptors")(i,t("./processObjectSave"))},{"./processObjectSave":28,"merge-descriptors":428}],28:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.concat.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkBucketName").checkBucketName,a=t("querystring"),l=t("js-base64").Base64.encode;function c(t,e){if(!t)throw new Error("".concat(e," is required"));if("string"!=typeof t)throw new Error("".concat(e," must be String"))}i.processObjectSave=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s){var h,u,d,p;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c(e,"sourceObject"),c(i,"targetObject"),c(r,"process"),i=this._objectName(i),s&&o(s),h=this._objectRequestParams("POST",e,{subres:"x-oss-process"}),u=s?",b_".concat(l(s)):"",i=l(i),d={"x-oss-process":"".concat(r,"|sys/saveas,o_").concat(i).concat(u)},h.content=a.stringify(d),t.next=12,this.request(h);case 12:return p=t.sent,t.abrupt("return",{res:p.res,status:p.res.status});case 14:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n){return t.apply(this,arguments)}return e}()},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.concat.js":310,"js-base64":413,querystring:451}],29:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.function.name.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.array.from.js"),t("core-js/modules/es.string.iterator.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.array.filter.js"),t("core-js/modules/es.array.find.js"),t("core-js/modules/es.regexp.to-string.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("debug")("ali-oss:multipart-copy"),a=t("copy-to"),l=i;l.uploadPartCopy=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s,o){var a,l,c,h,u,d=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=d.length>5&&void 0!==d[5]?d[5]:{}).headers=a.headers||{},l=a.versionId||a.subres&&a.subres.versionId||null,c=l?"/".concat(o.sourceBucketName,"/").concat(encodeURIComponent(o.sourceKey),"?versionId=").concat(l):"/".concat(o.sourceBucketName,"/").concat(encodeURIComponent(o.sourceKey)),a.headers["x-oss-copy-source"]=c,s&&(a.headers["x-oss-copy-source-range"]="bytes=".concat(s)),a.subres={partNumber:r,uploadId:i},(h=this._objectRequestParams("PUT",e,a)).mime=a.mime,h.successStatuses=[200],t.next=12,this.request(h);case 12:return u=t.sent,t.abrupt("return",{name:e,etag:u.res.headers.etag,res:u.res});case 14:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n,s){return t.apply(this,arguments)}return e}(),l.multipartUploadCopy=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,o,a,l,c,h,u,d,p,f,_=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=_.length>2&&void 0!==_[2]?_[2]:{},this.resetCancelFlag(),s=r.versionId,o={versionId:void 0===s?null:s},t.next=6,this._getObjectMeta(i.sourceBucketName,i.sourceKey,o);case 6:if(a=t.sent,l=a.res.headers["content-length"],i.startOffset=i.startOffset||0,i.endOffset=i.endOffset||l,!r.checkpoint||!r.checkpoint.uploadId){t.next=14;break}return t.next=13,this._resumeMultipartCopy(r.checkpoint,i,r);case 13:case 31:return t.abrupt("return",t.sent);case 14:if(c=102400,!((h=i.endOffset-i.startOffset)<c)){t.next=18;break}throw new Error("copySize must not be smaller than ".concat(c));case 18:if(!(r.partSize&&r.partSize<c)){t.next=20;break}throw new Error("partSize must not be smaller than ".concat(c));case 20:return t.next=22,this.initMultipartUpload(e,r);case 22:if(u=t.sent,d=u.uploadId,p=this._getPartSize(h,r.partSize),f={name:e,copySize:h,partSize:p,uploadId:d,doneParts:[]},!r||!r.progress){t.next=29;break}return t.next=29,r.progress(0,f,u.res);case 29:return t.next=31,this._resumeMultipartCopy(f,i,r);case 32:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),l._resumeMultipartCopy=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S,w,A,E,D;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isCancel()){t.next=2;break}throw this._makeCancelEvent();case 2:if(l=r.versionId,h={versionId:c=void 0===l?null:l},u=e.copySize,d=e.partSize,p=e.uploadId,f=e.doneParts,_=e.name,m=this._divideMultipartCopyParts(u,d,i.startOffset),g=m.length,y={headers:{}},r.copyheaders&&a(r.copyheaders).to(y.headers),c&&a(h).to(y),v=function(t,i,a){return new Promise(function(){var l=(0,s.default)(n.default.mark((function s(l,c){var h,u,d;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,t.isCancel()){n.next=22;break}return h=m[i-1],u="".concat(h.start,"-").concat(h.end-1),n.prev=4,n.next=7,t.uploadPartCopy(_,p,i,u,a,y);case 7:d=n.sent,n.next=15;break;case 10:if(n.prev=10,n.t0=n.catch(4),404!==n.t0.status){n.next=14;break}throw t._makeAbortEvent();case 14:throw n.t0;case 15:if(t.isCancel()){n.next=22;break}if(o("content-range ".concat(d.res.headers["content-range"])),f.push({number:i,etag:d.res.headers.etag}),e.doneParts=f,!r||!r.progress){n.next=22;break}return n.next=22,r.progress(f.length/g,e,d.res);case 22:l(),n.next=29;break;case 25:n.prev=25,n.t1=n.catch(0),n.t1.partNum=i,c(n.t1);case 29:case"end":return n.stop()}}),s,null,[[0,25],[4,10]])})));return function(t,e){return l.apply(this,arguments)}}())},b=Array.from(new Array(g),(function(t,e){return e+1})),x=f.map((function(t){return t.number})),T=b.filter((function(t){return x.indexOf(t)<0})),C=5,S=r.parallel||C,!this.checkBrowserAndVersion("Internet Explorer","10")&&1!==S){t.next=28;break}w=0;case 18:if(!(w<T.length)){t.next=26;break}if(!this.isCancel()){t.next=21;break}throw this._makeCancelEvent();case 21:return t.next=23,v(this,T[w],i);case 23:w++,t.next=18;break;case 26:t.next=40;break;case 28:return t.next=30,this._parallelNode(T,S,v,i);case 30:if(A=t.sent,!(E=A.find((function(t){return"abort"===t.name})))){t.next=34;break}throw E;case 34:if(!this.isCancel()){t.next=36;break}throw this._makeCancelEvent();case 36:if(!(A&&A.length>0)){t.next=40;break}throw(D=A[0]).message="Failed to copy some parts with error: ".concat(D.toString()," part_num: ").concat(D.partNum),D;case 40:return t.next=42,this.completeMultipartUpload(_,p,f,r);case 42:return t.abrupt("return",t.sent);case 43:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),l._divideMultipartCopyParts=function(t,e,i){for(var r=Math.ceil(t/e),n=[],s=0;s<r;s++){var o=e*s+i,a=Math.min(o+e,t+i);n.push({start:o,end:a})}return n},l._getObjectMeta=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=this.getBucket(),this.setBucket(e),t.next=4,this.head(i,r);case 4:return o=t.sent,this.setBucket(s),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"copy-to":107,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.filter.js":312,"core-js/modules/es.array.find.js":313,"core-js/modules/es.array.from.js":314,"core-js/modules/es.array.map.js":318,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.iterator.js":343,debug:536}],30:[function(t,e,i){(function(e){(function(){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.map.js"),t("core-js/modules/es.array.filter.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.array.sort.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.regexp.to-string.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("copy-to"),a=t("./callback"),l=t("./utils/deepCopy").deepCopyWith,c=t("./utils/isBuffer").isBuffer,h=t("./utils/omit").omit,u=i;u.listUploads=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,a,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={},o(i=i||{}).to(r),r.subres="uploads",(s=this._objectRequestParams("GET","",r)).query=e,s.xmlResponse=!0,s.successStatuses=[200],t.next=10,this.request(s);case 10:return a=t.sent,l=a.data.Upload||[],Array.isArray(l)||(l=[l]),l=l.map((function(t){return{name:t.Key,uploadId:t.UploadId,initiated:t.Initiated}})),t.abrupt("return",{res:a.res,uploads:l,bucket:a.data.Bucket,nextKeyMarker:a.data.NextKeyMarker,nextUploadIdMarker:a.data.NextUploadIdMarker,isTruncated:"true"===a.data.IsTruncated});case 15:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),u.listParts=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s){var a,l,c;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},o(s=s||{}).to(a),a.subres={uploadId:i},(l=this._objectRequestParams("GET",e,a)).query=r,l.xmlResponse=!0,l.successStatuses=[200],t.next=10,this.request(l);case 10:return c=t.sent,t.abrupt("return",{res:c.res,uploadId:c.data.UploadId,bucket:c.data.Bucket,name:c.data.Key,partNumberMarker:c.data.PartNumberMarker,nextPartNumberMarker:c.data.NextPartNumberMarker,maxParts:c.data.MaxParts,isTruncated:c.data.IsTruncated,parts:c.data.Part||[]});case 12:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n){return t.apply(this,arguments)}return e}(),u.abortMultipartUpload=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,a,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._stop(),s={},o(r=r||{}).to(s),s.subres={uploadId:i},(a=this._objectRequestParams("DELETE",e,s)).successStatuses=[204],t.next=9,this.request(a);case 9:return l=t.sent,t.abrupt("return",{res:l.res});case 11:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}(),u.initMultipartUpload=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={},o(i=i||{}).to(r),r.headers=r.headers||{},this._convertMetaToHeaders(i.meta,r.headers),r.subres="uploads",(s=this._objectRequestParams("POST",e,r)).mime=i.mime,s.xmlResponse=!0,s.successStatuses=[200],t.next=12,this.request(s);case 12:return a=t.sent,t.abrupt("return",{res:a.res,bucket:a.data.Bucket,name:a.data.Key,uploadId:a.data.UploadId});case 14:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}(),u.uploadPart=function(){var t=(0,s.default)(n.default.mark((function t(i,r,s,o,a,l,c){var h;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h={size:l-a},!e||!e.browser){t.next=8;break}return t.next=5,this._createBuffer(o,a,l);case 5:h.content=t.sent,t.next=11;break;case 8:return t.next=10,this._createStream(o,a,l);case 10:h.stream=t.sent;case 11:return t.next=13,this._uploadPart(i,r,s,h,c);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,this)})));function i(e,i,r,n,s,o,a){return t.apply(this,arguments)}return i}(),u.completeMultipartUpload=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s){var o,u,d,p,f,_,m,g;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o=r.concat().sort((function(t,e){return t.number-e.number})).filter((function(t,e,i){return!e||t.number!==i[e-1].number})),u='<?xml version="1.0" encoding="UTF-8"?>\n<CompleteMultipartUpload>\n',d=0;d<o.length;d++)p=o[d],u+="<Part>\n",u+="<PartNumber>".concat(p.number,"</PartNumber>\n"),u+="<ETag>".concat(p.etag,"</ETag>\n"),u+="</Part>\n";return u+="</CompleteMultipartUpload>",f={},(f=l(s=s||{},(function(t){if(c(t))return null}))).subres={uploadId:i},f.headers=h(f.headers,["x-oss-server-side-encryption","x-oss-storage-class"]),_=this._objectRequestParams("POST",e,f),a.encodeCallback(_,f),_.mime="xml",_.content=u,_.headers&&_.headers["x-oss-callback"]||(_.xmlResponse=!0),_.successStatuses=[200],t.next=17,this.request(_);case 17:if(m=t.sent,!s.progress){t.next=21;break}return t.next=21,s.progress(1,null,m.res);case 21:return g={res:m.res,bucket:_.bucket,name:e,etag:m.res.headers.etag},_.headers&&_.headers["x-oss-callback"]&&(g.data=JSON.parse(m.data.toString())),t.abrupt("return",g);case 24:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n){return t.apply(this,arguments)}return e}(),u._uploadPart=function(){var t=(0,s.default)(n.default.mark((function t(i,r,s,a,l){var c,u,d;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c={},o(l=l||{}).to(c),c.headers=c.headers||{},c.headers["Content-Length"]=a.size,c.headers=h(c.headers,["x-oss-server-side-encryption","x-oss-storage-class"]),c.subres={partNumber:s,uploadId:r},(u=this._objectRequestParams("PUT",i,c)).mime=c.mime,e&&e.browser?u.content=a.content:u.stream=a.stream,u.successStatuses=[200],u.disabledMD5=l.disabledMD5,t.next=15,this.request(u);case 15:if((d=t.sent).res.headers.etag){t.next=18;break}throw new Error("Please set the etag of expose-headers in OSS \n https://help.aliyun.com/document_detail/32069.html");case 18:return a.stream&&(a.stream=null,u.stream=null),t.abrupt("return",{name:i,etag:d.res.headers.etag,res:d.res});case 20:case"end":return t.stop()}}),t,this)})));function i(e,i,r,n,s){return t.apply(this,arguments)}return i}()}).call(this)}).call(this,t("_process"))},{"./callback":24,"./utils/deepCopy":60,"./utils/isBuffer":69,"./utils/omit":77,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,_process:538,"copy-to":107,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.filter.js":312,"core-js/modules/es.array.map.js":318,"core-js/modules/es.array.sort.js":320,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339}],31:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.regexp.exec.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("url"),a=t("utility"),l=t("copy-to"),c=t("../../common/signUtils"),h=t("../utils/isIP").isIP,u=t("../utils/setSTSToken").setSTSToken,d=t("../utils/isFunction").isFunction;i.asyncSignatureUrl=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,p,f,_,m,g=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!(g.length>2&&void 0!==g[2])||g[2],!h(this.options.endpoint.hostname)){t.next=3;break}throw new Error("can not get the object URL when endpoint is IP");case 3:if(!r||!/^\?/.test(e)){t.next=5;break}throw new Error("Invalid object name ".concat(e));case 5:if(i=i||{},e=this._objectName(e),i.method=i.method||"GET",s=a.timestamp()+(i.expires||1800),p={bucket:this.options.bucket,object:e},f=this._getResource(p),!this.options.stsToken||!d(this.options.refreshSTSToken)){t.next=14;break}return t.next=14,u.call(this);case 14:return this.options.stsToken&&(i["security-token"]=this.options.stsToken),_=c._signatureForURL(this.options.accessKeySecret,i,f,s),(m=o.parse(this._getReqUrl(p))).query={OSSAccessKeyId:this.options.accessKeyId,Expires:s,Signature:_.Signature},l(_.subResource).to(m.query),t.abrupt("return",m.format());case 20:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../../common/signUtils":52,"../utils/isFunction":72,"../utils/isIP":73,"../utils/setSTSToken":82,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"copy-to":107,"core-js/modules/es.regexp.exec.js":338,url:543,utility:545}],32:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.find.js"),t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js");var s=r(t("@babel/runtime/helpers/typeof")),o=r(t("@babel/runtime/helpers/asyncToGenerator")),a=t("../utils/checkBucketName").checkBucketName,l=i,c=["content-type","content-encoding","content-language","content-disposition","cache-control","expires"];l.copy=function(){var t=(0,o.default)(n.default.mark((function t(e,i,r,o){var a,l,h;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"object"===(0,s.default)(r)&&(o=r),(o=o||{}).headers=o.headers||{},Object.keys(o.headers).forEach((function(t){o.headers["x-oss-copy-source-".concat(t.toLowerCase())]=o.headers[t]})),(o.meta||Object.keys(o.headers).find((function(t){return c.includes(t.toLowerCase())})))&&(o.headers["x-oss-metadata-directive"]="REPLACE"),this._convertMetaToHeaders(o.meta,o.headers),i=this._getSourceName(i,r),o.versionId&&(i="".concat(i,"?versionId=").concat(o.versionId)),o.headers["x-oss-copy-source"]=i,(a=this._objectRequestParams("PUT",e,o)).xmlResponse=!0,a.successStatuses=[200,304],t.next=14,this.request(a);case 14:return l=t.sent,(h=l.data)&&(h={etag:h.ETag,lastModified:h.LastModified}),t.abrupt("return",{data:h,res:l.res});case 18:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n){return t.apply(this,arguments)}return e}(),l._getSourceName=function(t,e){return"string"==typeof e?t=this._objectName(t):"/"!==t[0]?e=this.options.bucket:(e=t.replace(/\/(.+?)(\/.*)/,"$1"),t=t.replace(/(\/.+?\/)(.*)/,"$2")),a(e),t=encodeURIComponent(t),t="/".concat(e,"/").concat(t)}},{"../utils/checkBucketName":53,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,"@babel/runtime/regenerator":93,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.find.js":313,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380}],33:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.delete=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=o.length>1&&void 0!==o[1]?o[1]:{}).subres=Object.assign({},i.subres),i.versionId&&(i.subres.versionId=i.versionId),(r=this._objectRequestParams("DELETE",e,i)).successStatuses=[204],t.next=7,this.request(r);case 7:return s=t.sent,t.abrupt("return",{res:s.res});case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],34:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("utility"),a=t("../utils/obj2xml").obj2xml;i.deleteMulti=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,l,c,h,u,d,p,f,_,m,g,y=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=y.length>1&&void 0!==y[1]?y[1]:{},r=[],e&&e.length){t.next=4;break}throw new Error("names is required");case 4:for(s=0;s<e.length;s++)l={},"string"==typeof e[s]?l.Key=o.escape(this._objectName(e[s])):(c=e[s],h=c.key,u=c.versionId,l.Key=o.escape(this._objectName(h)),l.VersionId=u),r.push(l);return d={Delete:{Quiet:!!i.quiet,Object:r}},p=a(d,{headers:!0}),i.subres=Object.assign({delete:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),(f=this._objectRequestParams("POST","",i)).mime="xml",f.content=p,f.xmlResponse=!0,f.successStatuses=[200],t.next=16,this.request(f);case 16:return _=t.sent,m=_.data,(g=m&&m.Deleted||null)&&(Array.isArray(g)||(g=[g])),t.abrupt("return",{res:_.res,deleted:g||[]});case 21:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325,utility:545}],35:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.deleteObjectTagging=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=o.length>1&&void 0!==o[1]?o[1]:{}).subres=Object.assign({tagging:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),e=this._objectName(e),(r=this._objectRequestParams("DELETE",e,i)).successStatuses=[204],t.next=8,this.request(r);case 8:return s=t.sent,t.abrupt("return",{status:s.status,res:s.res});case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],36:[function(t,e,i){t("core-js/modules/es.array.concat.js");var r=t("url"),n=t("../utils/isIP").isIP;i.generateObjectUrl=function(t,e){if(n(this.options.endpoint.hostname))throw new Error("can not get the object URL when endpoint is IP");if(e)"/"!==e[e.length-1]&&(e+="/");else{e=this.options.endpoint.format();var i=r.parse(e),s=this.options.bucket;i.hostname="".concat(s,".").concat(i.hostname),i.host="".concat(s,".").concat(i.host),e=i.format()}return e+this._escape(this._objectName(t))}},{"../utils/isIP":73,"core-js/modules/es.array.concat.js":310,url:543}],37:[function(t,e,i){(function(e){(function(){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("fs"),a=t("is-type-of"),l=t("../utils/isObject").isObject;i.get=function(){var t=(0,s.default)(n.default.mark((function t(i,r){var s,c,h,u,d,p,f,_,m=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=m.length>2&&void 0!==m[2]?m[2]:{},c=null,h=!1,a.writableStream(r)?c=r:a.string(r)?(c=o.createWriteStream(r),h=!0):l(r)&&(s=r),s=s||{},u=e&&e.browser,d=null===s.responseCacheControl?"":"no-cache",p=u&&d?{"response-cache-control":d}:{},s.subres=Object.assign(p,s.subres),s.versionId&&(s.subres.versionId=s.versionId),s.process&&(s.subres["x-oss-process"]=s.process),t.prev=11,(_=this._objectRequestParams("GET",i,s)).writeStream=c,_.successStatuses=[200,206,304],t.next=17,this.request(_);case 17:f=t.sent,h&&c.destroy(),t.next=28;break;case 21:if(t.prev=21,t.t0=t.catch(11),!h){t.next=27;break}return c.destroy(),t.next=27,this._deleteFileSafe(r);case 27:throw t.t0;case 28:return t.abrupt("return",{res:f.res,content:f.data});case 29:case"end":return t.stop()}}),t,this,[[11,21]])})));function i(e,i){return t.apply(this,arguments)}return i}()}).call(this)}).call(this,t("_process"))},{"../utils/isObject":74,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,_process:538,"core-js/modules/es.object.assign.js":325,fs:102,"is-type-of":537}],38:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.getACL=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=o.length>1&&void 0!==o[1]?o[1]:{}).subres=Object.assign({acl:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),e=this._objectName(e),(r=this._objectRequestParams("GET",e,i)).successStatuses=[200],r.xmlResponse=!0,t.next=9,this.request(r);case 9:return s=t.sent,t.abrupt("return",{acl:s.data.AccessControlList.Grant,owner:{id:s.data.Owner.ID,displayName:s.data.Owner.DisplayName},res:s.res});case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],39:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.number.constructor.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=i,a=t("../utils/isObject").isObject,l=t("../utils/isArray").isArray,c=t("../utils/parseRestoreInfo").parseRestoreInfo;function h(){return u.apply(this,arguments)}function u(){return u=(0,s.default)(n.default.mark((function t(){var e,i,r,s,o,a,h,u,d=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=d.length>0&&void 0!==d[0]?d[0]:{},i=d.length>1&&void 0!==d[1]?d[1]:{},!e.versionIdMarker||void 0!==e.keyMarker){t.next=4;break}throw new Error("A version-id marker cannot be specified without a key marker");case 4:return i.subres=Object.assign({versions:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),(r=this._objectRequestParams("GET","",i)).xmlResponse=!0,r.successStatuses=[200],r.query=p(e),t.next=12,this.request(r);case 12:return s=t.sent,o=s.data.Version||[],a=s.data.DeleteMarker||[],h=this,o&&(Array.isArray(o)||(o=[o]),o=o.map((function(t){return{name:t.Key,url:h._objectUrl(t.Key),lastModified:t.LastModified,isLatest:"true"===t.IsLatest,versionId:t.VersionId,etag:t.ETag,type:t.Type,size:Number(t.Size),storageClass:t.StorageClass,owner:{id:t.Owner.ID,displayName:t.Owner.DisplayName},restoreInfo:c(t.RestoreInfo)}}))),a&&(l(a)||(a=[a]),a=a.map((function(t){return{name:t.Key,lastModified:t.LastModified,versionId:t.VersionId,owner:{id:t.Owner.ID,displayName:t.Owner.DisplayName}}}))),(u=s.data.CommonPrefixes||null)&&(l(u)||(u=[u]),u=u.map((function(t){return t.Prefix}))),t.abrupt("return",{res:s.res,objects:o,deleteMarker:a,prefixes:u,nextMarker:s.data.NextKeyMarker||null,NextVersionIdMarker:s.data.NextVersionIdMarker||null,nextKeyMarker:s.data.NextKeyMarker||null,nextVersionIdMarker:s.data.NextVersionIdMarker||null,isTruncated:"true"===s.data.IsTruncated});case 21:case"end":return t.stop()}}),t,this)}))),u.apply(this,arguments)}function d(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return a(t)&&Object.keys(t).forEach((function(i){e[d(i)]=t[i]})),e}o.getBucketVersions=h,o.listObjectVersions=h},{"../utils/isArray":67,"../utils/isObject":74,"../utils/parseRestoreInfo":78,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.map.js":318,"core-js/modules/es.number.constructor.js":324,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380}],40:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.getObjectMeta=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=i||{},e=this._objectName(e),i.subres=Object.assign({objectMeta:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),(r=this._objectRequestParams("HEAD",e,i)).successStatuses=[200],t.next=8,this.request(r);case 8:return s=t.sent,t.abrupt("return",{status:s.status,res:s.res});case 10:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],41:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=i,a=t("../utils/isObject").isObject;o.getObjectTagging=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o,l,c,h=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=h.length>1&&void 0!==h[1]?h[1]:{}).subres=Object.assign({tagging:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),e=this._objectName(e),(r=this._objectRequestParams("GET",e,i)).successStatuses=[200],t.next=8,this.request(r);case 8:return s=t.sent,t.next=11,this.parseXML(s.data);case 11:return o=t.sent,l=(l=o.TagSet.Tag)&&a(l)?[l]:l||[],c={},l.forEach((function(t){c[t.Key]=t.Value})),t.abrupt("return",{status:s.status,res:s.res,tag:c});case 17:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"../utils/isObject":74,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.to-string.js":329,"core-js/modules/web.dom-collections.for-each.js":380}],42:[function(t,e,i){var r=t("../utils/isIP").isIP;i.getObjectUrl=function(t,e){if(r(this.options.endpoint.hostname))throw new Error("can not get the object URL when endpoint is IP");return e?"/"!==e[e.length-1]&&(e+="/"):e=this.options.endpoint.format(),e+this._escape(this._objectName(t))}},{"../utils/isIP":73}],43:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.getSymlink=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,o,a=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=a.length>1&&void 0!==a[1]?a[1]:{}).subres=Object.assign({symlink:""},i.subres),i.versionId&&(i.subres.versionId=i.versionId),e=this._objectName(e),(r=this._objectRequestParams("GET",e,i)).successStatuses=[200],t.next=8,this.request(r);case 8:return s=t.sent,o=s.res.headers["x-oss-symlink-target"],t.abrupt("return",{targetName:decodeURIComponent(o),res:s.res});case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],44:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/checkEnv").checkEnv;i.head=function(){var t=(0,s.default)(n.default.mark((function t(e){var i,r,s,a,l=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=l.length>1&&void 0!==l[1]?l[1]:{},o("Because HeadObject has gzip enabled, head cannot get the file size correctly. If you need to get the file size, please use getObjectMeta"),i.subres=Object.assign({},i.subres),i.versionId&&(i.subres.versionId=i.versionId),(r=this._objectRequestParams("HEAD",e,i)).successStatuses=[200,304],t.next=8,this.request(r);case 8:return s=t.sent,a={meta:null,res:s.res,status:s.status},200===s.status&&Object.keys(s.headers).forEach((function(t){0===t.indexOf("x-oss-meta-")&&(a.meta||(a.meta={}),a.meta[t.substring(11)]=s.headers[t])})),t.abrupt("return",a);case 12:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{"../utils/checkEnv":55,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/web.dom-collections.for-each.js":380}],45:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.putACL=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=r||{}).subres=Object.assign({acl:""},r.subres),r.versionId&&(r.subres.versionId=r.versionId),r.headers=r.headers||{},r.headers["x-oss-object-acl"]=i,e=this._objectName(e),(s=this._objectRequestParams("PUT",e,r)).successStatuses=[200],t.next=10,this.request(s);case 10:return o=t.sent,t.abrupt("return",{res:o.res});case 12:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],46:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.object.keys.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("../utils/obj2xml").obj2xml,a=t("../utils/checkObjectTag").checkObjectTag;i.putObjectTagging=function(){var t=(0,s.default)(n.default.mark((function t(e,i){var r,s,l,c,h=arguments;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=h.length>2&&void 0!==h[2]?h[2]:{},a(i),r.subres=Object.assign({tagging:""},r.subres),r.versionId&&(r.subres.versionId=r.versionId),e=this._objectName(e),(s=this._objectRequestParams("PUT",e,r)).successStatuses=[200],i=Object.keys(i).map((function(t){return{Key:t,Value:i[t]}})),l={Tagging:{TagSet:{Tag:i}}},s.mime="xml",s.content=o(l),t.next=13,this.request(s);case 13:return c=t.sent,t.abrupt("return",{res:c.res,status:c.status});case 15:case"end":return t.stop()}}),t,this)})));function e(e,i){return t.apply(this,arguments)}return e}()},{"../utils/checkObjectTag":56,"../utils/obj2xml":76,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.map.js":318,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.keys.js":328}],47:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));i.putSymlink=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r){var s,o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=r||{}).headers=r.headers||{},i=this._escape(this._objectName(i)),this._convertMetaToHeaders(r.meta,r.headers),r.headers["x-oss-symlink-target"]=i,r.subres=Object.assign({symlink:""},r.subres),r.versionId&&(r.subres.versionId=r.versionId),r.storageClass&&(r.headers["x-oss-storage-class"]=r.storageClass),e=this._objectName(e),(s=this._objectRequestParams("PUT",e,r)).successStatuses=[200],t.next=13,this.request(s);case 13:return o=t.sent,t.abrupt("return",{res:o.res});case 15:case"end":return t.stop()}}),t,this)})));function e(e,i,r){return t.apply(this,arguments)}return e}()},{"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.object.assign.js":325}],48:[function(t,e,i){(function(e){(function(){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js");var r=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.signPostObjectPolicyV4=void 0;var n=r(t("dateformat")),s=t("../utils/getStandardRegion"),o=t("../utils/policy2Str"),a=t("../signUtils");function l(t,i){var r=e.from(o.policy2Str(t),"utf8").toString("base64"),l=n.default(i,"UTC:yyyymmdd'T'HHMMss'Z'").split("T")[0];return a.getSignatureV4(this.options.accessKeySecret,l,s.getStandardRegion(this.options.region),r)}i.signPostObjectPolicyV4=l}).call(this)}).call(this,t("buffer").Buffer)},{"../signUtils":52,"../utils/getStandardRegion":65,"../utils/policy2Str":79,buffer:103,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339,dateformat:383}],49:[function(t,e,i){t("core-js/modules/es.regexp.exec.js");var r=t("url"),n=t("utility"),s=t("copy-to"),o=t("../../common/signUtils"),a=t("../utils/isIP").isIP;i.signatureUrl=function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(a(this.options.endpoint.hostname))throw new Error("can not get the object URL when endpoint is IP");if(i&&/^\?/.test(t))throw new Error("Invalid object name ".concat(t));e=e||{},t=this._objectName(t),e.method=e.method||"GET";var l=n.timestamp()+(e.expires||1800),c={bucket:this.options.bucket,object:t},h=this._getResource(c);this.options.stsToken&&(e["security-token"]=this.options.stsToken);var u=o._signatureForURL(this.options.accessKeySecret,e,h,l),d=r.parse(this._getReqUrl(c));return d.query={OSSAccessKeyId:this.options.accessKeyId,Expires:l,Signature:u.Signature},s(u.subResource).to(d.query),d.format()}},{"../../common/signUtils":52,"../utils/isIP":73,"copy-to":107,"core-js/modules/es.regexp.exec.js":338,url:543,utility:545}],50:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.array.join.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("dateformat"),a=t("url"),l=t("../../common/signUtils"),c=t("../utils/setSTSToken").setSTSToken,h=t("../utils/isFunction").isFunction,u=t("../utils/getStandardRegion").getStandardRegion;i.signatureUrlV4=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s,d){var p,f,_,m,g,y,v,b,x,T,C;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=this.options.cloudBoxId,f=l.getProduct(p),_=l.getSignRegion(u(this.options.region),p),m=r&&r.headers||{},g=Object.assign({},r&&r.queries||{}),y=o(new Date,"UTC:yyyymmdd'T'HHMMss'Z'"),v=y.split("T")[0],(b=l.fixAdditionalHeaders(d)).length>0&&(g["x-oss-additional-headers"]=b.join(";")),g["x-oss-credential"]=l.getCredential(v,_,this.options.accessKeyId,f),g["x-oss-date"]=y,g["x-oss-expires"]=i,g["x-oss-signature-version"]="OSS4-HMAC-SHA256",!this.options.stsToken||!h(this.options.refreshSTSToken)){t.next=17;break}return t.next=17,c.call(this);case 17:return this.options.stsToken&&(g["x-oss-security-token"]=this.options.stsToken),x=l.getCanonicalRequest(e,{headers:m,queries:g},this.options.bucket,s,b),T=l.getStringToSign(_,y,x,f),g["x-oss-signature"]=l.getSignatureV4(this.options.accessKeySecret,v,_,T,f),(C=a.parse(this._getReqUrl({bucket:this.options.bucket,object:s}))).query=Object.assign({},g),t.abrupt("return",C.format());case 24:case"end":return t.stop()}}),t,this)})));function e(e,i,r,n,s){return t.apply(this,arguments)}return e}()},{"../../common/signUtils":52,"../utils/getStandardRegion":65,"../utils/isFunction":72,"../utils/setSTSToken":82,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.join.js":317,"core-js/modules/es.object.assign.js":325,dateformat:383,url:543}],51:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.array.iterator.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.string.iterator.js"),t("core-js/modules/web.dom-collections.iterator.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.function.name.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator")),o=t("./utils/isArray").isArray,a=i;a._parallelNode=function(){var t=(0,s.default)(n.default.mark((function t(e,i,r,s){var o,a,l,c,h,u,d,p;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=this,a=[],l=[],c=e.length/i,h=e.length%i,u=0===h?c:(e.length-h)/i+1,d=1,p=0;case 8:if(!(p<e.length)){t.next=26;break}if(!o.isCancel()){t.next=11;break}return t.abrupt("break",26);case 11:if(s?l.push(r(o,e[p],s)):l.push(r(o,e[p])),l.length!==i&&(d!==u||p!==e.length-1)){t.next=23;break}return t.prev=13,d+=1,t.next=17,Promise.all(l);case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(13),a.push(t.t0);case 22:l=[];case 23:p++,t.next=8;break;case 26:return t.abrupt("return",a);case 27:case"end":return t.stop()}}),t,this,[[13,19]])})));function e(e,i,r,n){return t.apply(this,arguments)}return e}(),a._parallel=function(t,e,i){var r=this;return new Promise((function(n){var s=[];if(e<=0||!t)n(s);else{var o=u(t),a=!1,l=0,c=!1;f()}function h(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];e.apply(this,r)}}function u(t){var e=-1,i=t.length;return function(){return++e<i&&!r.isCancel()?{value:t[e],key:e}:null}}function d(t){l-=1,t?(a=!0,s.push(t),n(s)):a&&l<=0?(a=!0,n(s)):c||(r.isCancel()?n(s):f())}function p(t,e){i(t).then((function(t){e(null,t)})).catch((function(t){e(t)}))}function f(){for(c=!0;l<e&&!a&&!r.isCancel();){var t=o();if(null===t||s.length>0)return a=!0,void(l<=0&&n(s));l+=1,p(t.value,h(d))}c=!1}}))},a.cancel=function(t){this.options.cancelFlag=!0,o(this.multipartUploadStreams)&&this.multipartUploadStreams.forEach((function(t){if(!1===t.destroyed){var e={name:"cancel",message:"cancel"};t.destroy(e)}})),this.multipartUploadStreams=[],t&&this.abortMultipartUpload(t.name,t.uploadId,t.options)},a.isCancel=function(){return this.options.cancelFlag},a.resetCancelFlag=function(){this.options.cancelFlag=!1},a._stop=function(){this.options.cancelFlag=!0},a._makeCancelEvent=function(){return{status:0,name:"cancel"}},a._makeAbortEvent=function(){return{status:0,name:"abort",message:"upload task has been abort"}}},{"./utils/isArray":67,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.iterator.js":316,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.string.iterator.js":343,"core-js/modules/web.dom-collections.for-each.js":380,"core-js/modules/web.dom-collections.iterator.js":381}],52:[function(t,e,i){(function(e){(function(){var r=t("@babel/runtime/helpers/interopRequireDefault")(t("@babel/runtime/helpers/toConsumableArray"));t("core-js/modules/es.string.trim.js"),t("core-js/modules/es.array.sort.js"),t("core-js/modules/es.array.join.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.array.filter.js"),t("core-js/modules/es.array.iterator.js"),t("core-js/modules/es.set.js"),t("core-js/modules/es.string.iterator.js"),t("core-js/modules/web.dom-collections.iterator.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.string.starts-with.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.object.entries.js"),t("core-js/modules/es.regexp.to-string.js");var n=t("./../../shims/crypto/crypto.js"),s=t("is-type-of"),o=t("qs"),a=t("./utils/lowercaseKeyHeader").lowercaseKeyHeader,l=t("./utils/encodeString").encodeString;i.getProduct=function(t){return void 0===t?"oss":"oss-cloudbox"},i.getSignRegion=function(t,e){return void 0===e?t:e},i.buildCanonicalizedResource=function(t,e){var i="".concat(t),r="?";if(s.string(e)&&""!==e.trim())i+=r+e;else if(s.array(e))e.sort(),i+=r+e.join("&");else if(e){var n=function(t){i+=r+t,(e[t]||0===e[t])&&(i+="=".concat(e[t])),r="&"};Object.keys(e).sort().forEach(n)}return i},i.buildCanonicalString=function(t,e,i,r){var n=a((i=i||{}).headers),s="x-oss-",o=[],l={},c=[t.toUpperCase(),n["content-md5"]||"",n["content-type"],r||n["x-oss-date"]];return Object.keys(n).forEach((function(t){var e=t.toLowerCase();0===e.indexOf(s)&&(l[e]=String(n[t]).trim())})),Object.keys(l).sort().forEach((function(t){o.push("".concat(t,":").concat(l[t]))})),(c=c.concat(o)).push(this.buildCanonicalizedResource(e,i.parameters)),c.join("\n")},i.computeSignature=function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"utf-8";return n.createHmac("sha1",t).update(e.from(i,r)).digest("base64")},i.authorization=function(t,e,i,r){return"OSS ".concat(t,":").concat(this.computeSignature(e,i,r))},i.fixAdditionalHeaders=function(t){if(!t)return[];var e="x-oss-";return(0,r.default)(new Set(t.map((function(t){return t.toLowerCase()})))).filter((function(t){return"content-type"!==t&&"content-md5"!==t&&!t.startsWith(e)})).sort()},i.getCanonicalRequest=function(t,e,i,n,c){var h=a(e.headers),u=e.queries||{},d="x-oss-";if(n&&!i)throw Error("Please ensure that bucketName is passed into getCanonicalRequest.");var p=[t.toUpperCase(),l("/".concat(i?"".concat(i,"/"):"").concat(n||"")).replace(/%2F/g,"/")];p.push(o.stringify(u,{encoder:l,sort:function(t,e){return t.localeCompare(e)},strictNullHandling:!0})),c&&c.forEach((function(t){if(!Object.prototype.hasOwnProperty.call(h,t))throw Error("Can't find additional header ".concat(t," in request headers."))}));var f=new Set(c);Object.keys(h).forEach((function(t){("content-type"===t||"content-md5"===t||t.startsWith(d))&&f.add(t)}));var _="".concat((0,r.default)(f).sort().map((function(t){return"".concat(t,":").concat(s.string(h[t])?h[t].trim():h[t],"\n")})).join(""));return p.push(_),c&&c.length>0?p.push(c.join(";")):p.push(""),p.push(h["x-oss-content-sha256"]||"UNSIGNED-PAYLOAD"),p.join("\n")},i.getCredential=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"oss",n="".concat(t,"/").concat(e,"/").concat(r,"/aliyun_v4_request");return i?"".concat(i,"/").concat(n):n},i.getStringToSign=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"oss";return["OSS4-HMAC-SHA256",e,this.getCredential(e.split("T")[0],t,void 0,r),n.createHash("sha256").update(i).digest("hex")].join("\n")},i.getSignatureV4=function(t,e,i,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"oss",o=n.createHmac("sha256","aliyun_v4".concat(t)).update(e).digest(),a=n.createHmac("sha256",o).update(i).digest(),l=n.createHmac("sha256",a).update(s).digest(),c=n.createHmac("sha256",l).update("aliyun_v4_request").digest();return n.createHmac("sha256",c).update(r).digest("hex")},i.authorizationV4=function(t,i,r,n,o,a,l,c){var h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"utf-8",u=arguments.length>9?arguments[9]:void 0,d=this.getProduct(u),p=this.fixAdditionalHeaders(c),f={};Object.entries(o.headers).forEach((function(t){f[t[0]]=s.string(t[1])?e.from(t[1],h).toString():t[1]}));var _=f["x-oss-date"]||o.queries&&o.queries["x-oss-date"],m=this.getCanonicalRequest(n,{headers:f,queries:o.queries},a,l,p),g=this.getStringToSign(r,_,m,d),y=_.split("T")[0],v=this.getSignatureV4(i,y,r,g,d),b=p.length>0?"AdditionalHeaders=".concat(p.join(";"),","):"";return"OSS4-HMAC-SHA256 Credential=".concat(this.getCredential(y,r,t,d),",").concat(b,"Signature=").concat(v)},i._signatureForURL=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o={},a=i.subResource,l=void 0===a?{}:a;if(i.process&&(l["x-oss-process"]=i.process),i.trafficLimit&&(l["x-oss-traffic-limit"]=i.trafficLimit),i.response&&Object.keys(i.response).forEach((function(t){var e="response-".concat(t.toLowerCase());l[e]=i.response[t]})),Object.keys(i).forEach((function(t){var e=t.toLowerCase(),r=i[t];0===e.indexOf("x-oss-")?o[e]=r:(0===e.indexOf("content-md5")||0===e.indexOf("content-type"))&&(o[t]=r)})),Object.prototype.hasOwnProperty.call(i,"security-token")&&(l["security-token"]=i["security-token"]),Object.prototype.hasOwnProperty.call(i,"callback")){var c={callbackUrl:encodeURI(i.callback.url),callbackBody:i.callback.body};if(i.callback.host&&(c.callbackHost=i.callback.host),i.callback.contentType&&(c.callbackBodyType=i.callback.contentType),i.callback.callbackSNI&&(c.callbackSNI=i.callback.callbackSNI),l.callback=e.from(JSON.stringify(c)).toString("base64"),i.callback.customValue){var h={};Object.keys(i.callback.customValue).forEach((function(t){h["x:".concat(t)]=i.callback.customValue[t]})),l["callback-var"]=e.from(JSON.stringify(h)).toString("base64")}}var u=this.buildCanonicalString(i.method,r,{headers:o,parameters:l},n.toString());return{Signature:this.computeSignature(t,u,s),subResource:l}}}).call(this)}).call(this,t("buffer").Buffer)},{"./../../shims/crypto/crypto.js":531,"./utils/encodeString":61,"./utils/lowercaseKeyHeader":75,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/toConsumableArray":90,buffer:103,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.filter.js":312,"core-js/modules/es.array.iterator.js":316,"core-js/modules/es.array.join.js":317,"core-js/modules/es.array.map.js":318,"core-js/modules/es.array.sort.js":320,"core-js/modules/es.object.entries.js":326,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.set.js":341,"core-js/modules/es.string.iterator.js":343,"core-js/modules/es.string.replace.js":345,"core-js/modules/es.string.starts-with.js":348,"core-js/modules/es.string.trim.js":349,"core-js/modules/web.dom-collections.for-each.js":380,"core-js/modules/web.dom-collections.iterator.js":381,"is-type-of":537,qs:445}],53:[function(t,e,i){t("core-js/modules/es.regexp.exec.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.checkBucketName=void 0,i.checkBucketName=function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?/^[a-z0-9][a-z0-9-]{1,61}[a-z0-9]$/:/^[a-z0-9_][a-z0-9-_]{1,61}[a-z0-9_]$/).test(t))throw new Error("The bucket must be conform to the specifications")}},{"core-js/modules/es.regexp.exec.js":338}],54:[function(t,e,i){t("core-js/modules/es.regexp.exec.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.checkConfigValid=void 0;var r={endpoint:n,region:/^[a-zA-Z0-9\-_]+$/};function n(t){return"string"==typeof t?/^[a-zA-Z0-9._:/-]+$/.test(t):!!t.host&&/^[a-zA-Z0-9._:/-]+$/.test(t.host)}i.checkConfigValid=function(t,e){if(r[e]&&!(r[e]instanceof Function?r[e](t):r[e].test(t)))throw new Error("The ".concat(e," must be conform to the specifications"))}},{"core-js/modules/es.regexp.exec.js":338}],55:[function(t,e,i){(function(t){(function(){function e(e){t.browser&&console.warn(e)}Object.defineProperty(i,"__esModule",{value:!0}),i.checkEnv=void 0,i.checkEnv=e}).call(this)}).call(this,t("_process"))},{_process:538}],56:[function(t,e,i){t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.object.entries.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.checkObjectTag=void 0;var r=t("./checkValid").checkValid,n=t("./isObject").isObject,s=[{validator:function(t){if("string"!=typeof t)throw new Error("the key and value of the tag must be String")}},{pattern:/^[a-zA-Z0-9 +-=._:/]+$/,msg:"tag can contain letters, numbers, spaces, and the following symbols: plus sign (+), hyphen (-), equal sign (=), period (.), underscore (_), colon (:), and forward slash (/)"}],o={key:[].concat(s,[{pattern:/^.{1,128}$/,msg:"tag key can be a maximum of 128 bytes in length"}]),value:[].concat(s,[{pattern:/^.{0,256}$/,msg:"tag value can be a maximum of 256 bytes in length"}])};function a(t){if(!n(t))throw new Error("tag must be Object");var e=Object.entries(t);if(e.length>10)throw new Error("maximum of 10 tags for a object");var i=["key","value"];e.forEach((function(t){t.forEach((function(t,e){r(t,o[i[e]])}))}))}i.checkObjectTag=a},{"./checkValid":57,"./isObject":74,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.object.entries.js":326,"core-js/modules/es.object.to-string.js":329,"core-js/modules/web.dom-collections.for-each.js":380}],57:[function(t,e,i){function r(t,e){e.forEach((function(e){if(e.validator)e.validator(t);else if(e.pattern&&!e.pattern.test(t))throw new Error(e.msg)}))}t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.regexp.exec.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.checkValid=void 0,i.checkValid=r},{"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/web.dom-collections.for-each.js":380}],58:[function(t,e,i){(function(e){(function(){t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.string.includes.js"),t("core-js/modules/es.object.assign.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.entries.js"),t("core-js/modules/es.array.concat.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.createRequest=void 0;var r=t("./../../../shims/crypto/crypto.js"),n=t("debug")("ali-oss"),s=t("lodash/isString"),o=t("lodash/isArray"),a=t("lodash/isObject"),l=t("mime"),c=t("dateformat"),h=t("copy-to"),u=t("path"),d=t("./encoder").encoder,p=t("./isIP").isIP,f=t("./setRegion").setRegion,_=t("../client/getReqUrl").getReqUrl,m=t("./isDingTalk").isDingTalk;function g(t,e){return t[e]||t[e.toLowerCase()]}function y(t,e){delete t[e],delete t[e.toLowerCase()]}function v(t){var i=new Date;this.options.amendTimeSkewed&&(i=+new Date+this.options.amendTimeSkewed);var v={"x-oss-date":c(i,this.options.authorizationV4?"UTC:yyyymmdd'T'HHMMss'Z'":"UTC:ddd, dd mmm yyyy HH:MM:ss 'GMT'")};this.options.authorizationV4&&(v["x-oss-content-sha256"]="UNSIGNED-PAYLOAD"),"undefined"!=typeof window&&(v["x-oss-user-agent"]=this.userAgent),this.userAgent.includes("nodejs")&&(v["User-Agent"]=this.userAgent),this.options.isRequestPay&&Object.assign(v,{"x-oss-request-payer":"requester"}),this.options.stsToken&&(v["x-oss-security-token"]=this.options.stsToken),h(t.headers).to(v),g(v,"Content-Type")||(t.mime&&t.mime.indexOf("/")>0?v["Content-Type"]=t.mime:m()?v["Content-Type"]="application/octet-stream":v["Content-Type"]=l.getType(t.mime||u.extname(t.object||""))),g(v,"Content-Type")||y(v,"Content-Type"),t.content&&(t.disabledMD5||(t.headers&&t.headers["Content-MD5"]?v["Content-MD5"]=t.headers["Content-MD5"]:v["Content-MD5"]=r.createHash("md5").update(e.from(t.content,"utf8")).digest("base64")),v["Content-Length"]||(v["Content-Length"]=t.content.length));var b=Object.prototype.hasOwnProperty;for(var x in v)v[x]&&b.call(v,x)&&(v[x]=d(String(v[x]),this.options.headerEncoding));var T={};if(s(t.subres)?T[t.subres]=null:o(t.subres)?t.subres.forEach((function(t){T[t]=null})):a(t.subres)&&Object.entries(t.subres).forEach((function(t){T[t[0]]=""===t[1]?null:t[1]})),a(t.query)&&Object.entries(t.query).forEach((function(t){T[t[0]]=t[1]})),v.authorization=this.options.authorizationV4?this.authorizationV4(t.method,{headers:v,queries:T},t.bucket,t.object,t.additionalHeaders):this.authorization(t.method,this._getResource(t),t.subres,v,this.options.headerEncoding),p(this.options.endpoint.hostname)){var C=this.options,S=C.region,w=C.internal,A=C.secure,E=f(S,w,A);v.host="".concat(t.bucket,".").concat(E.host)}var D=_.bind(this)(t);n("request %s %s, with headers %j, !!stream: %s",t.method,D,v,!!t.stream);var L=t.timeout||this.options.timeout,I={method:t.method,content:t.content,stream:t.stream,headers:v,timeout:L,writeStream:t.writeStream,customResponse:t.customResponse,ctx:t.ctx||this.ctx};return this.agent&&(I.agent=this.agent),this.httpsAgent&&(I.httpsAgent=this.httpsAgent),I.enableProxy=!!this.options.enableProxy,I.proxy=this.options.proxy?this.options.proxy:null,{url:D,params:I}}i.createRequest=v}).call(this)}).call(this,t("buffer").Buffer)},{"../client/getReqUrl":25,"./../../../shims/crypto/crypto.js":531,"./encoder":62,"./isDingTalk":70,"./isIP":73,"./setRegion":81,buffer:103,"copy-to":107,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.entries.js":326,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.string.includes.js":342,"core-js/modules/web.dom-collections.for-each.js":380,dateformat:383,debug:536,"lodash/isArray":422,"lodash/isObject":423,"lodash/isString":425,mime:430,path:439}],59:[function(t,e,i){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.entries.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.object.keys.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.dataFix=void 0;var r=t("./isObject"),n=["true","TRUE","1",1],s=["false","FALSE","0",0];function o(t,e,i){if(r.isObject(t)){var n=e.remove,s=void 0===n?[]:n,c=e.rename,h=void 0===c?{}:c,u=e.camel,d=void 0===u?[]:u,p=e.bool,f=void 0===p?[]:p,_=e.lowerFirst,m=void 0!==_&&_;return s.forEach((function(e){return delete t[e]})),Object.entries(h).forEach((function(e){t[e[0]]&&(t[e[1]]||(t[e[1]]=t[e[0]],delete t[e[0]]))})),d.forEach((function(e){if(t[e]){var i=e.replace(/^(.)/,(function(t){return t.toLowerCase()})).replace(/-(\w)/g,(function(t,e){return e.toUpperCase()}));t[i]||(t[i]=t[e])}})),f.forEach((function(e){t[e]=a(t[e])})),"function"==typeof i&&i(t),l(t,m),o}}function a(t){return!!t&&(!!n.includes(t)||!s.includes(t)&&t)}function l(t,e){e&&Object.keys(t).forEach((function(e){var i=e.replace(/^\w/,(function(t){return t.toLowerCase()}));void 0===t[i]&&(t[i]=t[e],delete t[e])}))}i.dataFix=o},{"./isObject":74,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.object.entries.js":326,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380}],60:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault");t("core-js/modules/es.array.slice.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js");var n=r(t("@babel/runtime/helpers/typeof"));Object.defineProperty(i,"__esModule",{value:!0}),i.deepCopyWith=i.deepCopy=void 0;var s=t("./isBuffer");i.deepCopy=function(t){if(null===t||"object"!==(0,n.default)(t))return t;if(s.isBuffer(t))return t.slice();var e=Array.isArray(t)?[]:{};return Object.keys(t).forEach((function(r){e[r]=i.deepCopy(t[r])})),e},i.deepCopyWith=function(t,e){function r(t,i,o){var a=e(t,i,o);if(void 0!==a)return a;if(null===t||"object"!==(0,n.default)(t))return t;if(s.isBuffer(t))return t.slice();var l=Array.isArray(t)?[]:{};return Object.keys(t).forEach((function(e){l[e]=r(t[e],e,t)})),l}return e?r(t,"",null):i.deepCopy(t)}},{"./isBuffer":69,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/web.dom-collections.for-each.js":380}],61:[function(t,e,i){t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js");var r=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.encodeString=void 0;var n=r(t("lodash/toString"));function s(t){var e=n.default(t);return encodeURIComponent(e).replace(/[!'()*]/g,(function(t){return"%".concat(t.charCodeAt(0).toString(16).toUpperCase())}))}i.encodeString=s},{"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.replace.js":345,"lodash/toString":427}],62:[function(t,e,i){(function(e){(function(){function r(t){return"utf-8"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8")?t:e.from(t).toString("latin1")}t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.encoder=void 0,i.encoder=r}).call(this)}).call(this,t("buffer").Buffer)},{buffer:103,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339}],63:[function(t,e,i){t("core-js/modules/es.array.map.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.formatInventoryConfig=void 0;var r=t("../utils/dataFix"),n=t("../utils/isObject"),s=t("../utils/isArray"),o=t("../utils/formatObjKey");function a(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&n.isObject(t)&&(t=[t]),t=s.isArray(t)?t.map(l):l(t)}function l(t){return r.dataFix(t,{bool:["IsEnabled"]},(function(t){var e,i;t.prefix=t.Filter.Prefix,delete t.Filter,t.OSSBucketDestination=t.Destination.OSSBucketDestination,t.OSSBucketDestination.rolename=t.OSSBucketDestination.RoleArn.replace(/.*\//,""),delete t.OSSBucketDestination.RoleArn,t.OSSBucketDestination.bucket=t.OSSBucketDestination.Bucket.replace(/.*:::/,""),delete t.OSSBucketDestination.Bucket,delete t.Destination,t.frequency=t.Schedule.Frequency,delete t.Schedule.Frequency,(null===(e=null==t?void 0:t.OptionalFields)||void 0===e?void 0:e.Field)&&!s.isArray(null===(i=t.OptionalFields)||void 0===i?void 0:i.Field)&&(t.OptionalFields.Field=[t.OptionalFields.Field])})),t=o.formatObjKey(t,"firstLowerCase",{exclude:["OSSBucketDestination","SSE-OSS","SSE-KMS"]})}i.formatInventoryConfig=a},{"../utils/dataFix":59,"../utils/formatObjKey":64,"../utils/isArray":67,"../utils/isObject":74,"core-js/modules/es.array.map.js":318,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345}],64:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault");t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.string.includes.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js");var n=r(t("@babel/runtime/helpers/typeof"));function s(t,e,i){if(null===t||"object"!==(0,n.default)(t))return t;var r;if(Array.isArray(t)){r=[];for(var a=0;a<t.length;a++)r.push(s(t[a],e,i))}else r={},Object.keys(t).forEach((function(n){r[o(n,e,i)]=s(t[n],e,i)}));return r}function o(t,e,i){return i&&i.exclude&&i.exclude.includes(t)||("firstUpperCase"===e?t=t.replace(/^./,(function(t){return t.toUpperCase()})):"firstLowerCase"===e&&(t=t.replace(/^./,(function(t){return t.toLowerCase()})))),t}Object.defineProperty(i,"__esModule",{value:!0}),i.formatObjKey=void 0,i.formatObjKey=s},{"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.includes.js":342,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380}],65:[function(t,e,i){function r(t){return t.replace(/^oss-/g,"")}t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.getStandardRegion=void 0,i.getStandardRegion=r},{"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.replace.js":345}],66:[function(t,e,i){function r(t){for(var e=0,i=0;i<t.length;i++){var r=t.charAt(i);/^[\u00-\uff]$/.test(r)?e+=1:e+=2}return e}t("core-js/modules/es.regexp.exec.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.getStrBytesCount=void 0,i.getStrBytesCount=r},{"core-js/modules/es.regexp.exec.js":338}],67:[function(t,e,i){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.isArray=void 0,i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339}],68:[function(t,e,i){function r(t){return"undefined"!=typeof Blob&&t instanceof Blob}Object.defineProperty(i,"__esModule",{value:!0}),i.isBlob=void 0,i.isBlob=r},{}],69:[function(t,e,i){(function(t){(function(){function e(e){return t.isBuffer(e)}Object.defineProperty(i,"__esModule",{value:!0}),i.isBuffer=void 0,i.isBuffer=e}).call(this)}).call(this,{isBuffer:t("../../../node_modules/is-buffer/index.js")})},{"../../../node_modules/is-buffer/index.js":409}],70:[function(t,e,i){(function(e){(function(){function r(){return!(!e.browser||!window.navigator.userAgent.toLowerCase().includes("aliapp(dingtalk"))}t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.string.includes.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.isDingTalk=void 0,i.isDingTalk=r}).call(this)}).call(this,t("_process"))},{_process:538,"core-js/modules/es.array.includes.js":315,"core-js/modules/es.string.includes.js":342}],71:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isFile=void 0,i.isFile=function(t){return"undefined"!=typeof File&&t instanceof File}},{}],72:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isFunction=void 0,i.isFunction=function(t){return"function"==typeof t}},{}],73:[function(t,e,i){t("core-js/modules/es.regexp.exec.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.isIP=void 0,i.isIP=function(t){var e=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;return/^(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}$/.test(t)||e.test(t)}},{"core-js/modules/es.regexp.exec.js":338}],74:[function(t,e,i){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.isObject=void 0,i.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339}],75:[function(t,e,i){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.lowercaseKeyHeader=void 0;var r=t("./isObject");function n(t){var e={};return r.isObject(t)&&Object.keys(t).forEach((function(i){e[i.toLowerCase()]=t[i]})),e}i.lowercaseKeyHeader=n},{"./isObject":74,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/web.dom-collections.for-each.js":380}],76:[function(t,e,i){t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.array.join.js"),t("core-js/modules/es.array.map.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.obj2xml=void 0;var r=t("./formatObjKey");function n(t){return Object.prototype.toString.call(t).replace(/(.*? |])/g,"").toLowerCase()}function s(t,e){var i="";return e&&e.headers&&(i='<?xml version="1.0" encoding="UTF-8"?>\n'),e&&e.firstUpperCase&&(t=r.formatObjKey(t,"firstUpperCase")),"object"===n(t)?Object.keys(t).forEach((function(e){"undefined"!==n(t[e])&&"null"!==n(t[e])&&("string"===n(t[e])||"number"===n(t[e])?i+="<".concat(e,">").concat(t[e],"</").concat(e,">"):"object"===n(t[e])?i+="<".concat(e,">").concat(s(t[e]),"</").concat(e,">"):"array"===n(t[e])?i+=t[e].map((function(t){return"<".concat(e,">").concat(s(t),"</").concat(e,">")})).join(""):i+="<".concat(e,">").concat(t[e].toString(),"</").concat(e,">"))})):i+=t.toString(),i}i.obj2xml=s},{"./formatObjKey":64,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.join.js":317,"core-js/modules/es.array.map.js":318,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.replace.js":345,"core-js/modules/web.dom-collections.for-each.js":380}],77:[function(t,e,i){function r(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e){i&&(t=i);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){l=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw o}}}}function n(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function o(t,e){var i,n=Object.assign({},t),s=r(e);try{for(s.s();!(i=s.n()).done;)delete n[i.value]}catch(o){s.e(o)}finally{s.f()}return n}t("core-js/modules/es.array.slice.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/es.function.name.js"),t("core-js/modules/es.array.from.js"),t("core-js/modules/es.string.iterator.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.symbol.js"),t("core-js/modules/es.symbol.description.js"),t("core-js/modules/es.symbol.iterator.js"),t("core-js/modules/es.array.iterator.js"),t("core-js/modules/web.dom-collections.iterator.js"),t("core-js/modules/es.object.assign.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.omit=void 0,i.omit=o},{"core-js/modules/es.array.from.js":314,"core-js/modules/es.array.iterator.js":316,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.iterator.js":343,"core-js/modules/es.symbol.description.js":351,"core-js/modules/es.symbol.iterator.js":353,"core-js/modules/es.symbol.js":354,"core-js/modules/web.dom-collections.iterator.js":381}],78:[function(t,e,i){t("core-js/modules/es.array.includes.js"),t("core-js/modules/es.string.includes.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.match.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.parseRestoreInfo=void 0,i.parseRestoreInfo=function(t){var e;if(t&&!(e={ongoingRequest:t.includes("true")}).ongoingRequest){var i=t.match(/expiry-date="(.*)"/);i&&i[1]&&(e.expiryDate=new Date(i[1]))}return e}},{"core-js/modules/es.array.includes.js":315,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.includes.js":342,"core-js/modules/es.string.match.js":344}],79:[function(t,e,i){function r(t){var e;if(t)if("string"==typeof t)try{e=JSON.stringify(JSON.parse(t))}catch(i){throw new Error("Policy string is not a valid JSON: ".concat(i.message))}else e=JSON.stringify(t);return e}t("core-js/modules/es.object.keys.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.policy2Str=void 0,i.policy2Str=r},{"core-js/modules/es.object.keys.js":328}],80:[function(t,e,i){function r(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=0,n=i.retryDelay,s=void 0===n?500:n,o=i.errorHandler,a=void 0===o?function(){return!0}:o,l=function i(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return new Promise((function(n,l){t.apply(void 0,o).then((function(t){r=0,n(t)})).catch((function(t){r<e&&a(t)?(r++,setTimeout((function(){n(i.apply(void 0,o))}),s)):(r=0,l(t))}))}))};return l}t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),Object.defineProperty(i,"__esModule",{value:!0}),i.retry=void 0,i.retry=r},{"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333}],81:[function(t,e,i){var r=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.setRegion=void 0;var n=r(t("url")),s=t("./checkConfigValid");function o(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.checkConfigValid(t,"region");var r=i?"https://":"http://",o=e?"-internal.aliyuncs.com":".aliyuncs.com",a="vpc100-oss-cn-";return t.substr(0,a.length)===a&&(o=".aliyuncs.com"),n.default.parse(r+t+o)}i.setRegion=o},{"./checkConfigValid":54,url:543}],82:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault"),n=r(t("@babel/runtime/regenerator"));t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.array.find.js"),t("core-js/modules/es.object.assign.js");var s=r(t("@babel/runtime/helpers/asyncToGenerator"));Object.defineProperty(i,"__esModule",{value:!0}),i.checkCredentials=i.setSTSToken=void 0;var o=t("./formatObjKey");function a(){return l.apply(this,arguments)}function l(){return(l=(0,s.default)(n.default.mark((function t(){var e,i;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.options||(this.options={}),e=new Date,!this.stsTokenFreshTime){t.next=14;break}if(!(+e-this.stsTokenFreshTime>=this.options.refreshSTSTokenInterval)){t.next=12;break}return this.stsTokenFreshTime=e,t.next=7,this.options.refreshSTSToken();case 7:i=t.sent,(i=o.formatObjKey(i,"firstLowerCase")).securityToken&&(i.stsToken=i.securityToken),c(i),Object.assign(this.options,i);case 12:t.next=15;break;case 14:this.stsTokenFreshTime=e;case 15:return t.abrupt("return",null);case 16:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function c(t){var e=["accessKeySecret","accessKeyId","stsToken"],i=Object.keys(t);e.forEach((function(t){if(!i.find((function(e){return e===t})))throw Error("refreshSTSToken must return contains ".concat(t))}))}i.setSTSToken=a,i.checkCredentials=c},{"./formatObjKey":64,"@babel/runtime/helpers/asyncToGenerator":85,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/regenerator":93,"core-js/modules/es.array.find.js":313,"core-js/modules/es.object.assign.js":325,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329}],83:[function(t,e,i){function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},{}],84:[function(t,e,i){var r=t("./arrayLikeToArray.js");function n(t){if(Array.isArray(t))return r(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},{"./arrayLikeToArray.js":83}],85:[function(t,e,i){function r(t,e,i,r,n,s,o){try{var a=t[s](o),l=a.value}catch(c){return void i(c)}a.done?e(l):Promise.resolve(l).then(r,n)}function n(t){return function(){var e=this,i=arguments;return new Promise((function(n,s){var o=t.apply(e,i);function a(t){r(o,n,s,a,l,"next",t)}function l(t){r(o,n,s,a,l,"throw",t)}a(void 0)}))}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},{}],86:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},{}],87:[function(t,e,i){function r(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},{}],88:[function(t,e,i){function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},{}],89:[function(t,e,i){var r=t("./typeof.js").default;function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=n=function(){return i},e.exports.__esModule=!0,e.exports.default=e.exports;var t,i={},s=Object.prototype,o=s.hasOwnProperty,a=Object.defineProperty||function(t,e,i){t[e]=i.value},l="function"==typeof Symbol?Symbol:{},c=l.iterator||"@@iterator",h=l.asyncIterator||"@@asyncIterator",u=l.toStringTag||"@@toStringTag";function d(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(B){d=function(t,e,i){return t[e]=i}}function p(t,e,i,r){var n=e&&e.prototype instanceof b?e:b,s=Object.create(n.prototype),o=new R(r||[]);return a(s,"_invoke",{value:L(t,i,o)}),s}function f(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(r){return{type:"throw",arg:r}}}i.wrap=p;var _="suspendedStart",m="suspendedYield",g="executing",y="completed",v={};function b(){}function x(){}function T(){}var C={};d(C,c,(function(){return this}));var S=Object.getPrototypeOf,w=S&&S(S(O([])));w&&w!==s&&o.call(w,c)&&(C=w);var A=T.prototype=b.prototype=Object.create(C);function E(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function D(t,e){function i(n,s,a,l){var c=f(t[n],t,s);if("throw"!==c.type){var h=c.arg,u=h.value;return u&&"object"==r(u)&&o.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,l)}),(function(t){i("throw",t,a,l)})):e.resolve(u).then((function(t){h.value=t,a(h)}),(function(t){return i("throw",t,a,l)}))}l(c.arg)}var n;a(this,"_invoke",{value:function(t,r){function s(){return new e((function(e,n){i(t,r,e,n)}))}return n=n?n.then(s,s):s()}})}function L(e,i,r){var n=_;return function(s,o){if(n===g)throw new Error("Generator is already running");if(n===y){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var l=I(a,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===_)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=g;var c=f(e,i,r);if("normal"===c.type){if(n=r.done?y:m,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=y,r.method="throw",r.arg=c.arg)}}}function I(e,i){var r=i.method,n=e.iterator[r];if(n===t)return i.delegate=null,"throw"===r&&e.iterator.return&&(i.method="return",i.arg=t,I(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=f(n,e.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,v;var o=s.arg;return o?o.done?(i[e.resultName]=o.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,v):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function O(e){if(e||""===e){var i=e[c];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function i(){for(;++n<e.length;)if(o.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return s.next=s}}throw new TypeError(r(e)+" is not iterable")}return x.prototype=T,a(A,"constructor",{value:T,configurable:!0}),a(T,"constructor",{value:x,configurable:!0}),x.displayName=d(T,u,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,T):(t.__proto__=T,d(t,u,"GeneratorFunction")),t.prototype=Object.create(A),t},i.awrap=function(t){return{__await:t}},E(D.prototype),d(D.prototype,h,(function(){return this})),i.AsyncIterator=D,i.async=function(t,e,r,n,s){void 0===s&&(s=Promise);var o=new D(p(t,e,r,n),s);return i.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},E(A),d(A,u,"Generator"),d(A,c,(function(){return this})),d(A,"toString",(function(){return"[object Generator]"})),i.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},i.values=O,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(r,n){return a.type="throw",a.arg=e,i.next=r,n&&(i.method="next",i.arg=t),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=o.call(s,"catchLoc"),c=o.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var s=n?n.completion:{};return s.type=t,s.arg=e,n?(this.method="next",this.next=n.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),M(i),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;M(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={iterator:O(e),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=t),v}},i}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},{"./typeof.js":91}],90:[function(t,e,i){var r=t("./arrayWithoutHoles.js"),n=t("./iterableToArray.js"),s=t("./unsupportedIterableToArray.js"),o=t("./nonIterableSpread.js");function a(t){return r(t)||n(t)||s(t)||o()}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},{"./arrayWithoutHoles.js":84,"./iterableToArray.js":87,"./nonIterableSpread.js":88,"./unsupportedIterableToArray.js":92}],91:[function(t,e,i){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},{}],92:[function(t,e,i){var r=t("./arrayLikeToArray.js");function n(t,e){if(t){if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},{"./arrayLikeToArray.js":83}],93:[function(t,e,i){var r=t("../helpers/regeneratorRuntime")();e.exports=r;try{regeneratorRuntime=r}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},{"../helpers/regeneratorRuntime":89}],94:[function(t,e,i){function r(){}e.exports=r,e.exports.HttpsAgent=r},{}],95:[function(t,r,n){(function(i){(function(){var n=t("object.assign/polyfill")();
/*!
      		           * The buffer module from node.js, for the browser.
      		           *
      		           * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
      		           * @license  MIT
      		           */function s(t,e){if(t===e)return 0;for(var i=t.length,r=e.length,n=0,s=Math.min(i,r);n<s;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0}function o(t){return i.Buffer&&"function"==typeof i.Buffer.isBuffer?i.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var a=t("util/"),l=Object.prototype.hasOwnProperty,c=Array.prototype.slice,h="foo"===function(){}.name;function u(t){return Object.prototype.toString.call(t)}function d(t){return!o(t)&&"function"==typeof i.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var p=r.exports=b,f=/\s*function\s+([^\(\s]*)\s*/;function _(t){if(a.isFunction(t)){if(h)return t.name;var e=t.toString().match(f);return e&&e[1]}}function m(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function g(t){if(h||!a.isFunction(t))return a.inspect(t);var e=_(t);return"[Function"+(e?": "+e:"")+"]"}function y(t){return m(g(t.actual),128)+" "+t.operator+" "+m(g(t.expected),128)}function v(t,e,i,r,n){throw new p.AssertionError({message:i,actual:t,expected:e,operator:r,stackStartFunction:n})}function b(t,e){t||v(t,!0,e,"==",p.ok)}function x(t,e,i,r){if(t===e)return!0;if(o(t)&&o(e))return 0===s(t,e);if(a.isDate(t)&&a.isDate(e))return t.getTime()===e.getTime();if(a.isRegExp(t)&&a.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(d(t)&&d(e)&&u(t)===u(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===s(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(o(t)!==o(e))return!1;var n=(r=r||{actual:[],expected:[]}).actual.indexOf(t);return-1!==n&&n===r.expected.indexOf(e)||(r.actual.push(t),r.expected.push(e),C(t,e,i,r))}return i?t===e:t==e}function T(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function C(t,e,i,r){if(null==t||null==e)return!1;if(a.isPrimitive(t)||a.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=T(t),s=T(e);if(n&&!s||!n&&s)return!1;if(n)return x(t=c.call(t),e=c.call(e),i);var o,l,h=L(t),u=L(e);if(h.length!==u.length)return!1;for(h.sort(),u.sort(),l=h.length-1;l>=0;l--)if(h[l]!==u[l])return!1;for(l=h.length-1;l>=0;l--)if(!x(t[o=h[l]],e[o],i,r))return!1;return!0}function S(t,e,i){x(t,e,!0)&&v(t,e,i,"notDeepStrictEqual",S)}function w(t,i){if(!t||!i)return!1;if("[object RegExp]"==Object.prototype.toString.call(i))return i.test(t);try{if(t instanceof i)return!0}catch(e){}return!Error.isPrototypeOf(i)&&!0===i.call({},t)}function A(t){var i;try{t()}catch(e){i=e}return i}function E(t,e,i,r){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(r=i,i=null),n=A(e),r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:"."),t&&!n&&v(n,i,"Missing expected exception"+r);var s="string"==typeof r,o=!t&&n&&!i;if((!t&&a.isError(n)&&s&&w(n,i)||o)&&v(n,i,"Got unwanted exception"+r),t&&n&&i&&!w(n,i)||!t&&n)throw n}function D(t,e){t||v(t,!0,e,"==",D)}p.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=y(this),this.generatedMessage=!0);var e=t.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var r=i.stack,n=_(e),s=r.indexOf("\n"+n);if(s>=0){var o=r.indexOf("\n",s+1);r=r.substring(o+1)}this.stack=r}}},a.inherits(p.AssertionError,Error),p.fail=v,p.ok=b,p.equal=function(t,e,i){t!=e&&v(t,e,i,"==",p.equal)},p.notEqual=function(t,e,i){t==e&&v(t,e,i,"!=",p.notEqual)},p.deepEqual=function(t,e,i){x(t,e,!1)||v(t,e,i,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(t,e,i){x(t,e,!0)||v(t,e,i,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(t,e,i){x(t,e,!1)&&v(t,e,i,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=S,p.strictEqual=function(t,e,i){t!==e&&v(t,e,i,"===",p.strictEqual)},p.notStrictEqual=function(t,e,i){t===e&&v(t,e,i,"!==",p.notStrictEqual)},p.throws=function(t,e,i){E(!0,t,e,i)},p.doesNotThrow=function(t,e,i){E(!1,t,e,i)},p.ifError=function(t){if(t)throw t},p.strict=n(D,p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var L=Object.keys||function(t){var e=[];for(var i in t)l.call(t,i)&&e.push(i);return e}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object.assign/polyfill":438,"util/":98}],96:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],97:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],98:[function(t,e,r){(function(e,i){(function(){var n=/%[sdj%]/g;r.format=function(t){if(!T(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var r=arguments,s=r.length,o=String(t).replace(n,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return t}})),l=r[i];i<s;l=r[++i])v(l)||!A(l)?o+=" "+l:o+=" "+a(l);return o},r.deprecate=function(t,n){if(S(i.process))return function(){return r.deprecate(t,n).apply(this,arguments)};if(!0===e.noDeprecation)return t;var s=!1;function o(){if(!s){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),s=!0}return t.apply(this,arguments)}return o};var s,o={};function a(t,e){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),y(e)?i.showHidden=e:e&&r._extend(i,e),S(i.showHidden)&&(i.showHidden=!1),S(i.depth)&&(i.depth=2),S(i.colors)&&(i.colors=!1),S(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),u(i,t,i.depth)}function l(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function c(t,e){return t}function h(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}function u(t,e,i){if(t.customInspect&&e&&L(e.inspect)&&e.inspect!==r.inspect&&(!e.constructor||e.constructor.prototype!==e)){var n=e.inspect(i,t);return T(n)||(n=u(t,n,i)),n}var s=d(t,e);if(s)return s;var o=Object.keys(e),a=h(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),D(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(e);if(0===o.length){if(L(e)){var l=e.name?": "+e.name:"";return t.stylize("[Function"+l+"]","special")}if(w(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(E(e))return t.stylize(Date.prototype.toString.call(e),"date");if(D(e))return p(e)}var c,y="",v=!1,b=["{","}"];return g(e)&&(v=!0,b=["[","]"]),L(e)&&(y=" [Function"+(e.name?": "+e.name:"")+"]"),w(e)&&(y=" "+RegExp.prototype.toString.call(e)),E(e)&&(y=" "+Date.prototype.toUTCString.call(e)),D(e)&&(y=" "+p(e)),0!==o.length||v&&0!=e.length?i<0?w(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),c=v?f(t,e,i,a,o):o.map((function(r){return _(t,e,i,a,r,v)})),t.seen.pop(),m(c,y,b)):b[0]+y+b[1]}function d(t,e){if(S(e))return t.stylize("undefined","undefined");if(T(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return x(e)?t.stylize(""+e,"number"):y(e)?t.stylize(""+e,"boolean"):v(e)?t.stylize("null","null"):void 0}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,i,r,n){for(var s=[],o=0,a=e.length;o<a;++o)B(e,String(o))?s.push(_(t,e,i,r,String(o),!0)):s.push("");return n.forEach((function(n){n.match(/^\d+$/)||s.push(_(t,e,i,r,n,!0))})),s}function _(t,e,i,r,n,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),B(r,n)||(o="["+n+"]"),a||(t.seen.indexOf(l.value)<0?(a=v(i)?u(t,l.value,null):u(t,l.value,i-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),S(o)){if(s&&n.match(/^\d+$/))return a;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function m(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function g(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function v(t){return null===t}function b(t){return null==t}function x(t){return"number"==typeof t}function T(t){return"string"==typeof t}function C(t){return"symbol"==typeof t}function S(t){return void 0===t}function w(t){return A(t)&&"[object RegExp]"===P(t)}function A(t){return"object"==typeof t&&null!==t}function E(t){return A(t)&&"[object Date]"===P(t)}function D(t){return A(t)&&("[object Error]"===P(t)||t instanceof Error)}function L(t){return"function"==typeof t}function I(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function P(t){return Object.prototype.toString.call(t)}function M(t){return t<10?"0"+t.toString(10):t.toString(10)}r.debuglog=function(t){if(S(s)&&(s=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var i=e.pid;o[t]=function(){var e=r.format.apply(r,arguments);console.error("%s %d: %s",t,i,e)}}else o[t]=function(){};return o[t]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=g,r.isBoolean=y,r.isNull=v,r.isNullOrUndefined=b,r.isNumber=x,r.isString=T,r.isSymbol=C,r.isUndefined=S,r.isRegExp=w,r.isObject=A,r.isDate=E,r.isError=D,r.isFunction=L,r.isPrimitive=I,r.isBuffer=t("./support/isBuffer");var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var t=new Date,e=[M(t.getHours()),M(t.getMinutes()),M(t.getSeconds())].join(":");return[t.getDate(),R[t.getMonth()],e].join(" ")}function B(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.log=function(){console.log("%s - %s",O(),r.format.apply(r,arguments))},r.inherits=t("inherits"),r._extend=function(t,e){if(!e||!A(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t}}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":97,_process:538,inherits:96}],99:[function(t,e,r){(function(t){(function(){var i=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],r="undefined"==typeof globalThis?t:globalThis;e.exports=function(){for(var t=[],e=0;e<i.length;e++)"function"==typeof r[i[e]]&&(t[t.length]=i[e]);return t}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(t,e,i){i.byteLength=h,i.toByteArray=d,i.fromByteArray=_;for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=o.length;a<l;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function h(t){var e=c(t),i=e[0],r=e[1];return 3*(i+r)/4-r}function u(t,e,i){return 3*(e+i)/4-i}function d(t){var e,i,r=c(t),o=r[0],a=r[1],l=new s(u(t,o,a)),h=0,d=a>0?o-4:o;for(i=0;i<d;i+=4)e=n[t.charCodeAt(i)]<<18|n[t.charCodeAt(i+1)]<<12|n[t.charCodeAt(i+2)]<<6|n[t.charCodeAt(i+3)],l[h++]=e>>16&255,l[h++]=e>>8&255,l[h++]=255&e;return 2===a&&(e=n[t.charCodeAt(i)]<<2|n[t.charCodeAt(i+1)]>>4,l[h++]=255&e),1===a&&(e=n[t.charCodeAt(i)]<<10|n[t.charCodeAt(i+1)]<<4|n[t.charCodeAt(i+2)]>>2,l[h++]=e>>8&255,l[h++]=255&e),l}function p(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function f(t,e,i){for(var r,n=[],s=e;s<i;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),n.push(p(r));return n.join("")}function _(t){for(var e,i=t.length,n=i%3,s=[],o=16383,a=0,l=i-n;a<l;a+=o)s.push(f(t,a,a+o>l?l:a+o));return 1===n?(e=t[i-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===n&&(e=(t[i-2]<<8)+t[i-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},{}],101:[function(t,e,i){
/*!
      		       * Bowser - a browser detector
      		       * https://github.com/ded/bowser
      		       * MIT License | (c) Dustin Diaz 2015
      		       */
!function(t,i,r){void 0!==e&&e.exports?e.exports=r():t[i]=r()}(this,"bowser",(function(){var t=!0;function e(e){function i(t){var i=e.match(t);return i&&i.length>1&&i[1]||""}function r(t){var i=e.match(t);return i&&i.length>1&&i[2]||""}var n,o=i(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(e)&&/android/i.test(e),l=/nexus\s*[0-6]\s*/i.test(e),c=!l&&/nexus\s*[0-9]+/i.test(e),h=/CrOS/.test(e),u=/silk/i.test(e),d=/sailfish/i.test(e),p=/tizen/i.test(e),f=/(web|hpw)(o|0)s/i.test(e),_=/windows phone/i.test(e),m=!_&&/windows/i.test(e),g=!o&&!u&&/macintosh/i.test(e),y=!a&&!d&&!p&&!f&&/linux/i.test(e),v=r(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),b=i(/version\/(\d+(\.\d+)?)/i),x=/tablet/i.test(e)&&!/tablet pc/i.test(e),T=!x&&/[^-]mobi/i.test(e),C=/xbox/i.test(e);function S(t){switch(t){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}/opera/i.test(e)?n={name:"Opera",opera:t,version:b||i(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(e)?n={name:"Opera",opera:t,version:i(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(e)?n={name:"Samsung Internet for Android",samsungBrowser:t,version:b||i(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(e)?n={name:"NAVER Whale browser",whale:t,version:i(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(e)?n={name:"MZ Browser",mzbrowser:t,version:i(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(e)?n={name:"Opera Coast",coast:t,version:b||i(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(e)?n={name:"Focus",focus:t,version:i(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(e)?n={name:"Yandex Browser",yandexbrowser:t,version:b||i(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?n={name:"UC Browser",ucbrowser:t,version:i(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?n={name:"Maxthon",maxthon:t,version:i(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?n={name:"Epiphany",epiphany:t,version:i(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?n={name:"Puffin",puffin:t,version:i(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?n={name:"Sleipnir",sleipnir:t,version:i(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?n={name:"K-Meleon",kMeleon:t,version:i(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:_?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:t},v?(n.msedge=t,n.version=v):(n.msie=t,n.version=i(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?n={name:"Internet Explorer",msie:t,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:h?n={name:"Chrome",osname:"Chrome OS",chromeos:t,chromeBook:t,chrome:t,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(e)?n={name:"Microsoft Edge",msedge:t,version:v}:/vivaldi/i.test(e)?n={name:"Vivaldi",vivaldi:t,version:i(/vivaldi\/(\d+(\.\d+)?)/i)||b}:d?n={name:"Sailfish",osname:"Sailfish OS",sailfish:t,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?n={name:"SeaMonkey",seamonkey:t,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(n={name:"Firefox",firefox:t,version:i(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(n.firefoxos=t,n.osname="Firefox OS")):u?n={name:"Amazon Silk",silk:t,version:i(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?n={name:"PhantomJS",phantom:t,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?n={name:"SlimerJS",slimer:t,version:i(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:t,version:b||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(n={name:"WebOS",osname:"WebOS",webos:t,version:b||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(n.touchpad=t)):/bada/i.test(e)?n={name:"Bada",osname:"Bada",bada:t,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:p?n={name:"Tizen",osname:"Tizen",tizen:t,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(e)?n={name:"QupZilla",qupzilla:t,version:i(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(e)?n={name:"Chromium",chromium:t,version:i(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(e)?n={name:"Chrome",chrome:t,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:b}:/safari|applewebkit/i.test(e)?(n={name:"Safari",safari:t},b&&(n.version=b)):o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},b&&(n.version=b)):n=/googlebot/i.test(e)?{name:"Googlebot",googlebot:t,version:i(/googlebot\/(\d+(\.\d+))/i)||b}:{name:i(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(n.name=n.name||"Blink",n.blink=t):(n.name=n.name||"Webkit",n.webkit=t),!n.version&&b&&(n.version=b)):!n.opera&&/gecko\//i.test(e)&&(n.name=n.name||"Gecko",n.gecko=t,n.version=n.version||i(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!a&&!n.silk?!n.windowsphone&&o?(n[o]=t,n.ios=t,n.osname="iOS"):g?(n.mac=t,n.osname="macOS"):C?(n.xbox=t,n.osname="Xbox"):m?(n.windows=t,n.osname="Windows"):y&&(n.linux=t,n.osname="Linux"):(n.android=t,n.osname="Android");var w="";n.windows?w=S(i(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?w=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?w=(w=i(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?w=(w=i(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?w=i(/android[ \/-](\d+(\.\d+)*)/i):n.webos?w=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?w=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?w=i(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(w=i(/tizen[\/\s](\d+(\.\d+)*)/i)),w&&(n.osversion=w);var A=!n.windows&&w.split(".")[0];return x||c||"ipad"==o||a&&(3==A||A>=4&&!T)||n.silk?n.tablet=t:(T||"iphone"==o||"ipod"==o||a||l||n.blackberry||n.webos||n.bada)&&(n.mobile=t),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.whale&&1===s([n.version,"1.0"])||n.mzbrowser&&1===s([n.version,"6.0"])||n.focus&&1===s([n.version,"1.0"])||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=t:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=t:n.x=t,n}var i=e("undefined"!=typeof navigator&&navigator.userAgent||"");function r(t){return t.split(".").length}function n(t,e){var i,r=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(i=0;i<t.length;i++)r.push(e(t[i]));return r}function s(t){for(var e=Math.max(r(t[0]),r(t[1])),i=n(t,(function(t){var i=e-r(t);return n((t+=new Array(i+1).join(".0")).split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));--e>=0;){if(i[0][e]>i[1][e])return 1;if(i[0][e]!==i[1][e])return-1;if(0===e)return 0}}function o(t,r,n){var o=i;"string"==typeof r&&(n=r,r=void 0),void 0===r&&(r=!1),n&&(o=e(n));var a=""+o.version;for(var l in t)if(t.hasOwnProperty(l)&&o[l]){if("string"!=typeof t[l])throw new Error("Browser version in the minVersion map should be a string: "+l+": "+String(t));return s([a,t[l]])<0}return r}function a(t,e,i){return!o(t,e,i)}return i.test=function(t){for(var e=0;e<t.length;++e){var r=t[e];if("string"==typeof r&&r in i)return!0}return!1},i.isUnsupportedBrowser=o,i.compareVersions=s,i.check=a,i._detect=e,i.detect=e,i}))},{}],102:[function(t,e,i){},{}],103:[function(t,i,r){(function(i){(function(){var i=t("base64-js"),n=t("ieee754");r.Buffer=l,r.SlowBuffer=y,r.INSPECT_MAX_BYTES=50;var s=2147483647;function o(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(e){return!1}}function a(t){if(t>s)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=l.prototype,e}function l(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return d(t)}return c(t,e,i)}function c(t,e,i){if("string"==typeof t)return p(t,e);if(ArrayBuffer.isView(t))return f(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return _(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return l.from(r,e,i);var n=m(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t,e,i){return h(t),t<=0?a(t):void 0!==e?"string"==typeof i?a(t).fill(e,i):a(t).fill(e):a(t)}function d(t){return h(t),a(t<0?0:0|g(t))}function p(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var i=0|v(t,e),r=a(i),n=r.write(t,e);return n!==i&&(r=r.slice(0,n)),r}function f(t){for(var e=t.length<0?0:0|g(t.length),i=a(e),r=0;r<e;r+=1)i[r]=255&t[r];return i}function _(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');var r;return(r=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i)).__proto__=l.prototype,r}function m(t){if(l.isBuffer(t)){var e=0|g(t.length),i=a(e);return 0===i.length||t.copy(i,0,0,e),i}return void 0!==t.length?"number"!=typeof t.length||Q(t.length)?a(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}function g(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function y(t){return+t!=t&&(t=0),l.alloc(+t)}function v(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var i=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return J(t).length;default:if(n)return r?-1:z(t).length;e=(""+e).toLowerCase(),n=!0}}function b(t,e,i){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,e,i);case"utf8":case"utf-8":return P(this,e,i);case"ascii":return O(this,e,i);case"latin1":case"binary":return B(this,e,i);case"base64":return I(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function x(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function T(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),Q(i=+i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:C(t,e,i,r,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):C(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function C(t,e,i,r,n){var s,o=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,i/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var h=-1;for(s=i;s<a;s++)if(c(t,s)===c(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(i+l>a&&(i=a-l),s=i;s>=0;s--){for(var u=!0,d=0;d<l;d++)if(c(t,s+d)!==c(e,d)){u=!1;break}if(u)return s}return-1}function S(t,e,i,r){i=Number(i)||0;var n=t.length-i;r?(r=Number(r))>n&&(r=n):r=n;var s=e.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(Q(a))return o;t[i+o]=a}return o}function w(t,e,i,r){return q(z(e,t.length-i),t,i,r)}function A(t,e,i,r){return q(W(e),t,i,r)}function E(t,e,i,r){return A(t,e,i,r)}function D(t,e,i,r){return q(J(e),t,i,r)}function L(t,e,i,r){return q(Z(e,t.length-i),t,i,r)}function I(t,e,r){return 0===e&&r===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,r))}function P(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var s,o,a,l,c=t[n],h=null,u=c>239?4:c>223?3:c>191?2:1;if(n+u<=i)switch(u){case 1:c<128&&(h=c);break;case 2:128==(192&(s=t[n+1]))&&(l=(31&c)<<6|63&s)>127&&(h=l);break;case 3:s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&(l=(15&c)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(h=l)}null===h?(h=65533,u=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),n+=u}return R(r)}r.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=o(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=function(t,e,i){return c(t,e,i)},l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(t,e,i){return u(t,e,i)},l.allocUnsafe=function(t){return d(t)},l.allocUnsafeSlow=function(t){return d(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),K(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var i=t.length,r=e.length,n=0,s=Math.min(i,r);n<s;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=l.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var s=t[i];if(K(s,Uint8Array)&&(s=l.from(s)),!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,n),n+=s.length}return r},l.byteLength=v,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)x(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)x(this,e,e+3),x(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)x(this,e,e+7),x(this,e+1,e+6),x(this,e+2,e+5),x(this,e+3,e+4);return this},l.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?P(this,0,t):b.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},l.prototype.compare=function(t,e,i,r,n){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(this===t)return 0;for(var s=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(e>>>=0),a=Math.min(s,o),c=this.slice(r,n),h=t.slice(e,i),u=0;u<a;++u)if(c[u]!==h[u]){s=c[u],o=h[u];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return T(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return T(this,t,e,i,!1)},l.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return S(this,t,e,i);case"utf8":case"utf-8":return w(this,t,e,i);case"ascii":return A(this,t,e,i);case"latin1":case"binary":return E(this,t,e,i);case"base64":return D(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var M=4096;function R(t){var e=t.length;if(e<=M)return String.fromCharCode.apply(String,t);for(var i="",r=0;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=M));return i}function O(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function B(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function N(t,e,i){var r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);for(var n="",s=e;s<i;++s)n+=X(t[s]);return n}function k(t,e,i){for(var r=t.slice(e,i),n="",s=0;s<r.length;s+=2)n+=String.fromCharCode(r[s]+256*r[s+1]);return n}function F(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function V(t,e,i,r,n,s){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function j(t,e,i,r,n,s){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function G(t,e,i,r,s){return e=+e,i>>>=0,s||j(t,e,i,4),n.write(t,e,i,r,23,4),i+4}function U(t,e,i,r,s){return e=+e,i>>>=0,s||j(t,e,i,8),n.write(t,e,i,r,52,8),i+8}l.prototype.slice=function(t,e){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=l.prototype,r},l.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||F(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r},l.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||F(t,e,this.length);for(var r=this[t+--e],n=1;e>0&&(n*=256);)r+=this[t+--e]*n;return r},l.prototype.readUInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||F(t,e,this.length);for(var r=this[t],n=1,s=0;++s<e&&(n*=256);)r+=this[t+s]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||F(t,e,this.length);for(var r=e,n=1,s=this[t+--r];r>0&&(n*=256);)s+=this[t+--r]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},l.prototype.readInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||F(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){t>>>=0,e||F(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return t>>>=0,e||F(t,4,this.length),n.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||F(t,4,this.length),n.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||F(t,8,this.length),n.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||F(t,8,this.length),n.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,i,r){t=+t,e>>>=0,i>>>=0,r||V(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,s=0;for(this[e]=255&t;++s<i&&(n*=256);)this[e+s]=t/n&255;return e+i},l.prototype.writeUIntBE=function(t,e,i,r){t=+t,e>>>=0,i>>>=0,r||V(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,s=1;for(this[e+n]=255&t;--n>=0&&(s*=256);)this[e+n]=t/s&255;return e+i},l.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e>>>=0,!r){var n=Math.pow(2,8*i-1);V(this,t,e,i,n-1,-n)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+i},l.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e>>>=0,!r){var n=Math.pow(2,8*i-1);V(this,t,e,i,n-1,-n)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||V(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeFloatLE=function(t,e,i){return G(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return G(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return U(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return U(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n=r-i;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,i,r);else if(this===t&&i<e&&e<r)for(var s=n-1;s>=0;--s)t[s+e]=this[s+i];else Uint8Array.prototype.set.call(t,this.subarray(i,r),e);return n},l.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var n=t.charCodeAt(0);("utf8"===r&&n<128||"latin1"===r)&&(t=n)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=e;s<i;++s)this[s]=t;else{var o=l.isBuffer(t)?t:l.from(t,r),a=o.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<i-e;++s)this[s+e]=o[s%a]}return this};var Y=/[^+/0-9A-Za-z-_]/g;function H(t){if((t=(t=t.split("=")[0]).trim().replace(Y,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function X(t){return t<16?"0"+t.toString(16):t.toString(16)}function z(t,e){var i;e=e||1/0;for(var r=t.length,n=null,s=[],o=0;o<r;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function W(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}function Z(t,e){for(var i,r,n,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=(i=t.charCodeAt(o))>>8,n=i%256,s.push(n),s.push(r);return s}function J(t){return i.toByteArray(H(t))}function q(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Q(t){return t!=t}}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":100,buffer:103,ieee754:400}],104:[function(t,e,i){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],105:[function(t,e,i){var r=t("get-intrinsic"),n=t("./"),s=n(r("String.prototype.indexOf"));e.exports=function(t,e){var i=r(t,!!e);return"function"==typeof i&&s(t,".prototype.")>-1?n(i):i}},{"./":106,"get-intrinsic":390}],106:[function(t,i,r){var n=t("function-bind"),s=t("get-intrinsic"),o=t("set-function-length"),a=s("%TypeError%"),l=s("%Function.prototype.apply%"),c=s("%Function.prototype.call%"),h=s("%Reflect.apply%",!0)||n.call(c,l),u=s("%Object.defineProperty%",!0),d=s("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}i.exports=function(t){if("function"!=typeof t)throw new a("a function is required");var e=h(n,c,arguments);return o(e,1+d(0,t.length-(arguments.length-1)),!0)};var p=function(){return h(n,l,arguments)};u?u(i.exports,"apply",{value:p}):i.exports.apply=p},{"function-bind":389,"get-intrinsic":390,"set-function-length":466}],107:[function(t,e,i){var r=Array.prototype.slice;function n(t,e){if(!(this instanceof n))return new n(t,e);this.src=t,this._withAccess=e}function s(t,e){return void 0===t[e]&&void 0===t.__lookupGetter__(e)&&void 0===t.__lookupSetter__(e)}e.exports=n,n.prototype.withAccess=function(t){return this._withAccess=!1!==t,this},n.prototype.pick=function(t){return Array.isArray(t)||(t=r.call(arguments)),t.length&&(this.keys=t),this},n.prototype.to=function(t){if(t=t||{},!this.src)return t;var e=this.keys||Object.keys(this.src);if(!this._withAccess){for(var i=0;i<e.length;i++)void 0===t[r=e[i]]&&(t[r]=this.src[r]);return t}for(i=0;i<e.length;i++){var r=e[i];if(s(t,r)){var n=this.src.__lookupGetter__(r),o=this.src.__lookupSetter__(r);n&&t.__defineGetter__(r,n),o&&t.__defineSetter__(r,o),n||o||(t[r]=this.src[r])}}return t},n.prototype.toCover=function(t){for(var e=this.keys||Object.keys(this.src),i=0;i<e.length;i++){var r=e[i];delete t[r];var n=this.src.__lookupGetter__(r),s=this.src.__lookupSetter__(r);n&&t.__defineGetter__(r,n),s&&t.__defineSetter__(r,s),n||s||(t[r]=this.src[r])}},n.prototype.override=n.prototype.toCover,n.prototype.and=function(t){var e={};return this.to(e),this.src=t,this.to(e),this.src=e,this}},{}],108:[function(t,e,i){var r=t("../internals/is-callable"),n=t("../internals/try-to-string"),s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(n(t)+" is not a function")}},{"../internals/is-callable":203,"../internals/try-to-string":293}],109:[function(t,e,i){var r=t("../internals/is-constructor"),n=t("../internals/try-to-string"),s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(n(t)+" is not a constructor")}},{"../internals/is-constructor":204,"../internals/try-to-string":293}],110:[function(t,e,i){var r=t("../internals/is-possible-prototype"),n=String,s=TypeError;e.exports=function(t){if(r(t))return t;throw new s("Can't set "+n(t)+" as a prototype")}},{"../internals/is-possible-prototype":209}],111:[function(t,e,i){var r=t("../internals/well-known-symbol"),n=t("../internals/object-create"),s=t("../internals/object-define-property").f,o=r("unscopables"),a=Array.prototype;void 0===a[o]&&s(a,o,{configurable:!0,value:n(null)}),e.exports=function(t){a[o][t]=!0}},{"../internals/object-create":229,"../internals/object-define-property":231,"../internals/well-known-symbol":306}],112:[function(t,e,i){var r=t("../internals/string-multibyte").charAt;e.exports=function(t,e,i){return e+(i?r(t,e).length:1)}},{"../internals/string-multibyte":271}],113:[function(t,e,i){var r=t("../internals/object-is-prototype-of"),n=TypeError;e.exports=function(t,e){if(r(e,t))return t;throw new n("Incorrect invocation")}},{"../internals/object-is-prototype-of":238}],114:[function(t,e,i){var r=t("../internals/is-object"),n=String,s=TypeError;e.exports=function(t){if(r(t))return t;throw new s(n(t)+" is not an object")}},{"../internals/is-object":208}],115:[function(t,e,i){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},{}],116:[function(t,e,i){var r=t("../internals/fails");e.exports=r((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}}))},{"../internals/fails":171}],117:[function(t,e,i){var r,n,s,o=t("../internals/array-buffer-basic-detection"),a=t("../internals/descriptors"),l=t("../internals/global"),c=t("../internals/is-callable"),h=t("../internals/is-object"),u=t("../internals/has-own-property"),d=t("../internals/classof"),p=t("../internals/try-to-string"),f=t("../internals/create-non-enumerable-property"),_=t("../internals/define-built-in"),m=t("../internals/define-built-in-accessor"),g=t("../internals/object-is-prototype-of"),y=t("../internals/object-get-prototype-of"),v=t("../internals/object-set-prototype-of"),b=t("../internals/well-known-symbol"),x=t("../internals/uid"),T=t("../internals/internal-state"),C=T.enforce,S=T.get,w=l.Int8Array,A=w&&w.prototype,E=l.Uint8ClampedArray,D=E&&E.prototype,L=w&&y(w),I=A&&y(A),P=Object.prototype,M=l.TypeError,R=b("toStringTag"),O=x("TYPED_ARRAY_TAG"),B="TypedArrayConstructor",N=o&&!!v&&"Opera"!==d(l.opera),k=!1,F={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},V={BigInt64Array:8,BigUint64Array:8},j=function(t){if(!h(t))return!1;var e=d(t);return"DataView"===e||u(F,e)||u(V,e)},G=function(t){var e=y(t);if(h(e)){var i=S(e);return i&&u(i,B)?i[B]:G(e)}},U=function(t){if(!h(t))return!1;var e=d(t);return u(F,e)||u(V,e)},Y=function(t){if(U(t))return t;throw new M("Target is not a typed array")},H=function(t){if(c(t)&&(!v||g(L,t)))return t;throw new M(p(t)+" is not a typed array constructor")},X=function(t,e,i,r){if(a){if(i)for(var n in F){var s=l[n];if(s&&u(s.prototype,t))try{delete s.prototype[t]}catch(o){try{s.prototype[t]=e}catch(c){}}}I[t]&&!i||_(I,t,i?e:N&&A[t]||e,r)}},z=function(t,e,i){var r,n;if(a){if(v){if(i)for(r in F)if((n=l[r])&&u(n,t))try{delete n[t]}catch(s){}if(L[t]&&!i)return;try{return _(L,t,i?e:N&&L[t]||e)}catch(s){}}for(r in F)!(n=l[r])||n[t]&&!i||_(n,t,e)}};for(r in F)(s=(n=l[r])&&n.prototype)?C(s)[B]=n:N=!1;for(r in V)(s=(n=l[r])&&n.prototype)&&(C(s)[B]=n);if((!N||!c(L)||L===Function.prototype)&&(L=function(){throw new M("Incorrect invocation")},N))for(r in F)l[r]&&v(l[r],L);if((!N||!I||I===P)&&(I=L.prototype,N))for(r in F)l[r]&&v(l[r].prototype,I);if(N&&y(D)!==I&&v(D,I),a&&!u(I,R))for(r in k=!0,m(I,R,{configurable:!0,get:function(){return h(this)?this[O]:void 0}}),F)l[r]&&f(l[r],O,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:k&&O,aTypedArray:Y,aTypedArrayConstructor:H,exportTypedArrayMethod:X,exportTypedArrayStaticMethod:z,getTypedArrayConstructor:G,isView:j,isTypedArray:U,TypedArray:L,TypedArrayPrototype:I}},{"../internals/array-buffer-basic-detection":115,"../internals/classof":138,"../internals/create-non-enumerable-property":145,"../internals/define-built-in":149,"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/global":188,"../internals/has-own-property":189,"../internals/internal-state":199,"../internals/is-callable":203,"../internals/is-object":208,"../internals/object-get-prototype-of":236,"../internals/object-is-prototype-of":238,"../internals/object-set-prototype-of":242,"../internals/try-to-string":293,"../internals/uid":299,"../internals/well-known-symbol":306}],118:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/function-uncurry-this"),s=t("../internals/descriptors"),o=t("../internals/array-buffer-basic-detection"),a=t("../internals/function-name"),l=t("../internals/create-non-enumerable-property"),c=t("../internals/define-built-in-accessor"),h=t("../internals/define-built-ins"),u=t("../internals/fails"),d=t("../internals/an-instance"),p=t("../internals/to-integer-or-infinity"),f=t("../internals/to-length"),_=t("../internals/to-index"),m=t("../internals/math-fround"),g=t("../internals/ieee754"),y=t("../internals/object-get-prototype-of"),v=t("../internals/object-set-prototype-of"),b=t("../internals/array-fill"),x=t("../internals/array-slice"),T=t("../internals/inherit-if-required"),C=t("../internals/copy-constructor-properties"),S=t("../internals/set-to-string-tag"),w=t("../internals/internal-state"),A=a.PROPER,E=a.CONFIGURABLE,D="ArrayBuffer",L="DataView",I="prototype",P="Wrong length",M="Wrong index",R=w.getterFor(D),O=w.getterFor(L),B=w.set,N=r[D],k=N,F=k&&k[I],V=r[L],j=V&&V[I],G=Object.prototype,U=r.Array,Y=r.RangeError,H=n(b),X=n([].reverse),z=g.pack,W=g.unpack,Z=function(t){return[255&t]},J=function(t){return[255&t,t>>8&255]},q=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},K=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Q=function(t){return z(m(t),23,4)},$=function(t){return z(t,52,8)},tt=function(t,e,i){c(t[I],e,{configurable:!0,get:function(){return i(this)[e]}})},et=function(t,e,i,r){var n=O(t),s=_(i),o=!!r;if(s+e>n.byteLength)throw new Y(M);var a=n.bytes,l=s+n.byteOffset,c=x(a,l,l+e);return o?c:X(c)},it=function(t,e,i,r,n,s){var o=O(t),a=_(i),l=r(+n),c=!!s;if(a+e>o.byteLength)throw new Y(M);for(var h=o.bytes,u=a+o.byteOffset,d=0;d<e;d++)h[u+d]=l[c?d:e-d-1]};if(o){var rt=A&&N.name!==D;u((function(){N(1)}))&&u((function(){new N(-1)}))&&!u((function(){return new N,new N(1.5),new N(NaN),1!==N.length||rt&&!E}))?rt&&E&&l(N,"name",D):((k=function(t){return d(this,F),T(new N(_(t)),this,k)})[I]=F,F.constructor=k,C(k,N)),v&&y(j)!==G&&v(j,G);var nt=new V(new k(2)),st=n(j.setInt8);nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||h(j,{setInt8:function(t,e){st(this,t,e<<24>>24)},setUint8:function(t,e){st(this,t,e<<24>>24)}},{unsafe:!0})}else F=(k=function(t){d(this,F);var e=_(t);B(this,{type:D,bytes:H(U(e),0),byteLength:e}),s||(this.byteLength=e,this.detached=!1)})[I],j=(V=function(t,e,i){d(this,j),d(t,F);var r=R(t),n=r.byteLength,o=p(e);if(o<0||o>n)throw new Y("Wrong offset");if(o+(i=void 0===i?n-o:f(i))>n)throw new Y(P);B(this,{type:L,buffer:t,byteLength:i,byteOffset:o,bytes:r.bytes}),s||(this.buffer=t,this.byteLength=i,this.byteOffset=o)})[I],s&&(tt(k,"byteLength",R),tt(V,"buffer",O),tt(V,"byteLength",O),tt(V,"byteOffset",O)),h(j,{getInt8:function(t){return et(this,1,t)[0]<<24>>24},getUint8:function(t){return et(this,1,t)[0]},getInt16:function(t){var e=et(this,2,t,arguments.length>1&&arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=et(this,2,t,arguments.length>1&&arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return K(et(this,4,t,arguments.length>1&&arguments[1]))},getUint32:function(t){return K(et(this,4,t,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(t){return W(et(this,4,t,arguments.length>1&&arguments[1]),23)},getFloat64:function(t){return W(et(this,8,t,arguments.length>1&&arguments[1]),52)},setInt8:function(t,e){it(this,1,t,Z,e)},setUint8:function(t,e){it(this,1,t,Z,e)},setInt16:function(t,e){it(this,2,t,J,e,arguments.length>2&&arguments[2])},setUint16:function(t,e){it(this,2,t,J,e,arguments.length>2&&arguments[2])},setInt32:function(t,e){it(this,4,t,q,e,arguments.length>2&&arguments[2])},setUint32:function(t,e){it(this,4,t,q,e,arguments.length>2&&arguments[2])},setFloat32:function(t,e){it(this,4,t,Q,e,arguments.length>2&&arguments[2])},setFloat64:function(t,e){it(this,8,t,$,e,arguments.length>2&&arguments[2])}});S(k,D),S(V,L),e.exports={ArrayBuffer:k,DataView:V}},{"../internals/an-instance":113,"../internals/array-buffer-basic-detection":115,"../internals/array-fill":120,"../internals/array-slice":131,"../internals/copy-constructor-properties":141,"../internals/create-non-enumerable-property":145,"../internals/define-built-in-accessor":148,"../internals/define-built-ins":150,"../internals/descriptors":153,"../internals/fails":171,"../internals/function-name":178,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/ieee754":194,"../internals/inherit-if-required":196,"../internals/internal-state":199,"../internals/math-fround":222,"../internals/object-get-prototype-of":236,"../internals/object-set-prototype-of":242,"../internals/set-to-string-tag":266,"../internals/to-index":281,"../internals/to-integer-or-infinity":283,"../internals/to-length":284}],119:[function(t,e,i){var r=t("../internals/to-object"),n=t("../internals/to-absolute-index"),s=t("../internals/length-of-array-like"),o=t("../internals/delete-property-or-throw"),a=Math.min;e.exports=[].copyWithin||function(t,e){var i=r(this),l=s(i),c=n(t,l),h=n(e,l),u=arguments.length>2?arguments[2]:void 0,d=a((void 0===u?l:n(u,l))-h,l-c),p=1;for(h<c&&c<h+d&&(p=-1,h+=d-1,c+=d-1);d-- >0;)h in i?i[c]=i[h]:o(i,c),c+=p,h+=p;return i}},{"../internals/delete-property-or-throw":152,"../internals/length-of-array-like":219,"../internals/to-absolute-index":279,"../internals/to-object":285}],120:[function(t,e,i){var r=t("../internals/to-object"),n=t("../internals/to-absolute-index"),s=t("../internals/length-of-array-like");e.exports=function(t){for(var e=r(this),i=s(e),o=arguments.length,a=n(o>1?arguments[1]:void 0,i),l=o>2?arguments[2]:void 0,c=void 0===l?i:n(l,i);c>a;)e[a++]=t;return e}},{"../internals/length-of-array-like":219,"../internals/to-absolute-index":279,"../internals/to-object":285}],121:[function(t,e,i){var r=t("../internals/array-iteration").forEach,n=t("../internals/array-method-is-strict")("forEach");e.exports=n?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},{"../internals/array-iteration":125,"../internals/array-method-is-strict":128}],122:[function(t,e,i){var r=t("../internals/length-of-array-like");e.exports=function(t,e,i){for(var n=0,s=arguments.length>2?i:r(e),o=new t(s);s>n;)o[n]=e[n++];return o}},{"../internals/length-of-array-like":219}],123:[function(t,e,i){var r=t("../internals/function-bind-context"),n=t("../internals/function-call"),s=t("../internals/to-object"),o=t("../internals/call-with-safe-iteration-closing"),a=t("../internals/is-array-iterator-method"),l=t("../internals/is-constructor"),c=t("../internals/length-of-array-like"),h=t("../internals/create-property"),u=t("../internals/get-iterator"),d=t("../internals/get-iterator-method"),p=Array;e.exports=function(t){var e=s(t),i=l(this),f=arguments.length,_=f>1?arguments[1]:void 0,m=void 0!==_;m&&(_=r(_,f>2?arguments[2]:void 0));var g,y,v,b,x,T,C=d(e),S=0;if(!C||this===p&&a(C))for(g=c(e),y=i?new this(g):p(g);g>S;S++)T=m?_(e[S],S):e[S],h(y,S,T);else for(x=(b=u(e,C)).next,y=i?new this:[];!(v=n(x,b)).done;S++)T=m?o(b,_,[v.value,S],!0):v.value,h(y,S,T);return y.length=S,y}},{"../internals/call-with-safe-iteration-closing":135,"../internals/create-property":147,"../internals/function-bind-context":175,"../internals/function-call":177,"../internals/get-iterator":184,"../internals/get-iterator-method":183,"../internals/is-array-iterator-method":200,"../internals/is-constructor":204,"../internals/length-of-array-like":219,"../internals/to-object":285}],124:[function(t,e,i){var r=t("../internals/to-indexed-object"),n=t("../internals/to-absolute-index"),s=t("../internals/length-of-array-like"),o=function(t){return function(e,i,o){var a,l=r(e),c=s(l),h=n(o,c);if(t&&i!=i){for(;c>h;)if((a=l[h++])!=a)return!0}else for(;c>h;h++)if((t||h in l)&&l[h]===i)return t||h||0;return!t&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},{"../internals/length-of-array-like":219,"../internals/to-absolute-index":279,"../internals/to-indexed-object":282}],125:[function(t,e,i){var r=t("../internals/function-bind-context"),n=t("../internals/function-uncurry-this"),s=t("../internals/indexed-object"),o=t("../internals/to-object"),a=t("../internals/length-of-array-like"),l=t("../internals/array-species-create"),c=n([].push),h=function(t){var e=1===t,i=2===t,n=3===t,h=4===t,u=6===t,d=7===t,p=5===t||u;return function(f,_,m,g){for(var y,v,b=o(f),x=s(b),T=a(x),C=r(_,m),S=0,w=g||l,A=e?w(f,T):i||d?w(f,0):void 0;T>S;S++)if((p||S in x)&&(v=C(y=x[S],S,b),t))if(e)A[S]=v;else if(v)switch(t){case 3:return!0;case 5:return y;case 6:return S;case 2:c(A,y)}else switch(t){case 4:return!1;case 7:c(A,y)}return u?-1:n||h?h:A}};e.exports={forEach:h(0),map:h(1),filter:h(2),some:h(3),every:h(4),find:h(5),findIndex:h(6),filterReject:h(7)}},{"../internals/array-species-create":134,"../internals/function-bind-context":175,"../internals/function-uncurry-this":181,"../internals/indexed-object":195,"../internals/length-of-array-like":219,"../internals/to-object":285}],126:[function(t,e,i){var r=t("../internals/function-apply"),n=t("../internals/to-indexed-object"),s=t("../internals/to-integer-or-infinity"),o=t("../internals/length-of-array-like"),a=t("../internals/array-method-is-strict"),l=Math.min,c=[].lastIndexOf,h=!!c&&1/[1].lastIndexOf(1,-0)<0,u=a("lastIndexOf"),d=h||!u;e.exports=d?function(t){if(h)return r(c,this,arguments)||0;var e=n(this),i=o(e),a=i-1;for(arguments.length>1&&(a=l(a,s(arguments[1]))),a<0&&(a=i+a);a>=0;a--)if(a in e&&e[a]===t)return a||0;return-1}:c},{"../internals/array-method-is-strict":128,"../internals/function-apply":174,"../internals/length-of-array-like":219,"../internals/to-indexed-object":282,"../internals/to-integer-or-infinity":283}],127:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/well-known-symbol"),s=t("../internals/engine-v8-version"),o=n("species");e.exports=function(t){return s>=51||!r((function(){var e=[];return(e.constructor={})[o]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},{"../internals/engine-v8-version":167,"../internals/fails":171,"../internals/well-known-symbol":306}],128:[function(t,e,i){var r=t("../internals/fails");e.exports=function(t,e){var i=[][t];return!!i&&r((function(){i.call(null,e||function(){return 1},1)}))}},{"../internals/fails":171}],129:[function(t,e,i){var r=t("../internals/a-callable"),n=t("../internals/to-object"),s=t("../internals/indexed-object"),o=t("../internals/length-of-array-like"),a=TypeError,l=function(t){return function(e,i,l,c){var h=n(e),u=s(h),d=o(h);r(i);var p=t?d-1:0,f=t?-1:1;if(l<2)for(;;){if(p in u){c=u[p],p+=f;break}if(p+=f,t?p<0:d<=p)throw new a("Reduce of empty array with no initial value")}for(;t?p>=0:d>p;p+=f)p in u&&(c=i(c,u[p],p,h));return c}};e.exports={left:l(!1),right:l(!0)}},{"../internals/a-callable":108,"../internals/indexed-object":195,"../internals/length-of-array-like":219,"../internals/to-object":285}],130:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/is-array"),s=TypeError,o=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();e.exports=a?function(t,e){if(n(t)&&!o(t,"length").writable)throw new s("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},{"../internals/descriptors":153,"../internals/is-array":201}],131:[function(t,e,i){var r=t("../internals/function-uncurry-this");e.exports=r([].slice)},{"../internals/function-uncurry-this":181}],132:[function(t,e,i){var r=t("../internals/array-slice"),n=Math.floor,s=function(t,e){var i=t.length;if(i<8)for(var o,a,l=1;l<i;){for(a=l,o=t[l];a&&e(t[a-1],o)>0;)t[a]=t[--a];a!==l++&&(t[a]=o)}else for(var c=n(i/2),h=s(r(t,0,c),e),u=s(r(t,c),e),d=h.length,p=u.length,f=0,_=0;f<d||_<p;)t[f+_]=f<d&&_<p?e(h[f],u[_])<=0?h[f++]:u[_++]:f<d?h[f++]:u[_++];return t};e.exports=s},{"../internals/array-slice":131}],133:[function(t,e,i){var r=t("../internals/is-array"),n=t("../internals/is-constructor"),s=t("../internals/is-object"),o=t("../internals/well-known-symbol")("species"),a=Array;e.exports=function(t){var e;return r(t)&&(e=t.constructor,(n(e)&&(e===a||r(e.prototype))||s(e)&&null===(e=e[o]))&&(e=void 0)),void 0===e?a:e}},{"../internals/is-array":201,"../internals/is-constructor":204,"../internals/is-object":208,"../internals/well-known-symbol":306}],134:[function(t,e,i){var r=t("../internals/array-species-constructor");e.exports=function(t,e){return new(r(t))(0===e?0:e)}},{"../internals/array-species-constructor":133}],135:[function(t,e,i){var r=t("../internals/an-object"),n=t("../internals/iterator-close");e.exports=function(t,e,i,s){try{return s?e(r(i)[0],i[1]):e(i)}catch(o){n(t,"throw",o)}}},{"../internals/an-object":114,"../internals/iterator-close":214}],136:[function(t,e,i){var r=t("../internals/well-known-symbol")("iterator"),n=!1;try{var s=0,o={next:function(){return{done:!!s++}},return:function(){n=!0}};o[r]=function(){return this},Array.from(o,(function(){throw 2}))}catch(a){}e.exports=function(t,e){try{if(!e&&!n)return!1}catch(a){return!1}var i=!1;try{var s={};s[r]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch(a){}return i}},{"../internals/well-known-symbol":306}],137:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=r({}.toString),s=r("".slice);e.exports=function(t){return s(n(t),8,-1)}},{"../internals/function-uncurry-this":181}],138:[function(t,e,i){var r=t("../internals/to-string-tag-support"),n=t("../internals/is-callable"),s=t("../internals/classof-raw"),o=t("../internals/well-known-symbol")("toStringTag"),a=Object,l="Arguments"===s(function(){return arguments}()),c=function(t,e){try{return t[e]}catch(i){}};e.exports=r?s:function(t){var e,i,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=c(e=a(t),o))?i:l?s(e):"Object"===(r=s(e))&&n(e.callee)?"Arguments":r}},{"../internals/classof-raw":137,"../internals/is-callable":203,"../internals/to-string-tag-support":290,"../internals/well-known-symbol":306}],139:[function(t,e,i){var r=t("../internals/object-create"),n=t("../internals/define-built-in-accessor"),s=t("../internals/define-built-ins"),o=t("../internals/function-bind-context"),a=t("../internals/an-instance"),l=t("../internals/is-null-or-undefined"),c=t("../internals/iterate"),h=t("../internals/iterator-define"),u=t("../internals/create-iter-result-object"),d=t("../internals/set-species"),p=t("../internals/descriptors"),f=t("../internals/internal-metadata").fastKey,_=t("../internals/internal-state"),m=_.set,g=_.getterFor;e.exports={getConstructor:function(t,e,i,h){var u=t((function(t,n){a(t,d),m(t,{type:e,index:r(null),first:void 0,last:void 0,size:0}),p||(t.size=0),l(n)||c(n,t[h],{that:t,AS_ENTRIES:i})})),d=u.prototype,_=g(e),y=function(t,e,i){var r,n,s=_(t),o=v(t,e);return o?o.value=i:(s.last=o={index:n=f(e,!0),key:e,value:i,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=o),r&&(r.next=o),p?s.size++:t.size++,"F"!==n&&(s.index[n]=o)),t},v=function(t,e){var i,r=_(t),n=f(e);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key===e)return i};return s(d,{clear:function(){for(var t=this,e=_(t),i=e.first;i;)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),i=i.next;e.first=e.last=void 0,e.index=r(null),p?e.size=0:t.size=0},delete:function(t){var e=this,i=_(e),r=v(e,t);if(r){var n=r.next,s=r.previous;delete i.index[r.index],r.removed=!0,s&&(s.next=n),n&&(n.previous=s),i.first===r&&(i.first=n),i.last===r&&(i.last=s),p?i.size--:e.size--}return!!r},forEach:function(t){for(var e,i=_(this),r=o(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:i.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!v(this,t)}}),s(d,i?{get:function(t){var e=v(this,t);return e&&e.value},set:function(t,e){return y(this,0===t?0:t,e)}}:{add:function(t){return y(this,t=0===t?0:t,t)}}),p&&n(d,"size",{configurable:!0,get:function(){return _(this).size}}),u},setStrong:function(t,e,i){var r=e+" Iterator",n=g(e),s=g(r);h(t,e,(function(t,e){m(this,{type:r,target:t,state:n(t),kind:e,last:void 0})}),(function(){for(var t=s(this),e=t.kind,i=t.last;i&&i.removed;)i=i.previous;return t.target&&(t.last=i=i?i.next:t.state.first)?u("keys"===e?i.key:"values"===e?i.value:[i.key,i.value],!1):(t.target=void 0,u(void 0,!0))}),i?"entries":"values",!i,!0),d(e)}}},{"../internals/an-instance":113,"../internals/create-iter-result-object":144,"../internals/define-built-in-accessor":148,"../internals/define-built-ins":150,"../internals/descriptors":153,"../internals/function-bind-context":175,"../internals/internal-metadata":198,"../internals/internal-state":199,"../internals/is-null-or-undefined":207,"../internals/iterate":213,"../internals/iterator-define":216,"../internals/object-create":229,"../internals/set-species":265}],140:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/global"),s=t("../internals/function-uncurry-this"),o=t("../internals/is-forced"),a=t("../internals/define-built-in"),l=t("../internals/internal-metadata"),c=t("../internals/iterate"),h=t("../internals/an-instance"),u=t("../internals/is-callable"),d=t("../internals/is-null-or-undefined"),p=t("../internals/is-object"),f=t("../internals/fails"),_=t("../internals/check-correctness-of-iteration"),m=t("../internals/set-to-string-tag"),g=t("../internals/inherit-if-required");e.exports=function(t,e,i){var y=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),b=y?"set":"add",x=n[t],T=x&&x.prototype,C=x,S={},w=function(t){var e=s(T[t]);a(T,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(v&&!p(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return v&&!p(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(v&&!p(t))&&e(this,0===t?0:t)}:function(t,i){return e(this,0===t?0:t,i),this})};if(o(t,!u(x)||!(v||T.forEach&&!f((function(){(new x).entries().next()})))))C=i.getConstructor(e,t,y,b),l.enable();else if(o(t,!0)){var A=new C,E=A[b](v?{}:-0,1)!==A,D=f((function(){A.has(1)})),L=_((function(t){new x(t)})),I=!v&&f((function(){for(var t=new x,e=5;e--;)t[b](e,e);return!t.has(-0)}));L||((C=e((function(t,e){h(t,T);var i=g(new x,t,C);return d(e)||c(e,i[b],{that:i,AS_ENTRIES:y}),i}))).prototype=T,T.constructor=C),(D||I)&&(w("delete"),w("has"),y&&w("get")),(I||E)&&w(b),v&&T.clear&&delete T.clear}return S[t]=C,r({global:!0,constructor:!0,forced:C!==x},S),m(C,t),v||i.setStrong(C,t,y),C}},{"../internals/an-instance":113,"../internals/check-correctness-of-iteration":136,"../internals/define-built-in":149,"../internals/export":170,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/inherit-if-required":196,"../internals/internal-metadata":198,"../internals/is-callable":203,"../internals/is-forced":205,"../internals/is-null-or-undefined":207,"../internals/is-object":208,"../internals/iterate":213,"../internals/set-to-string-tag":266}],141:[function(t,e,i){var r=t("../internals/has-own-property"),n=t("../internals/own-keys"),s=t("../internals/object-get-own-property-descriptor"),o=t("../internals/object-define-property");e.exports=function(t,e,i){for(var a=n(e),l=o.f,c=s.f,h=0;h<a.length;h++){var u=a[h];r(t,u)||i&&r(i,u)||l(t,u,c(e,u))}}},{"../internals/has-own-property":189,"../internals/object-define-property":231,"../internals/object-get-own-property-descriptor":232,"../internals/own-keys":246}],142:[function(t,e,i){var r=t("../internals/well-known-symbol")("match");e.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[r]=!1,"/./"[t](e)}catch(n){}}return!1}},{"../internals/well-known-symbol":306}],143:[function(t,e,i){var r=t("../internals/fails");e.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},{"../internals/fails":171}],144:[function(t,e,i){e.exports=function(t,e){return{value:t,done:e}}},{}],145:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/object-define-property"),s=t("../internals/create-property-descriptor");e.exports=r?function(t,e,i){return n.f(t,e,s(1,i))}:function(t,e,i){return t[e]=i,t}},{"../internals/create-property-descriptor":146,"../internals/descriptors":153,"../internals/object-define-property":231}],146:[function(t,e,i){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],147:[function(t,e,i){var r=t("../internals/to-property-key"),n=t("../internals/object-define-property"),s=t("../internals/create-property-descriptor");e.exports=function(t,e,i){var o=r(e);o in t?n.f(t,o,s(0,i)):t[o]=i}},{"../internals/create-property-descriptor":146,"../internals/object-define-property":231,"../internals/to-property-key":289}],148:[function(t,e,i){var r=t("../internals/make-built-in"),n=t("../internals/object-define-property");e.exports=function(t,e,i){return i.get&&r(i.get,e,{getter:!0}),i.set&&r(i.set,e,{setter:!0}),n.f(t,e,i)}},{"../internals/make-built-in":220,"../internals/object-define-property":231}],149:[function(t,e,i){var r=t("../internals/is-callable"),n=t("../internals/object-define-property"),s=t("../internals/make-built-in"),o=t("../internals/define-global-property");e.exports=function(t,e,i,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:e;if(r(i)&&s(i,c,a),a.global)l?t[e]=i:o(e,i);else{try{a.unsafe?t[e]&&(l=!0):delete t[e]}catch(h){}l?t[e]=i:n.f(t,e,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},{"../internals/define-global-property":151,"../internals/is-callable":203,"../internals/make-built-in":220,"../internals/object-define-property":231}],150:[function(t,e,i){var r=t("../internals/define-built-in");e.exports=function(t,e,i){for(var n in e)r(t,n,e[n],i);return t}},{"../internals/define-built-in":149}],151:[function(t,e,i){var r=t("../internals/global"),n=Object.defineProperty;e.exports=function(t,e){try{n(r,t,{value:e,configurable:!0,writable:!0})}catch(i){r[t]=e}return e}},{"../internals/global":188}],152:[function(t,e,i){var r=t("../internals/try-to-string"),n=TypeError;e.exports=function(t,e){if(!delete t[e])throw new n("Cannot delete property "+r(e)+" of "+r(t))}},{"../internals/try-to-string":293}],153:[function(t,e,i){var r=t("../internals/fails");e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},{"../internals/fails":171}],154:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/is-object"),s=r.document,o=n(s)&&n(s.createElement);e.exports=function(t){return o?s.createElement(t):{}}},{"../internals/global":188,"../internals/is-object":208}],155:[function(t,e,i){var r=TypeError,n=9007199254740991;e.exports=function(t){if(t>n)throw r("Maximum allowed index exceeded");return t}},{}],156:[function(t,e,i){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},{}],157:[function(t,e,i){var r=t("../internals/document-create-element")("span").classList,n=r&&r.constructor&&r.constructor.prototype;e.exports=n===Object.prototype?void 0:n},{"../internals/document-create-element":154}],158:[function(t,e,i){var r=t("../internals/engine-user-agent").match(/firefox\/(\d+)/i);e.exports=!!r&&+r[1]},{"../internals/engine-user-agent":166}],159:[function(t,e,i){var r=t("../internals/engine-is-deno"),n=t("../internals/engine-is-node");e.exports=!r&&!n&&"object"==typeof window&&"object"==typeof document},{"../internals/engine-is-deno":160,"../internals/engine-is-node":164}],160:[function(t,e,i){e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},{}],161:[function(t,e,i){var r=t("../internals/engine-user-agent");e.exports=/MSIE|Trident/.test(r)},{"../internals/engine-user-agent":166}],162:[function(t,e,i){var r=t("../internals/engine-user-agent");e.exports=/ipad|iphone|ipod/i.test(r)&&"undefined"!=typeof Pebble},{"../internals/engine-user-agent":166}],163:[function(t,e,i){var r=t("../internals/engine-user-agent");e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},{"../internals/engine-user-agent":166}],164:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/classof-raw");e.exports="process"===n(r.process)},{"../internals/classof-raw":137,"../internals/global":188}],165:[function(t,e,i){var r=t("../internals/engine-user-agent");e.exports=/web0s(?!.*chrome)/i.test(r)},{"../internals/engine-user-agent":166}],166:[function(t,e,i){e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},{}],167:[function(t,e,i){var r,n,s=t("../internals/global"),o=t("../internals/engine-user-agent"),a=s.process,l=s.Deno,c=a&&a.versions||l&&l.version,h=c&&c.v8;h&&(n=(r=h.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!n&&o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(n=+r[1]),e.exports=n},{"../internals/engine-user-agent":166,"../internals/global":188}],168:[function(t,e,i){var r=t("../internals/engine-user-agent").match(/AppleWebKit\/(\d+)\./);e.exports=!!r&&+r[1]},{"../internals/engine-user-agent":166}],169:[function(t,e,i){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},{}],170:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/object-get-own-property-descriptor").f,s=t("../internals/create-non-enumerable-property"),o=t("../internals/define-built-in"),a=t("../internals/define-global-property"),l=t("../internals/copy-constructor-properties"),c=t("../internals/is-forced");e.exports=function(t,e){var i,h,u,d,p,f=t.target,_=t.global,m=t.stat;if(i=_?r:m?r[f]||a(f,{}):(r[f]||{}).prototype)for(h in e){if(d=e[h],u=t.dontCallGetSet?(p=n(i,h))&&p.value:i[h],!c(_?h:f+(m?".":"#")+h,t.forced)&&void 0!==u){if(typeof d==typeof u)continue;l(d,u)}(t.sham||u&&u.sham)&&s(d,"sham",!0),o(i,h,d,t)}}},{"../internals/copy-constructor-properties":141,"../internals/create-non-enumerable-property":145,"../internals/define-built-in":149,"../internals/define-global-property":151,"../internals/global":188,"../internals/is-forced":205,"../internals/object-get-own-property-descriptor":232}],171:[function(t,e,i){e.exports=function(t){try{return!!t()}catch(e){return!0}}},{}],172:[function(t,e,i){t("../modules/es.regexp.exec");var r=t("../internals/function-uncurry-this-clause"),n=t("../internals/define-built-in"),s=t("../internals/regexp-exec"),o=t("../internals/fails"),a=t("../internals/well-known-symbol"),l=t("../internals/create-non-enumerable-property"),c=a("species"),h=RegExp.prototype;e.exports=function(t,e,i,u){var d=a(t),p=!o((function(){var e={};return e[d]=function(){return 7},7!==""[t](e)})),f=p&&!o((function(){var e=!1,i=/a/;return"split"===t&&((i={}).constructor={},i.constructor[c]=function(){return i},i.flags="",i[d]=/./[d]),i.exec=function(){return e=!0,null},i[d](""),!e}));if(!p||!f||i){var _=r(/./[d]),m=e(d,""[t],(function(t,e,i,n,o){var a=r(t),l=e.exec;return l===s||l===h.exec?p&&!o?{done:!0,value:_(e,i,n)}:{done:!0,value:a(i,e,n)}:{done:!1}}));n(String.prototype,t,m[0]),n(h,d,m[1])}u&&l(h[d],"sham",!0)}},{"../internals/create-non-enumerable-property":145,"../internals/define-built-in":149,"../internals/fails":171,"../internals/function-uncurry-this-clause":180,"../internals/regexp-exec":256,"../internals/well-known-symbol":306,"../modules/es.regexp.exec":338}],173:[function(t,e,i){var r=t("../internals/fails");e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},{"../internals/fails":171}],174:[function(t,e,i){var r=t("../internals/function-bind-native"),n=Function.prototype,s=n.apply,o=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(s):function(){return o.apply(s,arguments)})},{"../internals/function-bind-native":176}],175:[function(t,e,i){var r=t("../internals/function-uncurry-this-clause"),n=t("../internals/a-callable"),s=t("../internals/function-bind-native"),o=r(r.bind);e.exports=function(t,e){return n(t),void 0===e?t:s?o(t,e):function(){return t.apply(e,arguments)}}},{"../internals/a-callable":108,"../internals/function-bind-native":176,"../internals/function-uncurry-this-clause":180}],176:[function(t,e,i){var r=t("../internals/fails");e.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},{"../internals/fails":171}],177:[function(t,e,i){var r=t("../internals/function-bind-native"),n=Function.prototype.call;e.exports=r?n.bind(n):function(){return n.apply(n,arguments)}},{"../internals/function-bind-native":176}],178:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/has-own-property"),s=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,a=n(s,"name"),l=a&&"something"===function(){}.name,c=a&&(!r||r&&o(s,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},{"../internals/descriptors":153,"../internals/has-own-property":189}],179:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/a-callable");e.exports=function(t,e,i){try{return r(n(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(s){}}},{"../internals/a-callable":108,"../internals/function-uncurry-this":181}],180:[function(t,e,i){var r=t("../internals/classof-raw"),n=t("../internals/function-uncurry-this");e.exports=function(t){if("Function"===r(t))return n(t)}},{"../internals/classof-raw":137,"../internals/function-uncurry-this":181}],181:[function(t,e,i){var r=t("../internals/function-bind-native"),n=Function.prototype,s=n.call,o=r&&n.bind.bind(s,s);e.exports=r?o:function(t){return function(){return s.apply(t,arguments)}}},{"../internals/function-bind-native":176}],182:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/is-callable"),s=function(t){return n(t)?t:void 0};e.exports=function(t,e){return arguments.length<2?s(r[t]):r[t]&&r[t][e]}},{"../internals/global":188,"../internals/is-callable":203}],183:[function(t,e,i){var r=t("../internals/classof"),n=t("../internals/get-method"),s=t("../internals/is-null-or-undefined"),o=t("../internals/iterators"),a=t("../internals/well-known-symbol")("iterator");e.exports=function(t){if(!s(t))return n(t,a)||n(t,"@@iterator")||o[r(t)]}},{"../internals/classof":138,"../internals/get-method":186,"../internals/is-null-or-undefined":207,"../internals/iterators":218,"../internals/well-known-symbol":306}],184:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/a-callable"),s=t("../internals/an-object"),o=t("../internals/try-to-string"),a=t("../internals/get-iterator-method"),l=TypeError;e.exports=function(t,e){var i=arguments.length<2?a(t):e;if(n(i))return s(r(i,t));throw new l(o(t)+" is not iterable")}},{"../internals/a-callable":108,"../internals/an-object":114,"../internals/function-call":177,"../internals/get-iterator-method":183,"../internals/try-to-string":293}],185:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/is-array"),s=t("../internals/is-callable"),o=t("../internals/classof-raw"),a=t("../internals/to-string"),l=r([].push);e.exports=function(t){if(s(t))return t;if(n(t)){for(var e=t.length,i=[],r=0;r<e;r++){var c=t[r];"string"==typeof c?l(i,c):"number"!=typeof c&&"Number"!==o(c)&&"String"!==o(c)||l(i,a(c))}var h=i.length,u=!0;return function(t,e){if(u)return u=!1,e;if(n(this))return e;for(var r=0;r<h;r++)if(i[r]===t)return e}}}},{"../internals/classof-raw":137,"../internals/function-uncurry-this":181,"../internals/is-array":201,"../internals/is-callable":203,"../internals/to-string":291}],186:[function(t,e,i){var r=t("../internals/a-callable"),n=t("../internals/is-null-or-undefined");e.exports=function(t,e){var i=t[e];return n(i)?void 0:r(i)}},{"../internals/a-callable":108,"../internals/is-null-or-undefined":207}],187:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/to-object"),s=Math.floor,o=r("".charAt),a=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,h=/\$([$&'`]|\d{1,2})/g;e.exports=function(t,e,i,r,u,d){var p=i+t.length,f=r.length,_=h;return void 0!==u&&(u=n(u),_=c),a(d,_,(function(n,a){var c;switch(o(a,0)){case"$":return"$";case"&":return t;case"`":return l(e,0,i);case"'":return l(e,p);case"<":c=u[l(a,1,-1)];break;default:var h=+a;if(0===h)return n;if(h>f){var d=s(h/10);return 0===d?n:d<=f?void 0===r[d-1]?o(a,1):r[d-1]+o(a,1):n}c=r[h-1]}return void 0===c?"":c}))}},{"../internals/function-uncurry-this":181,"../internals/to-object":285}],188:[function(t,e,r){(function(t){(function(){var i=function(t){return t&&t.Math===Math&&t};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],189:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/to-object"),s=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(t,e){return s(n(t),e)}},{"../internals/function-uncurry-this":181,"../internals/to-object":285}],190:[function(t,e,i){e.exports={}},{}],191:[function(t,e,i){e.exports=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(i){}}},{}],192:[function(t,e,i){var r=t("../internals/get-built-in");e.exports=r("document","documentElement")},{"../internals/get-built-in":182}],193:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/fails"),s=t("../internals/document-create-element");e.exports=!r&&!n((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},{"../internals/descriptors":153,"../internals/document-create-element":154,"../internals/fails":171}],194:[function(t,e,i){var r=Array,n=Math.abs,s=Math.pow,o=Math.floor,a=Math.log,l=Math.LN2,c=function(t,e,i){var c,h,u,d=r(i),p=8*i-e-1,f=(1<<p)-1,_=f>>1,m=23===e?s(2,-24)-s(2,-77):0,g=t<0||0===t&&1/t<0?1:0,y=0;for((t=n(t))!=t||t===1/0?(h=t!=t?1:0,c=f):(c=o(a(t)/l),t*(u=s(2,-c))<1&&(c--,u*=2),(t+=c+_>=1?m/u:m*s(2,1-_))*u>=2&&(c++,u/=2),c+_>=f?(h=0,c=f):c+_>=1?(h=(t*u-1)*s(2,e),c+=_):(h=t*s(2,_-1)*s(2,e),c=0));e>=8;)d[y++]=255&h,h/=256,e-=8;for(c=c<<e|h,p+=e;p>0;)d[y++]=255&c,c/=256,p-=8;return d[--y]|=128*g,d},h=function(t,e){var i,r=t.length,n=8*r-e-1,o=(1<<n)-1,a=o>>1,l=n-7,c=r-1,h=t[c--],u=127&h;for(h>>=7;l>0;)u=256*u+t[c--],l-=8;for(i=u&(1<<-l)-1,u>>=-l,l+=e;l>0;)i=256*i+t[c--],l-=8;if(0===u)u=1-a;else{if(u===o)return i?NaN:h?-1/0:1/0;i+=s(2,e),u-=a}return(h?-1:1)*i*s(2,u-e)};e.exports={pack:c,unpack:h}},{}],195:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/fails"),s=t("../internals/classof-raw"),o=Object,a=r("".split);e.exports=n((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"===s(t)?a(t,""):o(t)}:o},{"../internals/classof-raw":137,"../internals/fails":171,"../internals/function-uncurry-this":181}],196:[function(t,e,i){var r=t("../internals/is-callable"),n=t("../internals/is-object"),s=t("../internals/object-set-prototype-of");e.exports=function(t,e,i){var o,a;return s&&r(o=e.constructor)&&o!==i&&n(a=o.prototype)&&a!==i.prototype&&s(t,a),t}},{"../internals/is-callable":203,"../internals/is-object":208,"../internals/object-set-prototype-of":242}],197:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/is-callable"),s=t("../internals/shared-store"),o=r(Function.toString);n(s.inspectSource)||(s.inspectSource=function(t){return o(t)}),e.exports=s.inspectSource},{"../internals/function-uncurry-this":181,"../internals/is-callable":203,"../internals/shared-store":268}],198:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-uncurry-this"),s=t("../internals/hidden-keys"),o=t("../internals/is-object"),a=t("../internals/has-own-property"),l=t("../internals/object-define-property").f,c=t("../internals/object-get-own-property-names"),h=t("../internals/object-get-own-property-names-external"),u=t("../internals/object-is-extensible"),d=t("../internals/uid"),p=t("../internals/freezing"),f=!1,_=d("meta"),m=0,g=function(t){l(t,_,{value:{objectID:"O"+m++,weakData:{}}})},y=function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,_)){if(!u(t))return"F";if(!e)return"E";g(t)}return t[_].objectID},v=function(t,e){if(!a(t,_)){if(!u(t))return!0;if(!e)return!1;g(t)}return t[_].weakData},b=function(t){return p&&f&&u(t)&&!a(t,_)&&g(t),t},x=function(){T.enable=function(){},f=!0;var t=c.f,e=n([].splice),i={};i[_]=1,t(i).length&&(c.f=function(i){for(var r=t(i),n=0,s=r.length;n<s;n++)if(r[n]===_){e(r,n,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:h.f}))},T=e.exports={enable:x,fastKey:y,getWeakData:v,onFreeze:b};s[_]=!0},{"../internals/export":170,"../internals/freezing":173,"../internals/function-uncurry-this":181,"../internals/has-own-property":189,"../internals/hidden-keys":190,"../internals/is-object":208,"../internals/object-define-property":231,"../internals/object-get-own-property-names":234,"../internals/object-get-own-property-names-external":233,"../internals/object-is-extensible":237,"../internals/uid":299}],199:[function(t,e,i){var r,n,s,o=t("../internals/weak-map-basic-detection"),a=t("../internals/global"),l=t("../internals/is-object"),c=t("../internals/create-non-enumerable-property"),h=t("../internals/has-own-property"),u=t("../internals/shared-store"),d=t("../internals/shared-key"),p=t("../internals/hidden-keys"),f="Object already initialized",_=a.TypeError,m=a.WeakMap,g=function(t){return s(t)?n(t):r(t,{})},y=function(t){return function(e){var i;if(!l(e)||(i=n(e)).type!==t)throw new _("Incompatible receiver, "+t+" required");return i}};if(o||u.state){var v=u.state||(u.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,r=function(t,e){if(v.has(t))throw new _(f);return e.facade=t,v.set(t,e),e},n=function(t){return v.get(t)||{}},s=function(t){return v.has(t)}}else{var b=d("state");p[b]=!0,r=function(t,e){if(h(t,b))throw new _(f);return e.facade=t,c(t,b,e),e},n=function(t){return h(t,b)?t[b]:{}},s=function(t){return h(t,b)}}e.exports={set:r,get:n,has:s,enforce:g,getterFor:y}},{"../internals/create-non-enumerable-property":145,"../internals/global":188,"../internals/has-own-property":189,"../internals/hidden-keys":190,"../internals/is-object":208,"../internals/shared-key":267,"../internals/shared-store":268,"../internals/weak-map-basic-detection":303}],200:[function(t,e,i){var r=t("../internals/well-known-symbol"),n=t("../internals/iterators"),s=r("iterator"),o=Array.prototype;e.exports=function(t){return void 0!==t&&(n.Array===t||o[s]===t)}},{"../internals/iterators":218,"../internals/well-known-symbol":306}],201:[function(t,e,i){var r=t("../internals/classof-raw");e.exports=Array.isArray||function(t){return"Array"===r(t)}},{"../internals/classof-raw":137}],202:[function(t,e,i){var r=t("../internals/classof");e.exports=function(t){var e=r(t);return"BigInt64Array"===e||"BigUint64Array"===e}},{"../internals/classof":138}],203:[function(t,e,i){var r="object"==typeof document&&document.all;e.exports=void 0===r&&void 0!==r?function(t){return"function"==typeof t||t===r}:function(t){return"function"==typeof t}},{}],204:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/fails"),s=t("../internals/is-callable"),o=t("../internals/classof"),a=t("../internals/get-built-in"),l=t("../internals/inspect-source"),c=function(){},h=[],u=a("Reflect","construct"),d=/^\s*(?:class|function)\b/,p=r(d.exec),f=!d.test(c),_=function(t){if(!s(t))return!1;try{return u(c,h,t),!0}catch(e){return!1}},m=function(t){if(!s(t))return!1;switch(o(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(d,l(t))}catch(e){return!0}};m.sham=!0,e.exports=!u||n((function(){var t;return _(_.call)||!_(Object)||!_((function(){t=!0}))||t}))?m:_},{"../internals/classof":138,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/get-built-in":182,"../internals/inspect-source":197,"../internals/is-callable":203}],205:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/is-callable"),s=/#|\.prototype\./,o=function(t,e){var i=l[a(t)];return i===h||i!==c&&(n(e)?r(e):!!e)},a=o.normalize=function(t){return String(t).replace(s,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",h=o.POLYFILL="P";e.exports=o},{"../internals/fails":171,"../internals/is-callable":203}],206:[function(t,e,i){var r=t("../internals/is-object"),n=Math.floor;e.exports=Number.isInteger||function(t){return!r(t)&&isFinite(t)&&n(t)===t}},{"../internals/is-object":208}],207:[function(t,e,i){e.exports=function(t){return null==t}},{}],208:[function(t,e,i){var r=t("../internals/is-callable");e.exports=function(t){return"object"==typeof t?null!==t:r(t)}},{"../internals/is-callable":203}],209:[function(t,e,i){var r=t("../internals/is-object");e.exports=function(t){return r(t)||null===t}},{"../internals/is-object":208}],210:[function(t,e,i){e.exports=!1},{}],211:[function(t,e,i){var r=t("../internals/is-object"),n=t("../internals/classof-raw"),s=t("../internals/well-known-symbol")("match");e.exports=function(t){var e;return r(t)&&(void 0!==(e=t[s])?!!e:"RegExp"===n(t))}},{"../internals/classof-raw":137,"../internals/is-object":208,"../internals/well-known-symbol":306}],212:[function(t,e,i){var r=t("../internals/get-built-in"),n=t("../internals/is-callable"),s=t("../internals/object-is-prototype-of"),o=t("../internals/use-symbol-as-uid"),a=Object;e.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return n(e)&&s(e.prototype,a(t))}},{"../internals/get-built-in":182,"../internals/is-callable":203,"../internals/object-is-prototype-of":238,"../internals/use-symbol-as-uid":300}],213:[function(t,e,i){var r=t("../internals/function-bind-context"),n=t("../internals/function-call"),s=t("../internals/an-object"),o=t("../internals/try-to-string"),a=t("../internals/is-array-iterator-method"),l=t("../internals/length-of-array-like"),c=t("../internals/object-is-prototype-of"),h=t("../internals/get-iterator"),u=t("../internals/get-iterator-method"),d=t("../internals/iterator-close"),p=TypeError,f=function(t,e){this.stopped=t,this.result=e},_=f.prototype;e.exports=function(t,e,i){var m,g,y,v,b,x,T,C=i&&i.that,S=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_RECORD),A=!(!i||!i.IS_ITERATOR),E=!(!i||!i.INTERRUPTED),D=r(e,C),L=function(t){return m&&d(m,"normal",t),new f(!0,t)},I=function(t){return S?(s(t),E?D(t[0],t[1],L):D(t[0],t[1])):E?D(t,L):D(t)};if(w)m=t.iterator;else if(A)m=t;else{if(!(g=u(t)))throw new p(o(t)+" is not iterable");if(a(g)){for(y=0,v=l(t);v>y;y++)if((b=I(t[y]))&&c(_,b))return b;return new f(!1)}m=h(t,g)}for(x=w?t.next:m.next;!(T=n(x,m)).done;){try{b=I(T.value)}catch(P){d(m,"throw",P)}if("object"==typeof b&&b&&c(_,b))return b}return new f(!1)}},{"../internals/an-object":114,"../internals/function-bind-context":175,"../internals/function-call":177,"../internals/get-iterator":184,"../internals/get-iterator-method":183,"../internals/is-array-iterator-method":200,"../internals/iterator-close":214,"../internals/length-of-array-like":219,"../internals/object-is-prototype-of":238,"../internals/try-to-string":293}],214:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/an-object"),s=t("../internals/get-method");e.exports=function(t,e,i){var o,a;n(t);try{if(!(o=s(t,"return"))){if("throw"===e)throw i;return i}o=r(o,t)}catch(l){a=!0,o=l}if("throw"===e)throw i;if(a)throw o;return n(o),i}},{"../internals/an-object":114,"../internals/function-call":177,"../internals/get-method":186}],215:[function(t,e,i){var r=t("../internals/iterators-core").IteratorPrototype,n=t("../internals/object-create"),s=t("../internals/create-property-descriptor"),o=t("../internals/set-to-string-tag"),a=t("../internals/iterators"),l=function(){return this};e.exports=function(t,e,i,c){var h=e+" Iterator";return t.prototype=n(r,{next:s(+!c,i)}),o(t,h,!1,!0),a[h]=l,t}},{"../internals/create-property-descriptor":146,"../internals/iterators":218,"../internals/iterators-core":217,"../internals/object-create":229,"../internals/set-to-string-tag":266}],216:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-call"),s=t("../internals/is-pure"),o=t("../internals/function-name"),a=t("../internals/is-callable"),l=t("../internals/iterator-create-constructor"),c=t("../internals/object-get-prototype-of"),h=t("../internals/object-set-prototype-of"),u=t("../internals/set-to-string-tag"),d=t("../internals/create-non-enumerable-property"),p=t("../internals/define-built-in"),f=t("../internals/well-known-symbol"),_=t("../internals/iterators"),m=t("../internals/iterators-core"),g=o.PROPER,y=o.CONFIGURABLE,v=m.IteratorPrototype,b=m.BUGGY_SAFARI_ITERATORS,x=f("iterator"),T="keys",C="values",S="entries",w=function(){return this};e.exports=function(t,e,i,o,f,m,A){l(i,e,o);var E,D,L,I=function(t){if(t===f&&B)return B;if(!b&&t&&t in R)return R[t];switch(t){case T:case C:case S:return function(){return new i(this,t)}}return function(){return new i(this)}},P=e+" Iterator",M=!1,R=t.prototype,O=R[x]||R["@@iterator"]||f&&R[f],B=!b&&O||I(f),N="Array"===e&&R.entries||O;if(N&&(E=c(N.call(new t)))!==Object.prototype&&E.next&&(s||c(E)===v||(h?h(E,v):a(E[x])||p(E,x,w)),u(E,P,!0,!0),s&&(_[P]=w)),g&&f===C&&O&&O.name!==C&&(!s&&y?d(R,"name",C):(M=!0,B=function(){return n(O,this)})),f)if(D={values:I(C),keys:m?B:I(T),entries:I(S)},A)for(L in D)(b||M||!(L in R))&&p(R,L,D[L]);else r({target:e,proto:!0,forced:b||M},D);return s&&!A||R[x]===B||p(R,x,B,{name:f}),_[e]=B,D}},{"../internals/create-non-enumerable-property":145,"../internals/define-built-in":149,"../internals/export":170,"../internals/function-call":177,"../internals/function-name":178,"../internals/is-callable":203,"../internals/is-pure":210,"../internals/iterator-create-constructor":215,"../internals/iterators":218,"../internals/iterators-core":217,"../internals/object-get-prototype-of":236,"../internals/object-set-prototype-of":242,"../internals/set-to-string-tag":266,"../internals/well-known-symbol":306}],217:[function(t,e,i){var r,n,s,o=t("../internals/fails"),a=t("../internals/is-callable"),l=t("../internals/is-object"),c=t("../internals/object-create"),h=t("../internals/object-get-prototype-of"),u=t("../internals/define-built-in"),d=t("../internals/well-known-symbol"),p=t("../internals/is-pure"),f=d("iterator"),_=!1;[].keys&&("next"in(s=[].keys())?(n=h(h(s)))!==Object.prototype&&(r=n):_=!0);var m=!l(r)||o((function(){var t={};return r[f].call(t)!==t}));m?r={}:p&&(r=c(r)),a(r[f])||u(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:_}},{"../internals/define-built-in":149,"../internals/fails":171,"../internals/is-callable":203,"../internals/is-object":208,"../internals/is-pure":210,"../internals/object-create":229,"../internals/object-get-prototype-of":236,"../internals/well-known-symbol":306}],218:[function(t,e,i){arguments[4][190][0].apply(i,arguments)},{dup:190}],219:[function(t,e,i){var r=t("../internals/to-length");e.exports=function(t){return r(t.length)}},{"../internals/to-length":284}],220:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/fails"),s=t("../internals/is-callable"),o=t("../internals/has-own-property"),a=t("../internals/descriptors"),l=t("../internals/function-name").CONFIGURABLE,c=t("../internals/inspect-source"),h=t("../internals/internal-state"),u=h.enforce,d=h.get,p=String,f=Object.defineProperty,_=r("".slice),m=r("".replace),g=r([].join),y=a&&!n((function(){return 8!==f((function(){}),"length",{value:8}).length})),v=String(String).split("String"),b=e.exports=function(t,e,i){"Symbol("===_(p(e),0,7)&&(e="["+m(p(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!o(t,"name")||l&&t.name!==e)&&(a?f(t,"name",{value:e,configurable:!0}):t.name=e),y&&i&&o(i,"arity")&&t.length!==i.arity&&f(t,"length",{value:i.arity});try{i&&o(i,"constructor")&&i.constructor?a&&f(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(n){}var r=u(t);return o(r,"source")||(r.source=g(v,"string"==typeof e?e:"")),t};Function.prototype.toString=b((function(){return s(this)&&d(this).source||c(this)}),"toString")},{"../internals/descriptors":153,"../internals/fails":171,"../internals/function-name":178,"../internals/function-uncurry-this":181,"../internals/has-own-property":189,"../internals/inspect-source":197,"../internals/internal-state":199,"../internals/is-callable":203}],221:[function(t,e,i){var r=t("../internals/math-sign"),n=Math.abs,s=2220446049250313e-31,o=1/s,a=function(t){return t+o-o};e.exports=function(t,e,i,o){var l=+t,c=n(l),h=r(l);if(c<o)return h*a(c/o/e)*o*e;var u=(1+e/s)*c,d=u-(u-c);return d>i||d!=d?h*(1/0):h*d}},{"../internals/math-sign":223}],222:[function(t,e,i){var r=t("../internals/math-float-round"),n=1.1920928955078125e-7,s=34028234663852886e22,o=11754943508222875e-54;e.exports=Math.fround||function(t){return r(t,n,s,o)}},{"../internals/math-float-round":221}],223:[function(t,e,i){e.exports=Math.sign||function(t){var e=+t;return 0===e||e!=e?e:e<0?-1:1}},{}],224:[function(t,e,i){var r=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(t){var e=+t;return(e>0?n:r)(e)}},{}],225:[function(t,e,i){var r,n,s,o,a,l=t("../internals/global"),c=t("../internals/safe-get-built-in"),h=t("../internals/function-bind-context"),u=t("../internals/task").set,d=t("../internals/queue"),p=t("../internals/engine-is-ios"),f=t("../internals/engine-is-ios-pebble"),_=t("../internals/engine-is-webos-webkit"),m=t("../internals/engine-is-node"),g=l.MutationObserver||l.WebKitMutationObserver,y=l.document,v=l.process,b=l.Promise,x=c("queueMicrotask");if(!x){var T=new d,C=function(){var t,e;for(m&&(t=v.domain)&&t.exit();e=T.get();)try{e()}catch(i){throw T.head&&r(),i}t&&t.enter()};p||m||_||!g||!y?!f&&b&&b.resolve?((o=b.resolve(void 0)).constructor=b,a=h(o.then,o),r=function(){a(C)}):m?r=function(){v.nextTick(C)}:(u=h(u,l),r=function(){u(C)}):(n=!0,s=y.createTextNode(""),new g(C).observe(s,{characterData:!0}),r=function(){s.data=n=!n}),x=function(t){T.head||r(),T.add(t)}}e.exports=x},{"../internals/engine-is-ios":163,"../internals/engine-is-ios-pebble":162,"../internals/engine-is-node":164,"../internals/engine-is-webos-webkit":165,"../internals/function-bind-context":175,"../internals/global":188,"../internals/queue":254,"../internals/safe-get-built-in":263,"../internals/task":277}],226:[function(t,e,i){var r=t("../internals/a-callable"),n=TypeError,s=function(t){var e,i;this.promise=new t((function(t,r){if(void 0!==e||void 0!==i)throw new n("Bad Promise constructor");e=t,i=r})),this.resolve=r(e),this.reject=r(i)};e.exports.f=function(t){return new s(t)}},{"../internals/a-callable":108}],227:[function(t,e,i){var r=t("../internals/is-regexp"),n=TypeError;e.exports=function(t){if(r(t))throw new n("The method doesn't accept regular expressions");return t}},{"../internals/is-regexp":211}],228:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/function-uncurry-this"),s=t("../internals/function-call"),o=t("../internals/fails"),a=t("../internals/object-keys"),l=t("../internals/object-get-own-property-symbols"),c=t("../internals/object-property-is-enumerable"),h=t("../internals/to-object"),u=t("../internals/indexed-object"),d=Object.assign,p=Object.defineProperty,f=n([].concat);e.exports=!d||o((function(){if(r&&1!==d({b:1},d(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},i=Symbol("assign detection"),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach((function(t){e[t]=t})),7!==d({},t)[i]||a(d({},e)).join("")!==n}))?function(t,e){for(var i=h(t),n=arguments.length,o=1,d=l.f,p=c.f;n>o;)for(var _,m=u(arguments[o++]),g=d?f(a(m),d(m)):a(m),y=g.length,v=0;y>v;)_=g[v++],r&&!s(p,m,_)||(i[_]=m[_]);return i}:d},{"../internals/descriptors":153,"../internals/fails":171,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/indexed-object":195,"../internals/object-get-own-property-symbols":235,"../internals/object-keys":240,"../internals/object-property-is-enumerable":241,"../internals/to-object":285}],229:[function(t,e,i){var r,n=t("../internals/an-object"),s=t("../internals/object-define-properties"),o=t("../internals/enum-bug-keys"),a=t("../internals/hidden-keys"),l=t("../internals/html"),c=t("../internals/document-create-element"),h=t("../internals/shared-key"),u=">",d="<",p="prototype",f="script",_=h("IE_PROTO"),m=function(){},g=function(t){return d+f+u+t+d+"/"+f+u},y=function(t){t.write(g("")),t.close();var e=t.parentWindow.Object;return t=null,e},v=function(){var t,e=c("iframe"),i="java"+f+":";return e.style.display="none",l.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(g("document.F=Object")),t.close(),t.F},b=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}b="undefined"!=typeof document?document.domain&&r?y(r):v():y(r);for(var t=o.length;t--;)delete b[p][o[t]];return b()};a[_]=!0,e.exports=Object.create||function(t,e){var i;return null!==t?(m[p]=n(t),i=new m,m[p]=null,i[_]=t):i=b(),void 0===e?i:s.f(i,e)}},{"../internals/an-object":114,"../internals/document-create-element":154,"../internals/enum-bug-keys":169,"../internals/hidden-keys":190,"../internals/html":192,"../internals/object-define-properties":230,"../internals/shared-key":267}],230:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/v8-prototype-define-bug"),s=t("../internals/object-define-property"),o=t("../internals/an-object"),a=t("../internals/to-indexed-object"),l=t("../internals/object-keys");i.f=r&&!n?Object.defineProperties:function(t,e){o(t);for(var i,r=a(e),n=l(e),c=n.length,h=0;c>h;)s.f(t,i=n[h++],r[i]);return t}},{"../internals/an-object":114,"../internals/descriptors":153,"../internals/object-define-property":231,"../internals/object-keys":240,"../internals/to-indexed-object":282,"../internals/v8-prototype-define-bug":301}],231:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/ie8-dom-define"),s=t("../internals/v8-prototype-define-bug"),o=t("../internals/an-object"),a=t("../internals/to-property-key"),l=TypeError,c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";i.f=r?s?function(t,e,i){if(o(t),e=a(e),o(i),"function"==typeof t&&"prototype"===e&&"value"in i&&p in i&&!i[p]){var r=h(t,e);r&&r[p]&&(t[e]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return c(t,e,i)}:c:function(t,e,i){if(o(t),e=a(e),o(i),n)try{return c(t,e,i)}catch(r){}if("get"in i||"set"in i)throw new l("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},{"../internals/an-object":114,"../internals/descriptors":153,"../internals/ie8-dom-define":193,"../internals/to-property-key":289,"../internals/v8-prototype-define-bug":301}],232:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/function-call"),s=t("../internals/object-property-is-enumerable"),o=t("../internals/create-property-descriptor"),a=t("../internals/to-indexed-object"),l=t("../internals/to-property-key"),c=t("../internals/has-own-property"),h=t("../internals/ie8-dom-define"),u=Object.getOwnPropertyDescriptor;i.f=r?u:function(t,e){if(t=a(t),e=l(e),h)try{return u(t,e)}catch(i){}if(c(t,e))return o(!n(s.f,t,e),t[e])}},{"../internals/create-property-descriptor":146,"../internals/descriptors":153,"../internals/function-call":177,"../internals/has-own-property":189,"../internals/ie8-dom-define":193,"../internals/object-property-is-enumerable":241,"../internals/to-indexed-object":282,"../internals/to-property-key":289}],233:[function(t,e,i){var r=t("../internals/classof-raw"),n=t("../internals/to-indexed-object"),s=t("../internals/object-get-own-property-names").f,o=t("../internals/array-slice"),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],l=function(t){try{return s(t)}catch(e){return o(a)}};e.exports.f=function(t){return a&&"Window"===r(t)?l(t):s(n(t))}},{"../internals/array-slice":131,"../internals/classof-raw":137,"../internals/object-get-own-property-names":234,"../internals/to-indexed-object":282}],234:[function(t,e,i){var r=t("../internals/object-keys-internal"),n=t("../internals/enum-bug-keys").concat("length","prototype");i.f=Object.getOwnPropertyNames||function(t){return r(t,n)}},{"../internals/enum-bug-keys":169,"../internals/object-keys-internal":239}],235:[function(t,e,i){i.f=Object.getOwnPropertySymbols},{}],236:[function(t,e,i){var r=t("../internals/has-own-property"),n=t("../internals/is-callable"),s=t("../internals/to-object"),o=t("../internals/shared-key"),a=t("../internals/correct-prototype-getter"),l=o("IE_PROTO"),c=Object,h=c.prototype;e.exports=a?c.getPrototypeOf:function(t){var e=s(t);if(r(e,l))return e[l];var i=e.constructor;return n(i)&&e instanceof i?i.prototype:e instanceof c?h:null}},{"../internals/correct-prototype-getter":143,"../internals/has-own-property":189,"../internals/is-callable":203,"../internals/shared-key":267,"../internals/to-object":285}],237:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/is-object"),s=t("../internals/classof-raw"),o=t("../internals/array-buffer-non-extensible"),a=Object.isExtensible,l=r((function(){}));e.exports=l||o?function(t){return!!n(t)&&(!o||"ArrayBuffer"!==s(t))&&(!a||a(t))}:a},{"../internals/array-buffer-non-extensible":116,"../internals/classof-raw":137,"../internals/fails":171,"../internals/is-object":208}],238:[function(t,e,i){var r=t("../internals/function-uncurry-this");e.exports=r({}.isPrototypeOf)},{"../internals/function-uncurry-this":181}],239:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/has-own-property"),s=t("../internals/to-indexed-object"),o=t("../internals/array-includes").indexOf,a=t("../internals/hidden-keys"),l=r([].push);e.exports=function(t,e){var i,r=s(t),c=0,h=[];for(i in r)!n(a,i)&&n(r,i)&&l(h,i);for(;e.length>c;)n(r,i=e[c++])&&(~o(h,i)||l(h,i));return h}},{"../internals/array-includes":124,"../internals/function-uncurry-this":181,"../internals/has-own-property":189,"../internals/hidden-keys":190,"../internals/to-indexed-object":282}],240:[function(t,e,i){var r=t("../internals/object-keys-internal"),n=t("../internals/enum-bug-keys");e.exports=Object.keys||function(t){return r(t,n)}},{"../internals/enum-bug-keys":169,"../internals/object-keys-internal":239}],241:[function(t,e,i){var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!r.call({1:2},1);i.f=s?function(t){var e=n(this,t);return!!e&&e.enumerable}:r},{}],242:[function(t,e,i){var r=t("../internals/function-uncurry-this-accessor"),n=t("../internals/an-object"),s=t("../internals/a-possible-prototype");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=r(Object.prototype,"__proto__","set"))(i,[]),e=i instanceof Array}catch(o){}return function(i,r){return n(i),s(r),e?t(i,r):i.__proto__=r,i}}():void 0)},{"../internals/a-possible-prototype":110,"../internals/an-object":114,"../internals/function-uncurry-this-accessor":179}],243:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/fails"),s=t("../internals/function-uncurry-this"),o=t("../internals/object-get-prototype-of"),a=t("../internals/object-keys"),l=t("../internals/to-indexed-object"),c=s(t("../internals/object-property-is-enumerable").f),h=s([].push),u=r&&n((function(){var t=Object.create(null);return t[2]=2,!c(t,2)})),d=function(t){return function(e){for(var i,n=l(e),s=a(n),d=u&&null===o(n),p=s.length,f=0,_=[];p>f;)i=s[f++],r&&!(d?i in n:c(n,i))||h(_,t?[i,n[i]]:n[i]);return _}};e.exports={entries:d(!0),values:d(!1)}},{"../internals/descriptors":153,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/object-get-prototype-of":236,"../internals/object-keys":240,"../internals/object-property-is-enumerable":241,"../internals/to-indexed-object":282}],244:[function(t,e,i){var r=t("../internals/to-string-tag-support"),n=t("../internals/classof");e.exports=r?{}.toString:function(){return"[object "+n(this)+"]"}},{"../internals/classof":138,"../internals/to-string-tag-support":290}],245:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/is-callable"),s=t("../internals/is-object"),o=TypeError;e.exports=function(t,e){var i,a;if("string"===e&&n(i=t.toString)&&!s(a=r(i,t)))return a;if(n(i=t.valueOf)&&!s(a=r(i,t)))return a;if("string"!==e&&n(i=t.toString)&&!s(a=r(i,t)))return a;throw new o("Can't convert object to primitive value")}},{"../internals/function-call":177,"../internals/is-callable":203,"../internals/is-object":208}],246:[function(t,e,i){var r=t("../internals/get-built-in"),n=t("../internals/function-uncurry-this"),s=t("../internals/object-get-own-property-names"),o=t("../internals/object-get-own-property-symbols"),a=t("../internals/an-object"),l=n([].concat);e.exports=r("Reflect","ownKeys")||function(t){var e=s.f(a(t)),i=o.f;return i?l(e,i(t)):e}},{"../internals/an-object":114,"../internals/function-uncurry-this":181,"../internals/get-built-in":182,"../internals/object-get-own-property-names":234,"../internals/object-get-own-property-symbols":235}],247:[function(t,e,i){var r=t("../internals/global");e.exports=r},{"../internals/global":188}],248:[function(t,e,i){e.exports=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}}},{}],249:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/promise-native-constructor"),s=t("../internals/is-callable"),o=t("../internals/is-forced"),a=t("../internals/inspect-source"),l=t("../internals/well-known-symbol"),c=t("../internals/engine-is-browser"),h=t("../internals/engine-is-deno"),u=t("../internals/is-pure"),d=t("../internals/engine-v8-version"),p=n&&n.prototype,f=l("species"),_=!1,m=s(r.PromiseRejectionEvent),g=o("Promise",(function(){var t=a(n),e=t!==String(n);if(!e&&66===d)return!0;if(u&&(!p.catch||!p.finally))return!0;if(!d||d<51||!/native code/.test(t)){var i=new n((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};if((i.constructor={})[f]=r,!(_=i.then((function(){}))instanceof r))return!0}return!e&&(c||h)&&!m}));e.exports={CONSTRUCTOR:g,REJECTION_EVENT:m,SUBCLASSING:_}},{"../internals/engine-is-browser":159,"../internals/engine-is-deno":160,"../internals/engine-v8-version":167,"../internals/global":188,"../internals/inspect-source":197,"../internals/is-callable":203,"../internals/is-forced":205,"../internals/is-pure":210,"../internals/promise-native-constructor":250,"../internals/well-known-symbol":306}],250:[function(t,e,i){var r=t("../internals/global");e.exports=r.Promise},{"../internals/global":188}],251:[function(t,e,i){var r=t("../internals/an-object"),n=t("../internals/is-object"),s=t("../internals/new-promise-capability");e.exports=function(t,e){if(r(t),n(e)&&e.constructor===t)return e;var i=s.f(t);return(0,i.resolve)(e),i.promise}},{"../internals/an-object":114,"../internals/is-object":208,"../internals/new-promise-capability":226}],252:[function(t,e,i){var r=t("../internals/promise-native-constructor"),n=t("../internals/check-correctness-of-iteration"),s=t("../internals/promise-constructor-detection").CONSTRUCTOR;e.exports=s||!n((function(t){r.all(t).then(void 0,(function(){}))}))},{"../internals/check-correctness-of-iteration":136,"../internals/promise-constructor-detection":249,"../internals/promise-native-constructor":250}],253:[function(t,e,i){var r=t("../internals/object-define-property").f;e.exports=function(t,e,i){i in t||r(t,i,{configurable:!0,get:function(){return e[i]},set:function(t){e[i]=t}})}},{"../internals/object-define-property":231}],254:[function(t,e,i){var r=function(){this.head=null,this.tail=null};r.prototype={add:function(t){var e={item:t,next:null},i=this.tail;i?i.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},e.exports=r},{}],255:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/an-object"),s=t("../internals/is-callable"),o=t("../internals/classof-raw"),a=t("../internals/regexp-exec"),l=TypeError;e.exports=function(t,e){var i=t.exec;if(s(i)){var c=r(i,t,e);return null!==c&&n(c),c}if("RegExp"===o(t))return r(a,t,e);throw new l("RegExp#exec called on incompatible receiver")}},{"../internals/an-object":114,"../internals/classof-raw":137,"../internals/function-call":177,"../internals/is-callable":203,"../internals/regexp-exec":256}],256:[function(t,e,i){var r,n,s=t("../internals/function-call"),o=t("../internals/function-uncurry-this"),a=t("../internals/to-string"),l=t("../internals/regexp-flags"),c=t("../internals/regexp-sticky-helpers"),h=t("../internals/shared"),u=t("../internals/object-create"),d=t("../internals/internal-state").get,p=t("../internals/regexp-unsupported-dot-all"),f=t("../internals/regexp-unsupported-ncg"),_=h("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,g=m,y=o("".charAt),v=o("".indexOf),b=o("".replace),x=o("".slice),T=(n=/b*/g,s(m,r=/a/,"a"),s(m,n,"a"),0!==r.lastIndex||0!==n.lastIndex),C=c.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(T||S||C||p||f)&&(g=function(t){var e,i,r,n,o,c,h,p=this,f=d(p),w=a(t),A=f.raw;if(A)return A.lastIndex=p.lastIndex,e=s(g,A,w),p.lastIndex=A.lastIndex,e;var E=f.groups,D=C&&p.sticky,L=s(l,p),I=p.source,P=0,M=w;if(D&&(L=b(L,"y",""),-1===v(L,"g")&&(L+="g"),M=x(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==y(w,p.lastIndex-1))&&(I="(?: "+I+")",M=" "+M,P++),i=new RegExp("^(?:"+I+")",L)),S&&(i=new RegExp("^"+I+"$(?!\\s)",L)),T&&(r=p.lastIndex),n=s(m,D?i:p,M),D?n?(n.input=x(n.input,P),n[0]=x(n[0],P),n.index=p.lastIndex,p.lastIndex+=n[0].length):p.lastIndex=0:T&&n&&(p.lastIndex=p.global?n.index+n[0].length:r),S&&n&&n.length>1&&s(_,n[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(n[o]=void 0)})),n&&E)for(n.groups=c=u(null),o=0;o<E.length;o++)c[(h=E[o])[0]]=n[h[1]];return n}),e.exports=g},{"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/internal-state":199,"../internals/object-create":229,"../internals/regexp-flags":257,"../internals/regexp-sticky-helpers":259,"../internals/regexp-unsupported-dot-all":260,"../internals/regexp-unsupported-ncg":261,"../internals/shared":269,"../internals/to-string":291}],257:[function(t,e,i){var r=t("../internals/an-object");e.exports=function(){var t=r(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},{"../internals/an-object":114}],258:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/has-own-property"),s=t("../internals/object-is-prototype-of"),o=t("../internals/regexp-flags"),a=RegExp.prototype;e.exports=function(t){var e=t.flags;return void 0!==e||"flags"in a||n(t,"flags")||!s(a,t)?e:r(o,t)}},{"../internals/function-call":177,"../internals/has-own-property":189,"../internals/object-is-prototype-of":238,"../internals/regexp-flags":257}],259:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/global").RegExp,s=r((function(){var t=n("a","y");return t.lastIndex=2,null!==t.exec("abcd")})),o=s||r((function(){return!n("a","y").sticky})),a=s||r((function(){var t=n("^r","gy");return t.lastIndex=2,null!==t.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:o,UNSUPPORTED_Y:s}},{"../internals/fails":171,"../internals/global":188}],260:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/global").RegExp;e.exports=r((function(){var t=n(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)}))},{"../internals/fails":171,"../internals/global":188}],261:[function(t,e,i){var r=t("../internals/fails"),n=t("../internals/global").RegExp;e.exports=r((function(){var t=n("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")}))},{"../internals/fails":171,"../internals/global":188}],262:[function(t,e,i){var r=t("../internals/is-null-or-undefined"),n=TypeError;e.exports=function(t){if(r(t))throw new n("Can't call method on "+t);return t}},{"../internals/is-null-or-undefined":207}],263:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/descriptors"),s=Object.getOwnPropertyDescriptor;e.exports=function(t){if(!n)return r[t];var e=s(r,t);return e&&e.value}},{"../internals/descriptors":153,"../internals/global":188}],264:[function(t,e,i){e.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},{}],265:[function(t,e,i){var r=t("../internals/get-built-in"),n=t("../internals/define-built-in-accessor"),s=t("../internals/well-known-symbol"),o=t("../internals/descriptors"),a=s("species");e.exports=function(t){var e=r(t);o&&e&&!e[a]&&n(e,a,{configurable:!0,get:function(){return this}})}},{"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/get-built-in":182,"../internals/well-known-symbol":306}],266:[function(t,e,i){var r=t("../internals/object-define-property").f,n=t("../internals/has-own-property"),s=t("../internals/well-known-symbol")("toStringTag");e.exports=function(t,e,i){t&&!i&&(t=t.prototype),t&&!n(t,s)&&r(t,s,{configurable:!0,value:e})}},{"../internals/has-own-property":189,"../internals/object-define-property":231,"../internals/well-known-symbol":306}],267:[function(t,e,i){var r=t("../internals/shared"),n=t("../internals/uid"),s=r("keys");e.exports=function(t){return s[t]||(s[t]=n(t))}},{"../internals/shared":269,"../internals/uid":299}],268:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/define-global-property"),s="__core-js_shared__",o=r[s]||n(s,{});e.exports=o},{"../internals/define-global-property":151,"../internals/global":188}],269:[function(t,e,i){var r=t("../internals/is-pure"),n=t("../internals/shared-store");(e.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.35.0",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.0/LICENSE",source:"https://github.com/zloirock/core-js"})},{"../internals/is-pure":210,"../internals/shared-store":268}],270:[function(t,e,i){var r=t("../internals/an-object"),n=t("../internals/a-constructor"),s=t("../internals/is-null-or-undefined"),o=t("../internals/well-known-symbol")("species");e.exports=function(t,e){var i,a=r(t).constructor;return void 0===a||s(i=r(a)[o])?e:n(i)}},{"../internals/a-constructor":109,"../internals/an-object":114,"../internals/is-null-or-undefined":207,"../internals/well-known-symbol":306}],271:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/to-integer-or-infinity"),s=t("../internals/to-string"),o=t("../internals/require-object-coercible"),a=r("".charAt),l=r("".charCodeAt),c=r("".slice),h=function(t){return function(e,i){var r,h,u=s(o(e)),d=n(i),p=u.length;return d<0||d>=p?t?"":void 0:(r=l(u,d))<55296||r>56319||d+1===p||(h=l(u,d+1))<56320||h>57343?t?a(u,d):r:t?c(u,d,d+2):h-56320+(r-55296<<10)+65536}};e.exports={codeAt:h(!1),charAt:h(!0)}},{"../internals/function-uncurry-this":181,"../internals/require-object-coercible":262,"../internals/to-integer-or-infinity":283,"../internals/to-string":291}],272:[function(t,e,i){var r=t("../internals/function-name").PROPER,n=t("../internals/fails"),s=t("../internals/whitespaces"),o="​᠎";e.exports=function(t){return n((function(){return!!s[t]()||o[t]()!==o||r&&s[t].name!==t}))}},{"../internals/fails":171,"../internals/function-name":178,"../internals/whitespaces":307}],273:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/require-object-coercible"),s=t("../internals/to-string"),o=t("../internals/whitespaces"),a=r("".replace),l=RegExp("^["+o+"]+"),c=RegExp("(^|[^"+o+"])["+o+"]+$"),h=function(t){return function(e){var i=s(n(e));return 1&t&&(i=a(i,l,"")),2&t&&(i=a(i,c,"$1")),i}};e.exports={start:h(1),end:h(2),trim:h(3)}},{"../internals/function-uncurry-this":181,"../internals/require-object-coercible":262,"../internals/to-string":291,"../internals/whitespaces":307}],274:[function(t,e,i){var r=t("../internals/engine-v8-version"),n=t("../internals/fails"),s=t("../internals/global").String;e.exports=!!Object.getOwnPropertySymbols&&!n((function(){var t=Symbol("symbol detection");return!s(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},{"../internals/engine-v8-version":167,"../internals/fails":171,"../internals/global":188}],275:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/get-built-in"),s=t("../internals/well-known-symbol"),o=t("../internals/define-built-in");e.exports=function(){var t=n("Symbol"),e=t&&t.prototype,i=e&&e.valueOf,a=s("toPrimitive");e&&!e[a]&&o(e,a,(function(t){return r(i,this)}),{arity:1})}},{"../internals/define-built-in":149,"../internals/function-call":177,"../internals/get-built-in":182,"../internals/well-known-symbol":306}],276:[function(t,e,i){var r=t("../internals/symbol-constructor-detection");e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},{"../internals/symbol-constructor-detection":274}],277:[function(t,e,i){var r,n,s,o,a=t("../internals/global"),l=t("../internals/function-apply"),c=t("../internals/function-bind-context"),h=t("../internals/is-callable"),u=t("../internals/has-own-property"),d=t("../internals/fails"),p=t("../internals/html"),f=t("../internals/array-slice"),_=t("../internals/document-create-element"),m=t("../internals/validate-arguments-length"),g=t("../internals/engine-is-ios"),y=t("../internals/engine-is-node"),v=a.setImmediate,b=a.clearImmediate,x=a.process,T=a.Dispatch,C=a.Function,S=a.MessageChannel,w=a.String,A=0,E={},D="onreadystatechange";d((function(){r=a.location}));var L=function(t){if(u(E,t)){var e=E[t];delete E[t],e()}},I=function(t){return function(){L(t)}},P=function(t){L(t.data)},M=function(t){a.postMessage(w(t),r.protocol+"//"+r.host)};v&&b||(v=function(t){m(arguments.length,1);var e=h(t)?t:C(t),i=f(arguments,1);return E[++A]=function(){l(e,void 0,i)},n(A),A},b=function(t){delete E[t]},y?n=function(t){x.nextTick(I(t))}:T&&T.now?n=function(t){T.now(I(t))}:S&&!g?(o=(s=new S).port2,s.port1.onmessage=P,n=c(o.postMessage,o)):a.addEventListener&&h(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!d(M)?(n=M,a.addEventListener("message",P,!1)):n=D in _("script")?function(t){p.appendChild(_("script"))[D]=function(){p.removeChild(this),L(t)}}:function(t){setTimeout(I(t),0)}),e.exports={set:v,clear:b}},{"../internals/array-slice":131,"../internals/document-create-element":154,"../internals/engine-is-ios":163,"../internals/engine-is-node":164,"../internals/fails":171,"../internals/function-apply":174,"../internals/function-bind-context":175,"../internals/global":188,"../internals/has-own-property":189,"../internals/html":192,"../internals/is-callable":203,"../internals/validate-arguments-length":302}],278:[function(t,e,i){var r=t("../internals/function-uncurry-this");e.exports=r(1..valueOf)},{"../internals/function-uncurry-this":181}],279:[function(t,e,i){var r=t("../internals/to-integer-or-infinity"),n=Math.max,s=Math.min;e.exports=function(t,e){var i=r(t);return i<0?n(i+e,0):s(i,e)}},{"../internals/to-integer-or-infinity":283}],280:[function(t,e,i){var r=t("../internals/to-primitive"),n=TypeError;e.exports=function(t){var e=r(t,"number");if("number"==typeof e)throw new n("Can't convert number to bigint");return BigInt(e)}},{"../internals/to-primitive":288}],281:[function(t,e,i){var r=t("../internals/to-integer-or-infinity"),n=t("../internals/to-length"),s=RangeError;e.exports=function(t){if(void 0===t)return 0;var e=r(t),i=n(e);if(e!==i)throw new s("Wrong length or index");return i}},{"../internals/to-integer-or-infinity":283,"../internals/to-length":284}],282:[function(t,e,i){var r=t("../internals/indexed-object"),n=t("../internals/require-object-coercible");e.exports=function(t){return r(n(t))}},{"../internals/indexed-object":195,"../internals/require-object-coercible":262}],283:[function(t,e,i){var r=t("../internals/math-trunc");e.exports=function(t){var e=+t;return e!=e||0===e?0:r(e)}},{"../internals/math-trunc":224}],284:[function(t,e,i){var r=t("../internals/to-integer-or-infinity"),n=Math.min;e.exports=function(t){return t>0?n(r(t),9007199254740991):0}},{"../internals/to-integer-or-infinity":283}],285:[function(t,e,i){var r=t("../internals/require-object-coercible"),n=Object;e.exports=function(t){return n(r(t))}},{"../internals/require-object-coercible":262}],286:[function(t,e,i){var r=t("../internals/to-positive-integer"),n=RangeError;e.exports=function(t,e){var i=r(t);if(i%e)throw new n("Wrong offset");return i}},{"../internals/to-positive-integer":287}],287:[function(t,e,i){var r=t("../internals/to-integer-or-infinity"),n=RangeError;e.exports=function(t){var e=r(t);if(e<0)throw new n("The argument can't be less than 0");return e}},{"../internals/to-integer-or-infinity":283}],288:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/is-object"),s=t("../internals/is-symbol"),o=t("../internals/get-method"),a=t("../internals/ordinary-to-primitive"),l=t("../internals/well-known-symbol"),c=TypeError,h=l("toPrimitive");e.exports=function(t,e){if(!n(t)||s(t))return t;var i,l=o(t,h);if(l){if(void 0===e&&(e="default"),i=r(l,t,e),!n(i)||s(i))return i;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},{"../internals/function-call":177,"../internals/get-method":186,"../internals/is-object":208,"../internals/is-symbol":212,"../internals/ordinary-to-primitive":245,"../internals/well-known-symbol":306}],289:[function(t,e,i){var r=t("../internals/to-primitive"),n=t("../internals/is-symbol");e.exports=function(t){var e=r(t,"string");return n(e)?e:e+""}},{"../internals/is-symbol":212,"../internals/to-primitive":288}],290:[function(t,e,i){var r={};r[t("../internals/well-known-symbol")("toStringTag")]="z",e.exports="[object z]"===String(r)},{"../internals/well-known-symbol":306}],291:[function(t,e,i){var r=t("../internals/classof"),n=String;e.exports=function(t){if("Symbol"===r(t))throw new TypeError("Cannot convert a Symbol value to a string");return n(t)}},{"../internals/classof":138}],292:[function(t,e,i){var r=Math.round;e.exports=function(t){var e=r(t);return e<0?0:e>255?255:255&e}},{}],293:[function(t,e,i){var r=String;e.exports=function(t){try{return r(t)}catch(e){return"Object"}}},{}],294:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/global"),s=t("../internals/function-call"),o=t("../internals/descriptors"),a=t("../internals/typed-array-constructors-require-wrappers"),l=t("../internals/array-buffer-view-core"),c=t("../internals/array-buffer"),h=t("../internals/an-instance"),u=t("../internals/create-property-descriptor"),d=t("../internals/create-non-enumerable-property"),p=t("../internals/is-integral-number"),f=t("../internals/to-length"),_=t("../internals/to-index"),m=t("../internals/to-offset"),g=t("../internals/to-uint8-clamped"),y=t("../internals/to-property-key"),v=t("../internals/has-own-property"),b=t("../internals/classof"),x=t("../internals/is-object"),T=t("../internals/is-symbol"),C=t("../internals/object-create"),S=t("../internals/object-is-prototype-of"),w=t("../internals/object-set-prototype-of"),A=t("../internals/object-get-own-property-names").f,E=t("../internals/typed-array-from"),D=t("../internals/array-iteration").forEach,L=t("../internals/set-species"),I=t("../internals/define-built-in-accessor"),P=t("../internals/object-define-property"),M=t("../internals/object-get-own-property-descriptor"),R=t("../internals/array-from-constructor-and-list"),O=t("../internals/internal-state"),B=t("../internals/inherit-if-required"),N=O.get,k=O.set,F=O.enforce,V=P.f,j=M.f,G=n.RangeError,U=c.ArrayBuffer,Y=U.prototype,H=c.DataView,X=l.NATIVE_ARRAY_BUFFER_VIEWS,z=l.TYPED_ARRAY_TAG,W=l.TypedArray,Z=l.TypedArrayPrototype,J=l.isTypedArray,q="BYTES_PER_ELEMENT",K="Wrong length",Q=function(t,e){I(t,e,{configurable:!0,get:function(){return N(this)[e]}})},$=function(t){var e;return S(Y,t)||"ArrayBuffer"===(e=b(t))||"SharedArrayBuffer"===e},tt=function(t,e){return J(t)&&!T(e)&&e in t&&p(+e)&&e>=0},et=function(t,e){return e=y(e),tt(t,e)?u(2,t[e]):j(t,e)},it=function(t,e,i){return e=y(e),!(tt(t,e)&&x(i)&&v(i,"value"))||v(i,"get")||v(i,"set")||i.configurable||v(i,"writable")&&!i.writable||v(i,"enumerable")&&!i.enumerable?V(t,e,i):(t[e]=i.value,t)};o?(X||(M.f=et,P.f=it,Q(Z,"buffer"),Q(Z,"byteOffset"),Q(Z,"byteLength"),Q(Z,"length")),r({target:"Object",stat:!0,forced:!X},{getOwnPropertyDescriptor:et,defineProperty:it}),e.exports=function(t,e,i){var o=t.match(/\d+/)[0]/8,l=t+(i?"Clamped":"")+"Array",c="get"+t,u="set"+t,p=n[l],y=p,v=y&&y.prototype,b={},T=function(t,e){var i=N(t);return i.view[c](e*o+i.byteOffset,!0)},S=function(t,e,r){var n=N(t);n.view[u](e*o+n.byteOffset,i?g(r):r,!0)},I=function(t,e){V(t,e,{get:function(){return T(this,e)},set:function(t){return S(this,e,t)},enumerable:!0})};X?a&&(y=e((function(t,e,i,r){return h(t,v),B(x(e)?$(e)?void 0!==r?new p(e,m(i,o),r):void 0!==i?new p(e,m(i,o)):new p(e):J(e)?R(y,e):s(E,y,e):new p(_(e)),t,y)})),w&&w(y,W),D(A(p),(function(t){t in y||d(y,t,p[t])})),y.prototype=v):(y=e((function(t,e,i,r){h(t,v);var n,a,l,c=0,u=0;if(x(e)){if(!$(e))return J(e)?R(y,e):s(E,y,e);n=e,u=m(i,o);var d=e.byteLength;if(void 0===r){if(d%o)throw new G(K);if((a=d-u)<0)throw new G(K)}else if((a=f(r)*o)+u>d)throw new G(K);l=a/o}else l=_(e),n=new U(a=l*o);for(k(t,{buffer:n,byteOffset:u,byteLength:a,length:l,view:new H(n)});c<l;)I(t,c++)})),w&&w(y,W),v=y.prototype=C(Z)),v.constructor!==y&&d(v,"constructor",y),F(v).TypedArrayConstructor=y,z&&d(v,z,l);var P=y!==p;b[l]=y,r({global:!0,constructor:!0,forced:P,sham:!X},b),q in y||d(y,q,o),q in v||d(v,q,o),L(l)}):e.exports=function(){}},{"../internals/an-instance":113,"../internals/array-buffer":118,"../internals/array-buffer-view-core":117,"../internals/array-from-constructor-and-list":122,"../internals/array-iteration":125,"../internals/classof":138,"../internals/create-non-enumerable-property":145,"../internals/create-property-descriptor":146,"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/export":170,"../internals/function-call":177,"../internals/global":188,"../internals/has-own-property":189,"../internals/inherit-if-required":196,"../internals/internal-state":199,"../internals/is-integral-number":206,"../internals/is-object":208,"../internals/is-symbol":212,"../internals/object-create":229,"../internals/object-define-property":231,"../internals/object-get-own-property-descriptor":232,"../internals/object-get-own-property-names":234,"../internals/object-is-prototype-of":238,"../internals/object-set-prototype-of":242,"../internals/set-species":265,"../internals/to-index":281,"../internals/to-length":284,"../internals/to-offset":286,"../internals/to-property-key":289,"../internals/to-uint8-clamped":292,"../internals/typed-array-constructors-require-wrappers":295,"../internals/typed-array-from":297}],295:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/fails"),s=t("../internals/check-correctness-of-iteration"),o=t("../internals/array-buffer-view-core").NATIVE_ARRAY_BUFFER_VIEWS,a=r.ArrayBuffer,l=r.Int8Array;e.exports=!o||!n((function(){l(1)}))||!n((function(){new l(-1)}))||!s((function(t){new l,new l(null),new l(1.5),new l(t)}),!0)||n((function(){return 1!==new l(new a(2),1,void 0).length}))},{"../internals/array-buffer-view-core":117,"../internals/check-correctness-of-iteration":136,"../internals/fails":171,"../internals/global":188}],296:[function(t,e,i){var r=t("../internals/array-from-constructor-and-list"),n=t("../internals/typed-array-species-constructor");e.exports=function(t,e){return r(n(t),e)}},{"../internals/array-from-constructor-and-list":122,"../internals/typed-array-species-constructor":298}],297:[function(t,e,i){var r=t("../internals/function-bind-context"),n=t("../internals/function-call"),s=t("../internals/a-constructor"),o=t("../internals/to-object"),a=t("../internals/length-of-array-like"),l=t("../internals/get-iterator"),c=t("../internals/get-iterator-method"),h=t("../internals/is-array-iterator-method"),u=t("../internals/is-big-int-array"),d=t("../internals/array-buffer-view-core").aTypedArrayConstructor,p=t("../internals/to-big-int");e.exports=function(t){var e,i,f,_,m,g,y,v,b=s(this),x=o(t),T=arguments.length,C=T>1?arguments[1]:void 0,S=void 0!==C,w=c(x);if(w&&!h(w))for(v=(y=l(x,w)).next,x=[];!(g=n(v,y)).done;)x.push(g.value);for(S&&T>2&&(C=r(C,arguments[2])),i=a(x),f=new(d(b))(i),_=u(f),e=0;i>e;e++)m=S?C(x[e],e):x[e],f[e]=_?p(m):+m;return f}},{"../internals/a-constructor":109,"../internals/array-buffer-view-core":117,"../internals/function-bind-context":175,"../internals/function-call":177,"../internals/get-iterator":184,"../internals/get-iterator-method":183,"../internals/is-array-iterator-method":200,"../internals/is-big-int-array":202,"../internals/length-of-array-like":219,"../internals/to-big-int":280,"../internals/to-object":285}],298:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/species-constructor"),s=r.aTypedArrayConstructor,o=r.getTypedArrayConstructor;e.exports=function(t){return s(n(t,o(t)))}},{"../internals/array-buffer-view-core":117,"../internals/species-constructor":270}],299:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=0,s=Math.random(),o=r(1..toString);e.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++n+s,36)}},{"../internals/function-uncurry-this":181}],300:[function(t,e,i){var r=t("../internals/symbol-constructor-detection");e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},{"../internals/symbol-constructor-detection":274}],301:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/fails");e.exports=r&&n((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},{"../internals/descriptors":153,"../internals/fails":171}],302:[function(t,e,i){var r=TypeError;e.exports=function(t,e){if(t<e)throw new r("Not enough arguments");return t}},{}],303:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/is-callable"),s=r.WeakMap;e.exports=n(s)&&/native code/.test(String(s))},{"../internals/global":188,"../internals/is-callable":203}],304:[function(t,e,i){var r=t("../internals/path"),n=t("../internals/has-own-property"),s=t("../internals/well-known-symbol-wrapped"),o=t("../internals/object-define-property").f;e.exports=function(t){var e=r.Symbol||(r.Symbol={});n(e,t)||o(e,t,{value:s.f(t)})}},{"../internals/has-own-property":189,"../internals/object-define-property":231,"../internals/path":247,"../internals/well-known-symbol-wrapped":305}],305:[function(t,e,i){var r=t("../internals/well-known-symbol");i.f=r},{"../internals/well-known-symbol":306}],306:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/shared"),s=t("../internals/has-own-property"),o=t("../internals/uid"),a=t("../internals/symbol-constructor-detection"),l=t("../internals/use-symbol-as-uid"),c=r.Symbol,h=n("wks"),u=l?c.for||c:c&&c.withoutSetter||o;e.exports=function(t){return s(h,t)||(h[t]=a&&s(c,t)?c[t]:u("Symbol."+t)),h[t]}},{"../internals/global":188,"../internals/has-own-property":189,"../internals/shared":269,"../internals/symbol-constructor-detection":274,"../internals/uid":299,"../internals/use-symbol-as-uid":300}],307:[function(t,e,i){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},{}],308:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/global"),s=t("../internals/array-buffer"),o=t("../internals/set-species"),a="ArrayBuffer",l=s[a];r({global:!0,constructor:!0,forced:n[a]!==l},{ArrayBuffer:l}),o(a)},{"../internals/array-buffer":118,"../internals/export":170,"../internals/global":188,"../internals/set-species":265}],309:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-uncurry-this-clause"),s=t("../internals/fails"),o=t("../internals/array-buffer"),a=t("../internals/an-object"),l=t("../internals/to-absolute-index"),c=t("../internals/to-length"),h=t("../internals/species-constructor"),u=o.ArrayBuffer,d=o.DataView,p=d.prototype,f=n(u.prototype.slice),_=n(p.getUint8),m=n(p.setUint8);r({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:s((function(){return!new u(2).slice(1,void 0).byteLength}))},{slice:function(t,e){if(f&&void 0===e)return f(a(this),t);for(var i=a(this).byteLength,r=l(t,i),n=l(void 0===e?i:e,i),s=new(h(this,u))(c(n-r)),o=new d(this),p=new d(s),g=0;r<n;)m(p,g++,_(o,r++));return s}})},{"../internals/an-object":114,"../internals/array-buffer":118,"../internals/export":170,"../internals/fails":171,"../internals/function-uncurry-this-clause":180,"../internals/species-constructor":270,"../internals/to-absolute-index":279,"../internals/to-length":284}],310:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/fails"),s=t("../internals/is-array"),o=t("../internals/is-object"),a=t("../internals/to-object"),l=t("../internals/length-of-array-like"),c=t("../internals/does-not-exceed-safe-integer"),h=t("../internals/create-property"),u=t("../internals/array-species-create"),d=t("../internals/array-method-has-species-support"),p=t("../internals/well-known-symbol"),f=t("../internals/engine-v8-version"),_=p("isConcatSpreadable"),m=f>=51||!n((function(){var t=[];return t[_]=!1,t.concat()[0]!==t})),g=function(t){if(!o(t))return!1;var e=t[_];return void 0!==e?!!e:s(t)};r({target:"Array",proto:!0,arity:1,forced:!m||!d("concat")},{concat:function(t){var e,i,r,n,s,o=a(this),d=u(o,0),p=0;for(e=-1,r=arguments.length;e<r;e++)if(g(s=-1===e?o:arguments[e]))for(n=l(s),c(p+n),i=0;i<n;i++,p++)i in s&&h(d,p,s[i]);else c(p+1),h(d,p++,s);return d.length=p,d}})},{"../internals/array-method-has-species-support":127,"../internals/array-species-create":134,"../internals/create-property":147,"../internals/does-not-exceed-safe-integer":155,"../internals/engine-v8-version":167,"../internals/export":170,"../internals/fails":171,"../internals/is-array":201,"../internals/is-object":208,"../internals/length-of-array-like":219,"../internals/to-object":285,"../internals/well-known-symbol":306}],311:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-fill"),s=t("../internals/add-to-unscopables");r({target:"Array",proto:!0},{fill:n}),s("fill")},{"../internals/add-to-unscopables":111,"../internals/array-fill":120,"../internals/export":170}],312:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-iteration").filter;r({target:"Array",proto:!0,forced:!t("../internals/array-method-has-species-support")("filter")},{filter:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},{"../internals/array-iteration":125,"../internals/array-method-has-species-support":127,"../internals/export":170}],313:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-iteration").find,s=t("../internals/add-to-unscopables"),o="find",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),s(o)},{"../internals/add-to-unscopables":111,"../internals/array-iteration":125,"../internals/export":170}],314:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-from");r({target:"Array",stat:!0,forced:!t("../internals/check-correctness-of-iteration")((function(t){Array.from(t)}))},{from:n})},{"../internals/array-from":123,"../internals/check-correctness-of-iteration":136,"../internals/export":170}],315:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-includes").includes,s=t("../internals/fails"),o=t("../internals/add-to-unscopables");r({target:"Array",proto:!0,forced:s((function(){return!Array(1).includes()}))},{includes:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),o("includes")},{"../internals/add-to-unscopables":111,"../internals/array-includes":124,"../internals/export":170,"../internals/fails":171}],316:[function(t,e,i){var r=t("../internals/to-indexed-object"),n=t("../internals/add-to-unscopables"),s=t("../internals/iterators"),o=t("../internals/internal-state"),a=t("../internals/object-define-property").f,l=t("../internals/iterator-define"),c=t("../internals/create-iter-result-object"),h=t("../internals/is-pure"),u=t("../internals/descriptors"),d="Array Iterator",p=o.set,f=o.getterFor(d);e.exports=l(Array,"Array",(function(t,e){p(this,{type:d,target:r(t),index:0,kind:e})}),(function(){var t=f(this),e=t.target,i=t.index++;if(!e||i>=e.length)return t.target=void 0,c(void 0,!0);switch(t.kind){case"keys":return c(i,!1);case"values":return c(e[i],!1)}return c([i,e[i]],!1)}),"values");var _=s.Arguments=s.Array;if(n("keys"),n("values"),n("entries"),!h&&u&&"values"!==_.name)try{a(_,"name",{value:"values"})}catch(m){}},{"../internals/add-to-unscopables":111,"../internals/create-iter-result-object":144,"../internals/descriptors":153,"../internals/internal-state":199,"../internals/is-pure":210,"../internals/iterator-define":216,"../internals/iterators":218,"../internals/object-define-property":231,"../internals/to-indexed-object":282}],317:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-uncurry-this"),s=t("../internals/indexed-object"),o=t("../internals/to-indexed-object"),a=t("../internals/array-method-is-strict"),l=n([].join);r({target:"Array",proto:!0,forced:s!==Object||!a("join",",")},{join:function(t){return l(o(this),void 0===t?",":t)}})},{"../internals/array-method-is-strict":128,"../internals/export":170,"../internals/function-uncurry-this":181,"../internals/indexed-object":195,"../internals/to-indexed-object":282}],318:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/array-iteration").map;r({target:"Array",proto:!0,forced:!t("../internals/array-method-has-species-support")("map")},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},{"../internals/array-iteration":125,"../internals/array-method-has-species-support":127,"../internals/export":170}],319:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/is-array"),s=t("../internals/is-constructor"),o=t("../internals/is-object"),a=t("../internals/to-absolute-index"),l=t("../internals/length-of-array-like"),c=t("../internals/to-indexed-object"),h=t("../internals/create-property"),u=t("../internals/well-known-symbol"),d=t("../internals/array-method-has-species-support"),p=t("../internals/array-slice"),f=d("slice"),_=u("species"),m=Array,g=Math.max;r({target:"Array",proto:!0,forced:!f},{slice:function(t,e){var i,r,u,d=c(this),f=l(d),y=a(t,f),v=a(void 0===e?f:e,f);if(n(d)&&(i=d.constructor,(s(i)&&(i===m||n(i.prototype))||o(i)&&null===(i=i[_]))&&(i=void 0),i===m||void 0===i))return p(d,y,v);for(r=new(void 0===i?m:i)(g(v-y,0)),u=0;y<v;y++,u++)y in d&&h(r,u,d[y]);return r.length=u,r}})},{"../internals/array-method-has-species-support":127,"../internals/array-slice":131,"../internals/create-property":147,"../internals/export":170,"../internals/is-array":201,"../internals/is-constructor":204,"../internals/is-object":208,"../internals/length-of-array-like":219,"../internals/to-absolute-index":279,"../internals/to-indexed-object":282,"../internals/well-known-symbol":306}],320:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-uncurry-this"),s=t("../internals/a-callable"),o=t("../internals/to-object"),a=t("../internals/length-of-array-like"),l=t("../internals/delete-property-or-throw"),c=t("../internals/to-string"),h=t("../internals/fails"),u=t("../internals/array-sort"),d=t("../internals/array-method-is-strict"),p=t("../internals/engine-ff-version"),f=t("../internals/engine-is-ie-or-edge"),_=t("../internals/engine-v8-version"),m=t("../internals/engine-webkit-version"),g=[],y=n(g.sort),v=n(g.push),b=h((function(){g.sort(void 0)})),x=h((function(){g.sort(null)})),T=d("sort"),C=!h((function(){if(_)return _<70;if(!(p&&p>3)){if(f)return!0;if(m)return m<603;var t,e,i,r,n="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)g.push({k:e+r,v:i})}for(g.sort((function(t,e){return e.v-t.v})),r=0;r<g.length;r++)e=g[r].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}})),S=function(t){return function(e,i){return void 0===i?-1:void 0===e?1:void 0!==t?+t(e,i)||0:c(e)>c(i)?1:-1}};r({target:"Array",proto:!0,forced:b||!x||!T||!C},{sort:function(t){void 0!==t&&s(t);var e=o(this);if(C)return void 0===t?y(e):y(e,t);var i,r,n=[],c=a(e);for(r=0;r<c;r++)r in e&&v(n,e[r]);for(u(n,S(t)),i=a(n),r=0;r<i;)e[r]=n[r++];for(;r<c;)l(e,r++);return e}})},{"../internals/a-callable":108,"../internals/array-method-is-strict":128,"../internals/array-sort":132,"../internals/delete-property-or-throw":152,"../internals/engine-ff-version":158,"../internals/engine-is-ie-or-edge":161,"../internals/engine-v8-version":167,"../internals/engine-webkit-version":168,"../internals/export":170,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/length-of-array-like":219,"../internals/to-object":285,"../internals/to-string":291}],321:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/to-object"),s=t("../internals/to-absolute-index"),o=t("../internals/to-integer-or-infinity"),a=t("../internals/length-of-array-like"),l=t("../internals/array-set-length"),c=t("../internals/does-not-exceed-safe-integer"),h=t("../internals/array-species-create"),u=t("../internals/create-property"),d=t("../internals/delete-property-or-throw"),p=t("../internals/array-method-has-species-support")("splice"),f=Math.max,_=Math.min;r({target:"Array",proto:!0,forced:!p},{splice:function(t,e){var i,r,p,m,g,y,v=n(this),b=a(v),x=s(t,b),T=arguments.length;for(0===T?i=r=0:1===T?(i=0,r=b-x):(i=T-2,r=_(f(o(e),0),b-x)),c(b+i-r),p=h(v,r),m=0;m<r;m++)(g=x+m)in v&&u(p,m,v[g]);if(p.length=r,i<r){for(m=x;m<b-r;m++)y=m+i,(g=m+r)in v?v[y]=v[g]:d(v,y);for(m=b;m>b-r+i;m--)d(v,m-1)}else if(i>r)for(m=b-r;m>x;m--)y=m+i-1,(g=m+r-1)in v?v[y]=v[g]:d(v,y);for(m=0;m<i;m++)v[m+x]=arguments[m+2];return l(v,b-r+i),p}})},{"../internals/array-method-has-species-support":127,"../internals/array-set-length":130,"../internals/array-species-create":134,"../internals/create-property":147,"../internals/delete-property-or-throw":152,"../internals/does-not-exceed-safe-integer":155,"../internals/export":170,"../internals/length-of-array-like":219,"../internals/to-absolute-index":279,"../internals/to-integer-or-infinity":283,"../internals/to-object":285}],322:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/function-name").EXISTS,s=t("../internals/function-uncurry-this"),o=t("../internals/define-built-in-accessor"),a=Function.prototype,l=s(a.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,h=s(c.exec);r&&!n&&o(a,"name",{configurable:!0,get:function(){try{return h(c,l(this))[1]}catch(t){return""}}})},{"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/function-name":178,"../internals/function-uncurry-this":181}],323:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/get-built-in"),s=t("../internals/function-apply"),o=t("../internals/function-call"),a=t("../internals/function-uncurry-this"),l=t("../internals/fails"),c=t("../internals/is-callable"),h=t("../internals/is-symbol"),u=t("../internals/array-slice"),d=t("../internals/get-json-replacer-function"),p=t("../internals/symbol-constructor-detection"),f=String,_=n("JSON","stringify"),m=a(/./.exec),g=a("".charAt),y=a("".charCodeAt),v=a("".replace),b=a(1..toString),x=/[\uD800-\uDFFF]/g,T=/^[\uD800-\uDBFF]$/,C=/^[\uDC00-\uDFFF]$/,S=!p||l((function(){var t=n("Symbol")("stringify detection");return"[null]"!==_([t])||"{}"!==_({a:t})||"{}"!==_(Object(t))})),w=l((function(){return'"\\udf06\\ud834"'!==_("\udf06\ud834")||'"\\udead"'!==_("\udead")})),A=function(t,e){var i=u(arguments),r=d(e);if(c(r)||void 0!==t&&!h(t))return i[1]=function(t,e){if(c(r)&&(e=o(r,this,f(t),e)),!h(e))return e},s(_,null,i)},E=function(t,e,i){var r=g(i,e-1),n=g(i,e+1);return m(T,t)&&!m(C,n)||m(C,t)&&!m(T,r)?"\\u"+b(y(t,0),16):t};_&&r({target:"JSON",stat:!0,arity:3,forced:S||w},{stringify:function(t,e,i){var r=u(arguments),n=s(S?A:_,null,r);return w&&"string"==typeof n?v(n,x,E):n}})},{"../internals/array-slice":131,"../internals/export":170,"../internals/fails":171,"../internals/function-apply":174,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/get-built-in":182,"../internals/get-json-replacer-function":185,"../internals/is-callable":203,"../internals/is-symbol":212,"../internals/symbol-constructor-detection":274}],324:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/is-pure"),s=t("../internals/descriptors"),o=t("../internals/global"),a=t("../internals/path"),l=t("../internals/function-uncurry-this"),c=t("../internals/is-forced"),h=t("../internals/has-own-property"),u=t("../internals/inherit-if-required"),d=t("../internals/object-is-prototype-of"),p=t("../internals/is-symbol"),f=t("../internals/to-primitive"),_=t("../internals/fails"),m=t("../internals/object-get-own-property-names").f,g=t("../internals/object-get-own-property-descriptor").f,y=t("../internals/object-define-property").f,v=t("../internals/this-number-value"),b=t("../internals/string-trim").trim,x="Number",T=o[x],C=a[x],S=T.prototype,w=o.TypeError,A=l("".slice),E=l("".charCodeAt),D=function(t){var e=f(t,"number");return"bigint"==typeof e?e:L(e)},L=function(t){var e,i,r,n,s,o,a,l,c=f(t,"number");if(p(c))throw new w("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=b(c),43===(e=E(c,0))||45===e){if(88===(i=E(c,2))||120===i)return NaN}else if(48===e){switch(E(c,1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+c}for(o=(s=A(c,2)).length,a=0;a<o;a++)if((l=E(s,a))<48||l>n)return NaN;return parseInt(s,r)}return+c},I=c(x,!T(" 0o1")||!T("0b1")||T("+0x1")),P=function(t){return d(S,t)&&_((function(){v(t)}))},M=function(t){var e=arguments.length<1?0:T(D(t));return P(this)?u(Object(e),this,M):e};M.prototype=S,I&&!n&&(S.constructor=M),r({global:!0,constructor:!0,wrap:!0,forced:I},{Number:M});var R=function(t,e){for(var i,r=s?m(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),n=0;r.length>n;n++)h(e,i=r[n])&&!h(t,i)&&y(t,i,g(e,i))};n&&C&&R(a[x],C),(I||n)&&R(a[x],T)},{"../internals/descriptors":153,"../internals/export":170,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/has-own-property":189,"../internals/inherit-if-required":196,"../internals/is-forced":205,"../internals/is-pure":210,"../internals/is-symbol":212,"../internals/object-define-property":231,"../internals/object-get-own-property-descriptor":232,"../internals/object-get-own-property-names":234,"../internals/object-is-prototype-of":238,"../internals/path":247,"../internals/string-trim":273,"../internals/this-number-value":278,"../internals/to-primitive":288}],325:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/object-assign");r({target:"Object",stat:!0,arity:2,forced:Object.assign!==n},{assign:n})},{"../internals/export":170,"../internals/object-assign":228}],326:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/object-to-array").entries;r({target:"Object",stat:!0},{entries:function(t){return n(t)}})},{"../internals/export":170,"../internals/object-to-array":243}],327:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/symbol-constructor-detection"),s=t("../internals/fails"),o=t("../internals/object-get-own-property-symbols"),a=t("../internals/to-object");r({target:"Object",stat:!0,forced:!n||s((function(){o.f(1)}))},{getOwnPropertySymbols:function(t){var e=o.f;return e?e(a(t)):[]}})},{"../internals/export":170,"../internals/fails":171,"../internals/object-get-own-property-symbols":235,"../internals/symbol-constructor-detection":274,"../internals/to-object":285}],328:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/to-object"),s=t("../internals/object-keys");r({target:"Object",stat:!0,forced:t("../internals/fails")((function(){s(1)}))},{keys:function(t){return s(n(t))}})},{"../internals/export":170,"../internals/fails":171,"../internals/object-keys":240,"../internals/to-object":285}],329:[function(t,e,i){var r=t("../internals/to-string-tag-support"),n=t("../internals/define-built-in"),s=t("../internals/object-to-string");r||n(Object.prototype,"toString",s,{unsafe:!0})},{"../internals/define-built-in":149,"../internals/object-to-string":244,"../internals/to-string-tag-support":290}],330:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-call"),s=t("../internals/a-callable"),o=t("../internals/new-promise-capability"),a=t("../internals/perform"),l=t("../internals/iterate");r({target:"Promise",stat:!0,forced:t("../internals/promise-statics-incorrect-iteration")},{all:function(t){var e=this,i=o.f(e),r=i.resolve,c=i.reject,h=a((function(){var i=s(e.resolve),o=[],a=0,h=1;l(t,(function(t){var s=a++,l=!1;h++,n(i,e,t).then((function(t){l||(l=!0,o[s]=t,--h||r(o))}),c)})),--h||r(o)}));return h.error&&c(h.value),i.promise}})},{"../internals/a-callable":108,"../internals/export":170,"../internals/function-call":177,"../internals/iterate":213,"../internals/new-promise-capability":226,"../internals/perform":248,"../internals/promise-statics-incorrect-iteration":252}],331:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/is-pure"),s=t("../internals/promise-constructor-detection").CONSTRUCTOR,o=t("../internals/promise-native-constructor"),a=t("../internals/get-built-in"),l=t("../internals/is-callable"),c=t("../internals/define-built-in"),h=o&&o.prototype;if(r({target:"Promise",proto:!0,forced:s,real:!0},{catch:function(t){return this.then(void 0,t)}}),!n&&l(o)){var u=a("Promise").prototype.catch;h.catch!==u&&c(h,"catch",u,{unsafe:!0})}},{"../internals/define-built-in":149,"../internals/export":170,"../internals/get-built-in":182,"../internals/is-callable":203,"../internals/is-pure":210,"../internals/promise-constructor-detection":249,"../internals/promise-native-constructor":250}],332:[function(t,e,i){var r,n,s,o,a=t("../internals/export"),l=t("../internals/is-pure"),c=t("../internals/engine-is-node"),h=t("../internals/global"),u=t("../internals/function-call"),d=t("../internals/define-built-in"),p=t("../internals/object-set-prototype-of"),f=t("../internals/set-to-string-tag"),_=t("../internals/set-species"),m=t("../internals/a-callable"),g=t("../internals/is-callable"),y=t("../internals/is-object"),v=t("../internals/an-instance"),b=t("../internals/species-constructor"),x=t("../internals/task").set,T=t("../internals/microtask"),C=t("../internals/host-report-errors"),S=t("../internals/perform"),w=t("../internals/queue"),A=t("../internals/internal-state"),E=t("../internals/promise-native-constructor"),D=t("../internals/promise-constructor-detection"),L=t("../internals/new-promise-capability"),I="Promise",P=D.CONSTRUCTOR,M=D.REJECTION_EVENT,R=D.SUBCLASSING,O=A.getterFor(I),B=A.set,N=E&&E.prototype,k=E,F=N,V=h.TypeError,j=h.document,G=h.process,U=L.f,Y=U,H=!!(j&&j.createEvent&&h.dispatchEvent),X="unhandledrejection",z="rejectionhandled",W=0,Z=1,J=2,q=1,K=2,Q=function(t){var e;return!(!y(t)||!g(e=t.then))&&e},$=function(t,e){var i,r,n,s=e.value,o=e.state===Z,a=o?t.ok:t.fail,l=t.resolve,c=t.reject,h=t.domain;try{a?(o||(e.rejection===K&&nt(e),e.rejection=q),!0===a?i=s:(h&&h.enter(),i=a(s),h&&(h.exit(),n=!0)),i===t.promise?c(new V("Promise-chain cycle")):(r=Q(i))?u(r,i,l,c):l(i)):c(s)}catch(d){h&&!n&&h.exit(),c(d)}},tt=function(t,e){t.notified||(t.notified=!0,T((function(){for(var i,r=t.reactions;i=r.get();)$(i,t);t.notified=!1,e&&!t.rejection&&it(t)})))},et=function(t,e,i){var r,n;H?((r=j.createEvent("Event")).promise=e,r.reason=i,r.initEvent(t,!1,!0),h.dispatchEvent(r)):r={promise:e,reason:i},!M&&(n=h["on"+t])?n(r):t===X&&C("Unhandled promise rejection",i)},it=function(t){u(x,h,(function(){var e,i=t.facade,r=t.value;if(rt(t)&&(e=S((function(){c?G.emit("unhandledRejection",r,i):et(X,i,r)})),t.rejection=c||rt(t)?K:q,e.error))throw e.value}))},rt=function(t){return t.rejection!==q&&!t.parent},nt=function(t){u(x,h,(function(){var e=t.facade;c?G.emit("rejectionHandled",e):et(z,e,t.value)}))},st=function(t,e,i){return function(r){t(e,r,i)}},ot=function(t,e,i){t.done||(t.done=!0,i&&(t=i),t.value=e,t.state=J,tt(t,!0))},at=function(t,e,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===e)throw new V("Promise can't be resolved itself");var r=Q(e);r?T((function(){var i={done:!1};try{u(r,e,st(at,i,t),st(ot,i,t))}catch(n){ot(i,n,t)}})):(t.value=e,t.state=Z,tt(t,!1))}catch(n){ot({done:!1},n,t)}}};if(P&&(F=(k=function(t){v(this,F),m(t),u(r,this);var e=O(this);try{t(st(at,e),st(ot,e))}catch(i){ot(e,i)}}).prototype,(r=function(t){B(this,{type:I,done:!1,notified:!1,parent:!1,reactions:new w,rejection:!1,state:W,value:void 0})}).prototype=d(F,"then",(function(t,e){var i=O(this),r=U(b(this,k));return i.parent=!0,r.ok=!g(t)||t,r.fail=g(e)&&e,r.domain=c?G.domain:void 0,i.state===W?i.reactions.add(r):T((function(){$(r,i)})),r.promise})),n=function(){var t=new r,e=O(t);this.promise=t,this.resolve=st(at,e),this.reject=st(ot,e)},L.f=U=function(t){return t===k||t===s?new n(t):Y(t)},!l&&g(E)&&N!==Object.prototype)){o=N.then,R||d(N,"then",(function(t,e){var i=this;return new k((function(t,e){u(o,i,t,e)})).then(t,e)}),{unsafe:!0});try{delete N.constructor}catch(lt){}p&&p(N,F)}a({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:k}),f(k,I,!1,!0),_(I)},{"../internals/a-callable":108,"../internals/an-instance":113,"../internals/define-built-in":149,"../internals/engine-is-node":164,"../internals/export":170,"../internals/function-call":177,"../internals/global":188,"../internals/host-report-errors":191,"../internals/internal-state":199,"../internals/is-callable":203,"../internals/is-object":208,"../internals/is-pure":210,"../internals/microtask":225,"../internals/new-promise-capability":226,"../internals/object-set-prototype-of":242,"../internals/perform":248,"../internals/promise-constructor-detection":249,"../internals/promise-native-constructor":250,"../internals/queue":254,"../internals/set-species":265,"../internals/set-to-string-tag":266,"../internals/species-constructor":270,"../internals/task":277}],333:[function(t,e,i){t("../modules/es.promise.constructor"),t("../modules/es.promise.all"),t("../modules/es.promise.catch"),t("../modules/es.promise.race"),t("../modules/es.promise.reject"),t("../modules/es.promise.resolve")},{"../modules/es.promise.all":330,"../modules/es.promise.catch":331,"../modules/es.promise.constructor":332,"../modules/es.promise.race":334,"../modules/es.promise.reject":335,"../modules/es.promise.resolve":336}],334:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-call"),s=t("../internals/a-callable"),o=t("../internals/new-promise-capability"),a=t("../internals/perform"),l=t("../internals/iterate");r({target:"Promise",stat:!0,forced:t("../internals/promise-statics-incorrect-iteration")},{race:function(t){var e=this,i=o.f(e),r=i.reject,c=a((function(){var o=s(e.resolve);l(t,(function(t){n(o,e,t).then(i.resolve,r)}))}));return c.error&&r(c.value),i.promise}})},{"../internals/a-callable":108,"../internals/export":170,"../internals/function-call":177,"../internals/iterate":213,"../internals/new-promise-capability":226,"../internals/perform":248,"../internals/promise-statics-incorrect-iteration":252}],335:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/new-promise-capability");r({target:"Promise",stat:!0,forced:t("../internals/promise-constructor-detection").CONSTRUCTOR},{reject:function(t){var e=n.f(this);return(0,e.reject)(t),e.promise}})},{"../internals/export":170,"../internals/new-promise-capability":226,"../internals/promise-constructor-detection":249}],336:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/get-built-in"),s=t("../internals/is-pure"),o=t("../internals/promise-native-constructor"),a=t("../internals/promise-constructor-detection").CONSTRUCTOR,l=t("../internals/promise-resolve"),c=n("Promise"),h=s&&!a;r({target:"Promise",stat:!0,forced:s||a},{resolve:function(t){return l(h&&this===c?o:this,t)}})},{"../internals/export":170,"../internals/get-built-in":182,"../internals/is-pure":210,"../internals/promise-constructor-detection":249,"../internals/promise-native-constructor":250,"../internals/promise-resolve":251}],337:[function(t,e,i){var r=t("../internals/descriptors"),n=t("../internals/global"),s=t("../internals/function-uncurry-this"),o=t("../internals/is-forced"),a=t("../internals/inherit-if-required"),l=t("../internals/create-non-enumerable-property"),c=t("../internals/object-create"),h=t("../internals/object-get-own-property-names").f,u=t("../internals/object-is-prototype-of"),d=t("../internals/is-regexp"),p=t("../internals/to-string"),f=t("../internals/regexp-get-flags"),_=t("../internals/regexp-sticky-helpers"),m=t("../internals/proxy-accessor"),g=t("../internals/define-built-in"),y=t("../internals/fails"),v=t("../internals/has-own-property"),b=t("../internals/internal-state").enforce,x=t("../internals/set-species"),T=t("../internals/well-known-symbol"),C=t("../internals/regexp-unsupported-dot-all"),S=t("../internals/regexp-unsupported-ncg"),w=T("match"),A=n.RegExp,E=A.prototype,D=n.SyntaxError,L=s(E.exec),I=s("".charAt),P=s("".replace),M=s("".indexOf),R=s("".slice),O=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,B=/a/g,N=/a/g,k=new A(B)!==B,F=_.MISSED_STICKY,V=_.UNSUPPORTED_Y,j=r&&(!k||F||C||S||y((function(){return N[w]=!1,A(B)!==B||A(N)===N||"/a/i"!==String(A(B,"i"))}))),G=function(t){for(var e,i=t.length,r=0,n="",s=!1;r<=i;r++)"\\"!==(e=I(t,r))?s||"."!==e?("["===e?s=!0:"]"===e&&(s=!1),n+=e):n+="[\\s\\S]":n+=e+I(t,++r);return n},U=function(t){for(var e,i=t.length,r=0,n="",s=[],o=c(null),a=!1,l=!1,h=0,u="";r<=i;r++){if("\\"===(e=I(t,r)))e+=I(t,++r);else if("]"===e)a=!1;else if(!a)switch(!0){case"["===e:a=!0;break;case"("===e:L(O,R(t,r+1))&&(r+=2,l=!0),n+=e,h++;continue;case">"===e&&l:if(""===u||v(o,u))throw new D("Invalid capture group name");o[u]=!0,s[s.length]=[u,h],l=!1,u="";continue}l?u+=e:n+=e}return[n,s]};if(o("RegExp",j)){for(var Y=function(t,e){var i,r,n,s,o,c,h=u(E,this),_=d(t),m=void 0===e,g=[],y=t;if(!h&&_&&m&&t.constructor===Y)return t;if((_||u(E,t))&&(t=t.source,m&&(e=f(y))),t=void 0===t?"":p(t),e=void 0===e?"":p(e),y=t,C&&"dotAll"in B&&(r=!!e&&M(e,"s")>-1)&&(e=P(e,/s/g,"")),i=e,F&&"sticky"in B&&(n=!!e&&M(e,"y")>-1)&&V&&(e=P(e,/y/g,"")),S&&(t=(s=U(t))[0],g=s[1]),o=a(A(t,e),h?this:E,Y),(r||n||g.length)&&(c=b(o),r&&(c.dotAll=!0,c.raw=Y(G(t),i)),n&&(c.sticky=!0),g.length&&(c.groups=g)),t!==y)try{l(o,"source",""===y?"(?:)":y)}catch(v){}return o},H=h(A),X=0;H.length>X;)m(Y,A,H[X++]);E.constructor=Y,Y.prototype=E,g(n,"RegExp",Y,{constructor:!0})}x("RegExp")},{"../internals/create-non-enumerable-property":145,"../internals/define-built-in":149,"../internals/descriptors":153,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/has-own-property":189,"../internals/inherit-if-required":196,"../internals/internal-state":199,"../internals/is-forced":205,"../internals/is-regexp":211,"../internals/object-create":229,"../internals/object-get-own-property-names":234,"../internals/object-is-prototype-of":238,"../internals/proxy-accessor":253,"../internals/regexp-get-flags":258,"../internals/regexp-sticky-helpers":259,"../internals/regexp-unsupported-dot-all":260,"../internals/regexp-unsupported-ncg":261,"../internals/set-species":265,"../internals/to-string":291,"../internals/well-known-symbol":306}],338:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/regexp-exec");r({target:"RegExp",proto:!0,forced:/./.exec!==n},{exec:n})},{"../internals/export":170,"../internals/regexp-exec":256}],339:[function(t,e,i){var r=t("../internals/function-name").PROPER,n=t("../internals/define-built-in"),s=t("../internals/an-object"),o=t("../internals/to-string"),a=t("../internals/fails"),l=t("../internals/regexp-get-flags"),c="toString",h=RegExp.prototype,u=h[c],d=a((function(){return"/a/b"!==u.call({source:"a",flags:"b"})})),p=r&&u.name!==c;(d||p)&&n(h,c,(function(){var t=s(this);return"/"+o(t.source)+"/"+o(l(t))}),{unsafe:!0})},{"../internals/an-object":114,"../internals/define-built-in":149,"../internals/fails":171,"../internals/function-name":178,"../internals/regexp-get-flags":258,"../internals/to-string":291}],340:[function(t,e,i){t("../internals/collection")("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),t("../internals/collection-strong"))},{"../internals/collection":140,"../internals/collection-strong":139}],341:[function(t,e,i){t("../modules/es.set.constructor")},{"../modules/es.set.constructor":340}],342:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/function-uncurry-this"),s=t("../internals/not-a-regexp"),o=t("../internals/require-object-coercible"),a=t("../internals/to-string"),l=t("../internals/correct-is-regexp-logic"),c=n("".indexOf);r({target:"String",proto:!0,forced:!l("includes")},{includes:function(t){return!!~c(a(o(this)),a(s(t)),arguments.length>1?arguments[1]:void 0)}})},{"../internals/correct-is-regexp-logic":142,"../internals/export":170,"../internals/function-uncurry-this":181,"../internals/not-a-regexp":227,"../internals/require-object-coercible":262,"../internals/to-string":291}],343:[function(t,e,i){var r=t("../internals/string-multibyte").charAt,n=t("../internals/to-string"),s=t("../internals/internal-state"),o=t("../internals/iterator-define"),a=t("../internals/create-iter-result-object"),l="String Iterator",c=s.set,h=s.getterFor(l);o(String,"String",(function(t){c(this,{type:l,string:n(t),index:0})}),(function(){var t,e=h(this),i=e.string,n=e.index;return n>=i.length?a(void 0,!0):(t=r(i,n),e.index+=t.length,a(t,!1))}))},{"../internals/create-iter-result-object":144,"../internals/internal-state":199,"../internals/iterator-define":216,"../internals/string-multibyte":271,"../internals/to-string":291}],344:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/fix-regexp-well-known-symbol-logic"),s=t("../internals/an-object"),o=t("../internals/is-null-or-undefined"),a=t("../internals/to-length"),l=t("../internals/to-string"),c=t("../internals/require-object-coercible"),h=t("../internals/get-method"),u=t("../internals/advance-string-index"),d=t("../internals/regexp-exec-abstract");n("match",(function(t,e,i){return[function(e){var i=c(this),n=o(e)?void 0:h(e,t);return n?r(n,e,i):new RegExp(e)[t](l(i))},function(t){var r=s(this),n=l(t),o=i(e,r,n);if(o.done)return o.value;if(!r.global)return d(r,n);var c=r.unicode;r.lastIndex=0;for(var h,p=[],f=0;null!==(h=d(r,n));){var _=l(h[0]);p[f]=_,""===_&&(r.lastIndex=u(n,a(r.lastIndex),c)),f++}return 0===f?null:p}]}))},{"../internals/advance-string-index":112,"../internals/an-object":114,"../internals/fix-regexp-well-known-symbol-logic":172,"../internals/function-call":177,"../internals/get-method":186,"../internals/is-null-or-undefined":207,"../internals/regexp-exec-abstract":255,"../internals/require-object-coercible":262,"../internals/to-length":284,"../internals/to-string":291}],345:[function(t,e,i){var r=t("../internals/function-apply"),n=t("../internals/function-call"),s=t("../internals/function-uncurry-this"),o=t("../internals/fix-regexp-well-known-symbol-logic"),a=t("../internals/fails"),l=t("../internals/an-object"),c=t("../internals/is-callable"),h=t("../internals/is-null-or-undefined"),u=t("../internals/to-integer-or-infinity"),d=t("../internals/to-length"),p=t("../internals/to-string"),f=t("../internals/require-object-coercible"),_=t("../internals/advance-string-index"),m=t("../internals/get-method"),g=t("../internals/get-substitution"),y=t("../internals/regexp-exec-abstract"),v=t("../internals/well-known-symbol")("replace"),b=Math.max,x=Math.min,T=s([].concat),C=s([].push),S=s("".indexOf),w=s("".slice),A=function(t){return void 0===t?t:String(t)},E="$0"==="a".replace(/./,"$0"),D=!!/./[v]&&""===/./[v]("a","$0");o("replace",(function(t,e,i){var s=D?"$":"$0";return[function(t,i){var r=f(this),s=h(t)?void 0:m(t,v);return s?n(s,t,r,i):n(e,p(r),t,i)},function(t,n){var o=l(this),a=p(t);if("string"==typeof n&&-1===S(n,s)&&-1===S(n,"$<")){var h=i(e,o,a,n);if(h.done)return h.value}var f=c(n);f||(n=p(n));var m,v=o.global;v&&(m=o.unicode,o.lastIndex=0);for(var E,D=[];null!==(E=y(o,a))&&(C(D,E),v);)""===p(E[0])&&(o.lastIndex=_(a,d(o.lastIndex),m));for(var L="",I=0,P=0;P<D.length;P++){E=D[P];for(var M,R=p(E[0]),O=b(x(u(E.index),a.length),0),B=[],N=1;N<E.length;N++)C(B,A(E[N]));var k=E.groups;if(f){var F=T([R],B,O,a);void 0!==k&&C(F,k),M=p(r(n,void 0,F))}else M=g(R,a,O,B,k,n);O>=I&&(L+=w(a,I,O)+M,I=O+R.length)}return L+w(a,I)}]}),!!a((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!E||D)},{"../internals/advance-string-index":112,"../internals/an-object":114,"../internals/fails":171,"../internals/fix-regexp-well-known-symbol-logic":172,"../internals/function-apply":174,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/get-method":186,"../internals/get-substitution":187,"../internals/is-callable":203,"../internals/is-null-or-undefined":207,"../internals/regexp-exec-abstract":255,"../internals/require-object-coercible":262,"../internals/to-integer-or-infinity":283,"../internals/to-length":284,"../internals/to-string":291,"../internals/well-known-symbol":306}],346:[function(t,e,i){var r=t("../internals/function-call"),n=t("../internals/fix-regexp-well-known-symbol-logic"),s=t("../internals/an-object"),o=t("../internals/is-null-or-undefined"),a=t("../internals/require-object-coercible"),l=t("../internals/same-value"),c=t("../internals/to-string"),h=t("../internals/get-method"),u=t("../internals/regexp-exec-abstract");n("search",(function(t,e,i){return[function(e){var i=a(this),n=o(e)?void 0:h(e,t);return n?r(n,e,i):new RegExp(e)[t](c(i))},function(t){var r=s(this),n=c(t),o=i(e,r,n);if(o.done)return o.value;var a=r.lastIndex;l(a,0)||(r.lastIndex=0);var h=u(r,n);return l(r.lastIndex,a)||(r.lastIndex=a),null===h?-1:h.index}]}))},{"../internals/an-object":114,"../internals/fix-regexp-well-known-symbol-logic":172,"../internals/function-call":177,"../internals/get-method":186,"../internals/is-null-or-undefined":207,"../internals/regexp-exec-abstract":255,"../internals/require-object-coercible":262,"../internals/same-value":264,"../internals/to-string":291}],347:[function(t,e,i){var r=t("../internals/function-apply"),n=t("../internals/function-call"),s=t("../internals/function-uncurry-this"),o=t("../internals/fix-regexp-well-known-symbol-logic"),a=t("../internals/an-object"),l=t("../internals/is-null-or-undefined"),c=t("../internals/is-regexp"),h=t("../internals/require-object-coercible"),u=t("../internals/species-constructor"),d=t("../internals/advance-string-index"),p=t("../internals/to-length"),f=t("../internals/to-string"),_=t("../internals/get-method"),m=t("../internals/array-slice"),g=t("../internals/regexp-exec-abstract"),y=t("../internals/regexp-exec"),v=t("../internals/regexp-sticky-helpers"),b=t("../internals/fails"),x=v.UNSUPPORTED_Y,T=4294967295,C=Math.min,S=[].push,w=s(/./.exec),A=s(S),E=s("".slice),D=!b((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2!==i.length||"a"!==i[0]||"b"!==i[1]}));o("split",(function(t,e,i){var s;return s="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,i){var s=f(h(this)),o=void 0===i?T:i>>>0;if(0===o)return[];if(void 0===t)return[s];if(!c(t))return n(e,s,t,o);for(var a,l,u,d=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),_=0,g=new RegExp(t.source,p+"g");(a=n(y,g,s))&&!((l=g.lastIndex)>_&&(A(d,E(s,_,a.index)),a.length>1&&a.index<s.length&&r(S,d,m(a,1)),u=a[0].length,_=l,d.length>=o));)g.lastIndex===a.index&&g.lastIndex++;return _===s.length?!u&&w(g,"")||A(d,""):A(d,E(s,_)),d.length>o?m(d,0,o):d}:"0".split(void 0,0).length?function(t,i){return void 0===t&&0===i?[]:n(e,this,t,i)}:e,[function(e,i){var r=h(this),o=l(e)?void 0:_(e,t);return o?n(o,e,r,i):n(s,f(r),e,i)},function(t,r){var n=a(this),o=f(t),l=i(s,n,o,r,s!==e);if(l.done)return l.value;var c=u(n,RegExp),h=n.unicode,_=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(x?"g":"y"),m=new c(x?"^(?:"+n.source+")":n,_),y=void 0===r?T:r>>>0;if(0===y)return[];if(0===o.length)return null===g(m,o)?[o]:[];for(var v=0,b=0,S=[];b<o.length;){m.lastIndex=x?0:b;var w,D=g(m,x?E(o,b):o);if(null===D||(w=C(p(m.lastIndex+(x?b:0)),o.length))===v)b=d(o,b,h);else{if(A(S,E(o,v,b)),S.length===y)return S;for(var L=1;L<=D.length-1;L++)if(A(S,D[L]),S.length===y)return S;b=v=w}}return A(S,E(o,v)),S}]}),!D,x)},{"../internals/advance-string-index":112,"../internals/an-object":114,"../internals/array-slice":131,"../internals/fails":171,"../internals/fix-regexp-well-known-symbol-logic":172,"../internals/function-apply":174,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/get-method":186,"../internals/is-null-or-undefined":207,"../internals/is-regexp":211,"../internals/regexp-exec":256,"../internals/regexp-exec-abstract":255,"../internals/regexp-sticky-helpers":259,"../internals/require-object-coercible":262,"../internals/species-constructor":270,"../internals/to-length":284,"../internals/to-string":291}],348:[function(t,e,i){var r,n=t("../internals/export"),s=t("../internals/function-uncurry-this-clause"),o=t("../internals/object-get-own-property-descriptor").f,a=t("../internals/to-length"),l=t("../internals/to-string"),c=t("../internals/not-a-regexp"),h=t("../internals/require-object-coercible"),u=t("../internals/correct-is-regexp-logic"),d=t("../internals/is-pure"),p=s("".slice),f=Math.min,_=u("startsWith");n({target:"String",proto:!0,forced:!(!d&&!_&&(r=o(String.prototype,"startsWith"),r&&!r.writable)||_)},{startsWith:function(t){var e=l(h(this));c(t);var i=a(f(arguments.length>1?arguments[1]:void 0,e.length)),r=l(t);return p(e,i,i+r.length)===r}})},{"../internals/correct-is-regexp-logic":142,"../internals/export":170,"../internals/function-uncurry-this-clause":180,"../internals/is-pure":210,"../internals/not-a-regexp":227,"../internals/object-get-own-property-descriptor":232,"../internals/require-object-coercible":262,"../internals/to-length":284,"../internals/to-string":291}],349:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/string-trim").trim;r({target:"String",proto:!0,forced:t("../internals/string-trim-forced")("trim")},{trim:function(){return n(this)}})},{"../internals/export":170,"../internals/string-trim":273,"../internals/string-trim-forced":272}],350:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/global"),s=t("../internals/function-call"),o=t("../internals/function-uncurry-this"),a=t("../internals/is-pure"),l=t("../internals/descriptors"),c=t("../internals/symbol-constructor-detection"),h=t("../internals/fails"),u=t("../internals/has-own-property"),d=t("../internals/object-is-prototype-of"),p=t("../internals/an-object"),f=t("../internals/to-indexed-object"),_=t("../internals/to-property-key"),m=t("../internals/to-string"),g=t("../internals/create-property-descriptor"),y=t("../internals/object-create"),v=t("../internals/object-keys"),b=t("../internals/object-get-own-property-names"),x=t("../internals/object-get-own-property-names-external"),T=t("../internals/object-get-own-property-symbols"),C=t("../internals/object-get-own-property-descriptor"),S=t("../internals/object-define-property"),w=t("../internals/object-define-properties"),A=t("../internals/object-property-is-enumerable"),E=t("../internals/define-built-in"),D=t("../internals/define-built-in-accessor"),L=t("../internals/shared"),I=t("../internals/shared-key"),P=t("../internals/hidden-keys"),M=t("../internals/uid"),R=t("../internals/well-known-symbol"),O=t("../internals/well-known-symbol-wrapped"),B=t("../internals/well-known-symbol-define"),N=t("../internals/symbol-define-to-primitive"),k=t("../internals/set-to-string-tag"),F=t("../internals/internal-state"),V=t("../internals/array-iteration").forEach,j=I("hidden"),G="Symbol",U="prototype",Y=F.set,H=F.getterFor(G),X=Object[U],z=n.Symbol,W=z&&z[U],Z=n.RangeError,J=n.TypeError,q=n.QObject,K=C.f,Q=S.f,$=x.f,tt=A.f,et=o([].push),it=L("symbols"),rt=L("op-symbols"),nt=L("wks"),st=!q||!q[U]||!q[U].findChild,ot=function(t,e,i){var r=K(X,e);r&&delete X[e],Q(t,e,i),r&&t!==X&&Q(X,e,r)},at=l&&h((function(){return 7!==y(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a}))?ot:Q,lt=function(t,e){var i=it[t]=y(W);return Y(i,{type:G,tag:t,description:e}),l||(i.description=e),i},ct=function(t,e,i){t===X&&ct(rt,e,i),p(t);var r=_(e);return p(i),u(it,r)?(i.enumerable?(u(t,j)&&t[j][r]&&(t[j][r]=!1),i=y(i,{enumerable:g(0,!1)})):(u(t,j)||Q(t,j,g(1,y(null))),t[j][r]=!0),at(t,r,i)):Q(t,r,i)},ht=function(t,e){p(t);var i=f(e),r=v(i).concat(_t(i));return V(r,(function(e){l&&!s(dt,i,e)||ct(t,e,i[e])})),t},ut=function(t,e){return void 0===e?y(t):ht(y(t),e)},dt=function(t){var e=_(t),i=s(tt,this,e);return!(this===X&&u(it,e)&&!u(rt,e))&&(!(i||!u(this,e)||!u(it,e)||u(this,j)&&this[j][e])||i)},pt=function(t,e){var i=f(t),r=_(e);if(i!==X||!u(it,r)||u(rt,r)){var n=K(i,r);return!n||!u(it,r)||u(i,j)&&i[j][r]||(n.enumerable=!0),n}},ft=function(t){var e=$(f(t)),i=[];return V(e,(function(t){u(it,t)||u(P,t)||et(i,t)})),i},_t=function(t){var e=t===X,i=$(e?rt:f(t)),r=[];return V(i,(function(t){!u(it,t)||e&&!u(X,t)||et(r,it[t])})),r};c||(z=function(){if(d(W,this))throw new J("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?m(arguments[0]):void 0,e=M(t),i=function(t){var r=void 0===this?n:this;r===X&&s(i,rt,t),u(r,j)&&u(r[j],e)&&(r[j][e]=!1);var o=g(1,t);try{at(r,e,o)}catch(a){if(!(a instanceof Z))throw a;ot(r,e,o)}};return l&&st&&at(X,e,{configurable:!0,set:i}),lt(e,t)},E(W=z[U],"toString",(function(){return H(this).tag})),E(z,"withoutSetter",(function(t){return lt(M(t),t)})),A.f=dt,S.f=ct,w.f=ht,C.f=pt,b.f=x.f=ft,T.f=_t,O.f=function(t){return lt(R(t),t)},l&&(D(W,"description",{configurable:!0,get:function(){return H(this).description}}),a||E(X,"propertyIsEnumerable",dt,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:z}),V(v(nt),(function(t){B(t)})),r({target:G,stat:!0,forced:!c},{useSetter:function(){st=!0},useSimple:function(){st=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!l},{create:ut,defineProperty:ct,defineProperties:ht,getOwnPropertyDescriptor:pt}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:ft}),N(),k(z,G),P[j]=!0},{"../internals/an-object":114,"../internals/array-iteration":125,"../internals/create-property-descriptor":146,"../internals/define-built-in":149,"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/export":170,"../internals/fails":171,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/has-own-property":189,"../internals/hidden-keys":190,"../internals/internal-state":199,"../internals/is-pure":210,"../internals/object-create":229,"../internals/object-define-properties":230,"../internals/object-define-property":231,"../internals/object-get-own-property-descriptor":232,"../internals/object-get-own-property-names":234,"../internals/object-get-own-property-names-external":233,"../internals/object-get-own-property-symbols":235,"../internals/object-is-prototype-of":238,"../internals/object-keys":240,"../internals/object-property-is-enumerable":241,"../internals/set-to-string-tag":266,"../internals/shared":269,"../internals/shared-key":267,"../internals/symbol-constructor-detection":274,"../internals/symbol-define-to-primitive":275,"../internals/to-indexed-object":282,"../internals/to-property-key":289,"../internals/to-string":291,"../internals/uid":299,"../internals/well-known-symbol":306,"../internals/well-known-symbol-define":304,"../internals/well-known-symbol-wrapped":305}],351:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/descriptors"),s=t("../internals/global"),o=t("../internals/function-uncurry-this"),a=t("../internals/has-own-property"),l=t("../internals/is-callable"),c=t("../internals/object-is-prototype-of"),h=t("../internals/to-string"),u=t("../internals/define-built-in-accessor"),d=t("../internals/copy-constructor-properties"),p=s.Symbol,f=p&&p.prototype;if(n&&l(p)&&(!("description"in f)||void 0!==p().description)){var _={},m=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:h(arguments[0]),e=c(f,this)?new p(t):void 0===t?p():p(t);return""===t&&(_[e]=!0),e};d(m,p),m.prototype=f,f.constructor=m;var g="Symbol(description detection)"===String(p("description detection")),y=o(f.valueOf),v=o(f.toString),b=/^Symbol\((.*)\)[^)]+$/,x=o("".replace),T=o("".slice);u(f,"description",{configurable:!0,get:function(){var t=y(this);if(a(_,t))return"";var e=v(t),i=g?T(e,7,-1):x(e,b,"$1");return""===i?void 0:i}}),r({global:!0,constructor:!0,forced:!0},{Symbol:m})}},{"../internals/copy-constructor-properties":141,"../internals/define-built-in-accessor":148,"../internals/descriptors":153,"../internals/export":170,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/has-own-property":189,"../internals/is-callable":203,"../internals/object-is-prototype-of":238,"../internals/to-string":291}],352:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/get-built-in"),s=t("../internals/has-own-property"),o=t("../internals/to-string"),a=t("../internals/shared"),l=t("../internals/symbol-registry-detection"),c=a("string-to-symbol-registry"),h=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!l},{for:function(t){var e=o(t);if(s(c,e))return c[e];var i=n("Symbol")(e);return c[e]=i,h[i]=e,i}})},{"../internals/export":170,"../internals/get-built-in":182,"../internals/has-own-property":189,"../internals/shared":269,"../internals/symbol-registry-detection":276,"../internals/to-string":291}],353:[function(t,e,i){t("../internals/well-known-symbol-define")("iterator")},{"../internals/well-known-symbol-define":304}],354:[function(t,e,i){t("../modules/es.symbol.constructor"),t("../modules/es.symbol.for"),t("../modules/es.symbol.key-for"),t("../modules/es.json.stringify"),t("../modules/es.object.get-own-property-symbols")},{"../modules/es.json.stringify":323,"../modules/es.object.get-own-property-symbols":327,"../modules/es.symbol.constructor":350,"../modules/es.symbol.for":352,"../modules/es.symbol.key-for":355}],355:[function(t,e,i){var r=t("../internals/export"),n=t("../internals/has-own-property"),s=t("../internals/is-symbol"),o=t("../internals/try-to-string"),a=t("../internals/shared"),l=t("../internals/symbol-registry-detection"),c=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!l},{keyFor:function(t){if(!s(t))throw new TypeError(o(t)+" is not a symbol");if(n(c,t))return c[t]}})},{"../internals/export":170,"../internals/has-own-property":189,"../internals/is-symbol":212,"../internals/shared":269,"../internals/symbol-registry-detection":276,"../internals/try-to-string":293}],356:[function(t,e,i){var r=t("../internals/function-uncurry-this"),n=t("../internals/array-buffer-view-core"),s=r(t("../internals/array-copy-within")),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("copyWithin",(function(t,e){return s(o(this),t,e,arguments.length>2?arguments[2]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-copy-within":119,"../internals/function-uncurry-this":181}],357:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").every,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("every",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125}],358:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-fill"),s=t("../internals/to-big-int"),o=t("../internals/classof"),a=t("../internals/function-call"),l=t("../internals/function-uncurry-this"),c=t("../internals/fails"),h=r.aTypedArray,u=r.exportTypedArrayMethod,d=l("".slice);u("fill",(function(t){var e=arguments.length;h(this);var i="Big"===d(o(this),0,3)?s(t):+t;return a(n,this,i,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),c((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})))},{"../internals/array-buffer-view-core":117,"../internals/array-fill":120,"../internals/classof":138,"../internals/fails":171,"../internals/function-call":177,"../internals/function-uncurry-this":181,"../internals/to-big-int":280}],359:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").filter,s=t("../internals/typed-array-from-species-and-list"),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("filter",(function(t){var e=n(o(this),t,arguments.length>1?arguments[1]:void 0);return s(this,e)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125,"../internals/typed-array-from-species-and-list":296}],360:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").findIndex,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("findIndex",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125}],361:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").find,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("find",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125}],362:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").forEach,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("forEach",(function(t){n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125}],363:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-includes").includes,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("includes",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-includes":124}],364:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-includes").indexOf,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("indexOf",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-includes":124}],365:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/fails"),s=t("../internals/function-uncurry-this"),o=t("../internals/array-buffer-view-core"),a=t("../modules/es.array.iterator"),l=t("../internals/well-known-symbol")("iterator"),c=r.Uint8Array,h=s(a.values),u=s(a.keys),d=s(a.entries),p=o.aTypedArray,f=o.exportTypedArrayMethod,_=c&&c.prototype,m=!n((function(){_[l].call([1])})),g=!!_&&_.values&&_[l]===_.values&&"values"===_.values.name,y=function(){return h(p(this))};f("entries",(function(){return d(p(this))}),m),f("keys",(function(){return u(p(this))}),m),f("values",y,m||!g,{name:"values"}),f(l,y,m||!g,{name:"values"})},{"../internals/array-buffer-view-core":117,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/global":188,"../internals/well-known-symbol":306,"../modules/es.array.iterator":316}],366:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/function-uncurry-this"),s=r.aTypedArray,o=r.exportTypedArrayMethod,a=n([].join);o("join",(function(t){return a(s(this),t)}))},{"../internals/array-buffer-view-core":117,"../internals/function-uncurry-this":181}],367:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/function-apply"),s=t("../internals/array-last-index-of"),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return n(s,o(this),e>1?[t,arguments[1]]:[t])}))},{"../internals/array-buffer-view-core":117,"../internals/array-last-index-of":126,"../internals/function-apply":174}],368:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").map,s=t("../internals/typed-array-species-constructor"),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("map",(function(t){return n(o(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(s(t))(e)}))}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125,"../internals/typed-array-species-constructor":298}],369:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-reduce").right,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return n(s(this),t,e,e>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-reduce":129}],370:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-reduce").left,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return n(s(this),t,e,e>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-reduce":129}],371:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=r.aTypedArray,s=r.exportTypedArrayMethod,o=Math.floor;s("reverse",(function(){for(var t,e=this,i=n(e).length,r=o(i/2),s=0;s<r;)t=e[s],e[s++]=e[--i],e[i]=t;return e}))},{"../internals/array-buffer-view-core":117}],372:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/function-call"),s=t("../internals/array-buffer-view-core"),o=t("../internals/length-of-array-like"),a=t("../internals/to-offset"),l=t("../internals/to-object"),c=t("../internals/fails"),h=r.RangeError,u=r.Int8Array,d=u&&u.prototype,p=d&&d.set,f=s.aTypedArray,_=s.exportTypedArrayMethod,m=!c((function(){var t=new Uint8ClampedArray(2);return n(p,t,{length:1,0:3},1),3!==t[1]})),g=m&&s.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var t=new u(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));_("set",(function(t){f(this);var e=a(arguments.length>1?arguments[1]:void 0,1),i=l(t);if(m)return n(p,this,i,e);var r=this.length,s=o(i),c=0;if(s+e>r)throw new h("Wrong length");for(;c<s;)this[e+c]=i[c++]}),!m||g)},{"../internals/array-buffer-view-core":117,"../internals/fails":171,"../internals/function-call":177,"../internals/global":188,"../internals/length-of-array-like":219,"../internals/to-object":285,"../internals/to-offset":286}],373:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/typed-array-species-constructor"),s=t("../internals/fails"),o=t("../internals/array-slice"),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("slice",(function(t,e){for(var i=o(a(this),t,e),r=n(this),s=0,l=i.length,c=new r(l);l>s;)c[s]=i[s++];return c}),s((function(){new Int8Array(1).slice()})))},{"../internals/array-buffer-view-core":117,"../internals/array-slice":131,"../internals/fails":171,"../internals/typed-array-species-constructor":298}],374:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/array-iteration").some,s=r.aTypedArray;(0,r.exportTypedArrayMethod)("some",(function(t){return n(s(this),t,arguments.length>1?arguments[1]:void 0)}))},{"../internals/array-buffer-view-core":117,"../internals/array-iteration":125}],375:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/function-uncurry-this-clause"),s=t("../internals/fails"),o=t("../internals/a-callable"),a=t("../internals/array-sort"),l=t("../internals/array-buffer-view-core"),c=t("../internals/engine-ff-version"),h=t("../internals/engine-is-ie-or-edge"),u=t("../internals/engine-v8-version"),d=t("../internals/engine-webkit-version"),p=l.aTypedArray,f=l.exportTypedArrayMethod,_=r.Uint16Array,m=_&&n(_.prototype.sort),g=!(!m||s((function(){m(new _(2),null)}))&&s((function(){m(new _(2),{})}))),y=!!m&&!s((function(){if(u)return u<74;if(c)return c<67;if(h)return!0;if(d)return d<602;var t,e,i=new _(516),r=Array(516);for(t=0;t<516;t++)e=t%4,i[t]=515-t,r[t]=t-2*e+3;for(m(i,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(i[t]!==r[t])return!0})),v=function(t){return function(e,i){return void 0!==t?+t(e,i)||0:i!=i?-1:e!=e?1:0===e&&0===i?1/e>0&&1/i<0?1:-1:e>i}};f("sort",(function(t){return void 0!==t&&o(t),y?m(this,t):a(p(this),v(t))}),!y||g)},{"../internals/a-callable":108,"../internals/array-buffer-view-core":117,"../internals/array-sort":132,"../internals/engine-ff-version":158,"../internals/engine-is-ie-or-edge":161,"../internals/engine-v8-version":167,"../internals/engine-webkit-version":168,"../internals/fails":171,"../internals/function-uncurry-this-clause":180,"../internals/global":188}],376:[function(t,e,i){var r=t("../internals/array-buffer-view-core"),n=t("../internals/to-length"),s=t("../internals/to-absolute-index"),o=t("../internals/typed-array-species-constructor"),a=r.aTypedArray;(0,r.exportTypedArrayMethod)("subarray",(function(t,e){var i=a(this),r=i.length,l=s(t,r);return new(o(i))(i.buffer,i.byteOffset+l*i.BYTES_PER_ELEMENT,n((void 0===e?r:s(e,r))-l))}))},{"../internals/array-buffer-view-core":117,"../internals/to-absolute-index":279,"../internals/to-length":284,"../internals/typed-array-species-constructor":298}],377:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/function-apply"),s=t("../internals/array-buffer-view-core"),o=t("../internals/fails"),a=t("../internals/array-slice"),l=r.Int8Array,c=s.aTypedArray,h=s.exportTypedArrayMethod,u=[].toLocaleString,d=!!l&&o((function(){u.call(new l(1))}));h("toLocaleString",(function(){return n(u,d?a(c(this)):c(this),a(arguments))}),o((function(){return[1,2].toLocaleString()!==new l([1,2]).toLocaleString()}))||!o((function(){l.prototype.toLocaleString.call([1,2])})))},{"../internals/array-buffer-view-core":117,"../internals/array-slice":131,"../internals/fails":171,"../internals/function-apply":174,"../internals/global":188}],378:[function(t,e,i){var r=t("../internals/array-buffer-view-core").exportTypedArrayMethod,n=t("../internals/fails"),s=t("../internals/global"),o=t("../internals/function-uncurry-this"),a=s.Uint8Array,l=a&&a.prototype||{},c=[].toString,h=o([].join);n((function(){c.call({})}))&&(c=function(){return h(this)});var u=l.toString!==c;r("toString",c,u)},{"../internals/array-buffer-view-core":117,"../internals/fails":171,"../internals/function-uncurry-this":181,"../internals/global":188}],379:[function(t,e,i){t("../internals/typed-array-constructor")("Uint8",(function(t){return function(e,i,r){return t(this,e,i,r)}}))},{"../internals/typed-array-constructor":294}],380:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/dom-iterables"),s=t("../internals/dom-token-list-prototype"),o=t("../internals/array-for-each"),a=t("../internals/create-non-enumerable-property"),l=function(t){if(t&&t.forEach!==o)try{a(t,"forEach",o)}catch(e){t.forEach=o}};for(var c in n)n[c]&&l(r[c]&&r[c].prototype);l(s)},{"../internals/array-for-each":121,"../internals/create-non-enumerable-property":145,"../internals/dom-iterables":156,"../internals/dom-token-list-prototype":157,"../internals/global":188}],381:[function(t,e,i){var r=t("../internals/global"),n=t("../internals/dom-iterables"),s=t("../internals/dom-token-list-prototype"),o=t("../modules/es.array.iterator"),a=t("../internals/create-non-enumerable-property"),l=t("../internals/set-to-string-tag"),c=t("../internals/well-known-symbol")("iterator"),h=o.values,u=function(t,e){if(t){if(t[c]!==h)try{a(t,c,h)}catch(r){t[c]=h}if(l(t,e,!0),n[e])for(var i in o)if(t[i]!==o[i])try{a(t,i,o[i])}catch(r){t[i]=o[i]}}};for(var d in n)u(r[d]&&r[d].prototype,d);u(s,"DOMTokenList")},{"../internals/create-non-enumerable-property":145,"../internals/dom-iterables":156,"../internals/dom-token-list-prototype":157,"../internals/global":188,"../internals/set-to-string-tag":266,"../internals/well-known-symbol":306,"../modules/es.array.iterator":316}],382:[function(t,e,i){function r(t){return Array.isArray?Array.isArray(t):"[object Array]"===g(t)}function n(t){return"boolean"==typeof t}function s(t){return null===t}function o(t){return null==t}function a(t){return"number"==typeof t}function l(t){return"string"==typeof t}function c(t){return"symbol"==typeof t}function h(t){return void 0===t}function u(t){return"[object RegExp]"===g(t)}function d(t){return"object"==typeof t&&null!==t}function p(t){return"[object Date]"===g(t)}function f(t){return"[object Error]"===g(t)||t instanceof Error}function _(t){return"function"==typeof t}function m(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function g(t){return Object.prototype.toString.call(t)}i.isArray=r,i.isBoolean=n,i.isNull=s,i.isNullOrUndefined=o,i.isNumber=a,i.isString=l,i.isSymbol=c,i.isUndefined=h,i.isRegExp=u,i.isObject=d,i.isDate=p,i.isError=f,i.isFunction=_,i.isPrimitive=m,i.isBuffer=t("buffer").Buffer.isBuffer},{buffer:103}],383:[function(t,e,i){!function(t){var r=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g;return function(l,c,h,u){if(1!==arguments.length||"string"!==a(l)||/\d/.test(l)||(c=l,l=void 0),(l=l||new Date)instanceof Date||(l=new Date(l)),isNaN(l))throw TypeError("Invalid date");var d=(c=String(r.masks[c]||c||r.masks.default)).slice(0,4);"UTC:"!==d&&"GMT:"!==d||(c=c.slice(4),h=!0,"GMT:"===d&&(u=!0));var p=h?"getUTC":"get",f=l[p+"Date"](),_=l[p+"Day"](),m=l[p+"Month"](),g=l[p+"FullYear"](),y=l[p+"Hours"](),v=l[p+"Minutes"](),b=l[p+"Seconds"](),x=l[p+"Milliseconds"](),T=h?0:l.getTimezoneOffset(),C=s(l),S=o(l),w={d:f,dd:n(f),ddd:r.i18n.dayNames[_],dddd:r.i18n.dayNames[_+7],m:m+1,mm:n(m+1),mmm:r.i18n.monthNames[m],mmmm:r.i18n.monthNames[m+12],yy:String(g).slice(2),yyyy:g,h:y%12||12,hh:n(y%12||12),H:y,HH:n(y),M:v,MM:n(v),s:b,ss:n(b),l:n(x,3),L:n(Math.round(x/10)),t:y<12?"a":"p",tt:y<12?"am":"pm",T:y<12?"A":"P",TT:y<12?"AM":"PM",Z:u?"GMT":h?"UTC":(String(l).match(e)||[""]).pop().replace(i,""),o:(T>0?"-":"+")+n(100*Math.floor(Math.abs(T)/60)+Math.abs(T)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10],W:C,N:S};return c.replace(t,(function(t){return t in w?w[t]:t.slice(1,t.length-1)}))}}();function n(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}function s(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var i=new Date(e.getFullYear(),0,4);i.setDate(i.getDate()-(i.getDay()+6)%7+3);var r=e.getTimezoneOffset()-i.getTimezoneOffset();e.setHours(e.getHours()-r);var n=(e-i)/6048e5;return 1+Math.floor(n)}function o(t){var e=t.getDay();return 0===e&&(e=7),e}function a(t){return null===t?"null":void 0===t?"undefined":"object"!=typeof t?typeof t:Array.isArray(t)?"array":{}.toString.call(t).slice(8,-1).toLowerCase()}r.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},r.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},"object"==typeof i?e.exports=r:t.dateFormat=r}(this)},{}],384:[function(t,i,r){var n=t("has-property-descriptors")(),s=t("get-intrinsic"),o=n&&s("%Object.defineProperty%",!0);if(o)try{o({},"a",{value:1})}catch(e){o=!1}var a=s("%SyntaxError%"),l=s("%TypeError%"),c=t("gopd");i.exports=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new l("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new l("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new l("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new l("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new l("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new l("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,h=arguments.length>6&&arguments[6],u=!!c&&c(t,e);if(o)o(t,e,{configurable:null===s&&u?u.configurable:!s,enumerable:null===r&&u?u.enumerable:!r,value:i,writable:null===n&&u?u.writable:!n});else{if(!h&&(r||n||s))throw new a("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}}},{"get-intrinsic":390,gopd:391,"has-property-descriptors":392}],385:[function(t,e,i){var r=/["'&<>]/;function n(t){var e,i=""+t,n=r.exec(i);if(!n)return i;var s="",o=0,a=0;for(o=n.index;o<i.length;o++){switch(i.charCodeAt(o)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}a!==o&&(s+=i.substring(a,o)),a=o+1,s+=e}return a!==o?s+i.substring(a,o):s}e.exports=n},{}],386:[function(t,e,i){var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};function o(t){console&&console.warn&&console.warn(t)}r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function l(){l.init.call(this)}e.exports=l,e.exports.once=b,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var c=10;function h(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?l.defaultMaxListeners:t._maxListeners}function d(t,e,i,r){var n,s,a;if(h(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),a=s[e]),void 0===a)a=s[e]=i,++t._eventsCount;else if("function"==typeof a?a=s[e]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=u(t))>0&&a.length>n&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,o(l)}return t}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=p.bind(r);return n.listener=i,r.wrapFn=n,n}function _(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?v(n):g(n,n.length)}function m(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function y(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function v(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function b(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,s),r(i)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}T(t,e,s,{once:!0}),"error"!==e&&x(t,n,{once:!0})}))}function x(t,e,i){"function"==typeof t.on&&T(t,"error",e,i)}function T(t,e,i,r){if("function"==typeof t.on)r.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(s){r.once&&t.removeEventListener(e,n),i(s)}))}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},l.prototype.getMaxListeners=function(){return u(this)},l.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=n[t];if(void 0===l)return!1;if("function"==typeof l)s(l,this,e);else{var c=l.length,h=g(l,c);for(i=0;i<c;++i)s(h[i],this,e)}return!0},l.prototype.addListener=function(t,e){return d(this,t,e,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(t,e){return d(this,t,e,!0)},l.prototype.once=function(t,e){return h(e),this.on(t,f(this,t,e)),this},l.prototype.prependOnceListener=function(t,e){return h(e),this.prependListener(t,f(this,t,e)),this},l.prototype.removeListener=function(t,e){var i,r,n,s,o;if(h(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():y(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},l.prototype.listeners=function(t){return _(this,t,!0)},l.prototype.rawListeners=function(t){return _(this,t,!1)},l.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):m.call(t,e)},l.prototype.listenerCount=m,l.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},{}],387:[function(t,e,i){var r=t("is-callable"),n=Object.prototype.toString,s=Object.prototype.hasOwnProperty,o=function(t,e,i){for(var r=0,n=t.length;r<n;r++)s.call(t,r)&&(null==i?e(t[r],r,t):e.call(i,t[r],r,t))},a=function(t,e,i){for(var r=0,n=t.length;r<n;r++)null==i?e(t.charAt(r),r,t):e.call(i,t.charAt(r),r,t)},l=function(t,e,i){for(var r in t)s.call(t,r)&&(null==i?e(t[r],r,t):e.call(i,t[r],r,t))},c=function(t,e,i){if(!r(e))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=i),"[object Array]"===n.call(t)?o(t,e,s):"string"==typeof t?a(t,e,s):l(t,e,s)};e.exports=c},{"is-callable":410}],388:[function(t,e,i){var r="Function.prototype.bind called on incompatible ",n=Object.prototype.toString,s=Math.max,o="[object Function]",a=function(t,e){for(var i=[],r=0;r<t.length;r+=1)i[r]=t[r];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},l=function(t,e){for(var i=[],r=e,n=0;r<t.length;r+=1,n+=1)i[n]=t[r];return i},c=function(t,e){for(var i="",r=0;r<t.length;r+=1)i+=t[r],r+1<t.length&&(i+=e);return i};e.exports=function(t){var e=this;if("function"!=typeof e||n.apply(e)!==o)throw new TypeError(r+e);for(var i,h=l(arguments,1),u=function(){if(this instanceof i){var r=e.apply(this,a(h,arguments));return Object(r)===r?r:this}return e.apply(t,a(h,arguments))},d=s(0,e.length-h.length),p=[],f=0;f<d;f++)p[f]="$"+f;if(i=Function("binder","return function ("+c(p,",")+"){ return binder.apply(this,arguments); }")(u),e.prototype){var _=function(){};_.prototype=e.prototype,i.prototype=new _,_.prototype=null}return i}},{}],389:[function(t,e,i){var r=t("./implementation");e.exports=Function.prototype.bind||r},{"./implementation":388}],390:[function(t,i,r){var n,s=SyntaxError,o=Function,a=TypeError,l=function(t){try{return o('"use strict"; return ('+t+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var h=function(){throw new a},u=c?function(){try{return h}catch(t){try{return c(arguments,"callee").get}catch(e){return h}}}():h,d=t("has-symbols")(),p=t("has-proto")(),f=Object.getPrototypeOf||(p?function(t){return t.__proto__}:null),_={},m="undefined"!=typeof Uint8Array&&f?f(Uint8Array):n,g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d&&f?f([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":_,"%AsyncGenerator%":_,"%AsyncGeneratorFunction%":_,"%AsyncIteratorPrototype%":_,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":_,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&f?f(f([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d&&f?f((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d&&f?f((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&f?f(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(f)try{null.error}catch(e){var y=f(f(e));g["%Error.prototype%"]=y}var v=function t(e){var i;if("%AsyncFunction%"===e)i=l("async function () {}");else if("%GeneratorFunction%"===e)i=l("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=l("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&f&&(i=f(n.prototype))}return g[e]=i,i},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},x=t("function-bind"),T=t("hasown"),C=x.call(Function.call,Array.prototype.concat),S=x.call(Function.apply,Array.prototype.splice),w=x.call(Function.call,String.prototype.replace),A=x.call(Function.call,String.prototype.slice),E=x.call(Function.call,RegExp.prototype.exec),D=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L=/\\(\\)?/g,I=function(t){var e=A(t,0,1),i=A(t,-1);if("%"===e&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var r=[];return w(t,D,(function(t,e,i,n){r[r.length]=i?w(n,L,"$1"):e||t})),r},P=function(t,e){var i,r=t;if(T(b,r)&&(r="%"+(i=b[r])[0]+"%"),T(g,r)){var n=g[r];if(n===_&&(n=v(r)),void 0===n&&!e)throw new a("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:n}}throw new s("intrinsic "+t+" does not exist!")};i.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new a('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=I(t),r=i.length>0?i[0]:"",n=P("%"+r+"%",e),o=n.name,l=n.value,h=!1,u=n.alias;u&&(r=u[0],S(i,C([0,1],u)));for(var d=1,p=!0;d<i.length;d+=1){var f=i[d],_=A(f,0,1),m=A(f,-1);if(('"'===_||"'"===_||"`"===_||'"'===m||"'"===m||"`"===m)&&_!==m)throw new s("property names with quotes must have matching quotes");if("constructor"!==f&&p||(h=!0),T(g,o="%"+(r+="."+f)+"%"))l=g[o];else if(null!=l){if(!(f in l)){if(!e)throw new a("base intrinsic for "+t+" exists, but the property is not available.");return}if(c&&d+1>=i.length){var y=c(l,f);l=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[f]}else p=T(l,f),l=l[f];p&&!h&&(g[o]=l)}}return l}},{"function-bind":389,"has-proto":393,"has-symbols":394,hasown:397}],391:[function(t,i,r){var n=t("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}i.exports=n},{"get-intrinsic":390}],392:[function(t,i,r){var n=t("get-intrinsic")("%Object.defineProperty%",!0),s=function(){if(n)try{return n({},"a",{value:1}),!0}catch(e){return!1}return!1};s.hasArrayLengthDefineBug=function(){if(!s())return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},i.exports=s},{"get-intrinsic":390}],393:[function(t,e,i){var r={foo:{}},n=Object;e.exports=function(){return{__proto__:r}.foo===r.foo&&!({__proto__:null}instanceof n)}},{}],394:[function(t,e,i){var r="undefined"!=typeof Symbol&&Symbol,n=t("./shams");e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&n()}},{"./shams":395}],395:[function(t,e,i){e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;var r=42;for(e in t[e]=r,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,e);if(s.value!==r||!0!==s.enumerable)return!1}return!0}},{}],396:[function(t,e,i){var r=t("has-symbols/shams");e.exports=function(){return r()&&!!Symbol.toStringTag}},{"has-symbols/shams":395}],397:[function(t,e,i){var r=Function.prototype.call,n=Object.prototype.hasOwnProperty,s=t("function-bind");e.exports=s.call(r,n)},{"function-bind":389}],398:[function(t,e,i){var r=t("http"),n=t("url"),s=e.exports;for(var o in r)r.hasOwnProperty(o)&&(s[o]=r[o]);function a(t){if("string"==typeof t&&(t=n.parse(t)),t.protocol||(t.protocol="https:"),"https:"!==t.protocol)throw new Error('Protocol "'+t.protocol+'" not supported. Expected "https:"');return t}s.request=function(t,e){return t=a(t),r.request.call(this,t,e)},s.get=function(t,e){return t=a(t),r.get.call(this,t,e)}},{http:539,url:543}],399:[function(t,e,i){var r=t("util"),n=t("ms");e.exports=function(t){if("number"==typeof t)return t;var e=n(t);if(void 0===e){var i=new Error(r.format("humanize-ms(%j) result undefined",t));console.warn(i.stack)}return e}},{ms:432,util:489}],400:[function(t,e,i){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(t,e,i,r,n){var s,o,a=8*n-r-1,l=(1<<a)-1,c=l>>1,h=-7,u=i?n-1:0,d=i?-1:1,p=t[e+u];for(u+=d,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+t[e+u],u+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+t[e+u],u+=d,h-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=c}return(p?-1:1)*o*Math.pow(2,s-r)},i.write=function(t,e,i,r,n,s){var o,a,l,c=8*s-n-1,h=(1<<c)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,f=r?1:-1,_=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=h?(a=0,o=h):o+u>=1?(a=(e*l-1)*Math.pow(2,n),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;t[i+p]=255&o,p+=f,o/=256,c-=8);t[i+p-f]|=128*_}},{}],401:[function(t,e,i){var r,n,s,o=[t("./nextTick"),t("./queueMicrotask"),t("./mutation.js"),t("./messageChannel"),t("./stateChange"),t("./timeout")],a=-1,l=[],c=!1;function h(){r&&n&&(r=!1,n.length?l=n.concat(l):a=-1,l.length&&u())}function u(){if(!r){c=!1,r=!0;for(var t=l.length,e=setTimeout(h);t;){for(n=l,l=[];n&&++a<t;)n[a].run();a=-1,t=l.length}n=null,a=-1,r=!1,clearTimeout(e)}}for(var d=-1,p=o.length;++d<p;)if(o[d]&&o[d].test&&o[d].test()){s=o[d].install(u);break}function f(t,e){this.fun=t,this.array=e}function _(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new f(t,e)),c||r||(c=!0,s())}f.prototype.run=function(){var t=this.fun,e=this.array;switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);default:return t.apply(null,e)}},e.exports=_},{"./messageChannel":402,"./mutation.js":403,"./nextTick":102,"./queueMicrotask":404,"./stateChange":405,"./timeout":406}],402:[function(t,e,r){(function(t){(function(){r.test=function(){return!t.setImmediate&&void 0!==t.MessageChannel},r.install=function(e){var i=new t.MessageChannel;return i.port1.onmessage=e,function(){i.port2.postMessage(0)}}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],403:[function(t,e,r){(function(t){(function(){var e=t.MutationObserver||t.WebKitMutationObserver;r.test=function(){return e},r.install=function(i){var r=0,n=new e(i),s=t.document.createTextNode("");return n.observe(s,{characterData:!0}),function(){s.data=r=++r%2}}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],404:[function(t,e,r){(function(t){(function(){r.test=function(){return"function"==typeof t.queueMicrotask},r.install=function(e){return function(){t.queueMicrotask(e)}}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],405:[function(t,e,r){(function(t){(function(){r.test=function(){return"document"in t&&"onreadystatechange"in t.document.createElement("script")},r.install=function(e){return function(){var i=t.document.createElement("script");return i.onreadystatechange=function(){e(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},t.document.documentElement.appendChild(i),e}}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],406:[function(t,e,i){i.test=function(){return!0},i.install=function(t){return function(){setTimeout(t,0)}}},{}],407:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},{}],408:[function(t,e,i){var r=t("has-tostringtag/shams")(),n=t("call-bind/callBound")("Object.prototype.toString"),s=function(t){return!(r&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===n(t)},o=function(t){return!!s(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==n(t)&&"[object Function]"===n(t.callee)},a=function(){return s(arguments)}();s.isLegacyArguments=o,e.exports=a?s:o},{"call-bind/callBound":105,"has-tostringtag/shams":396}],409:[function(t,e,i){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function n(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}
/*!
      		       * Determine if an object is a Buffer
      		       *
      		       * @author   Feross Aboukhadijeh <https://feross.org>
      		       * @license  MIT
      		       */
e.exports=function(t){return null!=t&&(r(t)||n(t)||!!t._isBuffer)}},{}],410:[function(t,i,r){var n,s,o=Function.prototype.toString,a="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof a&&"function"==typeof Object.defineProperty)try{n=Object.defineProperty({},"length",{get:function(){throw s}}),s={},a((function(){throw 42}),null,n)}catch(T){T!==s&&(a=null)}else a=null;var l=/^\s*class\b/,c=function(t){try{var i=o.call(t);return l.test(i)}catch(e){return!1}},h=function(t){try{return!c(t)&&(o.call(t),!0)}catch(e){return!1}},u=Object.prototype.toString,d="[object Object]",p="[object Function]",f="[object GeneratorFunction]",_="[object HTMLAllCollection]",m="[object HTML document.all class]",g="[object HTMLCollection]",y="function"==typeof Symbol&&!!Symbol.toStringTag,v=!(0 in[,]),b=function(){return!1};if("object"==typeof document){var x=document.all;u.call(x)===u.call(document.all)&&(b=function(t){if((v||!t)&&(void 0===t||"object"==typeof t))try{var i=u.call(t);return(i===_||i===m||i===g||i===d)&&null==t("")}catch(e){}return!1})}i.exports=a?function(t){if(b(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{a(t,null,n)}catch(e){if(e!==s)return!1}return!c(t)&&h(t)}:function(t){if(b(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(y)return h(t);if(c(t))return!1;var e=u.call(t);return!(e!==p&&e!==f&&!/^\[object HTML/.test(e))&&h(t)}},{}],411:[function(t,i,r){var n,s=Object.prototype.toString,o=Function.prototype.toString,a=/^\s*(?:function)?\*/,l=t("has-tostringtag/shams")(),c=Object.getPrototypeOf,h=function(){if(!l)return!1;try{return Function("return function*() {}")()}catch(e){}};i.exports=function(t){if("function"!=typeof t)return!1;if(a.test(o.call(t)))return!0;if(!l)return"[object GeneratorFunction]"===s.call(t);if(!c)return!1;if(void 0===n){var e=h();n=!!e&&c(e)}return c(t)===n}},{"has-tostringtag/shams":396}],412:[function(t,e,i){var r=t("which-typed-array");e.exports=function(t){return!!r(t)}},{"which-typed-array":490}],413:[function(t,e,r){(function(t){(function(){var i,n;i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:this,n=function(t){var i,r=(t=t||{}).Base64,n="2.6.4",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(t){for(var e={},i=0,r=t.length;i<r;i++)e[t.charAt(i)]=i;return e}(s),a=String.fromCharCode,l=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?a(192|e>>>6)+a(128|63&e):a(224|e>>>12&15)+a(128|e>>>6&63)+a(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return a(240|e>>>18&7)+a(128|e>>>12&63)+a(128|e>>>6&63)+a(128|63&e)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,h=function(t){return t.replace(c,l)},u=function(t){var e=[0,2,1][t.length%3],i=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[s.charAt(i>>>18),s.charAt(i>>>12&63),e>=2?"=":s.charAt(i>>>6&63),e>=1?"=":s.charAt(63&i)].join("")},d=t.btoa&&"function"==typeof t.btoa?function(e){return t.btoa(e)}:function(t){if(t.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return t.replace(/[\s\S]{1,3}/g,u)},p=function(t){return d(h(String(t)))},f=function(t){return t.replace(/[+\/]/g,(function(t){return"+"==t?"-":"_"})).replace(/=/g,"")},_=function(t,e){return e?f(p(t)):p(t)},m=function(t){return _(t,!0)};t.Uint8Array&&(i=function(t,e){for(var i="",r=0,n=t.length;r<n;r+=3){var o=t[r],a=t[r+1],l=t[r+2],c=o<<16|a<<8|l;i+=s.charAt(c>>>18)+s.charAt(c>>>12&63)+(void 0!==a?s.charAt(c>>>6&63):"=")+(void 0!==l?s.charAt(63&c):"=")}return e?f(i):i});var g,y=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,v=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return a(55296+(e>>>10))+a(56320+(1023&e));case 3:return a((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return a((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},b=function(t){return t.replace(y,v)},x=function(t){var e=t.length,i=e%4,r=(e>0?o[t.charAt(0)]<<18:0)|(e>1?o[t.charAt(1)]<<12:0)|(e>2?o[t.charAt(2)]<<6:0)|(e>3?o[t.charAt(3)]:0),n=[a(r>>>16),a(r>>>8&255),a(255&r)];return n.length-=[0,0,2,1][i],n.join("")},T=t.atob&&"function"==typeof t.atob?function(e){return t.atob(e)}:function(t){return t.replace(/\S{1,4}/g,x)},C=function(t){return T(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},S=function(t){return b(T(t))},w=function(t){return String(t).replace(/[-_]/g,(function(t){return"-"==t?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")},A=function(t){return S(w(t))};t.Uint8Array&&(g=function(t){return Uint8Array.from(C(w(t)),(function(t){return t.charCodeAt(0)}))});var E=function(){var e=t.Base64;return t.Base64=r,e};if(t.Base64={VERSION:n,atob:C,btoa:d,fromBase64:A,toBase64:_,utob:h,encode:_,encodeURI:m,btou:b,decode:A,noConflict:E,fromUint8Array:i,toUint8Array:g},"function"==typeof Object.defineProperty){var D=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",D((function(){return A(this)}))),Object.defineProperty(String.prototype,"toBase64",D((function(t){return _(this,t)}))),Object.defineProperty(String.prototype,"toBase64URI",D((function(){return _(this,!0)})))}}return t.Meteor&&(Base64=t.Base64),void 0!==e&&e.exports&&(e.exports.Base64=t.Base64),{Base64:t.Base64}},"object"==typeof r&&void 0!==e?e.exports=n(i):n(i)}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],414:[function(t,e,i){var r=t("./_root").Symbol;e.exports=r},{"./_root":421}],415:[function(t,e,i){function r(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}e.exports=r},{}],416:[function(t,e,i){var r=t("./_Symbol"),n=t("./_getRawTag"),s=t("./_objectToString"),o="[object Null]",a="[object Undefined]",l=r?r.toStringTag:void 0;function c(t){return null==t?void 0===t?a:o:l&&l in Object(t)?n(t):s(t)}e.exports=c},{"./_Symbol":414,"./_getRawTag":419,"./_objectToString":420}],417:[function(t,e,i){var r=t("./_Symbol"),n=t("./_arrayMap"),s=t("./isArray"),o=t("./isSymbol"),a=r?r.prototype:void 0,l=a?a.toString:void 0;function c(t){if("string"==typeof t)return t;if(s(t))return n(t,c)+"";if(o(t))return l?l.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}e.exports=c},{"./_Symbol":414,"./_arrayMap":415,"./isArray":422,"./isSymbol":426}],418:[function(t,e,r){(function(t){(function(){var i="object"==typeof t&&t&&t.Object===Object&&t;e.exports=i}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],419:[function(t,i,r){var n=t("./_Symbol"),s=Object.prototype,o=s.hasOwnProperty,a=s.toString,l=n?n.toStringTag:void 0;function c(t){var i=o.call(t,l),r=t[l];try{t[l]=void 0;var n=!0}catch(e){}var s=a.call(t);return n&&(i?t[l]=r:delete t[l]),s}i.exports=c},{"./_Symbol":414}],420:[function(t,e,i){var r=Object.prototype.toString;function n(t){return r.call(t)}e.exports=n},{}],421:[function(t,e,i){var r=t("./_freeGlobal"),n="object"==typeof self&&self&&self.Object===Object&&self,s=r||n||Function("return this")();e.exports=s},{"./_freeGlobal":418}],422:[function(t,e,i){var r=Array.isArray;e.exports=r},{}],423:[function(t,e,i){function r(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}e.exports=r},{}],424:[function(t,e,i){function r(t){return null!=t&&"object"==typeof t}e.exports=r},{}],425:[function(t,e,i){var r=t("./_baseGetTag"),n=t("./isArray"),s=t("./isObjectLike"),o="[object String]";function a(t){return"string"==typeof t||!n(t)&&s(t)&&r(t)==o}e.exports=a},{"./_baseGetTag":416,"./isArray":422,"./isObjectLike":424}],426:[function(t,e,i){var r=t("./_baseGetTag"),n=t("./isObjectLike"),s="[object Symbol]";function o(t){return"symbol"==typeof t||n(t)&&r(t)==s}e.exports=o},{"./_baseGetTag":416,"./isObjectLike":424}],427:[function(t,e,i){var r=t("./_baseToString");function n(t){return null==t?"":r(t)}e.exports=n},{"./_baseToString":417}],428:[function(t,e,i){e.exports=n;var r=Object.prototype.hasOwnProperty;function n(t,e,i){if(!t)throw new TypeError("argument dest is required");if(!e)throw new TypeError("argument src is required");return void 0===i&&(i=!0),Object.getOwnPropertyNames(e).forEach((function(n){if(i||!r.call(t,n)){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s)}})),t}},{}],429:[function(t,e,i){function r(){this._types=Object.create(null),this._extensions=Object.create(null);for(var t=0;t<arguments.length;t++)this.define(arguments[t]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}t("core-js/modules/es.array.map.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.regexp.constructor.js"),t("core-js/modules/es.regexp.to-string.js"),r.prototype.define=function(t,e){for(var i in t){var r=t[i].map((function(t){return t.toLowerCase()}));i=i.toLowerCase();for(var n=0;n<r.length;n++){var s=r[n];if("*"!==s[0]){if(!e&&s in this._types)throw new Error('Attempt to change mapping for "'+s+'" extension from "'+this._types[s]+'" to "'+i+'". Pass `force=true` to allow this, otherwise remove "'+s+'" from the list of extensions for "'+i+'".');this._types[s]=i}}if(e||!this._extensions[i]){var o=r[0];this._extensions[i]="*"!==o[0]?o:o.substr(1)}}},r.prototype.getType=function(t){var e=(t=String(t)).replace(/^.*[/\\]/,"").toLowerCase(),i=e.replace(/^.*\./,"").toLowerCase(),r=e.length<t.length;return(i.length<e.length-1||!r)&&this._types[i]||null},r.prototype.getExtension=function(t){return(t=/^\s*([^;\s]*)/.test(t)&&RegExp.$1)&&this._extensions[t.toLowerCase()]||null},e.exports=r},{"core-js/modules/es.array.map.js":318,"core-js/modules/es.regexp.constructor.js":337,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/es.string.replace.js":345}],430:[function(t,e,i){var r=t("./Mime");e.exports=new r(t("./types/standard"))},{"./Mime":429,"./types/standard":431}],431:[function(t,e,i){e.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},{}],432:[function(t,e,i){var r=1e3,n=60*r,s=60*n,o=24*s,a=7*o,l=365.25*o;function c(t){if(!((t=String(t)).length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var i=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*l;case"weeks":case"week":case"w":return i*a;case"days":case"day":case"d":return i*o;case"hours":case"hour":case"hrs":case"hr":case"h":return i*s;case"minutes":case"minute":case"mins":case"min":case"m":return i*n;case"seconds":case"second":case"secs":case"sec":case"s":return i*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}function h(t){var e=Math.abs(t);return e>=o?Math.round(t/o)+"d":e>=s?Math.round(t/s)+"h":e>=n?Math.round(t/n)+"m":e>=r?Math.round(t/r)+"s":t+"ms"}function u(t){var e=Math.abs(t);return e>=o?d(t,e,o,"day"):e>=s?d(t,e,s,"hour"):e>=n?d(t,e,n,"minute"):e>=r?d(t,e,r,"second"):t+" ms"}function d(t,e,i,r){var n=e>=1.5*i;return Math.round(t/i)+" "+r+(n?"s":"")}e.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return c(t);if("number"===i&&isFinite(t))return e.long?u(t):h(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},{}],433:[function(t,r,n){(function(i){(function(){var n="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=n&&o&&"function"==typeof o.get?o.get:null,l=n&&Map.prototype.forEach,c="function"==typeof Set&&Set.prototype,h=Object.getOwnPropertyDescriptor&&c?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,u=c&&h&&"function"==typeof h.get?h.get:null,d=c&&Set.prototype.forEach,p="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,_="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,y=Object.prototype.toString,v=Function.prototype.toString,b=String.prototype.match,x=String.prototype.slice,T=String.prototype.replace,C=String.prototype.toUpperCase,S=String.prototype.toLowerCase,w=RegExp.prototype.test,A=Array.prototype.concat,E=Array.prototype.join,D=Array.prototype.slice,L=Math.floor,I="function"==typeof BigInt?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,R="function"==typeof Symbol&&"object"==typeof Symbol.iterator,O="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,B=Object.prototype.propertyIsEnumerable,N=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function k(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-L(-t):L(t);if(r!==t){var n=String(r),s=x.call(e,n.length+1);return T.call(n,i,"$&_")+"."+T.call(T.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return T.call(e,i,"$&_")}var F=t("./util.inspect"),V=F.custom,j=q(V)?V:null;function G(t,e,i){var r="double"===(i.quoteStyle||e)?'"':"'";return r+t+r}function U(t){return T.call(String(t),/"/g,"&quot;")}function Y(t){return!("[object Array]"!==tt(t)||O&&"object"==typeof t&&O in t)}function H(t){return!("[object Date]"!==tt(t)||O&&"object"==typeof t&&O in t)}function X(t){return!("[object RegExp]"!==tt(t)||O&&"object"==typeof t&&O in t)}function z(t){return!("[object Error]"!==tt(t)||O&&"object"==typeof t&&O in t)}function W(t){return!("[object String]"!==tt(t)||O&&"object"==typeof t&&O in t)}function Z(t){return!("[object Number]"!==tt(t)||O&&"object"==typeof t&&O in t)}function J(t){return!("[object Boolean]"!==tt(t)||O&&"object"==typeof t&&O in t)}function q(t){if(R)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!M)return!1;try{return M.call(t),!0}catch(e){}return!1}function K(t){if(!t||"object"!=typeof t||!I)return!1;try{return I.call(t),!0}catch(e){}return!1}r.exports=function t(e,r,n,s){var o=r||{};if($(o,"quoteStyle")&&"single"!==o.quoteStyle&&"double"!==o.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if($(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!$(o,"customInspect")||o.customInspect;if("boolean"!=typeof c&&"symbol"!==c)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if($(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if($(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=o.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return ct(e,o);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var p=String(e);return h?k(e,p):p}if("bigint"==typeof e){var f=String(e)+"n";return h?k(e,f):f}var _=void 0===o.depth?5:o.depth;if(void 0===n&&(n=0),n>=_&&_>0&&"object"==typeof e)return Y(e)?"[Array]":"[Object]";var m=_t(o,n);if(void 0===s)s=[];else if(it(s,e)>=0)return"[Circular]";function y(e,i,r){if(i&&(s=D.call(s)).push(i),r){var a={depth:o.depth};return $(o,"quoteStyle")&&(a.quoteStyle=o.quoteStyle),t(e,a,n+1,s)}return t(e,o,n+1,s)}if("function"==typeof e&&!X(e)){var v=et(e),b=gt(e,y);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(b.length>0?" { "+E.call(b,", ")+" }":"")}if(q(e)){var C=R?T.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):M.call(e);return"object"!=typeof e||R?C:ut(C)}if(lt(e)){for(var w="<"+S.call(String(e.nodeName)),L=e.attributes||[],P=0;P<L.length;P++)w+=" "+L[P].name+"="+G(U(L[P].value),"double",o);return w+=">",e.childNodes&&e.childNodes.length&&(w+="..."),w+="</"+S.call(String(e.nodeName))+">"}if(Y(e)){if(0===e.length)return"[]";var V=gt(e,y);return m&&!ft(V)?"["+mt(V,m)+"]":"[ "+E.call(V,", ")+" ]"}if(z(e)){var Q=gt(e,y);return"cause"in Error.prototype||!("cause"in e)||B.call(e,"cause")?0===Q.length?"["+String(e)+"]":"{ ["+String(e)+"] "+E.call(Q,", ")+" }":"{ ["+String(e)+"] "+E.call(A.call("[cause]: "+y(e.cause),Q),", ")+" }"}if("object"==typeof e&&c){if(j&&"function"==typeof e[j]&&F)return F(e,{depth:_-n});if("symbol"!==c&&"function"==typeof e.inspect)return e.inspect()}if(rt(e)){var ht=[];return l&&l.call(e,(function(t,i){ht.push(y(i,e,!0)+" => "+y(t,e))})),pt("Map",a.call(e),ht,m)}if(ot(e)){var yt=[];return d&&d.call(e,(function(t){yt.push(y(t,e))})),pt("Set",u.call(e),yt,m)}if(nt(e))return dt("WeakMap");if(at(e))return dt("WeakSet");if(st(e))return dt("WeakRef");if(Z(e))return ut(y(Number(e)));if(K(e))return ut(y(I.call(e)));if(J(e))return ut(g.call(e));if(W(e))return ut(y(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if(e===i)return"{ [object globalThis] }";if(!H(e)&&!X(e)){var vt=gt(e,y),bt=N?N(e)===Object.prototype:e instanceof Object||e.constructor===Object,xt=e instanceof Object?"":"null prototype",Tt=!bt&&O&&Object(e)===e&&O in e?x.call(tt(e),8,-1):xt?"Object":"",Ct=(bt||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(Tt||xt?"["+E.call(A.call([],Tt||[],xt||[]),": ")+"] ":"");return 0===vt.length?Ct+"{}":m?Ct+"{"+mt(vt,m)+"}":Ct+"{ "+E.call(vt,", ")+" }"}return String(e)};var Q=Object.prototype.hasOwnProperty||function(t){return t in this};function $(t,e){return Q.call(t,e)}function tt(t){return y.call(t)}function et(t){if(t.name)return t.name;var e=b.call(v.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function it(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function rt(t){if(!a||!t||"object"!=typeof t)return!1;try{a.call(t);try{u.call(t)}catch(s){return!0}return t instanceof Map}catch(e){}return!1}function nt(t){if(!p||!t||"object"!=typeof t)return!1;try{p.call(t,p);try{f.call(t,f)}catch(s){return!0}return t instanceof WeakMap}catch(e){}return!1}function st(t){if(!_||!t||"object"!=typeof t)return!1;try{return _.call(t),!0}catch(e){}return!1}function ot(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t);try{a.call(t)}catch(m){return!0}return t instanceof Set}catch(e){}return!1}function at(t){if(!f||!t||"object"!=typeof t)return!1;try{f.call(t,f);try{p.call(t,p)}catch(s){return!0}return t instanceof WeakSet}catch(e){}return!1}function lt(t){return!(!t||"object"!=typeof t)&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)}function ct(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,r="... "+i+" more character"+(i>1?"s":"");return ct(x.call(t,0,e.maxStringLength),e)+r}return G(T.call(T.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ht),"single",e)}function ht(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+C.call(e.toString(16))}function ut(t){return"Object("+t+")"}function dt(t){return t+" { ? }"}function pt(t,e,i,r){return t+" ("+e+") {"+(r?mt(i,r):E.call(i,", "))+"}"}function ft(t){for(var e=0;e<t.length;e++)if(it(t[e],"\n")>=0)return!1;return!0}function _t(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=E.call(Array(t.indent+1)," ")}return{base:i,prev:E.call(Array(e+1),i)}}function mt(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+E.call(t,","+i)+"\n"+e.prev}function gt(t,e){var i=Y(t),r=[];if(i){r.length=t.length;for(var n=0;n<t.length;n++)r[n]=$(t,n)?e(t[n],t):""}var s,o="function"==typeof P?P(t):[];if(R){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in t)$(t,l)&&(i&&String(Number(l))===l&&l<t.length||R&&s["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof P)for(var c=0;c<o.length;c++)B.call(t,o[c])&&r.push("["+e(o[c])+"]: "+e(t[o[c]],t));return r}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util.inspect":102}],434:[function(t,i,r){var n;if(!Object.keys){var s=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=t("./isArguments"),l=Object.prototype.propertyIsEnumerable,c=!l.call({toString:null},"toString"),h=l.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(t){var e=t.constructor;return e&&e.prototype===t},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&s.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{d(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),_=function(t){if("undefined"==typeof window||!f)return d(t);try{return d(t)}catch(e){return!1}};n=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===o.call(t),r=a(t),n=e&&"[object String]"===o.call(t),l=[];if(!e&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var d=h&&i;if(n&&t.length>0&&!s.call(t,0))for(var p=0;p<t.length;++p)l.push(String(p));if(r&&t.length>0)for(var f=0;f<t.length;++f)l.push(String(f));else for(var m in t)d&&"prototype"===m||!s.call(t,m)||l.push(String(m));if(c)for(var g=_(t),y=0;y<u.length;++y)g&&"constructor"===u[y]||!s.call(t,u[y])||l.push(u[y]);return l}}i.exports=n},{"./isArguments":436}],435:[function(t,e,i){var r=Array.prototype.slice,n=t("./isArguments"),s=Object.keys,o=s?function(t){return s(t)}:t("./implementation"),a=Object.keys;o.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return n(t)?a(r.call(t)):a(t)})}else Object.keys=o;return Object.keys||o},e.exports=o},{"./implementation":434,"./isArguments":436}],436:[function(t,e,i){var r=Object.prototype.toString;e.exports=function(t){var e=r.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===r.call(t.callee)),i}},{}],437:[function(t,e,i){var r=t("object-keys"),n=t("has-symbols/shams")(),s=t("call-bind/callBound"),o=Object,a=s("Array.prototype.push"),l=s("Object.prototype.propertyIsEnumerable"),c=n?Object.getOwnPropertySymbols:null;e.exports=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=o(t);if(1===arguments.length)return i;for(var s=1;s<arguments.length;++s){var h=o(arguments[s]),u=r(h),d=n&&(Object.getOwnPropertySymbols||c);if(d)for(var p=d(h),f=0;f<p.length;++f){var _=p[f];l(h,_)&&a(u,_)}for(var m=0;m<u.length;++m){var g=u[m];if(l(h,g)){var y=h[g];i[g]=y}}}return i}},{"call-bind/callBound":105,"has-symbols/shams":395,"object-keys":435}],438:[function(t,i,r){var n=t("./implementation"),s=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},r=0;r<e.length;++r)i[e[r]]=e[r];var n=Object.assign({},i),s="";for(var o in n)s+=o;return t!==s},o=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}return!1};i.exports=function(){return Object.assign?s()||o()?n:Object.assign:n}},{"./implementation":437}],439:[function(t,e,i){(function(t){(function(){function i(t){if("string"!=typeof t)throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function r(t,e){for(var i,r="",n=0,s=-1,o=0,a=0;a<=t.length;++a){if(a<t.length)i=t.charCodeAt(a);else{if(47===i)break;i=47}if(47===i){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var l=r.lastIndexOf("/");if(l!==r.length-1){-1===l?(r="",n=0):n=(r=r.slice(0,l)).length-1-r.lastIndexOf("/"),s=a,o=0;continue}}else if(2===r.length||1===r.length){r="",n=0,s=a,o=0;continue}e&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+="/"+t.slice(s+1,a):r=t.slice(s+1,a),n=a-s-1;s=a,o=0}else 46===i&&-1!==o?++o:o=-1}return r}function n(t,e){var i=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return i?i===e.root?i+r:i+t+r:r}var s={resolve:function(){for(var e,n="",s=!1,o=arguments.length-1;o>=-1&&!s;o--){var a;o>=0?a=arguments[o]:(void 0===e&&(e=t.cwd()),a=e),i(a),0!==a.length&&(n=a+"/"+n,s=47===a.charCodeAt(0))}return n=r(n,!s),s?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(t){if(i(t),0===t.length)return".";var e=47===t.charCodeAt(0),n=47===t.charCodeAt(t.length-1);return 0!==(t=r(t,!e)).length||e||(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return i(t),t.length>0&&47===t.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var t,e=0;e<arguments.length;++e){var r=arguments[e];i(r),r.length>0&&(void 0===t?t=r:t+="/"+r)}return void 0===t?".":s.normalize(t)},relative:function(t,e){if(i(t),i(e),t===e)return"";if((t=s.resolve(t))===(e=s.resolve(e)))return"";for(var r=1;r<t.length&&47===t.charCodeAt(r);++r);for(var n=t.length,o=n-r,a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var l=e.length-a,c=o<l?o:l,h=-1,u=0;u<=c;++u){if(u===c){if(l>c){if(47===e.charCodeAt(a+u))return e.slice(a+u+1);if(0===u)return e.slice(a+u)}else o>c&&(47===t.charCodeAt(r+u)?h=u:0===u&&(h=0));break}var d=t.charCodeAt(r+u);if(d!==e.charCodeAt(a+u))break;47===d&&(h=u)}var p="";for(u=r+h+1;u<=n;++u)u!==n&&47!==t.charCodeAt(u)||(0===p.length?p+="..":p+="/..");return p.length>0?p+e.slice(a+h):(a+=h,47===e.charCodeAt(a)&&++a,e.slice(a))},_makeLong:function(t){return t},dirname:function(t){if(i(t),0===t.length)return".";for(var e=t.charCodeAt(0),r=47===e,n=-1,s=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!s){n=o;break}}else s=!1;return-1===n?r?"/":".":r&&1===n?"//":t.slice(0,n)},basename:function(t,e){if(void 0!==e&&"string"!=typeof e)throw new TypeError('"ext" argument must be a string');i(t);var r,n=0,s=-1,o=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,l=-1;for(r=t.length-1;r>=0;--r){var c=t.charCodeAt(r);if(47===c){if(!o){n=r+1;break}}else-1===l&&(o=!1,l=r+1),a>=0&&(c===e.charCodeAt(a)?-1==--a&&(s=r):(a=-1,s=l))}return n===s?s=l:-1===s&&(s=t.length),t.slice(n,s)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!o){n=r+1;break}}else-1===s&&(o=!1,s=r+1);return-1===s?"":t.slice(n,s)},extname:function(t){i(t);for(var e=-1,r=0,n=-1,s=!0,o=0,a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(47!==l)-1===n&&(s=!1,n=a+1),46===l?-1===e?e=a:1!==o&&(o=1):-1!==e&&(o=-1);else if(!s){r=a+1;break}}return-1===e||-1===n||0===o||1===o&&e===n-1&&e===r+1?"":t.slice(e,n)},format:function(t){if(null===t||"object"!=typeof t)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return n("/",t)},parse:function(t){i(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;var r,n=t.charCodeAt(0),s=47===n;s?(e.root="/",r=1):r=0;for(var o=-1,a=0,l=-1,c=!0,h=t.length-1,u=0;h>=r;--h)if(47!==(n=t.charCodeAt(h)))-1===l&&(c=!1,l=h+1),46===n?-1===o?o=h:1!==u&&(u=1):-1!==o&&(u=-1);else if(!c){a=h+1;break}return-1===o||-1===l||0===u||1===u&&o===l-1&&o===a+1?-1!==l&&(e.base=e.name=0===a&&s?t.slice(1,l):t.slice(a,l)):(0===a&&s?(e.name=t.slice(1,o),e.base=t.slice(1,l)):(e.name=t.slice(a,o),e.base=t.slice(a,l)),e.ext=t.slice(o,l)),a>0?e.dir=t.slice(0,a-1):s&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};s.posix=s,e.exports=s}).call(this)}).call(this,t("_process"))},{_process:538}],440:[function(t,r,n){(function(t){(function(){(function(){var i={function:!0,object:!0},s=i[typeof window]&&window||this,o=i[typeof n]&&n,a=i[typeof r]&&r&&!r.nodeType&&r,l=o&&a&&"object"==typeof t&&t;!l||l.global!==l&&l.window!==l&&l.self!==l||(s=l);var c=Math.pow(2,53)-1,h=/\bOpera/,u=Object.prototype,d=u.hasOwnProperty,p=u.toString;function f(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function _(t,e,i){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return e&&i&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(r=r[/[\d.]+$/.exec(t)])&&(t="Windows "+r),t=String(t),e&&i&&(t=t.replace(RegExp(e,"i"),i)),t=g(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function m(t,e){var i=-1,r=t?t.length:0;if("number"==typeof r&&r>-1&&r<=c)for(;++i<r;)e(t[i],i,t);else y(t,e)}function g(t){return t=C(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:f(t)}function y(t,e){for(var i in t)d.call(t,i)&&e(t[i],i,t)}function v(t){return null==t?f(t):p.call(t).slice(8,-1)}function b(t,e){var i=null!=t?typeof t[e]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(i)||"object"==i&&!t[e])}function x(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function T(t,e){var i=null;return m(t,(function(r,n){i=e(i,r,n,t)})),i}function C(t){return String(t).replace(/^ +| +$/g,"")}function S(t){var i=s,r=t&&"object"==typeof t&&"String"!=v(t);r&&(i=t,t=null);var n=i.navigator||{},o=n.userAgent||"";t||(t=o);var a,l,c=r?!!n.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(p.toString()),u="Object",d=r?u:"ScriptBridgingProxyObject",f=r?u:"Environment",m=r&&i.java?"JavaPackage":v(i.java),w=r?u:"RuntimeObject",A=/\bJava/.test(m)&&i.java,E=A&&v(i.environment)==f,D=A?"a":"α",L=A?"b":"β",I=i.document||{},P=i.operamini||i.opera,M=h.test(M=r&&P?P["[[Class]]"]:v(P))?M:P=null,R=t,O=[],B=null,N=t==o,k=N&&P&&"function"==typeof P.version&&P.version(),F=Y([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=X(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),j=W([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),G=H({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=z(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function Y(e){return T(e,(function(e,i){return e||RegExp("\\b"+(i.pattern||x(i))+"\\b","i").exec(t)&&(i.label||i)}))}function H(e){return T(e,(function(e,i,r){return e||(i[j]||i[/^[a-z]+(?: +[a-z]+\b)*/i.exec(j)]||RegExp("\\b"+x(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}function X(e){return T(e,(function(e,i){return e||RegExp("\\b"+(i.pattern||x(i))+"\\b","i").exec(t)&&(i.label||i)}))}function z(e){return T(e,(function(e,i){var r=i.pattern||x(i);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=_(e,r,i.label||i)),e}))}function W(e){return T(e,(function(e,i){var r=i.pattern||x(i);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(i.label&&!RegExp(r,"i").test(i.label)?i.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),i=i.label||i,e=g(e[0].replace(RegExp(r,"i"),i).replace(RegExp("; *(?:"+i+"[_-])?","i")," ").replace(RegExp("("+i+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function Z(e){return T(e,(function(e,i){return e||(RegExp(i+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}function J(){return this.description||""}if(F&&(F=[F]),/\bAndroid\b/.test(U)&&!j&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(j=C(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),G&&!j?j=W([G]):G&&j&&(j=j.replace(RegExp("^("+x(G)+")[-_.\\s]","i"),G+" ").replace(RegExp("^("+x(G)+")[-_.]?(\\w)","i"),G+" $2")),(a=/\bGoogle TV\b/.exec(j))&&(j=a[0]),/\bSimulator\b/i.test(t)&&(j=(j?j+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&O.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(G=(a=S(t.replace(/like iPhone OS/,""))).manufacturer,j=a.product):/^iP/.test(j)?(V||(V="Safari"),U="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test(U)?U="Kubuntu":G&&"Google"!=G&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(j))||/\bAndroid\b/.test(U)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==V?(/\bMobi/i.test(t)||(U="Android",O.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&O.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?O.push("speed mode"):"PaleMoon"==V&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?O.push("identifying as Firefox "+a[1]):"Firefox"==V&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(U||(U="Firefox OS"),j||(j=a[1])):!V||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!j&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(V=null),(a=j||G||U)&&(j||G||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:a)+" Browser")):"Electron"==V&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&O.push("Chromium "+a),k||(k=Z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",x(V),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==F&&parseFloat(k)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(F)&&"WebKit"||!F&&/\bMSIE\b/i.test(t)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==F&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(F=[a]),"IE"==V&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",U="Windows Phone "+(/\+$/.test(a)?a:a+".x"),O.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",U="Windows Phone 8.x",O.unshift("desktop mode"),k||(k=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==F&&(a=/\brv:([\d.]+)/.exec(t))&&(V&&O.push("identifying as "+V+(k?" "+k:"")),V="IE",k=a[1]),N){if(b(i,"global"))if(A&&(R=(a=A.lang.System).getProperty("os.arch"),U=U||a.getProperty("os.name")+" "+a.getProperty("os.version")),E){try{k=i.require("ringo/engine").version.join("."),V="RingoJS"}catch(e){(a=i.system)&&a.global.system==i.system&&(V="Narwhal",U||(U=a[0].os||null))}V||(V="Rhino")}else"object"==typeof i.process&&!i.process.browser&&(a=i.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(O.push("Node "+a.versions.node),V="Electron",k=a.versions.electron):"string"==typeof a.versions.nw&&(O.push("Chromium "+k,"Node "+a.versions.node),V="NW.js",k=a.versions.nw)),V||(V="Node.js",R=a.arch,U=a.platform,k=(k=/[\d.]+/.exec(a.version))?k[0]:null));else v(a=i.runtime)==d?(V="Adobe AIR",U=a.flash.system.Capabilities.os):v(a=i.phantom)==w?(V="PhantomJS",k=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof I.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(k=[k,I.documentMode],(a=+a[1]+4)!=k[1]&&(O.push("IE "+k[1]+" mode"),F&&(F[1]=""),k[1]=a),k="IE"==V?String(k[1].toFixed(1)):k[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(O.push("masking as "+V+" "+k),V="IE",k="11.0",F=["Trident"],U="Windows");U=U&&g(U)}if(k&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(k)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(N&&n.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(B=/b/i.test(a)?"beta":"alpha",k=k.replace(RegExp(a+"\\+?$"),"")+("beta"==B?L:D)+(/\d+\+?/.exec(a)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))V="Firefox Mobile";else if("Maxthon"==V&&k)k=k.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(j))"Xbox 360"==j&&(U=null),"Xbox 360"==j&&/\bIEMobile\b/.test(t)&&O.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||j||/Browser|Mobi/.test(V))||"Windows CE"!=U&&!/Mobi/i.test(t))if("IE"==V&&N)try{null===i.external&&O.unshift("platform preview")}catch(e){O.unshift("embedded")}else(/\bBlackBerry\b/.test(j)||/\bBB10\b/.test(t))&&(a=(RegExp(j.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||k)?(U=((a=[a,/BB10/.test(t)])[1]?(j=null,G="BlackBerry"):"Device Software")+" "+a[0],k=null):this!=y&&"Wii"!=j&&(N&&P||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==V&&(U&&!/^Win/.test(U)&&k>5.5||/\bWindows XP\b/.test(U)&&k>8||8==k&&!/\bTrident\b/.test(t)))&&!h.test(a=S.call(y,t.replace(h,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),h.test(V)?(/\bIE\b/.test(a)&&"Mac OS"==U&&(U=null),a="identify"+a):(a="mask"+a,V=M?g(M.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(U=null),N||(k=null)),F=["Presto"],O.push(a));else V+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==V&&"+"==a[1].slice(-1)?(V="WebKit Nightly",B="alpha",k=a[1].slice(0,-1)):k!=a[1]&&k!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(k=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==F&&(F=["Blink"]),N&&(c||a[1])?(F&&(F[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=F?"27":"28")):(F&&(F[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),F&&(F[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==V&&(!k||parseInt(k)>45)?k=a:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&O.unshift("headless")),"Opera"==V&&(a=/\bzbov|zvav$/.exec(U))?(V+=" ",O.unshift("desktop mode"),"zvav"==a?(V+="Mini",k=null):V+="Mobile",U=U.replace(RegExp(" *"+a+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(F&&F[1])?(O.unshift("desktop mode"),V="Chrome Mobile",k=null,/\bOS X\b/.test(U)?(G="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(V)&&!k&&(k=Z("Chrome")),k&&0==k.indexOf(a=/[\d.]+$/.exec(U))&&t.indexOf("/"+a+"-")>-1&&(U=C(U.replace(a,""))),U&&-1!=U.indexOf(V)&&!RegExp(V+" OS").test(U)&&(U=U.replace(RegExp(" *"+x(V)+" *"),"")),F&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(U)&&/\bSafari\b/.test(F[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&F[1])&&(a=F[F.length-1])&&O.push(a),O.length&&(O=["("+O.join("; ")+")"]),G&&j&&j.indexOf(G)<0&&O.push("on "+G),j&&O.push((/^on /.test(O[O.length-1])?"":"on ")+j),U&&(a=/ ([\d.+]+)$/.exec(U),l=a&&"/"==U.charAt(U.length-a[0].length-1),U={architecture:32,family:a&&!l?U.replace(a[0],""):U,version:a?a[1]:null,toString:function(){var t=this.version;return this.family+(t&&!l?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(R))&&!/\bi686\b/i.test(R)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+a),"")),V&&(/\bWOW64\b/i.test(t)||N&&/\w(?:86|32)$/.test(n.cpuClass||n.platform)&&!/\bWin64; x64\b/i.test(t))&&O.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==V&&parseFloat(k)>=39&&(U.architecture=64),t||(t=null);var q={};return q.description=t,q.layout=F&&F[0],q.manufacturer=G,q.name=V,q.prerelease=B,q.product=j,q.ua=t,q.version=V&&k,q.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},q.parse=S,q.toString=J,q.version&&O.unshift(k),q.name&&O.unshift(V),U&&V&&(U!=String(U).split(" ")[0]||U!=V.split(" ")[0]&&!j)&&O.push(j?"("+U+")":"on "+U),O.length&&(q.description=O.join(" ")),q}var w=S();o&&a?y(w,(function(t,e){o[e]=t})):s.platform=w}).call(this)}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],441:[function(t,e,i){(function(t){(function(){function i(e,i,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,i)}));case 3:return t.nextTick((function(){e.call(null,i,r)}));case 4:return t.nextTick((function(){e.call(null,i,r,n)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return t.nextTick((function(){e.apply(null,s)}))}}void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:i}:e.exports=t}).call(this)}).call(this,t("_process"))},{_process:538}],442:[function(t,i,r){var n,s,o=i.exports={};function a(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(i){return n.call(this,t,0)}}}function h(t){if(s===clearTimeout)return clearTimeout(t);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{return s(t)}catch(e){try{return s.call(null,t)}catch(i){return s.call(this,t)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var u,d=[],p=!1,f=-1;function _(){p&&u&&(p=!1,u.length?d=u.concat(d):f=-1,d.length&&m())}function m(){if(!p){var t=c(_);p=!0;for(var e=d.length;e;){for(u=d,d=[];++f<e;)u&&u[f].run();f=-1,e=d.length}u=null,p=!1,h(t)}}function g(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d.push(new g(t,e)),1!==d.length||p||c(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],443:[function(t,e,r){(function(t){(function(){!function(i){var n="object"==typeof r&&r&&!r.nodeType&&r,s="object"==typeof e&&e&&!e.nodeType&&e,o="object"==typeof t&&t;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var a,l,c=2147483647,h=36,u=1,d=26,p=38,f=700,_=72,m=128,g="-",y=/^xn--/,v=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=h-u,C=Math.floor,S=String.fromCharCode;function w(t){throw new RangeError(x[t])}function A(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function E(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+A((t=t.replace(b,".")).split("."),e).join(".")}function D(t){for(var e,i,r=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(i=t.charCodeAt(n++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),n--):r.push(e);return r}function L(t){return A(t,(function(t){var e="";return t>65535&&(e+=S((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=S(t)})).join("")}function I(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:h}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,i){var r=0;for(t=i?C(t/f):t>>1,t+=C(t/e);t>T*d>>1;r+=h)t=C(t/T);return C(r+(T+1)*t/(t+p))}function R(t){var e,i,r,n,s,o,a,l,p,f,y=[],v=t.length,b=0,x=m,T=_;for((i=t.lastIndexOf(g))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&w("not-basic"),y.push(t.charCodeAt(r));for(n=i>0?i+1:0;n<v;){for(s=b,o=1,a=h;n>=v&&w("invalid-input"),((l=I(t.charCodeAt(n++)))>=h||l>C((c-b)/o))&&w("overflow"),b+=l*o,!(l<(p=a<=T?u:a>=T+d?d:a-T));a+=h)o>C(c/(f=h-p))&&w("overflow"),o*=f;T=M(b-s,e=y.length+1,0==s),C(b/e)>c-x&&w("overflow"),x+=C(b/e),b%=e,y.splice(b++,0,x)}return L(y)}function O(t){var e,i,r,n,s,o,a,l,p,f,y,v,b,x,T,A=[];for(v=(t=D(t)).length,e=m,i=0,s=_,o=0;o<v;++o)(y=t[o])<128&&A.push(S(y));for(r=n=A.length,n&&A.push(g);r<v;){for(a=c,o=0;o<v;++o)(y=t[o])>=e&&y<a&&(a=y);for(a-e>C((c-i)/(b=r+1))&&w("overflow"),i+=(a-e)*b,e=a,o=0;o<v;++o)if((y=t[o])<e&&++i>c&&w("overflow"),y==e){for(l=i,p=h;!(l<(f=p<=s?u:p>=s+d?d:p-s));p+=h)T=l-f,x=h-f,A.push(S(P(f+T%x,0))),l=C(T/x);A.push(S(P(l,0))),s=M(i,b,r==n),i=0,++r}++i,++e}return A.join("")}function B(t){return E(t,(function(t){return y.test(t)?R(t.slice(4).toLowerCase()):t}))}function N(t){return E(t,(function(t){return v.test(t)?"xn--"+O(t):t}))}if(a={version:"1.4.1",ucs2:{decode:D,encode:L},decode:R,encode:O,toASCII:N,toUnicode:B},n&&s)if(e.exports==n)s.exports=a;else for(l in a)a.hasOwnProperty(l)&&(n[l]=a[l]);else i.punycode=a}(this)}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],444:[function(t,e,i){var r=String.prototype.replace,n=/%20/g,s={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:s.RFC3986,formatters:{RFC1738:function(t){return r.call(t,n,"+")},RFC3986:function(t){return String(t)}},RFC1738:s.RFC1738,RFC3986:s.RFC3986}},{}],445:[function(t,e,i){var r=t("./stringify"),n=t("./parse"),s=t("./formats");e.exports={formats:s,parse:n,stringify:r}},{"./formats":444,"./parse":446,"./stringify":447}],446:[function(t,e,i){var r=t("./utils"),n=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},c="utf8=%26%2310003%3B",h="utf8=%E2%9C%93",u=function(t,e){var i,u={__proto__:null},d=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,p=e.parameterLimit===1/0?void 0:e.parameterLimit,f=d.split(e.delimiter,p),_=-1,m=e.charset;if(e.charsetSentinel)for(i=0;i<f.length;++i)0===f[i].indexOf("utf8=")&&(f[i]===h?m="utf-8":f[i]===c&&(m="iso-8859-1"),_=i,i=f.length);for(i=0;i<f.length;++i)if(i!==_){var g,y,v=f[i],b=v.indexOf("]="),x=-1===b?v.indexOf("="):b+1;-1===x?(g=e.decoder(v,o.decoder,m,"key"),y=e.strictNullHandling?null:""):(g=e.decoder(v.slice(0,x),o.decoder,m,"key"),y=r.maybeMap(l(v.slice(x+1),e),(function(t){return e.decoder(t,o.decoder,m,"value")}))),y&&e.interpretNumericEntities&&"iso-8859-1"===m&&(y=a(y)),v.indexOf("[]=")>-1&&(y=s(y)?[y]:y),n.call(u,g)?u[g]=r.combine(u[g],y):u[g]=y}return u},d=function(t,e,i,r){for(var n=r?e:l(e,i),s=t.length-1;s>=0;--s){var o,a=t[s];if("[]"===a&&i.parseArrays)o=[].concat(n);else{o=i.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,h=parseInt(c,10);i.parseArrays||""!==c?!isNaN(h)&&a!==c&&String(h)===c&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(o=[])[h]=n:"__proto__"!==c&&(o[c]=n):o={0:n}}n=o}return n},p=function(t,e,i,r){if(t){var s=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=i.depth>0&&o.exec(s),c=l?s.slice(0,l.index):s,h=[];if(c){if(!i.plainObjects&&n.call(Object.prototype,c)&&!i.allowPrototypes)return;h.push(c)}for(var u=0;i.depth>0&&null!==(l=a.exec(s))&&u<i.depth;){if(u+=1,!i.plainObjects&&n.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(l[1])}return l&&h.push("["+s.slice(l.index)+"]"),d(h,e,i,r)}},f=function(t){if(!t)return o;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?o.charset:t.charset;return{allowDots:void 0===t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}};e.exports=function(t,e){var i=f(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var n="string"==typeof t?u(t,i):t,s=i.plainObjects?Object.create(null):{},o=Object.keys(n),a=0;a<o.length;++a){var l=o[a],c=p(l,n[l],i,"string"==typeof t);s=r.merge(s,c,i)}return!0===i.allowSparse?s:r.compact(s)}},{"./utils":448}],447:[function(t,e,i){var r=t("side-channel"),n=t("./utils"),s=t("./formats"),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,c=Array.prototype.push,h=function(t,e){c.apply(t,l(e)?e:[e])},u=Date.prototype.toISOString,d=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},f=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},_={},m=function t(e,i,s,o,a,c,u,d,m,g,y,v,b,x,T,C){for(var S=e,w=C,A=0,E=!1;void 0!==(w=w.get(_))&&!E;){var D=w.get(e);if(A+=1,void 0!==D){if(D===A)throw new RangeError("Cyclic object value");E=!0}void 0===w.get(_)&&(A=0)}if("function"==typeof d?S=d(i,S):S instanceof Date?S=y(S):"comma"===s&&l(S)&&(S=n.maybeMap(S,(function(t){return t instanceof Date?y(t):t}))),null===S){if(a)return u&&!x?u(i,p.encoder,T,"key",v):i;S=""}if(f(S)||n.isBuffer(S))return u?[b(x?i:u(i,p.encoder,T,"key",v))+"="+b(u(S,p.encoder,T,"value",v))]:[b(i)+"="+b(String(S))];var L,I=[];if(void 0===S)return I;if("comma"===s&&l(S))x&&u&&(S=n.maybeMap(S,u)),L=[{value:S.length>0?S.join(",")||null:void 0}];else if(l(d))L=d;else{var P=Object.keys(S);L=m?P.sort(m):P}for(var M=o&&l(S)&&1===S.length?i+"[]":i,R=0;R<L.length;++R){var O=L[R],B="object"==typeof O&&void 0!==O.value?O.value:S[O];if(!c||null!==B){var N=l(S)?"function"==typeof s?s(M,O):M:M+(g?"."+O:"["+O+"]");C.set(e,A);var k=r();k.set(_,C),h(I,t(B,N,s,o,a,c,"comma"===s&&x&&l(S)?null:u,d,m,g,y,v,b,x,T,k))}}return I},g=function(t){if(!t)return p;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||p.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=s.default;if(void 0!==t.format){if(!o.call(s.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var r=s.formatters[i],n=p.filter;return("function"==typeof t.filter||l(t.filter))&&(n=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===t.allowDots?p.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:p.charsetSentinel,delimiter:void 0===t.delimiter?p.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:p.encode,encoder:"function"==typeof t.encoder?t.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:p.encodeValuesOnly,filter:n,format:i,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:p.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:p.strictNullHandling}};e.exports=function(t,e){var i,n=t,s=g(e);"function"==typeof s.filter?n=(0,s.filter)("",n):l(s.filter)&&(i=s.filter);var o,c=[];if("object"!=typeof n||null===n)return"";o=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var u=a[o];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var d="comma"===u&&e&&e.commaRoundTrip;i||(i=Object.keys(n)),s.sort&&i.sort(s.sort);for(var p=r(),f=0;f<i.length;++f){var _=i[f];s.skipNulls&&null===n[_]||h(c,m(n[_],_,u,d,s.strictNullHandling,s.skipNulls,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,p))}var y=c.join(s.delimiter),v=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),y.length>0?v+y:""}},{"./formats":444,"./utils":448,"side-channel":467}],448:[function(t,i,r){var n=t("./formats"),s=Object.prototype.hasOwnProperty,o=Array.isArray,a=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),l=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(o(i)){for(var r=[],n=0;n<i.length;++n)void 0!==i[n]&&r.push(i[n]);e.obj[e.prop]=r}}},c=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(i[r]=t[r]);return i},h=function t(e,i,r){if(!i)return e;if("object"!=typeof i){if(o(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(r&&(r.plainObjects||r.allowPrototypes)||!s.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var n=e;return o(e)&&!o(i)&&(n=c(e,r)),o(e)&&o(i)?(i.forEach((function(i,n){if(s.call(e,n)){var o=e[n];o&&"object"==typeof o&&i&&"object"==typeof i?e[n]=t(o,i,r):e.push(i)}else e[n]=i})),e):Object.keys(i).reduce((function(e,n){var o=i[n];return s.call(e,n)?e[n]=t(e[n],o,r):e[n]=o,e}),n)},u=function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},d=function(t,i,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},p=function(t,e,i,r,s){if(0===t.length)return t;var o=t;if("symbol"==typeof t?o=Symbol.prototype.toString.call(t):"string"!=typeof t&&(o=String(t)),"iso-8859-1"===i)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",c=0;c<o.length;++c){var h=o.charCodeAt(c);45===h||46===h||95===h||126===h||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===n.RFC1738&&(40===h||41===h)?l+=o.charAt(c):h<128?l+=a[h]:h<2048?l+=a[192|h>>6]+a[128|63&h]:h<55296||h>=57344?l+=a[224|h>>12]+a[128|h>>6&63]+a[128|63&h]:(c+=1,h=65536+((1023&h)<<10|1023&o.charCodeAt(c)),l+=a[240|h>>18]+a[128|h>>12&63]+a[128|h>>6&63]+a[128|63&h])}return l},f=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],r=0;r<e.length;++r)for(var n=e[r],s=n.obj[n.prop],o=Object.keys(s),a=0;a<o.length;++a){var c=o[a],h=s[c];"object"==typeof h&&null!==h&&-1===i.indexOf(h)&&(e.push({obj:s,prop:c}),i.push(h))}return l(e),t},_=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},m=function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},g=function(t,e){return[].concat(t,e)},y=function(t,e){if(o(t)){for(var i=[],r=0;r<t.length;r+=1)i.push(e(t[r]));return i}return e(t)};i.exports={arrayToObject:c,assign:u,combine:g,compact:f,decode:d,encode:p,isBuffer:m,isRegExp:_,maybeMap:y,merge:h}},{"./formats":444}],449:[function(t,e,i){function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,i,s){e=e||"&",i=i||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var l=1e3;s&&"number"==typeof s.maxKeys&&(l=s.maxKeys);var c=t.length;l>0&&c>l&&(c=l);for(var h=0;h<c;++h){var u,d,p,f,_=t[h].replace(a,"%20"),m=_.indexOf(i);m>=0?(u=_.substr(0,m),d=_.substr(m+1)):(u=_,d=""),p=decodeURIComponent(u),f=decodeURIComponent(d),r(o,p)?n(o[p])?o[p].push(f):o[p]=[o[p],f]:o[p]=f}return o};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],450:[function(t,e,i){var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,i,a){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?s(o(t),(function(o){var a=encodeURIComponent(r(o))+i;return n(t[o])?s(t[o],(function(t){return a+encodeURIComponent(r(t))})).join(e):a+encodeURIComponent(r(t[o]))})).join(e):a?encodeURIComponent(r(a))+i+encodeURIComponent(r(t)):""};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function s(t,e){if(t.map)return t.map(e);for(var i=[],r=0;r<t.length;r++)i.push(e(t[r],r));return i}var o=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],451:[function(t,e,i){i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":449,"./encode":450}],452:[function(t,e,i){var r=t("process-nextick-args"),n=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};e.exports=u;var s=Object.create(t("core-util-is"));s.inherits=t("inherits");var o=t("./_stream_readable"),a=t("./_stream_writable");s.inherits(u,o);for(var l=n(a.prototype),c=0;c<l.length;c++){var h=l[c];u.prototype[h]||(u.prototype[h]=a.prototype[h])}function u(t){if(!(this instanceof u))return new u(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),r.nextTick(e,t)}},{"./_stream_readable":454,"./_stream_writable":456,"core-util-is":382,inherits:407,"process-nextick-args":441}],453:[function(t,e,i){e.exports=s;var r=t("./_stream_transform"),n=Object.create(t("core-util-is"));function s(t){if(!(this instanceof s))return new s(t);r.call(this,t)}n.inherits=t("inherits"),n.inherits(s,r),s.prototype._transform=function(t,e,i){i(null,t)}},{"./_stream_transform":455,"core-util-is":382,inherits:407}],454:[function(t,e,r){(function(i,r){(function(){var n=t("process-nextick-args");e.exports=T;var s,o=t("isarray");T.ReadableState=x,t("events").EventEmitter;var a=function(t,e){return t.listeners(e).length},l=t("./internal/streams/stream"),c=t("safe-buffer").Buffer,h=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};function u(t){return c.from(t)}function d(t){return c.isBuffer(t)||t instanceof h}var p=Object.create(t("core-util-is"));p.inherits=t("inherits");var f=t("util"),_=void 0;_=f&&f.debuglog?f.debuglog("stream"):function(){};var m,g=t("./internal/streams/BufferList"),y=t("./internal/streams/destroy");p.inherits(T,l);var v=["error","close","destroy","pause","resume"];function b(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}function x(e,i){e=e||{};var r=i instanceof(s=s||t("./_stream_duplex"));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(m||(m=t("string_decoder/").StringDecoder),this.decoder=new m(e.encoding),this.encoding=e.encoding)}function T(e){if(s=s||t("./_stream_duplex"),!(this instanceof T))return new T(e);this._readableState=new x(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function C(t,e,i,r,n){var s,o=t._readableState;return null===e?(o.reading=!1,I(t,o)):(n||(s=w(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=u(e)),r?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):S(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!i?(e=o.decoder.write(e),o.objectMode||0!==e.length?S(t,o,e,!1):R(t,o)):S(t,o,e,!1))):r||(o.reading=!1)),A(o)}function S(t,e,i,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,r?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&P(t)),R(t,e)}function w(t,e){var i;return d(e)||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}function A(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}Object.defineProperty(T.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),T.prototype.destroy=y.destroy,T.prototype._undestroy=y.undestroy,T.prototype._destroy=function(t,e){this.push(null),e(t)},T.prototype.push=function(t,e){var i,r=this._readableState;return r.objectMode?i=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=c.from(t,e),e=""),i=!0),C(this,t,e,!1,i)},T.prototype.unshift=function(t){return C(this,t,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){return m||(m=t("string_decoder/").StringDecoder),this._readableState.decoder=new m(e),this._readableState.encoding=e,this};var E=8388608;function D(t){return t>=E?t=E:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function L(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=D(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function I(t,e){if(!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,P(t)}}function P(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(_("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?n.nextTick(M,t):M(t))}function M(t){_("emit readable"),t.emit("readable"),V(t)}function R(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(O,t,e))}function O(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(_("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function B(t){return function(){var e=t._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,V(t))}}function N(t){_("readable nexttick read 0"),t.read(0)}function k(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n.nextTick(F,t,e))}function F(t,e){e.reading||(_("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),V(t),e.flowing&&!e.reading&&t.read(0)}function V(t){var e=t._readableState;for(_("flow",e.flowing);e.flowing&&null!==t.read(););}function j(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=G(t,e.buffer,e.decoder),i);var i}function G(t,e,i){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():i?U(t,e):Y(t,e),r}function U(t,e){var i=e.head,r=1,n=i.data;for(t-=n.length;i=i.next;){var s=i.data,o=t>s.length?s.length:t;if(o===s.length?n+=s:n+=s.slice(0,t),0==(t-=o)){o===s.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=s.slice(o));break}++r}return e.length-=r,n}function Y(t,e){var i=c.allocUnsafe(t),r=e.head,n=1;for(r.data.copy(i),t-=r.data.length;r=r.next;){var s=r.data,o=t>s.length?s.length:t;if(s.copy(i,i.length-t,0,o),0==(t-=o)){o===s.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=s.slice(o));break}++n}return e.length-=n,i}function H(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,n.nextTick(X,e,t))}function X(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function z(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}T.prototype.read=function(t){_("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return _("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?H(this):P(this),null;if(0===(t=L(t,e))&&e.ended)return 0===e.length&&H(this),null;var r,n=e.needReadable;return _("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&_("length less than watermark",n=!0),e.ended||e.reading?_("reading or ended",n=!1):n&&(_("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=L(i,e))),null===(r=t>0?j(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&H(this)),null!==r&&this.emit("data",r),r},T.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},T.prototype.pipe=function(t,e){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,_("pipe count=%d opts=%j",s.pipesCount,e);var o=e&&!1===e.end||t===i.stdout||t===i.stderr?v:c;function l(t,e){_("onunpipe"),t===r&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,d())}function c(){_("onend"),t.end()}s.endEmitted?n.nextTick(o):r.once("end",o),t.on("unpipe",l);var h=B(r);t.on("drain",h);var u=!1;function d(){_("cleanup"),t.removeListener("close",g),t.removeListener("finish",y),t.removeListener("drain",h),t.removeListener("error",m),t.removeListener("unpipe",l),r.removeListener("end",c),r.removeListener("end",v),r.removeListener("data",f),u=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||h()}var p=!1;function f(e){_("ondata"),p=!1,!1!==t.write(e)||p||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==z(s.pipes,t))&&!u&&(_("false write response, pause",s.awaitDrain),s.awaitDrain++,p=!0),r.pause())}function m(e){_("onerror",e),v(),t.removeListener("error",m),0===a(t,"error")&&t.emit("error",e)}function g(){t.removeListener("finish",y),v()}function y(){_("onfinish"),t.removeListener("close",g),v()}function v(){_("unpipe"),r.unpipe(t)}return r.on("data",f),b(t,"error",m),t.once("close",g),t.once("finish",y),t.emit("pipe",r),s.flowing||(_("pipe resume"),r.resume()),t},T.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)r[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=z(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i)),this},T.prototype.on=function(t,e){var i=l.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&P(this):n.nextTick(N,this))}return i},T.prototype.addListener=T.prototype.on,T.prototype.resume=function(){var t=this._readableState;return t.flowing||(_("resume"),t.flowing=!0,k(this,t)),this},T.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},T.prototype.wrap=function(t){var e=this,i=this._readableState,r=!1;for(var n in t.on("end",(function(){if(_("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(n){_("wrapped data"),i.decoder&&(n=i.decoder.write(n)),i.objectMode&&null==n||(i.objectMode||n&&n.length)&&(e.push(n)||(r=!0,t.pause()))})),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var s=0;s<v.length;s++)t.on(v[s],this.emit.bind(this,v[s]));return this._read=function(e){_("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),T._fromList=j}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":452,"./internal/streams/BufferList":457,"./internal/streams/destroy":458,"./internal/streams/stream":459,_process:538,"core-util-is":382,events:386,inherits:407,isarray:460,"process-nextick-args":441,"safe-buffer":461,"string_decoder/":462,util:102}],455:[function(t,e,i){e.exports=o;var r=t("./_stream_duplex"),n=Object.create(t("core-util-is"));function s(t,e){var i=this._transformState;i.transforming=!1;var r=i.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),r(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function o(t){if(!(this instanceof o))return new o(t);r.call(this,t),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,i){l(t,e,i)})):l(this,null,null)}function l(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}n.inherits=t("inherits"),n.inherits(o,r),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var i=this;r.prototype._destroy.call(this,t,(function(t){e(t),i.emit("close")}))}},{"./_stream_duplex":452,"core-util-is":382,inherits:407}],456:[function(t,e,r){(function(i,r,n){(function(){var s=t("process-nextick-args");function o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){k(e,t)}}e.exports=b;var a,l=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?n:s.nextTick;b.WritableState=v;var c=Object.create(t("core-util-is"));c.inherits=t("inherits");var h={deprecate:t("util-deprecate")},u=t("./internal/streams/stream"),d=t("safe-buffer").Buffer,p=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};function f(t){return d.from(t)}function _(t){return d.isBuffer(t)||t instanceof p}var m,g=t("./internal/streams/destroy");function y(){}function v(e,i){a=a||t("./_stream_duplex"),e=e||{};var r=i instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,s=e.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(s||0===s)?s:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var c=!1===e.decodeStrings;this.decodeStrings=!c,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){D(i,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function b(e){if(a=a||t("./_stream_duplex"),!(m.call(b,this)||this instanceof a))return new b(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function x(t,e){var i=new Error("write after end");t.emit("error",i),s.nextTick(e,i)}function T(t,e,i,r){var n=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),s.nextTick(r,o),n=!1),n}function C(t,e,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=d.from(e,i)),e}function S(t,e,i,r,n,s){if(!i){var o=C(e,r,n);r!==o&&(i=!0,n="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var l=e.length<e.highWaterMark;if(l||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else w(t,e,!1,a,r,n,s);return l}function w(t,e,i,r,n,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,i?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function A(t,e,i,r,n){--e.pendingcb,i?(s.nextTick(n,r),s.nextTick(B,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(n(r),t._writableState.errorEmitted=!0,t.emit("error",r),B(t,e))}function E(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function D(t,e){var i=t._writableState,r=i.sync,n=i.writecb;if(E(i),e)A(t,i,r,e,n);else{var s=M(i);s||i.corked||i.bufferProcessing||!i.bufferedRequest||P(t,i),r?l(L,t,i,s,n):L(t,i,s,n)}}function L(t,e,i,r){i||I(t,e),e.pendingcb--,r(),B(t,e)}function I(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function P(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),s=e.corkedRequestsFree;s.entry=i;for(var a=0,l=!0;i;)n[a]=i,i.isBuf||(l=!1),i=i.next,a+=1;n.allBuffers=l,w(t,e,!0,e.length,n,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new o(e),e.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,h=i.encoding,u=i.callback;if(w(t,e,!1,e.objectMode?1:c.length,c,h,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function M(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function R(t,e){t._final((function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),B(t,e)}))}function O(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,s.nextTick(R,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function B(t,e){var i=M(e);return i&&(O(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}function N(t,e,i){e.ending=!0,B(t,e),i&&(e.finished?s.nextTick(i):t.once("finish",i)),e.ended=!0,t.writable=!1}function k(t,e,i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree.next=t}c.inherits(b,u),v.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(v.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(m=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!m.call(this,t)||this===b&&t&&t._writableState instanceof v}})):m=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,i){var r=this._writableState,n=!1,s=!r.objectMode&&_(t);return s&&!d.isBuffer(t)&&(t=f(t)),"function"==typeof e&&(i=e,e=null),s?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof i&&(i=y),r.ended?x(this,i):(s||T(this,r,t,i))&&(r.pendingcb++,n=S(this,r,s,t,e,i)),n},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||P(this,t))},b.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,i){var r=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||N(this,r,i)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("timers").setImmediate)},{"./_stream_duplex":452,"./internal/streams/destroy":458,"./internal/streams/stream":459,_process:538,"core-util-is":382,inherits:407,"process-nextick-args":441,"safe-buffer":461,timers:484,"util-deprecate":486}],457:[function(t,e,i){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=t("safe-buffer").Buffer,s=t("util");function o(t,e,i){t.copy(e,i)}e.exports=function(){function t(){r(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);for(var e=n.allocUnsafe(t>>>0),i=this.head,r=0;i;)o(i.data,e,r),r+=i.data.length,i=i.next;return e},t}(),s&&s.inspect&&s.inspect.custom&&(e.exports.prototype[s.inspect.custom]=function(){var t=s.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":461,util:102}],458:[function(t,e,i){var r=t("process-nextick-args");function n(t,e){var i=this,n=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return n||s?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(o,this,t)):r.nextTick(o,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?i._writableState?i._writableState.errorEmitted||(i._writableState.errorEmitted=!0,r.nextTick(o,i,t)):r.nextTick(o,i,t):e&&e(t)})),this)}function s(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function o(t,e){t.emit("error",e)}e.exports={destroy:n,undestroy:s}},{"process-nextick-args":441}],459:[function(t,e,i){e.exports=t("events").EventEmitter},{events:386}],460:[function(t,e,i){var r={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},{}],461:[function(t,e,i){var r=t("buffer"),n=r.Buffer;function s(t,e){for(var i in t)e[i]=t[i]}function o(t,e,i){return n(t,e,i)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(s(r,i),i.Buffer=o),s(n,o),o.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,i)},o.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=n(t);return void 0!==e?"string"==typeof i?r.fill(e,i):r.fill(e):r.fill(0),r},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},{buffer:103}],462:[function(t,e,i){var r=t("safe-buffer").Buffer,n=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function o(t){var e=s(t);if("string"!=typeof e&&(r.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}function a(t){var e;switch(this.encoding=o(t),this.encoding){case"utf16le":this.text=f,this.end=_,e=4;break;case"utf8":this.fillLast=u,e=4;break;case"base64":this.text=m,this.end=g,e=3;break;default:return this.write=y,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function l(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function c(t,e,i){var r=e.length-1;if(r<i)return 0;var n=l(e[r]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--r<i||-2===n?0:(n=l(e[r]))>=0?(n>0&&(t.lastNeed=n-2),n):--r<i||-2===n?0:(n=l(e[r]))>=0?(n>0&&(2===n?n=0:t.lastNeed=n-3),n):0}function h(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}function u(t){var e=this.lastTotal-this.lastNeed,i=h(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function d(t,e){var i=c(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var r=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)}function p(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e}function f(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function _(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function m(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function g(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function y(t){return t.toString(this.encoding)}function v(t){return t&&t.length?this.write(t):""}i.StringDecoder=a,a.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},a.prototype.end=p,a.prototype.text=d,a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":461}],463:[function(t,e,i){(i=e.exports=t("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=t("./lib/_stream_writable.js"),i.Duplex=t("./lib/_stream_duplex.js"),i.Transform=t("./lib/_stream_transform.js"),i.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":452,"./lib/_stream_passthrough.js":453,"./lib/_stream_readable.js":454,"./lib/_stream_transform.js":455,"./lib/_stream_writable.js":456}],464:[function(t,e,i){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=t("buffer"),n=r.Buffer;function s(t,e){for(var i in t)e[i]=t[i]}function o(t,e,i){return n(t,e,i)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(s(r,i),i.Buffer=o),o.prototype=Object.create(n.prototype),s(n,o),o.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,i)},o.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=n(t);return void 0!==e?"string"==typeof i?r.fill(e,i):r.fill(e):r.fill(0),r},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},{buffer:103}],465:[function(t,e,i){(function(e){(function(){!function(i){i.parser=function(t,e){return new s(t,e)},i.SAXParser=s,i.SAXStream=u,i.createStream=h,i.MAX_BUFFER_LENGTH=65536;var r,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function s(t,e){if(!(this instanceof s))return new s(t,e);var r=this;a(r),r.q=r.c="",r.bufferCheckPosition=i.MAX_BUFFER_LENGTH,r.opt=e||{},r.opt.lowercase=r.opt.lowercase||r.opt.lowercasetags,r.looseCase=r.opt.lowercase?"toLowerCase":"toUpperCase",r.tags=[],r.closed=r.closedRoot=r.sawRoot=!1,r.tag=r.error=null,r.strict=!!t,r.noscript=!(!t&&!r.opt.noscript),r.state=L.BEGIN,r.strictEntities=r.opt.strictEntities,r.ENTITIES=r.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),r.attribList=[],r.opt.xmlns&&(r.ns=Object.create(m)),r.trackPosition=!1!==r.opt.position,r.trackPosition&&(r.position=r.line=r.column=0),P(r,"onready")}function o(t){for(var e=Math.max(i.MAX_BUFFER_LENGTH,10),r=0,s=0,o=n.length;s<o;s++){var a=t[n[s]].length;if(a>e)switch(n[s]){case"textNode":R(t);break;case"cdata":M(t,"oncdata",t.cdata),t.cdata="";break;case"script":M(t,"onscript",t.script),t.script="";break;default:B(t,"Max buffer length exceeded: "+n[s])}r=Math.max(r,a)}var l=i.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=l+t.position}function a(t){for(var e=0,i=n.length;e<i;e++)t[n[e]]=""}function l(t){R(t),""!==t.cdata&&(M(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(M(t,"onscript",t.script),t.script="")}i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}return e.prototype=t,new e}),Object.keys||(Object.keys=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}),s.prototype={end:function(){N(this)},write:z,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){l(this)}};try{r=t("stream").Stream}catch(W){r=function(){}}r||(r=function(){});var c=i.EVENTS.filter((function(t){return"error"!==t&&"end"!==t}));function h(t,e){return new u(t,e)}function u(t,e){if(!(this instanceof u))return new u(t,e);r.apply(this),this._parser=new s(t,e),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(t){i.emit("error",t),i._parser.error=null},this._decoder=null,c.forEach((function(t){Object.defineProperty(i,"on"+t,{get:function(){return i._parser["on"+t]},set:function(e){if(!e)return i.removeAllListeners(t),i._parser["on"+t]=e,e;i.on(t,e)},enumerable:!0,configurable:!1})}))}u.prototype=Object.create(r.prototype,{constructor:{value:u}}),u.prototype.write=function(i){if("function"==typeof e&&"function"==typeof e.isBuffer&&e.isBuffer(i)){if(!this._decoder){var r=t("string_decoder").StringDecoder;this._decoder=new r("utf8")}i=this._decoder.write(i)}return this._parser.write(i.toString()),this.emit("data",i),!0},u.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},u.prototype.on=function(t,e){var i=this;return i._parser["on"+t]||-1===c.indexOf(t)||(i._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),i.emit.apply(i,e)}),r.prototype.on.call(i,t,e)};var d="[CDATA[",p="DOCTYPE",f="http://www.w3.org/XML/1998/namespace",_="http://www.w3.org/2000/xmlns/",m={xml:f,xmlns:_},g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function x(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}function T(t){return'"'===t||"'"===t}function C(t){return">"===t||x(t)}function S(t,e){return t.test(e)}function w(t,e){return!S(t,e)}var A,E,D,L=0;for(var I in i.STATE={BEGIN:L++,BEGIN_WHITESPACE:L++,TEXT:L++,TEXT_ENTITY:L++,OPEN_WAKA:L++,SGML_DECL:L++,SGML_DECL_QUOTED:L++,DOCTYPE:L++,DOCTYPE_QUOTED:L++,DOCTYPE_DTD:L++,DOCTYPE_DTD_QUOTED:L++,COMMENT_STARTING:L++,COMMENT:L++,COMMENT_ENDING:L++,COMMENT_ENDED:L++,CDATA:L++,CDATA_ENDING:L++,CDATA_ENDING_2:L++,PROC_INST:L++,PROC_INST_BODY:L++,PROC_INST_ENDING:L++,OPEN_TAG:L++,OPEN_TAG_SLASH:L++,ATTRIB:L++,ATTRIB_NAME:L++,ATTRIB_NAME_SAW_WHITE:L++,ATTRIB_VALUE:L++,ATTRIB_VALUE_QUOTED:L++,ATTRIB_VALUE_CLOSED:L++,ATTRIB_VALUE_UNQUOTED:L++,ATTRIB_VALUE_ENTITY_Q:L++,ATTRIB_VALUE_ENTITY_U:L++,CLOSE_TAG:L++,CLOSE_TAG_SAW_WHITE:L++,SCRIPT:L++,SCRIPT_ENDING:L++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach((function(t){var e=i.ENTITIES[t],r="number"==typeof e?String.fromCharCode(e):e;i.ENTITIES[t]=r})),i.STATE)i.STATE[i.STATE[I]]=I;function P(t,e,i){t[e]&&t[e](i)}function M(t,e,i){t.textNode&&R(t),P(t,e,i)}function R(t){t.textNode=O(t.opt,t.textNode),t.textNode&&P(t,"ontext",t.textNode),t.textNode=""}function O(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function B(t,e){return R(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,P(t,"onerror",e),t}function N(t){return t.sawRoot&&!t.closedRoot&&k(t,"Unclosed root tag"),t.state!==L.BEGIN&&t.state!==L.BEGIN_WHITESPACE&&t.state!==L.TEXT&&B(t,"Unexpected end"),R(t),t.c="",t.closed=!0,P(t,"onend"),s.call(t,t.strict,t.opt),t}function k(t,e){if("object"!=typeof t||!(t instanceof s))throw new Error("bad call to strictFail");t.strict&&B(t,e)}function F(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,i=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(i.ns=e.ns),t.attribList.length=0,M(t,"onopentagstart",i)}function V(t,e){var i=t.indexOf(":")<0?["",t]:t.split(":"),r=i[0],n=i[1];return e&&"xmlns"===t&&(r="xmlns",n=""),{prefix:r,local:n}}function j(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))t.attribName=t.attribValue="";else{if(t.opt.xmlns){var e=V(t.attribName,!0),i=e.prefix,r=e.local;if("xmlns"===i)if("xml"===r&&t.attribValue!==f)k(t,"xml: prefix must be bound to "+f+"\nActual: "+t.attribValue);else if("xmlns"===r&&t.attribValue!==_)k(t,"xmlns: prefix must be bound to "+_+"\nActual: "+t.attribValue);else{var n=t.tag,s=t.tags[t.tags.length-1]||t;n.ns===s.ns&&(n.ns=Object.create(s.ns)),n.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,M(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}}function G(t,e){if(t.opt.xmlns){var i=t.tag,r=V(t.tagName);i.prefix=r.prefix,i.local=r.local,i.uri=i.ns[r.prefix]||"",i.prefix&&!i.uri&&(k(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),i.uri=r.prefix);var n=t.tags[t.tags.length-1]||t;i.ns&&n.ns!==i.ns&&Object.keys(i.ns).forEach((function(e){M(t,"onopennamespace",{prefix:e,uri:i.ns[e]})}));for(var s=0,o=t.attribList.length;s<o;s++){var a=t.attribList[s],l=a[0],c=a[1],h=V(l,!0),u=h.prefix,d=h.local,p=""===u?"":i.ns[u]||"",f={name:l,value:c,prefix:u,local:d,uri:p};u&&"xmlns"!==u&&!p&&(k(t,"Unbound namespace prefix: "+JSON.stringify(u)),f.uri=u),t.tag.attributes[l]=f,M(t,"onattribute",f)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),M(t,"onopentag",t.tag),e||(t.noscript||"script"!==t.tagName.toLowerCase()?t.state=L.TEXT:t.state=L.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function U(t){if(!t.tagName)return k(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=L.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=L.SCRIPT);M(t,"onscript",t.script),t.script=""}var e=t.tags.length,i=t.tagName;t.strict||(i=i[t.looseCase]());for(var r=i;e--&&t.tags[e].name!==r;)k(t,"Unexpected close tag");if(e<0)return k(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=L.TEXT);t.tagName=i;for(var n=t.tags.length;n-- >e;){var s=t.tag=t.tags.pop();t.tagName=t.tag.name,M(t,"onclosetag",t.tagName);var o={};for(var a in s.ns)o[a]=s.ns[a];var l=t.tags[t.tags.length-1]||t;t.opt.xmlns&&s.ns!==l.ns&&Object.keys(s.ns).forEach((function(e){var i=s.ns[e];M(t,"onclosenamespace",{prefix:e,uri:i})}))}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=L.TEXT}function Y(t){var e,i=t.entity,r=i.toLowerCase(),n="";return t.ENTITIES[i]?t.ENTITIES[i]:t.ENTITIES[r]?t.ENTITIES[r]:("#"===(i=r).charAt(0)&&("x"===i.charAt(1)?(i=i.slice(2),n=(e=parseInt(i,16)).toString(16)):(i=i.slice(1),n=(e=parseInt(i,10)).toString(10))),i=i.replace(/^0+/,""),isNaN(e)||n.toLowerCase()!==i?(k(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function H(t,e){"<"===e?(t.state=L.OPEN_WAKA,t.startTagPosition=t.position):x(e)||(k(t,"Non-whitespace before first tag."),t.textNode=e,t.state=L.TEXT)}function X(t,e){var i="";return e<t.length&&(i=t.charAt(e)),i}function z(t){var e=this;if(this.error)throw this.error;if(e.closed)return B(e,"Cannot write after close. Assign an onready handler.");if(null===t)return N(e);"object"==typeof t&&(t=t.toString());for(var i=0,r="";r=X(t,i++),e.c=r,r;)switch(e.trackPosition&&(e.position++,"\n"===r?(e.line++,e.column=0):e.column++),e.state){case L.BEGIN:if(e.state=L.BEGIN_WHITESPACE,"\ufeff"===r)continue;H(e,r);continue;case L.BEGIN_WHITESPACE:H(e,r);continue;case L.TEXT:if(e.sawRoot&&!e.closedRoot){for(var n=i-1;r&&"<"!==r&&"&"!==r;)(r=X(t,i++))&&e.trackPosition&&(e.position++,"\n"===r?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(n,i-1)}"<"!==r||e.sawRoot&&e.closedRoot&&!e.strict?(x(r)||e.sawRoot&&!e.closedRoot||k(e,"Text data outside of root node."),"&"===r?e.state=L.TEXT_ENTITY:e.textNode+=r):(e.state=L.OPEN_WAKA,e.startTagPosition=e.position);continue;case L.SCRIPT:"<"===r?e.state=L.SCRIPT_ENDING:e.script+=r;continue;case L.SCRIPT_ENDING:"/"===r?e.state=L.CLOSE_TAG:(e.script+="<"+r,e.state=L.SCRIPT);continue;case L.OPEN_WAKA:if("!"===r)e.state=L.SGML_DECL,e.sgmlDecl="";else if(x(r));else if(S(g,r))e.state=L.OPEN_TAG,e.tagName=r;else if("/"===r)e.state=L.CLOSE_TAG,e.tagName="";else if("?"===r)e.state=L.PROC_INST,e.procInstName=e.procInstBody="";else{if(k(e,"Unencoded <"),e.startTagPosition+1<e.position){var s=e.position-e.startTagPosition;r=new Array(s).join(" ")+r}e.textNode+="<"+r,e.state=L.TEXT}continue;case L.SGML_DECL:(e.sgmlDecl+r).toUpperCase()===d?(M(e,"onopencdata"),e.state=L.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+r==="--"?(e.state=L.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+r).toUpperCase()===p?(e.state=L.DOCTYPE,(e.doctype||e.sawRoot)&&k(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):">"===r?(M(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=L.TEXT):T(r)?(e.state=L.SGML_DECL_QUOTED,e.sgmlDecl+=r):e.sgmlDecl+=r;continue;case L.SGML_DECL_QUOTED:r===e.q&&(e.state=L.SGML_DECL,e.q=""),e.sgmlDecl+=r;continue;case L.DOCTYPE:">"===r?(e.state=L.TEXT,M(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=r,"["===r?e.state=L.DOCTYPE_DTD:T(r)&&(e.state=L.DOCTYPE_QUOTED,e.q=r));continue;case L.DOCTYPE_QUOTED:e.doctype+=r,r===e.q&&(e.q="",e.state=L.DOCTYPE);continue;case L.DOCTYPE_DTD:e.doctype+=r,"]"===r?e.state=L.DOCTYPE:T(r)&&(e.state=L.DOCTYPE_DTD_QUOTED,e.q=r);continue;case L.DOCTYPE_DTD_QUOTED:e.doctype+=r,r===e.q&&(e.state=L.DOCTYPE_DTD,e.q="");continue;case L.COMMENT:"-"===r?e.state=L.COMMENT_ENDING:e.comment+=r;continue;case L.COMMENT_ENDING:"-"===r?(e.state=L.COMMENT_ENDED,e.comment=O(e.opt,e.comment),e.comment&&M(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+r,e.state=L.COMMENT);continue;case L.COMMENT_ENDED:">"!==r?(k(e,"Malformed comment"),e.comment+="--"+r,e.state=L.COMMENT):e.state=L.TEXT;continue;case L.CDATA:"]"===r?e.state=L.CDATA_ENDING:e.cdata+=r;continue;case L.CDATA_ENDING:"]"===r?e.state=L.CDATA_ENDING_2:(e.cdata+="]"+r,e.state=L.CDATA);continue;case L.CDATA_ENDING_2:">"===r?(e.cdata&&M(e,"oncdata",e.cdata),M(e,"onclosecdata"),e.cdata="",e.state=L.TEXT):"]"===r?e.cdata+="]":(e.cdata+="]]"+r,e.state=L.CDATA);continue;case L.PROC_INST:"?"===r?e.state=L.PROC_INST_ENDING:x(r)?e.state=L.PROC_INST_BODY:e.procInstName+=r;continue;case L.PROC_INST_BODY:if(!e.procInstBody&&x(r))continue;"?"===r?e.state=L.PROC_INST_ENDING:e.procInstBody+=r;continue;case L.PROC_INST_ENDING:">"===r?(M(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=L.TEXT):(e.procInstBody+="?"+r,e.state=L.PROC_INST_BODY);continue;case L.OPEN_TAG:S(y,r)?e.tagName+=r:(F(e),">"===r?G(e):"/"===r?e.state=L.OPEN_TAG_SLASH:(x(r)||k(e,"Invalid character in tag name"),e.state=L.ATTRIB));continue;case L.OPEN_TAG_SLASH:">"===r?(G(e,!0),U(e)):(k(e,"Forward-slash in opening tag not followed by >"),e.state=L.ATTRIB);continue;case L.ATTRIB:if(x(r))continue;">"===r?G(e):"/"===r?e.state=L.OPEN_TAG_SLASH:S(g,r)?(e.attribName=r,e.attribValue="",e.state=L.ATTRIB_NAME):k(e,"Invalid attribute name");continue;case L.ATTRIB_NAME:"="===r?e.state=L.ATTRIB_VALUE:">"===r?(k(e,"Attribute without value"),e.attribValue=e.attribName,j(e),G(e)):x(r)?e.state=L.ATTRIB_NAME_SAW_WHITE:S(y,r)?e.attribName+=r:k(e,"Invalid attribute name");continue;case L.ATTRIB_NAME_SAW_WHITE:if("="===r)e.state=L.ATTRIB_VALUE;else{if(x(r))continue;k(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",M(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",">"===r?G(e):S(g,r)?(e.attribName=r,e.state=L.ATTRIB_NAME):(k(e,"Invalid attribute name"),e.state=L.ATTRIB)}continue;case L.ATTRIB_VALUE:if(x(r))continue;T(r)?(e.q=r,e.state=L.ATTRIB_VALUE_QUOTED):(k(e,"Unquoted attribute value"),e.state=L.ATTRIB_VALUE_UNQUOTED,e.attribValue=r);continue;case L.ATTRIB_VALUE_QUOTED:if(r!==e.q){"&"===r?e.state=L.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=r;continue}j(e),e.q="",e.state=L.ATTRIB_VALUE_CLOSED;continue;case L.ATTRIB_VALUE_CLOSED:x(r)?e.state=L.ATTRIB:">"===r?G(e):"/"===r?e.state=L.OPEN_TAG_SLASH:S(g,r)?(k(e,"No whitespace between attributes"),e.attribName=r,e.attribValue="",e.state=L.ATTRIB_NAME):k(e,"Invalid attribute name");continue;case L.ATTRIB_VALUE_UNQUOTED:if(!C(r)){"&"===r?e.state=L.ATTRIB_VALUE_ENTITY_U:e.attribValue+=r;continue}j(e),">"===r?G(e):e.state=L.ATTRIB;continue;case L.CLOSE_TAG:if(e.tagName)">"===r?U(e):S(y,r)?e.tagName+=r:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=L.SCRIPT):(x(r)||k(e,"Invalid tagname in closing tag"),e.state=L.CLOSE_TAG_SAW_WHITE);else{if(x(r))continue;w(g,r)?e.script?(e.script+="</"+r,e.state=L.SCRIPT):k(e,"Invalid tagname in closing tag."):e.tagName=r}continue;case L.CLOSE_TAG_SAW_WHITE:if(x(r))continue;">"===r?U(e):k(e,"Invalid characters in closing tag");continue;case L.TEXT_ENTITY:case L.ATTRIB_VALUE_ENTITY_Q:case L.ATTRIB_VALUE_ENTITY_U:var a,l;switch(e.state){case L.TEXT_ENTITY:a=L.TEXT,l="textNode";break;case L.ATTRIB_VALUE_ENTITY_Q:a=L.ATTRIB_VALUE_QUOTED,l="attribValue";break;case L.ATTRIB_VALUE_ENTITY_U:a=L.ATTRIB_VALUE_UNQUOTED,l="attribValue"}if(";"===r)if(e.opt.unparsedEntities){var c=Y(e);e.entity="",e.state=a,e.write(c)}else e[l]+=Y(e),e.entity="",e.state=a;else S(e.entity.length?b:v,r)?e.entity+=r:(k(e,"Invalid character in entity name"),e[l]+="&"+e.entity+r,e.entity="",e.state=a);continue;default:throw new Error(e,"Unknown state: "+e.state)}return e.position>=e.bufferCheckPosition&&o(e),e}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */L=i.STATE,String.fromCodePoint||(A=String.fromCharCode,E=Math.floor,D=function(){var t,e,i=16384,r=[],n=-1,s=arguments.length;if(!s)return"";for(var o="";++n<s;){var a=Number(arguments[n]);if(!isFinite(a)||a<0||a>1114111||E(a)!==a)throw RangeError("Invalid code point: "+a);a<=65535?r.push(a):(t=55296+((a-=65536)>>10),e=a%1024+56320,r.push(t,e)),(n+1===s||r.length>i)&&(o+=A.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:D,configurable:!0,writable:!0}):String.fromCodePoint=D)}(void 0===i?this.sax={}:i)}).call(this)}).call(this,t("buffer").Buffer)},{buffer:103,stream:468,string_decoder:483}],466:[function(t,e,i){var r=t("get-intrinsic"),n=t("define-data-property"),s=t("has-property-descriptors")(),o=t("gopd"),a=r("%TypeError%"),l=r("%Math.floor%");e.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||l(e)!==e)throw new a("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],r=!0,c=!0;if("length"in t&&o){var h=o(t,"length");h&&!h.configurable&&(r=!1),h&&!h.writable&&(c=!1)}return(r||c||!i)&&(s?n(t,"length",e,!0,!0):n(t,"length",e)),t}},{"define-data-property":384,"get-intrinsic":390,gopd:391,"has-property-descriptors":392}],467:[function(t,e,i){var r=t("get-intrinsic"),n=t("call-bind/callBound"),s=t("object-inspect"),o=r("%TypeError%"),a=r("%WeakMap%",!0),l=r("%Map%",!0),c=n("WeakMap.prototype.get",!0),h=n("WeakMap.prototype.set",!0),u=n("WeakMap.prototype.has",!0),d=n("Map.prototype.get",!0),p=n("Map.prototype.set",!0),f=n("Map.prototype.has",!0),_=function(t,e){for(var i,r=t;null!==(i=r.next);r=i)if(i.key===e)return r.next=i.next,i.next=t.next,t.next=i,i},m=function(t,e){var i=_(t,e);return i&&i.value},g=function(t,e,i){var r=_(t,e);r?r.value=i:t.next={key:e,next:t.next,value:i}},y=function(t,e){return!!_(t,e)};e.exports=function(){var t,e,i,r={assert:function(t){if(!r.has(t))throw new o("Side channel does not contain "+s(t))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return c(t,r)}else if(l){if(e)return d(e,r)}else if(i)return m(i,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return u(t,r)}else if(l){if(e)return f(e,r)}else if(i)return y(i,r);return!1},set:function(r,n){a&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new a),h(t,r,n)):l?(e||(e=new l),p(e,r,n)):(i||(i={key:{},next:null}),g(i,r,n))}};return r}},{"call-bind/callBound":105,"get-intrinsic":390,"object-inspect":433}],468:[function(t,e,i){e.exports=n;var r=t("events").EventEmitter;function n(){r.call(this)}t("inherits")(n,r),n.Readable=t("readable-stream/lib/_stream_readable.js"),n.Writable=t("readable-stream/lib/_stream_writable.js"),n.Duplex=t("readable-stream/lib/_stream_duplex.js"),n.Transform=t("readable-stream/lib/_stream_transform.js"),n.PassThrough=t("readable-stream/lib/_stream_passthrough.js"),n.finished=t("readable-stream/lib/internal/streams/end-of-stream.js"),n.pipeline=t("readable-stream/lib/internal/streams/pipeline.js"),n.Stream=n,n.prototype.pipe=function(t,e){var i=this;function n(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",n),t.on("drain",s),t._isStdio||e&&!1===e.end||(i.on("end",a),i.on("close",l));var o=!1;function a(){o||(o=!0,t.end())}function l(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function c(t){if(h(),0===r.listenerCount(this,"error"))throw t}function h(){i.removeListener("data",n),t.removeListener("drain",s),i.removeListener("end",a),i.removeListener("close",l),i.removeListener("error",c),t.removeListener("error",c),i.removeListener("end",h),i.removeListener("close",h),t.removeListener("close",h)}return i.on("error",c),t.on("error",c),i.on("end",h),i.on("close",h),t.on("close",h),t.emit("pipe",i),t}},{events:386,inherits:407,"readable-stream/lib/_stream_duplex.js":470,"readable-stream/lib/_stream_passthrough.js":471,"readable-stream/lib/_stream_readable.js":472,"readable-stream/lib/_stream_transform.js":473,"readable-stream/lib/_stream_writable.js":474,"readable-stream/lib/internal/streams/end-of-stream.js":478,"readable-stream/lib/internal/streams/pipeline.js":480}],469:[function(t,e,i){function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var n={};function s(t,e,i){function s(t,i,r){return"string"==typeof e?e:e(t,i,r)}i||(i=Error);var o=function(t){function e(e,i,r){return t.call(this,s(e,i,r))||this}return r(e,t),e}(i);o.prototype.name=i.name,o.prototype.code=t,n[t]=o}function o(t,e){if(Array.isArray(t)){var i=t.length;return t=t.map((function(t){return String(t)})),i>2?"one of ".concat(e," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:2===i?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(String(t))}function a(t,e,i){return t.substr(0,e.length)===e}function l(t,e,i){return(void 0===i||i>t.length)&&(i=t.length),t.substring(i-e.length,i)===e}function c(t,e,i){return"number"!=typeof i&&(i=0),!(i+e.length>t.length)&&-1!==t.indexOf(e,i)}s("ERR_INVALID_OPT_VALUE",(function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(t,e,i){var r,n;if("string"==typeof e&&a(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be",l(t," argument"))n="The ".concat(t," ").concat(r," ").concat(o(e,"type"));else{var s=c(t,".")?"property":"argument";n='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(o(e,"type"))}return n+=". Received type ".concat(typeof i)}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(t){return"The "+t+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(t){return"Cannot call "+t+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(t){return"Unknown encoding: "+t}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=n},{}],470:[function(t,e,i){(function(i){(function(){var r=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};e.exports=c;var n=t("./_stream_readable"),s=t("./_stream_writable");t("inherits")(c,n);for(var o=r(s.prototype),a=0;a<o.length;a++){var l=o[a];c.prototype[l]||(c.prototype[l]=s.prototype[l])}function c(t){if(!(this instanceof c))return new c(t);n.call(this,t),s.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",h)))}function h(){this._writableState.ended||i.nextTick(u,this)}function u(t){t.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}).call(this)}).call(this,t("_process"))},{"./_stream_readable":472,"./_stream_writable":474,_process:538,inherits:407}],471:[function(t,e,i){e.exports=n;var r=t("./_stream_transform");function n(t){if(!(this instanceof n))return new n(t);r.call(this,t)}t("inherits")(n,r),n.prototype._transform=function(t,e,i){i(null,t)}},{"./_stream_transform":473,inherits:407}],472:[function(t,e,r){(function(i,r){(function(){var n;e.exports=D,D.ReadableState=E,t("events").EventEmitter;var s=function(t,e){return t.listeners(e).length},o=t("./internal/streams/stream"),a=t("buffer").Buffer,l=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};function c(t){return a.from(t)}function h(t){return a.isBuffer(t)||t instanceof l}var u,d=t("util");u=d&&d.debuglog?d.debuglog("stream"):function(){};var p,f,_,m=t("./internal/streams/buffer_list"),g=t("./internal/streams/destroy"),y=t("./internal/streams/state").getHighWaterMark,v=t("../errors").codes,b=v.ERR_INVALID_ARG_TYPE,x=v.ERR_STREAM_PUSH_AFTER_EOF,T=v.ERR_METHOD_NOT_IMPLEMENTED,C=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;t("inherits")(D,o);var S=g.errorOrDestroy,w=["error","close","destroy","pause","resume"];function A(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}function E(e,i,r){n=n||t("./_stream_duplex"),e=e||{},"boolean"!=typeof r&&(r=i instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=y(this,e,"readableHighWaterMark",r),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=t("string_decoder/").StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function D(e){if(n=n||t("./_stream_duplex"),!(this instanceof D))return new D(e);var i=this instanceof n;this._readableState=new E(e,this,i),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function L(t,e,i,r,n){u("readableAddChunk",e);var s,o=t._readableState;if(null===e)o.reading=!1,B(t,o);else if(n||(s=P(o,e)),s)S(t,s);else if(o.objectMode||e&&e.length>0)if("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===a.prototype||(e=c(e)),r)o.endEmitted?S(t,new C):I(t,o,e,!0);else if(o.ended)S(t,new x);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!i?(e=o.decoder.write(e),o.objectMode||0!==e.length?I(t,o,e,!1):F(t,o)):I(t,o,e,!1)}else r||(o.reading=!1,F(t,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function I(t,e,i,r){e.flowing&&0===e.length&&!e.sync?(e.awaitDrain=0,t.emit("data",i)):(e.length+=e.objectMode?1:i.length,r?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&N(t)),F(t,e)}function P(t,e){var i;return h(e)||"string"==typeof e||void 0===e||t.objectMode||(i=new b("chunk",["string","Buffer","Uint8Array"],e)),i}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),D.prototype.destroy=g.destroy,D.prototype._undestroy=g.undestroy,D.prototype._destroy=function(t,e){e(t)},D.prototype.push=function(t,e){var i,r=this._readableState;return r.objectMode?i=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=a.from(t,e),e=""),i=!0),L(this,t,e,!1,i)},D.prototype.unshift=function(t){return L(this,t,null,!0,!1)},D.prototype.isPaused=function(){return!1===this._readableState.flowing},D.prototype.setEncoding=function(e){p||(p=t("string_decoder/").StringDecoder);var i=new p(e);this._readableState.decoder=i,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=i.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var M=1073741824;function R(t){return t>=M?t=M:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function O(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=R(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function B(t,e){if(u("onEofChunk"),!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,e.sync?N(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,k(t)))}}function N(t){var e=t._readableState;u("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(u("emitReadable",e.flowing),e.emittedReadable=!0,i.nextTick(k,t))}function k(t){var e=t._readableState;u("emitReadable_",e.destroyed,e.length,e.ended),e.destroyed||!e.length&&!e.ended||(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,X(t)}function F(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(V,t,e))}function V(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){var i=e.length;if(u("maybeReadMore read 0"),t.read(0),i===e.length)break}e.readingMore=!1}function j(t){return function(){var e=t._readableState;u("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,X(t))}}function G(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function U(t){u("readable nexttick read 0"),t.read(0)}function Y(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(H,t,e))}function H(t,e){u("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),X(t),e.flowing&&!e.reading&&t.read(0)}function X(t){var e=t._readableState;for(u("flow",e.flowing);e.flowing&&null!==t.read(););}function z(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):i=e.buffer.consume(t,e.decoder),i);var i}function W(t){var e=t._readableState;u("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,i.nextTick(Z,e,t))}function Z(t,e){if(u("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var i=e._writableState;(!i||i.autoDestroy&&i.finished)&&e.destroy()}}function J(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}D.prototype.read=function(t){u("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&((0!==e.highWaterMark?e.length>=e.highWaterMark:e.length>0)||e.ended))return u("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?W(this):N(this),null;if(0===(t=O(t,e))&&e.ended)return 0===e.length&&W(this),null;var r,n=e.needReadable;return u("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&u("length less than watermark",n=!0),e.ended||e.reading?u("reading or ended",n=!1):n&&(u("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=O(i,e))),null===(r=t>0?z(t,e):null)?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&W(this)),null!==r&&this.emit("data",r),r},D.prototype._read=function(t){S(this,new T("_read()"))},D.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t)}n.pipesCount+=1,u("pipe count=%d opts=%j",n.pipesCount,e);var o=e&&!1===e.end||t===i.stdout||t===i.stderr?g:l;function a(t,e){u("onunpipe"),t===r&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,d())}function l(){u("onend"),t.end()}n.endEmitted?i.nextTick(o):r.once("end",o),t.on("unpipe",a);var c=j(r);t.on("drain",c);var h=!1;function d(){u("cleanup"),t.removeListener("close",_),t.removeListener("finish",m),t.removeListener("drain",c),t.removeListener("error",f),t.removeListener("unpipe",a),r.removeListener("end",l),r.removeListener("end",g),r.removeListener("data",p),h=!0,!n.awaitDrain||t._writableState&&!t._writableState.needDrain||c()}function p(e){u("ondata");var i=t.write(e);u("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===t||n.pipesCount>1&&-1!==J(n.pipes,t))&&!h&&(u("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function f(e){u("onerror",e),g(),t.removeListener("error",f),0===s(t,"error")&&S(t,e)}function _(){t.removeListener("finish",m),g()}function m(){u("onfinish"),t.removeListener("close",_),g()}function g(){u("unpipe"),r.unpipe(t)}return r.on("data",p),A(t,"error",f),t.once("close",_),t.once("finish",m),t.emit("pipe",r),n.flowing||(u("pipe resume"),r.resume()),t},D.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)r[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=J(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i)),this},D.prototype.on=function(t,e){var r=o.prototype.on.call(this,t,e),n=this._readableState;return"data"===t?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===t&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,u("on readable",n.length,n.reading),n.length?N(this):n.reading||i.nextTick(U,this))),r},D.prototype.addListener=D.prototype.on,D.prototype.removeListener=function(t,e){var r=o.prototype.removeListener.call(this,t,e);return"readable"===t&&i.nextTick(G,this),r},D.prototype.removeAllListeners=function(t){var e=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||i.nextTick(G,this),e},D.prototype.resume=function(){var t=this._readableState;return t.flowing||(u("resume"),t.flowing=!t.readableListening,Y(this,t)),t.paused=!1,this},D.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},D.prototype.wrap=function(t){var e=this,i=this._readableState,r=!1;for(var n in t.on("end",(function(){if(u("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(n){u("wrapped data"),i.decoder&&(n=i.decoder.write(n)),i.objectMode&&null==n||(i.objectMode||n&&n.length)&&(e.push(n)||(r=!0,t.pause()))})),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var s=0;s<w.length;s++)t.on(w[s],this.emit.bind(this,w[s]));return this._read=function(e){u("wrapped _read",e),r&&(r=!1,t.resume())},this},"function"==typeof Symbol&&(D.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=t("./internal/streams/async_iterator")),f(this)}),Object.defineProperty(D.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(D.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(D.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),D._fromList=z,Object.defineProperty(D.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(D.from=function(e,i){return void 0===_&&(_=t("./internal/streams/from")),_(D,e,i)})}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":469,"./_stream_duplex":470,"./internal/streams/async_iterator":475,"./internal/streams/buffer_list":476,"./internal/streams/destroy":477,"./internal/streams/from":479,"./internal/streams/state":481,"./internal/streams/stream":482,_process:538,buffer:103,events:386,inherits:407,"string_decoder/":483,util:102}],473:[function(t,e,i){e.exports=h;var r=t("../errors").codes,n=r.ERR_METHOD_NOT_IMPLEMENTED,s=r.ERR_MULTIPLE_CALLBACK,o=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,l=t("./_stream_duplex");function c(t,e){var i=this._transformState;i.transforming=!1;var r=i.writecb;if(null===r)return this.emit("error",new s);i.writechunk=null,i.writecb=null,null!=e&&this.push(e),r(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function h(t){if(!(this instanceof h))return new h(t);l.call(this,t),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",u)}function u(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(e,i){d(t,e,i)}))}function d(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new a;if(t._transformState.transforming)throw new o;return t.push(null)}t("inherits")(h,l),h.prototype.push=function(t,e){return this._transformState.needTransform=!1,l.prototype.push.call(this,t,e)},h.prototype._transform=function(t,e,i){i(new n("_transform()"))},h.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},h.prototype._read=function(t){var e=this._transformState;null===e.writechunk||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))},h.prototype._destroy=function(t,e){l.prototype._destroy.call(this,t,(function(t){e(t)}))}},{"../errors":469,"./_stream_duplex":470,inherits:407}],474:[function(t,e,r){(function(i,r){(function(){function n(t){var e=this;this.next=null,this.entry=null,this.finish=function(){H(e,t)}}var s;e.exports=E,E.WritableState=A;var o={deprecate:t("util-deprecate")},a=t("./internal/streams/stream"),l=t("buffer").Buffer,c=(void 0!==r?r:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};function h(t){return l.from(t)}function u(t){return l.isBuffer(t)||t instanceof c}var d,p=t("./internal/streams/destroy"),f=t("./internal/streams/state").getHighWaterMark,_=t("../errors").codes,m=_.ERR_INVALID_ARG_TYPE,g=_.ERR_METHOD_NOT_IMPLEMENTED,y=_.ERR_MULTIPLE_CALLBACK,v=_.ERR_STREAM_CANNOT_PIPE,b=_.ERR_STREAM_DESTROYED,x=_.ERR_STREAM_NULL_VALUES,T=_.ERR_STREAM_WRITE_AFTER_END,C=_.ERR_UNKNOWN_ENCODING,S=p.errorOrDestroy;function w(){}function A(e,i,r){s=s||t("./_stream_duplex"),e=e||{},"boolean"!=typeof r&&(r=i instanceof s),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=f(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){B(i,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function E(e){var i=this instanceof(s=s||t("./_stream_duplex"));if(!i&&!d.call(E,this))return new E(e);this._writableState=new A(e,this,i),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),a.call(this)}function D(t,e){var r=new T;S(t,r),i.nextTick(e,r)}function L(t,e,r,n){var s;return null===r?s=new x:"string"==typeof r||e.objectMode||(s=new m("chunk",["string","Buffer"],r)),!s||(S(t,s),i.nextTick(n,s),!1)}function I(t,e,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=l.from(e,i)),e}function P(t,e,i,r,n,s){if(!i){var o=I(e,r,n);r!==o&&(i=!0,n="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var l=e.length<e.highWaterMark;if(l||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else M(t,e,!1,a,r,n,s);return l}function M(t,e,i,r,n,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new b("write")):i?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function R(t,e,r,n,s){--e.pendingcb,r?(i.nextTick(s,n),i.nextTick(U,t,e),t._writableState.errorEmitted=!0,S(t,n)):(s(n),t._writableState.errorEmitted=!0,S(t,n),U(t,e))}function O(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function B(t,e){var r=t._writableState,n=r.sync,s=r.writecb;if("function"!=typeof s)throw new y;if(O(r),e)R(t,r,n,e,s);else{var o=V(r)||t.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||F(t,r),n?i.nextTick(N,t,r,o,s):N(t,r,o,s)}}function N(t,e,i,r){i||k(t,e),e.pendingcb--,r(),U(t,e)}function k(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function F(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,s=new Array(r),o=e.corkedRequestsFree;o.entry=i;for(var a=0,l=!0;i;)s[a]=i,i.isBuf||(l=!1),i=i.next,a+=1;s.allBuffers=l,M(t,e,!0,e.length,s,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new n(e),e.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,h=i.encoding,u=i.callback;if(M(t,e,!1,e.objectMode?1:c.length,c,h,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function V(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function j(t,e){t._final((function(i){e.pendingcb--,i&&S(t,i),e.prefinished=!0,t.emit("prefinish"),U(t,e)}))}function G(t,e){e.prefinished||e.finalCalled||("function"!=typeof t._final||e.destroyed?(e.prefinished=!0,t.emit("prefinish")):(e.pendingcb++,e.finalCalled=!0,i.nextTick(j,t,e)))}function U(t,e){var i=V(e);if(i&&(G(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var r=t._readableState;(!r||r.autoDestroy&&r.endEmitted)&&t.destroy()}return i}function Y(t,e,r){e.ending=!0,U(t,e),r&&(e.finished?i.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function H(t,e,i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree.next=t}t("inherits")(E,a),A.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(A.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(t){return!!d.call(this,t)||this===E&&t&&t._writableState instanceof A}})):d=function(t){return t instanceof this},E.prototype.pipe=function(){S(this,new v)},E.prototype.write=function(t,e,i){var r=this._writableState,n=!1,s=!r.objectMode&&u(t);return s&&!l.isBuffer(t)&&(t=h(t)),"function"==typeof e&&(i=e,e=null),s?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof i&&(i=w),r.ending?D(this,i):(s||L(this,r,t,i))&&(r.pendingcb++,n=P(this,r,s,t,e,i)),n},E.prototype.cork=function(){this._writableState.corked++},E.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||F(this,t))},E.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new C(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),E.prototype._write=function(t,e,i){i(new g("_write()"))},E.prototype._writev=null,E.prototype.end=function(t,e,i){var r=this._writableState;return"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||Y(this,r,i),this},Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),E.prototype.destroy=p.destroy,E.prototype._undestroy=p.undestroy,E.prototype._destroy=function(t,e){e(t)}}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":469,"./_stream_duplex":470,"./internal/streams/destroy":477,"./internal/streams/state":481,"./internal/streams/stream":482,_process:538,buffer:103,inherits:407,"util-deprecate":486}],475:[function(t,e,i){(function(i){(function(){var r;function n(t,e,i){return(e=s(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t){var e=o(t,"string");return"symbol"==typeof e?e:String(e)}function o(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var a=t("./end-of-stream"),l=Symbol("lastResolve"),c=Symbol("lastReject"),h=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),p=Symbol("handlePromise"),f=Symbol("stream");function _(t,e){return{value:t,done:e}}function m(t){var e=t[l];if(null!==e){var i=t[f].read();null!==i&&(t[d]=null,t[l]=null,t[c]=null,e(_(i,!1)))}}function g(t){i.nextTick(m,t)}function y(t,e){return function(i,r){t.then((function(){e[u]?i(_(void 0,!0)):e[p](i,r)}),r)}}var v=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((n(r={get stream(){return this[f]},next:function(){var t=this,e=this[h];if(null!==e)return Promise.reject(e);if(this[u])return Promise.resolve(_(void 0,!0));if(this[f].destroyed)return new Promise((function(e,r){i.nextTick((function(){t[h]?r(t[h]):e(_(void 0,!0))}))}));var r,n=this[d];if(n)r=new Promise(y(n,this));else{var s=this[f].read();if(null!==s)return Promise.resolve(_(s,!1));r=new Promise(this[p])}return this[d]=r,r}},Symbol.asyncIterator,(function(){return this})),n(r,"return",(function(){var t=this;return new Promise((function(e,i){t[f].destroy(null,(function(t){t?i(t):e(_(void 0,!0))}))}))})),r),v),x=function(t){var e,i=Object.create(b,(n(e={},f,{value:t,writable:!0}),n(e,l,{value:null,writable:!0}),n(e,c,{value:null,writable:!0}),n(e,h,{value:null,writable:!0}),n(e,u,{value:t._readableState.endEmitted,writable:!0}),n(e,p,{value:function(t,e){var r=i[f].read();r?(i[d]=null,i[l]=null,i[c]=null,t(_(r,!1))):(i[l]=t,i[c]=e)},writable:!0}),e));return i[d]=null,a(t,(function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var e=i[c];return null!==e&&(i[d]=null,i[l]=null,i[c]=null,e(t)),void(i[h]=t)}var r=i[l];null!==r&&(i[d]=null,i[l]=null,i[c]=null,r(_(void 0,!0))),i[u]=!0})),t.on("readable",g.bind(null,i)),i};e.exports=x}).call(this)}).call(this,t("_process"))},{"./end-of-stream":478,_process:538}],476:[function(t,e,i){function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function n(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e,i){return(e=c(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function l(t,e,i){return e&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t){var e=h(t,"string");return"symbol"==typeof e?e:String(e)}function h(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var u=t("buffer").Buffer,d=t("util").inspect,p=d&&d.custom||"inspect";function f(t,e,i){u.prototype.copy.call(t,e,i)}e.exports=function(){function t(){o(this,t),this.head=null,this.tail=null,this.length=0}return l(t,[{key:"push",value:function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i}},{key:"concat",value:function(t){if(0===this.length)return u.alloc(0);for(var e=u.allocUnsafe(t>>>0),i=this.head,r=0;i;)f(i.data,e,r),r+=i.data.length,i=i.next;return e}},{key:"consume",value:function(t,e){var i;return t<this.head.data.length?(i=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):i=t===this.head.data.length?this.shift():e?this._getString(t):this._getBuffer(t),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var e=this.head,i=1,r=e.data;for(t-=r.length;e=e.next;){var n=e.data,s=t>n.length?n.length:t;if(s===n.length?r+=n:r+=n.slice(0,t),0==(t-=s)){s===n.length?(++i,e.next?this.head=e.next:this.head=this.tail=null):(this.head=e,e.data=n.slice(s));break}++i}return this.length-=i,r}},{key:"_getBuffer",value:function(t){var e=u.allocUnsafe(t),i=this.head,r=1;for(i.data.copy(e),t-=i.data.length;i=i.next;){var n=i.data,s=t>n.length?n.length:t;if(n.copy(e,e.length-t,0,s),0==(t-=s)){s===n.length?(++r,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=n.slice(s));break}++r}return this.length-=r,e}},{key:p,value:function(t,e){return d(this,n(n({},e),{},{depth:0,customInspect:!1}))}}]),t}()},{buffer:103,util:102}],477:[function(t,e,i){(function(t){(function(){function i(e,i){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(i?i(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(o,this,e)):t.nextTick(o,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!i&&e?s._writableState?s._writableState.errorEmitted?t.nextTick(n,s):(s._writableState.errorEmitted=!0,t.nextTick(r,s,e)):t.nextTick(r,s,e):i?(t.nextTick(n,s),i(e)):t.nextTick(n,s)})),this)}function r(t,e){o(t,e),n(t)}function n(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function s(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function o(t,e){t.emit("error",e)}function a(t,e){var i=t._readableState,r=t._writableState;i&&i.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}e.exports={destroy:i,undestroy:s,errorOrDestroy:a}}).call(this)}).call(this,t("_process"))},{_process:538}],478:[function(t,e,i){var r=t("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function n(t){var e=!1;return function(){if(!e){e=!0;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];t.apply(this,r)}}}function s(){}function o(t){return t.setHeader&&"function"==typeof t.abort}function a(t,e,i){if("function"==typeof e)return a(t,null,e);e||(e={}),i=n(i||s);var l=e.readable||!1!==e.readable&&t.readable,c=e.writable||!1!==e.writable&&t.writable,h=function(){t.writable||d()},u=t._writableState&&t._writableState.finished,d=function(){c=!1,u=!0,l||i.call(t)},p=t._readableState&&t._readableState.endEmitted,f=function(){l=!1,p=!0,c||i.call(t)},_=function(e){i.call(t,e)},m=function(){var e;return l&&!p?(t._readableState&&t._readableState.ended||(e=new r),i.call(t,e)):c&&!u?(t._writableState&&t._writableState.ended||(e=new r),i.call(t,e)):void 0},g=function(){t.req.on("finish",d)};return o(t)?(t.on("complete",d),t.on("abort",m),t.req?g():t.on("request",g)):c&&!t._writableState&&(t.on("end",h),t.on("close",h)),t.on("end",f),t.on("finish",d),!1!==e.error&&t.on("error",_),t.on("close",m),function(){t.removeListener("complete",d),t.removeListener("abort",m),t.removeListener("request",g),t.req&&t.req.removeListener("finish",d),t.removeListener("end",h),t.removeListener("close",h),t.removeListener("finish",d),t.removeListener("end",f),t.removeListener("error",_),t.removeListener("close",m)}}e.exports=a},{"../../../errors":469}],479:[function(t,e,i){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],480:[function(t,e,i){var r;function n(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var s=t("../../../errors").codes,o=s.ERR_MISSING_ARGS,a=s.ERR_STREAM_DESTROYED;function l(t){if(t)throw t}function c(t){return t.setHeader&&"function"==typeof t.abort}function h(e,i,s,o){o=n(o);var l=!1;e.on("close",(function(){l=!0})),void 0===r&&(r=t("./end-of-stream")),r(e,{readable:i,writable:s},(function(t){if(t)return o(t);l=!0,o()}));var h=!1;return function(t){if(!l&&!h)return h=!0,c(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new a("pipe"))}}function u(t){t()}function d(t,e){return t.pipe(e)}function p(t){return t.length?"function"!=typeof t[t.length-1]?l:t.pop():l}function f(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r,n=p(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new o("streams");var s=e.map((function(t,i){var o=i<e.length-1;return h(t,o,i>0,(function(t){r||(r=t),t&&s.forEach(u),o||(s.forEach(u),n(r))}))}));return e.reduce(d)}e.exports=f},{"../../../errors":469,"./end-of-stream":478}],481:[function(t,e,i){var r=t("../../../errors").codes.ERR_INVALID_OPT_VALUE;function n(t,e,i){return null!=t.highWaterMark?t.highWaterMark:e?t[i]:null}function s(t,e,i,s){var o=n(e,s,i);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(s?i:"highWaterMark",o);return Math.floor(o)}return t.objectMode?16:16384}e.exports={getHighWaterMark:s}},{"../../../errors":469}],482:[function(t,e,i){arguments[4][459][0].apply(i,arguments)},{dup:459,events:386}],483:[function(t,e,i){arguments[4][462][0].apply(i,arguments)},{dup:462,"safe-buffer":464}],484:[function(t,e,i){(function(e,r){(function(){var n=t("process/browser.js").nextTick,s=Function.prototype.apply,o=Array.prototype.slice,a={},l=0;function c(t,e){this._id=t,this._clearFn=e}i.setTimeout=function(){return new c(s.call(setTimeout,window,arguments),clearTimeout)},i.setInterval=function(){return new c(s.call(setInterval,window,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(t){t.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},i.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},i.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},i._unrefActive=i.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i.setImmediate="function"==typeof e?e:function(t){var e=l++,r=!(arguments.length<2)&&o.call(arguments,1);return a[e]=!0,n((function(){a[e]&&(r?t.apply(null,r):t.call(null),i.clearImmediate(e))})),e},i.clearImmediate="function"==typeof r?r:function(t){delete a[t]}}).call(this)}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":442,timers:484}],485:[function(t,e,i){var r=t("buffer").Buffer;e.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(r.isBuffer(t)){for(var e=new Uint8Array(t.length),i=t.length,n=0;n<i;n++)e[n]=t[n];return e.buffer}throw new Error("Argument must be a Buffer")}},{buffer:103}],486:[function(t,e,r){(function(t){(function(){function i(t,e){if(r("noDeprecation"))return t;var i=!1;function n(){if(!i){if(r("throwDeprecation"))throw new Error(e);r("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}return n}function r(e){try{if(!t.localStorage)return!1}catch(r){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=i}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],487:[function(t,e,i){arguments[4][97][0].apply(i,arguments)},{dup:97}],488:[function(t,i,r){var n=t("is-arguments"),s=t("is-generator-function"),o=t("which-typed-array"),a=t("is-typed-array");function l(t){return t.call.bind(t)}var c="undefined"!=typeof BigInt,h="undefined"!=typeof Symbol,u=l(Object.prototype.toString),d=l(Number.prototype.valueOf),p=l(String.prototype.valueOf),f=l(Boolean.prototype.valueOf);if(c)var _=l(BigInt.prototype.valueOf);if(h)var m=l(Symbol.prototype.valueOf);function g(t,i){if("object"!=typeof t)return!1;try{return i(t),!0}catch(e){return!1}}function y(t){return"undefined"!=typeof Promise&&t instanceof Promise||null!==t&&"object"==typeof t&&"function"==typeof t.then&&"function"==typeof t.catch}function v(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):a(t)||U(t)}function b(t){return"Uint8Array"===o(t)}function x(t){return"Uint8ClampedArray"===o(t)}function T(t){return"Uint16Array"===o(t)}function C(t){return"Uint32Array"===o(t)}function S(t){return"Int8Array"===o(t)}function w(t){return"Int16Array"===o(t)}function A(t){return"Int32Array"===o(t)}function E(t){return"Float32Array"===o(t)}function D(t){return"Float64Array"===o(t)}function L(t){return"BigInt64Array"===o(t)}function I(t){return"BigUint64Array"===o(t)}function P(t){return"[object Map]"===u(t)}function M(t){return"undefined"!=typeof Map&&(P.working?P(t):t instanceof Map)}function R(t){return"[object Set]"===u(t)}function O(t){return"undefined"!=typeof Set&&(R.working?R(t):t instanceof Set)}function B(t){return"[object WeakMap]"===u(t)}function N(t){return"undefined"!=typeof WeakMap&&(B.working?B(t):t instanceof WeakMap)}function k(t){return"[object WeakSet]"===u(t)}function F(t){return k(t)}function V(t){return"[object ArrayBuffer]"===u(t)}function j(t){return"undefined"!=typeof ArrayBuffer&&(V.working?V(t):t instanceof ArrayBuffer)}function G(t){return"[object DataView]"===u(t)}function U(t){return"undefined"!=typeof DataView&&(G.working?G(t):t instanceof DataView)}r.isArgumentsObject=n,r.isGeneratorFunction=s,r.isTypedArray=a,r.isPromise=y,r.isArrayBufferView=v,r.isUint8Array=b,r.isUint8ClampedArray=x,r.isUint16Array=T,r.isUint32Array=C,r.isInt8Array=S,r.isInt16Array=w,r.isInt32Array=A,r.isFloat32Array=E,r.isFloat64Array=D,r.isBigInt64Array=L,r.isBigUint64Array=I,P.working="undefined"!=typeof Map&&P(new Map),r.isMap=M,R.working="undefined"!=typeof Set&&R(new Set),r.isSet=O,B.working="undefined"!=typeof WeakMap&&B(new WeakMap),r.isWeakMap=N,k.working="undefined"!=typeof WeakSet&&k(new WeakSet),r.isWeakSet=F,V.working="undefined"!=typeof ArrayBuffer&&V(new ArrayBuffer),r.isArrayBuffer=j,G.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&G(new DataView(new ArrayBuffer(1),0,1)),r.isDataView=U;var Y="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function H(t){return"[object SharedArrayBuffer]"===u(t)}function X(t){return void 0!==Y&&(void 0===H.working&&(H.working=H(new Y)),H.working?H(t):t instanceof Y)}function z(t){return"[object AsyncFunction]"===u(t)}function W(t){return"[object Map Iterator]"===u(t)}function Z(t){return"[object Set Iterator]"===u(t)}function J(t){return"[object Generator]"===u(t)}function q(t){return"[object WebAssembly.Module]"===u(t)}function K(t){return g(t,d)}function Q(t){return g(t,p)}function $(t){return g(t,f)}function tt(t){return c&&g(t,_)}function et(t){return h&&g(t,m)}function it(t){return K(t)||Q(t)||$(t)||tt(t)||et(t)}function rt(t){return"undefined"!=typeof Uint8Array&&(j(t)||X(t))}r.isSharedArrayBuffer=X,r.isAsyncFunction=z,r.isMapIterator=W,r.isSetIterator=Z,r.isGeneratorObject=J,r.isWebAssemblyCompiledModule=q,r.isNumberObject=K,r.isStringObject=Q,r.isBooleanObject=$,r.isBigIntObject=tt,r.isSymbolObject=et,r.isBoxedPrimitive=it,r.isAnyArrayBuffer=rt,["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(t){Object.defineProperty(r,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})}))},{"is-arguments":408,"is-generator-function":411,"is-typed-array":412,"which-typed-array":490}],489:[function(t,e,i){(function(e){(function(){var r=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},r=0;r<e.length;r++)i[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return i},n=/%[sdj%]/g;i.format=function(t){if(!C(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(l(arguments[i]));return e.join(" ")}i=1;for(var r=arguments,s=r.length,o=String(t).replace(n,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return t}})),a=r[i];i<s;a=r[++i])b(a)||!E(a)?o+=" "+a:o+=" "+l(a);return o},i.deprecate=function(t,r){if(void 0!==e&&!0===e.noDeprecation)return t;if(void 0===e)return function(){return i.deprecate(t,r).apply(this,arguments)};var n=!1;function s(){if(!n){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),n=!0}return t.apply(this,arguments)}return s};var s={},o=/^$/;if(e.env.NODE_DEBUG){var a=e.env.NODE_DEBUG;a=a.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+a+"$","i")}function l(t,e){var r={seen:[],stylize:h};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(e)?r.showHidden=e:e&&i._extend(r,e),w(r.showHidden)&&(r.showHidden=!1),w(r.depth)&&(r.depth=2),w(r.colors)&&(r.colors=!1),w(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),d(r,t,r.depth)}function c(t,e){var i=l.styles[e];return i?"["+l.colors[i][0]+"m"+t+"["+l.colors[i][1]+"m":t}function h(t,e){return t}function u(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}function d(t,e,r){if(t.customInspect&&e&&I(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var n=e.inspect(r,t);return C(n)||(n=d(t,n,r)),n}var s=p(t,e);if(s)return s;var o=Object.keys(e),a=u(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),L(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(e);if(0===o.length){if(I(e)){var l=e.name?": "+e.name:"";return t.stylize("[Function"+l+"]","special")}if(A(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(D(e))return t.stylize(Date.prototype.toString.call(e),"date");if(L(e))return f(e)}var c,h="",v=!1,b=["{","}"];return y(e)&&(v=!0,b=["[","]"]),I(e)&&(h=" [Function"+(e.name?": "+e.name:"")+"]"),A(e)&&(h=" "+RegExp.prototype.toString.call(e)),D(e)&&(h=" "+Date.prototype.toUTCString.call(e)),L(e)&&(h=" "+f(e)),0!==o.length||v&&0!=e.length?r<0?A(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),c=v?_(t,e,r,a,o):o.map((function(i){return m(t,e,r,a,i,v)})),t.seen.pop(),g(c,h,b)):b[0]+h+b[1]}function p(t,e){if(w(e))return t.stylize("undefined","undefined");if(C(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return T(e)?t.stylize(""+e,"number"):v(e)?t.stylize(""+e,"boolean"):b(e)?t.stylize("null","null"):void 0}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function _(t,e,i,r,n){for(var s=[],o=0,a=e.length;o<a;++o)N(e,String(o))?s.push(m(t,e,i,r,String(o),!0)):s.push("");return n.forEach((function(n){n.match(/^\d+$/)||s.push(m(t,e,i,r,n,!0))})),s}function m(t,e,i,r,n,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),N(r,n)||(o="["+n+"]"),a||(t.seen.indexOf(l.value)<0?(a=b(i)?d(t,l.value,null):d(t,l.value,i-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(t){return"  "+t})).join("\n").slice(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),w(o)){if(s&&n.match(/^\d+$/))return a;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function g(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function y(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function b(t){return null===t}function x(t){return null==t}function T(t){return"number"==typeof t}function C(t){return"string"==typeof t}function S(t){return"symbol"==typeof t}function w(t){return void 0===t}function A(t){return E(t)&&"[object RegExp]"===M(t)}function E(t){return"object"==typeof t&&null!==t}function D(t){return E(t)&&"[object Date]"===M(t)}function L(t){return E(t)&&("[object Error]"===M(t)||t instanceof Error)}function I(t){return"function"==typeof t}function P(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function M(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}i.debuglog=function(t){if(t=t.toUpperCase(),!s[t])if(o.test(t)){var r=e.pid;s[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,r,e)}}else s[t]=function(){};return s[t]},i.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.types=t("./support/types"),i.isArray=y,i.isBoolean=v,i.isNull=b,i.isNullOrUndefined=x,i.isNumber=T,i.isString=C,i.isSymbol=S,i.isUndefined=w,i.isRegExp=A,i.types.isRegExp=A,i.isObject=E,i.isDate=D,i.types.isDate=D,i.isError=L,i.types.isNativeError=L,i.isFunction=I,i.isPrimitive=P,i.isBuffer=t("./support/isBuffer");var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function B(){var t=new Date,e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),O[t.getMonth()],e].join(" ")}function N(t,e){return Object.prototype.hasOwnProperty.call(t,e)}i.log=function(){console.log("%s - %s",B(),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,e){if(!e||!E(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t};var k="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function F(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}function V(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function i(){for(var i=[],r=0;r<arguments.length;r++)i.push(arguments[r]);var n=i.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var s=this,o=function(){return n.apply(s,arguments)};t.apply(this,i).then((function(t){e.nextTick(o.bind(null,null,t))}),(function(t){e.nextTick(F.bind(null,t,o))}))}return Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.defineProperties(i,r(t)),i}i.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(k&&t[k]){var e;if("function"!=typeof(e=t[k]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,k,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,r=new Promise((function(t,r){e=t,i=r})),n=[],s=0;s<arguments.length;s++)n.push(arguments[s]);n.push((function(t,r){t?i(t):e(r)}));try{t.apply(this,n)}catch(o){i(o)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),k&&Object.defineProperty(e,k,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,r(t))},i.promisify.custom=k,i.callbackify=V}).call(this)}).call(this,t("_process"))},{"./support/isBuffer":487,"./support/types":488,_process:538,inherits:407}],490:[function(t,r,n){(function(i){(function(){var n=t("for-each"),s=t("available-typed-arrays"),o=t("call-bind"),a=t("call-bind/callBound"),l=t("gopd"),c=a("Object.prototype.toString"),h=t("has-tostringtag/shams")(),u="undefined"==typeof globalThis?i:globalThis,d=s(),p=a("String.prototype.slice"),f=Object.getPrototypeOf,_=a("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},m={__proto__:null};n(d,h&&l&&f?function(t){var e=new u[t];if(Symbol.toStringTag in e){var i=f(e),r=l(i,Symbol.toStringTag);if(!r){var n=f(i);r=l(n,Symbol.toStringTag)}m["$"+t]=o(r.get)}}:function(t){var e=new u[t],i=e.slice||e.set;i&&(m["$"+t]=o(i))});var g=function(t){var i=!1;return n(m,(function(r,n){if(!i)try{"$"+r(t)===n&&(i=p(n,1))}catch(e){}})),i},y=function(t){var i=!1;return n(m,(function(r,n){if(!i)try{r(t),i=p(n,1)}catch(e){}})),i};r.exports=function(t){if(!t||"object"!=typeof t)return!1;if(!h){var e=p(c(t),8,-1);return _(d,e)>-1?e:"Object"===e&&y(t)}return l?g(t):null}}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"available-typed-arrays":99,"call-bind":106,"call-bind/callBound":105,"for-each":387,gopd:391,"has-tostringtag/shams":396}],491:[function(t,e,i){(function(){i.stripBOM=function(t){return"\ufeff"===t[0]?t.substring(1):t}}).call(this)},{}],492:[function(t,e,i){(function(){var e,r,n,s,o,a={}.hasOwnProperty;e=t("xmlbuilder"),r=t("./defaults").defaults,s=function(t){return"string"==typeof t&&(t.indexOf("&")>=0||t.indexOf(">")>=0||t.indexOf("<")>=0)},o=function(t){return"<![CDATA["+n(t)+"]]>"},n=function(t){return t.replace("]]>","]]]]><![CDATA[>")},i.Builder=function(){function t(t){var e,i,n;for(e in this.options={},i=r[.2])a.call(i,e)&&(n=i[e],this.options[e]=n);for(e in t)a.call(t,e)&&(n=t[e],this.options[e]=n)}return t.prototype.buildObject=function(t){var i,n,l,c,h;return i=this.options.attrkey,n=this.options.charkey,1===Object.keys(t).length&&this.options.rootName===r[.2].rootName?t=t[h=Object.keys(t)[0]]:h=this.options.rootName,l=function(t){return function(e,r){var c,h,u,d,p,f;if("object"!=typeof r)t.options.cdata&&s(r)?e.raw(o(r)):e.txt(r);else if(Array.isArray(r)){for(d in r)if(a.call(r,d))for(p in h=r[d])u=h[p],e=l(e.ele(p),u).up()}else for(p in r)if(a.call(r,p))if(h=r[p],p===i){if("object"==typeof h)for(c in h)f=h[c],e=e.att(c,f)}else if(p===n)e=t.options.cdata&&s(h)?e.raw(o(h)):e.txt(h);else if(Array.isArray(h))for(d in h)a.call(h,d)&&(e="string"==typeof(u=h[d])?t.options.cdata&&s(u)?e.ele(p).raw(o(u)).up():e.ele(p,u).up():l(e.ele(p),u).up());else"object"==typeof h?e=l(e.ele(p),h).up():"string"==typeof h&&t.options.cdata&&s(h)?e=e.ele(p).raw(o(h)).up():(null==h&&(h=""),e=e.ele(p,h.toString()).up());return e}}(this),c=e.create(h,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),l(c,t).end(this.options.renderOpts)},t}()}).call(this)},{"./defaults":493,xmlbuilder:529}],493:[function(t,e,i){(function(){i.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(this)},{}],494:[function(t,e,i){(function(){var e,r,n,s,o,a,l,c,h,u=function(t,e){return function(){return t.apply(e,arguments)}},d=function(t,e){for(var i in e)p.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=t("sax"),s=t("events"),e=t("./bom"),l=t("./processors"),h=t("timers").setImmediate,r=t("./defaults").defaults,o=function(t){return"object"==typeof t&&null!=t&&0===Object.keys(t).length},a=function(t,e,i){var r,n;for(r=0,n=t.length;r<n;r++)e=(0,t[r])(e,i);return e},n=function(t,e,i){var r;return(r=Object.create(null)).value=i,r.writable=!0,r.enumerable=!0,r.configurable=!0,Object.defineProperty(t,e,r)},i.Parser=function(t){function s(t){var e,n,s;if(this.parseStringPromise=u(this.parseStringPromise,this),this.parseString=u(this.parseString,this),this.reset=u(this.reset,this),this.assignOrPush=u(this.assignOrPush,this),this.processAsync=u(this.processAsync,this),!(this instanceof i.Parser))return new i.Parser(t);for(e in this.options={},n=r[.2])p.call(n,e)&&(s=n[e],this.options[e]=s);for(e in t)p.call(t,e)&&(s=t[e],this.options[e]=s);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(l.normalize)),this.reset()}return d(s,t),s.prototype.processAsync=function(){var t,e;try{return this.remaining.length<=this.options.chunkSize?(t=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(t),this.saxParser.close()):(t=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(t),h(this.processAsync))}catch(i){if(e=i,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(e)}},s.prototype.assignOrPush=function(t,e,i){return e in t?(t[e]instanceof Array||n(t,e,[t[e]]),t[e].push(i)):this.options.explicitArray?n(t,e,[i]):n(t,e,i)},s.prototype.reset=function(){var t,e,i,r;return this.removeAllListeners(),this.saxParser=c.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(t){return function(e){if(t.saxParser.resume(),!t.saxParser.errThrown)return t.saxParser.errThrown=!0,t.emit("error",e)}}(this),this.saxParser.onend=function(t){return function(){if(!t.saxParser.ended)return t.saxParser.ended=!0,t.emit("end",t.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,r=[],t=this.options.attrkey,e=this.options.charkey,this.saxParser.onopentag=function(i){return function(s){var o,l,c,h,u;if((c={})[e]="",!i.options.ignoreAttrs)for(o in u=s.attributes)p.call(u,o)&&(t in c||i.options.mergeAttrs||(c[t]={}),l=i.options.attrValueProcessors?a(i.options.attrValueProcessors,s.attributes[o],o):s.attributes[o],h=i.options.attrNameProcessors?a(i.options.attrNameProcessors,o):o,i.options.mergeAttrs?i.assignOrPush(c,h,l):n(c[t],h,l));return c["#name"]=i.options.tagNameProcessors?a(i.options.tagNameProcessors,s.name):s.name,i.options.xmlns&&(c[i.options.xmlnskey]={uri:s.uri,local:s.local}),r.push(c)}}(this),this.saxParser.onclosetag=function(t){return function(){var i,s,l,c,h,u,d,f,_,m;if(u=r.pop(),h=u["#name"],t.options.explicitChildren&&t.options.preserveChildrenOrder||delete u["#name"],!0===u.cdata&&(i=u.cdata,delete u.cdata),_=r[r.length-1],u[e].match(/^\s*$/)&&!i?(s=u[e],delete u[e]):(t.options.trim&&(u[e]=u[e].trim()),t.options.normalize&&(u[e]=u[e].replace(/\s{2,}/g," ").trim()),u[e]=t.options.valueProcessors?a(t.options.valueProcessors,u[e],h):u[e],1===Object.keys(u).length&&e in u&&!t.EXPLICIT_CHARKEY&&(u=u[e])),o(u)&&(u="function"==typeof t.options.emptyTag?t.options.emptyTag():""!==t.options.emptyTag?t.options.emptyTag:s),null!=t.options.validator&&(m="/"+function(){var t,e,i;for(i=[],t=0,e=r.length;t<e;t++)c=r[t],i.push(c["#name"]);return i}().concat(h).join("/"),function(){var e;try{return u=t.options.validator(m,_&&_[h],u)}catch(i){return e=i,t.emit("error",e)}}()),t.options.explicitChildren&&!t.options.mergeAttrs&&"object"==typeof u)if(t.options.preserveChildrenOrder){if(_){for(l in _[t.options.childkey]=_[t.options.childkey]||[],d={},u)p.call(u,l)&&n(d,l,u[l]);_[t.options.childkey].push(d),delete u["#name"],1===Object.keys(u).length&&e in u&&!t.EXPLICIT_CHARKEY&&(u=u[e])}}else c={},t.options.attrkey in u&&(c[t.options.attrkey]=u[t.options.attrkey],delete u[t.options.attrkey]),!t.options.charsAsChildren&&t.options.charkey in u&&(c[t.options.charkey]=u[t.options.charkey],delete u[t.options.charkey]),Object.getOwnPropertyNames(u).length>0&&(c[t.options.childkey]=u),u=c;return r.length>0?t.assignOrPush(_,h,u):(t.options.explicitRoot&&(f=u,n(u={},h,f)),t.resultObject=u,t.saxParser.ended=!0,t.emit("end",t.resultObject))}}(this),i=function(t){return function(i){var n,s;if(s=r[r.length-1])return s[e]+=i,t.options.explicitChildren&&t.options.preserveChildrenOrder&&t.options.charsAsChildren&&(t.options.includeWhiteChars||""!==i.replace(/\\n/g,"").trim())&&(s[t.options.childkey]=s[t.options.childkey]||[],(n={"#name":"__text__"})[e]=i,t.options.normalize&&(n[e]=n[e].replace(/\s{2,}/g," ").trim()),s[t.options.childkey].push(n)),s}}(this),this.saxParser.ontext=i,this.saxParser.oncdata=function(){return function(t){var e;if(e=i(t))return e.cdata=!0}}()},s.prototype.parseString=function(t,i){var r;null!=i&&"function"==typeof i&&(this.on("end",(function(t){return this.reset(),i(null,t)})),this.on("error",(function(t){return this.reset(),i(t)})));try{return""===(t=t.toString()).trim()?(this.emit("end",null),!0):(t=e.stripBOM(t),this.options.async?(this.remaining=t,h(this.processAsync),this.saxParser):this.saxParser.write(t).close())}catch(n){if(r=n,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",r),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw r}},s.prototype.parseStringPromise=function(t){return new Promise(function(e){return function(i,r){return e.parseString(t,(function(t,e){return t?r(t):i(e)}))}}(this))},s}(s),i.parseString=function(t,e,r){var n,s;return null!=r?("function"==typeof r&&(n=r),"object"==typeof e&&(s=e)):("function"==typeof e&&(n=e),s={}),new i.Parser(s).parseString(t,n)},i.parseStringPromise=function(t,e){var r;return"object"==typeof e&&(r=e),new i.Parser(r).parseStringPromise(t)}}).call(this)},{"./bom":491,"./defaults":493,"./processors":495,events:386,sax:465,timers:484}],495:[function(t,e,i){(function(){var t;t=new RegExp(/(?!xmlns)^.*:/),i.normalize=function(t){return t.toLowerCase()},i.firstCharLowerCase=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},i.stripPrefix=function(e){return e.replace(t,"")},i.parseNumbers=function(t){return isNaN(t)||(t=t%1==0?parseInt(t,10):parseFloat(t)),t},i.parseBooleans=function(t){return/^(?:true|false)$/i.test(t)&&(t="true"===t.toLowerCase()),t}}).call(this)},{}],496:[function(t,e,i){(function(){var e,r,n,s,o=function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=t("./defaults"),e=t("./builder"),n=t("./parser"),s=t("./processors"),i.defaults=r.defaults,i.processors=s,i.ValidationError=function(t){function e(t){this.message=t}return o(e,t),e}(Error),i.Builder=e.Builder,i.Parser=n.Parser,i.parseString=n.parseString,i.parseStringPromise=n.parseStringPromise}).call(this)},{"./builder":492,"./defaults":493,"./parser":494,"./processors":495}],497:[function(t,e,i){(function(){e.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},{}],498:[function(t,e,i){(function(){e.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},{}],499:[function(t,e,i){(function(){var t,i,r,n,s,o,a,l=[].slice,c={}.hasOwnProperty;t=function(){var t,e,i,r,n,o;if(o=arguments[0],n=2<=arguments.length?l.call(arguments,1):[],s(Object.assign))Object.assign.apply(null,arguments);else for(t=0,i=n.length;t<i;t++)if(null!=(r=n[t]))for(e in r)c.call(r,e)&&(o[e]=r[e]);return o},s=function(t){return!!t&&"[object Function]"===Object.prototype.toString.call(t)},o=function(t){var e;return!!t&&("function"==(e=typeof t)||"object"===e)},r=function(t){return s(Array.isArray)?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},n=function(t){var e;if(r(t))return!t.length;for(e in t)if(c.call(t,e))return!1;return!0},a=function(t){var e,i;return o(t)&&(i=Object.getPrototypeOf(t))&&(e=i.constructor)&&"function"==typeof e&&e instanceof e&&Function.prototype.toString.call(e)===Function.prototype.toString.call(Object)},i=function(t){return s(t.valueOf)?t.valueOf():t},e.exports.assign=t,e.exports.isFunction=s,e.exports.isObject=o,e.exports.isArray=r,e.exports.isEmpty=n,e.exports.isPlainObject=a,e.exports.getValue=i}).call(this)},{}],500:[function(t,e,i){(function(){e.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},{}],501:[function(t,e,i){(function(){var i;i=t("./NodeType"),t("./XMLNode"),e.exports=function(){function t(t,e,r){if(this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==e)throw new Error("Missing attribute name. "+this.debugInfo(e));this.name=this.stringify.name(e),this.value=this.stringify.attValue(r),this.type=i.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(t.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(t.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(t.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(t.prototype,"specified",{get:function(){return!0}}),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(t){return this.options.writer.attribute(this,this.options.writer.filterOptions(t))},t.prototype.debugInfo=function(t){return null==(t=t||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+t+"}, parent: <"+this.parent.name+">"},t.prototype.isEqualNode=function(t){return t.namespaceURI===this.namespaceURI&&t.prefix===this.prefix&&t.localName===this.localName&&t.value===this.value},t}()}).call(this)},{"./NodeType":498,"./XMLNode":520}],502:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=t("./NodeType"),r=t("./XMLCharacterData"),e.exports=function(t){function e(t,r){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=i.CData,this.value=this.stringify.cdata(r)}return n(e,t),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return this.options.writer.cdata(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLCharacterData":503}],503:[function(t,e,i){(function(){var i,r=function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;i=t("./XMLNode"),e.exports=function(t){function e(t){e.__super__.constructor.call(this,t),this.value=""}return r(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.value},set:function(t){return this.value=t||""}}),Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(e.prototype,"textContent",{get:function(){return this.value},set:function(t){return this.value=t||""}}),e.prototype.clone=function(){return Object.create(this)},e.prototype.substringData=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.appendData=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.insertData=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.deleteData=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.replaceData=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isEqualNode=function(t){return!!e.__super__.isEqualNode.apply(this,arguments).isEqualNode(t)&&t.data===this.data},e}(i)}).call(this)},{"./XMLNode":520}],504:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=t("./NodeType"),r=t("./XMLCharacterData"),e.exports=function(t){function e(t,r){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=i.Comment,this.value=this.stringify.comment(r)}return n(e,t),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return this.options.writer.comment(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLCharacterData":503}],505:[function(t,e,i){(function(){var i,r;i=t("./XMLDOMErrorHandler"),r=t("./XMLDOMStringList"),e.exports=function(){function t(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new i,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}return Object.defineProperty(t.prototype,"parameterNames",{get:function(){return new r(Object.keys(this.defaultParams))}}),t.prototype.getParameter=function(t){return this.params.hasOwnProperty(t)?this.params[t]:null},t.prototype.canSetParameter=function(t,e){return!0},t.prototype.setParameter=function(t,e){return null!=e?this.params[t]=e:delete this.params[t]},t}()}).call(this)},{"./XMLDOMErrorHandler":506,"./XMLDOMStringList":508}],506:[function(t,e,i){(function(){e.exports=function(){function t(){}return t.prototype.handleError=function(t){throw new Error(t)},t}()}).call(this)},{}],507:[function(t,e,i){(function(){e.exports=function(){function t(){}return t.prototype.hasFeature=function(t,e){return!0},t.prototype.createDocumentType=function(t,e,i){throw new Error("This DOM method is not implemented.")},t.prototype.createDocument=function(t,e,i){throw new Error("This DOM method is not implemented.")},t.prototype.createHTMLDocument=function(t){throw new Error("This DOM method is not implemented.")},t.prototype.getFeature=function(t,e){throw new Error("This DOM method is not implemented.")},t}()}).call(this)},{}],508:[function(t,e,i){(function(){e.exports=function(){function t(t){this.arr=t||[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.arr.length}}),t.prototype.item=function(t){return this.arr[t]||null},t.prototype.contains=function(t){return-1!==this.arr.indexOf(t)},t}()}).call(this)},{}],509:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t,r,n,s,o,a){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==n)throw new Error("Missing DTD attribute name. "+this.debugInfo(r));if(!s)throw new Error("Missing DTD attribute type. "+this.debugInfo(r));if(!o)throw new Error("Missing DTD attribute default. "+this.debugInfo(r));if(0!==o.indexOf("#")&&(o="#"+o),!o.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(r));if(a&&!o.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(r));this.elementName=this.stringify.name(r),this.type=i.AttributeDeclaration,this.attributeName=this.stringify.name(n),this.attributeType=this.stringify.dtdAttType(s),a&&(this.defaultValue=this.stringify.dtdAttDefault(a)),this.defaultValueType=o}return n(e,t),e.prototype.toString=function(t){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLNode":520}],510:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t,r,n){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing DTD element name. "+this.debugInfo());n||(n="(#PCDATA)"),Array.isArray(n)&&(n="("+n.join(",")+")"),this.name=this.stringify.name(r),this.type=i.ElementDeclaration,this.value=this.stringify.dtdElementValue(n)}return n(e,t),e.prototype.toString=function(t){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLNode":520}],511:[function(t,e,i){(function(){var i,r,n,s=function(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=t("./Utility").isObject,r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t,r,s,o){if(e.__super__.constructor.call(this,t),null==s)throw new Error("Missing DTD entity name. "+this.debugInfo(s));if(null==o)throw new Error("Missing DTD entity value. "+this.debugInfo(s));if(this.pe=!!r,this.name=this.stringify.name(s),this.type=i.EntityDeclaration,n(o)){if(!o.pubID&&!o.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(s));if(o.pubID&&!o.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(s));if(this.internal=!1,null!=o.pubID&&(this.pubID=this.stringify.dtdPubID(o.pubID)),null!=o.sysID&&(this.sysID=this.stringify.dtdSysID(o.sysID)),null!=o.nData&&(this.nData=this.stringify.dtdNData(o.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(s))}else this.value=this.stringify.dtdEntityValue(o),this.internal=!0}return s(e,t),Object.defineProperty(e.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(e.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(e.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(e.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(e.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(e.prototype,"xmlVersion",{get:function(){return null}}),e.prototype.toString=function(t){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./Utility":499,"./XMLNode":520}],512:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t,r,n){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing DTD notation name. "+this.debugInfo(r));if(!n.pubID&&!n.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(r));this.name=this.stringify.name(r),this.type=i.NotationDeclaration,null!=n.pubID&&(this.pubID=this.stringify.dtdPubID(n.pubID)),null!=n.sysID&&(this.sysID=this.stringify.dtdSysID(n.sysID))}return n(e,t),Object.defineProperty(e.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(e.prototype,"systemId",{get:function(){return this.sysID}}),e.prototype.toString=function(t){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLNode":520}],513:[function(t,e,i){(function(){var i,r,n,s=function(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;n=t("./Utility").isObject,r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t,r,s,o){var a;e.__super__.constructor.call(this,t),n(r)&&(r=(a=r).version,s=a.encoding,o=a.standalone),r||(r="1.0"),this.type=i.Declaration,this.version=this.stringify.xmlVersion(r),null!=s&&(this.encoding=this.stringify.xmlEncoding(s)),null!=o&&(this.standalone=this.stringify.xmlStandalone(o))}return s(e,t),e.prototype.toString=function(t){return this.options.writer.declaration(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./Utility":499,"./XMLNode":520}],514:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c,h=function(t,e){for(var i in e)u.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;c=t("./Utility").isObject,l=t("./XMLNode"),i=t("./NodeType"),r=t("./XMLDTDAttList"),s=t("./XMLDTDEntity"),n=t("./XMLDTDElement"),o=t("./XMLDTDNotation"),a=t("./XMLNamedNodeMap"),e.exports=function(t){function e(t,r,n){var s,o,a,l,h,u;if(e.__super__.constructor.call(this,t),this.type=i.DocType,t.children)for(o=0,a=(l=t.children).length;o<a;o++)if((s=l[o]).type===i.Element){this.name=s.name;break}this.documentObject=t,c(r)&&(r=(h=r).pubID,n=h.sysID),null==n&&(n=(u=[r,n])[0],r=u[1]),null!=r&&(this.pubID=this.stringify.dtdPubID(r)),null!=n&&(this.sysID=this.stringify.dtdSysID(n))}return h(e,t),Object.defineProperty(e.prototype,"entities",{get:function(){var t,e,r,n,s;for(n={},e=0,r=(s=this.children).length;e<r;e++)(t=s[e]).type!==i.EntityDeclaration||t.pe||(n[t.name]=t);return new a(n)}}),Object.defineProperty(e.prototype,"notations",{get:function(){var t,e,r,n,s;for(n={},e=0,r=(s=this.children).length;e<r;e++)(t=s[e]).type===i.NotationDeclaration&&(n[t.name]=t);return new a(n)}}),Object.defineProperty(e.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(e.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(e.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),e.prototype.element=function(t,e){var i;return i=new n(this,t,e),this.children.push(i),this},e.prototype.attList=function(t,e,i,n,s){var o;return o=new r(this,t,e,i,n,s),this.children.push(o),this},e.prototype.entity=function(t,e){var i;return i=new s(this,!1,t,e),this.children.push(i),this},e.prototype.pEntity=function(t,e){var i;return i=new s(this,!0,t,e),this.children.push(i),this},e.prototype.notation=function(t,e){var i;return i=new o(this,t,e),this.children.push(i),this},e.prototype.toString=function(t){return this.options.writer.docType(this,this.options.writer.filterOptions(t))},e.prototype.ele=function(t,e){return this.element(t,e)},e.prototype.att=function(t,e,i,r,n){return this.attList(t,e,i,r,n)},e.prototype.ent=function(t,e){return this.entity(t,e)},e.prototype.pent=function(t,e){return this.pEntity(t,e)},e.prototype.not=function(t,e){return this.notation(t,e)},e.prototype.up=function(){return this.root()||this.documentObject},e.prototype.isEqualNode=function(t){return!!e.__super__.isEqualNode.apply(this,arguments).isEqualNode(t)&&t.name===this.name&&t.publicId===this.publicId&&t.systemId===this.systemId},e}(l)}).call(this)},{"./NodeType":498,"./Utility":499,"./XMLDTDAttList":509,"./XMLDTDElement":510,"./XMLDTDEntity":511,"./XMLDTDNotation":512,"./XMLNamedNodeMap":519,"./XMLNode":520}],515:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c=function(t,e){for(var i in e)h.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h={}.hasOwnProperty;l=t("./Utility").isPlainObject,n=t("./XMLDOMImplementation"),r=t("./XMLDOMConfiguration"),s=t("./XMLNode"),i=t("./NodeType"),a=t("./XMLStringifier"),o=t("./XMLStringWriter"),e.exports=function(t){function e(t){e.__super__.constructor.call(this,null),this.name="#document",this.type=i.Document,this.documentURI=null,this.domConfig=new r,t||(t={}),t.writer||(t.writer=new o),this.options=t,this.stringify=new a(t)}return c(e,t),Object.defineProperty(e.prototype,"implementation",{value:new n}),Object.defineProperty(e.prototype,"doctype",{get:function(){var t,e,r,n;for(e=0,r=(n=this.children).length;e<r;e++)if((t=n[e]).type===i.DocType)return t;return null}}),Object.defineProperty(e.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(e.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(e.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(e.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===i.Declaration?this.children[0].encoding:null}}),Object.defineProperty(e.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===i.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(e.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===i.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(e.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(e.prototype,"origin",{get:function(){return null}}),Object.defineProperty(e.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(e.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(e.prototype,"contentType",{get:function(){return null}}),e.prototype.end=function(t){var e;return e={},t?l(t)&&(e=t,t=this.options.writer):t=this.options.writer,t.document(this,t.filterOptions(e))},e.prototype.toString=function(t){return this.options.writer.document(this,this.options.writer.filterOptions(t))},e.prototype.createElement=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createTextNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createComment=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createCDATASection=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createProcessingInstruction=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createAttribute=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createEntityReference=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagName=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.importNode=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createElementNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createAttributeNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagNameNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementById=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.adoptNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.renameNode=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByClassName=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createEvent=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createNodeIterator=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.createTreeWalker=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e}(s)}).call(this)},{"./NodeType":498,"./Utility":499,"./XMLDOMConfiguration":505,"./XMLDOMImplementation":507,"./XMLNode":520,"./XMLStringWriter":525,"./XMLStringifier":526}],516:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c,h,u,d,p,f,_,m,g,y,v,b,x,T,C,S,w={}.hasOwnProperty;S=t("./Utility"),T=S.isObject,x=S.isFunction,C=S.isPlainObject,b=S.getValue,i=t("./NodeType"),p=t("./XMLDocument"),f=t("./XMLElement"),s=t("./XMLCData"),o=t("./XMLComment"),m=t("./XMLRaw"),v=t("./XMLText"),_=t("./XMLProcessingInstruction"),u=t("./XMLDeclaration"),d=t("./XMLDocType"),a=t("./XMLDTDAttList"),c=t("./XMLDTDEntity"),l=t("./XMLDTDElement"),h=t("./XMLDTDNotation"),n=t("./XMLAttribute"),y=t("./XMLStringifier"),g=t("./XMLStringWriter"),r=t("./WriterState"),e.exports=function(){function t(t,e,r){var n;this.name="?xml",this.type=i.Document,t||(t={}),n={},t.writer?C(t.writer)&&(n=t.writer,t.writer=new g):t.writer=new g,this.options=t,this.writer=t.writer,this.writerOptions=this.writer.filterOptions(n),this.stringify=new y(t),this.onDataCallback=e||function(){},this.onEndCallback=r||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return t.prototype.createChildNode=function(t){var e,r,n,s,o,a,l,c;switch(t.type){case i.CData:this.cdata(t.value);break;case i.Comment:this.comment(t.value);break;case i.Element:for(r in n={},l=t.attribs)w.call(l,r)&&(e=l[r],n[r]=e.value);this.node(t.name,n);break;case i.Dummy:this.dummy();break;case i.Raw:this.raw(t.value);break;case i.Text:this.text(t.value);break;case i.ProcessingInstruction:this.instruction(t.target,t.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+t.constructor.name)}for(o=0,a=(c=t.children).length;o<a;o++)s=c[o],this.createChildNode(s),s.type===i.Element&&this.up();return this},t.prototype.dummy=function(){return this},t.prototype.node=function(t,e,i){var r;if(null==t)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(t));return this.openCurrent(),t=b(t),null==e&&(e={}),e=b(e),T(e)||(i=(r=[e,i])[0],e=r[1]),this.currentNode=new f(this,t,e),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=i&&this.text(i),this},t.prototype.element=function(t,e,r){var n,s,o,a,l,c;if(this.currentNode&&this.currentNode.type===i.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(t)||T(t)||x(t))for(a=this.options.noValidation,this.options.noValidation=!0,(c=new p(this.options).element("TEMP_ROOT")).element(t),this.options.noValidation=a,s=0,o=(l=c.children).length;s<o;s++)n=l[s],this.createChildNode(n),n.type===i.Element&&this.up();else this.node(t,e,r);return this},t.prototype.attribute=function(t,e){var i,r;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(t));if(null!=t&&(t=b(t)),T(t))for(i in t)w.call(t,i)&&(r=t[i],this.attribute(i,r));else x(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.currentNode.attribs[t]=new n(this,t,""):null!=e&&(this.currentNode.attribs[t]=new n(this,t,e));return this},t.prototype.text=function(t){var e;return this.openCurrent(),e=new v(this,t),this.onData(this.writer.text(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.cdata=function(t){var e;return this.openCurrent(),e=new s(this,t),this.onData(this.writer.cdata(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.comment=function(t){var e;return this.openCurrent(),e=new o(this,t),this.onData(this.writer.comment(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.raw=function(t){var e;return this.openCurrent(),e=new m(this,t),this.onData(this.writer.raw(e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.instruction=function(t,e){var i,r,n,s,o;if(this.openCurrent(),null!=t&&(t=b(t)),null!=e&&(e=b(e)),Array.isArray(t))for(i=0,s=t.length;i<s;i++)r=t[i],this.instruction(r);else if(T(t))for(r in t)w.call(t,r)&&(n=t[r],this.instruction(r,n));else x(e)&&(e=e.apply()),o=new _(this,t,e),this.onData(this.writer.processingInstruction(o,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},t.prototype.declaration=function(t,e,i){var r;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return r=new u(this,t,e,i),this.onData(this.writer.declaration(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.doctype=function(t,e,i){if(this.openCurrent(),null==t)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new d(this,e,i),this.currentNode.rootNodeName=t,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},t.prototype.dtdElement=function(t,e){var i;return this.openCurrent(),i=new l(this,t,e),this.onData(this.writer.dtdElement(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.attList=function(t,e,i,r,n){var s;return this.openCurrent(),s=new a(this,t,e,i,r,n),this.onData(this.writer.dtdAttList(s,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.entity=function(t,e){var i;return this.openCurrent(),i=new c(this,!1,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.pEntity=function(t,e){var i;return this.openCurrent(),i=new c(this,!0,t,e),this.onData(this.writer.dtdEntity(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.notation=function(t,e){var i;return this.openCurrent(),i=new h(this,t,e),this.onData(this.writer.dtdNotation(i,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},t.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},t.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},t.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},t.prototype.openNode=function(t){var e,n,s,o;if(!t.isOpen){if(this.root||0!==this.currentLevel||t.type!==i.Element||(this.root=t),n="",t.type===i.Element){for(s in this.writerOptions.state=r.OpenTag,n=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<"+t.name,o=t.attribs)w.call(o,s)&&(e=o[s],n+=this.writer.attribute(e,this.writerOptions,this.currentLevel));n+=(t.children?">":"/>")+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=r.InsideTag}else this.writerOptions.state=r.OpenTag,n=this.writer.indent(t,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+t.rootNodeName,t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),t.children?(n+=" [",this.writerOptions.state=r.InsideTag):(this.writerOptions.state=r.CloseTag,n+=">"),n+=this.writer.endline(t,this.writerOptions,this.currentLevel);return this.onData(n,this.currentLevel),t.isOpen=!0}},t.prototype.closeNode=function(t){var e;if(!t.isClosed)return e="",this.writerOptions.state=r.CloseTag,e=t.type===i.Element?this.writer.indent(t,this.writerOptions,this.currentLevel)+"</"+t.name+">"+this.writer.endline(t,this.writerOptions,this.currentLevel):this.writer.indent(t,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(t,this.writerOptions,this.currentLevel),this.writerOptions.state=r.None,this.onData(e,this.currentLevel),t.isClosed=!0},t.prototype.onData=function(t,e){return this.documentStarted=!0,this.onDataCallback(t,e+1)},t.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},t.prototype.debugInfo=function(t){return null==t?"":"node: <"+t+">"},t.prototype.ele=function(){return this.element.apply(this,arguments)},t.prototype.nod=function(t,e,i){return this.node(t,e,i)},t.prototype.txt=function(t){return this.text(t)},t.prototype.dat=function(t){return this.cdata(t)},t.prototype.com=function(t){return this.comment(t)},t.prototype.ins=function(t,e){return this.instruction(t,e)},t.prototype.dec=function(t,e,i){return this.declaration(t,e,i)},t.prototype.dtd=function(t,e,i){return this.doctype(t,e,i)},t.prototype.e=function(t,e,i){return this.element(t,e,i)},t.prototype.n=function(t,e,i){return this.node(t,e,i)},t.prototype.t=function(t){return this.text(t)},t.prototype.d=function(t){return this.cdata(t)},t.prototype.c=function(t){return this.comment(t)},t.prototype.r=function(t){return this.raw(t)},t.prototype.i=function(t,e){return this.instruction(t,e)},t.prototype.att=function(){return this.currentNode&&this.currentNode.type===i.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},t.prototype.a=function(){return this.currentNode&&this.currentNode.type===i.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},t.prototype.ent=function(t,e){return this.entity(t,e)},t.prototype.pent=function(t,e){return this.pEntity(t,e)},t.prototype.not=function(t,e){return this.notation(t,e)},t}()}).call(this)},{"./NodeType":498,"./Utility":499,"./WriterState":500,"./XMLAttribute":501,"./XMLCData":502,"./XMLComment":504,"./XMLDTDAttList":509,"./XMLDTDElement":510,"./XMLDTDEntity":511,"./XMLDTDNotation":512,"./XMLDeclaration":513,"./XMLDocType":514,"./XMLDocument":515,"./XMLElement":518,"./XMLProcessingInstruction":522,"./XMLRaw":523,"./XMLStringWriter":525,"./XMLStringifier":526,"./XMLText":527}],517:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./XMLNode"),i=t("./NodeType"),e.exports=function(t){function e(t){e.__super__.constructor.call(this,t),this.type=i.Dummy}return n(e,t),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return""},e}(r)}).call(this)},{"./NodeType":498,"./XMLNode":520}],518:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c,h=function(t,e){for(var i in e)u.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;c=t("./Utility"),l=c.isObject,a=c.isFunction,o=c.getValue,s=t("./XMLNode"),i=t("./NodeType"),r=t("./XMLAttribute"),n=t("./XMLNamedNodeMap"),e.exports=function(t){function e(t,r,n){var s,o,a,l;if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(r),this.type=i.Element,this.attribs={},this.schemaTypeInfo=null,null!=n&&this.attribute(n),t.type===i.Document&&(this.isRoot=!0,this.documentObject=t,t.rootObject=this,t.children))for(o=0,a=(l=t.children).length;o<a;o++)if((s=l[o]).type===i.DocType){s.name=this.name;break}}return h(e,t),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(e.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(e.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(e.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(e.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.attributeMap&&this.attributeMap.nodes||(this.attributeMap=new n(this.attribs)),this.attributeMap}}),e.prototype.clone=function(){var t,e,i,r;for(e in(i=Object.create(this)).isRoot&&(i.documentObject=null),i.attribs={},r=this.attribs)u.call(r,e)&&(t=r[e],i.attribs[e]=t.clone());return i.children=[],this.children.forEach((function(t){var e;return(e=t.clone()).parent=i,i.children.push(e)})),i},e.prototype.attribute=function(t,e){var i,n;if(null!=t&&(t=o(t)),l(t))for(i in t)u.call(t,i)&&(n=t[i],this.attribute(i,n));else a(e)&&(e=e.apply()),this.options.keepNullAttributes&&null==e?this.attribs[t]=new r(this,t,""):null!=e&&(this.attribs[t]=new r(this,t,e));return this},e.prototype.removeAttribute=function(t){var e,i,r;if(null==t)throw new Error("Missing attribute name. "+this.debugInfo());if(t=o(t),Array.isArray(t))for(i=0,r=t.length;i<r;i++)e=t[i],delete this.attribs[e];else delete this.attribs[t];return this},e.prototype.toString=function(t){return this.options.writer.element(this,this.options.writer.filterOptions(t))},e.prototype.att=function(t,e){return this.attribute(t,e)},e.prototype.a=function(t,e){return this.attribute(t,e)},e.prototype.getAttribute=function(t){return this.attribs.hasOwnProperty(t)?this.attribs[t].value:null},e.prototype.setAttribute=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getAttributeNode=function(t){return this.attribs.hasOwnProperty(t)?this.attribs[t]:null},e.prototype.setAttributeNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.removeAttributeNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagName=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getAttributeNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setAttributeNS=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.removeAttributeNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getAttributeNodeNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setAttributeNodeNS=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagNameNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.hasAttribute=function(t){return this.attribs.hasOwnProperty(t)},e.prototype.hasAttributeNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setIdAttribute=function(t,e){return this.attribs.hasOwnProperty(t)?this.attribs[t].isId:e},e.prototype.setIdAttributeNS=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setIdAttributeNode=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagName=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByTagNameNS=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getElementsByClassName=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isEqualNode=function(t){var i,r,n;if(!e.__super__.isEqualNode.apply(this,arguments).isEqualNode(t))return!1;if(t.namespaceURI!==this.namespaceURI)return!1;if(t.prefix!==this.prefix)return!1;if(t.localName!==this.localName)return!1;if(t.attribs.length!==this.attribs.length)return!1;for(i=r=0,n=this.attribs.length-1;0<=n?r<=n:r>=n;i=0<=n?++r:--r)if(!this.attribs[i].isEqualNode(t.attribs[i]))return!1;return!0},e}(s)}).call(this)},{"./NodeType":498,"./Utility":499,"./XMLAttribute":501,"./XMLNamedNodeMap":519,"./XMLNode":520}],519:[function(t,e,i){(function(){e.exports=function(){function t(t){this.nodes=t}return Object.defineProperty(t.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),t.prototype.clone=function(){return this.nodes=null},t.prototype.getNamedItem=function(t){return this.nodes[t]},t.prototype.setNamedItem=function(t){var e;return e=this.nodes[t.nodeName],this.nodes[t.nodeName]=t,e||null},t.prototype.removeNamedItem=function(t){var e;return e=this.nodes[t],delete this.nodes[t],e||null},t.prototype.item=function(t){return this.nodes[Object.keys(this.nodes)[t]]||null},t.prototype.getNamedItemNS=function(t,e){throw new Error("This DOM method is not implemented.")},t.prototype.setNamedItemNS=function(t){throw new Error("This DOM method is not implemented.")},t.prototype.removeNamedItemNS=function(t,e){throw new Error("This DOM method is not implemented.")},t}()}).call(this)},{}],520:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c,h,u,d,p,f,_,m,g,y,v={}.hasOwnProperty;y=t("./Utility"),g=y.isObject,m=y.isFunction,_=y.isEmpty,f=y.getValue,c=null,n=null,s=null,o=null,a=null,d=null,p=null,u=null,l=null,r=null,h=null,i=null,e.exports=function(){function e(e){this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,c||(c=t("./XMLElement"),n=t("./XMLCData"),s=t("./XMLComment"),o=t("./XMLDeclaration"),a=t("./XMLDocType"),d=t("./XMLRaw"),p=t("./XMLText"),u=t("./XMLProcessingInstruction"),l=t("./XMLDummy"),r=t("./NodeType"),h=t("./XMLNodeList"),t("./XMLNamedNodeMap"),i=t("./DocumentPosition"))}return Object.defineProperty(e.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new h(this.children)),this.childNodeList}}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t-1]||null}}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){var t;return t=this.parent.children.indexOf(this),this.parent.children[t+1]||null}}),Object.defineProperty(e.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(e.prototype,"textContent",{get:function(){var t,e,i,n,s;if(this.nodeType===r.Element||this.nodeType===r.DocumentFragment){for(s="",e=0,i=(n=this.children).length;e<i;e++)(t=n[e]).textContent&&(s+=t.textContent);return s}return null},set:function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),e.prototype.setParent=function(t){var e,i,r,n,s;for(this.parent=t,t&&(this.options=t.options,this.stringify=t.stringify),s=[],i=0,r=(n=this.children).length;i<r;i++)e=n[i],s.push(e.setParent(this));return s},e.prototype.element=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p;if(l=null,null===e&&null==i&&(e=(u=[{},null])[0],i=u[1]),null==e&&(e={}),e=f(e),g(e)||(i=(d=[e,i])[0],e=d[1]),null!=t&&(t=f(t)),Array.isArray(t))for(s=0,c=t.length;s<c;s++)n=t[s],l=this.element(n);else if(m(t))l=this.element(t.apply());else if(g(t)){for(a in t)if(v.call(t,a))if(p=t[a],m(p)&&(p=p.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===a.indexOf(this.stringify.convertAttKey))l=this.attribute(a.substr(this.stringify.convertAttKey.length),p);else if(!this.options.separateArrayItems&&Array.isArray(p)&&_(p))l=this.dummy();else if(g(p)&&_(p))l=this.element(a);else if(this.options.keepNullNodes||null!=p)if(!this.options.separateArrayItems&&Array.isArray(p))for(o=0,h=p.length;o<h;o++)n=p[o],(r={})[a]=n,l=this.element(r);else g(p)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===a.indexOf(this.stringify.convertTextKey)?l=this.element(p):(l=this.element(a)).element(p):l=this.element(a,p);else l=this.dummy()}else l=this.options.keepNullNodes||null!==i?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===t.indexOf(this.stringify.convertTextKey)?this.text(i):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===t.indexOf(this.stringify.convertCDataKey)?this.cdata(i):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===t.indexOf(this.stringify.convertCommentKey)?this.comment(i):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===t.indexOf(this.stringify.convertRawKey)?this.raw(i):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===t.indexOf(this.stringify.convertPIKey)?this.instruction(t.substr(this.stringify.convertPIKey.length),i):this.node(t,e,i):this.dummy();if(null==l)throw new Error("Could not create any elements with: "+t+". "+this.debugInfo());return l},e.prototype.insertBefore=function(t,e,i){var r,n,s,o,a;if(null!=t?t.type:void 0)return o=e,(s=t).setParent(this),o?(n=children.indexOf(o),a=children.splice(n),children.push(s),Array.prototype.push.apply(children,a)):children.push(s),s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return n=this.parent.children.indexOf(this),a=this.parent.children.splice(n),r=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,a),r},e.prototype.insertAfter=function(t,e,i){var r,n,s;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(t));return n=this.parent.children.indexOf(this),s=this.parent.children.splice(n+1),r=this.parent.element(t,e,i),Array.prototype.push.apply(this.parent.children,s),r},e.prototype.remove=function(){var t;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return t=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[t,t-t+1].concat([])),this.parent},e.prototype.node=function(t,e,i){var r,n;return null!=t&&(t=f(t)),e||(e={}),e=f(e),g(e)||(i=(n=[e,i])[0],e=n[1]),r=new c(this,t,e),null!=i&&r.text(i),this.children.push(r),r},e.prototype.text=function(t){var e;return g(t)&&this.element(t),e=new p(this,t),this.children.push(e),this},e.prototype.cdata=function(t){var e;return e=new n(this,t),this.children.push(e),this},e.prototype.comment=function(t){var e;return e=new s(this,t),this.children.push(e),this},e.prototype.commentBefore=function(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this},e.prototype.commentAfter=function(t){var e,i;return e=this.parent.children.indexOf(this),i=this.parent.children.splice(e+1),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,i),this},e.prototype.raw=function(t){var e;return e=new d(this,t),this.children.push(e),this},e.prototype.dummy=function(){return new l(this)},e.prototype.instruction=function(t,e){var i,r,n,s,o;if(null!=t&&(t=f(t)),null!=e&&(e=f(e)),Array.isArray(t))for(s=0,o=t.length;s<o;s++)i=t[s],this.instruction(i);else if(g(t))for(i in t)v.call(t,i)&&(r=t[i],this.instruction(i,r));else m(e)&&(e=e.apply()),n=new u(this,t,e),this.children.push(n);return this},e.prototype.instructionBefore=function(t,e){var i,r;return i=this.parent.children.indexOf(this),r=this.parent.children.splice(i),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.instructionAfter=function(t,e){var i,r;return i=this.parent.children.indexOf(this),r=this.parent.children.splice(i+1),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.declaration=function(t,e,i){var n,s;return n=this.document(),s=new o(n,t,e,i),0===n.children.length?n.children.unshift(s):n.children[0].type===r.Declaration?n.children[0]=s:n.children.unshift(s),n.root()||n},e.prototype.dtd=function(t,e){var i,n,s,o,l,c,h,u,d;for(i=this.document(),n=new a(i,t,e),s=o=0,c=(u=i.children).length;o<c;s=++o)if(u[s].type===r.DocType)return i.children[s]=n,n;for(s=l=0,h=(d=i.children).length;l<h;s=++l)if(d[s].isRoot)return i.children.splice(s,0,n),n;return i.children.push(n),n},e.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},e.prototype.root=function(){var t;for(t=this;t;){if(t.type===r.Document)return t.rootObject;if(t.isRoot)return t;t=t.parent}},e.prototype.document=function(){var t;for(t=this;t;){if(t.type===r.Document)return t;t=t.parent}},e.prototype.end=function(t){return this.document().end(t)},e.prototype.prev=function(){var t;if((t=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[t-1]},e.prototype.next=function(){var t;if(-1===(t=this.parent.children.indexOf(this))||t===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[t+1]},e.prototype.importDocument=function(t){var e;return(e=t.root().clone()).parent=this,e.isRoot=!1,this.children.push(e),this},e.prototype.debugInfo=function(t){var e,i;return null!=(t=t||this.name)||(null!=(e=this.parent)?e.name:void 0)?null==t?"parent: <"+this.parent.name+">":(null!=(i=this.parent)?i.name:void 0)?"node: <"+t+">, parent: <"+this.parent.name+">":"node: <"+t+">":""},e.prototype.ele=function(t,e,i){return this.element(t,e,i)},e.prototype.nod=function(t,e,i){return this.node(t,e,i)},e.prototype.txt=function(t){return this.text(t)},e.prototype.dat=function(t){return this.cdata(t)},e.prototype.com=function(t){return this.comment(t)},e.prototype.ins=function(t,e){return this.instruction(t,e)},e.prototype.doc=function(){return this.document()},e.prototype.dec=function(t,e,i){return this.declaration(t,e,i)},e.prototype.e=function(t,e,i){return this.element(t,e,i)},e.prototype.n=function(t,e,i){return this.node(t,e,i)},e.prototype.t=function(t){return this.text(t)},e.prototype.d=function(t){return this.cdata(t)},e.prototype.c=function(t){return this.comment(t)},e.prototype.r=function(t){return this.raw(t)},e.prototype.i=function(t,e){return this.instruction(t,e)},e.prototype.u=function(){return this.up()},e.prototype.importXMLBuilder=function(t){return this.importDocument(t)},e.prototype.replaceChild=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.removeChild=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.appendChild=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.hasChildNodes=function(){return 0!==this.children.length},e.prototype.cloneNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isSupported=function(t,e){return!0},e.prototype.hasAttributes=function(){return 0!==this.attribs.length},e.prototype.compareDocumentPosition=function(t){var e,r;return(e=this)===t?0:this.document()!==t.document()?(r=i.Disconnected|i.ImplementationSpecific,Math.random()<.5?r|=i.Preceding:r|=i.Following,r):e.isAncestor(t)?i.Contains|i.Preceding:e.isDescendant(t)?i.Contains|i.Following:e.isPreceding(t)?i.Preceding:i.Following},e.prototype.isSameNode=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupPrefix=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isDefaultNamespace=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupNamespaceURI=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isEqualNode=function(t){var e,i,r;if(t.nodeType!==this.nodeType)return!1;if(t.children.length!==this.children.length)return!1;for(e=i=0,r=this.children.length-1;0<=r?i<=r:i>=r;e=0<=r?++i:--i)if(!this.children[e].isEqualNode(t.children[e]))return!1;return!0},e.prototype.getFeature=function(t,e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setUserData=function(t,e,i){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getUserData=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.contains=function(t){return!!t&&(t===this||this.isDescendant(t))},e.prototype.isDescendant=function(t){var e,i,r,n;for(i=0,r=(n=this.children).length;i<r;i++){if(t===(e=n[i]))return!0;if(e.isDescendant(t))return!0}return!1},e.prototype.isAncestor=function(t){return t.isDescendant(this)},e.prototype.isPreceding=function(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e<i},e.prototype.isFollowing=function(t){var e,i;return e=this.treePosition(t),i=this.treePosition(this),-1!==e&&-1!==i&&e>i},e.prototype.treePosition=function(t){var e,i;return i=0,e=!1,this.foreachTreeNode(this.document(),(function(r){if(i++,!e&&r===t)return e=!0})),e?i:-1},e.prototype.foreachTreeNode=function(t,e){var i,r,n,s,o;for(t||(t=this.document()),r=0,n=(s=t.children).length;r<n;r++){if(o=e(i=s[r]))return o;if(o=this.foreachTreeNode(i,e))return o}},e}()}).call(this)},{"./DocumentPosition":497,"./NodeType":498,"./Utility":499,"./XMLCData":502,"./XMLComment":504,"./XMLDeclaration":513,"./XMLDocType":514,"./XMLDummy":517,"./XMLElement":518,"./XMLNamedNodeMap":519,"./XMLNodeList":521,"./XMLProcessingInstruction":522,"./XMLRaw":523,"./XMLText":527}],521:[function(t,e,i){(function(){e.exports=function(){function t(t){this.nodes=t}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length||0}}),t.prototype.clone=function(){return this.nodes=null},t.prototype.item=function(t){return this.nodes[t]||null},t}()}).call(this)},{}],522:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=t("./NodeType"),r=t("./XMLCharacterData"),e.exports=function(t){function e(t,r,n){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing instruction target. "+this.debugInfo());this.type=i.ProcessingInstruction,this.target=this.stringify.insTarget(r),this.name=this.target,n&&(this.value=this.stringify.insValue(n))}return n(e,t),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(t))},e.prototype.isEqualNode=function(t){return!!e.__super__.isEqualNode.apply(this,arguments).isEqualNode(t)&&t.target===this.target},e}(r)}).call(this)},{"./NodeType":498,"./XMLCharacterData":503}],523:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=t("./NodeType"),r=t("./XMLNode"),e.exports=function(t){function e(t,r){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing raw text. "+this.debugInfo());this.type=i.Raw,this.value=this.stringify.raw(r)}return n(e,t),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return this.options.writer.raw(this,this.options.writer.filterOptions(t))},e}(r)}).call(this)},{"./NodeType":498,"./XMLNode":520}],524:[function(t,e,i){(function(){var i,r,n,s=function(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;i=t("./NodeType"),n=t("./XMLWriterBase"),r=t("./WriterState"),e.exports=function(t){function e(t,i){this.stream=t,e.__super__.constructor.call(this,i)}return s(e,t),e.prototype.endline=function(t,i,n){return t.isLastRootNode&&i.state===r.CloseTag?"":e.__super__.endline.call(this,t,i,n)},e.prototype.document=function(t,e){var i,r,n,s,o,a,l,c,h;for(r=n=0,o=(l=t.children).length;n<o;r=++n)(i=l[r]).isLastRootNode=r===t.children.length-1;for(e=this.filterOptions(e),h=[],s=0,a=(c=t.children).length;s<a;s++)i=c[s],h.push(this.writeChildNode(i,e,0));return h},e.prototype.attribute=function(t,i,r){return this.stream.write(e.__super__.attribute.call(this,t,i,r))},e.prototype.cdata=function(t,i,r){return this.stream.write(e.__super__.cdata.call(this,t,i,r))},e.prototype.comment=function(t,i,r){return this.stream.write(e.__super__.comment.call(this,t,i,r))},e.prototype.declaration=function(t,i,r){return this.stream.write(e.__super__.declaration.call(this,t,i,r))},e.prototype.docType=function(t,e,i){var n,s,o,a;if(i||(i=0),this.openNode(t,e,i),e.state=r.OpenTag,this.stream.write(this.indent(t,e,i)),this.stream.write("<!DOCTYPE "+t.root().name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(t,e,i)),e.state=r.InsideTag,s=0,o=(a=t.children).length;s<o;s++)n=a[s],this.writeChildNode(n,e,i+1);e.state=r.CloseTag,this.stream.write("]")}return e.state=r.CloseTag,this.stream.write(e.spaceBeforeSlash+">"),this.stream.write(this.endline(t,e,i)),e.state=r.None,this.closeNode(t,e,i)},e.prototype.element=function(t,e,n){var s,a,l,c,h,u,d,p,f;for(d in n||(n=0),this.openNode(t,e,n),e.state=r.OpenTag,this.stream.write(this.indent(t,e,n)+"<"+t.name),p=t.attribs)o.call(p,d)&&(s=p[d],this.attribute(s,e,n));if(c=0===(l=t.children.length)?null:t.children[0],0===l||t.children.every((function(t){return(t.type===i.Text||t.type===i.Raw)&&""===t.value})))e.allowEmpty?(this.stream.write(">"),e.state=r.CloseTag,this.stream.write("</"+t.name+">")):(e.state=r.CloseTag,this.stream.write(e.spaceBeforeSlash+"/>"));else if(!e.pretty||1!==l||c.type!==i.Text&&c.type!==i.Raw||null==c.value){for(this.stream.write(">"+this.endline(t,e,n)),e.state=r.InsideTag,h=0,u=(f=t.children).length;h<u;h++)a=f[h],this.writeChildNode(a,e,n+1);e.state=r.CloseTag,this.stream.write(this.indent(t,e,n)+"</"+t.name+">")}else this.stream.write(">"),e.state=r.InsideTag,e.suppressPrettyCount++,this.writeChildNode(c,e,n+1),e.suppressPrettyCount--,e.state=r.CloseTag,this.stream.write("</"+t.name+">");return this.stream.write(this.endline(t,e,n)),e.state=r.None,this.closeNode(t,e,n)},e.prototype.processingInstruction=function(t,i,r){return this.stream.write(e.__super__.processingInstruction.call(this,t,i,r))},e.prototype.raw=function(t,i,r){return this.stream.write(e.__super__.raw.call(this,t,i,r))},e.prototype.text=function(t,i,r){return this.stream.write(e.__super__.text.call(this,t,i,r))},e.prototype.dtdAttList=function(t,i,r){return this.stream.write(e.__super__.dtdAttList.call(this,t,i,r))},e.prototype.dtdElement=function(t,i,r){return this.stream.write(e.__super__.dtdElement.call(this,t,i,r))},e.prototype.dtdEntity=function(t,i,r){return this.stream.write(e.__super__.dtdEntity.call(this,t,i,r))},e.prototype.dtdNotation=function(t,i,r){return this.stream.write(e.__super__.dtdNotation.call(this,t,i,r))},e}(n)}).call(this)},{"./NodeType":498,"./WriterState":500,"./XMLWriterBase":528}],525:[function(t,e,i){(function(){var i,r=function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;i=t("./XMLWriterBase"),e.exports=function(t){function e(t){e.__super__.constructor.call(this,t)}return r(e,t),e.prototype.document=function(t,e){var i,r,n,s,o;for(e=this.filterOptions(e),s="",r=0,n=(o=t.children).length;r<n;r++)i=o[r],s+=this.writeChildNode(i,e,0);return e.pretty&&s.slice(-e.newline.length)===e.newline&&(s=s.slice(0,-e.newline.length)),s},e}(i)}).call(this)},{"./XMLWriterBase":528}],526:[function(t,e,i){(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty;e.exports=function(){function e(e){var r,n,s;for(r in this.assertLegalName=t(this.assertLegalName,this),this.assertLegalChar=t(this.assertLegalChar,this),e||(e={}),this.options=e,this.options.version||(this.options.version="1.0"),n=e.stringify||{})i.call(n,r)&&(s=n[r],this[r]=s)}return e.prototype.name=function(t){return this.options.noValidation?t:this.assertLegalName(""+t||"")},e.prototype.text=function(t){return this.options.noValidation?t:this.assertLegalChar(this.textEscape(""+t||""))},e.prototype.cdata=function(t){return this.options.noValidation?t:(t=(t=""+t||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(t))},e.prototype.comment=function(t){if(this.options.noValidation)return t;if((t=""+t||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+t);return this.assertLegalChar(t)},e.prototype.raw=function(t){return this.options.noValidation?t:""+t||""},e.prototype.attValue=function(t){return this.options.noValidation?t:this.assertLegalChar(this.attEscape(t=""+t||""))},e.prototype.insTarget=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.insValue=function(t){if(this.options.noValidation)return t;if((t=""+t||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+t);return this.assertLegalChar(t)},e.prototype.xmlVersion=function(t){if(this.options.noValidation)return t;if(!(t=""+t||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+t);return t},e.prototype.xmlEncoding=function(t){if(this.options.noValidation)return t;if(!(t=""+t||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+t);return this.assertLegalChar(t)},e.prototype.xmlStandalone=function(t){return this.options.noValidation?t:t?"yes":"no"},e.prototype.dtdPubID=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdSysID=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdElementValue=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdAttType=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdAttDefault=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdEntityValue=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.dtdNData=function(t){return this.options.noValidation?t:this.assertLegalChar(""+t||"")},e.prototype.convertAttKey="@",e.prototype.convertPIKey="?",e.prototype.convertTextKey="#text",e.prototype.convertCDataKey="#cdata",e.prototype.convertCommentKey="#comment",e.prototype.convertRawKey="#raw",e.prototype.assertLegalChar=function(t){var e,i;if(this.options.noValidation)return t;if(e="","1.0"===this.options.version){if(e=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,i=t.match(e))throw new Error("Invalid character in string: "+t+" at index "+i.index)}else if("1.1"===this.options.version&&(e=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,i=t.match(e)))throw new Error("Invalid character in string: "+t+" at index "+i.index);return t},e.prototype.assertLegalName=function(t){var e;if(this.options.noValidation)return t;if(this.assertLegalChar(t),e=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!t.match(e))throw new Error("Invalid character in name");return t},e.prototype.textEscape=function(t){var e;return this.options.noValidation?t:(e=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},e.prototype.attEscape=function(t){var e;return this.options.noValidation?t:(e=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},e}()}).call(this)},{}],527:[function(t,e,i){(function(){var i,r,n=function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=t("./NodeType"),r=t("./XMLCharacterData"),e.exports=function(t){function e(t,r){if(e.__super__.constructor.call(this,t),null==r)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=i.Text,this.value=this.stringify.text(r)}return n(e,t),Object.defineProperty(e.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(e.prototype,"wholeText",{get:function(){var t,e,i;for(i="",e=this.previousSibling;e;)i=e.data+i,e=e.previousSibling;for(i+=this.data,t=this.nextSibling;t;)i+=t.data,t=t.nextSibling;return i}}),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(t){return this.options.writer.text(this,this.options.writer.filterOptions(t))},e.prototype.splitText=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.replaceWholeText=function(t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e}(r)}).call(this)},{"./NodeType":498,"./XMLCharacterData":503}],528:[function(t,e,i){(function(){var i,r,n,s={}.hasOwnProperty;n=t("./Utility").assign,i=t("./NodeType"),t("./XMLDeclaration"),t("./XMLDocType"),t("./XMLCData"),t("./XMLComment"),t("./XMLElement"),t("./XMLRaw"),t("./XMLText"),t("./XMLProcessingInstruction"),t("./XMLDummy"),t("./XMLDTDAttList"),t("./XMLDTDElement"),t("./XMLDTDEntity"),t("./XMLDTDNotation"),r=t("./WriterState"),e.exports=function(){function t(t){var e,i,r;for(e in t||(t={}),this.options=t,i=t.writer||{})s.call(i,e)&&(r=i[e],this["_"+e]=this[e],this[e]=r)}return t.prototype.filterOptions=function(t){var e,i,s,o,a,l,c,h;return t||(t={}),t=n({},this.options,t),(e={writer:this}).pretty=t.pretty||!1,e.allowEmpty=t.allowEmpty||!1,e.indent=null!=(i=t.indent)?i:"  ",e.newline=null!=(s=t.newline)?s:"\n",e.offset=null!=(o=t.offset)?o:0,e.dontPrettyTextNodes=null!=(a=null!=(l=t.dontPrettyTextNodes)?l:t.dontprettytextnodes)?a:0,e.spaceBeforeSlash=null!=(c=null!=(h=t.spaceBeforeSlash)?h:t.spacebeforeslash)?c:"",!0===e.spaceBeforeSlash&&(e.spaceBeforeSlash=" "),e.suppressPrettyCount=0,e.user={},e.state=r.None,e},t.prototype.indent=function(t,e,i){var r;return!e.pretty||e.suppressPrettyCount?"":e.pretty&&(r=(i||0)+e.offset+1)>0?new Array(r).join(e.indent):""},t.prototype.endline=function(t,e,i){return!e.pretty||e.suppressPrettyCount?"":e.newline},t.prototype.attribute=function(t,e,i){var r;return this.openAttribute(t,e,i),r=" "+t.name+'="'+t.value+'"',this.closeAttribute(t,e,i),r},t.prototype.cdata=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<![CDATA[",e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+="]]>"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.comment=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"\x3c!-- ",e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=" --\x3e"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.declaration=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<?xml",e.state=r.InsideTag,n+=' version="'+t.version+'"',null!=t.encoding&&(n+=' encoding="'+t.encoding+'"'),null!=t.standalone&&(n+=' standalone="'+t.standalone+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+"?>",n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.docType=function(t,e,i){var n,s,o,a,l;if(i||(i=0),this.openNode(t,e,i),e.state=r.OpenTag,a=this.indent(t,e,i),a+="<!DOCTYPE "+t.root().name,t.pubID&&t.sysID?a+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(a+=' SYSTEM "'+t.sysID+'"'),t.children.length>0){for(a+=" [",a+=this.endline(t,e,i),e.state=r.InsideTag,s=0,o=(l=t.children).length;s<o;s++)n=l[s],a+=this.writeChildNode(n,e,i+1);e.state=r.CloseTag,a+="]"}return e.state=r.CloseTag,a+=e.spaceBeforeSlash+">",a+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),a},t.prototype.element=function(t,e,n){var o,a,l,c,h,u,d,p,f,_,m,g,y,v;for(f in n||(n=0),_=!1,m="",this.openNode(t,e,n),e.state=r.OpenTag,m+=this.indent(t,e,n)+"<"+t.name,g=t.attribs)s.call(g,f)&&(o=g[f],m+=this.attribute(o,e,n));if(c=0===(l=t.children.length)?null:t.children[0],0===l||t.children.every((function(t){return(t.type===i.Text||t.type===i.Raw)&&""===t.value})))e.allowEmpty?(m+=">",e.state=r.CloseTag,m+="</"+t.name+">"+this.endline(t,e,n)):(e.state=r.CloseTag,m+=e.spaceBeforeSlash+"/>"+this.endline(t,e,n));else if(!e.pretty||1!==l||c.type!==i.Text&&c.type!==i.Raw||null==c.value){if(e.dontPrettyTextNodes)for(h=0,d=(y=t.children).length;h<d;h++)if(((a=y[h]).type===i.Text||a.type===i.Raw)&&null!=a.value){e.suppressPrettyCount++,_=!0;break}for(m+=">"+this.endline(t,e,n),e.state=r.InsideTag,u=0,p=(v=t.children).length;u<p;u++)a=v[u],m+=this.writeChildNode(a,e,n+1);e.state=r.CloseTag,m+=this.indent(t,e,n)+"</"+t.name+">",_&&e.suppressPrettyCount--,m+=this.endline(t,e,n),e.state=r.None}else m+=">",e.state=r.InsideTag,e.suppressPrettyCount++,_=!0,m+=this.writeChildNode(c,e,n+1),e.suppressPrettyCount--,_=!1,e.state=r.CloseTag,m+="</"+t.name+">"+this.endline(t,e,n);return this.closeNode(t,e,n),m},t.prototype.writeChildNode=function(t,e,r){switch(t.type){case i.CData:return this.cdata(t,e,r);case i.Comment:return this.comment(t,e,r);case i.Element:return this.element(t,e,r);case i.Raw:return this.raw(t,e,r);case i.Text:return this.text(t,e,r);case i.ProcessingInstruction:return this.processingInstruction(t,e,r);case i.Dummy:return"";case i.Declaration:return this.declaration(t,e,r);case i.DocType:return this.docType(t,e,r);case i.AttributeDeclaration:return this.dtdAttList(t,e,r);case i.ElementDeclaration:return this.dtdElement(t,e,r);case i.EntityDeclaration:return this.dtdEntity(t,e,r);case i.NotationDeclaration:return this.dtdNotation(t,e,r);default:throw new Error("Unknown XML node type: "+t.constructor.name)}},t.prototype.processingInstruction=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<?",e.state=r.InsideTag,n+=t.target,t.value&&(n+=" "+t.value),e.state=r.CloseTag,n+=e.spaceBeforeSlash+"?>",n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.raw=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i),e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.text=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i),e.state=r.InsideTag,n+=t.value,e.state=r.CloseTag,n+=this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.dtdAttList=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ATTLIST",e.state=r.InsideTag,n+=" "+t.elementName+" "+t.attributeName+" "+t.attributeType,"#DEFAULT"!==t.defaultValueType&&(n+=" "+t.defaultValueType),t.defaultValue&&(n+=' "'+t.defaultValue+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.dtdElement=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ELEMENT",e.state=r.InsideTag,n+=" "+t.name+" "+t.value,e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.dtdEntity=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!ENTITY",e.state=r.InsideTag,t.pe&&(n+=" %"),n+=" "+t.name,t.value?n+=' "'+t.value+'"':(t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),t.nData&&(n+=" NDATA "+t.nData)),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.dtdNotation=function(t,e,i){var n;return this.openNode(t,e,i),e.state=r.OpenTag,n=this.indent(t,e,i)+"<!NOTATION",e.state=r.InsideTag,n+=" "+t.name,t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.pubID?n+=' PUBLIC "'+t.pubID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),e.state=r.CloseTag,n+=e.spaceBeforeSlash+">"+this.endline(t,e,i),e.state=r.None,this.closeNode(t,e,i),n},t.prototype.openNode=function(t,e,i){},t.prototype.closeNode=function(t,e,i){},t.prototype.openAttribute=function(t,e,i){},t.prototype.closeAttribute=function(t,e,i){},t}()}).call(this)},{"./NodeType":498,"./Utility":499,"./WriterState":500,"./XMLCData":502,"./XMLComment":504,"./XMLDTDAttList":509,"./XMLDTDElement":510,"./XMLDTDEntity":511,"./XMLDTDNotation":512,"./XMLDeclaration":513,"./XMLDocType":514,"./XMLDummy":517,"./XMLElement":518,"./XMLProcessingInstruction":522,"./XMLRaw":523,"./XMLText":527}],529:[function(t,e,i){(function(){var i,r,n,s,o,a,l,c,h,u;u=t("./Utility"),c=u.assign,h=u.isFunction,n=t("./XMLDOMImplementation"),s=t("./XMLDocument"),o=t("./XMLDocumentCB"),l=t("./XMLStringWriter"),a=t("./XMLStreamWriter"),i=t("./NodeType"),r=t("./WriterState"),e.exports.create=function(t,e,i,r){var n,o;if(null==t)throw new Error("Root element needs a name.");return r=c({},e,i,r),o=(n=new s(r)).element(t),r.headless||(n.declaration(r),null==r.pubID&&null==r.sysID||n.dtd(r)),o},e.exports.begin=function(t,e,i){var r;return h(t)&&(e=(r=[t,e])[0],i=r[1],t={}),e?new o(t,e,i):new s(t)},e.exports.stringWriter=function(t){return new l(t)},e.exports.streamWriter=function(t,e){return new a(t,e)},e.exports.implementation=new n,e.exports.nodeType=i,e.exports.writerState=r}).call(this)},{"./NodeType":498,"./Utility":499,"./WriterState":500,"./XMLDOMImplementation":507,"./XMLDocument":515,"./XMLDocumentCB":516,"./XMLStreamWriter":524,"./XMLStringWriter":525}],530:[function(t,e,i){e.exports=n;var r=Object.prototype.hasOwnProperty;function n(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)r.call(i,n)&&(t[n]=i[n])}return t}},{}],531:[function(t,e,i){t("core-js/modules/es.array.fill.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/es.array.join.js"),t("core-js/modules/es.array.slice.js");var r=t("buffer").Buffer,n={sha1:t("./sha"),sha256:t("./sha256"),md5:t("./md5")},s=64,o=r.alloc(s);function a(t,e,i){r.isBuffer(e)||(e=r.from(e)),r.isBuffer(i)||(i=r.from(i)),e.length>s?e=t(e):e.length<s&&(e=r.concat([e,o],s));for(var n=r.alloc(s),a=r.alloc(s),l=0;l<s;l++)n[l]=54^e[l],a[l]=92^e[l];var c=t(r.concat([n,i]));return t(r.concat([a,c]))}function l(t,e){var i=n[t=t||"sha1"],s=[];return i||c("algorithm:",t,"is not yet supported"),{update:function(t){return r.isBuffer(t)||(t=r.from(t)),s.push(t),t.length,this},digest:function(t){var n=r.concat(s),o=e?a(i,e,n):i(n);return s=null,t?o.toString(t):o}}}function c(){var t=[].slice.call(arguments).join(" ");throw new Error([t,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}o.fill(0),i.createHash=function(t){return l(t)},i.createHmac=function(t,e){return l(t,e)},i.createCredentials=function(){c("sorry,createCredentials is not implemented yet")},i.createCipher=function(){c("sorry,createCipher is not implemented yet")},i.createCipheriv=function(){c("sorry,createCipheriv is not implemented yet")},i.createDecipher=function(){c("sorry,createDecipher is not implemented yet")},i.createDecipheriv=function(){c("sorry,createDecipheriv is not implemented yet")},i.createSign=function(){c("sorry,createSign is not implemented yet")},i.createVerify=function(){c("sorry,createVerify is not implemented yet")},i.createDiffieHellman=function(){c("sorry,createDiffieHellman is not implemented yet")},i.pbkdf2=function(){c("sorry,pbkdf2 is not implemented yet")}},{"./md5":533,"./sha":534,"./sha256":535,buffer:103,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.fill.js":311,"core-js/modules/es.array.join.js":317,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.regexp.to-string.js":339}],532:[function(t,e,i){t("core-js/modules/es.array.fill.js"),t("core-js/modules/es.array.concat.js");var r=t("buffer").Buffer,n=4,s=r.alloc(n);s.fill(0);var o=8;function a(t,e){if(t.length%n!=0){var i=t.length+(n-t.length%n);t=r.concat([t,s],i)}for(var o=[],a=e?t.readInt32BE:t.readInt32LE,l=0;l<t.length;l+=n)o.push(a.call(t,l));return o}function l(t,e,i){for(var n=r.alloc(e),s=i?n.writeInt32BE:n.writeInt32LE,o=0;o<t.length;o++)s.call(n,t[o],4*o,!0);return n}function c(t,e,i,n){return r.isBuffer(t)||(t=r.from(t)),l(e(a(t,n),t.length*o),i,n)}e.exports={hash:c}},{buffer:103,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.fill.js":311}],533:[function(t,e,i){var r=t("./helpers");function n(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,r=-271733879,n=-1732584194,s=271733878,u=0;u<t.length;u+=16){var d=i,p=r,f=n,_=s;i=o(i,r,n,s,t[u+0],7,-680876936),s=o(s,i,r,n,t[u+1],12,-389564586),n=o(n,s,i,r,t[u+2],17,606105819),r=o(r,n,s,i,t[u+3],22,-1044525330),i=o(i,r,n,s,t[u+4],7,-176418897),s=o(s,i,r,n,t[u+5],12,1200080426),n=o(n,s,i,r,t[u+6],17,-1473231341),r=o(r,n,s,i,t[u+7],22,-45705983),i=o(i,r,n,s,t[u+8],7,1770035416),s=o(s,i,r,n,t[u+9],12,-1958414417),n=o(n,s,i,r,t[u+10],17,-42063),r=o(r,n,s,i,t[u+11],22,-1990404162),i=o(i,r,n,s,t[u+12],7,1804603682),s=o(s,i,r,n,t[u+13],12,-40341101),n=o(n,s,i,r,t[u+14],17,-1502002290),i=a(i,r=o(r,n,s,i,t[u+15],22,1236535329),n,s,t[u+1],5,-165796510),s=a(s,i,r,n,t[u+6],9,-1069501632),n=a(n,s,i,r,t[u+11],14,643717713),r=a(r,n,s,i,t[u+0],20,-373897302),i=a(i,r,n,s,t[u+5],5,-701558691),s=a(s,i,r,n,t[u+10],9,38016083),n=a(n,s,i,r,t[u+15],14,-660478335),r=a(r,n,s,i,t[u+4],20,-405537848),i=a(i,r,n,s,t[u+9],5,568446438),s=a(s,i,r,n,t[u+14],9,-1019803690),n=a(n,s,i,r,t[u+3],14,-187363961),r=a(r,n,s,i,t[u+8],20,1163531501),i=a(i,r,n,s,t[u+13],5,-1444681467),s=a(s,i,r,n,t[u+2],9,-51403784),n=a(n,s,i,r,t[u+7],14,1735328473),i=l(i,r=a(r,n,s,i,t[u+12],20,-1926607734),n,s,t[u+5],4,-378558),s=l(s,i,r,n,t[u+8],11,-2022574463),n=l(n,s,i,r,t[u+11],16,1839030562),r=l(r,n,s,i,t[u+14],23,-35309556),i=l(i,r,n,s,t[u+1],4,-1530992060),s=l(s,i,r,n,t[u+4],11,1272893353),n=l(n,s,i,r,t[u+7],16,-155497632),r=l(r,n,s,i,t[u+10],23,-1094730640),i=l(i,r,n,s,t[u+13],4,681279174),s=l(s,i,r,n,t[u+0],11,-358537222),n=l(n,s,i,r,t[u+3],16,-722521979),r=l(r,n,s,i,t[u+6],23,76029189),i=l(i,r,n,s,t[u+9],4,-640364487),s=l(s,i,r,n,t[u+12],11,-421815835),n=l(n,s,i,r,t[u+15],16,530742520),i=c(i,r=l(r,n,s,i,t[u+2],23,-995338651),n,s,t[u+0],6,-198630844),s=c(s,i,r,n,t[u+7],10,1126891415),n=c(n,s,i,r,t[u+14],15,-1416354905),r=c(r,n,s,i,t[u+5],21,-57434055),i=c(i,r,n,s,t[u+12],6,1700485571),s=c(s,i,r,n,t[u+3],10,-1894986606),n=c(n,s,i,r,t[u+10],15,-1051523),r=c(r,n,s,i,t[u+1],21,-2054922799),i=c(i,r,n,s,t[u+8],6,1873313359),s=c(s,i,r,n,t[u+15],10,-30611744),n=c(n,s,i,r,t[u+6],15,-1560198380),r=c(r,n,s,i,t[u+13],21,1309151649),i=c(i,r,n,s,t[u+4],6,-145523070),s=c(s,i,r,n,t[u+11],10,-1120210379),n=c(n,s,i,r,t[u+2],15,718787259),r=c(r,n,s,i,t[u+9],21,-343485551),i=h(i,d),r=h(r,p),n=h(n,f),s=h(s,_)}return Array(i,r,n,s)}function s(t,e,i,r,n,s){return h(u(h(h(e,t),h(r,s)),n),i)}function o(t,e,i,r,n,o,a){return s(e&i|~e&r,t,e,n,o,a)}function a(t,e,i,r,n,o,a){return s(e&r|i&~r,t,e,n,o,a)}function l(t,e,i,r,n,o,a){return s(e^i^r,t,e,n,o,a)}function c(t,e,i,r,n,o,a){return s(i^(e|~r),t,e,n,o,a)}function h(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function u(t,e){return t<<e|t>>>32-e}e.exports=function(t){return r.hash(t,n,16)}},{"./helpers":532}],534:[function(t,e,i){var r=t("./helpers");function n(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var i=Array(80),r=1732584193,n=-271733879,c=-1732584194,h=271733878,u=-1009589776,d=0;d<t.length;d+=16){for(var p=r,f=n,_=c,m=h,g=u,y=0;y<80;y++){i[y]=y<16?t[d+y]:l(i[y-3]^i[y-8]^i[y-14]^i[y-16],1);var v=a(a(l(r,5),s(y,n,c,h)),a(a(u,i[y]),o(y)));u=h,h=c,c=l(n,30),n=r,r=v}r=a(r,p),n=a(n,f),c=a(c,_),h=a(h,m),u=a(u,g)}return Array(r,n,c,h,u)}function s(t,e,i,r){return t<20?e&i|~e&r:t<40?e^i^r:t<60?e&i|e&r|i&r:e^i^r}function o(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function a(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function l(t,e){return t<<e|t>>>32-e}e.exports=function(t){return r.hash(t,n,20,!0)}},{"./helpers":532}],535:[function(t,e,i){var r=t("./helpers"),n=function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i},s=function(t,e){return t>>>e|t<<32-e},o=function(t,e){return t>>>e},a=function(t,e,i){return t&e^~t&i},l=function(t,e,i){return t&e^t&i^e&i},c=function(t){return s(t,2)^s(t,13)^s(t,22)},h=function(t){return s(t,6)^s(t,11)^s(t,25)},u=function(t){return s(t,7)^s(t,18)^o(t,3)},d=function(t){return s(t,17)^s(t,19)^o(t,10)},p=function(t,e){var i,r,s,o,p,f,_,m,g,y,v=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),b=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),x=new Array(64);t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var T=0;T<t.length;T+=16){i=b[0],r=b[1],s=b[2],o=b[3],p=b[4],f=b[5],_=b[6],m=b[7];for(var C=0;C<64;C++)x[C]=C<16?t[C+T]:n(n(n(d(x[C-2]),x[C-7]),u(x[C-15])),x[C-16]),g=n(n(n(n(m,h(p)),a(p,f,_)),v[C]),x[C]),y=n(c(i),l(i,r,s)),m=_,_=f,f=p,p=n(o,g),o=s,s=r,r=i,i=n(g,y);b[0]=n(i,b[0]),b[1]=n(r,b[1]),b[2]=n(s,b[2]),b[3]=n(o,b[3]),b[4]=n(p,b[4]),b[5]=n(f,b[5]),b[6]=n(_,b[6]),b[7]=n(m,b[7])}return b};e.exports=function(t){return r.hash(t,p,32,!0)}},{"./helpers":532}],536:[function(t,e,i){e.exports=function(){return function(){}}},{}],537:[function(t,e,i){(function(i){(function(){var r=t("@babel/runtime/helpers/interopRequireDefault")(t("@babel/runtime/helpers/typeof")),n=t("stream").Stream,s=t("../lib/common/utils/isArray").isArray;function o(t){return t instanceof n}e.exports.string=function(t){return"string"==typeof t},e.exports.array=s,e.exports.buffer=i.isBuffer,e.exports.writableStream=function(t){return o(t)&&"function"==typeof t._write&&"object"===(0,r.default)(t._writableState)}}).call(this)}).call(this,{isBuffer:t("../node_modules/is-buffer/index.js")})},{"../lib/common/utils/isArray":67,"../node_modules/is-buffer/index.js":409,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,stream:468}],538:[function(t,e,i){var r=t("immediate"),n=e.exports={};function s(){}n.nextTick=r,n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=s,n.addListener=s,n.once=s,n.off=s,n.removeListener=s,n.removeAllListeners=s,n.emit=s,n.prependListener=s,n.prependOnceListener=s,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{immediate:401}],539:[function(t,e,r){(function(e){(function(){t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.search.js");var i=t("./lib/request"),n=t("./lib/response"),s=t("xtend"),o=t("builtin-status-codes"),a=t("url"),l=r;l.request=function(t,r){t="string"==typeof t?a.parse(t):s(t);var n=-1===e.location.protocol.search(/^https?:$/)?"http:":"",o=t.protocol||n,l=t.hostname||t.host,c=t.port,h=t.path||"/";l&&-1!==l.indexOf(":")&&(l="["+l+"]"),t.url=(l?o+"//"+l:"")+(c?":"+c:"")+h,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var u=new i(t);return r&&u.on("response",r),u},l.get=function(t,e){var i=l.request(t,e);return i.end(),i},l.ClientRequest=i,l.IncomingMessage=n.IncomingMessage,l.Agent=function(){},l.Agent.defaultMaxSockets=4,l.globalAgent=new l.Agent,l.STATUS_CODES=o,l.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":541,"./lib/response":542,"builtin-status-codes":104,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.search.js":346,url:543,xtend:530}],540:[function(t,r,n){(function(i){(function(){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.array-buffer.constructor.js"),t("core-js/modules/es.array-buffer.slice.js"),t("core-js/modules/es.array.slice.js"),n.fetch=c(i.fetch)&&c(i.ReadableStream),n.writableStream=c(i.WritableStream),n.abortController=c(i.AbortController),n.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),n.blobConstructor=!0}catch(e){}var r;function s(){if(void 0!==r)return r;if(i.XMLHttpRequest){r=new i.XMLHttpRequest;try{r.open("GET",i.XDomainRequest?"/":"https://example.com")}catch(e){r=null}}else r=null;return r}function o(t){var i=s();if(!i)return!1;try{return i.responseType=t,i.responseType===t}catch(e){}return!1}var a=void 0!==i.ArrayBuffer,l=a&&c(i.ArrayBuffer.prototype.slice);function c(t){return"function"==typeof t}n.arraybuffer=n.fetch||a&&o("arraybuffer"),n.msstream=!n.fetch&&l&&o("ms-stream"),n.mozchunkedarraybuffer=!n.fetch&&a&&o("moz-chunked-arraybuffer"),n.overrideMimeType=n.fetch||!!s()&&c(s().overrideMimeType),n.vbArray=c(i.VBArray),r=null}).call(this)}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"core-js/modules/es.array-buffer.constructor.js":308,"core-js/modules/es.array-buffer.slice.js":309,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333}],541:[function(t,r,n){(function(i,n,s){(function(){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.regexp.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.array.map.js"),t("core-js/modules/es.function.name.js"),t("core-js/modules/es.promise.js");var o=t("./capability"),a=t("inherits"),l=t("./response"),c=t("readable-stream"),h=t("to-arraybuffer"),u=l.IncomingMessage,d=l.readyStates;function p(t,e){return o.fetch&&e?"fetch":o.mozchunkedarraybuffer?"moz-chunked-arraybuffer":o.msstream?"ms-stream":o.arraybuffer&&t?"arraybuffer":o.vbArray&&t?"text:vbarray":"text"}var f=r.exports=function(t){var e,i=this;c.Writable.call(i),i._opts=t,i._body=[],i._headers={},t.auth&&i.setHeader("Authorization","Basic "+new s(t.auth).toString("base64")),Object.keys(t.headers).forEach((function(e){i.setHeader(e,t.headers[e])}));var r=!0;if("disable-fetch"===t.mode||"requestTimeout"in t&&!o.abortController)r=!1,e=!0;else if("prefer-streaming"===t.mode)e=!1;else if("allow-wrong-content-type"===t.mode)e=!o.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");e=!0}i._mode=p(e,r),i._fetchTimer=null,i.on("finish",(function(){i._onFinish()}))};function _(t){try{var i=t.status;return null!==i&&0!==i}catch(e){return!1}}a(f,c.Writable),f.prototype.setHeader=function(t,e){var i=this,r=t.toLowerCase();-1===m.indexOf(r)&&(i._headers[r]={name:t,value:e})},f.prototype.getHeader=function(t){var e=this._headers[t.toLowerCase()];return e?e.value:null},f.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},f.prototype._onFinish=function(){var t=this;if(!t._destroyed){var e=t._opts,r=t._headers,a=null;"GET"!==e.method&&"HEAD"!==e.method&&(a=o.arraybuffer?h(s.concat(t._body)):o.blobConstructor?new n.Blob(t._body.map((function(t){return h(t)})),{type:(r["content-type"]||{}).value||""}):s.concat(t._body).toString());var l=[];if(Object.keys(r).forEach((function(t){var e=r[t].name,i=r[t].value;Array.isArray(i)?i.forEach((function(t){l.push([e,t])})):l.push([e,i])})),"fetch"===t._mode){var c=null;if(o.abortController){var u=new AbortController;c=u.signal,t._fetchAbortController=u,"requestTimeout"in e&&0!==e.requestTimeout&&(t._fetchTimer=n.setTimeout((function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()}),e.requestTimeout))}n.fetch(t._opts.url,{method:t._opts.method,headers:l,body:a||void 0,mode:"cors",credentials:e.withCredentials?"include":"same-origin",signal:c}).then((function(e){t._fetchResponse=e,t._connect()}),(function(e){n.clearTimeout(t._fetchTimer),t._destroyed||t.emit("error",e)}))}else{var p=t._xhr=new n.XMLHttpRequest;try{p.open(t._opts.method,t._opts.url,!0)}catch(f){return void i.nextTick((function(){t.emit("error",f)}))}"responseType"in p&&(p.responseType=t._mode.split(":")[0]),"withCredentials"in p&&(p.withCredentials=!!e.withCredentials),"text"===t._mode&&"overrideMimeType"in p&&p.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in e&&(p.timeout=e.requestTimeout,p.ontimeout=function(){t.emit("requestTimeout")}),l.forEach((function(t){p.setRequestHeader(t[0],t[1])})),t._response=null,p.onreadystatechange=function(){switch(p.readyState){case d.LOADING:case d.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(p.onprogress=function(){t._onXHRProgress()}),p.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{p.send(a)}catch(f){return void i.nextTick((function(){t.emit("error",f)}))}}}},f.prototype._onXHRProgress=function(){var t=this;_(t._xhr)&&!t._destroyed&&(t._response||t._connect(),t._response._onXHRProgress())},f.prototype._connect=function(){var t=this;t._destroyed||(t._response=new u(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on("error",(function(e){t.emit("error",e)})),t.emit("response",t._response))},f.prototype._write=function(t,e,i){this._body.push(t),i()},f.prototype.abort=f.prototype.destroy=function(){var t=this;t._destroyed=!0,n.clearTimeout(t._fetchTimer),t._response&&(t._response._destroyed=!0),t._xhr?t._xhr.abort():t._fetchAbortController&&t._fetchAbortController.abort()},f.prototype.end=function(t,e,i){var r=this;"function"==typeof t&&(i=t,t=void 0),c.Writable.prototype.end.call(r,t,e,i)},f.prototype.flushHeaders=function(){},f.prototype.setTimeout=function(){},f.prototype.setNoDelay=function(){},f.prototype.setSocketKeepAlive=function(){};var m=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{"./capability":540,"./response":542,_process:538,buffer:103,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.map.js":318,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.to-string.js":339,"core-js/modules/web.dom-collections.for-each.js":380,inherits:407,"readable-stream":463,"to-arraybuffer":485}],542:[function(t,r,n){(function(i,r,s){(function(){t("core-js/modules/es.object.to-string.js"),t("core-js/modules/web.dom-collections.for-each.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.split.js"),t("core-js/modules/es.string.match.js"),t("core-js/modules/es.array.iterator.js"),t("core-js/modules/es.array-buffer.slice.js"),t("core-js/modules/es.typed-array.uint8-array.js"),t("core-js/modules/es.typed-array.copy-within.js"),t("core-js/modules/es.typed-array.every.js"),t("core-js/modules/es.typed-array.fill.js"),t("core-js/modules/es.typed-array.filter.js"),t("core-js/modules/es.typed-array.find.js"),t("core-js/modules/es.typed-array.find-index.js"),t("core-js/modules/es.typed-array.for-each.js"),t("core-js/modules/es.typed-array.includes.js"),t("core-js/modules/es.typed-array.index-of.js"),t("core-js/modules/es.typed-array.iterator.js"),t("core-js/modules/es.typed-array.join.js"),t("core-js/modules/es.typed-array.last-index-of.js"),t("core-js/modules/es.typed-array.map.js"),t("core-js/modules/es.typed-array.reduce.js"),t("core-js/modules/es.typed-array.reduce-right.js"),t("core-js/modules/es.typed-array.reverse.js"),t("core-js/modules/es.typed-array.set.js"),t("core-js/modules/es.typed-array.slice.js"),t("core-js/modules/es.typed-array.some.js"),t("core-js/modules/es.typed-array.sort.js"),t("core-js/modules/es.typed-array.subarray.js"),t("core-js/modules/es.typed-array.to-locale-string.js"),t("core-js/modules/es.typed-array.to-string.js"),t("core-js/modules/es.array.slice.js");var o=t("./capability"),a=t("inherits"),l=t("readable-stream"),c=n.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},h=n.IncomingMessage=function(t,n,a,c){var h=this;if(l.Readable.call(h),h._mode=a,h.headers={},h.rawHeaders=[],h.trailers={},h.rawTrailers=[],h.on("end",(function(){i.nextTick((function(){h.emit("close")}))})),"fetch"===a){var u=function t(){p.read().then((function(e){if(!h._destroyed){if(e.done)return r.clearTimeout(c),void h.push(null);h.push(new s(e.value)),t()}})).catch((function(t){r.clearTimeout(c),h._destroyed||h.emit("error",t)}))};if(h._fetchResponse=n,h.url=n.url,h.statusCode=n.status,h.statusMessage=n.statusText,n.headers.forEach((function(t,e){h.headers[e.toLowerCase()]=t,h.rawHeaders.push(e,t)})),o.writableStream){var d=new WritableStream({write:function(t){return new Promise((function(e,i){h._destroyed?i():h.push(new s(t))?e():h._resumeFetch=e}))},close:function(){r.clearTimeout(c),h._destroyed||h.push(null)},abort:function(t){h._destroyed||h.emit("error",t)}});try{return void n.body.pipeTo(d).catch((function(t){r.clearTimeout(c),h._destroyed||h.emit("error",t)}))}catch(e){}}var p=n.body.getReader();u()}else if(h._xhr=t,h._pos=0,h.url=t.responseURL,h.statusCode=t.status,h.statusMessage=t.statusText,t.getAllResponseHeaders().split(/\r?\n/).forEach((function(t){var e=t.match(/^([^:]+):\s*(.*)/);if(e){var i=e[1].toLowerCase();"set-cookie"===i?(void 0===h.headers[i]&&(h.headers[i]=[]),h.headers[i].push(e[2])):void 0!==h.headers[i]?h.headers[i]+=", "+e[2]:h.headers[i]=e[2],h.rawHeaders.push(e[1],e[2])}})),h._charset="x-user-defined",!o.overrideMimeType){var f=h.rawHeaders["mime-type"];if(f){var _=f.match(/;\s*charset=([^;])(;|$)/);_&&(h._charset=_[1].toLowerCase())}h._charset||(h._charset="utf-8")}};a(h,l.Readable),h.prototype._read=function(){var t=this,e=t._resumeFetch;e&&(t._resumeFetch=null,e())},h.prototype._onXHRProgress=function(){var t=this,i=t._xhr,n=null;switch(t._mode){case"text:vbarray":if(i.readyState!==c.DONE)break;try{n=new r.VBArray(i.responseBody).toArray()}catch(e){}if(null!==n){t.push(new s(n));break}case"text":try{n=i.responseText}catch(e){t._mode="text:vbarray";break}if(n.length>t._pos){var o=n.substr(t._pos);if("x-user-defined"===t._charset){for(var a=new s(o.length),l=0;l<o.length;l++)a[l]=255&o.charCodeAt(l);t.push(a)}else t.push(o,t._charset);t._pos=n.length}break;case"arraybuffer":if(i.readyState!==c.DONE||!i.response)break;n=i.response,t.push(new s(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=i.response,i.readyState!==c.LOADING||!n)break;t.push(new s(new Uint8Array(n)));break;case"ms-stream":if(n=i.response,i.readyState!==c.LOADING)break;var h=new r.MSStreamReader;h.onprogress=function(){h.result.byteLength>t._pos&&(t.push(new s(new Uint8Array(h.result.slice(t._pos)))),t._pos=h.result.byteLength)},h.onload=function(){t.push(null)},h.readAsArrayBuffer(n)}t._xhr.readyState===c.DONE&&"ms-stream"!==t._mode&&t.push(null)}}).call(this)}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{"./capability":540,_process:538,buffer:103,"core-js/modules/es.array-buffer.slice.js":309,"core-js/modules/es.array.iterator.js":316,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.match.js":344,"core-js/modules/es.string.split.js":347,"core-js/modules/es.typed-array.copy-within.js":356,"core-js/modules/es.typed-array.every.js":357,"core-js/modules/es.typed-array.fill.js":358,"core-js/modules/es.typed-array.filter.js":359,"core-js/modules/es.typed-array.find-index.js":360,"core-js/modules/es.typed-array.find.js":361,"core-js/modules/es.typed-array.for-each.js":362,"core-js/modules/es.typed-array.includes.js":363,"core-js/modules/es.typed-array.index-of.js":364,"core-js/modules/es.typed-array.iterator.js":365,"core-js/modules/es.typed-array.join.js":366,"core-js/modules/es.typed-array.last-index-of.js":367,"core-js/modules/es.typed-array.map.js":368,"core-js/modules/es.typed-array.reduce-right.js":369,"core-js/modules/es.typed-array.reduce.js":370,"core-js/modules/es.typed-array.reverse.js":371,"core-js/modules/es.typed-array.set.js":372,"core-js/modules/es.typed-array.slice.js":373,"core-js/modules/es.typed-array.some.js":374,"core-js/modules/es.typed-array.sort.js":375,"core-js/modules/es.typed-array.subarray.js":376,"core-js/modules/es.typed-array.to-locale-string.js":377,"core-js/modules/es.typed-array.to-string.js":378,"core-js/modules/es.typed-array.uint8-array.js":379,"core-js/modules/web.dom-collections.for-each.js":380,inherits:407,"readable-stream":463}],543:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault")(t("@babel/runtime/helpers/typeof"));t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.string.search.js"),t("core-js/modules/es.array.concat.js"),t("core-js/modules/es.string.split.js"),t("core-js/modules/es.string.replace.js"),t("core-js/modules/es.array.join.js"),t("core-js/modules/es.string.trim.js"),t("core-js/modules/es.string.match.js"),t("core-js/modules/es.array.slice.js"),t("core-js/modules/es.object.keys.js"),t("core-js/modules/es.array.splice.js");var n=t("punycode"),s=t("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}i.parse=x,i.resolve=C,i.resolveObject=S,i.format=T,i.Url=o;var a=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(h),d=["%","/","?",";","#"].concat(u),p=["/","?","#"],f=255,_=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=t("querystring");function x(t,e,i){if(t&&s.isObject(t)&&t instanceof o)return t;var r=new o;return r.parse(t,e,i),r}function T(t){return s.isString(t)&&(t=x(t)),t instanceof o?t.format():o.prototype.format.call(t)}function C(t,e){return x(t,!1,!0).resolve(e)}function S(t,e){return t?x(t,!1,!0).resolveObject(e):e}o.prototype.parse=function(t,e,i){if(!s.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+(0,r.default)(t));var o=t.indexOf("?"),l=-1!==o&&o<t.indexOf("#")?"?":"#",h=t.split(l),x=/\\/g;h[0]=h[0].replace(x,"/");var T=t=h.join(l);if(T=T.trim(),!i&&1===t.split("#").length){var C=c.exec(T);if(C)return this.path=T,this.href=T,this.pathname=C[1],C[2]?(this.search=C[2],this.query=e?b.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var S=a.exec(T);if(S){var w=(S=S[0]).toLowerCase();this.protocol=w,T=T.substr(S.length)}if(i||S||T.match(/^\/\/[^@\/]+@[^@\/]+/)){var A="//"===T.substr(0,2);!A||S&&y[S]||(T=T.substr(2),this.slashes=!0)}if(!y[S]&&(A||S&&!v[S])){for(var E,D,L=-1,I=0;I<p.length;I++)-1!==(P=T.indexOf(p[I]))&&(-1===L||P<L)&&(L=P);for(-1!==(D=-1===L?T.lastIndexOf("@"):T.lastIndexOf("@",L))&&(E=T.slice(0,D),T=T.slice(D+1),this.auth=decodeURIComponent(E)),L=-1,I=0;I<d.length;I++){var P;-1!==(P=T.indexOf(d[I]))&&(-1===L||P<L)&&(L=P)}-1===L&&(L=T.length),this.host=T.slice(0,L),T=T.slice(L),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var R=this.hostname.split("."),O=(I=0,R.length);I<O;I++){var B=R[I];if(B&&!B.match(_)){for(var N="",k=0,F=B.length;k<F;k++)B.charCodeAt(k)>127?N+="x":N+=B[k];if(!N.match(_)){var V=R.slice(0,I),j=R.slice(I+1),G=B.match(m);G&&(V.push(G[1]),j.unshift(G[2])),j.length&&(T="/"+j.join(".")+T),this.hostname=V.join(".");break}}}this.hostname.length>f?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=n.toASCII(this.hostname));var U=this.port?":"+this.port:"",Y=this.hostname||"";this.host=Y+U,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==T[0]&&(T="/"+T))}if(!g[w])for(I=0,O=u.length;I<O;I++){var H=u[I];if(-1!==T.indexOf(H)){var X=encodeURIComponent(H);X===H&&(X=escape(H)),T=T.split(H).join(X)}}var z=T.indexOf("#");-1!==z&&(this.hash=T.substr(z),T=T.slice(0,z));var W=T.indexOf("?");if(-1!==W?(this.search=T.substr(W),this.query=T.substr(W+1),e&&(this.query=b.parse(this.query)),T=T.slice(0,W)):e&&(this.search="",this.query={}),T&&(this.pathname=T),v[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var Z=this.search||"";this.path=U+Z}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=b.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||v[e])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+r},o.prototype.resolve=function(t){return this.resolveObject(x(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(s.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var i=new o,r=Object.keys(this),n=0;n<r.length;n++){var a=r[n];i[a]=this[a]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),c=0;c<l.length;c++){var h=l[c];"protocol"!==h&&(i[h]=t[h])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!v[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var p=u[d];i[p]=t[p]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||y[t.protocol])i.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),i.pathname=f.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var _=i.pathname||"",m=i.search||"";i.path=_+m}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var g=i.pathname&&"/"===i.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=b||g||i.host&&t.pathname,T=x,C=i.pathname&&i.pathname.split("/")||[],S=(f=t.pathname&&t.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(S&&(i.hostname="",i.port=null,i.host&&(""===C[0]?C[0]=i.host:C.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),x=x&&(""===f[0]||""===C[0])),b)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,C=f;else if(f.length)C||(C=[]),C.pop(),C=C.concat(f),i.search=t.search,i.query=t.query;else if(!s.isNullOrUndefined(t.search))return S&&(i.hostname=i.host=C.shift(),(L=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=L.shift(),i.host=i.hostname=L.shift())),i.search=t.search,i.query=t.query,s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!C.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var w=C.slice(-1)[0],A=(i.host||t.host||C.length>1)&&("."===w||".."===w)||""===w,E=0,D=C.length;D>=0;D--)"."===(w=C[D])?C.splice(D,1):".."===w?(C.splice(D,1),E++):E&&(C.splice(D,1),E--);if(!x&&!T)for(;E--;E)C.unshift("..");!x||""===C[0]||C[0]&&"/"===C[0].charAt(0)||C.unshift(""),A&&"/"!==C.join("/").substr(-1)&&C.push("");var L,I=""===C[0]||C[0]&&"/"===C[0].charAt(0);return S&&(i.hostname=i.host=I?"":C.length?C.shift():"",(L=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=L.shift(),i.host=i.hostname=L.shift())),(x=x||i.host&&C.length)&&!I&&C.unshift(""),C.length?i.pathname=C.join("/"):(i.pathname=null,i.path=null),s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},o.prototype.parseHost=function(){var t=this.host,e=l.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":544,"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.array.join.js":317,"core-js/modules/es.array.slice.js":319,"core-js/modules/es.array.splice.js":321,"core-js/modules/es.object.keys.js":328,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.match.js":344,"core-js/modules/es.string.replace.js":345,"core-js/modules/es.string.search.js":346,"core-js/modules/es.string.split.js":347,"core-js/modules/es.string.trim.js":349,punycode:443,querystring:451}],544:[function(t,e,i){var r=t("@babel/runtime/helpers/interopRequireDefault")(t("@babel/runtime/helpers/typeof"));e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"===(0,r.default)(t)&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91}],545:[function(t,i,r){t("core-js/modules/es.number.constructor.js"),r.encodeURIComponent=function(t){try{return encodeURIComponent(t)}catch(e){return t}},r.escape=t("escape-html"),r.timestamp=function(t){if(t){var e=t;return"string"==typeof e&&(e=Number(e)),10===String(t).length&&(e*=1e3),new Date(e)}return Math.round(Date.now()/1e3)}},{"core-js/modules/es.number.constructor.js":324,"escape-html":385}],546:[function(t,i,r){(function(i,n){(function(){var s=t("@babel/runtime/helpers/interopRequireDefault")(t("@babel/runtime/helpers/typeof"));t("core-js/modules/es.string.trim.js"),t("core-js/modules/es.object.to-string.js"),t("core-js/modules/es.promise.js"),t("core-js/modules/es.regexp.exec.js"),t("core-js/modules/es.function.name.js"),t("core-js/modules/es.array.concat.js");var o=t("util"),a=t("url"),l=t("http"),c=t("https"),h=t("debug")("urllib"),u=t("humanize-ms"),d=0,p=Math.pow(2,31)-10,f=/^https?:\/\//i;function _(t,e){return void 0===t?e:t}function m(t){return t?t.split(";")[0].trim().toLowerCase():""}function g(t,e){return function(i,r,n){if(i)return e(i);t({data:r,status:n.statusCode,headers:n.headers,res:n})}}r.TIMEOUTS=[u("300s"),u("300s")];var y=["json","text"];r.request=function(t,e,i){return 2===arguments.length&&"function"==typeof e&&(i=e,e=null),"function"==typeof i?r.requestWithCallback(t,e,i):new Promise((function(i,n){r.requestWithCallback(t,e,g(i,n))}))},r.requestWithCallback=function(t,g,v){if(!t||"string"!=typeof t&&"object"!==(0,s.default)(t)){var b=o.format("expect request url to be a string or a http request options, but got %j",t);throw new Error(b)}2===arguments.length&&"function"==typeof g&&(v=g,g=null),d>=p&&(d=0);var x=++d;(g=g||{}).requestUrls=g.requestUrls||[];var T={requestId:x,url:t,args:g,ctx:g.ctx};g.emitter&&g.emitter.emit("request",T),g.timeout=g.timeout||r.TIMEOUTS,g.maxRedirects=g.maxRedirects||10,g.streaming=g.streaming||g.customResponse;var C,S=Date.now();"string"==typeof t?(f.test(t)||(t="https://"+t),C=a.parse(t)):C=t;var w=(g.type||g.method||C.method||"GET").toUpperCase(),A=C.port||80,E=l,D=_(g.agent,r.agent),L=g.fixJSONCtlChars;"https:"===C.protocol&&(E=c,D=_(g.httpsAgent,r.httpsAgent),C.port||(A=443));var I={host:C.hostname||C.host||"localhost",path:C.path||"/",method:w,port:A,agent:D,headers:g.headers||{},lookup:g.lookup};Array.isArray(g.timeout)?I.requestTimeout=g.timeout[g.timeout.length-1]:void 0!==g.timeout&&(I.requestTimeout=g.timeout);var P=g.auth||C.auth;P&&(I.auth=P);var M=g.content||g.data,R="GET"===w||"HEAD"===w||g.dataAsQueryString;if(!g.content&&M&&"string"!=typeof M&&!n.isBuffer(M))if(R)M=g.nestedQuerystring?qs.stringify(M):querystring.stringify(M);else{var O=I.headers["Content-Type"]||I.headers["content-type"];O||(O="json"===g.contentType?"application/json":"application/x-www-form-urlencoded",I.headers["Content-Type"]=O),M="application/json"===m(O)?JSON.stringify(M):g.nestedQuerystring?qs.stringify(M):querystring.stringify(M)}R&&M&&(I.path+=(C.query?"&":"?")+M,M=null);var B=0;if(M){var N=M.length;n.isBuffer(M)||(N=n.byteLength(M)),B=I.headers["Content-Length"]=N}"json"===g.dataType&&(I.headers.Accept="application/json"),"function"==typeof g.beforeRequest&&g.beforeRequest(I);var k=null,F=null,V=null,j=!1,G=!1,U=0,Y=-1,H=!1,X="",z="",W=null;function Z(){k&&(clearTimeout(k),k=null)}function J(){F&&(clearTimeout(F),F=null)}function q(e,r,n){if(J(),!v)return console.warn("[urllib:warn] [%s] [%s] [worker:%s] %s %s callback twice!!!",Date(),x,i.pid,I.method,t),void(e&&console.warn("[urllib:warn] [%s] [%s] [worker:%s] %s: %s\nstack: %s",Date(),x,i.pid,e.name,e.message,e.stack));var s=v;v=null;var o={};n&&(Y=n.statusCode,o=n.headers);var a=Date.now()-S;W&&(W.contentDownload=a),h("[%sms] done, %s bytes HTTP %s %s %s %s, keepAliveSocket: %s, timing: %j",a,U,Y,I.method,I.host,I.path,G,W);var l={status:Y,statusCode:Y,headers:o,size:U,aborted:H,rt:a,keepAliveSocket:G,data:r,requestUrls:g.requestUrls,timing:W,remoteAddress:X,remotePort:z};if(e){var c="";D&&"function"==typeof D.getCurrentStatus&&(c=", agent status: "+JSON.stringify(D.getCurrentStatus())),e.message+=", "+I.method+" "+t+" "+Y+" (connected: "+j+", keepalive socket: "+G+c+")\nheaders: "+JSON.stringify(o),e.data=r,e.path=I.path,e.status=Y,e.headers=o,e.res=l}s(e,r,g.streaming?n:l),g.emitter&&(T.url=t,T.socket=et&&et.connection,T.options=I,T.size=B,g.emitter.emit("response",{requestId:x,error:e,ctx:g.ctx,req:T,res:l}))}function K(e){var i=null;if(g.followRedirect&&statuses.redirect[e.statusCode]){g._followRedirectCount=(g._followRedirectCount||0)+1;var n=e.headers.location;if(n){if(!(g._followRedirectCount>g.maxRedirects)){var s=g.formatRedirectUrl?g.formatRedirectUrl(t,n):a.resolve(t,n);h("Request#%d %s: `redirected` from %s to %s",x,I.path,t,s),J(),g.headers&&g.headers.Host&&f.test(n)&&(g.headers.Host=null);var o=v;return v=null,r.requestWithCallback(s,g,o),{redirect:!0,error:null}}(i=new Error("Exceeded maxRedirects. Probably stuck in a redirect loop "+t)).name="MaxRedirectError"}else(i=new Error("Got statusCode "+e.statusCode+" but cannot resolve next location from headers")).name="FollowRedirectError"}return{redirect:!1,error:i}}function Q(t,e,i){return i(null,e,t.headers["content-encoding"])}g.timing&&(W={queuing:0,dnslookup:0,connected:0,requestSent:0,waiting:0,contentDownload:0}),g.gzip&&(I.headers["Accept-Encoding"]||I.headers["accept-encoding"]||(I.headers["Accept-Encoding"]="gzip"));var $,tt,et,it=g.writeStream;function rt(i){if(W&&(W.waiting=Date.now()-S),h("Request#%d %s `req response` event emit: status %d, headers: %j",x,t,i.statusCode,i.headers),g.streaming){var r=K(i);return r.redirect?void i.resume():r.error?(i.resume(),q(r.error,null,i)):q(null,null,i)}if(i.on("close",(function(){h("Request#%d %s: `res close` event emit, total size %d",x,t,U)})),i.on("error",(function(){h("Request#%d %s: `res error` event emit, total size %d",x,t,U)})),i.on("aborted",(function(){H=!0,h("Request#%d %s: `res aborted` event emit, total size %d",x,t,U)})),it){var s=K(i);return s.redirect?void i.resume():s.error?(i.resume(),it.end(),q(s.error,null,i)):(!1===g.consumeWriteStream?i.on("end",q.bind(null,null,null,i)):it.on("close",(function(){h("Request#%d %s: writeStream close event emitted",x,t),q(V||null,null,i)})),i.pipe(it))}var o=[];i.on("data",(function(e){h("Request#%d %s: `res data` event emit, size %d",x,t,e.length),U+=e.length,o.push(e)})),i.on("end",(function(){var r=n.concat(o,U);if(h("Request#%d %s: `res end` event emit, total size %d, _dumped: %s",x,t,U,i._dumped),V)return q(V,r,i);var s=K(i);if(s.error)return q(s.error,r,i);s.redirect||Q(i,r,(function(n,s,o){if(n)return q(n,r,i);if(!o&&y.indexOf(g.dataType)>=0){try{s=decodeBodyByCharset(s,i)}catch(e){return h("decodeBodyByCharset error: %s",e),q(null,s,i)}if("json"===g.dataType)if(0===U)s=null;else{var a=parseJSON(s,L);a.error?n=a.error:s=a.data}}H&&h("Request#%d %s: Remote socket was terminated before `response.end()` was called",x,t),q(n,s,i)}))}))}function nt(){h("Connect timer ticking, timeout: %d",$),k=setTimeout((function(){k=null,-1===Y&&(Y=-2);var e="Connect timeout for "+$+"ms",i="ConnectionTimeoutError";et.socket||(i="SocketAssignTimeoutError",e+=", working sockets is full"),(V=new Error(e)).name=i,V.requestId=x,h("ConnectTimeout: Request#%d %s %s: %s, connected: %s",x,t,V.name,e,j),ot()}),$)}function st(){h("Response timer ticking, timeout: %d",tt),F=setTimeout((function(){F=null;var e="Response timeout for "+tt+"ms",i="ResponseTimeoutError";(V=new Error(e)).name=i,V.requestId=x,h("ResponseTimeout: Request#%d %s %s: %s, connected: %s",x,t,V.name,e,j),ot()}),tt)}h("Request#%d %s %s with headers %j, options.path: %s",x,w,t,I.headers,I.path),g.requestUrls.push(t),Array.isArray(g.timeout)?($=u(g.timeout[0]),tt=u(g.timeout[1])):$=tt=u(g.timeout),h("ConnectTimeout: %d, ResponseTimeout: %d",$,tt),I.mode=g.mode?g.mode:"";try{et=E.request(I,rt)}catch(at){return q(at)}function ot(){h("Request#%d %s abort, connected: %s",x,t,j),et.socket||(V.noSocket=!0,q(V)),et.abort()}return"undefined"==typeof window?nt():et.on("requestTimeout",(function(){-1===Y&&(Y=-2);var t="ConnectionTimeoutError";(V=new Error("Connect timeout for "+$+"ms")).name=t,V.requestId=x,ot()})),W&&et.on("finish",(function(){W.requestSent=Date.now()-S})),et.once("socket",(function(e){W&&(W.queuing=Date.now()-S);var i=e.readyState;if("opening"===i)return e.once("lookup",(function(e,i,r){h("Request#%d %s lookup: %s, %s, %s",x,t,e,i,r),W&&(W.dnslookup=Date.now()-S),i&&(X=i)})),void e.once("connect",(function(){W&&(W.connected=Date.now()-S),Z(),st(),h("Request#%d %s new socket connected",x,t),j=!0,X||(X=e.remoteAddress),z=e.remotePort}));h("Request#%d %s reuse socket connected, readyState: %s",x,t,i),j=!0,G=!0,X||(X=e.remoteAddress),z=e.remotePort,Z(),st()})),et.on("error",(function(e){"Error"!==e.name&&"TypeError"!==e.name||(e.name=j?"ResponseError":"RequestError"),e.message+=' (req "error")',h("Request#%d %s `req error` event emit, %s: %s",x,t,e.name,e.message),q(V||e)})),it&&it.once("error",(function(e){e.message+=' (writeStream "error")',V=e,h("Request#%d %s `writeStream error` event emit, %s: %s",x,t,e.name,e.message),ot()})),g.stream?(g.stream.pipe(et),g.stream.once("error",(function(e){e.message+=' (stream "error")',V=e,h("Request#%d %s `readStream error` event emit, %s: %s",x,t,e.name,e.message),ot()}))):et.end(M),et.requestId=x,et}}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{"@babel/runtime/helpers/interopRequireDefault":86,"@babel/runtime/helpers/typeof":91,_process:538,buffer:103,"core-js/modules/es.array.concat.js":310,"core-js/modules/es.function.name.js":322,"core-js/modules/es.object.to-string.js":329,"core-js/modules/es.promise.js":333,"core-js/modules/es.regexp.exec.js":338,"core-js/modules/es.string.trim.js":349,debug:536,http:539,https:398,"humanize-ms":399,url:543,util:489}]},{},[1])(1)}(window)}(aliyunOssSdk$1)),aliyunOssSdk$1.exports}var aliyunOssSdkExports=requireAliyunOssSdk();const aliyunOssSdk=getDefaultExportFromCjs(aliyunOssSdkExports);var strChineseFirstPY="YDYQSXMWZSSXJBYMGCCZQPSSQBYCDSCDQLDYLYBSSJGYZZJJFKCCLZDHWDWZJLJPFYYNWJJTMYHZWZHFLZPPQHGSCYYYNJQYXXGJHHSDSJNKKTMOMLCRXYPSNQSECCQZGGLLYJLMYZZSECYKYYHQWJSSGGYXYZYJWWKDJHYCHMYXJTLXJYQBYXZLDWRDJRWYSRLDZJPCBZJJBRCFTLECZSTZFXXZHTRQHYBDLYCZSSYMMRFMYQZPWWJJYFCRWFDFZQPYDDWYXKYJAWJFFXYPSFTZYHHYZYSWCJYXSCLCXXWZZXNBGNNXBXLZSZSBSGPYSYZDHMDZBQBZCWDZZYYTZHBTSYYBZGNTNXQYWQSKBPHHLXGYBFMJEBJHHGQTJCYSXSTKZHLYCKGLYSMZXYALMELDCCXGZYRJXSDLTYZCQKCNNJWHJTZZCQLJSTSTBNXBTYXCEQXGKWJYFLZQLYHYXSPSFXLMPBYSXXXYDJCZYLLLSJXFHJXPJBTFFYABYXBHZZBJYZLWLCZGGBTSSMDTJZXPTHYQTGLJSCQFZKJZJQNLZWLSLHDZBWJNCJZYZSQQYCQYRZCJJWYBRTWPYFTWEXCSKDZCTBZHYZZYYJXZCFFZZMJYXXSDZZOTTBZLQWFCKSZSXFYRLNYJMBDTHJXSQQCCSBXYYTSYFBXDZTGBCNSLCYZZPSAZYZZSCJCSHZQYDXLBPJLLMQXTYDZXSQJTZPXLCGLQTZWJBHCTSYJSFXYEJJTLBGXSXJMYJQQPFZASYJNTYDJXKJCDJSZCBARTDCLYJQMWNQNCLLLKBYBZZSYHQQLTWLCCXTXLLZNTYLNEWYZYXCZXXGRKRMTCNDNJTSYYSSDQDGHSDBJGHRWRQLYBGLXHLGTGXBQJDZPYJSJYJCTMRNYMGRZJCZGJMZMGXMPRYXKJNYMSGMZJYMKMFXMLDTGFBHCJHKYLPFMDXLQJJSMTQGZSJLQDLDGJYCALCMZCSDJLLNXDJFFFFJCZFMZFFPFKHKGDPSXKTACJDHHZDDCRRCFQYJKQCCWJDXHWJLYLLZGCFCQDSMLZPBJJPLSBCJGGDCKKDEZSQCCKJGCGKDJTJDLZYCXKLQSCGJCLTFPCQCZGWPJDQYZJJBYJHSJDZWGFSJGZKQCCZLLPSPKJGQJHZZLJPLGJGJJTHJJYJZCZMLZLYQBGJWMLJKXZDZNJQSYZMLJLLJKYWXMKJLHSKJGBMCLYYMKXJQLBMLLKMDXXKWYXYSLMLPSJQQJQXYXFJTJDXMXXLLCXQBSYJBGWYMBGGBCYXPJYGPEPFGDJGBHBNSQJYZJKJKHXQFGQZKFHYGKHDKLLSDJQXPQYKYBNQSXQNSZSWHBSXWHXWBZZXDMNSJBSBKBBZKLYLXGWXDRWYQZMYWSJQLCJXXJXKJEQXSCYETLZHLYYYSDZPAQYZCMTLSHTZCFYZYXYLJSDCJQAGYSLCQLYYYSHMRQQKLDXZSCSSSYDYCJYSFSJBFRSSZQSBXXPXJYSDRCKGJLGDKZJZBDKTCSYQPYHSTCLDJDHMXMCGXYZHJDDTMHLTXZXYLYMOHYJCLTYFBQQXPFBDFHHTKSQHZYYWCNXXCRWHOWGYJLEGWDQCWGFJYCSNTMYTOLBYGWQWESJPWNMLRYDZSZTXYQPZGCWXHNGPYXSHMYQJXZTDPPBFYHZHTJYFDZWKGKZBLDNTSXHQEEGZZYLZMMZYJZGXZXKHKSTXNXXWYLYAPSTHXDWHZYMPXAGKYDXBHNHXKDPJNMYHYLPMGOCSLNZHKXXLPZZLBMLSFBHHGYGYYGGBHSCYAQTYWLXTZQCEZYDQDQMMHTKLLSZHLSJZWFYHQSWSCWLQAZYNYTLSXTHAZNKZZSZZLAXXZWWCTGQQTDDYZTCCHYQZFLXPSLZYGPZSZNGLNDQTBDLXGTCTAJDKYWNSYZLJHHZZCWNYYZYWMHYCHHYXHJKZWSXHZYXLYSKQYSPSLYZWMYPPKBYGLKZHTYXAXQSYSHXASMCHKDSCRSWJPWXSGZJLWWSCHSJHSQNHCSEGNDAQTBAALZZMSSTDQJCJKTSCJAXPLGGXHHGXXZCXPDMMHLDGTYBYSJMXHMRCPXXJZCKZXSHMLQXXTTHXWZFKHCCZDYTCJYXQHLXDHYPJQXYLSYYDZOZJNYXQEZYSQYAYXWYPDGXDDXSPPYZNDLTWRHXYDXZZJHTCXMCZLHPYYYYMHZLLHNXMYLLLMDCPPXHMXDKYCYRDLTXJCHHZZXZLCCLYLNZSHZJZZLNNRLWHYQSNJHXYNTTTKYJPYCHHYEGKCTTWLGQRLGGTGTYGYHPYHYLQYQGCWYQKPYYYTTTTLHYHLLTYTTSPLKYZXGZWGPYDSSZZDQXSKCQNMJJZZBXYQMJRTFFBTKHZKBXLJJKDXJTLBWFZPPTKQTZTGPDGNTPJYFALQMKGXBDCLZFHZCLLLLADPMXDJHLCCLGYHDZFGYDDGCYYFGYDXKSSEBDHYKDKDKHNAXXYBPBYYHXZQGAFFQYJXDMLJCSQZLLPCHBSXGJYNDYBYQSPZWJLZKSDDTACTBXZDYZYPJZQSJNKKTKNJDJGYYPGTLFYQKASDNTCYHBLWDZHBBYDWJRYGKZYHEYYFJMSDTYFZJJHGCXPLXHLDWXXJKYTCYKSSSMTWCTTQZLPBSZDZWZXGZAGYKTYWXLHLSPBCLLOQMMZSSLCMBJCSZZKYDCZJGQQDSMCYTZQQLWZQZXSSFPTTFQMDDZDSHDTDWFHTDYZJYQJQKYPBDJYYXTLJHDRQXXXHAYDHRJLKLYTWHLLRLLRCXYLBWSRSZZSYMKZZHHKYHXKSMDSYDYCJPBZBSQLFCXXXNXKXWYWSDZYQOGGQMMYHCDZTTFJYYBGSTTTYBYKJDHKYXBELHTYPJQNFXFDYKZHQKZBYJTZBXHFDXKDASWTAWAJLDYJSFHBLDNNTNQJTJNCHXFJSRFWHZFMDRYJYJWZPDJKZYJYMPCYZNYNXFBYTFYFWYGDBNZZZDNYTXZEMMQBSQEHXFZMBMFLZZSRXYMJGSXWZJSPRYDJSJGXHJJGLJJYNZZJXHGXKYMLPYYYCXYTWQZSWHWLYRJLPXSLSXMFSWWKLCTNXNYNPSJSZHDZEPTXMYYWXYYSYWLXJQZQXZDCLEEELMCPJPCLWBXSQHFWWTFFJTNQJHJQDXHWLBYZNFJLALKYYJLDXHHYCSTYYWNRJYXYWTRMDRQHWQCMFJDYZMHMYYXJWMYZQZXTLMRSPWWCHAQBXYGZYPXYYRRCLMPYMGKSJSZYSRMYJSNXTPLNBAPPYPYLXYYZKYNLDZYJZCZNNLMZHHARQMPGWQTZMXXMLLHGDZXYHXKYXYCJMFFYYHJFSBSSQLXXNDYCANNMTCJCYPRRNYTYQNYYMBMSXNDLYLYSLJRLXYSXQMLLYZLZJJJKYZZCSFBZXXMSTBJGNXYZHLXNMCWSCYZYFZLXBRNNNYLBNRTGZQYSATSWRYHYJZMZDHZGZDWYBSSCSKXSYHYTXXGCQGXZZSHYXJSCRHMKKBXCZJYJYMKQHZJFNBHMQHYSNJNZYBKNQMCLGQHWLZNZSWXKHLJHYYBQLBFCDSXDLDSPFZPSKJYZWZXZDDXJSMMEGJSCSSMGCLXXKYYYLNYPWWWGYDKZJGGGZGGSYCKNJWNJPCXBJJTQTJWDSSPJXZXNZXUMELPXFSXTLLXCLJXJJLJZXCTPSWXLYDHLYQRWHSYCSQYYBYAYWJJJQFWQCQQCJQGXALDBZZYJGKGXPLTZYFXJLTPADKYQHPMATLCPDCKBMTXYBHKLENXDLEEGQDYMSAWHZMLJTWYGXLYQZLJEEYYBQQFFNLYXRDSCTGJGXYYNKLLYQKCCTLHJLQMKKZGCYYGLLLJDZGYDHZWXPYSJBZKDZGYZZHYWYFQYTYZSZYEZZLYMHJJHTSMQWYZLKYYWZCSRKQYTLTDXWCTYJKLWSQZWBDCQYNCJSRSZJLKCDCDTLZZZACQQZZDDXYPLXZBQJYLZLLLQDDZQJYJYJZYXNYYYNYJXKXDAZWYRDLJYYYRJLXLLDYXJCYWYWNQCCLDDNYYYNYCKCZHXXCCLGZQJGKWPPCQQJYSBZZXYJSQPXJPZBSBDSFNSFPZXHDWZTDWPPTFLZZBZDMYYPQJRSDZSQZSQXBDGCPZSWDWCSQZGMDHZXMWWFYBPDGPHTMJTHZSMMBGZMBZJCFZWFZBBZMQCFMBDMCJXLGPNJBBXGYHYYJGPTZGZMQBQTCGYXJXLWZKYDPDYMGCFTPFXYZTZXDZXTGKMTYBBCLBJASKYTSSQYYMSZXFJEWLXLLSZBQJJJAKLYLXLYCCTSXMCWFKKKBSXLLLLJYXTYLTJYYTDPJHNHNNKBYQNFQYYZBYYESSESSGDYHFHWTCJBSDZZTFDMXHCNJZYMQWSRYJDZJQPDQBBSTJGGFBKJBXTGQHNGWJXJGDLLTHZHHYYYYYYSXWTYYYCCBDBPYPZYCCZYJPZYWCBDLFWZCWJDXXHYHLHWZZXJTCZLCDPXUJCZZZLYXJJTXPHFXWPYWXZPTDZZBDZCYHJHMLXBQXSBYLRDTGJRRCTTTHYTCZWMXFYTWWZCWJWXJYWCSKYBZSCCTZQNHXNWXXKHKFHTSWOCCJYBCMPZZYKBNNZPBZHHZDLSYDDYTYFJPXYNGFXBYQXCBHXCPSXTYZDMKYSNXSXLHKMZXLYHDHKWHXXSSKQYHHCJYXGLHZXCSNHEKDTGZXQYPKDHEXTYKCNYMYYYPKQYYYKXZLTHJQTBYQHXBMYHSQCKWWYLLHCYYLNNEQXQWMCFBDCCMLJGGXDQKTLXKGNQCDGZJWYJJLYHHQTTTNWCHMXCXWHWSZJYDJCCDBQCDGDNYXZTHCQRXCBHZTQCBXWGQWYYBXHMBYMYQTYEXMQKYAQYRGYZSLFYKKQHYSSQYSHJGJCNXKZYCXSBXYXHYYLSTYCXQTHYSMGSCPMMGCCCCCMTZTASMGQZJHKLOSQYLSWTMXSYQKDZLJQQYPLSYCZTCQQPBBQJZCLPKHQZYYXXDTDDTSJCXFFLLCHQXMJLWCJCXTSPYCXNDTJSHJWXDQQJSKXYAMYLSJHMLALYKXCYYDMNMDQMXMCZNNCYBZKKYFLMCHCMLHXRCJJHSYLNMTJZGZGYWJXSRXCWJGJQHQZDQJDCJJZKJKGDZQGJJYJYLXZXXCDQHHHEYTMHLFSBDJSYYSHFYSTCZQLPBDRFRZTZYKYWHSZYQKWDQZRKMSYNBCRXQBJYFAZPZZEDZCJYWBCJWHYJBQSZYWRYSZPTDKZPFPBNZTKLQYHBBZPNPPTYZZYBQNYDCPJMMCYCQMCYFZZDCMNLFPBPLNGQJTBTTNJZPZBBZNJKLJQYLNBZQHKSJZNGGQSZZKYXSHPZSNBCGZKDDZQANZHJKDRTLZLSWJLJZLYWTJNDJZJHXYAYNCBGTZCSSQMNJPJYTYSWXZFKWJQTKHTZPLBHSNJZSYZBWZZZZLSYLSBJHDWWQPSLMMFBJDWAQYZTCJTBNNWZXQXCDSLQGDSDPDZHJTQQPSWLYYJZLGYXYZLCTCBJTKTYCZJTQKBSJLGMGZDMCSGPYNJZYQYYKNXRPWSZXMTNCSZZYXYBYHYZAXYWQCJTLLCKJJTJHGDXDXYQYZZBYWDLWQCGLZGJGQRQZCZSSBCRPCSKYDZNXJSQGXSSJMYDNSTZTPBDLTKZWXQWQTZEXNQCZGWEZKSSBYBRTSSSLCCGBPSZQSZLCCGLLLZXHZQTHCZMQGYZQZNMCOCSZJMMZSQPJYGQLJYJPPLDXRGZYXCCSXHSHGTZNLZWZKJCXTCFCJXLBMQBCZZWPQDNHXLJCTHYZLGYLNLSZZPCXDSCQQHJQKSXZPBAJYEMSMJTZDXLCJYRYYNWJBNGZZTMJXLTBSLYRZPYLSSCNXPHLLHYLLQQZQLXYMRSYCXZLMMCZLTZSDWTJJLLNZGGQXPFSKYGYGHBFZPDKMWGHCXMSGDXJMCJZDYCABXJDLNBCDQYGSKYDQTXDJJYXMSZQAZDZFSLQXYJSJZYLBTXXWXQQZBJZUFBBLYLWDSLJHXJYZJWTDJCZFQZQZZDZSXZZQLZCDZFJHYSPYMPQZMLPPLFFXJJNZZYLSJEYQZFPFZKSYWJJJHRDJZZXTXXGLGHYDXCSKYSWMMZCWYBAZBJKSHFHJCXMHFQHYXXYZFTSJYZFXYXPZLCHMZMBXHZZSXYFYMNCWDABAZLXKTCSHHXKXJJZJSTHYGXSXYYHHHJWXKZXSSBZZWHHHCWTZZZPJXSNXQQJGZYZYWLLCWXZFXXYXYHXMKYYSWSQMNLNAYCYSPMJKHWCQHYLAJJMZXHMMCNZHBHXCLXTJPLTXYJHDYYLTTXFSZHYXXSJBJYAYRSMXYPLCKDUYHLXRLNLLSTYZYYQYGYHHSCCSMZCTZQXKYQFPYYRPFFLKQUNTSZLLZMWWTCQQYZWTLLMLMPWMBZSSTZRBPDDTLQJJBXZCSRZQQYGWCSXFWZLXCCRSZDZMCYGGDZQSGTJSWLJMYMMZYHFBJDGYXCCPSHXNZCSBSJYJGJMPPWAFFYFNXHYZXZYLREMZGZCYZSSZDLLJCSQFNXZKPTXZGXJJGFMYYYSNBTYLBNLHPFZDCYFBMGQRRSSSZXYSGTZRNYDZZCDGPJAFJFZKNZBLCZSZPSGCYCJSZLMLRSZBZZLDLSLLYSXSQZQLYXZLSKKBRXBRBZCYCXZZZEEYFGKLZLYYHGZSGZLFJHGTGWKRAAJYZKZQTSSHJJXDCYZUYJLZYRZDQQHGJZXSSZBYKJPBFRTJXLLFQWJHYLQTYMBLPZDXTZYGBDHZZRBGXHWNJTJXLKSCFSMWLSDQYSJTXKZSCFWJLBXFTZLLJZLLQBLSQMQQCGCZFPBPHZCZJLPYYGGDTGWDCFCZQYYYQYSSCLXZSKLZZZGFFCQNWGLHQYZJJCZLQZZYJPJZZBPDCCMHJGXDQDGDLZQMFGPSYTSDYFWWDJZJYSXYYCZCYHZWPBYKXRYLYBHKJKSFXTZJMMCKHLLTNYYMSYXYZPYJQYCSYCWMTJJKQYRHLLQXPSGTLYYCLJSCPXJYZFNMLRGJJTYZBXYZMSJYJHHFZQMSYXRSZCWTLRTQZSSTKXGQKGSPTGCZNJSJCQCXHMXGGZTQYDJKZDLBZSXJLHYQGGGTHQSZPYHJHHGYYGKGGCWJZZYLCZLXQSFTGZSLLLMLJSKCTBLLZZSZMMNYTPZSXQHJCJYQXYZXZQZCPSHKZZYSXCDFGMWQRLLQXRFZTLYSTCTMJCXJJXHJNXTNRZTZFQYHQGLLGCXSZSJDJLJCYDSJTLNYXHSZXCGJZYQPYLFHDJSBPCCZHJJJQZJQDYBSSLLCMYTTMQTBHJQNNYGKYRQYQMZGCJKPDCGMYZHQLLSLLCLMHOLZGDYYFZSLJCQZLYLZQJESHNYLLJXGJXLYSYYYXNBZLJSSZCQQCJYLLZLTJYLLZLLBNYLGQCHXYYXOXCXQKYJXXXYKLXSXXYQXCYKQXQCSGYXXYQXYGYTQOHXHXPYXXXULCYEYCHZZCBWQBBWJQZSCSZSSLZYLKDESJZWMYMCYTSDSXXSCJPQQSQYLYYZYCMDJDZYWCBTJSYDJKCYDDJLBDJJSODZYSYXQQYXDHHGQQYQHDYXWGMMMAJDYBBBPPBCMUUPLJZSMTXERXJMHQNUTPJDCBSSMSSSTKJTSSMMTRCPLZSZMLQDSDMJMQPNQDXCFYNBFSDQXYXHYAYKQYDDLQYYYSSZBYDSLNTFQTZQPZMCHDHCZCWFDXTMYQSPHQYYXSRGJCWTJTZZQMGWJJTJHTQJBBHWZPXXHYQFXXQYWYYHYSCDYDHHQMNMTMWCPBSZPPZZGLMZFOLLCFWHMMSJZTTDHZZYFFYTZZGZYSKYJXQYJZQBHMBZZLYGHGFMSHPZFZSNCLPBQSNJXZSLXXFPMTYJYGBXLLDLXPZJYZJYHHZCYWHJYLSJEXFSZZYWXKZJLUYDTMLYMQJPWXYHXSKTQJEZRPXXZHHMHWQPWQLYJJQJJZSZCPHJLCHHNXJLQWZJHBMZYXBDHHYPZLHLHLGFWLCHYYTLHJXCJMSCPXSTKPNHQXSRTYXXTESYJCTLSSLSTDLLLWWYHDHRJZSFGXTSYCZYNYHTDHWJSLHTZDQDJZXXQHGYLTZPHCSQFCLNJTCLZPFSTPDYNYLGMJLLYCQHYSSHCHYLHQYQTMZYPBYWRFQYKQSYSLZDQJMPXYYSSRHZJNYWTQDFZBWWTWWRXCWHGYHXMKMYYYQMSMZHNGCEPMLQQMTCWCTMMPXJPJJHFXYYZSXZHTYBMSTSYJTTQQQYYLHYNPYQZLCYZHZWSMYLKFJXLWGXYPJYTYSYXYMZCKTTWLKSMZSYLMPWLZWXWQZSSAQSYXYRHSSNTSRAPXCPWCMGDXHXZDZYFJHGZTTSBJHGYZSZYSMYCLLLXBTYXHBBZJKSSDMALXHYCFYGMQYPJYCQXJLLLJGSLZGQLYCJCCZOTYXMTMTTLLWTGPXYMZMKLPSZZZXHKQYSXCTYJZYHXSHYXZKXLZWPSQPYHJWPJPWXQQYLXSDHMRSLZZYZWTTCYXYSZZSHBSCCSTPLWSSCJCHNLCGCHSSPHYLHFHHXJSXYLLNYLSZDHZXYLSXLWZYKCLDYAXZCMDDYSPJTQJZLNWQPSSSWCTSTSZLBLNXSMNYYMJQBQHRZWTYYDCHQLXKPZWBGQYBKFCMZWPZLLYYLSZYDWHXPSBCMLJBSCGBHXLQHYRLJXYSWXWXZSLDFHLSLYNJLZYFLYJYCDRJLFSYZFSLLCQYQFGJYHYXZLYLMSTDJCYHBZLLNWLXXYGYYHSMGDHXXHHLZZJZXCZZZCYQZFNGWPYLCPKPYYPMCLQKDGXZGGWQBDXZZKZFBXXLZXJTPJPTTBYTSZZDWSLCHZHSLTYXHQLHYXXXYYZYSWTXZKHLXZXZPYHGCHKCFSYHUTJRLXFJXPTZTWHPLYXFCRHXSHXKYXXYHZQDXQWULHYHMJTBFLKHTXCWHJFWJCFPQRYQXCYYYQYGRPYWSGSUNGWCHKZDXYFLXXHJJBYZWTSXXNCYJJYMSWZJQRMHXZWFQSYLZJZGBHYNSLBGTTCSYBYXXWXYHXYYXNSQYXMQYWRGYQLXBBZLJSYLPSYTJZYHYZAWLRORJMKSCZJXXXYXCHDYXRYXXJDTSQFXLYLTSFFYXLMTYJMJUYYYXLTZCSXQZQHZXLYYXZHDNBRXXXJCTYHLBRLMBRLLAXKYLLLJLYXXLYCRYLCJTGJCMTLZLLCYZZPZPCYAWHJJFYBDYYZSMPCKZDQYQPBPCJPDCYZMDPBCYYDYCNNPLMTMLRMFMMGWYZBSJGYGSMZQQQZTXMKQWGXLLPJGZBQCDJJJFPKJKCXBLJMSWMDTQJXLDLPPBXCWRCQFBFQJCZAHZGMYKPHYYHZYKNDKZMBPJYXPXYHLFPNYYGXJDBKXNXHJMZJXSTRSTLDXSKZYSYBZXJLXYSLBZYSLHXJPFXPQNBYLLJQKYGZMCYZZYMCCSLCLHZFWFWYXZMWSXTYNXJHPYYMCYSPMHYSMYDYSHQYZCHMJJMZCAAGCFJBBHPLYZYLXXSDJGXDHKXXTXXNBHRMLYJSLTXMRHNLXQJXYZLLYSWQGDLBJHDCGJYQYCMHWFMJYBMBYJYJWYMDPWHXQLDYGPDFXXBCGJSPCKRSSYZJMSLBZZJFLJJJLGXZGYXYXLSZQYXBEXYXHGCXBPLDYHWETTWWCJMBTXCHXYQXLLXFLYXLLJLSSFWDPZSMYJCLMWYTCZPCHQEKCQBWLCQYDPLQPPQZQFJQDJHYMMCXTXDRMJWRHXCJZYLQXDYYNHYYHRSLSRSYWWZJYMTLTLLGTQCJZYABTCKZCJYCCQLJZQXALMZYHYWLWDXZXQDLLQSHGPJFJLJHJABCQZDJGTKHSSTCYJLPSWZLXZXRWGLDLZRLZXTGSLLLLZLYXXWGDZYGBDPHZPBRLWSXQBPFDWOFMWHLYPCBJCCLDMBZPBZZLCYQXLDOMZBLZWPDWYYGDSTTHCSQSCCRSSSYSLFYBFNTYJSZDFNDPDHDZZMBBLSLCMYFFGTJJQWFTMTPJWFNLBZCMMJTGBDZLQLPYFHYYMJYLSDCHDZJWJCCTLJCLDTLJJCPDDSQDSSZYBNDBJLGGJZXSXNLYCYBJXQYCBYLZCFZPPGKCXZDZFZTJJFJSJXZBNZYJQTTYJYHTYCZHYMDJXTTMPXSPLZCDWSLSHXYPZGTFMLCJTYCBPMGDKWYCYZCDSZZYHFLYCTYGWHKJYYLSJCXGYWJCBLLCSNDDBTZBSCLYZCZZSSQDLLMQYYHFSLQLLXFTYHABXGWNYWYYPLLSDLDLLBJCYXJZMLHLJDXYYQYTDLLLBUGBFDFBBQJZZMDPJHGCLGMJJPGAEHHBWCQXAXHHHZCHXYPHJAXHLPHJPGPZJQCQZGJJZZUZDMQYYBZZPHYHYBWHAZYJHYKFGDPFQSDLZMLJXKXGALXZDAGLMDGXMWZQYXXDXXPFDMMSSYMPFMDMMKXKSYZYSHDZKXSYSMMZZZMSYDNZZCZXFPLSTMZDNMXCKJMZTYYMZMZZMSXHHDCZJEMXXKLJSTLWLSQLYJZLLZJSSDPPMHNLZJCZYHMXXHGZCJMDHXTKGRMXFWMCGMWKDTKSXQMMMFZZYDKMSCLCMPCGMHSPXQPZDSSLCXKYXTWLWJYAHZJGZQMCSNXYYMMPMLKJXMHLMLQMXCTKZMJQYSZJSYSZHSYJZJCDAJZYBSDQJZGWZQQXFKDMSDJLFWEHKZQKJPEYPZYSZCDWYJFFMZZYLTTDZZEFMZLBNPPLPLPEPSZALLTYLKCKQZKGENQLWAGYXYDPXLHSXQQWQCQXQCLHYXXMLYCCWLYMQYSKGCHLCJNSZKPYZKCQZQLJPDMDZHLASXLBYDWQLWDNBQCRYDDZTJYBKBWSZDXDTNPJDTCTQDFXQQMGNXECLTTBKPWSLCTYQLPWYZZKLPYGZCQQPLLKCCYLPQMZCZQCLJSLQZDJXLDDHPZQDLJJXZQDXYZQKZLJCYQDYJPPYPQYKJYRMPCBYMCXKLLZLLFQPYLLLMBSGLCYSSLRSYSQTMXYXZQZFDZUYSYZTFFMZZSMZQHZSSCCMLYXWTPZGXZJGZGSJSGKDDHTQGGZLLBJDZLCBCHYXYZHZFYWXYZYMSDBZZYJGTSMTFXQYXQSTDGSLNXDLRYZZLRYYLXQHTXSRTZNGZXBNQQZFMYKMZJBZYMKBPNLYZPBLMCNQYZZZSJZHJCTZKHYZZJRDYZHNPXGLFZTLKGJTCTSSYLLGZRZBBQZZKLPKLCZYSSUYXBJFPNJZZXCDWXZYJXZZDJJKGGRSRJKMSMZJLSJYWQSKYHQJSXPJZZZLSNSHRNYPZTWCHKLPSRZLZXYJQXQKYSJYCZTLQZYBBYBWZPQDWWYZCYTJCJXCKCWDKKZXSGKDZXWWYYJQYYTCYTDLLXWKCZKKLCCLZCQQDZLQLCSFQCHQHSFSMQZZLNBJJZBSJHTSZDYSJQJPDLZCDCWJKJZZLPYCGMZWDJJBSJQZSYZYHHXJPBJYDSSXDZNCGLQMBTSFSBPDZDLZNFGFJGFSMPXJQLMBLGQCYYXBQKDJJQYRFKZTJDHCZKLBSDZCFJTPLLJGXHYXZCSSZZXSTJYGKGCKGYOQXJPLZPBPGTGYJZGHZQZZLBJLSQFZGKQQJZGYCZBZQTLDXRJXBSXXPZXHYZYCLWDXJJHXMFDZPFZHQHQMQGKSLYHTYCGFRZGNQXCLPDLBZCSCZQLLJBLHBZCYPZZPPDYMZZSGYHCKCPZJGSLJLNSCDSLDLXBMSTLDDFJMKDJDHZLZXLSZQPQPGJLLYBDSZGQLBZLSLKYYHZTTNTJYQTZZPSZQZTLLJTYYLLQLLQYZQLBDZLSLYYZYMDFSZSNHLXZNCZQZPBWSKRFBSYZMTHBLGJPMCZZLSTLXSHTCSYZLZBLFEQHLXFLCJLYLJQCBZLZJHHSSTBRMHXZHJZCLXFNBGXGTQJCZTMSFZKJMSSNXLJKBHSJXNTNLZDNTLMSJXGZJYJCZXYJYJWRWWQNZTNFJSZPZSHZJFYRDJSFSZJZBJFZQZZHZLXFYSBZQLZSGYFTZDCSZXZJBQMSZKJRHYJZCKMJKHCHGTXKXQGLXPXFXTRTYLXJXHDTSJXHJZJXZWZLCQSBTXWXGXTXXHXFTSDKFJHZYJFJXRZSDLLLTQSQQZQWZXSYQTWGWBZCGZLLYZBCLMQQTZHZXZXLJFRMYZFLXYSQXXJKXRMQDZDMMYYBSQBHGZMWFWXGMXLZPYYTGZYCCDXYZXYWGSYJYZNBHPZJSQSYXSXRTFYZGRHZTXSZZTHCBFCLSYXZLZQMZLMPLMXZJXSFLBYZMYQHXJSXRXSQZZZSSLYFRCZJRCRXHHZXQYDYHXSJJHZCXZBTYNSYSXJBQLPXZQPYMLXZKYXLXCJLCYSXXZZLXDLLLJJYHZXGYJWKJRWYHCPSGNRZLFZWFZZNSXGXFLZSXZZZBFCSYJDBRJKRDHHGXJLJJTGXJXXSTJTJXLYXQFCSGSWMSBCTLQZZWLZZKXJMLTMJYHSDDBXGZHDLBMYJFRZFSGCLYJBPMLYSMSXLSZJQQHJZFXGFQFQBPXZGYYQXGZTCQWYLTLGWSGWHRLFSFGZJMGMGBGTJFSYZZGZYZAFLSSPMLPFLCWBJZCLJJMZLPJJLYMQDMYYYFBGYGYZMLYZDXQYXRQQQHSYYYQXYLJTYXFSFSLLGNQCYHYCWFHCCCFXPYLYPLLZYXXXXXKQHHXSHJZCFZSCZJXCPZWHHHHHAPYLQALPQAFYHXDYLUKMZQGGGDDESRNNZLTZGCHYPPYSQJJHCLLJTOLNJPZLJLHYMHEYDYDSQYCDDHGZUNDZCLZYZLLZNTNYZGSLHSLPJJBDGWXPCDUTJCKLKCLWKLLCASSTKZZDNQNTTLYYZSSYSSZZRYLJQKCQDHHCRXRZYDGRGCWCGZQFFFPPJFZYNAKRGYWYQPQXXFKJTSZZXSWZDDFBBXTBGTZKZNPZZPZXZPJSZBMQHKCYXYLDKLJNYPKYGHGDZJXXEAHPNZKZTZCMXCXMMJXNKSZQNMNLWBWWXJKYHCPSTMCSQTZJYXTPCTPDTNNPGLLLZSJLSPBLPLQHDTNJNLYYRSZFFJFQWDPHZDWMRZCCLODAXNSSNYZRESTYJWJYJDBCFXNMWTTBYLWSTSZGYBLJPXGLBOCLHPCBJLTMXZLJYLZXCLTPNCLCKXTPZJSWCYXSFYSZDKNTLBYJCYJLLSTGQCBXRYZXBXKLYLHZLQZLNZCXWJZLJZJNCJHXMNZZGJZZXTZJXYCYYCXXJYYXJJXSSSJSTSSTTPPGQTCSXWZDCSYFPTFBFHFBBLZJCLZZDBXGCXLQPXKFZFLSYLTUWBMQJHSZBMDDBCYSCCLDXYCDDQLYJJWMQLLCSGLJJSYFPYYCCYLTJANTJJPWYCMMGQYYSXDXQMZHSZXPFTWWZQSWQRFKJLZJQQYFBRXJHHFWJJZYQAZMYFRHCYYBYQWLPEXCCZSTYRLTTDMQLYKMBBGMYYJPRKZNPBSXYXBHYZDJDNGHPMFSGMWFZMFQMMBCMZZCJJLCNUXYQLMLRYGQZCYXZLWJGCJCGGMCJNFYZZJHYCPRRCMTZQZXHFQGTJXCCJEAQCRJYHPLQLSZDJRBCQHQDYRHYLYXJSYMHZYDWLDFRYHBPYDTSSCNWBXGLPZMLZZTQSSCPJMXXYCSJYTYCGHYCJWYRXXLFEMWJNMKLLSWTXHYYYNCMMCWJDQDJZGLLJWJRKHPZGGFLCCSCZMCBLTBHBQJXQDSPDJZZGKGLFQYWBZYZJLTSTDHQHCTCBCHFLQMPWDSHYYTQWCNZZJTLBYMBPDYYYXSQKXWYYFLXXNCWCXYPMAELYKKJMZZZBRXYYQJFLJPFHHHYTZZXSGQQMHSPGDZQWBWPJHZJDYSCQWZKTXXSQLZYYMYSDZGRXCKKUJLWPYSYSCSYZLRMLQSYLJXBCXTLWDQZPCYCYKPPPNSXFYZJJRCEMHSZMSXLXGLRWGCSTLRSXBZGBZGZTCPLUJLSLYLYMTXMTZPALZXPXJTJWTCYYZLBLXBZLQMYLXPGHDSLSSDMXMBDZZSXWHAMLCZCPJMCNHJYSNSYGCHSKQMZZQDLLKABLWJXSFMOCDXJRRLYQZKJMYBYQLYHETFJZFRFKSRYXFJTWDSXXSYSQJYSLYXWJHSNLXYYXHBHAWHHJZXWMYLJCSSLKYDZTXBZSYFDXGXZJKHSXXYBSSXDPYNZWRPTQZCZENYGCXQFJYKJBZMLJCMQQXUOXSLYXXLYLLJDZBTYMHPFSTTQQWLHOKYBLZZALZXQLHZWRRQHLSTMYPYXJJXMQSJFNBXYXYJXXYQYLTHYLQYFMLKLJTMLLHSZWKZHLJMLHLJKLJSTLQXYLMBHHLNLZXQJHXCFXXLHYHJJGBYZZKBXSCQDJQDSUJZYYHZHHMGSXCSYMXFEBCQWWRBPYYJQTYZCYQYQQZYHMWFFHGZFRJFCDPXNTQYZPDYKHJLFRZXPPXZDBBGZQSTLGDGYLCQMLCHHMFYWLZYXKJLYPQHSYWMQQGQZMLZJNSQXJQSYJYCBEHSXFSZPXZWFLLBCYYJDYTDTHWZSFJMQQYJLMQXXLLDTTKHHYBFPWTYYSQQWNQWLGWDEBZWCMYGCULKJXTMXMYJSXHYBRWFYMWFRXYQMXYSZTZZTFYKMLDHQDXWYYNLCRYJBLPSXCXYWLSPRRJWXHQYPHTYDNXHHMMYWYTZCSQMTSSCCDALWZTCPQPYJLLQZYJSWXMZZMMYLMXCLMXCZMXMZSQTZPPQQBLPGXQZHFLJJHYTJSRXWZXSCCDLXTYJDCQJXSLQYCLZXLZZXMXQRJMHRHZJBHMFLJLMLCLQNLDXZLLLPYPSYJYSXCQQDCMQJZZXHNPNXZMEKMXHYKYQLXSXTXJYYHWDCWDZHQYYBGYBCYSCFGPSJNZDYZZJZXRZRQJJYMCANYRJTLDPPYZBSTJKXXZYPFDWFGZZRPYMTNGXZQBYXNBUFNQKRJQZMJEGRZGYCLKXZDSKKNSXKCLJSPJYYZLQQJYBZSSQLLLKJXTBKTYLCCDDBLSPPFYLGYDTZJYQGGKQTTFZXBDKTYYHYBBFYTYYBCLPDYTGDHRYRNJSPTCSNYJQHKLLLZSLYDXXWBCJQSPXBPJZJCJDZFFXXBRMLAZHCSNDLBJDSZBLPRZTSWSBXBCLLXXLZDJZSJPYLYXXYFTFFFBHJJXGBYXJPMMMPSSJZJMTLYZJXSWXTYLEDQPJMYGQZJGDJLQJWJQLLSJGJGYGMSCLJJXDTYGJQJQJCJZCJGDZZSXQGSJGGCXHQXSNQLZZBXHSGZXCXYLJXYXYYDFQQJHJFXDHCTXJYRXYSQTJXYEFYYSSYYJXNCYZXFXMSYSZXYYSCHSHXZZZGZZZGFJDLTYLNPZGYJYZYYQZPBXQBDZTZCZYXXYHHSQXSHDHGQHJHGYWSZTMZMLHYXGEBTYLZKQWYTJZRCLEKYSTDBCYKQQSAYXCJXWWGSBHJYZYDHCSJKQCXSWXFLTYNYZPZCCZJQTZWJQDZZZQZLJJXLSBHPYXXPSXSHHEZTXFPTLQYZZXHYTXNCFZYYHXGNXMYWXTZSJPTHHGYMXMXQZXTSBCZYJYXXTYYZYPCQLMMSZMJZZLLZXGXZAAJZYXJMZXWDXZSXZDZXLEYJJZQBHZWZZZQTZPSXZTDSXJJJZNYAZPHXYYSRNQDTHZHYYKYJHDZXZLSWCLYBZYECWCYCRYLCXNHZYDZYDYJDFRJJHTRSQTXYXJRJHOJYNXELXSFSFJZGHPZSXZSZDZCQZBYYKLSGSJHCZSHDGQGXYZGXCHXZJWYQWGYHKSSEQZZNDZFKWYSSTCLZSTSYMCDHJXXYWEYXCZAYDMPXMDSXYBSQMJMZJMTZQLPJYQZCGQHXJHHLXXHLHDLDJQCLDWBSXFZZYYSCHTYTYYBHECXHYKGJPXHHYZJFXHWHBDZFYZBCAPNPGNYDMSXHMMMMAMYNBYJTMPXYYMCTHJBZYFCGTYHWPHFTWZZEZSBZEGPFMTSKFTYCMHFLLHGPZJXZJGZJYXZSBBQSCZZLZCCSTPGXMJSFTCCZJZDJXCYBZLFCJSYZFGSZLYBCWZZBYZDZYPSWYJZXZBDSYUXLZZBZFYGCZXBZHZFTPBGZGEJBSTGKDMFHYZZJHZLLZZGJQZLSFDJSSCBZGPDLFZFZSZYZYZSYGCXSNXXCHCZXTZZLJFZGQSQYXZJQDCCZTQCDXZJYQJQCHXZTDLGSCXZSYQJQTZWLQDQZTQCHQQJZYEZZZPBWKDJFCJPZTYPQYQTTYNLMBDKTJZPQZQZZFPZSBNJLGYJDXJDZZKZGQKXDLPZJTCJDQBXDJQJSTCKNXBXZMSLYJCQMTJQWWCJQNJNLLLHJCWQTBZQYDZCZPZZDZYDDCYZZZCCJTTJFZDPRRTZTJDCQTQZDTJNPLZBCLLCTZSXKJZQZPZLBZRBTJDCXFCZDBCCJJLTQQPLDCGZDBBZJCQDCJWYNLLZYZCCDWLLXWZLXRXNTQQCZXKQLSGDFQTDDGLRLAJJTKUYMKQLLTZYTDYYCZGJWYXDXFRSKSTQTENQMRKQZHHQKDLDAZFKYPBGGPZREBZZYKZZSPEGJXGYKQZZZSLYSYYYZWFQZYLZZLZHWCHKYPQGNPGBLPLRRJYXCCSYYHSFZFYBZYYTGZXYLXCZWXXZJZBLFFLGSKHYJZEYJHLPLLLLCZGXDRZELRHGKLZZYHZLYQSZZJZQLJZFLNBHGWLCZCFJYSPYXZLZLXGCCPZBLLCYBBBBUBBCBPCRNNZCZYRBFSRLDCGQYYQXYGMQZWTZYTYJXYFWTEHZZJYWLCCNTZYJJZDEDPZDZTSYQJHDYMBJNYJZLXTSSTPHNDJXXBYXQTZQDDTJTDYYTGWSCSZQFLSHLGLBCZPHDLYZJYCKWTYTYLBNYTSDSYCCTYSZYYEBHEXHQDTWNYGYCLXTSZYSTQMYGZAZCCSZZDSLZCLZRQXYYELJSBYMXSXZTEMBBLLYYLLYTDQYSHYMRQWKFKBFXNXSBYCHXBWJYHTQBPBSBWDZYLKGZSKYHXQZJXHXJXGNLJKZLYYCDXLFYFGHLJGJYBXQLYBXQPQGZTZPLNCYPXDJYQYDYMRBESJYYHKXXSTMXRCZZYWXYQYBMCLLYZHQYZWQXDBXBZWZMSLPDMYSKFMZKLZCYQYCZLQXFZZYDQZPZYGYJYZMZXDZFYFYTTQTZHGSPCZMLCCYTZXJCYTJMKSLPZHYSNZLLYTPZCTZZCKTXDHXXTQCYFKSMQCCYYAZHTJPCYLZLYJBJXTPNYLJYYNRXSYLMMNXJSMYBCSYSYLZYLXJJQYLDZLPQBFZZBLFNDXQKCZFYWHGQMRDSXYCYTXNQQJZYYPFZXDYZFPRXEJDGYQBXRCNFYYQPGHYJDYZXGRHTKYLNWDZNTSMPKLBTHBPYSZBZTJZSZZJTYYXZPHSSZZBZCZPTQFZMYFLYPYBBJQXZMXXDJMTSYSKKBJZXHJCKLPSMKYJZCXTMLJYXRZZQSLXXQPYZXMKYXXXJCLJPRMYYGADYSKQLSNDHYZKQXZYZTCGHZTLMLWZYBWSYCTBHJHJFCWZTXWYTKZLXQSHLYJZJXTMPLPYCGLTBZZTLZJCYJGDTCLKLPLLQPJMZPAPXYZLKKTKDZCZZBNZDYDYQZJYJGMCTXLTGXSZLMLHBGLKFWNWZHDXUHLFMKYSLGXDTWWFRJEJZTZHYDXYKSHWFZCQSHKTMQQHTZHYMJDJSKHXZJZBZZXYMPAGQMSTPXLSKLZYNWRTSQLSZBPSPSGZWYHTLKSSSWHZZLYYTNXJGMJSZSUFWNLSOZTXGXLSAMMLBWLDSZYLAKQCQCTMYCFJBSLXCLZZCLXXKSBZQCLHJPSQPLSXXCKSLNHPSFQQYTXYJZLQLDXZQJZDYYDJNZPTUZDSKJFSLJHYLZSQZLBTXYDGTQFDBYAZXDZHZJNHHQBYKNXJJQCZMLLJZKSPLDYCLBBLXKLELXJLBQYCXJXGCNLCQPLZLZYJTZLJGYZDZPLTQCSXFDMNYCXGBTJDCZNBGBQYQJWGKFHTNPYQZQGBKPBBYZMTJDYTBLSQMPSXTBNPDXKLEMYYCJYNZCTLDYKZZXDDXHQSHDGMZSJYCCTAYRZLPYLTLKXSLZCGGEXCLFXLKJRTLQJAQZNCMBYDKKCXGLCZJZXJHPTDJJMZQYKQSECQZDSHHADMLZFMMZBGNTJNNLGBYJBRBTMLBYJDZXLCJLPLDLPCQDHLXZLYCBLCXZZJADJLNZMMSSSMYBHBSQKBHRSXXJMXSDZNZPXLGBRHWGGFCXGMSKLLTSJYYCQLTSKYWYYHYWXBXQYWPYWYKQLSQPTNTKHQCWDQKTWPXXHCPTHTWUMSSYHBWCRWXHJMKMZNGWTMLKFGHKJYLSYYCXWHYECLQHKQHTTQKHFZLDXQWYZYYDESBPKYRZPJFYYZJCEQDZZDLATZBBFJLLCXDLMJSSXEGYGSJQXCWBXSSZPDYZCXDNYXPPZYDLYJCZPLTXLSXYZYRXCYYYDYLWWNZSAHJSYQYHGYWWAXTJZDAXYSRLTDPSSYYFNEJDXYZHLXLLLZQZSJNYQYQQXYJGHZGZCYJCHZLYCDSHWSHJZYJXCLLNXZJJYYXNFXMWFPYLCYLLABWDDHWDXJMCXZTZPMLQZHSFHZYNZTLLDYWLSLXHYMMYLMBWWKYXYADTXYLLDJPYBPWUXJMWMLLSAFDLLYFLBHHHBQQLTZJCQJLDJTFFKMMMBYTHYGDCQRDDWRQJXNBYSNWZDBYYTBJHPYBYTTJXAAHGQDQTMYSTQXKBTZPKJLZRBEQQSSMJJBDJOTGTBXPGBKTLHQXJJJCTHXQDWJLWRFWQGWSHCKRYSWGFTGYGBXSDWDWRFHWYTJJXXXJYZYSLPYYYPAYXHYDQKXSHXYXGSKQHYWFDDDPPLCJLQQEEWXKSYYKDYPLTJTHKJLTCYYHHJTTPLTZZCDLTHQKZXQYSTEEYWYYZYXXYYSTTJKLLPZMCYHQGXYHSRMBXPLLNQYDQHXSXXWGDQBSHYLLPJJJTHYJKYPPTHYYKTYEZYENMDSHLCRPQFDGFXZPSFTLJXXJBSWYYSKSFLXLPPLBBBLBSFXFYZBSJSSYLPBBFFFFSSCJDSTZSXZRYYSYFFSYZYZBJTBCTSBSDHRTJJBYTCXYJEYLXCBNEBJDSYXYKGSJZBXBYTFZWGENYHHTHZHHXFWGCSTBGXKLSXYWMTMBYXJSTZSCDYQRCYTWXZFHMYMCXLZNSDJTTTXRYCFYJSBSDYERXJLJXBBDEYNJGHXGCKGSCYMBLXJMSZNSKGXFBNBPTHFJAAFXYXFPXMYPQDTZCXZZPXRSYWZDLYBBKTYQPQJPZYPZJZNJPZJLZZFYSBTTSLMPTZRTDXQSJEHBZYLZDHLJSQMLHTXTJECXSLZZSPKTLZKQQYFSYGYWPCPQFHQHYTQXZKRSGTTSQCZLPTXCDYYZXSQZSLXLZMYCPCQBZYXHBSXLZDLTCDXTYLZJYYZPZYZLTXJSJXHLPMYTXCQRBLZSSFJZZTNJYTXMYJHLHPPLCYXQJQQKZZSCPZKSWALQSBLCCZJSXGWWWYGYKTJBBZTDKHXHKGTGPBKQYSLPXPJCKBMLLXDZSTBKLGGQKQLSBKKTFXRMDKBFTPZFRTBBRFERQGXYJPZSSTLBZTPSZQZSJDHLJQLZBPMSMMSXLQQNHKNBLRDDNXXDHDDJCYYGYLXGZLXSYGMQQGKHBPMXYXLYTQWLWGCPBMQXCYZYDRJBHTDJYHQSHTMJSBYPLWHLZFFNYPMHXXHPLTBQPFBJWQDBYGPNZTPFZJGSDDTQSHZEAWZZYLLTYYBWJKXXGHLFKXDJTMSZSQYNZGGSWQSPHTLSSKMCLZXYSZQZXNCJDQGZDLFNYKLJCJLLZLMZZNHYDSSHTHZZLZZBBHQZWWYCRZHLYQQJBEYFXXXWHSRXWQHWPSLMSSKZTTYGYQQWRSLALHMJTQJSMXQBJJZJXZYZKXBYQXBJXSHZTSFJLXMXZXFGHKZSZGGYLCLSARJYHSLLLMZXELGLXYDJYTLFBHBPNLYZFBBHPTGJKWETZHKJJXZXXGLLJLSTGSHJJYQLQZFKCGNNDJSSZFDBCTWWSEQFHQJBSAQTGYPQLBXBMMYWXGSLZHGLZGQYFLZBYFZJFRYSFMBYZHQGFWZSYFYJJPHZBYYZFFWODGRLMFTWLBZGYCQXCDJYGZYYYYTYTYDWEGAZYHXJLZYYHLRMGRXXZCLHNELJJTJTPWJYBJJBXJJTJTEEKHWSLJPLPSFYZPQQBDLQJJTYYQLYZKDKSQJYYQZLDQTGJQYZJSUCMRYQTHTEJMFCTYHYPKMHYZWJDQFHYYXWSHCTXRLJHQXHCCYYYJLTKTTYTMXGTCJTZAYYOCZLYLBSZYWJYTSJYHBYSHFJLYGJXXTMZYYLTXXYPZLXYJZYZYYPNHMYMDYYLBLHLSYYQQLLNJJYMSOYQBZGDLYXYLCQYXTSZEGXHZGLHWBLJHEYXTWQMAKBPQCGYSHHEGQCMWYYWLJYJHYYZLLJJYLHZYHMGSLJLJXCJJYCLYCJPCPZJZJMMYLCQLNQLJQJSXYJMLSZLJQLYCMMHCFMMFPQQMFYLQMCFFQMMMMHMZNFHHJGTTHHKHSLNCHHYQDXTMMQDCYZYXYQMYQYLTDCYYYZAZZCYMZYDLZFFFMMYCQZWZZMABTBYZTDMNZZGGDFTYPCGQYTTSSFFWFDTZQSSYSTWXJHXYTSXXYLBYQHWWKXHZXWZNNZZJZJJQJCCCHYYXBZXZCYZTLLCQXYNJYCYYCYNZZQYYYEWYCZDCJYCCHYJLBTZYYCQWMPWPYMLGKDLDLGKQQBGYCHJXY",oMultiDiff={19969:"DZ",19975:"WM",19988:"QJ",20048:"YL",20056:"SC",20060:"NM",20094:"QG",20127:"QJ",20167:"QC",20193:"YG",20250:"KH",20256:"ZC",20282:"SC",20285:"QJG",20291:"TD",20314:"YD",20340:"NE",20375:"TD",20389:"YJ",20391:"CZ",20415:"PB",20446:"YS",20447:"SQ",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20985:"AW",21032:"PB",21048:"XQ",21049:"SC",21089:"YS",21119:"JC",21242:"SB",21273:"SC",21305:"YP",21306:"QO",21330:"ZC",21333:"SDC",21345:"QK",21378:"CA",21397:"SC",21414:"XS",21442:"SC",21477:"JG",21480:"TD",21484:"ZS",21494:"YX",21505:"YX",21512:"HG",21523:"XH",21537:"PB",21542:"PF",21549:"KH",21571:"E",21574:"DA",21588:"TD",21589:"O",21618:"ZC",21621:"KHA",21632:"ZJ",21654:"KG",21679:"LKG",21683:"KH",21710:"A",21719:"YH",21734:"WOE",21769:"A",21780:"WN",21804:"XH",21834:"A",21899:"ZD",21903:"RN",21908:"WO",21939:"ZC",21956:"SA",21964:"YA",21970:"TD",22003:"A",22031:"JG",22040:"XS",22060:"ZC",22066:"ZC",22079:"MH",22129:"XJ",22179:"XA",22237:"NJ",22244:"TD",22280:"JQ",22300:"YH",22313:"XW",22331:"YQ",22343:"YJ",22351:"PH",22395:"DC",22412:"TD",22484:"PB",22500:"PB",22534:"ZD",22549:"DH",22561:"PB",22612:"TD",22771:"KQ",22831:"HB",22841:"JG",22855:"QJ",22865:"XQ",23013:"ML",23081:"WM",23487:"SX",23558:"QJ",23561:"YW",23586:"YW",23614:"YW",23615:"SN",23631:"PB",23646:"ZS",23663:"ZT",23673:"YG",23762:"TD",23769:"ZS",23780:"QJ",23884:"QK",24055:"XH",24113:"DC",24162:"ZC",24191:"GA",24273:"QJ",24324:"NL",24377:"TD",24378:"QJ",24439:"PF",24554:"ZS",24683:"TD",24694:"WE",24733:"LK",24925:"TN",25094:"ZG",25100:"XQ",25103:"XH",25153:"PB",25170:"PB",25179:"KG",25203:"PB",25240:"ZS",25282:"FB",25303:"NA",25324:"KG",25341:"ZY",25373:"WZ",25375:"XJ",25384:"A",25457:"A",25528:"SD",25530:"SC",25552:"TD",25774:"ZC",25874:"ZC",26044:"YW",26080:"WM",26292:"PB",26333:"PB",26355:"ZY",26366:"CZ",26397:"ZC",26399:"QJ",26415:"ZS",26451:"SB",26526:"ZC",26552:"JG",26561:"TD",26588:"JG",26597:"CZ",26629:"ZS",26638:"YL",26646:"XQ",26653:"KG",26657:"XJ",26727:"HG",26894:"ZC",26937:"ZS",26946:"ZC",26999:"KJ",27099:"KJ",27449:"YQ",27481:"XS",27542:"ZS",27663:"ZS",27748:"TS",27784:"SC",27788:"ZD",27795:"TD",27812:"O",27850:"PB",27852:"MB",27895:"SL",27898:"PL",27973:"QJ",27981:"KH",27986:"HX",27994:"XJ",28044:"YC",28065:"WG",28177:"SM",28267:"QJ",28291:"KH",28337:"ZQ",28463:"TL",28548:"DC",28601:"TD",28689:"PB",28805:"JG",28820:"QG",28846:"PB",28952:"TD",28975:"ZC",29100:"A",29325:"QJ",29575:"SL",29602:"FB",30010:"TD",30044:"CX",30058:"PF",30091:"YSP",30111:"YN",30229:"XJ",30427:"SC",30465:"SX",30631:"YQ",30655:"QJ",30684:"QJG",30707:"SD",30729:"XH",30796:"LG",30917:"PB",31074:"NM",31085:"JZ",31109:"SC",31181:"ZC",31192:"MLB",31293:"JQ",31400:"YX",31584:"YJ",31896:"ZN",31909:"ZY",31995:"XJ",32321:"PF",32327:"ZY",32418:"HG",32420:"XQ",32421:"HG",32438:"LG",32473:"GJ",32488:"TD",32521:"QJ",32527:"PB",32562:"ZSQ",32564:"JZ",32735:"ZD",32793:"PB",33071:"PF",33098:"XL",33100:"YA",33152:"PB",33261:"CX",33324:"BP",33333:"TD",33406:"YA",33426:"WM",33432:"PB",33445:"JG",33486:"ZN",33493:"TS",33507:"QJ",33540:"QJ",33544:"ZC",33564:"XQ",33617:"YT",33632:"QJ",33636:"XH",33637:"YX",33694:"WG",33705:"PF",33728:"YW",33882:"SR",34067:"WM",34074:"YW",34121:"QJ",34255:"ZC",34259:"XL",34425:"JH",34430:"XH",34485:"KH",34503:"YS",34532:"HG",34552:"XS",34558:"YE",34593:"ZL",34660:"YQ",34892:"XH",34928:"SC",34999:"QJ",35048:"PB",35059:"SC",35098:"ZC",35203:"TQ",35265:"JX",35299:"JX",35782:"SZ",35828:"YS",35830:"E",35843:"TD",35895:"YG",35977:"MH",36158:"JG",36228:"QJ",36426:"XQ",36466:"DC",36710:"JC",36711:"ZYG",36767:"PB",36866:"SK",36951:"YW",37034:"YX",37063:"XH",37218:"ZC",37325:"ZC",38063:"PB",38079:"TD",38085:"QY",38107:"DC",38116:"TD",38123:"YD",38224:"HG",38241:"XTC",38271:"ZC",38415:"YE",38426:"KH",38461:"YD",38463:"AE",38466:"PB",38477:"XJ",38518:"YT",38551:"WK",38585:"ZC",38704:"XS",38739:"LJ",38761:"GJ",38808:"SQ",39048:"JG",39049:"XJ",39052:"HG",39076:"CZ",39271:"XT",39534:"TD",39552:"TD",39584:"PB",39647:"SB",39730:"LG",39748:"TPB",40109:"ZQ",40479:"ND",40516:"HG",40536:"HG",40583:"QJ",40765:"YQ",40784:"QJ",40840:"YK",40863:"QJG"};function isAllChinese(t){return/^[\u4E00-\u9FA5]+$/.test(t)}function isChinese(t){return/^[\u4E00-\u9FA5]$/.test(t)}function checkCh(t){var e=t.charCodeAt(0);return e>40869||e<19968?t:oMultiDiff[e]?oMultiDiff[e]:strChineseFirstPY.charAt(e-19968)}function mkRslt(t){for(var e=[""],i=0,r=t.length;i<r;i++){var n=t[i],s=n.length;if(1==s)for(var o=0;o<e.length;o++)e[o]+=n;else{var a=e.slice(0);for(e=[],o=0;o<s;o++){for(var l=a.slice(0),c=0;c<l.length;c++)l[c]+=n.charAt(o);e=e.concat(l)}}}return e}function getFirstLetterList(t){if("string"!=typeof t)throw new Error(-1,"请传入字符串类型的参数!");for(var e=new Array,i=0,r=t.length;i<r;i++){var n=t.charAt(i);e.push(checkCh(n))}return mkRslt(e)}function sort(t,e){if("number"==typeof t&&"string"==typeof e)return-1;if("string"==typeof t&&"number"==typeof e)return 1;if(isNaN(t)||isNaN(e)){if(isAllChinese(t)&&!isAllChinese(e))return 1;if(!isAllChinese(t)&&isAllChinese(e))return-1;t=t.toString(),e=e.toString();let i=0;for(let r=0;r<(t.length-e.length?e.length:t.length);r++){if(!isChinese(t[r])&&isChinese(e[r])&&(i=-1),isChinese(t[r])&&!isChinese(e[r])&&(i=1),isChinese(t[r])&&isChinese(e[r])){let n=getFirstLetterList(t[r]).toString(),s=getFirstLetterList(e[r]).toString();i=n.localeCompare(s,"zh-Hans-CN",{sensitivity:"accent"})}if(0!==i)break}return i||t.toString().localeCompare(e.toString(),"zh-Hans-CN",{sensitivity:"accent"})}return Number(t)-Number(e)}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};const totpSecret="LNKFKRGPNZNUYSLX2VSDSQKJKZDTSRLD";var ossClient=null;function isEmptyString(t){return/^\s*$/.test(t)}function fakeClick(t){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}function exportRaw(t,e){var i=window.URL||window.webkitURL||window,r=new Blob([e]),n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=i.createObjectURL(r),n.download=t,fakeClick(n)}const TableDataSaveKey="celueTableBooks",POLICYKEY="",menuItems=ref([{key:"0",label:"绘本列表",title:"绘本列表",closable:!1}]),list2=ref([]),graphDit={};let recordTouch=[];const bookGroup=[{value:"-1",label:"已下架"},{value:"101",label:"主页推荐"},{value:"0",label:"动物世界"},{value:"1",label:"节日里的中国"},{value:"3",label:"魔法拼音国"},{value:"4",label:"原来如此的故事"},{value:"5",label:"塔塔启蒙"}],bookGroupBySearch=[{value:"已下架",label:"已下架"},{value:"主页推荐",label:"主页推荐"},{value:"动物世界",label:"动物世界"},{value:"节日里的中国",label:"节日里的中国"},{value:"魔法拼音国",label:"魔法拼音国"},{value:"原来如此的故事",label:"原来如此的故事"},{value:"塔塔启蒙",label:"塔塔启蒙"}],_sfc_main={name:"App",components:{TreeCom:_sfc_main$4,DescCom:_sfc_main$3,UseElementSize:UseElementSize,MarkEdit:MarkEdit,SoundTextEdit:SoundTextEdit},setup:()=>({}),data:()=>({locale:localeValues,isOpenDark:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,screenHeight:document.body.clientHeight,screenWidth:document.body.clientWidth,fnData:fnData,curFnInfo:ref(null),symbolData:null,showDataSetIndex:0,showDataSetResult:0,menuItems:menuItems,freshState:!1,currentSelectMenu:ref(["1"]),bookGroup:bookGroup,bookGroupBySearch:bookGroupBySearch,modelTableColumns:[{title:"绘本编号",dataIndex:"name",key:"name",ellipsis:!0,width:"9%"},{title:"名称",dataIndex:"showName",key:"showName",ellipsis:!0,width:"11%",customFilterDropdown:!0,onFilter:(t,e)=>{let i=bookGroup.find((e=>e.label==t));return null!=i&&null!=e.config.group.indexOf&&-1!=e.config.group.indexOf(i.value)||(e.name.toString().toLowerCase().includes(t.toLowerCase())||e.config.name.toLowerCase().includes(t.toLowerCase()))}},{title:"备注（不会出现在App中）",dataIndex:"des",key:"des",ellipsis:!0,width:"18%"},{title:"创建时间",dataIndex:"createTime",key:"createTime",ellipsis:!0,width:"9%"},{title:"发布时间",dataIndex:"publishTime",ellipsis:!0,key:"publishTime",width:"9%"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,width:"15%"}],graphTableColumns:[{title:"预览",dataIndex:"img",key:"img",fixed:"left",width:"130px"},{title:"操作",dataIndex:"action",key:"action",fixed:"right",width:80}],filteredInfo:ref({}),sortedInfo:ref({}),soundBoxColumns:[{title:"资源名称",dataIndex:"name",key:"name",sorter:(t,e)=>sort(t.name,e.name),sortOrder:"ascend"},{title:"版本",dataIndex:"md5",key:"md5"},{title:"分镜使用",dataIndex:"graphUse",key:"graphUse",ellipsis:!0},{title:"操作",dataIndex:"action",key:"action"}],curEditLgraphTable:ref([]),graphTableSelectRows:ref([]),modelTableDatas:ref([]),soundBoxDatas:ref([]),inputModelDes:"",tabActiveKey:ref(menuItems.value[0].key),list2:list2,curEditTabDit:ref({}),curOpenLayout:ref([0,1,1,1,1]),searchConfig:ref([{key:"name",type:"input",value:"",title:"过滤名称"},{key:"group",type:"select",value:[],title:"过滤分组",mode:"tags",width:"200px",maxTagCount:3,options:bookGroup}]),huiceConfig:ref([{key:"name",type:"input",value:"",title:"名称",inBottom:!0},{key:"splitName",type:"input",value:"",title:"简称",inBottom:!0},{key:"author",type:"input",value:"塔塔工作室/文",title:"作者",inBottom:!0},{key:"draw",type:"input",value:"塔塔工作室/绘",title:"绘制",inBottom:!0},{key:"press",type:"input",value:"",title:"出版社",inBottom:!0},{key:"labels",type:"select",value:[],title:"标签",mode:"tags",width:"100%",maxTagCount:3,inBottom:!0},{key:"group",type:"select",value:[],title:"分组",mode:"tags",width:"100%",maxTagCount:3,options:bookGroup,inBottom:!0},{key:"desc",type:"inputArea",value:"",title:"简介",inBottom:!0,placeholder:"请输入绘本简介"},{key:"price",type:"number",value:0,step:1,width:"100%",formatter:t=>`${t}元`,parser:t=>Number(t.replace("元","")),title:"价格",inBottom:!0},{key:"freepage",type:"number",value:0,step:1,width:"100%",formatter:t=>`${t}页`,parser:t=>Number(t.replace("页","")),title:"免费页数",inBottom:!0},{key:"show",type:"bool",value:!0,title:"是否上架",inBottom:!0},{key:"record",type:"bool",value:!1,title:"是否录音",inBottom:!0},{key:"justOld",type:"bool",value:!1,title:"仍然使用旧版绘本",inBottom:!0},{key:"emptyClickEffect",type:"select",value:"",title:"空白处点击效果",width:"100%",inBottom:!0,options:[{value:"",label:"无"},{value:"story/prefab/P12_FJ0_AN",label:"气泡"},{value:"story/prefab/P08_FJ0_AN",label:"萤火虫光"}]}]),ruleChooseTabOption:"蓝图",checkAllRule:!1,checkIndeterminate:!0,newPolicyName:"",copyToProject:"",newProjectName:"",celueLiebiaoCardHeight:0,celueLiebiaoBodyHeight:0,canvasHeight:0,canvasWidth:0,gameCanvasWidth:320,gameCanvasHeight:180,gameCanvasCardWidth:0,gameCanvasCardHeight:180,previewCardMinWidth:332,previewCardMinHeight:229,width:320,height:180,workSpaceHeight:200,celueEditBodyHeight:0,expandPolicyList:!1,policyShowKey:"none",policySortKey:"none",policySortKeyIsDown:!1,freshCheckBool:!0,freshResultList:!0,items:[],showByKeyOptions:[{value:"none",label:"无"},{value:"xiapuPresent",label:"夏普比率"},{value:"suotinuoPresent",label:"索提诺比率"},{value:"yearPresent",label:"年化收益"},{value:"jiaoyiWinPresent",label:"胜率"},{value:"jiaoyiCount",label:"交易次数"},{value:"maxHuice",label:"最大回撤"}],importModelOpen:!1,importOldVersionConfig:ref([{key:"bookFolder",type:"input",value:"/Users/yaowei/Documents/work/tataread2026/assets/bundleStory/880012",width:"400px",title:"绘本目录",des:"选择Cocos AssestBundle下的书本目录",isPath:!0,inBottom:!0},{key:"bookId",type:"input",value:"",title:"绘本编号",inBottom:!0}]),createMotionTextConfig:ref([{key:"content",type:"input",value:"",title:"内容",inBottom:!0}]),importCheckedIndeterminate:!1,importCheckedPageList:ref([]),importPageOptions:ref([]),importCheckAll:!1,editColiderOpen:!1,editSoundTextOpen:!1,editSoundTextParams:{},editColiderImg:"",pointArr:[],editColiderScale:1,importProgress:0,importInfo:"0/0",waitImportProject:null,ruleMenu:[],moreActionMenu:[],isShowMenu:!1,cocosPreviewTreeWidth:0,cocosPreviewTreeData:[],expandedKeys:[],fileList:[],highlightNodeDit:{},outputLinkMenu:ref([]),inputLinkMenu:ref([]),waitLink:{},cocosConfig:{cocosPreviewIsShowTree:!1,cocosPreviewIsShowState:!1,cocosPreviewIsShowGird:!1,cocosPreviewCanDrag:!1,isPreviewMode:!0,cocosPreviewIsShowColiderBox:!1,mute:!1,radioLock:!1,radio:"2560:1500",aspectRadio:.5859375,radioOptions:[{value:"无比例",label:"无比例"},{value:"16:9",label:"常规显示器"},{value:"4:3",label:"ipad"},{value:"19.5:9",label:"iPhone全面屏"},{value:"2560:1500",label:"绘本设计分辨率"}]},systemSetting:ref([{key:"accessKeyId",type:"input",value:"",width:"400px",title:"accessKeyId",inBottom:!0},{key:"accessKeySecret",type:"input",value:"",title:"accessKeySecret",inBottom:!0},{key:"bucket",type:"input",value:"",title:"bucket",inBottom:!0},{key:"cloudHost",type:"input",value:"",title:"cloudHost",inBottom:!0},{key:"xunfeiAppid",type:"input",value:"",width:"400px",title:"xunfeiAppid",inBottom:!0},{key:"xunfeiApiSecret",type:"input",value:"",width:"400px",title:"xunfeiApiSecret",inBottom:!0},{key:"xunfeiApiKey",type:"input",value:"",width:"400px",title:"xunfeiApiKey",inBottom:!0}]),copyedNode:{},configs:{showNameColumn:!1,uploadReplaceAssestByName:!0,recordType:"none"},showCreateMotionTextModal:!1,showSoundBoxModal:!1,verificationCode:"",showKeyboard:!0,justCurrentPage:!0,curShowAssestBoxType:""}),watch:{policySortKey(t,e){this.sortPolicyList()},policySortKeyIsDown(t,e){this.sortPolicyList()},currentSelectMenu(t,e){console.log("newValue",t[0],e[0])},ruleChooseTabOption(t,e){null!=this.waitLink.nodeObj&&(this.$message.info({content:"绑定取消",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={}),"表格"==t&&this.getCurEditLgraphTable()},tabActiveKey(t,e){console.log("tabActiveKey",t,e),0!=e&&this.onClickSaveBtn(e),0!=t&&(this.freshCurEdit(),this.$nextTick((()=>{this.calculateHeight()})),this.copyToProject=t),0==t?(this.clearCurEditLgragh(e),null!=this.lgcanvas&&(this.lgcanvas.clear(),this.lgcanvas=null)):(t!=e&&this.clearCurEditLgragh(e),this.$nextTick((()=>{this.updateCurShowLGraph()})))}},async mounted(){let t=localStorage.getItem("BookEdit_curOpenLayout");null!=t&&(this.curOpenLayout=JSON.parse(t)),this.previewCardMinHeight=(this.previewCardMinWidth-10)*(designViewHeight/designViewWidth)+10+38,window.channel=new BroadcastChannel("BookEditFM"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{this.isOpenDark=t.matches}));let e=localStorage.getItem("bookEditConfig");if(null!=e)try{e=JSON.parse(e);for(var i=0;i<this.systemSetting.length;i++)null!=e[this.systemSetting[i].key]&&(this.systemSetting[i].value=e[this.systemSetting[i].key]);setRootHost(e.cloudHost),ossClient=new aliyunOssSdk({region:"oss-cn-shanghai",accessKeyId:e.accessKeyId,accessKeySecret:e.accessKeySecret,bucket:e.bucket});const t=await ossClient.listV2({prefix:"bookEditProject/",delimiter:"/"});VoiceCheck$1.setConfig(e.xunfeiAppid,e.xunfeiApiSecret,e.xunfeiApiKey),console.log("云端文件列表",t.objects)}catch(n){console.log("初始化云储存失败",n),this.$message.error("初始化云储存失败:"+n,0)}else this.$message.warn("使用前请先进行系统设置",0);document.title="绘本编辑器",window.onresize=()=>(()=>{this.screenHeight=document.body.clientHeight,this.screenWidth=document.body.clientWidth,this.calculateHeight()})(),window.onChangeGraph=this.onChangeGraph,window.onGraphMenuClick=this.onGraphMenuClick,window.onGraphNodeClick=this.onGraphNodeClick,window.uploadGroupFile=this.uploadGroupFile,window.setDropXY=(t,e)=>{this.dropedX=t,this.dropedY=e},window.antAleart=t=>{this.$message.warn(t)};var r=await this.getFromLocalOrCloud(TableDataSaveKey);null!=r&&r.forEach((t=>{this.modelTableDatas.push(t)})),this.calculateHeight(),this.ruleMenu=this.getMenu(""),this.ruleMenu.push({key:"onestep/",label:"快捷操作",has_submenu:!0,icon:h$1(ToolOutlined),children:[{key:"viewToCenter",label:"重置界面中心点",has_submenu:!1},{key:"autoSetAni",label:"自动设置动画",has_submenu:!1},{key:"layoutNodes",label:"扩散节点",has_submenu:!1},{key:"layoutNodesJustX",label:"向右扩散节点",has_submenu:!1},{key:"girdNodes",label:"优化节点排列",has_submenu:!1},{key:"collase",label:"折叠节点",has_submenu:!0,children:[{key:"collapseAll_objects/createObject",label:"折叠所有物体节点",has_submenu:!1},{key:"collapseAll_objects/animates/animate",label:"折叠所有骨骼动画节点",has_submenu:!1},{key:"collapseAll",label:"折叠所有节点",has_submenu:!1}]},{key:"expand",label:"展开节点",has_submenu:!0,children:[{key:"expandAll_objects/createObject",label:"展开所有物体节点",has_submenu:!1},{key:"expandAll_objects/animates/animate",label:"展开所有骨骼动画节点",has_submenu:!1},{key:"expandAll_middle/change/timeDown",label:"展开所有延迟触发节点",has_submenu:!1},{key:"expandAll_middle/tool/acceptData",label:"展开无线传送接收",has_submenu:!1},{key:"expandAll_middle/tool/sendData",label:"展开无线传送发送",has_submenu:!1},{key:"expandAll",label:"展开所有节点",has_submenu:!1}]},{key:"soundBox",label:"音频库",has_submenu:!1},{key:"spineBox",label:"动画库",has_submenu:!1}]}),this.moreActionMenu=[{key:"deleteNode",label:"删除指令",has_submenu:!1},{key:"addMenus",label:"添加指令",has_submenu:!0,children:this.ruleMenu},{key:"copyNode",label:"复制",has_submenu:!1},{key:"pasteNode",label:"粘贴",has_submenu:!1},{key:"toggleToGraph",label:"定位到蓝图",has_submenu:!1}],console.log("最终的menu",this.ruleMenu)},methods:{onUpdate(t){console.log("onUpdate",t)},onEnd(){console.log("onEnd",this.modelTableDatas)},pushTo(t){this.$router.push(t)},jumpTo(t){this.$router.replace(t)},formatTime:t=>null==t?"":hooks(t).format("YYYY/MM/DD HH:mm:ss"),async getFromLocalOrCloud(t){let e=arrToDit(this.systemSetting,"key","value").cloudHost;try{var i=await axios.get(e+"/bookEditProject/"+t+".json?timestamp="+(new Date).getTime());if("object"==typeof i.data)return i.data;this.$message.error("不存在Json文件:/bookEditProject/"+t+".json",3)}catch(r){this.$message.error("网络出错，获取云端数据失败:"+r,3)}},async setToLocalOrCloud(t,e){if(null!=ossClient)try{let i=new Blob([JSON.stringify(e)],{type:"text/plain"});return await ossClient.put("bookEditProject/"+t+".json",i),!0}catch(i){this.$message.error("保存"+t+"失败:"+i,3)}else this.$message.error("当前没有访问远程资源权限！请先设置AccessKey")},async delToLocalOrCloud(t){null!=ossClient?await ossClient.delete("bookEditProject/"+t+".json"):this.$message.error("当前没有访问远程资源权限！请先设置AccessKey")},getMenu(t){var e={"middle/":h$1(ApiOutlined),"input/":h$1(LogoutOutlined),"output/":h$1(LoginOutlined),"objects/":h$1(BuildOutlined),"onestep/":h$1(ToolOutlined)},i=LiteGraph.getNodeTypesCategories().filter((e=>e.startsWith(t))),r=[];for(const o of i){if(!o)continue;const i=new RegExp(`^(${t})`),s=o.replace(i,"").split("/",1)[0],a=""===t?`${s}/`:`${t}${s}/`;let l=s;l.includes("::")&&(l=l.split("::",2)[1]);const c=r.findIndex((t=>t.key===a));if(-1===c){var n={key:a,label:zhString[l]?zhString[l]:l,has_submenu:!0,children:this.getMenu(a)};null!=e[a]&&(n.icon=e[a]),r.push(n)}}const s=LiteGraph.getNodeTypesInCategory(t.slice(0,-1));for(const o of s){if(o.skip_list)continue;const t={key:o.type,label:zhString[o.title]?zhString[o.title]:o.title,has_submenu:!1};r.push(t)}return r},getResArr(t,e,i){let r=this.curEditTabDit[this.tabActiveKey].policyList;if(1==i){let t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;r=r.filter((e=>e.name==t))}let n={},s=[];for(var o=0;o<r.length;o++){let e=r[o].graphJson;if(null!=e)for(var a=0;a<e.nodes.length;a++){let i=e.nodes[a];if(null!=i.properties.customeName){let e={graphUse:[r[o].name],nodeId:i.id,customeName:i.properties.customeName},s=!1;"output/sound"==i.type?-1!=t.indexOf("sound")&&(e.md5=i.properties.customeName.split(".")[1],e.name=i.properties.customeName.split(".")[0],e.type="sound",s=!0):"objects/createObject"==i.type&&(i.properties.modal==ObjectTypeEnum.spine?-1!=t.indexOf("spine")&&(e.md5=i.properties.customeName.split("/")[0],e.name=i.properties.customeName.split("/")[1],e.type="spine",null==e.name&&(e.name=e.md5),s=!0):i.properties.modal==ObjectTypeEnum.sprite&&-1!=t.indexOf("sprite")&&(e.md5=i.properties.customeName.split(".")[1],e.name=i.properties.customeName.split(".")[0],e.type="image",s=!0)),s&&(null!=n[e.customeName]?n[e.customeName].graphUse.push(r[o].name):n[e.customeName]=e)}}}if(1==e)return n;for(var l in n)s.push(n[l]);return s},replaceFileGrpup(t){let e=this.getCurEditLGraph();if(null==e)return;let i=!1,r=getFileType(t.type);if("音频"==r){let r=e.findNodesByType("output/sound");for(var n=0;n<r.length;n++){let e=r[n];e.properties.customeName.split(".")[0]==t.name&&(e.setProperty("customeName",t.customeName),i=!0)}}else if("图片"==r){let r=e.findNodesByType("objects/createObject");for(n=0;n<r.length;n++){let e=r[n];e.properties.modal==ObjectTypeEnum.sprite&&e.properties.customeName.split(".")[0]==t.name&&(e.setProperty("customeName",t.customeName),e.onWidgetChanged("资源"),i=!0)}}else if("spine"==r){let r=e.findNodesByType("objects/createObject");for(n=0;n<r.length;n++){let e=r[n];e.properties.modal==ObjectTypeEnum.spine&&e.properties.customeName.split("/")[1]==t.name&&(e.setProperty("customeName",t.customeName),e.onWidgetChanged("资源"),i=!0)}}return i},replaceFileGroupByBook(t){let e=this.curEditTabDit[this.tabActiveKey].policyList;for(var i=0;i<e.length;i++){let n=e[i].graphJson;if(null!=n)for(var r=0;r<n.nodes.length;r++){let e=n.nodes[r];null!=e.properties.customeName&&("output/sound"==e.type?e.properties.customeName.split(".")[0]==t.name&&(e.properties.customeName=t.customeName):"objects/createObject"==e.type&&(e.properties.modal==ObjectTypeEnum.spine?e.properties.customeName.split("/")[1]==t.name&&(e.properties.customeName=t.customeName):e.properties.modal==ObjectTypeEnum.sprite&&e.properties.customeName.split(".")[0]==t.name&&(e.properties.customeName=t.customeName)))}}},onClickMenuItem(t,e,i,r){if(null!=this.waitLink.nodeObj&&(this.$message.info({content:"绑定取消",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={}),"viewToCenter"==t.key){if(0!=(o=this.getCurEditLGraph()).nodes.length){const t=createBounds(o.nodes);this.lgcanvas.animateToBounds(t,{zoom:1})}}else if("autoSetAni"==t.key)for(var n=(o=this.getCurEditLGraph()).findNodesByType("objects/animates/animate"),s=0;s<n.length;s++){let t=n[s];t.getEnums(!0);let e=t.getInputNode(1);if(null!=e&&"objects/animates/animate"==e.type){let i=e.getRealLinkNode(),r=t.getRealLinkNode();null!=i&&null!=r&&i.id==r.id&&t.setProperty("softChange",!1)}null==e&&t.setProperty("softChange",!1)}else if("autoSetOldData"==t.key){for(n=(o=this.getCurEditLGraph()).findNodesByType("objects/animates/animate"),s=0;s<n.length;s++){let t=n[s];t.getEnums(!0);let e=t.getInputNode(1);if(null!=e&&"objects/animates/animate"==e.type){let i=e.getRealLinkNode(),r=t.getRealLinkNode();null!=i&&null!=r&&i.id==r.id&&t.setProperty("softChange",!1)}null==e&&t.setProperty("softChange",!1)}let t=o.findNodesByType("objects/animates/tween");for(let e=0;e<t.length;e++){let i=t[e];if("变化目标值"==i.properties.tweenMode){let t=i.getInputData(0,!0);null!=t&&(i.setProperty("anchorX",t.anchorX),i.setProperty("anchorY",t.anchorY),i.setProperty("width",t.width),i.setProperty("height",t.height),i.setProperty("color","#"+t.color))}else"变化多少值"==i.properties.tweenMode&&(i.setProperty("anchorX",0),i.setProperty("anchorY",0),i.setProperty("width",0),i.setProperty("height",0),i.setProperty("color","#000000"))}}else if("layoutNodes"==t.key){var o=this.getCurEditLGraph();let t=()=>{let e=!1;for(let t=0;t<o.nodes.length;t++){let i=o.nodes[t];for(let t=0;t<o.nodes.length;t++){let r=o.nodes[t];r.id!=i.id&&(overlapBounding(i.boundingRect,r.boundingRect)&&(i.pos[0]<=r.pos[0]?r.pos=[r.pos[0]+11,r.pos[1]]:i.pos=[i.pos[0]+11,i.pos[1]],i.pos[1]<=r.pos[1]?r.pos=[r.pos[0],r.pos[1]+10]:i.pos=[i.pos[0],i.pos[1]+10],e=!0))}}o.setDirtyCanvas(!0,!0),1==e&&setTimeout((()=>{t()}),10)};t()}else if("layoutNodesJustX"==t.key){o=this.getCurEditLGraph();let t=()=>{let e=!1;for(let t=0;t<o.nodes.length;t++){let i=o.nodes[t];for(let t=0;t<o.nodes.length;t++){let r=o.nodes[t];r.id!=i.id&&(overlapBounding(i.boundingRect,r.boundingRect)&&(i.pos[0]<=r.pos[0]?r.pos=[r.pos[0]+3,r.pos[1]]:i.pos=[i.pos[0]+3,i.pos[1]],e=!0))}}o.setDirtyCanvas(!0,!0),1==e&&setTimeout((()=>{t()}),10)};t()}else if("girdNodes"==t.key){if(0==(o=this.getCurEditLGraph()).nodes.length)return;let t=0;const e=createBounds(o.nodes);let i=0,r=e[1]+e[3]+50;var a=o.findNodesByType("objects/createObject");a.sort(((t,e)=>t.properties.zIndex-e.properties.zIndex));for(s=0;s<a.length;s++){let e=a[s],n=e.getOutputNodes(0)||[],o=!0;for(let t=0;t<n.length;t++){let e=n[t];if(e.isAnyOutputConnected()){o=!1;break}for(var l=1;l<e.inputs.length;l++)if(null!=e.getInputLink(l)){o=!1;break}}if(1==o){e.pos=[i,r];let s=0;i+=e.width+3;let o=r;for(let e=0;e<n.length;e++){let o=n[e];o.pos=[i,r],r+=o.height+3,s<o.width&&(s=o.width),t<r&&(t=r)}i+=s+3,r=o,t<r+e.height&&(t=r+e.height)}}let n=o.findNodesByType("output/sound");i=0,r=t+100;for(s=0;s<n.length;s++){let t=n[s];0==t.isAnyOutputConnected()&&0==t.isAnyInputConnected()&&(t.pos=[i,r],i+=t.width+5)}}else if(-1!=t.key.indexOf("expandAll")||-1!=t.key.indexOf("collapseAll")){var c=t.key.split("_"),h="expandAll"==c[0],u=c[1];let e=(o=this.getCurEditLGraph()).nodes;null!=u&&(e=o.findNodesByType(u));for(s=0;s<e.length;s++){let t=e[s];t.collapsed==h&&t.collapse()}}else if("deleteNode"==t.key){let t=e[i][r];if(null!=t){let n=(o=this.getCurEditLGraph()).getNodeById(t.id);o.remove(n),e[i].splice(r,1)}}else if("copyNode"==t.key){let t=e[i][r];null!=t?this.copyedNode={type:t.type}:this.$message.info("没有可复制的指令")}else if("pasteNode"==t.key)null!=this.copyedNode.type?this.onClickMenuItem({key:this.copyedNode.type},e,i,r):this.$message.info("没有可粘贴的指令");else if("topMenus"==t.key);else if("toggleToGraph"==t.key){let t=e[i][r];null!=t&&this.toggleNodeIdToGraph(t.id)}else if("createMotionText"==t.key)this.showCreateMotionTextModal=!0;else if("soundBox"==t.key||"spineBox"==t.key||"imageBox"==t.key)this.curShowAssestBoxType=t.key,this.freshAssestBoxData(),this.showSoundBoxModal=!0;else{o=this.getCurEditLGraph();let r=null;null!=e&&(r=o.getNodeById(e.id));let n=this.addNodeToGraph(t.key,r);if(null==n)return;if(null!=t.initProp){for(var d in t.initProp)n.setProperty(d,t.initProp[d]);null!=n.onWidgetChanged&&n.onWidgetChanged("物体类型")}if(null!=r){let t=n.findSlotByType(!0,"codeNode");-1!=t&&r.connect(0,n,t)}if(null!=e){let t=this.genOneNodeToTableCell(n);e[i].push(t)}"表格"==this.ruleChooseTabOption&&(null==e||"objects/createObject"==t.key||"output/tips/showHandTip"==t.key||"objects/camera"==t.key)&&this.getCurEditLgraphTable()}},freshAssestBoxData(){let t=this.justCurrentPage;"soundBox"==this.curShowAssestBoxType?this.soundBoxDatas=this.getResArr(["sound"],!1,t):"spineBox"==this.curShowAssestBoxType?this.soundBoxDatas=this.getResArr(["spine"],!1,t):"imageBox"==this.curShowAssestBoxType&&(this.soundBoxDatas=this.getResArr(["sprite"],!1,t))},onBtnDeleteTableRow(t,e){console.log("点击删除row",t,e);var i=this.getCurEditLGraph();for(var r in e)if(-1!=r.indexOf("linkNode"))for(var n=0;n<e[r].length;n++){let t=e[r][n],s=i.getNodeById(t.id);if(null!=s&&"codeNode"==s.getInputDataType(0)){let t=s.getInputNode(0);null!=t&&t.id==e.id&&i.remove(s)}}let s=i.getNodeById(e.id);null!=s&&i.remove(s),this.getCurEditLgraphTable()},toggleNodeIdToGraph(t){let e=this.getCurEditLGraph().getNodeById(t);if(null!=e){this.ruleChooseTabOption="蓝图",e.selected=!0,e.onSelected&&e.onSelected(),e.collapsed&&e.collapse();let t=createBounds([e]);this.lgcanvas.animateToBounds(t,{zoom:1})}},onMenuOpenChange(t){0==t.length?this.isShowMenu=!1:this.isShowMenu=!0},onClickChangeShowView(t){this.curOpenLayout[t]=!this.curOpenLayout[t],localStorage.setItem("BookEdit_curOpenLayout",JSON.stringify(this.curOpenLayout)),this.$nextTick((()=>{this.calculateHeight()}))},getProjectOptions(){return this.modelTableDatas.map((t=>({value:t.name,label:t.name})))},addItems(t=1){for(let e=0;e<t;e++)this.items.push({text:1e3*Math.random()+"随机数字",id:this.items.length+1});this.scrollToBottom()},scrollToBottom(){},onSymbolInput(t){console.log("onInputSymbol",t),this.inputSymbol=t},onChangeDataPicker(t){console.log("onChangeDataPicker",t);var e=t[0].format("YYYY/MM/DD"),i=t[1].format("YYYY/MM/DD");this.inputSymbolDate=e+"-"+i},calculateHeight(){var t=document.getElementById("tabHtml").getElementsByClassName("ant-tabs-nav")[0];if(null!=t){var e=t.getBoundingClientRect().height;this.workSpaceHeight=this.screenHeight-e;var i=document.getElementById("canvasCard"),r=document.getElementById("leftFlexView");let a=document.getElementById("huiceConfigCard").getBoundingClientRect();if(this.celueEditBodyHeight=this.workSpaceHeight-20-38,this.canvasWidth=this.screenWidth-20-2,null!=r){var n=r.getBoundingClientRect();this.canvasWidth=this.screenWidth-n.width-30}if(null!=i){i.getBoundingClientRect();var s=i.getElementsByClassName("ant-card-head")[0];if(null!=s){var o=s.getBoundingClientRect();this.celueLiebiaoBodyHeight=this.workSpaceHeight-a.height-5-o.height-20-1,this.canvasHeight=this.workSpaceHeight-o.height-20-1}}}else console.warn("navObj == null")},getCardBodyHeight(t){var e=document.getElementById(t);if(null!=e){var i=e.getElementsByClassName("ant-card-head")[0];if(null!=i){var r=e.getBoundingClientRect(),n=i.getBoundingClientRect();this[t+"Height"]=r.height-n.height-10,console.log("getCardBodyHeight",this[t+"Height"])}}else this.$nextTick((()=>{var e=document.getElementById(t);if(null!=e){var i=e.getElementsByClassName("ant-card-body")[0];if(null!=i){var r=e.getBoundingClientRect(),n=i.getBoundingClientRect();this[t+"Height"]=r.height-n.height-10,console.log("getCardBodyHeight",this[t+"Height"])}}else console.log("等待了1秒还是没有找到height")}));return 0},handleSortTagChange(t){console.log("handleSortTagChange",t,this.sortTableDatas)},handleYkeyChoose(t,e){var i=t.key,r=e;this.girdMap["y_"+r]=i,console.log("y_"+r,i)},onRuleEditFocus(t){console.log("onRuleEditFocus",t),this.curEditSortRule=t},insertRuleText(t,e){if(null!=this.curEditSortRule){var i=this.sortTableDatas.findIndex((t=>t.name==this.curEditSortRule));i>-1&&null!=this.sortTableDatas[i].codeMirror&&this.sortTableDatas[i].codeMirror.insertText(t,e)}},hoverFn(t){this.curFnInfo=functionDescription[t],console.log("hoverFn",this.curFnInfo)},insertFn(t){t.children||this.insertRuleText(`${t.title}`,"fn")},async run(){},async onBtnCreateModel(t,e){var i=(e+="").replace(/\s/g,"");if(i==TableDataSaveKey)return this.$message.error("绘本编号不能为预置字符串"),!1;if(""==i)return this.$message.error("绘本编号为空"),!1;if(this.modelTableDatas.findIndex((t=>t.name==e))>=0)return this.$message.error("当前已存在绘本："+e),!1;var r={key:e,name:e,des:""!=this.inputModelDes?this.inputModelDes:"创建时间："+hooks().format("YYYY/MM/DD HH:mm:ss"),createTime:hooks().format("YYYY/MM/DD HH:mm:ss"),policyList:[],config:{}};return null!=t&&(r.config=t.config,r.policyList=t.policyList),await this.setToLocalOrCloud(POLICYKEY+r.name,JSON.parse(JSON.stringify(r))),this.modelTableDatas.push(r),await this.saveTableData(),!0},async onBtnCopyModel(t){let e=this.modelTableDatas.findIndex((e=>e.name==t));if(-1!=e){var i=this.modelTableDatas[e];if(null!=i&&null!=i.name)var r=await this.getFromLocalOrCloud(POLICYKEY+i.name);this.onBtnCreateModel(r,this.newProjectName)}},async onBtnRenameProject(t){if(-1==this.modelTableDatas.findIndex((t=>t.name==this.newProjectName))){var e=this.modelTableDatas.findIndex((e=>e.name==t));if(-1!=e){try{var i=await this.getFromLocalOrCloud(POLICYKEY+this.modelTableDatas[e].name);await this.delToLocalOrCloud(POLICYKEY+this.modelTableDatas[e].name),i.name=this.newProjectName,i.key=this.newProjectName,await this.setToLocalOrCloud(POLICYKEY+this.newProjectName,i)}catch(r){return void api.error("重命名失败："+r)}this.modelTableDatas[e].name=this.newProjectName,this.saveTableData()}}else api.error("重命名失败，已存在绘本："+this.newProjectName)},getCoverUrl:t=>null==t.cover||""==t.cover?"https://cdn.goowee.cn/appres/bookcover/"+t.name+".png":rootHost+"/"+t.cover,handleChangeCover(t){console.log("handleChangeCover",t)},handleDropCover(t){console.log("handleDropCover",t)},handleUploadCover:t=>(console.log("handleUploadCover",t),!0),async onConfigChangeSave(t){t.config=arrToDit(this.huiceConfig,"key","value");var e=await this.getFromLocalOrCloud(POLICYKEY+t.name);e.config=t.config,await this.setToLocalOrCloud(POLICYKEY+t.name,e),this.saveTableData();var i=menuItems.value.findIndex((e=>e.key==t.name));-1!=i&&(menuItems.value[i].modeJson.config=t.config)},onClickTableConfig(t){if(console.log("onClickTableConfig",t.config),null!=t.config)for(var e=0;e<this.huiceConfig.length;e++){var i=this.huiceConfig[e].key;null!=t.config[i]&&(this.huiceConfig[e].value=t.config[i])}},async onBtnEditProjectDes(t){var e=this.modelTableDatas.findIndex((e=>e.name==t));-1!=e&&(this.modelTableDatas[e].des=this.inputModelDes,this.saveTableData())},robotToGraphNode(t){if(null!=robotNodeEnum[t.config.key]){let i=LiteGraph.createNode(robotNodeEnum[t.config.key]);for(var e in t.config.otherConfig){let r=t.config.otherConfig[e];if(null!=i.properties[e]){let n=i.widgets.find((t=>t.options.property==e));null!=n&&"combo"==n.type&&Array.isArray(n.options.values)&&(null!=n.options.values[r]?r=n.options.values[r]:console.warn("widget没有对应的值",e,r)),"sound"==t.config.key&&("loop"==e?r=!r:"volume"==e&&(r*=.1)),"createObject"==t.config.key&&("scaleX"!=e&&"scaleY"!=e&&"anchorX"!=e&&"anchorY"!=e||(r*=.1),"color"!=e&&"outLineColor"!=e||(r="#"+r)),"camera"==t.config.key&&"zoomRatio"==e&&(r*=.1),"animate"==t.config.key&&("timeScale"==e&&(r*=.1),"loop"!=e&&"cancelEvent"!=e&&"aniEndCanClick"!=e||(r=!r)),"touchEnd"==t.config.key&&"listernTouchCancel"==e&&(r=!r),"tween"==t.config.key&&("cancelEvent"==e&&(r=!r),"delay"!=e&&"duration"!=e&&"scaleX"!=e&&"scaleY"!=e&&"zoomRatio"!=e||(r*=.1)),"bezierCurve"==t.config.key&&("duration"==e&&(r*=.1),"startResetT"==e&&(r=!r)),"showHandTip"==t.config.key&&"scale"==e&&(r*=.1),i.setProperty(e,r)}else console.warn("node没有对应配置",e,t.config.key,t.config.otherConfig[e])}return"tween"==t.config.key&&1==t.config.otherConfig.tweenMode&&(i.setProperty("anchorX",0),i.setProperty("anchorY",0),i.setProperty("width",0),i.setProperty("height",0)),i}return console.warn("没有对应的graphNode",t.config.key),null},filterPageList:t=>t.filter((t=>{let e=t.split(".");return"json"==e[e.length-1]&&(-1==t.indexOf("_std")&&(-1!=t.indexOf("_")&&-1==t.indexOf("_kepu")))})).sort(((t,e)=>{let i=t.indexOf("p")+1,r=t.indexOf("."),n=t.substring(i,r),s=e.indexOf("p")+1,o=e.indexOf("."),a=e.substring(s,o);return Number(n)-Number(a)})),onFreshCanImportPage(){if(null==window.require)return void this.$message.warn("此功能仅在桌面版可用，网页版无法使用");let t=window.require("fs"),e=arrToDit(this.importOldVersionConfig,"key","value"),i=[];1==t.existsSync(e.bookFolder+"/json")&&(i=t.readdirSync(e.bookFolder+"/json"),i=this.filterPageList(i)),this.importPageOptions=i,this.importCheckedPageList=i,this.importCheckAll=!0,this.importCheckedIndeterminate=!1},onImportOldVersionConfigChange(t){"bookFolder"==t&&this.onFreshCanImportPage()},onImportPageCheck(){this.importCheckedIndeterminate=!!this.importCheckedPageList.length&&this.importCheckedPageList.length<this.importPageOptions.length,this.importCheckAll=this.importCheckedPageList.length===this.importPageOptions.length},onCheckAllChange(t){this.importCheckedPageList=t.target.checked?this.importPageOptions:[],this.importCheckedIndeterminate=!1,this.importCheckAll=t.target.checked,console.log(this.importCheckedPageList)},async handleOkImport(){if(null==window.require)return void this.$message.warn("此功能仅在桌面版可用，网页版无法使用");let t=window.require("fs"),e=arrToDit(this.importOldVersionConfig,"key","value"),i=["image","sound","spine"];if(0==t.existsSync(e.bookFolder+"/json"))return void this.$message.error("所选目录下json文件夹不存在");for(var r=0;r<i.length;r++){let n=e.bookFolder+"/"+i[r];if(0==t.existsSync(n))return void this.$message.error("所选目录下"+i[r]+"文件夹不存在")}let n=[],s={};for(r=0;r<i.length;r++){let l=e.bookFolder+"/"+i[r],c=t.readdirSync(l);if(c=c.filter((t=>-1==t.indexOf(".meta"))).map((t=>({name:getName(t),path:e.bookFolder+"/"+i[r]+"/"+t}))),"spine"==i[r])for(var o=0;o<c.length;o++)if(-1!=c[o].path.indexOf(".json")){let e=JSON.parse(t.readFileSync(c[o].path,"utf-8"));if(null!=e.events)for(var a in e.events)null==s[getBaseName(c[o].name)]&&(s[getBaseName(c[o].name)]=[]),s[getBaseName(c[o].name)].push(a)}n=n.concat(c)}let l=await this.prepareDealFiles(n),c={};for(let p=0;p<l.length;p++)c[l[p].name]=l[p].path;console.log("filesDit",c),console.log("spineEventSound",s);let h=[];changeRunInmportState(!0);let u=this.importCheckedPageList;for(r=0;r<u.length;r++){let i=u[r],n=JSON.parse(t.readFileSync(e.bookFolder+"/json/"+i,"utf-8")),o=new LGraph,a={},l={};for(let t=0;t<n.length;t++){let e=n[t];l[e.id]=e;let i=this.robotToGraphNode(e);if(null!=i){if("createObject"==e.config.key){let t=e.config.otherConfig.customeName,r=e.config.otherConfig.modal;if(1==r)null!=c[t]?i.setProperty("customeName",c[t]):-1==t.indexOf(".")&&(t+=".png",i.setProperty("customeName",t));else if(3==r&&(null!=c[t]?i.setProperty("customeName",c[t]):"P0_Common_Finger"==t&&i.setProperty("premulAlpha",!1),null!=s[t]))for(var d=0;d<s[t].length;d++){let e=s[t][d];if(null!=c[e]){let t=LiteGraph.createNode("output/sound");t.setProperty("customeName",c[e]),o.add(t),console.log("添加了声音节点",c[e])}}}else if("sound"==e.config.key){let t=e.config.otherConfig.customeName;null!=c[t]&&i.setProperty("customeName",c[t])}i.pos=[e.nodeValue.x,-e.nodeValue.y],o.add(i),a[e.id]=i.id}}for(let t=0;t<n.length;t++){let e=n[t];if(null!=a[e.id]){let t=o.getNodeById(a[e.id]),i=Object.keys(e.linkDatas.outputSolt);for(let r=0;r<i.length;r++){let n=i[r];for(let i=0;i<e.linkDatas.outputSolt[n].length;i++){let s=e.linkDatas.outputSolt[n][i],c=l[s.robot],h=Object.keys(c.linkDatas.inputSolt).indexOf(s.otherSolt),u=a[s.robot];if(null!=u){let n=o.getNodeById(u);"cardTopSolt"==s.otherSolt?(n.addOutput("被引用","lgraphNode"),n.connect(n.outputs.length-1,t,r)):(null!=n.inputs[0]&&"codeNode"==n.inputs[0].type&&(h+=1),console.log(e.config.key,"准备连接节点",i,e,n,r,h,n.getInputDataType(0)),-1!=h&&t.connect(r,n,h))}}}for(let r=0;r<e.linkDatas.cardacSolt.length;r++){let i=a[e.linkDatas.cardacSolt[r].robot];if(null!=i){let e=o.getNodeById(i),r=t.findOutputByType("codeNode"),n=e.findInputByType("codeNode");null!=n&&null!=r&&-1!=n.index&&-1!=r.index&&t.connect(r.index,e,n.index)}}if(-1!=["connection"].indexOf(e.config.key)){console.log("needConnectExSoltNode",e);for(let i=0;i<e.linkDatas.cardacSolt.length;i++){let r=a[e.linkDatas.cardacSolt[i].robot];if(null!=r){let e=o.getNodeById(r),i=e.findOutputByType("codeNode"),n=t.inputs.findIndex((t=>"codeNode"==t.type&&null==t.link));if(-1==n&&null!=t.onGetInputs){let e=t.onGetInputs(),i=e.findIndex((t=>"codeNode"==t[1]));-1!=i&&(t.addInput(e[i][0],e[i][1]),n=t.inputs.length-1)}-1!=n&&null!=i&&-1!=i.index&&e.connect(i.index,t,n)}}}}}h.push(o)}if(console.log("newGraphList",h),1==await this.onBtnCreateModel(null,e.bookId)){let t=await this.getFromLocalOrCloud(POLICYKEY+e.bookId);if(null!=t){t.policyList=h.map(((t,e)=>({name:null!=u[e]?getBaseName(u[e]):"页面"+e,graphJson:t.asSerialisable()})));for(r=0;r<h.length;r++)h[r].clear();changeRunInmportState(!1),await this.setToLocalOrCloud(POLICYKEY+e.bookId,t),this.importModelOpen=!1}else changeRunInmportState(!1)}else changeRunInmportState(!1)},async onBtnLoadModel(t){if(-1==menuItems.value.findIndex((e=>e.key==t)))if(-1!=this.modelTableDatas.findIndex((e=>e.name==t))){var e=await this.getFromLocalOrCloud(POLICYKEY+t);null!=e?(console.log("当前打开的modeljson",e),null!=e.policyList&&e.policyList.forEach((t=>{null==t.active&&(t.active=!0)})),menuItems.value.push({title:e.name,label:"Content of new Tab "+e.name,key:e.name,modeJson:e}),this.tabActiveKey=e.name):this.$message.error("打开失败，绘本缺失："+t)}else this.$message.info("列表中不存在绘本："+t);else this.tabActiveKey=t},getPolicyState(t,e){null==t&&(t=this.tabActiveKey);var i=this.curEditTabDit[t];return null==i||""==i.curSelectPolicy?null:(null==i.policyState[i.curSelectPolicy]&&(i.policyState[i.curSelectPolicy]={resultSymbolList:[],curSelectSymbolItem:{},progress:0}),null!=e?i.policyState[i.curSelectPolicy][e]:i.policyState[i.curSelectPolicy])},getPolicyStateByName(t,e,i){null==t&&(t=this.tabActiveKey);var r=this.curEditTabDit[t];return null==r?null:(null==r.policyState[e]&&(r.policyState[e]={resultSymbolList:[],curSelectSymbolItem:{},progress:0}),null!=i?r.policyState[e][i]:r.policyState[e])},setPolicyState(t,e,i){null==t&&(t=this.tabActiveKey);var r=this.getPolicyState(t);null!=r&&(r[e]=i)},setPolicyStateByName(t,e,i,r){null==t&&(t=this.tabActiveKey);var n=this.getPolicyStateByName(t,e);null!=n&&(n[i]=r)},freshCurEdit(){null==this.curEditTabDit[this.tabActiveKey]&&(this.curEditTabDit[this.tabActiveKey]={policyList:[],curSelectPolicy:"",curEditRulesDit:{ruleOfSelect:[],ruleOfBuy:[],ruleOfSale:[]},resultSymbolList:[],curSelectSymbolItem:{},policyState:[]});var t=menuItems.value.find((t=>t.key==this.tabActiveKey)).modeJson;if(null!=t&&(null!=t.policyList&&(this.curEditTabDit[this.tabActiveKey].policyList=t.policyList,t.policyList.length>0&&""==this.curEditTabDit[this.tabActiveKey].curSelectPolicy&&this.onClickOnePolicy(t.policyList[0])),null!=t.config))for(var e=0;e<this.huiceConfig.length;e++){var i=this.huiceConfig[e].key;null!=t.config[i]&&(this.huiceConfig[e].value=t.config[i])}},saveCurEditRule(t){if(null==t&&(t=this.tabActiveKey),null!=this.curEditTabDit[t]){if(""!=this.curEditTabDit[t].curSelectPolicy){var e=this.curEditTabDit[t].policyList,i=e.findIndex((e=>e.name==this.curEditTabDit[t].curSelectPolicy));if(-1!=i&&null!=graphDit[t]&&null!=graphDit[t][this.curEditTabDit[t].curSelectPolicy]){var r=graphDit[t][this.curEditTabDit[t].curSelectPolicy];if(0!=recordTouch.length){if("autoRecordTouch"==this.configs.recordType){let t=r.findNodesByType("output/autoRunRecordTouch")[0];null==t&&(t=LiteGraph.createNode("output/autoRunRecordTouch"),r.add(t)),t.setProperty("recordTouch",JSON.parse(JSON.stringify(recordTouch)))}recordTouch=[]}e[i].graphJson=r.asSerialisable()}}}else console.warn("this.curEditTabDit[tabActiveKey] == null",t)},onChangeGraph(t,e,i){console.log("onChangeGraph ",t,e);let r=this.curEditTabDit[this.tabActiveKey].policyList;console.log("policyList",r);let n=!1;if(e>=0&&null!=r[e])n=!0,this.onClickOnePolicy(r[e]);else{let e=r.findIndex((e=>e.name==t));-1!=e&&(n=!0,this.onClickOnePolicy(r[e]))}1==n&&i&&(this.autoRunPolicy=!0)},onGraphMenuClick(t,e){console.log("点击了菜单",t),"editColider"==t?(this.editColiderOpen=!0,this.editColiderImg=e.img,this.pointArr=e.pointArr,this.onMarkEditOk=e.onValueChange,this.editColiderScale=e.scale):"editSoundText"==t?(this.editSoundTextOpen=!0,this.editSoundTextParams=e,this.editSoundTextParams.url=rootHost+"/"+e.customeName):"layoutNodesJustX"==t&&this.onClickMenuItem({key:"layoutNodesJustX"})},onSoundTextEditOk(t){this.editSoundTextOpen=!1,null!=this.editSoundTextParams.onValueChange&&this.editSoundTextParams.onValueChange(t)},onGraphNodeClick(t){"autoRecordTouch"==this.configs.recordType&&(console.log("我收到点击事件",t),recordTouch.push(t))},handleOkCreateMotionText(){let t=this.addNodeToGraph("objects/createObject"),e=this.addNodeToGraph("output/customComponent/MotionText",t),i=arrToDit(this.createMotionTextConfig,"key","value"),r=this.getCurEditLGraph().findNodesByType("objects/createObject"),n=99;null!=r&&(n=r.length),t.setProperty("modal","文本"),t.setProperty("x",0),t.setProperty("y",0),t.setProperty("zIndex",n),t.setProperty("color","#000000"),t.setProperty("anchorX",0),t.setProperty("outLineWidth",4),t.setProperty("string",i.content),t.onWidgetChanged("物体类型"),t.connect(0,e,0),this.showCreateMotionTextModal=!1},handleOkSoundMotionText(){null!=this.templeteAudio&&(this.templeteAudio.pause(),this.templeteAudio.src=""),this.showSoundBoxModal=!1},onClickOnePolicy(t){this.saveCurEditRule(),this.clearCurEditLgragh(),null!=t?(this.curEditTabDit[this.tabActiveKey].curSelectPolicy=t.name,this.$nextTick((()=>{this.updateCurShowLGraph()}))):this.curEditTabDit[this.tabActiveKey].curSelectPolicy=""},onClickAddPolicy(){var t=this.curEditTabDit[this.tabActiveKey].policyList;if(isEmptyString(this.newPolicyName))this.$message.error("分镜名称不能为空");else if(-1==t.findIndex((t=>t.name==this.newPolicyName))){var e={name:this.newPolicyName};this.curEditTabDit[this.tabActiveKey].policyList.push(e)}else this.$message.error("当前列表已经存在分镜名称："+this.newPolicyName)},async onClickCopyPolicy(){if(isEmptyString(this.newPolicyName))this.$message.error("分镜名称不能为空");else{var t={name:this.newPolicyName},e=this.curEditTabDit[this.tabActiveKey].policyList,i=e.findIndex((t=>t.name==this.curEditTabDit[this.tabActiveKey].curSelectPolicy));if(-1!=i&&((t=clone(e[i])).name=this.newPolicyName),null!=this.curEditTabDit[this.copyToProject]){if(-1!=this.curEditTabDit[this.copyToProject].policyList.findIndex((t=>t.name==this.newPolicyName)))return void this.$message.error(this.copyToProject+"已经存在分镜："+this.newPolicyName);this.curEditTabDit[this.copyToProject].policyList.push(t)}else{var r=await this.getFromLocalOrCloud(POLICYKEY+this.copyToProject);if(null!=r){if(-1!=r.policyList.findIndex((t=>t.name==this.newPolicyName)))return void this.$message.error(r.name+"已经存在分镜："+this.newPolicyName);r.policyList.push(t),await this.setToLocalOrCloud(POLICYKEY+this.copyToProject,r)}}}},onClickDeletePolicy(){if(0!=window.otplib.authenticator.check(this.verificationCode,totpSecret)){if(null!=this.curEditTabDit[this.tabActiveKey]){var t=this.curEditTabDit[this.tabActiveKey].policyList;if(t.length<=1)this.$message.error("绘本中至少要有一个分镜");else{console.log("确认删除分镜",this.curEditTabDit[this.tabActiveKey].curSelectPolicy);var e=t.findIndex((t=>t.name==this.curEditTabDit[this.tabActiveKey].curSelectPolicy));-1!=e&&(t.splice(e,1),this.onClickOnePolicy(t[0]))}}}else this.$message.error("权限验证码错误！")},async onBtnExportModel(t){console.log("准备导出绘本",t);var e=await this.getFromLocalOrCloud(POLICYKEY+t);null!=e&&exportRaw(e.name+".json",JSON.stringify(e))},onBtnImportModel(t){var e=null;e=null==this.$refs.modelImport.files?this.$refs.modelImport[0].files[0]:this.$refs.modelImport.files[0];const i=new FileReader;i.onload=async t=>{try{var r=JSON.parse(i.result);this.importModelOpen=!0,this.newProjectName=r.name,this.inputModelDes=r.des,this.waitImportProject=r}catch(n){console.error("error",n)}e=null},i.readAsText(e),t.target.value=""},onBtnImportOldVersion(t){null!=window.require?(this.importModelOpen=!0,this.onFreshCanImportPage()):this.$message.warn("此功能仅在桌面版可用，网页版无法使用")},async parseExcelConfig(t){let e=t[0],i=[];for(var r=2;r<t.length;r++){let o=t[r],a={};for(var n in e)"__rowNum__"!=n&&(null==o[n]&&(o[n]=""),"grpup"==e[n]||"labels"==e[n]?a[e[n]]=o[n].split(","):a[e[n]]=o[n]);i.push(a);let l=this.modelTableDatas.findIndex((t=>t.name==a.bookId));if(-1==l&&await this.onBtnCreateModel(null,a.bookId),l=this.modelTableDatas.findIndex((t=>t.name==a.bookId)),-1==l){console.warn("创建失败了",a.bookId);continue}let c=arrToDit(this.huiceConfig,"key","value");for(var s in c)null!=a[s]&&(this.modelTableDatas[l].config[s]=a[s])}this.saveTableData(),console.log("configArr",i,this.modelTableDatas)},onBtnImportExcelConfig(t){const e=t.target.files[0],i=new FileReader;i.onload=t=>{const e=readSync(new Uint8Array(t.target.result),{type:"array"}),i=e.SheetNames[0],r=e.Sheets[i],n=utils$1.sheet_to_json(r);console.log("读取到的json数据",n),this.parseExcelConfig(n)},i.readAsArrayBuffer(e)},onFinishVerificationCode(t){},async onBtnDeleteModel(t){if(0!=window.otplib.authenticator.check(this.verificationCode,totpSecret)){var e=this.modelTableDatas.findIndex((e=>e.name==t));-1!=e&&(this.modelTableDatas.splice(e,1),this.delToLocalOrCloud(POLICYKEY+t),this.saveTableData())}else this.$message.error("权限验证码错误！")},openTab(){this.activeKey=(new Date).getTime(),menuItems.value.push({title:"New Tab",label:"Content of new Tab "+this.activeKey,key:this.activeKey})},closeModelTab(t){console.log("closeTab",t),this.onClickSaveBtn(t);let e=0;menuItems.value.forEach(((i,r)=>{i.key===t&&(e=r-1)})),menuItems.value=menuItems.value.filter((e=>e.key!==t)),menuItems.value.length&&this.tabActiveKey===t&&(this.tabActiveKey=e>=0?menuItems.value[e].key:menuItems.value[0].key),this.$nextTick((()=>{var e=graphDit[t];for(var i in console.log("关闭绘本的情况graphDit",e),e)e[i].clear();delete graphDit[t],delete this.curEditTabDit[t]}))},async onClickSaveBtn(t){if(0==t)return void this.saveTableData();var e=menuItems.value.findIndex((e=>e.key==t));if(-1==e)return void console.log("menuItems find "+t+" == -1");var i=menuItems.value[e].modeJson;i.config=arrToDit(this.huiceConfig,"key","value");let r=this.modelTableDatas.findIndex((e=>e.key==t));-1!=r&&(this.modelTableDatas[r].config=i.config),this.saveCurEditRule(t),i.policyList=this.curEditTabDit[t].policyList;let n=await this.getFromLocalOrCloud(POLICYKEY+t);if(null==n)return void api.error(t+" 保存失败：拉取云端文件失败");if(null!=n.lastChangedTime&&n.lastChangedTime!=i.lastChangedTime)return void api$1.error({message:t+" 保存失败：与云端版本冲突",description:()=>h$1("div",{style:{"white-space":"pre-wrap"}},"云端保存时间："+hooks(n.lastChangedTime).format("YYYY-MM-DD HH:mm:ss")+"\n本地打开时间："+hooks(i.lastChangedTime).format("YYYY-MM-DD HH:mm:ss")),duration:0});let s=i.lastChangedTime;i.lastChangedTime=(new Date).getTime();var o=await this.setToLocalOrCloud(POLICYKEY+t,JSON.parse(JSON.stringify(i)));await this.saveTableData(),1==o?api.success(t+" 保存成功"):i.lastChangedTime=s},async onClickPublishBtn(t){if(0!=t){var e=menuItems.value.findIndex((e=>e.key==t));if(-1!=e){var i=menuItems.value[e].modeJson;if(i.config=arrToDit(this.huiceConfig,"key","value"),this.saveCurEditRule(t),i.policyList=this.curEditTabDit[t].policyList,i.lastChangedTime=(new Date).getTime(),console.log("要发布的modelJson ",i),console.log("bookes列表",this.modelTableDatas.findIndex),null!=ossClient)try{let t=new Blob([JSON.stringify(i)],{type:"text/plain"});await ossClient.put("bookEditRelease/"+i.name+"."+i.lastChangedTime+".json",t);let e=this.modelTableDatas.findIndex((t=>t.name==i.name));-1!=e&&(this.modelTableDatas[e].publishTime=i.lastChangedTime);let r=new Blob([JSON.stringify(this.modelTableDatas)],{type:"text/plain"});await ossClient.put("bookEditRelease/"+TableDataSaveKey+".json",r),await this.saveTableData(),this.$message.success("发布成功！🎉🎉🎉")}catch(r){this.$message.error("发布失败:"+r,3),console.log("error",r)}else this.$message.error("当前没有访问远程资源权限！请先设置AccessKey")}else console.log("menuItems find "+t+" == -1")}else this.publishTableData()},async publishTableData(){await this.saveTableData();try{let t=new Blob([JSON.stringify(this.modelTableDatas)],{type:"text/plain"});await ossClient.put("bookEditRelease/"+TableDataSaveKey+".json",t),this.$message.success("发布成功！🎉🎉🎉")}catch(t){this.$message.error("发布失败:"+t,3)}},onEdit(t,e){console.log("onEdit targetKey",t),"add"===e?(console.log("新建了文件"),this.openTab()):this.closeModelTab(t)},async saveTableData(){var t=this.modelTableDatas.map((t=>({createTime:t.createTime,publishTime:t.publishTime,key:t.key,name:t.name,des:t.des,config:t.config})));if(0!=t.length)try{await this.setToLocalOrCloud(TableDataSaveKey,JSON.parse(JSON.stringify(t)))}catch(e){this.$message.error("保存失败："+e,3)}else this.$message.error("要保存的列表不应该为空",3)},onhuiceConfigChange(t){console.log("哪一个绘本配置修改了",t)},onClone(t){console.log("onClone",t)},onConfigInputChange(t){console.log("onConfigInputChange",t)},ipcRunCall(t,e,i,r){if(window.require){var{ipcRenderer:n}=window.require("electron"),s={tabActiveKey:t,policyName:e,rulesDit:r,huiceConfig:i},o=n.sendSync("loopCheckRule",JSON.parse(JSON.stringify(s)));console.log("ipcRenderer 调用成功",o)}},sortPolicyList(){this.curEditTabDit[this.tabActiveKey].policyList.sort(((t,e)=>{var i=0,r=0,n=this.getPolicyStateByName(null,t.name,"huiceInfo");null!=n&&(i=n[this.policySortKey]);var s=this.getPolicyStateByName(null,e.name,"huiceInfo");return null!=s&&(r=s[this.policySortKey]),n=null,s=null,1==this.policySortKeyIsDown?i-r:r-i}))},initLgraphCanvas(t){if(null!=this.lgcanvas)return null!=t&&(this.lgcanvas.setGraph(t),this.lgcanvas.draw(!0,!0)),this.lgcanvas;if(null!=document.getElementById("mycanvas")){console.log("准备创建lgcanvas");var e=new LGraphCanvas("mycanvas",t);return this.lgcanvas=e,console.log("创建了lgcanvas"),e}},async updateCurShowLGraph(){var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;if(""==t||null==t)return void console.warn("curSelectPolicy == null");console.log("开始刷Graph, updateCurShowLGraph"),null==graphDit[this.tabActiveKey]&&(graphDit[this.tabActiveKey]={});let e=hasInit;if(console.log("cocoMgr开始init"),init(),await waitCocosInit(),console.log("cocoMgr加载完成"),1!=e){let t=localStorage.getItem("cocosConfig");if(null!=t)try{t=JSON.parse(t),1==t.cocosPreviewIsShowState&&showOrHideFPS(),1==t.cocosPreviewIsShowColiderBox&&showOrHideColiderBox(),0==t.isPreviewMode&&changePreviewMode(),this.cocosConfig=t}catch(s){console.error(s)}}null!=this.waitLink.nodeObj&&(this.$message.info({content:"绑定取消",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={});var i=graphDit[this.tabActiveKey][t];if(null!=i)return this.initLgraphCanvas(i),i.config.mute=this.cocosConfig.mute,1==this.autoRunPolicy&&(this.autoRunPolicy=!1,this.onClickRunGraph()),void this.getCurEditLgraphTable();i=new LGraph,LiteGraph.debug=!0,LiteGraph.node_box_coloured_by_mode=!0,this.initLgraphCanvas(i);var r=this.curEditTabDit[this.tabActiveKey].policyList.findIndex((e=>e.name==t));if(-1!=r){var n=this.curEditTabDit[this.tabActiveKey].policyList[r];null!=n.graphJson&&(i.configure(n.graphJson),null!=window.channel&&(console.log("asSerialisable",i.asSerialisable()),window.channel.postMessage({type:"initLgraphCanvas",graph:JSON.parse(JSON.stringify(i.asSerialisable()))})))}i.config.mute=this.cocosConfig.mute,graphDit[this.tabActiveKey][t]=i,1==this.autoRunPolicy&&(this.autoRunPolicy=!1,this.onClickRunGraph()),this.getCurEditLgraphTable()},getCurEditLGraph(){if(null!=this.curEditTabDit[this.tabActiveKey]){var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;if(""!=t&&null!=t){if(null!=graphDit[this.tabActiveKey])return graphDit[this.tabActiveKey][t]}else console.warn("curSelectPolicy == null")}},clearCurEditLgragh(t,e){if(null==t&&(t=this.tabActiveKey),this.setPolicyState(t,"isRuning",!1),null==this.curEditTabDit[t])return;if(null==e&&(e=this.curEditTabDit[t].curSelectPolicy),""==e||null==e)return void console.warn("curSelectPolicy == null");if(null==graphDit[t])return;let i=graphDit[t][e];null!=i&&null!=i.clear&&i.clear(),delete graphDit[t][e]},getCellInputLinks(t,e){let i=this.getCurEditLGraph();if(null==i)return[];let r=i.getNodeById(t.id),n=[];for(var s=0;s<r.inputs.length;s++){let t=r.inputs[s];if(t.type==LiteGraph.ACTION){let i=r.getInputNode(s);if(null!=i)if("middle/logic/orToggle"!=i.type)n.push({slotName:t.name,node:i});else for(let r=0;r<i.inputs.length;r++){let s=i.getInputNode(r);null==s&&1!=e||n.push({slotName:t.name,node:s})}else 1==e&&n.push({slotName:t.name,node:null})}}return n},getCellInputLinkMenu(t,e,i,r){if(1!=t)return void(this.highlightNodeDit={});if(null==this.getCurEditLGraph())return;let n=e[i][r],s=this.getCellInputLinks(n,!0);this.highlightNodeDit={},this.inputLinkMenu=[];let o={};for(var a=0;a<s.length;a++){let t=s[a].node,e=s[a].slotName;null!=t&&(this.highlightNodeDit[t.id]=1,o[e]=1,this.inputLinkMenu.push({key:"unLinkInput_"+t.id,label:"解绑："+t.title+t.id+"-"+e,has_submenu:!1}))}if(null!=this.waitLink.nodeObj){this.inputLinkMenu.push({type:"divider"});for(a=0;a<s.length;a++){let t=s[a].slotName;if(-1==this.inputLinkMenu.findIndex((e=>e.slotName==t))){let e={key:"linkInput_"+t,label:"绑定："+t,slotName:t,has_submenu:!1};1==o[t]&&(e.icon=h$1(ApiFilled,{style:{color:"#219021"}})),this.inputLinkMenu.push(e)}}}},loopGetAllOutputNodes(t,e,i){let r=t.getOutputNodes(e)||[];for(var n=0;n<r.length;n++){let t=r[n];"middle/logic/orToggle"==t.type?this.loopGetAllOutputNodes(t,0,i):i.push(t)}},getCellOutputLinks(t){let e=this.getCurEditLGraph();if(null==e)return[];null!=t.config&&arrToDit(t.config,"key","value");let i=e.getNodeById(t.id),r={};for(var n=0;n<i.outputs.length;n++){let t=i.outputs[n];if(t.type==LiteGraph.EVENT){let e=[];this.loopGetAllOutputNodes(i,n,e),r[t.name]=e}}return r},getCellOutputLinkMenu(t,e,i,r){if(1!=t)return void(this.highlightNodeDit={});if(null==this.getCurEditLGraph())return;let n=e[i][r],s=this.getCellOutputLinks(n),o=[];for(var a in this.highlightNodeDit={},s){let t=[];for(var l=0;l<s[a].length;l++){let e=s[a][l];this.highlightNodeDit[e.id]=1,t.push({key:"linked_"+e.id,label:e.title+e.id,has_submenu:!1})}s[a].length>0&&t.push({type:"divider"}),t.push({key:"connect_"+a,label:"绑定其它",slotName:a,has_submenu:!1}),o.push({key:a,label:a+"("+s[a].length+")",children:t})}this.outputLinkMenu=o},onClickCellInputMenuItem(t,e,i,r){let n=t.key,s=this.getCurEditLGraph();if(null==s)return;let o=e[i][r],a=s.getNodeById(o.id);if(-1!=n.indexOf("unLinkInput")){let t=n.split("_")[1];console.log("准备解除绑定--",a,o,n,t);for(var l=0;l<o.inputs.length;l++)if(o.inputs[l]==t){o.inputs.splice(l,1);break}for(l=0;l<a.inputs.length;l++){let e=a.getInputNode(l);if(null!=e)if("middle/logic/orToggle"==e.type){let i=e.findConnectSoltIndex(t);if(-1!=i){e.disconnectInput(i);break}}else if(e.id==t){a.disconnectInput(l);break}}}else if(-1!=n.indexOf("linkInput")&&(console.log("点击了绑定操作",n,this.waitLink),null!=this.waitLink.nodeObj)){let e=this.waitLink.slotName,i=s.getNodeById(this.waitLink.nodeObj.id);if(i.id==a.id)return this.$message.error({content:"绑定失败，不能绑定指令自身的输入节点",key:this.waitLink.nodeObj.id,duration:3}),void(this.waitLink={});let r=i.findOutputSlot(e),n=t.item.originItemValue.slotName,o=a.findInputSlot(n);if(-1!=r&&-1!=o){if(null==a.inputs[o].link)i.connect(r,a,o);else{let t="middle/logic/orToggle",e=a.getInputNode(o);if(null!=e)if(e.type==t){if(0!=e.checkHasConnectMyInput(i))return this.$message.error({content:"请勿重复绑定",key:this.waitLink.nodeObj.id,duration:1}),void(this.waitLink={});i.connect(r,e,e.getFreeSoltIndex())}else{let n=a.getInputLink(o).origin_slot,l=LiteGraph.createNode(t);s.add(l),e.connect(n,l,l.getFreeSoltIndex()),i.connect(r,l,l.getFreeSoltIndex()),l.connect(0,a,o)}}this.$message.success({content:"绑定成功",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={},this.getCurEditLgraphTable()}}},onClickCellOutputMenuItem(t,e,i,r){let n=t.key;console.log("menuKey",t.key,e,i,r);let s=e[i][r];if(-1!=n.indexOf("connect")){let e=t.item.originItemValue.slotName;null!=this.waitLink.nodeObj&&(this.$message.info({content:"绑定取消",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={}),this.waitLink={nodeObj:s,slotName:e};let i="【"+e+"】绑定:等待选择一个指令",r=h$1(Tag,{style:{"margin-right":"0px"}},s.title+s.id),n=h$1("span",{style:{color:"#1668dc","margin-right":"20px"}},i),o=h$1(CloseOutlined,{style:{color:"red",cursor:"pointer","margin-right":"-2px"},onClick:()=>{console.log("点击了关闭"),null!=this.waitLink.nodeObj&&(this.$message.info({content:"绑定取消",key:this.waitLink.nodeObj.id,duration:1}),this.waitLink={})}}),a=h$1("span",{},[r,n,o]);this.$message.loading({content:a,key:s.id,duration:0})}},genOneNodeToTableCell(t){let e={id:t.id,type:t.type,title:t.title,nodeList:[t.id],noInput:!1,noOutput:!1,bgColor:"#6AFF92",inputs:[],outputs:[]},i=t.type.split("/")[0];if(null!=typeColorEnum[i]&&(e.tagColor=typeColorEnum[i]),"objects/animates/animate"==t.type){t.getEnums(),t.isOutputConnected(0)&&t.isOutputConnected(1)||t.isOutputConnected(0)||t.isOutputConnected(1),t.outputs.map(((t,e)=>({value:e,label:t.name}))).push({value:"无",label:"无"}),e.config=[{key:"playAniName",value:t.properties.playAniName,type:"select",width:"70px",options:t._animations.map((t=>({value:t,label:t})))}]}else"middle/logic/allToggle"==t.type?e.config=[{key:"inputCount",value:t.inputs.length,des:"全部触发有多少个可输入节点，要所有可输入节点都满足才会触发下一步",type:"number",min:2}]:"middle/change/timeDown"==t.type?e.config=[{key:"time_in_ms",value:t.properties.time_in_ms,des:"延迟时间（毫秒）",type:"number",width:"70px",min:0}]:"middle/change/timeDownCycle"==t.type?e.config=[{key:"interval",value:t.properties.interval,des:"延迟时间（毫秒）",type:"number",width:"70px",min:0}]:"input/value"==t.type?e.config=[{key:"value",value:t.properties.value,des:"数值",type:"number",width:"70px"}]:"middle/tool/sendData"==t.type?e.config=[{key:"customeName",value:t.properties.customeName,des:"发送事件",type:"input",width:"70px"}]:"middle/tool/acceptData"==t.type?e.config=[{key:"customeName",value:t.properties.customeName,des:"接收事件",type:"input",width:"70px"}]:"output/sound"==t.type&&(e.config=[{key:"customeName",value:t.properties.customeName,des:t.properties.customeName,type:"input",width:"70px"}]);null==t.findOutputByType(LiteGraph.EVENT)&&(e.noOutput=!0),null==t.findInputByType(LiteGraph.ACTION)&&(e.noInput=!0);let r=this.getCellInputLinks(e);for(var n=0;n<r.length;n++)e.inputs.push(r[n].node.id);let s=this.getCellOutputLinks(e);for(var o in s){let t=s[o];for(n=0;n<t.length;n++)e.outputs.push(o+"_"+t[n].id)}return e},genLinkNodes(t,e,i){let r=t.outputs;null==e[i]&&(e[i]=[]);for(var n=0;n<r.length;n++)if("codeNode"==r[n].type||r[n].type==LiteGraph.EVENT){let r=t.getOutputNodes(n);if(null!=r)for(var s=0;s<r.length;s++){let t=r[s],n=e.findIndex((e=>-1!=e.findIndex((e=>e.id==t.id))));if(-1!=n&&n==i-1){let i=e[n].findIndex((e=>e.id==t.id));e[n].splice(i,1),n=-1}-1==n&&("middle/logic/orToggle"!=t.type&&e[i].push(t),this.genLinkNodes(t,e,i+1))}}},checkNotInTableNodes(t,e){let i={},r=this.getCurEditLGraph();for(var n=0;n<t.length;n++)for(var s in t[n])if(i[t[n].id]=1,-1!=s.indexOf("linkNode")){let e=t[n][s];for(var o=0;o<e.length;o++)i[e[o].id]=1}for(n=0;n<t.length;n++){let e=[],l="linkNode_0";for(var s in t[n])if(-1!=s.indexOf("linkNode")){let l=t[n][s];for(o=0;o<l.length;o++){let t=l[o],n=r.getNodeById(t.id);for(var a=0;a<n.inputs.length;a++)if(n.inputs[a].type==LiteGraph.ACTION){let t=n.getInputNode(a);null!=t&&null==i[t.id]&&"middle/logic/orToggle"!=t.type&&(e.push(this.genOneNodeToTableCell(t)),i[t.id]=1)}}}0!=e.length&&(0==t[n][l].length?t[n][l]=e:t[n][l]=t[n][l].concat(e))}let l=[];for(o=0;o<r.nodes.length;o++){let t=r.nodes[o];null==i[t.id]&&"middle/logic/orToggle"!=t.type&&l.push(this.genOneNodeToTableCell(t))}if(0!=l.length){let i={id:l[0].id,modal:"无物体"};for(o=0;o<l.length;o++){let t=l[o];i["linkNode_"+o]=[t],e["linkNode_"+o]=1}for(var s in i)if(-1!=s.indexOf("linkNode"))for(a=0;a<i[s].length;a++){let t=i[s][a],r=this.findSameRowUpNode(t,i);if(-1!=r){let n="linkNode_"+(r+1);null==i[n]&&(i[n]=[],e[n]=1),n!=s&&(i[n].push(t),i[s].splice(a,1),a--)}}let r=function(t){let e="linkNode_"+(t+1);return null!=i[e]?i[e].length>0?e:r(t+1):null};for(var s in i)if(-1!=s.indexOf("linkNode")&&0==i[s].length){let t=r(Number(s.split("_")[1]));null!=t&&(i[s]=i[t],i[t]=[])}t.push(i)}console.log("noLinkAnyNodes",l)},getNodeInRow(t){let e=null;for(var i=0;i<this.curEditLgraphTable.length;i++)if(this.curEditLgraphTable[i].id==t.id){e=this.curEditLgraphTable[i];break}return e},checkNodeIsSameRowWithUpNode(t,e){let i=this.getCurEditLGraph().getNodeById(t.id);if("codeNode"==i.getInputDataType(0)){let t=i.getInputNode(0);return null==t||t.id==e.id}{let i=this.getCellInputLinks(t),n=!1;for(var r=0;r<i.length;r++){let t=i[r].node,s=this.getNodeInRow(t);null!=s&&s.id==e.id&&(n=!0)}return n}},findSameRowUpNode(t,e){let i=-1;for(var r in e)if(-1!=r.indexOf("linkNode")){if(null==e[r]){console.warn("row[key] == null",r);continue}for(var n=0;n<e[r].length;n++){if(-1!=e[r][n].outputs.findIndex((e=>{let i=e.split("_");return i[i.length-1]==t.id}))){i=Number(r.split("_")[1]);break}}}return i},sortTable(t,e){let i=this.getCurEditLGraph();for(var r=0;r<t.length;r++){let a=t[r];for(var n in a)if(-1!=n.indexOf("linkNode"))for(var s=0;s<a[n].length;s++){let r=a[n][s],l=i.getNodeById(r.id);if(0==this.checkNodeIsSameRowWithUpNode(r,a)){console.log("不在同一行",r.title+r.id,a.customeName);let i=l.getInputNode(0);if(null!=i&&i.id!=a.id){let l=t.find((t=>{let e=!1;if(t.id==i.id)for(var n in t)if(-1!=n.indexOf("linkNode")){if(-1!=t[n].findIndex((t=>t.id==r.id))){e=!0;break}}return e}));if(null!=l){let t=-1;for(var o in l)if(-1!=o.indexOf("linkNode")&&(t=l[o].findIndex((t=>t.id==r.id))),-1!=t){null==l[n]&&(l[n]=[]),l[n].push(r),l[o].splice(t,1),a[n].splice(s,1),s--;break}}else{let t=this.findSameRowUpNode(r,a);if(console.log("虽然不在同一行，但也没有找到另一行",r.title+r.id,a.customeName,t),-1!=t){let i="linkNode_"+(t+1);console.log("找到了同一行的哪一列是连接的",i),null==a[i]&&(a[i]=[],e[i]=1),i!=n&&(a[i].push(r),a[n].splice(s,1),s--)}}}}}}},getCurEditLgraphTable(){let t=this.getCurEditLGraph();if(null==t)return;let e=[],i={};e=t.findNodesByType("objects/camera").concat(t.findNodesByType("objects/createObject").sort(((t,e)=>t.properties.zIndex-e.properties.zIndex))).map((t=>{let e={id:t.id,modal:t.properties.modal,customeName:t.properties.customeName};null!=t.getPreviewImg&&(e.img=t.getPreviewImg()),"objects/camera"==t.type&&(e.modal="镜头"),"文本"==e.modal&&(e.customeName=t.properties.string);let r=[];this.genLinkNodes(t,r,0),r=r.map((t=>t.map(this.genOneNodeToTableCell))),e.linkNode_0=[],i.linkNode_0=1;for(var n=1;n<=r.length;n++)e["linkNode_"+n]=r[n-1],i["linkNode_"+n]=1;return e})),this.sortTable(e,i),this.checkNotInTableNodes(e,i);let r=this.graphTableColumns.findIndex((t=>"linkNode_0"==t.key));console.log("linkNode_1:",r,this.graphTableColumns.length-1-r),-1!=r&&this.graphTableColumns.splice(r,this.graphTableColumns.length-1-r);for(let s in i){for(var n=0;n<e.length;n++)null==e[n][s]&&(e[n][s]=[]);this.graphTableColumns.splice(this.graphTableColumns.length-1,0,{title:"linkNode_1"==s?"初始关联指令":"关联指令",dataIndex:s,key:s,ellipsis:!0,resizable:!0,width:220,minWidth:75})}console.log("table",e),this.curEditLgraphTable=e},addOneColumnToTable(){let t=0;for(var e=0;e<this.graphTableColumns.length;e++)if(-1!=this.graphTableColumns[e].key.indexOf("linkNode_")){let i=Number(this.graphTableColumns[e].key.split("_")[1]);i>t&&(t=i)}t+=1;let i="linkNode_"+t;this.graphTableColumns.splice(this.graphTableColumns.length-1,0,{title:"关联指令",dataIndex:i,key:i,ellipsis:!0,resizable:!0,width:220,minWidth:75});for(e=0;e<this.curEditLgraphTable.length;e++)null==this.curEditLgraphTable[e][i]&&(this.curEditLgraphTable[e][i]=[]);return i},addNameColumnToTable(){if(1==this.configs.showNameColumn){let t={title:"资源",dataIndex:"customeName",key:"customeName",ellipsis:!0,resizable:!0,width:200};-1==this.graphTableColumns.findIndex((t=>"customeName"==t.key))&&this.graphTableColumns.splice(1,0,t)}else{let t=this.graphTableColumns.findIndex((t=>"customeName"==t.key));-1!=t&&this.graphTableColumns.splice(t,1)}},onGraphTableConfigChange(t,e,i,r){console.log("value修改了",t,e,i);let n=this.getCurEditLGraph();if(null==n)return;let s=e[i][r];if(null!=s){let e=n.getNodeById(s.id),i=arrToDit(s.config,"key","value");if("playAniName"==t&&e.setProperty("loop",-1!=i[t].indexOf("std")),"spe_output"==t);else if("inputCount"==t){let r=i[t]-e.inputs.length;if(console.log("增加还是减少inputslot数量",r,e.onGetInputs()),r>0){if(null!=e.onGetInputs)for(var o=0;o<r;o++){let t=e.onGetInputs();null!=t[0]&&e.addInput(t[0][0],t[0][1])}}else for(o=0;o<Math.abs(r);o++)e.removeInput(e.inputs.length-1)}else e.setProperty(t,i[t])}},onLgraphTableDragEnd(){let t=this.getCurEditLGraph();for(var e=0;e<this.curEditLgraphTable.length;e++){let i=this.curEditLgraphTable[e],r=t.getNodeById(i.id);null!=r&&r.setProperty("zIndex",e)}},handleResizeTableColumn(t,e){e.width=t},onSelectChange(t){this.graphTableSelectRows=t},onGraphTableEnd(t,e,i){let r=t.to.dataset,n=t.target.dataset,s=this.curEditLgraphTable[Number(n.row)][n.col],o=this.curEditLgraphTable[Number(r.row)][r.col],a=this.getCurEditLGraph(),l=a.getNodeById(s.id),c=a.getNodeById(o.id),h=this.curEditLgraphTable[Number(n.row)].id,u=a.getNodeById(h),d=this.curEditLgraphTable[Number(r.row)].id,p=a.getNodeById(d);if(console.log("targetLinkObject",u,"toLinkObject",p),h==d){let t=u.outputs[0].links.findIndex((t=>{let e=a.links.get(t);return console.log("link",e.target_id,s.id),e.target_id==s.id})),e=u.outputs[0].links.findIndex((t=>a.links.get(t).target_id==o.id)),i=u.outputs[0].links[t];u.outputs[0].links[t]=u.outputs[0].links[e],u.outputs[0].links[e]=i}else u.connect(0,c,0),p.connect(0,l,0);o.nodeList.splice(0,o.nodeList.length),o.nodeList.push(o.id),s.nodeList.push(s.id);let f=o;this.curEditLgraphTable[Number(r.row)][r.col]=s,this.curEditLgraphTable[Number(n.row)][n.col]=f},onGraphTableCellDragEnd(t,e,i){let r=t.to.dataset;t.target.dataset;let n=this.getCurEditLGraph();if(null==n)return;let s=t.clonedData,o=n.getNodeById(s.id),a=o.findInputByType("codeNode");if(console.log("是否需要重新关联",a,o),-1!=a){let t=this.curEditLgraphTable[Number(r.row)].id,e=n.getNodeById(t);null!=e&&("objects/createObject"!=e.type&&"objects/camera"!=e.type||e.connect(0,o,a))}},onClickRunGraphStep(){var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;""!=t&&null!=t?graphDit[this.tabActiveKey][t].runStep():console.warn("curSelectPolicy == null")},async onClickRunGraph(){var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;if(""!=t&&null!=t)if(null!=graphDit[this.tabActiveKey]){var e=graphDit[this.tabActiveKey][t];if(null!=e){if(this.setPolicyState(this.tabActiveKey,"isStartLoading",!0),window.channel&&window.channel.postMessage({type:"graphStart",graph:JSON.parse(JSON.stringify(e.asSerialisable()))}),recordTouch=[],"autoRunRecordTouch"==this.configs.recordType){let t=e.findNodesByType("output/autoRunRecordTouch")[0];null!=t&&t.setProperty("active",!0)}else{let t=e.findNodesByType("output/autoRunRecordTouch")[0];null!=t&&t.setProperty("active",!1)}1==this.curOpenLayout[1]&&await e.start(),this.setPolicyState(this.tabActiveKey,"isRuning",!0),this.setPolicyState(this.tabActiveKey,"isStartLoading",!1),this.freshState=!this.freshState}else console.warn("graph == null",this.tabActiveKey,t)}else console.warn("graphDit[this.tabActiveKey] == null");else console.warn("curSelectPolicy == null")},onClickStopGraph(){var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;if(""!=t&&null!=t){if(null!=graphDit[this.tabActiveKey]){var e=graphDit[this.tabActiveKey][t];1==this.curOpenLayout[1]&&e.stop(),window.channel&&window.channel.postMessage({type:"graphStop"}),this.setPolicyState(this.tabActiveKey,"isRuning",!1),this.freshState=!this.freshState,"autoRecordTouch"==this.configs.recordType&&this.saveCurEditRule()}}else console.warn("curSelectPolicy == null")},addNodeToGraph(t,e){if(null==this.lgcanvas)return;let i=this.lgcanvas.graph;if(null!=i){if("objects/camera"==t){if(i.findNodesByType(t).length>0)return void this.$message.warn("只能添加一个镜头节点")}var r=LiteGraph.createNode(t);if(r.pos=[200,200],null!=i.list_of_graphcanvas[0]){var n=i.list_of_graphcanvas[0].visible_area;if(null!=e){let t=e.getOutputNodes(0),i=e.pos[0]+e.width+3,n=e.pos[1];if(null!=t)for(let e=0;e<t.length;e++){let i=t[e];i.pos[1]>n&&(n=i.pos[1]+i.height+3)}r.pos=[i,n]}else r.pos=[.5*n[2]+n[0],.5*n[3]+n[1]];console.log("viewport",n)}return i.add(r),null!=r.createLinkNode&&r.createLinkNode(),r}},getEditViewCenterPos(t){if(null==this.lgcanvas)return[0,0];let e=this.lgcanvas.visible_area;return 1==t?[.5*e[2],.5*e[3]]:[.5*e[2]+e[0],.5*e[3]+e[1]]},getCurGraphIsRuning(){if(null==this.curEditTabDit[this.tabActiveKey])return!1;var t=this.curEditTabDit[this.tabActiveKey].curSelectPolicy;if(""==t||null==t)return console.warn("curSelectPolicy == null"),!1;if(null==graphDit[this.tabActiveKey])return!1;var e=graphDit[this.tabActiveKey][t];return null!=e&&(console.log("获取到了蓝图的状态",e.status,LGraph.STATUS_RUNNING),e.status==LGraph.STATUS_RUNNING)},onClickExpandPreview(){this.cocosPreviewCanDrag=!this.cocosPreviewCanDrag},onClickFreshPreview(){refreshTree(),console.log("TreeData",treeData),this.cocosPreviewTreeData=treeData},onClickConsoleSelect(){this.$message.info("对象已打印至控制台"),console.log(selectedNode)},onClickTreeExport(){console.log(this.expandedKeys),this.expandedKeys=getHasChildrenNodeId()},onClickFpsPreview(){this.cocosPreviewIsShowState=showOrHideFPS()},onClickTreePreview(t){if("cocosPreviewIsShowState"==t)return this.cocosConfig[t]=showOrHideFPS(),void localStorage.setItem("cocosConfig",JSON.stringify(this.cocosConfig));if("cocosPreviewIsShowColiderBox"==t)return this.cocosConfig[t]=showOrHideColiderBox(),void localStorage.setItem("cocosConfig",JSON.stringify(this.cocosConfig));if(this.cocosConfig[t]=!this.cocosConfig[t],"cocosPreviewIsShowTree"==t)refreshTree(),this.cocosPreviewTreeData=treeData;else if("cocosPreviewCanDrag"==t)this.cocosConfig.cocosPreviewIsShowGird&&(this.cocosConfig.cocosPreviewIsShowGird=!1,setTimeout((()=>{this.cocosConfig.cocosPreviewIsShowGird=!0}),700));else if("isPreviewMode"==t)changePreviewMode(),this.cocosConfig[t]=isPreviewMode,console.log("CocosMgr.isPreviewMode",isPreviewMode);else if("mute"==t){let t=this.getCurEditLGraph();null!=t&&(t.config.mute=this.cocosConfig.mute)}localStorage.setItem("cocosConfig",JSON.stringify(this.cocosConfig))},onClickNewPreview(){let t=window.location.origin+window.location.pathname+"#/BookPreview";console.log("打开的url",t,window.location),window.open(t,"_blank","height=1028,width=1634"),setTimeout((()=>{let t=this.getCurEditLGraph();null!=window.channel&&null!=t&&window.channel.postMessage({type:"initLgraphCanvas",graph:JSON.parse(JSON.stringify(t.asSerialisable()))})}),1e3)},onChangeRadionPicker(t){if(console.log("onChangeRadionPicker",t),"无比例"!=t){var e=t.split(":"),i=Number(e[1]),r=Number(e[0]);this.cocosConfig.aspectRadio=i/r}else this.cocosConfig.aspectRadio=0;localStorage.setItem("cocosConfig",JSON.stringify(this.cocosConfig))},onClickClearScene(){clearScene(),this.$message.info("已清空场景")},onPreviewSizeChange(t){setTimeout((()=>{updateCanvasSize(t.width,t.height)}),100);for(var e=designViewWidth,i=designViewHeight,r=[{width:1920,height:1500},{width:2560,height:1080}],n=[],s=0;s<r.length;s++){var o=r[s],a=.5*(i-o.height),l=a/i,c=(o.height+a)/i;0!=l&&n.push({top:l*t.height,left:0,width:"100%",height:"2px"}),1!=c&&n.push({top:c*t.height,left:0,width:"100%",height:"2px"});var h=.5*(e-o.width),u=h/e,d=(o.width+h)/e;0!=u&&n.push({top:0,left:u*t.width,width:"2px",height:"100%"}),1!=d&&n.push({top:0,left:d*t.width,width:"2px",height:"100%"})}this.saveAreaLines=n},onPreviewTreeSizeChange(t){this.cocosPreviewTreeWidth=t.width},onSelectCocosNode(t){var e=getNodeById(t[0]);null!=e&&drawNodeRect(e)},onHandDarkMode(t){null!=window.onChangeDarkMode&&window.onChangeDarkMode(t)},handleSoundBoxTableChange(t,e,i){if(this.filteredInfo=e,this.sortedInfo=i,null!=i.columnKey){let t=this.soundBoxColumns.findIndex((t=>t.key==i.columnKey));this.soundBoxColumns[t].sortOrder=i.order}},onBtnUseBoxOneRow(t){console.log("onBtnUseBoxOneRow",t),"sound"==t.type?this.onClickMenuItem({key:"output/sound",initProp:{customeName:t.customeName}}):"spine"==t.type?this.onClickMenuItem({key:"objects/createObject",initProp:{modal:ObjectTypeEnum.spine,customeName:t.customeName}}):"image"==t.type&&this.onClickMenuItem({key:"objects/createObject",initProp:{modal:ObjectTypeEnum.sprite,customeName:t.customeName}}),this.$message.success("已添加："+t.customeName)},donwLoadUrl(t,e){let i=document.createElement("a");i.href=t,i.download=e,i.click()},onBtnDownLoadBoxOneRow(t){let e=rootHost+"/"+t.customeName;"spine"==t.type?(this.donwLoadUrl(e+".json",t.name+".json"),setTimeout((()=>{this.donwLoadUrl(e+".atlas",t.name+".atlas")}),100),setTimeout((()=>{this.donwLoadUrl(e+".png",t.name+".png")}),200)):this.donwLoadUrl(e,t.name+getExName(t.customeName,!0))},onBtnPlayBoxOneRow(t){let e=rootHost+"/"+t.customeName;console.log("record",t,e),"spine"==t.type||"sound"==t.type&&(null!=this.templeteAudio?(this.templeteAudio.pause(),this.templeteAudio.src=e):this.templeteAudio=new Audio(e),this.templeteAudio.play())},onFileChange(t){console.log("handleChange",t)},handleDragOver(t){t.dataTransfer.dropEffect="copy"},async uploadOneFile(t,e){return new Promise(((e,i)=>{const r=new FileReader,n=new SparkMD5.ArrayBuffer;r.onload=async i=>{try{n.append(r.result);var s,o=n.end(),a=t.name;if(-1!=a.indexOf(".")&&(s=(a=t.name.split("."))[a.length-1],a.splice(a.length-1,0,o.substring(0,8))),a=a.join("."),null==ossClient)return void this.$message.error("当前没有访问远程资源权限！请先设置AccessKey");await ossClient.put("bookEdit/"+a,t);var l=this.getCurEditLGraph();if(null!=l){var c=[200,200];if(null!=l.list_of_graphcanvas[0]){var h=l.list_of_graphcanvas[0].visible_area;c=[this.dropedX+h[0],this.dropedY+h[1]],this.dropedX+=40,this.dropedY+=40}let t=getFileType(s);if("音频"!=t){let e=LiteGraph.createNode("objects/createObject");l.add(e),e.pos=c,e.setProperty("modal",t),console.log("fileType",t),"spine"==t&&(console.log("直接设置了premulAlpha"),e.setProperty("premulAlpha",!0)),e.setProperty("customeName",a)}else{let t=LiteGraph.createNode("output/sound");l.add(t),t.pos=c,t.setProperty("customeName",a)}}e()}catch(u){console.error("资源上传失败：",u),this.$message.error("资源上传失败："+t.name),e()}},r.readAsArrayBuffer(t)}))},async uploadFiles(t){console.log("上传了文件",t);for(var e=0;e<t.length;e++){var i=t[e];await this.uploadOneFile(i,!0)}console.log("上传文件结束")},async genMd5(t){const e=new SparkMD5.ArrayBuffer;for(var i=0;i<t.files.length;i++){var r=await this.readArrayBufferFile(t.files[i]);e.append(r)}return e.end().substring(0,8)},addGroupFileToGraph(t){var e=this.getCurEditLGraph();if(null!=e){var i=[200,200];if(null!=e.list_of_graphcanvas[0]){var r=e.list_of_graphcanvas[0].visible_area;i=[this.dropedX+r[0],this.dropedY+r[1]]}null!=t.x&&(i[0]=t.x),null!=t.y&&(i[1]=t.y);let s=getFileType(t.type);if(-1!=["空物体","图片","绘制","spine","文本"].indexOf(s)){let r=LiteGraph.createNode("objects/createObject");r.pos=i,this.dropedX+=r.width+3,r.setProperty("modal",s);var n=e.findNodesByType("objects/createObject").length;if(console.log("当前页面object数量",n),r.setProperty("zIndex",n),r.setProperty("customeName",t.path),"spine"==s){r.setProperty("premulAlpha",!0),e.add(r);let t=LiteGraph.createNode("objects/animates/animate");t.setProperty("autoRun",!0),t.pos=[r.pos[0]+r.width+3,r.pos[1]],this.dropedX+=r.width+3,e.add(t),r.connect(0,t,0)}else e.add(r)}else if("音频"==s){let r=LiteGraph.createNode("output/sound");r.pos=i,this.dropedX+=r.width+3,r.setProperty("customeName",t.path),e.add(r)}}},async uploadGroupFile(t){if(null==ossClient)return void this.$message.error("当前没有访问远程资源权限！请先设置AccessKey");this.importProgress=0,this.importInfo="0/"+t.length;let e=null;null!=window.require&&(e=window.require("fs"));for(var i=0;i<t.length;i++){var r=t[i];r.md5=await this.genMd5(r);try{if(1==r.files.length){var n=r.name+"."+r.md5+"."+r.type;if(r.path=n,r.customeName=n,"string"==typeof r.files[0].path)if(null!=e){let t=e.readFileSync(r.files[0].path);await ossClient.put("bookEdit/"+n,t)}else console.warn("文件路径上传需要当前有fs环境");else await ossClient.put("bookEdit/"+n,r.files[0])}else{r.modal="spine",r.path=r.md5+"/"+r.name,r.customeName=r.path;for(var s=0;s<r.files.length;s++)if("string"==typeof r.files[s].path)if(null!=e){let t=e.readFileSync(r.files[s].path);await ossClient.put("bookEdit/"+r.md5+"/"+r.files[s].name,t)}else console.warn("文件路径上传需要当前有fs环境");else await ossClient.put("bookEdit/"+r.md5+"/"+r.files[s].name,r.files[s])}}catch(o){this.$message.error("上传文件失败:"+o,3),console.log("error",o)}if(0!=this.tabActiveKey)if(0==this.showSoundBoxModal)if(1==this.configs.uploadReplaceAssestByName){0==this.replaceFileGrpup(r)&&this.addGroupFileToGraph(r)}else this.addGroupFileToGraph(r);else this.replaceFileGroupByBook(r);this.importProgress=Math.ceil((i+1)/t.length*100),this.importInfo=i+1+"/"+t.length,1==this.showSoundBoxModal&&this.freshAssestBoxData()}"表格"==this.ruleChooseTabOption&&this.getCurEditLgraphTable(),console.log("uploadGroupFile",t)},async readJsonFile(t){if("string"==typeof t.path&&null!=window.require){let e=window.require("fs").readFileSync(t.path,"utf-8");return JSON.parse(e)}return new Promise(((e,i)=>{const r=new FileReader;r.onload=async t=>{e(JSON.parse(r.result))},r.readAsText(t)}))},async readArrayBufferFile(t){if("string"==typeof t.path&&null!=window.require){let e=window.require("fs").readFileSync(t.path);return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}return new Promise(((e,i)=>{const r=new FileReader;r.onload=async t=>{e(r.result)},r.readAsArrayBuffer(t)}))},getSpineOtherFiles(t,e){var i=[];for(var r in t){r.split(".")[0]==e&&(i.push(t[r]),delete t[r])}return i},async prepareDealFiles(t){for(var e=[],i={},r=0;r<t.length;r++)i[t[r].name]=t[r];for(var n in i){var s=i[n];if("json"==getExName(n)){var o=await this.readJsonFile(s);if(null!=o.skeleton&&null!=o.skeleton.spine){var a=s.name.split(".")[0],l=this.getSpineOtherFiles(i,a);e.push({files:l,type:"spine",name:a})}}}for(var n in i)e.push({files:[i[n]],type:getExName(n),name:getBaseName(n)});return await this.uploadGroupFile(e),e},handleDrop(t){const e=t.dataTransfer.files;console.log("最终drop的位置",t.offsetX,t.offsetY),this.dropedX=t.offsetX,this.dropedY=t.offsetY,e.length&&this.prepareDealFiles(e)},onBtnImportAssest(t){var e=null;e=null==this.$refs.modelImport2.files?this.$refs.modelImport2[0].files:this.$refs.modelImport2.files;let i=this.getEditViewCenterPos(!0);this.dropedX=i[0],this.dropedY=i[1],null!=e&&e.length&&this.prepareDealFiles(e),t.target.value=""},onSaveSetting(){let t=arrToDit(this.systemSetting,"key","value");ossClient=new aliyunOssSdk({region:"oss-cn-shanghai",accessKeyId:t.accessKeyId,accessKeySecret:t.accessKeySecret,bucket:t.bucket}),localStorage.setItem("bookEditConfig",JSON.stringify(t))},onStopClick(t,e){null!=t&&t.stopPropagation&&t.stopPropagation(),null!=e&&e.stopPropagation&&e.stopPropagation()},handleSearch(t,e,i){e()},handleReset(t){t({confirm:!0})}}},_hoisted_1={class:"about"},_hoisted_2={key:0},_hoisted_3={style:{width:"200px"}},_hoisted_4={key:0,style:{width:"200px"}},_hoisted_5={style:{width:"100px",height:"130px","border-radius":"12%",position:"relative"}},_hoisted_6=["src"],_hoisted_7={id:"leftFlexView",style:{display:"flex","flex-direction":"column",gap:"5px"}},_hoisted_8={id:"huiceConfigCard",style:{display:"flex","flex-direction":"column",gap:"5px"}},_hoisted_9=["width","height"],_hoisted_10={style:{display:"flex",height:"37px","user-select":"none",overflow:"hidden","margin-top":"-8px","justify-content":"left",width:"100%"}},_hoisted_11=["width","height"],_hoisted_12=["src"],_hoisted_13={style:{position:"absolute",width:"100%",height:"100%",top:"0%",left:"0%",display:"flex","justify-content":"center","align-items":"center"}},_hoisted_14={key:0,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},_hoisted_15=["src"],_hoisted_16={style:{width:"200px"}},_hoisted_17={style:{"margin-top":"10px"}},_hoisted_18={key:0,style:{"font-size":"large"}},_hoisted_19={key:1,style:{"font-size":"large"}},_hoisted_20={key:2,style:{"font-size":"large"}};function _sfc_render(t,e,i,r,n,s){const o=resolveComponent("CloudUploadOutlined"),a=resolveComponent("a-button"),l=resolveComponent("SaveOutlined"),c=resolveComponent("SettingOutlined"),h=resolveComponent("PictureOutlined"),u=resolveComponent("UnorderedListOutlined"),d=resolveComponent("NodeIndexOutlined"),p=resolveComponent("UpCircleOutlined"),f=resolveComponent("a-button-group"),_=resolveComponent("a-switch"),m=resolveComponent("a-flex"),g=resolveComponent("a-tab-pane"),y=resolveComponent("a-tabs"),v=resolveComponent("a-input"),b=resolveComponent("a-popconfirm"),x=resolveComponent("ConfigInput"),T=resolveComponent("a-select"),C=resolveComponent("SearchOutlined"),S=resolveComponent("search-outlined"),w=resolveComponent("EditOutlined"),A=resolveComponent("DownloadOutlined"),E=resolveComponent("CopyOutlined"),D=resolveComponent("arco-verification-code"),L=resolveComponent("DeleteOutlined"),I=resolveComponent("a-upload-dragger"),P=resolveComponent("a-table"),M=resolveComponent("VueDraggable"),R=resolveComponent("a-card"),O=resolveComponent("ClearOutlined"),B=resolveComponent("a-tooltip"),N=resolveComponent("VideoCameraOutlined"),k=resolveComponent("NumberOutlined"),F=resolveComponent("DeploymentUnitOutlined"),V=resolveComponent("DashboardOutlined"),j=resolveComponent("GatewayOutlined"),G=resolveComponent("SoundFilled"),U=resolveComponent("SoundOutlined"),Y=resolveComponent("FullscreenOutlined"),H=resolveComponent("FullscreenExitOutlined"),X=resolveComponent("BlockOutlined"),z=resolveComponent("ExpandAltOutlined"),W=resolveComponent("CodeOutlined"),Z=resolveComponent("SyncOutlined"),J=resolveComponent("a-tree"),q=resolveComponent("UseElementSize"),K=resolveComponent("TopFreeDrag"),Q=resolveComponent("PlusOutlined"),$=resolveComponent("MenuOutlined"),tt=resolveComponent("LineOutlined"),et=resolveComponent("a-segmented"),it=resolveComponent("a-menu"),rt=resolveComponent("a-progress"),nt=resolveComponent("a-radio-button"),st=resolveComponent("a-radio-group"),ot=resolveComponent("DownCircleOutlined"),at=resolveComponent("AppstoreAddOutlined"),lt=resolveComponent("a-tag"),ct=resolveComponent("a-popover"),ht=resolveComponent("MoreOutlined"),ut=resolveComponent("a-dropdown"),dt=resolveComponent("LoginOutlined"),pt=resolveComponent("LogoutOutlined"),ft=resolveComponent("AimOutlined"),_t=resolveComponent("a-checkbox"),mt=resolveComponent("a-divider"),gt=resolveComponent("a-checkbox-group"),yt=resolveComponent("a-modal"),vt=resolveComponent("MarkEdit"),bt=resolveComponent("SoundTextEdit"),xt=resolveComponent("a-config-provider"),Tt=resolveDirective("element-size");return openBlock(),createBlock(xt,{locale:n.locale,"component-size":"small"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_1,[withDirectives(createVNode(y,{id:"tabHtml",tabBarStyle:{"margin-bottom":"0px"},style:{"user-select":"none"},activeKey:n.tabActiveKey,"onUpdate:activeKey":e[7]||(e[7]=t=>n.tabActiveKey=t),type:"editable-card",onEdit:s.onEdit,size:"small",hideAdd:!0},{rightExtra:withCtx((()=>[createVNode(m,{gap:"small",align:"center",style:{"margin-right":"10px"}},{default:withCtx((()=>[createVNode(a,{type:"primary",onClick:e[0]||(e[0]=t=>s.onClickPublishBtn(n.tabActiveKey))},{icon:withCtx((()=>[createVNode(o)])),default:withCtx((()=>[e[55]||(e[55]=createTextVNode(" 发布 ",-1))])),_:1}),createVNode(a,{type:"primary",onClick:e[1]||(e[1]=t=>s.onClickSaveBtn(n.tabActiveKey))},{icon:withCtx((()=>[createVNode(l)])),default:withCtx((()=>[e[56]||(e[56]=createTextVNode(" 保存 ",-1))])),_:1}),0!=n.tabActiveKey?(openBlock(),createBlock(f,{key:0,compact:""},{default:withCtx((()=>[createVNode(a,{type:n.curOpenLayout[0]?"primary":"default",onClick:e[2]||(e[2]=t=>s.onClickChangeShowView(0))},{icon:withCtx((()=>[createVNode(c)])),_:1},8,["type"]),createVNode(a,{type:n.curOpenLayout[1]?"primary":"default",onClick:e[3]||(e[3]=t=>s.onClickChangeShowView(1))},{icon:withCtx((()=>[createVNode(h)])),_:1},8,["type"]),createVNode(a,{type:n.curOpenLayout[2]?"primary":"default",onClick:e[4]||(e[4]=t=>s.onClickChangeShowView(2))},{icon:withCtx((()=>[createVNode(u)])),_:1},8,["type"]),createVNode(a,{type:n.curOpenLayout[3]?"primary":"default"},{icon:withCtx((()=>[createVNode(d)])),_:1},8,["type"]),createVNode(a,{type:n.curOpenLayout[4]?"primary":"default",onClick:e[5]||(e[5]=t=>s.onClickChangeShowView(4))},{icon:withCtx((()=>[createVNode(p)])),_:1},8,["type"])])),_:1})):createCommentVNode("",!0),createVNode(_,{size:"default",style:{height:"100%"},checked:n.isOpenDark,"onUpdate:checked":e[6]||(e[6]=t=>n.isOpenDark=t),onChange:s.onHandDarkMode},{checkedChildren:withCtx((()=>[(openBlock(),createBlock(resolveDynamicComponent("BulbFilled")))])),unCheckedChildren:withCtx((()=>[(openBlock(),createBlock(resolveDynamicComponent("BulbOutlined")))])),_:1},8,["checked","onChange"])])),_:1})])),default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.menuItems,(t=>(openBlock(),createBlock(g,{key:t.key,tab:t.title,closable:t.closable},null,8,["tab","closable"])))),128))])),_:1},8,["activeKey","onEdit"]),[[vShow,1==n.curOpenLayout[4]]]),e[95]||(e[95]=createBaseVNode("div",null,null,-1)),0==n.tabActiveKey?(openBlock(),createElementBlock("div",_hoisted_2,[createVNode(m,{gap:"5",style:{padding:"5px"}},{default:withCtx((()=>[1==n.currentSelectMenu[0]?(openBlock(),createBlock(b,{key:0,title:"新建一个绘本",onConfirm:e[10]||(e[10]=t=>s.onBtnCreateModel(null,this.newProjectName))},{description:withCtx((()=>[createVNode(v,{value:n.newProjectName,"onUpdate:value":e[8]||(e[8]=t=>n.newProjectName=t),"addon-before":"绘本编号",placeholder:"请输入新绘本编号",style:{"margin-bottom":"5px"}},null,8,["value"]),createVNode(v,{value:n.inputModelDes,"onUpdate:value":e[9]||(e[9]=t=>n.inputModelDes=t),"addon-before":"绘本备注",placeholder:"输入绘本备注"},null,8,["value"])])),default:withCtx((()=>[createVNode(a,{type:"primary"},{default:withCtx((()=>[...e[57]||(e[57]=[createTextVNode("新建绘本",-1)])])),_:1})])),_:1})):createCommentVNode("",!0),e[59]||(e[59]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),1==n.currentSelectMenu[0]?(openBlock(),createBlock(b,{key:1,title:"系统设置",placement:"bottomRight",onConfirm:s.onSaveSetting},{description:withCtx((()=>[createVNode(x,{values:n.systemSetting,vertical:!0,marginLeft:"0px"},null,8,["values"])])),default:withCtx((()=>[createVNode(a,{type:"primary"},{default:withCtx((()=>[...e[58]||(e[58]=[createTextVNode("系统设置",-1)])])),_:1})])),_:1},8,["onConfirm"])):createCommentVNode("",!0)])),_:1}),1==n.currentSelectMenu[0]?(openBlock(),createBlock(M,{key:0,modelValue:n.modelTableDatas,"onUpdate:modelValue":e[15]||(e[15]=t=>n.modelTableDatas=t),target:".ant-table-tbody",draggable:".ant-table-row",sort:!0,animation:150,onOnUpdate:s.onUpdate,onEnd:s.onEnd},{default:withCtx((()=>[createVNode(P,{columns:n.modelTableColumns,"data-source":n.modelTableDatas,size:"small",bordered:"",pagination:!1,rowKey:"name",scroll:{y:n.screenHeight-88}},{customFilterDropdown:withCtx((({setSelectedKeys:t,selectedKeys:i,confirm:r,clearFilters:o,column:l})=>[createVNode(m,{vertical:"",style:{padding:"8px"},gap:"small"},{default:withCtx((()=>[createVNode(v,{ref:"searchInput",placeholder:"搜索名称或编号",value:i[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:t=>s.handleSearch(i,r,l.dataIndex)},null,8,["value","onChange","onPressEnter"]),createVNode(T,{size:"small",value:i,placeholder:"筛选分组",style:{width:"100%"},mode:"tags",maxTagCount:1,options:n.bookGroupBySearch,onChange:e=>t(e)},null,8,["value","options","onChange"]),createBaseVNode("div",null,[createVNode(a,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:t=>s.handleSearch(i,r,l.dataIndex)},{icon:withCtx((()=>[createVNode(C)])),default:withCtx((()=>[e[60]||(e[60]=createTextVNode(" 搜索 ",-1))])),_:1},8,["onClick"]),createVNode(a,{size:"small",style:{width:"90px"},onClick:t=>s.handleReset(o)},{default:withCtx((()=>[...e[61]||(e[61]=[createTextVNode(" 重置 ",-1)])])),_:1},8,["onClick"])])])),_:2},1024)])),customFilterIcon:withCtx((({filtered:t})=>[createVNode(S,{style:normalizeStyle({color:t?"#108ee9":void 0})},null,8,["style"])])),bodyCell:withCtx((({column:t,record:i})=>["des"===t.key?(openBlock(),createBlock(m,{key:0,gap:"small"},{default:withCtx((()=>[createBaseVNode("div",null,toDisplayString(i.des),1),e[62]||(e[62]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),1==n.currentSelectMenu[0]?(openBlock(),createBlock(b,{key:0,title:"修改绘本备注",onConfirm:t=>s.onBtnEditProjectDes(i.name)},{description:withCtx((()=>[createVNode(v,{value:n.inputModelDes,"onUpdate:value":e[11]||(e[11]=t=>n.inputModelDes=t),"addon-before":"绘本备注",placeholder:"请输入绘本备注",style:{width:"500px"}},null,8,["value"])])),default:withCtx((()=>[createVNode(a,{type:"text"},{default:withCtx((()=>[createVNode(w)])),_:1})])),_:1},8,["onConfirm"])):createCommentVNode("",!0)])),_:2},1024)):createCommentVNode("",!0),"action"===t.key?(openBlock(),createBlock(m,{key:1,gap:"small",align:"center",justify:"center",style:{overflow:"scroll"}},{default:withCtx((()=>[createVNode(a,{size:"small",type:"primary",onClick:t=>s.onBtnLoadModel(i.name)},{default:withCtx((()=>[...e[63]||(e[63]=[createTextVNode("编辑",-1)])])),_:1},8,["onClick"]),createVNode(a,{size:"small",type:"default",onClick:t=>s.onBtnExportModel(i.name)},{default:withCtx((()=>[createVNode(A)])),_:1},8,["onClick"]),createVNode(b,{title:"复制绘本",placement:"bottomRight",onConfirm:t=>s.onBtnCopyModel(i.name)},{description:withCtx((()=>[createVNode(v,{value:n.newProjectName,"onUpdate:value":e[12]||(e[12]=t=>n.newProjectName=t),placeholder:"请输入新绘本编号"},null,8,["value"])])),default:withCtx((()=>[createVNode(a,null,{default:withCtx((()=>[createVNode(E)])),_:1})])),_:1},8,["onConfirm"]),createVNode(b,{title:"删除警告",placement:"bottomRight"},{description:withCtx((()=>[createBaseVNode("div",_hoisted_3,"确定要删除绘本："+toDisplayString(i.name)+"?",1),null!=i.config?(openBlock(),createElementBlock("div",_hoisted_4,"《"+toDisplayString(i.config.name)+"》",1)):createCommentVNode("",!0),e[64]||(e[64]=createBaseVNode("div",{style:{position:"relative",right:"0px",color:"#FF4D50"}},"此操作不可撤销，需校验权限",-1)),createVNode(D,{modelValue:n.verificationCode,"onUpdate:modelValue":e[13]||(e[13]=t=>n.verificationCode=t),formatter:t=>!!/^\d*$/.test(t)&&t},null,8,["modelValue","formatter"])])),okButton:withCtx((()=>[createVNode(a,{danger:"",onClick:t=>s.onBtnDeleteModel(i.name)},{default:withCtx((()=>[...e[65]||(e[65]=[createTextVNode(" 确定 ",-1)])])),_:1},8,["onClick"])])),default:withCtx((()=>[createVNode(a,{type:"text",danger:"",shape:"circle"},{default:withCtx((()=>[createVNode(L)])),_:1})])),_:2},1024)])),_:2},1024)):createCommentVNode("",!0),"publishTime"===t.key?(openBlock(),createElementBlock(Fragment,{key:2},[createTextVNode(toDisplayString(s.formatTime(i.publishTime)),1)],64)):createCommentVNode("",!0),"name"===t.key?(openBlock(),createBlock(m,{key:3,gap:"small"},{default:withCtx((()=>[createVNode(a,{type:"link",onClick:t=>s.onBtnLoadModel(i.name)},{default:withCtx((()=>[createTextVNode(toDisplayString(i.name),1)])),_:2},1032,["onClick"]),e[66]||(e[66]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),createVNode(b,{title:"重命名绘本编号",onConfirm:t=>s.onBtnRenameProject(i.name)},{description:withCtx((()=>[createVNode(v,{value:n.newProjectName,"onUpdate:value":e[14]||(e[14]=t=>n.newProjectName=t),placeholder:"请输入新绘本编号"},null,8,["value"])])),default:withCtx((()=>[createVNode(a,{type:"text"},{default:withCtx((()=>[createVNode(w)])),_:1})])),_:1},8,["onConfirm"])])),_:2},1024)):createCommentVNode("",!0),"showName"===t.key?(openBlock(),createBlock(m,{key:4,gap:"small"},{default:withCtx((()=>[createBaseVNode("div",null,toDisplayString(i.config&&i.config.name?i.config.name:""),1),e[67]||(e[67]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),createVNode(b,{title:"修改绘本配置",placement:"right",onConfirm:t=>s.onConfigChangeSave(i)},{description:withCtx((()=>[createVNode(m,{align:"center",justify:"center",style:{width:"100%"}},{default:withCtx((()=>[createVNode(I,{name:"file",style:{padding:"0px","margin-bottom":"5px"},multiple:!1,onChange:s.handleChangeCover,customRequest:s.handleUploadCover,onDrop:s.handleDropCover},{default:withCtx((()=>[createBaseVNode("div",_hoisted_5,[createBaseVNode("img",{style:{width:"100%",height:"100%","object-fit":"cover",position:"absolute",top:"0",left:"0"},src:s.getCoverUrl(i)},null,8,_hoisted_6)])])),_:2},1032,["onChange","customRequest","onDrop"])])),_:2},1024),createVNode(x,{values:n.huiceConfig,vertical:!0,marginLeft:"0px"},null,8,["values"])])),default:withCtx((()=>[createVNode(a,{onClick:t=>s.onClickTableConfig(i)},{default:withCtx((()=>[createVNode(c)])),_:1},8,["onClick"])])),_:2},1032,["onConfirm"])])),_:2},1024)):createCommentVNode("",!0)])),_:1},8,["columns","data-source","scroll"])])),_:1},8,["modelValue","onOnUpdate","onEnd"])):createCommentVNode("",!0)])):createCommentVNode("",!0),withDirectives(createVNode(m,{gap:"small",style:normalizeStyle([{padding:"5px",overflow:"auto"},{height:n.workSpaceHeight}])},{default:withCtx((()=>[withDirectives(createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[n.curOpenLayout[0]?(openBlock(),createBlock(R,{key:0,size:"small",title:"绘本配置",style:{"min-width":"332px","user-select":"none"}},{default:withCtx((()=>[createVNode(x,{values:n.huiceConfig,vertical:!0,marginLeft:"0px",onOnChange:s.onhuiceConfigChange},null,8,["values","onOnChange"])])),_:1})):createCommentVNode("",!0),withDirectives(createVNode(K,{ref:"previewParent",drageHandId:"dragTitle",enableDrag:n.cocosConfig.cocosPreviewCanDrag,aspectRadio:n.cocosConfig.aspectRadio,oriHeight:n.previewCardMinHeight,localStorageDrag:!0},{default:withCtx((()=>[createVNode(q,{style:normalizeStyle([{width:"100%",height:"100%"},{"min-width":n.previewCardMinWidth+"px","min-height":n.previewCardMinHeight+"px"}])},{default:withCtx((({width:i,height:r})=>[createVNode(R,{style:normalizeStyle([{height:"100%"},{"min-width":n.previewCardMinWidth+"px","min-height":n.previewCardMinHeight+"px"}]),onClick:withModifiers((()=>{}),["stop"]),onMousemove:withModifiers((()=>{}),["stop"])},{title:withCtx((()=>[...e[68]||(e[68]=[createBaseVNode("div",{id:"dragTitle",style:{cursor:"move"}},"分镜预览",-1)])])),extra:withCtx((()=>[createVNode(m,{gap:"small"},{default:withCtx((()=>[n.cocosConfig.cocosPreviewCanDrag?(openBlock(),createBlock(T,{key:0,size:"small",optionLabelProp:"value",dropdownMatchSelectWidth:150,value:n.cocosConfig.radio,"onUpdate:value":e[16]||(e[16]=t=>n.cocosConfig.radio=t),options:n.cocosConfig.radioOptions,onChange:e[17]||(e[17]=t=>s.onChangeRadionPicker(n.cocosConfig.radio))},null,8,["value","options"])):createCommentVNode("",!0),createVNode(B,null,{title:withCtx((()=>[...e[69]||(e[69]=[createTextVNode("清空场景",-1)])])),default:withCtx((()=>[createVNode(O,{style:{"font-size":"larger",color:"#FF4D50"},onClick:s.onClickClearScene},null,8,["onClick"])])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[70]||(e[70]=[createTextVNode("激活摄像机预览",-1)])])),default:withCtx((()=>[createVNode(N,{style:normalizeStyle([{color:n.cocosConfig.isPreviewMode?"":"#1568DD"},{"font-size":"larger"}]),onClick:e[18]||(e[18]=t=>s.onClickTreePreview("isPreviewMode"))},null,8,["style"])])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[71]||(e[71]=[createTextVNode("显示安全框",-1)])])),default:withCtx((()=>[createVNode(k,{style:normalizeStyle([{color:n.cocosConfig.cocosPreviewIsShowGird?"#1568DD":""},{"font-size":"larger"}]),onClick:e[19]||(e[19]=t=>s.onClickTreePreview("cocosPreviewIsShowGird"))},null,8,["style"])])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[72]||(e[72]=[createTextVNode("显示节点树",-1)])])),default:withCtx((()=>[createVNode(F,{style:normalizeStyle([{color:n.cocosConfig.cocosPreviewIsShowTree?"#1568DD":""},{"font-size":"large"}]),onClick:e[20]||(e[20]=t=>s.onClickTreePreview("cocosPreviewIsShowTree"))},null,8,["style"])])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[73]||(e[73]=[createTextVNode("显示帧率信息",-1)])])),default:withCtx((()=>[createVNode(V,{style:normalizeStyle([{"font-size":"large"},{color:n.cocosConfig.cocosPreviewIsShowState?"#1568DD":""}]),onClick:e[21]||(e[21]=t=>s.onClickTreePreview("cocosPreviewIsShowState"))},null,8,["style"])])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[74]||(e[74]=[createTextVNode("显示碰撞框",-1)])])),default:withCtx((()=>[createVNode(j,{style:normalizeStyle([{"font-size":"large"},{color:n.cocosConfig.cocosPreviewIsShowColiderBox?"#1568DD":""}]),onClick:e[22]||(e[22]=t=>s.onClickTreePreview("cocosPreviewIsShowColiderBox"))},null,8,["style"])])),_:1}),0==n.cocosConfig.mute?(openBlock(),createBlock(G,{key:1,style:{"font-size":"large",color:"#1677FF"},onClick:e[23]||(e[23]=t=>s.onClickTreePreview("mute"))})):(openBlock(),createBlock(U,{key:2,style:{"font-size":"large"},onClick:e[24]||(e[24]=t=>s.onClickTreePreview("mute"))})),0==n.cocosConfig.cocosPreviewCanDrag?(openBlock(),createBlock(Y,{key:3,style:{"font-size":"large"},onClick:e[25]||(e[25]=t=>s.onClickTreePreview("cocosPreviewCanDrag"))})):(openBlock(),createBlock(H,{key:4,style:{"font-size":"large"},onClick:e[26]||(e[26]=t=>s.onClickTreePreview("cocosPreviewCanDrag"))})),createVNode(B,null,{title:withCtx((()=>[...e[75]||(e[75]=[createTextVNode("在新窗口中预览",-1)])])),default:withCtx((()=>[createVNode(X,{style:{"font-size":"large"},onClick:s.onClickNewPreview},null,8,["onClick"])])),_:1})])),_:1})])),default:withCtx((()=>[withDirectives((openBlock(),createElementBlock("div",{id:"GameDiv",style:normalizeStyle([{position:"absolute","user-select":"none"},{width:i-12+"px",height:r-50+"px"}])},[createBaseVNode("canvas",{id:"GameCanvas",style:{"user-select":"none"},width:i-12,height:r-50},null,8,_hoisted_9),n.cocosConfig.cocosPreviewIsShowGird?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(t.saveAreaLines,(t=>(openBlock(),createElementBlock("div",{style:normalizeStyle([{position:"absolute","background-color":"#FF4D50"},{top:t.top+"px",left:t.left+"px",width:t.width,height:t.height}])},null,4)))),256)):createCommentVNode("",!0)],4)),[[Tt,s.onPreviewSizeChange]]),n.cocosConfig.cocosPreviewIsShowTree?(openBlock(),createBlock(K,{key:0,enableDrag:!0,oriWidth:229,disableWidth:"",handPosOnLeft:"",style:normalizeStyle([{position:"absolute",top:"0"},{left:-n.cocosPreviewTreeWidth-4+"px"}])},{default:withCtx((()=>[createVNode(q,{style:normalizeStyle([{"min-height":n.previewCardMinHeight+"px"},{width:"100%",height:"100%"}])},{default:withCtx((({width:t,height:i})=>[withDirectives((openBlock(),createBlock(R,{title:"节点层级"},{extra:withCtx((()=>[createVNode(m,{gap:"middle"},{default:withCtx((()=>[createVNode(z,{style:{"font-size":"larger"},onClick:s.onClickTreeExport},null,8,["onClick"]),createVNode(W,{style:{"font-size":"larger"},onClick:s.onClickConsoleSelect},null,8,["onClick"]),createVNode(Z,{style:{"font-size":"larger"},onClick:s.onClickFreshPreview},null,8,["onClick"])])),_:1})])),default:withCtx((()=>[createBaseVNode("div",{style:normalizeStyle([{overflow:"scroll"},{height:i-50+"px"}])},[createVNode(J,{"tree-data":n.cocosPreviewTreeData,expandedKeys:n.expandedKeys,"onUpdate:expandedKeys":e[27]||(e[27]=t=>n.expandedKeys=t),fieldNames:{title:"name",key:"id"},onSelect:s.onSelectCocosNode},null,8,["tree-data","expandedKeys","onSelect"])],4)])),_:2},1024)),[[Tt,s.onPreviewTreeSizeChange]])])),_:2},1032,["style"])])),_:2},1032,["style"])):createCommentVNode("",!0)])),_:2},1032,["style"])])),_:1},8,["style"])])),_:1},8,["enableDrag","aspectRadio","oriHeight"]),[[vShow,n.curOpenLayout[1]]])]),n.curOpenLayout[2]?(openBlock(),createBlock(R,{key:0,id:"celueLiebiaoCard",class:"widthAni",style:normalizeStyle([{width:n.expandPolicyList?"700px":"332px"},{"min-width":"332px","flex-grow":"1","flex-shrink":"0","user-select":"none"}]),size:"small",title:"分镜列表"},{extra:withCtx((()=>[createVNode(m,{gap:"small",align:"center",justify:"center"},{default:withCtx((()=>[createVNode(b,{title:"新建分镜",onConfirm:s.onClickAddPolicy},{description:withCtx((()=>[createVNode(v,{value:n.newPolicyName,"onUpdate:value":e[28]||(e[28]=t=>n.newPolicyName=t),placeholder:"请输入分镜名称"},null,8,["value"])])),default:withCtx((()=>[createVNode(a,{type:"primary",shape:"circle"},{default:withCtx((()=>[createVNode(Q)])),_:1})])),_:1},8,["onConfirm"]),createVNode(b,{title:"复制当前选中分镜",onConfirm:s.onClickCopyPolicy},{description:withCtx((()=>[e[76]||(e[76]=createBaseVNode("div",null,"复制到哪个绘本下：",-1)),createVNode(T,{size:"small",style:{width:"100%","margin-bottom":"7px"},value:n.copyToProject,"onUpdate:value":e[29]||(e[29]=t=>n.copyToProject=t),options:s.getProjectOptions()},null,8,["value","options"]),e[77]||(e[77]=createBaseVNode("div",null,"新的分镜名称：",-1)),createVNode(v,{value:n.newPolicyName,"onUpdate:value":e[30]||(e[30]=t=>n.newPolicyName=t),placeholder:"请输入新分镜名称"},null,8,["value"])])),default:withCtx((()=>[createVNode(a,{type:"primary",ghost:"",shape:"circle"},{default:withCtx((()=>[createVNode(E)])),_:1})])),_:1},8,["onConfirm"]),createVNode(b,{title:"确认删除当前选中的分镜吗？",onConfirm:s.onClickDeletePolicy},{description:withCtx((()=>[e[78]||(e[78]=createBaseVNode("div",{style:{position:"relative",right:"0px",color:"#FF4D50"}},"此操作不可撤销，需校验权限",-1)),createVNode(D,{modelValue:n.verificationCode,"onUpdate:modelValue":e[31]||(e[31]=t=>n.verificationCode=t),formatter:t=>!!/^\d*$/.test(t)&&t},null,8,["modelValue","formatter"])])),default:withCtx((()=>[createVNode(a,{type:"primary",danger:"",shape:"circle"},{default:withCtx((()=>[createVNode(L)])),_:1})])),_:1},8,["onConfirm"]),createVNode(_,{size:"default",checked:n.expandPolicyList,"onUpdate:checked":e[32]||(e[32]=t=>n.expandPolicyList=t)},{checkedChildren:withCtx((()=>[createVNode($)])),unCheckedChildren:withCtx((()=>[createVNode(tt,{rotate:90})])),_:1},8,["checked"])])),_:1})])),default:withCtx((()=>[null!=n.curEditTabDit[n.tabActiveKey]?(openBlock(),createBlock(M,{key:0,animation:150,modelValue:n.curEditTabDit[n.tabActiveKey].policyList,"onUpdate:modelValue":e[33]||(e[33]=t=>n.curEditTabDit[n.tabActiveKey].policyList=t),sort:!0,style:normalizeStyle([{height:n.celueLiebiaoBodyHeight+"px"},{display:"flex","flex-direction":"column",gap:"5px",overflow:"scroll"}])},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.curEditTabDit[n.tabActiveKey].policyList,((t,i)=>(openBlock(),createBlock(R,{key:t.name,size:"small",onClick:e=>s.onClickOnePolicy(t)},{title:withCtx((()=>[createVNode(m,{gap:"0px",align:"center"},{default:withCtx((()=>[createBaseVNode("div",{style:normalizeStyle([{"flex-shrink":"0","max-width":"150px"},{color:null!=n.curEditTabDit[n.tabActiveKey]&&n.curEditTabDit[n.tabActiveKey].curSelectPolicy==t.name?"#3c89e8":""}])},toDisplayString(i+1+"."+t.name),5),e[79]||(e[79]=createBaseVNode("div",{style:{height:"10px",width:"10px","flex-grow":"1"}},null,-1))])),_:2},1024)])),extra:withCtx((()=>[createVNode(m,{gap:"small",align:"center"},{default:withCtx((()=>[createVNode(_,{checked:t.active,"onUpdate:checked":e=>t.active=e,onClick:s.onStopClick},null,8,["checked","onUpdate:checked","onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue","style"])):createCommentVNode("",!0)])),_:1},8,["style"])):createCommentVNode("",!0)],512),[[vShow,n.curOpenLayout[0]||n.curOpenLayout[1]||n.curOpenLayout[2]]]),createVNode(R,{id:"canvasCard",size:"small",style:{"user-select":"none"}},{title:withCtx((()=>[createVNode(m,{gap:"small",align:"center"},{default:withCtx((()=>[createVNode(et,{value:n.ruleChooseTabOption,"onUpdate:value":e[34]||(e[34]=t=>n.ruleChooseTabOption=t),block:"",options:["蓝图","表格"]},null,8,["value"]),createBaseVNode("div",_hoisted_10,[createVNode(it,{mode:"horizontal",triggerSubMenuAction:"click",items:n.ruleMenu,selectable:!1,onOpenChange:s.onMenuOpenChange,onClick:s.onClickMenuItem,style:{"user-select":"none",width:"450px"}},null,8,["items","onOpenChange","onClick"])]),0!=n.importProgress&&100!=n.importProgress?(openBlock(),createBlock(m,{key:0,gap:"small",align:"center"},{default:withCtx((()=>[createBaseVNode("div",null,"资源导入中"+toDisplayString(n.importInfo),1),createVNode(rt,{percent:n.importProgress||0,type:"circle",size:20,"stroke-width":20,format:t=>`导入资源中，已完成${t}%`,style:{"flex-shrink":"0"}},null,8,["percent","format"])])),_:1})):createCommentVNode("",!0),e[88]||(e[88]=createBaseVNode("div",null,"自动替换",-1)),createVNode(B,null,{title:withCtx((()=>[...e[80]||(e[80]=[createTextVNode("开启后上传资源将自动替换所有分镜中已使用的同名称资源",-1)])])),default:withCtx((()=>[createVNode(_,{checked:n.configs.uploadReplaceAssestByName,"onUpdate:checked":e[35]||(e[35]=t=>n.configs.uploadReplaceAssestByName=t)},null,8,["checked"])])),_:1}),createVNode(a,null,{default:withCtx((()=>[e[81]||(e[81]=createTextVNode(" 上传资源 ",-1)),createBaseVNode("input",{type:"file",onChange:e[36]||(e[36]=(...t)=>s.onBtnImportAssest&&s.onBtnImportAssest(...t)),ref:"modelImport2",multiple:"",accept:".png,.jpg,.jepg,.json,.atlas,.mp3,.wav",style:{opacity:"0","font-size":"30px",width:"100%",position:"absolute",top:"0",left:"0"}},null,544)])),_:1}),createVNode(B,null,{title:withCtx((()=>[...e[82]||(e[82]=[createBaseVNode("div",null,"录制操作：运行后将录制点击事件，停止后结束录制并记录到当前分镜",-1),createBaseVNode("div",null,"自动点击：运行后如果当前有录制好的操作，将自动点击需要触发的操作",-1)])])),default:withCtx((()=>[createVNode(st,{value:n.configs.recordType,"onUpdate:value":e[37]||(e[37]=t=>n.configs.recordType=t),"button-style":"solid"},{default:withCtx((()=>[createVNode(nt,{value:"none"},{default:withCtx((()=>[...e[83]||(e[83]=[createTextVNode("关闭",-1)])])),_:1}),createVNode(nt,{value:"autoRecordTouch"},{default:withCtx((()=>[...e[84]||(e[84]=[createTextVNode("录制操作",-1)])])),_:1}),createVNode(nt,{value:"autoRunRecordTouch"},{default:withCtx((()=>[...e[85]||(e[85]=[createTextVNode("自动点击",-1)])])),_:1})])),_:1},8,["value"])])),_:1}),null!=n.freshState&&1!=s.getPolicyState(n.tabActiveKey,"isRuning")?(openBlock(),createBlock(a,{key:1,onClick:s.onClickRunGraph},{default:withCtx((()=>[...e[86]||(e[86]=[createTextVNode("运行",-1)])])),_:1},8,["onClick"])):(openBlock(),createBlock(a,{key:2,danger:"",onClick:s.onClickStopGraph},{default:withCtx((()=>[...e[87]||(e[87]=[createTextVNode("停止",-1)])])),_:1},8,["onClick"])),0==n.curOpenLayout[4]?(openBlock(),createBlock(ot,{key:3,style:{"font-size":"larger",color:"#1568DD"},onClick:e[38]||(e[38]=t=>s.onClickChangeShowView(4))})):createCommentVNode("",!0)])),_:1})])),default:withCtx((()=>[createBaseVNode("div",{style:normalizeStyle([{width:n.canvasWidth+"px",height:n.canvasHeight+"px"},{position:"relative"}]),onDrop:e[45]||(e[45]=withModifiers(((...t)=>s.handleDrop&&s.handleDrop(...t)),["prevent"]))},[withDirectives(createBaseVNode("canvas",{id:"mycanvas",width:n.canvasWidth,height:n.canvasHeight},null,8,_hoisted_11),[[vShow,"蓝图"==n.ruleChooseTabOption]]),withDirectives(createVNode(M,{modelValue:n.curEditLgraphTable,"onUpdate:modelValue":e[44]||(e[44]=t=>n.curEditLgraphTable=t),target:".ant-table-tbody",draggable:".ant-table-row",sort:!0,animation:150,onEnd:s.onLgraphTableDragEnd},{default:withCtx((()=>[createVNode(P,{columns:n.graphTableColumns,"data-source":n.curEditLgraphTable,size:"small",bordered:!0,pagination:!1,rowKey:"id",scroll:{x:n.canvasWidth-80,y:n.canvasHeight-40},onResizeColumn:s.handleResizeTableColumn},{headerCell:withCtx((({column:t})=>["linkNode_1"==t.key?(openBlock(),createBlock(B,{key:0},{title:withCtx((()=>[...e[89]||(e[89]=[createTextVNode("此列下的动画指令将在进入页面时自动播放，注意：如果两个spine动画同时播放，第二个将覆盖前一个，如果两个数值动画同时播放，可能相互影响",-1)])])),default:withCtx((()=>[createTextVNode(" "+toDisplayString(t.title),1)])),_:2},1024)):createCommentVNode("",!0),"action"==t.key?(openBlock(),createBlock(m,{key:1,align:"center",gap:"4"},{default:withCtx((()=>[e[92]||(e[92]=createBaseVNode("div",null,"操作",-1)),e[93]||(e[93]=createBaseVNode("div",{style:{"flex-grow":"1"}},null,-1)),createVNode(B,{placement:"bottomRight"},{title:withCtx((()=>[...e[90]||(e[90]=[createTextVNode("添加关联指令列",-1)])])),default:withCtx((()=>[createVNode(at,{onClick:s.addOneColumnToTable},null,8,["onClick"])])),_:1}),createVNode(B,{placement:"bottomRight"},{title:withCtx((()=>[...e[91]||(e[91]=[createTextVNode("显示资源名称列",-1)])])),default:withCtx((()=>[createVNode(_,{checked:n.configs.showNameColumn,"onUpdate:checked":e[39]||(e[39]=t=>n.configs.showNameColumn=t),onChange:s.addNameColumnToTable},null,8,["checked","onChange"])])),_:1})])),_:1})):createCommentVNode("",!0)])),bodyCell:withCtx((({column:t,record:i,index:r})=>["modal"==t.key?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(i.modal),1)],64)):createCommentVNode("",!0),"img"==t.key?(openBlock(),createBlock(ct,{key:1,title:"预览",placement:"left",trigger:"click"},{content:withCtx((()=>[createBaseVNode("img",{src:i.img,style:{"max-width":"300px","max-height":"300px"}},null,8,_hoisted_12),createBaseVNode("div",null,"物体类型："+toDisplayString(i.modal),1),createBaseVNode("div",null,"资源："+toDisplayString(i.customeName),1)])),default:withCtx((()=>[createBaseVNode("div",_hoisted_13,[null!=i.img?(openBlock(),createElementBlock("div",_hoisted_14,[createBaseVNode("img",{style:{width:"100%",height:"100%","object-fit":"contain",position:"absolute",top:"0",left:"0"},src:i.img},null,8,_hoisted_15)])):(openBlock(),createBlock(lt,{key:1,style:{"margin-right":"0px"},color:"文本"==i.modal?"purple":"blue"},{default:withCtx((()=>[createTextVNode(toDisplayString("文本"==i.modal?i.customeName.length>8?i.customeName.substring(0,8)+"...":i.customeName:i.modal),1)])),_:2},1032,["color"]))])])),_:2},1024)):createCommentVNode("",!0),-1!=t.key.indexOf("linkNode")?(openBlock(),createElementBlock(Fragment,{key:2},[null!=i[t.key]?(openBlock(),createBlock(M,{key:0,class:"我是拖拽parent",modelValue:i[t.key],"onUpdate:modelValue":e=>i[t.key]=e,"data-row":r,"data-col":t.key,group:"tableCell",animation:150,onEnd:e=>s.onGraphTableCellDragEnd(e,i,t.key)},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i[t.key],((r,o)=>(openBlock(),createBlock(m,{gap:"3",style:normalizeStyle({"margin-top":0==o?"0px":"8px"})},{default:withCtx((()=>[createVNode(ut,null,{overlay:withCtx((()=>[createVNode(it,{items:n.moreActionMenu,selectable:!1,onOpenChange:s.onMenuOpenChange,onClick:e=>s.onClickMenuItem(e,i,t.key,o)},null,8,["items","onOpenChange","onClick"])])),default:withCtx((()=>[createVNode(ht,{onClick:e[40]||(e[40]=withModifiers((()=>{}),["prevent"]))})])),_:2},1024),0==r.noInput?(openBlock(),createBlock(ut,{key:0,onOpenChange:e=>s.getCellInputLinkMenu(e,i,t.key,o)},{overlay:withCtx((()=>[createBaseVNode("div",null,[createVNode(it,{items:n.inputLinkMenu,selectable:!1,onOpenChange:s.onMenuOpenChange,onClick:e=>s.onClickCellInputMenuItem(e,i,t.key,o)},null,8,["items","onOpenChange","onClick"])])])),default:withCtx((()=>[createVNode(dt,{onClick:e[41]||(e[41]=withModifiers((()=>{}),["prevent"])),style:normalizeStyle({color:0==r.inputs.length?"red":"green"})},null,8,["style"])])),_:2},1032,["onOpenChange"])):createCommentVNode("",!0),createVNode(lt,{style:{"margin-right":"0px"},color:1==n.highlightNodeDit[r.id]?"#87d068":r.tagColor?r.tagColor:""},{default:withCtx((()=>[createTextVNode(toDisplayString(r.title+r.id),1)])),_:2},1032,["color"]),null!=r.config?(openBlock(),createBlock(x,{key:1,gap:"3",values:r.config,marginLeft:"0px",onOnChange:e=>s.onGraphTableConfigChange(e,i,t.key,o)},null,8,["values","onOnChange"])):createCommentVNode("",!0),0==r.noOutput?(openBlock(),createBlock(ut,{key:2,onOpenChange:e=>s.getCellOutputLinkMenu(e,i,t.key,o)},{overlay:withCtx((()=>[createVNode(it,{items:n.outputLinkMenu,selectable:!1,onOpenChange:s.onMenuOpenChange,onClick:e=>s.onClickCellOutputMenuItem(e,i,t.key,o)},null,8,["items","onOpenChange","onClick"])])),default:withCtx((()=>[createVNode(pt,{onClick:e[42]||(e[42]=withModifiers((()=>{}),["prevent"])),style:normalizeStyle({color:0==r.outputs.length?"red":"green"})},null,8,["style"])])),_:2},1032,["onOpenChange"])):createCommentVNode("",!0)])),_:2},1032,["style"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue","data-row","data-col","onEnd"])):createCommentVNode("",!0),null!=i[t.key]&&0==i[t.key].length?(openBlock(),createBlock(ut,{key:1},{overlay:withCtx((()=>[createVNode(it,{items:n.moreActionMenu,selectable:!1,onOpenChange:s.onMenuOpenChange,onClick:e=>s.onClickMenuItem(e,i,t.key,-1)},null,8,["items","onOpenChange","onClick"])])),default:withCtx((()=>[createVNode(ht,{onClick:e[43]||(e[43]=withModifiers((()=>{}),["prevent"]))})])),_:2},1024)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),"action"==t.key?(openBlock(),createBlock(m,{key:3,gap:"small",align:"center",justify:"center",style:{overflow:"scroll"}},{default:withCtx((()=>[createVNode(b,{title:"删除警告",placement:"rightTop"},{description:withCtx((()=>[createBaseVNode("div",_hoisted_16,"确定要删除id"+toDisplayString(i.id)+"物体?",1)])),okButton:withCtx((()=>[createVNode(a,{danger:"",onClick:t=>s.onBtnDeleteTableRow(r,i)},{default:withCtx((()=>[...e[94]||(e[94]=[createTextVNode(" 确定 ",-1)])])),_:1},8,["onClick"])])),default:withCtx((()=>[createVNode(a,{type:"text",danger:"",shape:"circle"},{default:withCtx((()=>[createVNode(L)])),_:1})])),_:2},1024),createVNode(a,{type:"text",shape:"circle",onClick:t=>s.toggleNodeIdToGraph(i.id)},{default:withCtx((()=>[createVNode(ft)])),_:1},8,["onClick"])])),_:2},1024)):createCommentVNode("",!0)])),_:1},8,["columns","data-source","scroll","onResizeColumn"])])),_:1},8,["modelValue","onEnd"]),[[vShow,"表格"==n.ruleChooseTabOption]]),1==n.isShowMenu?(openBlock(),createElementBlock("div",{key:0,style:normalizeStyle([{width:n.canvasWidth+"px",height:n.canvasHeight+"px"},{position:"absolute",opacity:"0.4",top:"0"}])},null,4)):createCommentVNode("",!0)],36)])),_:1})])),_:1},8,["style"]),[[vShow,0!=n.tabActiveKey]])]),createVNode(yt,{open:n.importModelOpen,"onUpdate:open":e[48]||(e[48]=t=>n.importModelOpen=t),title:"导入旧版绘本",onOk:s.handleOkImport},{default:withCtx((()=>[createVNode(x,{vertical:!0,gap:"3",values:n.importOldVersionConfig,marginLeft:"0px",onOnChange:s.onImportOldVersionConfigChange},null,8,["values","onOnChange"]),createBaseVNode("div",_hoisted_17,[createVNode(_t,{style:{},indeterminate:n.importCheckedIndeterminate,checked:n.importCheckAll,"onUpdate:checked":e[46]||(e[46]=t=>n.importCheckAll=t),onChange:s.onCheckAllChange},{default:withCtx((()=>[...e[96]||(e[96]=[createTextVNode(" 全选 ",-1)])])),_:1},8,["indeterminate","checked","onChange"])]),createVNode(mt,{style:{"margin-bottom":"5px","margin-top":"5px"}}),createVNode(gt,{value:n.importCheckedPageList,"onUpdate:value":e[47]||(e[47]=t=>n.importCheckedPageList=t),options:n.importPageOptions,onChange:s.onImportPageCheck},null,8,["value","options","onChange"]),null!=n.importProgress&&0!=n.importProgress&&100!=n.importProgress?(openBlock(),createBlock(m,{key:0,gap:"small",align:"center",justify:"flex-end",style:{"margin-top":"10px"}},{default:withCtx((()=>[createBaseVNode("div",null,"资源导入中"+toDisplayString(n.importInfo),1),createVNode(rt,{percent:n.importProgress||0,type:"circle",size:20,"stroke-width":20,format:t=>`导入资源中，已完成${t}%`,style:{"flex-shrink":"0"}},null,8,["percent","format"])])),_:1})):createCommentVNode("",!0)])),_:1},8,["open","onOk"]),createVNode(yt,{open:n.editColiderOpen,"onUpdate:open":e[49]||(e[49]=t=>n.editColiderOpen=t),width:800,footer:null,destroyOnClose:!0,title:"编辑碰撞框"},{default:withCtx((()=>[createVNode(vt,{img:n.editColiderImg,pointArr:n.pointArr,imgScale:n.editColiderScale,onOnChange:t.onMarkEditOk},null,8,["img","pointArr","imgScale","onOnChange"])])),_:1},8,["open"]),createVNode(yt,{open:n.editSoundTextOpen,"onUpdate:open":e[50]||(e[50]=t=>n.editSoundTextOpen=t),width:1200,footer:null,destroyOnClose:!0,maskClosable:!1,title:"编辑音频字幕"},{default:withCtx((()=>[createVNode(bt,{audioUrl:n.editSoundTextParams.url,config:n.editSoundTextParams.motionTextData,onOnChange:s.onSoundTextEditOk},null,8,["audioUrl","config","onOnChange"])])),_:1},8,["open"]),createVNode(yt,{open:n.showCreateMotionTextModal,"onUpdate:open":e[51]||(e[51]=t=>n.showCreateMotionTextModal=t),width:600,destroyOnClose:!0,title:"创建字幕",onOk:s.handleOkCreateMotionText},{default:withCtx((()=>[createVNode(x,{vertical:!0,gap:"3",values:n.createMotionTextConfig,marginLeft:"0px"},null,8,["values"])])),_:1},8,["open","onOk"]),createVNode(yt,{open:n.showSoundBoxModal,"onUpdate:open":e[54]||(e[54]=t=>n.showSoundBoxModal=t),width:1e3,footer:null,maskClosable:!1,destroyOnClose:!0,onOk:s.handleOkSoundMotionText},{title:withCtx((()=>[createVNode(m,{gap:"small",align:"center"},{default:withCtx((()=>["soundBox"==n.curShowAssestBoxType?(openBlock(),createElementBlock("div",_hoisted_18,"音频资源库")):createCommentVNode("",!0),"spineBox"==n.curShowAssestBoxType?(openBlock(),createElementBlock("div",_hoisted_19,"动画资源库")):createCommentVNode("",!0),"imageBox"==n.curShowAssestBoxType?(openBlock(),createElementBlock("div",_hoisted_20,"图片资源库")):createCommentVNode("",!0),e[98]||(e[98]=createBaseVNode("div",{style:{"margin-left":"30px"}},"仅显示当前分镜资源",-1)),createVNode(_,{style:{"margin-right":"30px"},checked:n.justCurrentPage,"onUpdate:checked":e[52]||(e[52]=t=>n.justCurrentPage=t),onChange:s.freshAssestBoxData},null,8,["checked","onChange"]),0!=n.importProgress&&100!=n.importProgress?(openBlock(),createBlock(m,{key:3,gap:"small",align:"center"},{default:withCtx((()=>[createBaseVNode("div",null,"资源导入中"+toDisplayString(n.importInfo),1),createVNode(rt,{percent:n.importProgress||0,type:"circle",size:20,"stroke-width":20,format:t=>`导入资源中，已完成${t}%`,style:{"flex-shrink":"0"}},null,8,["percent","format"])])),_:1})):createCommentVNode("",!0),createVNode(a,null,{default:withCtx((()=>[e[97]||(e[97]=createTextVNode(" 全局替换资源 ",-1)),createBaseVNode("input",{type:"file",onChange:e[53]||(e[53]=(...t)=>s.onBtnImportAssest&&s.onBtnImportAssest(...t)),ref:"modelImport2",multiple:"",accept:".png,.jpg,.jepg,.json,.atlas,.mp3,.wav",style:{opacity:"0","font-size":"30px",width:"100%",position:"absolute",top:"0",left:"0"}},null,544)])),_:1})])),_:1})])),default:withCtx((()=>[createVNode(P,{columns:n.soundBoxColumns,"data-source":n.soundBoxDatas,size:"small",onChange:s.handleSoundBoxTableChange,bordered:"",pagination:!1,rowKey:"customeName"},{bodyCell:withCtx((({column:t,record:i})=>["action"===t.key?(openBlock(),createBlock(m,{key:0,gap:"small",align:"center",justify:"center",style:{overflow:"scroll"}},{default:withCtx((()=>[createVNode(B,{placement:"bottomRight"},{title:withCtx((()=>[...e[99]||(e[99]=[createTextVNode("将此音频添加到当前编辑的分镜",-1)])])),default:withCtx((()=>[createVNode(a,{onClick:t=>s.onBtnUseBoxOneRow(i)},{default:withCtx((()=>[...e[100]||(e[100]=[createTextVNode("使用",-1)])])),_:1},8,["onClick"])])),_:2},1024),createVNode(a,{onClick:t=>s.onBtnDownLoadBoxOneRow(i)},{default:withCtx((()=>[...e[101]||(e[101]=[createTextVNode("下载",-1)])])),_:1},8,["onClick"]),createVNode(a,{onClick:t=>s.onBtnPlayBoxOneRow(i)},{default:withCtx((()=>[...e[102]||(e[102]=[createTextVNode("播放",-1)])])),_:1},8,["onClick"])])),_:2},1024)):createCommentVNode("",!0),"graphUse"===t.key?(openBlock(),createBlock(m,{key:1,style:{overflow:"scroll"}},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.graphUse,(t=>(openBlock(),createBlock(lt,null,{default:withCtx((()=>[createTextVNode(toDisplayString(t),1)])),_:2},1024)))),256))])),_:2},1024)):createCommentVNode("",!0)])),_:1},8,["columns","data-source","onChange"])])),_:1},8,["open","onOk"])])),_:1},8,["locale"])}const BookEdit=exports("default",_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-52828108"]]))}}}))})();
